<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Android on QX 的笔记</title><link>https://lqxhub.github.io/categories/android/</link><description>Recent content in Android on QX 的笔记</description><generator>Hugo -- gohugo.io</generator><language>zh-cn</language><lastBuildDate>Sun, 10 Sep 2017 19:03:48 +0000</lastBuildDate><atom:link href="https://lqxhub.github.io/categories/android/index.xml" rel="self" type="application/rss+xml"/><item><title>Android NDK开发之环境搭建</title><link>https://lqxhub.github.io/posts/ddb43708/</link><pubDate>Sun, 10 Sep 2017 19:03:48 +0000</pubDate><guid>https://lqxhub.github.io/posts/ddb43708/</guid><description>&lt;p>工欲善其事，必先利其器。要想进行Android NDK开发首先我们载NDK的开发包，配置NDK开发环境，就像配置SDK差不多。配置NDK环境的方法有很多，可以去官网下载，也可以用SDK manger下载安装，还可以用Androidstudio的SDK管理下载。&lt;/p>
&lt;p>下图是在AS下安装NDK
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-733e2ec04c671b84.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-733e2ec04c671b84.webp" alt="NDK下载" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>红色标记的选项，可能排列的顺序不同，找到然后勾选，点击OK，等待下载完成。说一下这三个工具是干啥的吧。&lt;/p>
&lt;ul>
&lt;li>CMake是一个跨平台的编译工具，可以用简单的语句来描述所有平台的编译过程。&lt;/li>
&lt;li>LLDB是用来调试C++代码的工具&lt;/li>
&lt;li>NDk 不用多说了，用来编译和打包C++的一整套工具&lt;/li>
&lt;/ul>
&lt;p>这里要说一个坑，AS的下载是不支持断点的，一定要在良好的网络环境下载，要不然。。。。说多了都是泪，让校园网害苦了，最后用下载工具下载的压缩包。网络不好的情况下可以把下载链接提取出来，用下载工具下载，这样就不怕断网了。 AS下载完成会自动解压，自己下载的要解压到SDK的目录下，新建ndk-bundle文件夹。只要setting中的SDKTools下这三项打钩了就说明环境搭建成功了。&lt;/p>
&lt;blockquote>
&lt;p>Linux NDK压缩包下载地址 &lt;a class="link" href="https://dl.google.com/android/repository/android-ndk-r15c-linux-x86_64.zip" target="_blank" rel="noopener"
>https://dl.google.com/android/repository/android-ndk-r15c-linux-x86_64.zip&lt;/a>&lt;/p>
&lt;/blockquote>
&lt;p>我用的是Ubuntu系统，没找到SDK manger，就不介绍了，我记得Windows里有这个东西，界面和as里差不多，大同小异。
还有就是去官网&lt;a class="link" href="https://developer.android.google.cn/ndk/downloads/index.html" target="_blank" rel="noopener"
>下载&lt;/a>，选择适合自己系统的版本下载，然后解压到指定目录就行了
网速好的话还是推荐使用AS去安装NDK，毕竟简单，下载完成会自己解压到指定目录。自己下载压缩包如果没有解压到指定目录是无法使用的。
等一切都弄好以后，打开界面看到&lt;em>&lt;strong>CMake&lt;/strong>&lt;/em>，&lt;em>&lt;strong>LLDB&lt;/strong>&lt;/em> ，&lt;em>&lt;strong>NDK&lt;/strong>&lt;/em>都勾选了就说明配置成功了。
还有就是&lt;em>&lt;strong>CMake&lt;/strong>&lt;/em>，&lt;em>&lt;strong>LLDB&lt;/strong>&lt;/em> 只能通过AS下载，别的还没找到，这两个比较小，很快就下完了。&lt;/p>
&lt;p>到此环境搭建就算完成了。&lt;/p></description></item><item><title>自定义属性</title><link>https://lqxhub.github.io/posts/25a04712/</link><pubDate>Wed, 08 Mar 2017 18:27:24 +0000</pubDate><guid>https://lqxhub.github.io/posts/25a04712/</guid><description>&lt;p>这两天在Android中用到了自定义view，在自定义view时也顺便使用了下自定义属性。自定义属性以前只是耳闻 未曾谋面，这次借机会对自定义属性进行了一番学习，顺便总结了一下自定义属性的使用。
下面扫盲班老司机要开车了，小白快刷卡上车，大神拒载。&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-03310748610842de.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-03310748610842de.webp" alt="老司机" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>Android中经常用到自定义view，既然用了自定义view那就不得不提自定义属性。你是否思考过为什么我们在xml文件中进行布局时可以直接通过&lt;code>android:layout_width=&amp;quot;match_parent&amp;quot;&lt;/code>就可以设置控件的宽度呢？不只是宽度，几乎控件的所有属性都可以在xml文件中进行设置，这是怎样实现的呢，this is a question
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-03310748610842de.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-03310748610842de.webp" alt="TextView部分属性" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>我们自定义view时能不能也像系统提供的控件一样在xml文件中设置属性呢。答案是当然可以了，用到的就是今天要说的自定义属性。废话不多说 直接开干。
1，首先在res 的values文件夹下新建一个attrs.xml文件，就是这样
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-2417ee7808124d9c">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-2417ee7808124d9c" alt="新建的attrs.xml文件" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>2，开始编写我们需要的属性。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-xml" data-lang="xml">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">&amp;lt;?xml version=&amp;#34;1.0&amp;#34; encoding=&amp;#34;utf-8&amp;#34;?&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span>&lt;span style="color:#ff79c6">&amp;lt;resources&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span> &lt;span style="color:#ff79c6">&amp;lt;declare-styleable&lt;/span> &lt;span style="color:#50fa7b">name=&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;burce&amp;#34;&lt;/span>&lt;span style="color:#ff79c6">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span> &lt;span style="color:#ff79c6">&amp;lt;attr&lt;/span> &lt;span style="color:#50fa7b">name=&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;mHeight&amp;#34;&lt;/span> &lt;span style="color:#50fa7b">format=&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;integer&amp;#34;&lt;/span>&lt;span style="color:#ff79c6">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span> &lt;span style="color:#ff79c6">&amp;lt;attr&lt;/span> &lt;span style="color:#50fa7b">name=&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;mWidth&amp;#34;&lt;/span> &lt;span style="color:#50fa7b">format=&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;integer&amp;#34;&lt;/span>&lt;span style="color:#ff79c6">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span> &lt;span style="color:#ff79c6">&amp;lt;attr&lt;/span> &lt;span style="color:#50fa7b">name=&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;mName&amp;#34;&lt;/span> &lt;span style="color:#50fa7b">format=&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;string&amp;#34;&lt;/span>&lt;span style="color:#ff79c6">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span> &lt;span style="color:#ff79c6">&amp;lt;attr&lt;/span> &lt;span style="color:#50fa7b">name=&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;sex&amp;#34;&lt;/span> &lt;span style="color:#50fa7b">format=&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;enum&amp;#34;&lt;/span>&lt;span style="color:#ff79c6">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span> &lt;span style="color:#ff79c6">&amp;lt;enum&lt;/span> &lt;span style="color:#50fa7b">name=&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;man&amp;#34;&lt;/span> &lt;span style="color:#50fa7b">value=&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;0&amp;#34;&lt;/span>&lt;span style="color:#ff79c6">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span> &lt;span style="color:#ff79c6">&amp;lt;enum&lt;/span> &lt;span style="color:#50fa7b">name=&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;woman&amp;#34;&lt;/span> &lt;span style="color:#50fa7b">value=&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;1&amp;#34;&lt;/span>&lt;span style="color:#ff79c6">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span> &lt;span style="color:#ff79c6">&amp;lt;/attr&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span> &lt;span style="color:#ff79c6">&amp;lt;attr&lt;/span> &lt;span style="color:#50fa7b">name=&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;student&amp;#34;&lt;/span> &lt;span style="color:#50fa7b">format=&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;boolean&amp;#34;&lt;/span>&lt;span style="color:#ff79c6">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span> &lt;span style="color:#ff79c6">&amp;lt;/declare-styleable&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span>&lt;span style="color:#ff79c6">&amp;lt;/resources&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>说一下用到的东西
&lt;code>&amp;lt;declare-styleable name=&amp;quot;burce&amp;quot;&amp;gt;&lt;/code>其中的name的值随便定义一个，不要与系统的起冲突。
&lt;code> &amp;lt;attr name=&amp;quot;mHeight&amp;quot; format=&amp;quot;integer&amp;quot;/&amp;gt;&lt;/code>name就是自定义的属性的名字（比如系统控件的android:layout_width） format 就是属性的类型，这里支持10种类型，常用的有string，integer，boolean等等，这次我们用到了整形，枚举和布尔
注意：我们在自定义属性的名字的时候不能与系统的名字冲突，否则会报错&lt;/p>
&lt;p>3，新建一个类继承View类，实现3个构造方法，然后获取我们自定义的属性&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">public&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">class&lt;/span> &lt;span style="color:#50fa7b">MyView&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">extends&lt;/span> View {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span> &lt;span style="color:#8be9fd;font-style:italic">private&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">static&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">final&lt;/span> String TAG &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;MyView&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span> &lt;span style="color:#8be9fd;font-style:italic">private&lt;/span> &lt;span style="color:#8be9fd">int&lt;/span> heiget;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span> &lt;span style="color:#8be9fd;font-style:italic">private&lt;/span> &lt;span style="color:#8be9fd">int&lt;/span> width;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span> &lt;span style="color:#8be9fd;font-style:italic">private&lt;/span> String name;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span> &lt;span style="color:#8be9fd;font-style:italic">private&lt;/span> &lt;span style="color:#8be9fd">int&lt;/span> sex;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span> &lt;span style="color:#8be9fd;font-style:italic">private&lt;/span> &lt;span style="color:#8be9fd">boolean&lt;/span> student;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span> &lt;span style="color:#8be9fd;font-style:italic">public&lt;/span> &lt;span style="color:#50fa7b">MyView&lt;/span>(Context context) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span> &lt;span style="color:#ff79c6">this&lt;/span>(context,&lt;span style="color:#ff79c6">null&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span> &lt;span style="color:#8be9fd;font-style:italic">public&lt;/span> &lt;span style="color:#50fa7b">MyView&lt;/span>(Context context, AttributeSet attrs) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span> &lt;span style="color:#ff79c6">this&lt;/span>(context, attrs,0);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16&lt;/span>&lt;span> &lt;span style="color:#8be9fd;font-style:italic">public&lt;/span> &lt;span style="color:#50fa7b">MyView&lt;/span>(Context context, AttributeSet attrs, &lt;span style="color:#8be9fd">int&lt;/span> defStyleAttr) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17&lt;/span>&lt;span> &lt;span style="color:#8be9fd;font-style:italic">super&lt;/span>(context, attrs, defStyleAttr);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18&lt;/span>&lt;span> TypedArray array&lt;span style="color:#ff79c6">=&lt;/span>context.&lt;span style="color:#50fa7b">obtainStyledAttributes&lt;/span>(attrs, R.&lt;span style="color:#50fa7b">styleable&lt;/span>.&lt;span style="color:#50fa7b">burce&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19&lt;/span>&lt;span> heiget&lt;span style="color:#ff79c6">=&lt;/span>array.&lt;span style="color:#50fa7b">getInt&lt;/span>(R.&lt;span style="color:#50fa7b">styleable&lt;/span>.&lt;span style="color:#50fa7b">burce_mHeight&lt;/span>,0);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20&lt;/span>&lt;span> width&lt;span style="color:#ff79c6">=&lt;/span>array.&lt;span style="color:#50fa7b">getInt&lt;/span>(R.&lt;span style="color:#50fa7b">styleable&lt;/span>.&lt;span style="color:#50fa7b">burce_mWidth&lt;/span>,0);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21&lt;/span>&lt;span> name&lt;span style="color:#ff79c6">=&lt;/span>array.&lt;span style="color:#50fa7b">getString&lt;/span>(R.&lt;span style="color:#50fa7b">styleable&lt;/span>.&lt;span style="color:#50fa7b">burce_mName&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22&lt;/span>&lt;span> sex&lt;span style="color:#ff79c6">=&lt;/span>array.&lt;span style="color:#50fa7b">getInt&lt;/span>(R.&lt;span style="color:#50fa7b">styleable&lt;/span>.&lt;span style="color:#50fa7b">burce_sex&lt;/span>,0);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23&lt;/span>&lt;span> student&lt;span style="color:#ff79c6">=&lt;/span>array.&lt;span style="color:#50fa7b">getBoolean&lt;/span>(R.&lt;span style="color:#50fa7b">styleable&lt;/span>.&lt;span style="color:#50fa7b">burce_student&lt;/span>,&lt;span style="color:#ff79c6">true&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24&lt;/span>&lt;span> array.&lt;span style="color:#50fa7b">recycle&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26&lt;/span>&lt;span> Log.&lt;span style="color:#50fa7b">i&lt;/span>(TAG, &lt;span style="color:#f1fa8c">&amp;#34;height: &amp;#34;&lt;/span>&lt;span style="color:#ff79c6">+&lt;/span>heiget);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27&lt;/span>&lt;span> Log.&lt;span style="color:#50fa7b">i&lt;/span>(TAG, &lt;span style="color:#f1fa8c">&amp;#34;width: &amp;#34;&lt;/span>&lt;span style="color:#ff79c6">+&lt;/span>width);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28&lt;/span>&lt;span> Log.&lt;span style="color:#50fa7b">i&lt;/span>(TAG, &lt;span style="color:#f1fa8c">&amp;#34;name: &amp;#34;&lt;/span>&lt;span style="color:#ff79c6">+&lt;/span>name);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29&lt;/span>&lt;span> Log.&lt;span style="color:#50fa7b">i&lt;/span>(TAG, &lt;span style="color:#f1fa8c">&amp;#34;sex: &amp;#34;&lt;/span>&lt;span style="color:#ff79c6">+&lt;/span>sex);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30&lt;/span>&lt;span> Log.&lt;span style="color:#50fa7b">i&lt;/span>(TAG, &lt;span style="color:#f1fa8c">&amp;#34;student: &amp;#34;&lt;/span>&lt;span style="color:#ff79c6">+&lt;/span>student);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>TypedArray array=context.obtainStyledAttributes(attrs, R.styleable.burce);&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-f758038afb367abe.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-f758038afb367abe.webp" alt="Android Developers" />
&lt;/a>
&lt;/div>
这是Google官方给的解释，就简单说一下两个参数怎么填吧，第一个填形参的attrs，第二个填 R.styleable是固定写法，bruce是&lt;code>&amp;lt;declare-styleable name=&amp;quot;burce&amp;quot;&amp;gt;&lt;/code>中的name的值。
4，回到MainActivity的布局文件中使用我们的自定义view&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">&amp;lt;&lt;/span>?xml version&lt;span style="color:#ff79c6">=&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;1.0&amp;#34;&lt;/span> encoding&lt;span style="color:#ff79c6">=&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;utf-8&amp;#34;&lt;/span>?&lt;span style="color:#ff79c6">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span>&lt;span style="color:#ff79c6">&amp;lt;&lt;/span>RelativeLayout xmlns:android&lt;span style="color:#ff79c6">=&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;http://schemas.android.com/apk/res/android&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span> xmlns:app&lt;span style="color:#ff79c6">=&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;http://schemas.android.com/apk/res-auto&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span> xmlns:tools&lt;span style="color:#ff79c6">=&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;http://schemas.android.com/tools&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span> android:layout_width&lt;span style="color:#ff79c6">=&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;match_parent&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span> android:layout_height&lt;span style="color:#ff79c6">=&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;match_parent&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span> tools:context&lt;span style="color:#ff79c6">=&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;com.myviewtest.MainActivity&amp;#34;&lt;/span>&lt;span style="color:#ff79c6">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span> &lt;span style="color:#ff79c6">&amp;lt;&lt;/span>com&lt;span style="color:#ff79c6">.&lt;/span>myviewtest&lt;span style="color:#ff79c6">.&lt;/span>MyView
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span> android:layout_width&lt;span style="color:#ff79c6">=&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;match_parent&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span> android:layout_height&lt;span style="color:#ff79c6">=&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;match_parent&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span> app:mName&lt;span style="color:#ff79c6">=&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;bruce&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span> app:sex&lt;span style="color:#ff79c6">=&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;man&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span> app:mHeight&lt;span style="color:#ff79c6">=&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;100&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span> app:mWidth&lt;span style="color:#ff79c6">=&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;100&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15&lt;/span>&lt;span> app:student&lt;span style="color:#ff79c6">=&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;true&amp;#34;&lt;/span>&lt;span style="color:#ff79c6">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16&lt;/span>&lt;span>&lt;span style="color:#ff79c6">&amp;lt;/&lt;/span>RelativeLayout&lt;span style="color:#ff79c6">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>注意：如果Android studio没有加上命名空间的话需要自己加上&lt;code> xmlns:app=&amp;quot;http://schemas.android.com/apk/res-auto&amp;quot;&lt;/code> 只有声明了命名空间才能使用自定义属性，不懂啥是命名空间的同学呢自己Google学习一下吧（最近在学C++，我就安C++中的命名空间理解的，如果不正确还请大神赐教）
&lt;attr name="height" format="integer"/> 这里的我们在这用了app命名空间，所有所有的自定义属性的开头都加上了“app:”。&lt;/p>
&lt;p>准备工作都做好了接下来我们吧应用跑起来看看吧，这里我们通过打印log查看自定义属性的值。&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-c84b11ee34379ad1.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-c84b11ee34379ad1.webp" alt="运行结果" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>通过log可以得知 我们在自定义view中成功的获取到了属性的值。好的老司机平安到站，小白有序下车。
由于你遇到了一个假的老司机，文章中如果有不正确的地方还请各位大神在评论区指正，老司机在这里抱拳了。&lt;/p></description></item><item><title>在Android中实现文件上传</title><link>https://lqxhub.github.io/posts/3c55041d/</link><pubDate>Wed, 15 Feb 2017 09:50:53 +0000</pubDate><guid>https://lqxhub.github.io/posts/3c55041d/</guid><description>&lt;p>本例是我在年前的项目中用到的一个小例子，使用Android自带的HttpURLConnection实现文件上传。网上的资料对这方面的讲解不太多，有两个实例也不太详细，我在开发中用到了，觉得挺实用的，分享出来，希望能对各位朋友有所帮助，受水平所限，实例中如有谬处，还望各位大神批评指正，这个实例个人认为适用于项目中的文件上传比较少的情况，当文件上传比较多的时候还是用框架吧（例如okhtp）。
本来想在刚放寒假就整理一下，由于年前回家比较晚了，年前年后的事有点多，直到现在才有时间整理。废话不多说 直接上代码：(代码是我从项目中剪出来的，可能会有报错，问题不会太大，很好改)&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">import&lt;/span> android.os.Handler;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span>&lt;span style="color:#ff79c6">import&lt;/span> android.os.Message;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span>&lt;span style="color:#ff79c6">import&lt;/span> android.util.Log;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span>&lt;span style="color:#ff79c6">import&lt;/span> org.json.JSONException;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span>&lt;span style="color:#ff79c6">import&lt;/span> org.json.JSONObject;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span>&lt;span style="color:#ff79c6">import&lt;/span> java.io.BufferedReader;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span>&lt;span style="color:#ff79c6">import&lt;/span> java.io.DataOutputStream;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span>&lt;span style="color:#ff79c6">import&lt;/span> java.io.FileInputStream;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span>&lt;span style="color:#ff79c6">import&lt;/span> java.io.IOException;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span>&lt;span style="color:#ff79c6">import&lt;/span> java.io.InputStreamReader;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span>&lt;span style="color:#ff79c6">import&lt;/span> java.net.HttpURLConnection;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span>&lt;span style="color:#ff79c6">import&lt;/span> java.net.MalformedURLException;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span>&lt;span style="color:#ff79c6">import&lt;/span> java.net.URL;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">public&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">class&lt;/span> &lt;span style="color:#50fa7b">ArrivateUpload&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">extends&lt;/span> Thread {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17&lt;/span>&lt;span> &lt;span style="color:#8be9fd;font-style:italic">private&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">final&lt;/span> String BOUNDARYSTR &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;--------aifudao7816510d1hq&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18&lt;/span>&lt;span> &lt;span style="color:#8be9fd;font-style:italic">private&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">final&lt;/span> String END &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;\r\n&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19&lt;/span>&lt;span> &lt;span style="color:#8be9fd;font-style:italic">private&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">final&lt;/span> String LAST &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;--&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21&lt;/span>&lt;span> &lt;span style="color:#8be9fd;font-style:italic">private&lt;/span> String data;&lt;span style="color:#6272a4">//表单数据&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22&lt;/span>&lt;span> &lt;span style="color:#8be9fd;font-style:italic">private&lt;/span> FileInputStream fis;&lt;span style="color:#6272a4">//文件输入流&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23&lt;/span>&lt;span> &lt;span style="color:#8be9fd;font-style:italic">private&lt;/span> Handler handler;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25&lt;/span>&lt;span> &lt;span style="color:#8be9fd;font-style:italic">public&lt;/span> &lt;span style="color:#50fa7b">ArrivateUpload&lt;/span>(String data, FileInputStream fis, Handler handler) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26&lt;/span>&lt;span> &lt;span style="color:#ff79c6">this&lt;/span>.&lt;span style="color:#50fa7b">data&lt;/span> &lt;span style="color:#ff79c6">=&lt;/span> data;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27&lt;/span>&lt;span> &lt;span style="color:#ff79c6">this&lt;/span>.&lt;span style="color:#50fa7b">handler&lt;/span> &lt;span style="color:#ff79c6">=&lt;/span> handler;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28&lt;/span>&lt;span> &lt;span style="color:#ff79c6">this&lt;/span>.&lt;span style="color:#50fa7b">fis&lt;/span>&lt;span style="color:#ff79c6">=&lt;/span>fis;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31&lt;/span>&lt;span> @Override
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32&lt;/span>&lt;span> &lt;span style="color:#8be9fd;font-style:italic">public&lt;/span> &lt;span style="color:#8be9fd">void&lt;/span> &lt;span style="color:#50fa7b">run&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33&lt;/span>&lt;span> &lt;span style="color:#ff79c6">try&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34&lt;/span>&lt;span> URL httpUrl&lt;span style="color:#ff79c6">=&lt;/span>&lt;span style="color:#ff79c6">new&lt;/span> URL(urlStr);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35&lt;/span>&lt;span> HttpURLConnection connection&lt;span style="color:#ff79c6">=&lt;/span> (HttpURLConnection) httpUrl.&lt;span style="color:#50fa7b">openConnection&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36&lt;/span>&lt;span> connection.&lt;span style="color:#50fa7b">setRequestMethod&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;POST&amp;#34;&lt;/span>);&lt;span style="color:#6272a4">//必须为post&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37&lt;/span>&lt;span> connection.&lt;span style="color:#50fa7b">setDoInput&lt;/span>(&lt;span style="color:#ff79c6">true&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38&lt;/span>&lt;span> connection.&lt;span style="color:#50fa7b">setDoOutput&lt;/span>(&lt;span style="color:#ff79c6">true&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39&lt;/span>&lt;span> connection.&lt;span style="color:#50fa7b">setRequestProperty&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;Content-type&amp;#34;&lt;/span>, &lt;span style="color:#f1fa8c">&amp;#34;multipart/form-data;boundary=&amp;#34;&lt;/span> &lt;span style="color:#ff79c6">+&lt;/span> BOUNDARYSTR);&lt;span style="color:#6272a4">//固定格式&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40&lt;/span>&lt;span> DataOutputStream dos&lt;span style="color:#ff79c6">=&lt;/span>&lt;span style="color:#ff79c6">new&lt;/span> DataOutputStream(connection.&lt;span style="color:#50fa7b">getOutputStream&lt;/span>());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41&lt;/span>&lt;span> StringBuffer sb&lt;span style="color:#ff79c6">=&lt;/span>&lt;span style="color:#ff79c6">new&lt;/span> StringBuffer();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42&lt;/span>&lt;span> &lt;span style="color:#6272a4">/**
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43&lt;/span>&lt;span>&lt;span style="color:#6272a4"> * 写入文本数据
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44&lt;/span>&lt;span>&lt;span style="color:#6272a4"> */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46&lt;/span>&lt;span> sb.&lt;span style="color:#50fa7b">append&lt;/span>(LAST&lt;span style="color:#ff79c6">+&lt;/span>BOUNDARYSTR&lt;span style="color:#ff79c6">+&lt;/span>END);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47&lt;/span>&lt;span> sb.&lt;span style="color:#50fa7b">append&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;Content-Disposition: form-data; name=\&amp;#34;data\&amp;#34;&amp;#34;&lt;/span>&lt;span style="color:#ff79c6">+&lt;/span>END&lt;span style="color:#ff79c6">+&lt;/span>END);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48&lt;/span>&lt;span> sb.&lt;span style="color:#50fa7b">append&lt;/span>(data&lt;span style="color:#ff79c6">+&lt;/span>END);&lt;span style="color:#6272a4">//内容&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49&lt;/span>&lt;span> &lt;span style="color:#6272a4">/**
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50&lt;/span>&lt;span>&lt;span style="color:#6272a4"> * 循环写入文件
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">51&lt;/span>&lt;span>&lt;span style="color:#6272a4"> */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">52&lt;/span>&lt;span>sb.&lt;span style="color:#50fa7b">append&lt;/span>(LAST&lt;span style="color:#ff79c6">+&lt;/span>BOUNDARYSTR&lt;span style="color:#ff79c6">+&lt;/span>END);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">53&lt;/span>&lt;span>sb.&lt;span style="color:#50fa7b">append&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;Content-Disposition:form-data;Content-Type:application/octet-stream;name=\&amp;#34;file\&amp;#34;;&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">54&lt;/span>&lt;span> sb.&lt;span style="color:#50fa7b">append&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;filename=\&amp;#34;&amp;#34;&lt;/span>&lt;span style="color:#ff79c6">+&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;map_image.png&amp;#34;&lt;/span>&lt;span style="color:#ff79c6">+&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;\&amp;#34;&amp;#34;&lt;/span>&lt;span style="color:#ff79c6">+&lt;/span>END&lt;span style="color:#ff79c6">+&lt;/span>END);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">55&lt;/span>&lt;span> dos.&lt;span style="color:#50fa7b">write&lt;/span>(sb.&lt;span style="color:#50fa7b">toString&lt;/span>().&lt;span style="color:#50fa7b">getBytes&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;utf-8&amp;#34;&lt;/span>));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">56&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (fis &lt;span style="color:#ff79c6">!=&lt;/span> &lt;span style="color:#ff79c6">null&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">57&lt;/span>&lt;span> &lt;span style="color:#8be9fd">byte&lt;/span>&lt;span style="color:#ff79c6">[]&lt;/span> b&lt;span style="color:#ff79c6">=&lt;/span>&lt;span style="color:#ff79c6">new&lt;/span> &lt;span style="color:#8be9fd">byte&lt;/span>&lt;span style="color:#ff79c6">[&lt;/span>1024&lt;span style="color:#ff79c6">]&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">58&lt;/span>&lt;span> &lt;span style="color:#8be9fd">int&lt;/span> len;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">59&lt;/span>&lt;span> &lt;span style="color:#ff79c6">while&lt;/span> ((len&lt;span style="color:#ff79c6">=&lt;/span>fis.&lt;span style="color:#50fa7b">read&lt;/span>(b))&lt;span style="color:#ff79c6">!=-&lt;/span>1){
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">60&lt;/span>&lt;span> dos.&lt;span style="color:#50fa7b">write&lt;/span>(b,0,len);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">61&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">62&lt;/span>&lt;span> dos.&lt;span style="color:#50fa7b">write&lt;/span>(END.&lt;span style="color:#50fa7b">getBytes&lt;/span>());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">63&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">64&lt;/span>&lt;span> dos.&lt;span style="color:#50fa7b">write&lt;/span>((LAST&lt;span style="color:#ff79c6">+&lt;/span>BOUNDARYSTR&lt;span style="color:#ff79c6">+&lt;/span>LAST&lt;span style="color:#ff79c6">+&lt;/span>END).&lt;span style="color:#50fa7b">getBytes&lt;/span>());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">65&lt;/span>&lt;span> dos.&lt;span style="color:#50fa7b">flush&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">66&lt;/span>&lt;span> sb&lt;span style="color:#ff79c6">=&lt;/span>&lt;span style="color:#ff79c6">new&lt;/span> StringBuffer();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">67&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (connection.&lt;span style="color:#50fa7b">getResponseCode&lt;/span>()&lt;span style="color:#ff79c6">==&lt;/span>200) {&lt;span style="color:#6272a4">//请求成功&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">68&lt;/span>&lt;span> BufferedReader br&lt;span style="color:#ff79c6">=&lt;/span>&lt;span style="color:#ff79c6">new&lt;/span> BufferedReader(&lt;span style="color:#ff79c6">new&lt;/span> InputStreamReader(connection.&lt;span style="color:#50fa7b">getInputStream&lt;/span>()));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">69&lt;/span>&lt;span> String line;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">70&lt;/span>&lt;span> &lt;span style="color:#ff79c6">while&lt;/span> ((line&lt;span style="color:#ff79c6">=&lt;/span>br.&lt;span style="color:#50fa7b">readLine&lt;/span>())&lt;span style="color:#ff79c6">!=&lt;/span>&lt;span style="color:#ff79c6">null&lt;/span>){
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">71&lt;/span>&lt;span> sb.&lt;span style="color:#50fa7b">append&lt;/span>(line);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">72&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">73&lt;/span>&lt;span> Message msg&lt;span style="color:#ff79c6">=&lt;/span>Message.&lt;span style="color:#50fa7b">obtain&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">74&lt;/span>&lt;span> JSONObject object&lt;span style="color:#ff79c6">=&lt;/span>&lt;span style="color:#ff79c6">new&lt;/span> JSONObject(sb.&lt;span style="color:#50fa7b">toString&lt;/span>());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">75&lt;/span>&lt;span> handler.&lt;span style="color:#50fa7b">sendMessage&lt;/span>(msg);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">76&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">77&lt;/span>&lt;span> } &lt;span style="color:#ff79c6">catch&lt;/span> (MalformedURLException e) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">78&lt;/span>&lt;span> e.&lt;span style="color:#50fa7b">printStackTrace&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">79&lt;/span>&lt;span> } &lt;span style="color:#ff79c6">catch&lt;/span> (IOException e) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">80&lt;/span>&lt;span> e.&lt;span style="color:#50fa7b">printStackTrace&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">81&lt;/span>&lt;span> } &lt;span style="color:#ff79c6">catch&lt;/span> (JSONException e) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">82&lt;/span>&lt;span> e.&lt;span style="color:#50fa7b">printStackTrace&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">83&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">84&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">85&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>说一下实现思路：用Android系统中提供的HttpURLConnection，利用http中的multipart协议实现文件上传。httpUrlConnection应该不用多说了（不太熟悉的同学去Google学习一下HttpURLConnection和http协议吧），就说几个注意点吧，请求模式设置为POST，打开输入输出流（这个好像默认是开启的，还是设置为true比较放心）
重点说一下multipart协议吧，因为普通的http post协议使用的分隔符太简单，上传文件会造成文件分割歧义，所以必须使用multipart协议。 写一个简单的HTML表单文件上传的例子，对照学习。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-xml" data-lang="xml">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">&amp;lt;!DOCTYPE html&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span>&lt;span style="color:#ff79c6">&amp;lt;html&lt;/span> &lt;span style="color:#50fa7b">lang=&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;en&amp;#34;&lt;/span>&lt;span style="color:#ff79c6">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span>&lt;span style="color:#ff79c6">&amp;lt;head&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span> &lt;span style="color:#ff79c6">&amp;lt;meta&lt;/span> &lt;span style="color:#50fa7b">charset=&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;UTF-8&amp;#34;&lt;/span>&lt;span style="color:#ff79c6">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span> &lt;span style="color:#ff79c6">&amp;lt;title&amp;gt;&lt;/span>upload&lt;span style="color:#ff79c6">&amp;lt;/title&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span>&lt;span style="color:#ff79c6">&amp;lt;/head&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span>&lt;span style="color:#ff79c6">&amp;lt;body&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span>&lt;span style="color:#ff79c6">&amp;lt;form&lt;/span> &lt;span style="color:#50fa7b">action=&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;a.php&amp;#34;&lt;/span> &lt;span style="color:#50fa7b">method=&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;post&amp;#34;&lt;/span> &lt;span style="color:#50fa7b">enctype=&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;multipart/form-data&amp;#34;&lt;/span>&lt;span style="color:#ff79c6">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span> &lt;span style="color:#ff79c6">&amp;lt;input&lt;/span> &lt;span style="color:#50fa7b">type=&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;text&amp;#34;&lt;/span> &lt;span style="color:#50fa7b">name=&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;data&amp;#34;&lt;/span>&lt;span style="color:#ff79c6">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span> &lt;span style="color:#ff79c6">&amp;lt;input&lt;/span> &lt;span style="color:#50fa7b">type=&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;file&amp;#34;&lt;/span> &lt;span style="color:#50fa7b">name=&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;file&amp;#34;&lt;/span>&lt;span style="color:#ff79c6">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span> &lt;span style="color:#ff79c6">&amp;lt;input&lt;/span> &lt;span style="color:#50fa7b">type=&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;submit&amp;#34;&lt;/span>&lt;span style="color:#ff79c6">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span>&lt;span style="color:#ff79c6">&amp;lt;/form&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span>&lt;span style="color:#ff79c6">&amp;lt;/body&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span>&lt;span style="color:#ff79c6">&amp;lt;/html&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>在浏览器中通过调试我们可以对照浏览器来拼出multipart协议，浏览器会报404,a.php 没有找到，不用管它，这不是我们关注的重点。下图就是浏览器中的详细信息&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-6e76fb78588d3baf.png">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-6e76fb78588d3baf.png" alt="Paste_Image.png" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>在1处定义了分隔符，分隔符尽量复杂一点，避免造成与文件中的字符产生冲突。注意了，前方有大坑，注意脚下油门，老司机一不留神也会翻车。仔细对比你会发现2,3,4处和1处是不同的，2,3,4处比1处多了两个“-”,一定要留神，这也就是为什么我们在使用boundary时要加上“&amp;ndash;”的原因了。sb.append(LAST+BOUNDARYSTR+END); 在4处，整个body的结束处要加上一个“&amp;ndash;”，没有why，协议就是这样规定的。&lt;/p>
&lt;p>每一行结束都要有一个&amp;quot;\r\n&amp;quot;，第二行结束时（数据文件开始前）要有两个&amp;quot;\r\n&amp;quot;。对比图中会发现数据文件前有一个空行。还有非常重要的一点，千万注意引号(“ ”)的转义问题，如果引号出问题就会导致上传失败，而且这个错误还不容易发现。文件写入需要用输入流循环写入&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>sb.&lt;span style="color:#50fa7b">append&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;Content-Disposition:form-data;Content-Type:application/octet-stream;name=\&amp;#34;file\&amp;#34;;&amp;#34;&lt;/span>); &lt;span style="color:#6272a4">//name 之前是固定写法， 这里的name是服务端接收时需要用到的，&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span>sb.&lt;span style="color:#50fa7b">append&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;filename=\&amp;#34;&amp;#34;&lt;/span>&lt;span style="color:#ff79c6">+&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;map_image.png&amp;#34;&lt;/span>&lt;span style="color:#ff79c6">+&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;\&amp;#34;&amp;#34;&lt;/span>&lt;span style="color:#ff79c6">+&lt;/span>END&lt;span style="color:#ff79c6">+&lt;/span>END); &lt;span style="color:#6272a4">// 这里的filename的值随便写，无所谓，但是一定要有，没有会导致上传失败。&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span>dos.&lt;span style="color:#50fa7b">write&lt;/span>(sb.&lt;span style="color:#50fa7b">toString&lt;/span>().&lt;span style="color:#50fa7b">getBytes&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;utf-8&amp;#34;&lt;/span>));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (fis &lt;span style="color:#ff79c6">!=&lt;/span> &lt;span style="color:#ff79c6">null&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span> &lt;span style="color:#8be9fd">byte&lt;/span>&lt;span style="color:#ff79c6">[]&lt;/span> b&lt;span style="color:#ff79c6">=&lt;/span>&lt;span style="color:#ff79c6">new&lt;/span> &lt;span style="color:#8be9fd">byte&lt;/span>&lt;span style="color:#ff79c6">[&lt;/span>1024&lt;span style="color:#ff79c6">]&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span> &lt;span style="color:#8be9fd">int&lt;/span> len;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span> &lt;span style="color:#ff79c6">while&lt;/span> ((len&lt;span style="color:#ff79c6">=&lt;/span>fis.&lt;span style="color:#50fa7b">read&lt;/span>(b))&lt;span style="color:#ff79c6">!=-&lt;/span>1){
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span> dos.&lt;span style="color:#50fa7b">write&lt;/span>(b,0,len);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span> dos.&lt;span style="color:#50fa7b">write&lt;/span>(END.&lt;span style="color:#50fa7b">getBytes&lt;/span>());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span> dos.&lt;span style="color:#50fa7b">write&lt;/span>((LAST&lt;span style="color:#ff79c6">+&lt;/span>BOUNDARYSTR&lt;span style="color:#ff79c6">+&lt;/span>LAST&lt;span style="color:#ff79c6">+&lt;/span>END).&lt;span style="color:#50fa7b">getBytes&lt;/span>());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span> dos.&lt;span style="color:#50fa7b">flush&lt;/span>();
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>再分享一个调试技巧，我们的程序是跑在Android上的，我们是无法像在浏览器中那样调试的，所以开抓包是非常必要的（genymation自带抓包器，熟悉linux的可以直接使用），在模拟器上运行程序，电脑开启抓包器，每次上传都抓取一个数据包，分析数据包，如果出错了与浏览器的格式对比，这样调试不要太酸爽。有次上传的内容有点复杂，一直调试不正确，最后用抓包对比搞定了。我用的是wireshark，这个功能太强大了，直接在网卡安装驱动，只要经过网卡的数据都能抓到（想象力丰富的同学可以用它来干点坏事情 此处略去一千字……）。还有一个地方需要注意一下，wireshark不能抓ip为127.0.0.1的数据包（用本地电脑做服务器），因为这时的数据不经过网卡，所以无法抓取。
由于水平有限，加之时间匆忙，如有谬处，还请各位大神批评指正&lt;/p></description></item></channel></rss>