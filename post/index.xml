<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Posts on QX çš„ç¬”è®°</title><link>https://lqxhub.github.io/post/</link><description>Recent content in Posts on QX çš„ç¬”è®°</description><generator>Hugo -- gohugo.io</generator><language>zh-cn</language><lastBuildDate>Sat, 10 Jan 2026 11:26:39 +0800</lastBuildDate><atom:link href="https://lqxhub.github.io/post/index.xml" rel="self" type="application/rss+xml"/><item><title>æˆ‘çš„2025 - QX's blog</title><link>https://lqxhub.github.io/posts/3ccaa6e6/</link><pubDate>Sat, 10 Jan 2026 11:26:39 +0800</pubDate><guid>https://lqxhub.github.io/posts/3ccaa6e6/</guid><description>&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/e2bf0cda73c16e51758a974234f597848dd510fe.jpg" alt="Featured image of post æˆ‘çš„2025 - QX's blog" />&lt;p>æ„Ÿè§‰æ—¶é—´è¿‡å¾—ç‰¹åˆ«å¿«ï¼Œè½¬çœ¼é—´2025å¹´å°±è¦ç»“æŸäº†ï¼Œå›æƒ³ä¸Šæ¬¡å†™2024å¹´ä»¿ä½›è¿˜åœ¨æ˜¨æ—¥ã€‚å›é¡¾è¿™ä¸€å¹´ï¼Œç»å†äº†è®¸å¤šäº‹æƒ…ï¼Œæ²¡æ³•ç®€å•è¯´æ˜¯å¥½æ˜¯åï¼Œæ— è®ºå¦‚ä½•ï¼Œè¿™äº›ç»å†éƒ½è®©æˆ‘æˆé•¿äº†è®¸å¤šã€‚è¿˜æ˜¯è€è§„çŸ©ä»&lt;strong>ç”Ÿæ´»&lt;/strong>å’Œ&lt;strong>å·¥ä½œ&lt;/strong>ä¸¤ä¸ªæ–¹é¢æ¥æ€»ç»“å§ã€‚&lt;/p>
&lt;h2 id="ç”Ÿæ´»">&lt;a href="#%e7%94%9f%e6%b4%bb" class="header-anchor">&lt;/a>ç”Ÿæ´»
&lt;/h2>&lt;p>ä»Šå¹´å‡ºå»ç©äº†ä¸¤æ¬¡ï¼Œè€Œä¸”éƒ½æ˜¯å¿ƒå¿ƒå¿µå¿µäº†å¥½ä¹…çš„åœ°æ–¹ã€‚å¹´åˆäº†å¹¿å·+é¦™æ¸¯ã€‚ä¸»è¦æ˜¯æƒ³å»é¦™æ¸¯ï¼Œè¿™ä¸ªè®¡åˆ’åœ¨2019å¹´å°±æœ‰äº†ï¼Œä½†æ˜¯å› ä¸ºä¼—æ‰€å‘¨çŸ¥çš„åŸå› ï¼Œä¸€ç›´æ²¡å»æˆã€‚å»é¦™æ¸¯ä¸»è¦çš„ç›®çš„ä¸æ˜¯å»é¦™æ¸¯ç©ï¼Œä¸»è¦æ˜¯ä¸ºäº†å»å¼€æ¸¯å¡ã€‚å¼€æ¸¯å¡çš„ç›®çš„ä¹Ÿå¾ˆç®€å•ï¼Œå°±æ˜¯ä¸ºäº†é€ƒç¦»å¤§Aï¼Œå½“æ´‹éŸ­èœğŸ¤£ã€‚2019å¹´å°±äº†è§£åˆ°äº†æ¸¯è‚¡æ‰“æ–°ç›¸å…³çš„ä¸œè¥¿ï¼Œå½“æ—¶å°±å¼€äº†æ¸¯è‚¡è´¦å·ï¼Œä½†æ˜¯æ²¡æœ‰å¤–é¢çš„é“¶è¡Œå¡ï¼Œæ²¡æ³•æŠŠé’±è½¬å‡ºå»ï¼Œåªèƒ½æ”¾å¼ƒäº†ã€‚2025å¹´åˆï¼Œé›ªç‹åœ¨æ¸¯è‚¡ä¸Šå¸‚ï¼Œå½±å“éå¸¸å¤§ï¼Œæˆ‘å½“æ—¶åˆæƒ³èµ·äº†æ¸¯è‚¡è¿™ä»¶äº‹ï¼Œäºæ˜¯å»é¦™æ¸¯å¼€æ¸¯å¡è¿™ä»¶äº‹åˆè¢«æä¸Šäº†æ—¥ç¨‹ã€‚&lt;/p>
&lt;p>äºæ˜¯é©¬ä¸Šå°±åŠäº†æ¸¯æ¾³é€šè¡Œè¯ï¼Œç„¶åè®¢äº†æœºç¥¨é…’åº—ï¼Œå°±å‡ºå‘äº†ã€‚å¥½åœ¨ä¸€åˆ‡é¡ºåˆ©ï¼Œé¡ºåˆ©å¼€äº†æ¸¯å¡ã€‚èµ¶ä¸Šäº†æ²ªä¸Šé˜¿å§¨å’Œéœ¸ç‹èŒ¶å§¬æ‰“æ–°ï¼ŒåŸºæœ¬æŠŠè¿™æ¬¡æ—…è¡Œçš„è´¹ç”¨éƒ½èµšå›æ¥äº†ã€‚è¯´åˆ°é¦™æ¸¯ï¼Œä¹‹å‰çœ‹å¾ˆå¤šäººè¯´é¦™æ¸¯æ’å¤–ï¼Œè¯´æ™®é€šè¯ä¼šè¢«çœ‹ä¸èµ·ä»€ä¹ˆçš„ã€‚ä»æˆ‘è¿™æ¬¡çš„ç»å†æ¥çœ‹ï¼Œæ²¡æœ‰é‡åˆ°è¿™ç§æƒ…å†µï¼Œåè€Œè§‰å¾—é¦™æ¸¯äººè¿˜æ˜¯æŒºå‹å¥½çš„ï¼Œå…¨ç¨‹ç”¨æ™®é€šè¯äº¤æµä¹Ÿæ²¡æœ‰ä»»ä½•é—®é¢˜ã€‚åŒ…æ‹¬é—®è·¯ä»€ä¹ˆçš„ï¼Œé¦™æ¸¯äººéƒ½å¾ˆçƒ­å¿ƒçš„å¸®å¿™æŒ‡è·¯ã€‚&lt;/p>
&lt;p>è¿˜æœ‰å°±æ˜¯ï¼Œèµ°åœ¨é¦™æ¸¯çš„è¡—å¤´ï¼Œçœ‹åˆ°äº†å¾ˆå¤šç†Ÿæ‚‰è€Œåˆé™Œç”Ÿçš„åœºæ™¯ï¼Œç†Ÿæ‚‰æ˜¯å› ä¸ºä»¥å‰ä»ç”µå½±ä¸­çœ‹åˆ°çš„åœºæ™¯æ­¤æ—¶å°±åœ¨æˆ‘çš„çœ¼å‰ï¼Œé™Œç”Ÿæ˜¯å› ä¸ºè¿™äº›åœºæ™¯æˆ‘çš„ç¡®æ˜¯ç¬¬ä¸€æ¬¡äº²çœ¼è§åˆ°ã€‚æ„Ÿè§‰æŒºå¥‡å¦™çš„ã€‚&lt;/p>
&lt;p>ç»´æ¸¯çš„é£å¹äº†ä¸‰åå¹´æ‰æ‹‚è¿‡æˆ‘çš„èº«æ—ã€‚&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/78df89023a06ed5ebe97d7dbccdbfa84a699f7c4.jpg">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/78df89023a06ed5ebe97d7dbccdbfa84a699f7c4.jpg" alt="" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>å› ä¸ºæ—¶é—´æœ‰é™ï¼Œåªåœ¨é¦™æ¸¯ç©äº†ä¸€å¤©ï¼Œå½“å¤©å°±åŒ†åŒ†å›åˆ°æ·±åœ³ç„¶åèµ¶å›ä¸Šæµ·äº†ã€‚ä¸‹æ¬¡æœ‰æœºä¼šä¸€å®šè¦å¤šå¾…å‡ å¤©ï¼Œå¥½å¥½æ„Ÿå—ä¸€ä¸‹é¦™æ¸¯çš„é­…åŠ›ã€‚&lt;/p>
&lt;p>è¿™æ¬¡å»é¦™æ¸¯ï¼Œæƒ³ç€é¡ºè·¯ï¼Œæ‰€ä»¥ä¹Ÿå»äº†å¹¿å·ã€‚å…¶å®æ˜¯å…ˆå»çš„å¹¿å·ï¼Œç„¶åä»å¹¿å·å»çš„é¦™æ¸¯ã€‚ä¹‹å‰å¯¹å¹¿å·çš„å°è±¡ä¸»è¦æ˜¯ç¾é£Ÿï¼Œå»äº†ä¹‹åå‘ç°å¹¿å·å…¶å®ä¹Ÿæ˜¯ä¸€ä¸ªæŒºæœ‰æ„æ€çš„åŸå¸‚ã€‚æ—¢æœ‰ä¼ ç»Ÿçš„å²­å—æ–‡åŒ–ï¼Œåˆæœ‰ç°ä»£åŒ–çš„éƒ½å¸‚é£è²Œã€‚ç™½äº‘å±±ã€å¹¿å·å¡”ã€ä¸Šä¸‹ä¹æ­¥è¡Œè¡—è¿™äº›åœ°æ–¹éƒ½ç»™æˆ‘ç•™ä¸‹äº†æ·±åˆ»çš„å°è±¡ã€‚å°è±¡å¾ˆæ·±çš„å…¶å®æ˜¯å¹¿å·çš„åŸä¸­æ‘ï¼Œåœ¨é‚£é‡Œå¯ä»¥çœ‹åˆ°å¹¿å·æœ€çœŸå®çš„ä¸€é¢ã€‚åŸä¸­æ‘é‡Œäººä»¬çš„ç”Ÿæ´»çŠ¶æ€å’ŒåŸå¸‚çš„ç¹åå½¢æˆäº†é²œæ˜çš„å¯¹æ¯”ã€‚ä¸€é¢æ˜¯é«˜æ¥¼å¤§å¦ï¼Œä¸€é¢ä¸è§å¤©æ—¥çš„ç‹­çª„å··é“ã€‚æ„Ÿè§‰æŒºéœ‡æ’¼çš„ã€‚&lt;/p>
&lt;p>å¹¿å·åœ°æ ‡â€”â€”å¹¿å·å¡”
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/a3552f9a2ac7937b9b5506b48dabaa3f9692b796.jpg">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/a3552f9a2ac7937b9b5506b48dabaa3f9692b796.jpg" alt="" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>ç™½äº‘å±±è¿œçœº
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/4ddecd80a76fc549cab109d85f709b0f21797548.jpg">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/4ddecd80a76fc549cab109d85f709b0f21797548.jpg" alt="" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>å¹´åº•çš„ä¸€æ¬¡æ—…è¡Œå»äº†æµ·å—ã€‚è¿™æ¬¡æ˜¯éª‘è‡ªè¡Œè½¦ç¯æµ·å—å²›ã€‚å…¶å®æ—©åœ¨å»å¹´å¼€å§‹éª‘è½¦æ—¶ï¼Œå°±æœ‰è¿™ä¸ªæƒ³æ³•äº†ï¼Œä½†æ˜¯ä¸€ç›´æ²¡æœ‰ä»˜è¯¸è¡ŒåŠ¨ã€‚è¿™æ¬¡åšè¿™ä¸ªå†³å®šä¹Ÿæ˜¯æŒºçªç„¶çš„ã€‚å¿«åˆ°å¹´åº•äº†ï¼Œçœ‹äº†ä¸€ä¸‹è‡ªå·±è¿˜æœ‰å¥½å¤šè°ƒä¼‘å‡æ²¡æœ‰ç”¨å®Œï¼Œäºæ˜¯å°±å†³å®šåˆ©ç”¨è¿™äº›å‡æœŸå»æµ·å—éª‘è¡Œã€‚ä»å†³å®šåˆ°å‡ºå‘ï¼Œå‰åä¹Ÿå°±ä¸€å‘¨å¤šçš„æ—¶é—´ã€‚å†³å®šäº†ä¹‹åå°±æ˜¯åšéª‘è¡Œè·¯ä¹¦ï¼Œè®¢æœºç¥¨é…’åº—ï¼Œå‡†å¤‡è£…å¤‡ç­‰ç­‰ã€‚è™½ç„¶æ—¶é—´ç´§å¼ ï¼Œä½†æ˜¯ä¸€åˆ‡éƒ½å¾ˆé¡ºåˆ©ã€‚æœ€ç»ˆé¡ºåˆ©å®Œæˆäº†ç¯æµ·å—å²›çš„éª‘è¡Œã€‚è·¨å¹´ä¹Ÿæ˜¯åœ¨æµ·å—åº¦è¿‡çš„ã€‚æ‰€ä»¥è¿™ç¯‡æ–‡ç« ä¹Ÿè¢«æ‹–åˆ°äº†ç°åœ¨æ‰å†™å®Œã€‚&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/1e467e3f2e28d8c17b8ecdc46102d1b6045e919c.JPEG">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/1e467e3f2e28d8c17b8ecdc46102d1b6045e919c.JPEG" alt="" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>åŸæœ¬æ‰“ç®—ä¸€ä¸ªäººå»éª‘è¡Œçš„ï¼Œåæ¥åœ¨å°çº¢ä¹¦ä¸Šå‘äº†ä¸ªå¸–å­ï¼Œç»“æœæœ‰å‡ ä¸ªå°ä¼™ä¼´ä¹Ÿæƒ³å»ï¼Œäºæ˜¯å°±ç»„é˜Ÿéª‘è¡Œäº†ã€‚å…¨ç¨‹å·®ä¸å¤š1000å…¬é‡Œï¼Œåˆ†7å¤©å®Œæˆã€‚ä¸€è·¯ä¸Šé£æ™¯éå¸¸ç¾ä¸½ï¼Œå°¤å…¶æ˜¯æ²¿æµ·çš„è·¯æ®µï¼Œæ™¯è‰²éå¸¸ä¼˜ç¾ï¼Œä¹‹å‰åœ¨ç»å¸¸ä¼šå› ä¸ºå·¥ä½œå‹åŠ›å¤§è€Œæ„Ÿåˆ°ç„¦è™‘å’Œå¤±çœ ï¼Œè¿™æ¬¡éª‘è¡Œè®©æˆ‘å½»åº•æ”¾æ¾äº†ä¸‹æ¥ã€‚&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/509db41afd76fef991531bbdfd58a56c99ce9532.jpg">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/509db41afd76fef991531bbdfd58a56c99ce9532.jpg" alt="" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/fadfadbc6a29ca3ff33cedba3be0cb4f421ea6b4.jpg">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/fadfadbc6a29ca3ff33cedba3be0cb4f421ea6b4.jpg" alt="" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/1ecd1736c2aa1ff03017ffb982325e77bb724fc0.jpg">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/1ecd1736c2aa1ff03017ffb982325e77bb724fc0.jpg" alt="" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>å»ä¹‹å‰è¿˜åœ¨æ‹…å¿ƒè‡ªå·±æ˜¯å¦èƒ½å¤ŸåšæŒä¸‹æ¥ï¼Œæ¯•ç«Ÿ1000å…¬é‡Œä¸æ˜¯ä¸€ä¸ªå°æ•°ç›®ï¼Œè€Œä¸”åœ°åŠ¿èµ·ä¼æ¯”ä¸Šæµ·å¤§å¾ˆå¤šã€‚ä½†æ˜¯éª‘è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œå‘ç°è‡ªå·±çš„ä½“åŠ›å’Œè€åŠ›éƒ½æ¯”æƒ³è±¡ä¸­è¦å¥½å¾ˆå¤šã€‚æ¯å¤©éª‘è¡Œå¤§çº¦150å…¬é‡Œï¼Œè™½ç„¶å¾ˆç´¯ï¼Œä½†æ˜¯æ¯æ¬¡åˆ°è¾¾ç›®çš„åœ°æ—¶ï¼Œçœ‹åˆ°ç¾ä¸½çš„é£æ™¯å’Œæ„Ÿå—åˆ°æˆå°±æ„Ÿï¼Œæ‰€æœ‰çš„ç–²æƒ«éƒ½çƒŸæ¶ˆäº‘æ•£äº†ã€‚ä»ç¬¬ä¸‰å¤©å¼€å§‹å±è‚¡å¼€å§‹ç–¼äº†ï¼Œè¿˜æ˜¯è¿˜æ˜¯åšæŒä¸‹æ¥äº†ã€‚æœ€åä¸€å¤©å¿«å›åˆ°æµ·å£æ—¶ï¼Œå±…ç„¶æœ‰ç‚¹ä¸æƒ³ç»“æŸäº†ï¼Œæ„Ÿè§‰è¿˜å¯ä»¥ç»§ç»­éª‘ä¸‹å»ã€‚&lt;/p>
&lt;p>ç¾¤é‡Œæœ‰å‡ ä¸ªå°ä¼™ä¼´ï¼Œåœ¨éª‘è¡Œç»“æŸæˆ–è€…è¦å¼€å§‹æµ·å—æ—¶ï¼Œéƒ½æƒ…ä¸è‡ªç¦çš„æµä¸‹äº†çœ¼æ³ªã€‚å¯èƒ½æ˜¯ç»å†äº†è¿™ä¹ˆå¤šå¤©çš„è‰°è¾›å’ŒæŒ‘æˆ˜ï¼Œç»ˆäºå®Œæˆäº†è¿™ä¸ªç›®æ ‡ï¼Œå†…å¿ƒçš„æ¿€åŠ¨å’Œæ„ŸåŠ¨è®©ä»–ä»¬å¿ä¸ä½æµä¸‹äº†çœ¼æ³ªã€‚&lt;/p>
&lt;h2 id="å·¥ä½œ">&lt;a href="#%e5%b7%a5%e4%bd%9c" class="header-anchor">&lt;/a>å·¥ä½œ
&lt;/h2>&lt;p>è¯´åˆ°å·¥ä½œæ–¹é¢ï¼Œå…¶å®2025å¹´å¯¹æˆ‘æ¥è¯´å…¶å®ä¸­æ¯”è¾ƒå¤±è´¥çš„ä¸€å¹´ã€‚å¹´åˆçš„æ—¶å€™ï¼Œä¿¡å¿ƒæ»¡æ»¡ï¼Œè§‰å¾—è‡ªå·±å¸¦é˜Ÿåšçš„é¡¹ç›®ä¸€å®šä¼šæˆåŠŸã€‚è‡ªå·±ä¹Ÿæ˜¯å……æ»¡å¹²åŠ²ï¼Œæƒ³ç€è¦æŠŠé¡¹ç›®åšå¥½ï¼ŒæŠŠå›¢é˜Ÿå¸¦å¥½ï¼Œä¸çŸ¥ç–²æƒ«çš„åŠ ç­ã€‚å½“å¹´ä¸­ä¸Šçº¿åï¼Œå•†ä¸šåŒ–çš„æ•ˆæœå¹¶ä¸ç†æƒ³ï¼Œæ¯”é¢„æœŸçš„å·®å¾ˆå¤šã€‚ä½†æ˜¯ä»æŠ€æœ¯è§’åº¦çœ‹ï¼Œé¡¹ç›®ä¸ç®—å¤±è´¥ï¼Œæ¯•ç«Ÿä¸Šçº¿äº†ï¼Œç³»ç»Ÿä¹Ÿç¨³å®šè¿è¡Œäº†ï¼Œæ’‘ä½äº†é¦–å‘çš„æµé‡ï¼Œæ²¡æœ‰å› ä¸ºæŠ€æœ¯é—®é¢˜ï¼Œæ‹–ç´¯æ•´ä¸ªé¡¹ç›®ã€‚åªæ˜¯å•†ä¸šåŒ–æ•ˆæœä¸ä½³ï¼Œè®©æˆ‘æ„Ÿåˆ°å¾ˆå¤±è½ã€‚&lt;/p>
&lt;p>å¿«åˆ°å¹´åº•æ—¶ï¼Œè‡ªå·±çš„ä¸€ä¸ªå¤±è¯¯ï¼Œå¯¼è‡´äº†ä¸€æ¬¡çº¿ä¸Šäº‹æ•…ã€‚å¥½åœ¨è¿˜èƒ½æŒ½æ•‘ï¼Œæ²¡æœ‰å¯¼è‡´äº‹æ€å½»åº•å¤±æ§ã€‚ä½†æ˜¯è¿™ä»¶äº‹å¯¹æˆ‘æ‰“å‡»å¾ˆå¤§ã€‚æ„Ÿè§‰è‡ªå·±èƒ½åŠ›ä¸è¶³ï¼Œæ²¡èƒ½æŠŠäº‹æƒ…åšå¥½ã€‚&lt;/p>
&lt;p>å…¶å®åœ¨10æœˆä»½ï¼Œæˆ‘å°±å·²ç»æœ‰ç‚¹æƒ³ç¦»å¼€ç°åœ¨çš„å²—ä½äº†ã€‚ä¸»è¦æ˜¯è§‰å¾—è‡ªå·±åœ¨è¿™ä¸ªå²—ä½ä¸Šå·²ç»æ²¡æœ‰å¤ªå¤šæˆé•¿ç©ºé—´äº†ï¼Œè€Œä¸”å·¥ä½œå†…å®¹ä¹Ÿæ¯”è¾ƒå•ä¸€ï¼Œæ„Ÿè§‰è‡ªå·±åœ¨åŸåœ°è¸æ­¥ã€‚è‡ªå·±ä¹Ÿå»é¢è¯•äº†ä¸€äº›å…¶ä»–çš„å²—ä½ï¼Œæƒ³çœ‹çœ‹å¤–é¢çš„æœºä¼šã€‚æœ‰ä¸€å®¶å›½å†…çŸ¥åäº’è”ç½‘å…¬å¸ï¼Œ3é¢éƒ½è¯•é€šè¿‡äº†ï¼Œæœ€åæ²¡æœ‰å‘offerï¼Œåæ¥çœ‹åˆ°è¿™å®¶å…¬å¸çš„è£å‘˜æ¶ˆæ¯ï¼Œå¤§æ¦‚ä¹Ÿèƒ½çŒœåˆ°ï¼Œå¯èƒ½æ˜¯å› ä¸ºå…¬å¸ä¸šåŠ¡è°ƒæ•´çš„åŸå› ï¼Œæ²¡æœ‰ç»™æˆ‘å‘offerã€‚æ„Ÿè§‰æŒºé—æ†¾çš„ã€‚&lt;/p>
&lt;h2 id="å¼€æºç¤¾åŒº">&lt;a href="#%e5%bc%80%e6%ba%90%e7%a4%be%e5%8c%ba" class="header-anchor">&lt;/a>å¼€æºç¤¾åŒº
&lt;/h2>&lt;p>ä»Šå¹´å› ä¸ºå·¥ä½œçš„åŸå› ï¼Œç›¸æ¯”å»å¹´ï¼Œå‚ä¸å¼€æºç¤¾åŒºçš„æ—¶é—´å°‘äº†å¾ˆå¤šã€‚ä¸»è¦æ˜¯å› ä¸ºå·¥ä½œæ¯”è¾ƒå¿™ï¼Œæ²¡æ³•æŠ½å‡ºå¤ªå¤šæ—¶é—´æ¥å‚ä¸ç¤¾åŒºçš„æ´»åŠ¨ã€‚è™½ç„¶æ—¶é—´å°‘äº†ï¼Œä½†æ˜¯è¿˜æ˜¯æœ‰å‚ä¸ä¸€äº›é¡¹ç›®çš„ç»´æŠ¤å’Œå¼€å‘å·¥ä½œã€‚ä¹Ÿæœ‰å‚åŠ ä¸€äº›çº¿ä¸Šçš„æŠ€æœ¯åˆ†äº«ä¼šï¼Œå­¦ä¹ äº†ä¸€äº›æ–°çš„æŠ€æœ¯çŸ¥è¯†ã€‚&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/677a8c113622fe6e1a0538ba804500ebe5da0c04.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/677a8c113622fe6e1a0538ba804500ebe5da0c04.webp" alt="" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>å¸Œæœ›2026å¹´èƒ½æœ‰æ›´å¤šçš„æ—¶é—´å’Œç²¾åŠ›æ¥å‚ä¸å¼€æºç¤¾åŒºçš„æ´»åŠ¨ï¼Œä¸ºç¤¾åŒºçš„å‘å±•è´¡çŒ®è‡ªå·±çš„ä¸€ä»½åŠ›é‡ã€‚&lt;/p>
&lt;h2 id="other">&lt;a href="#other" class="header-anchor">&lt;/a>other
&lt;/h2>&lt;p>è¿™é‡Œä¹Ÿæ˜¯æƒ³åˆ°ä»€ä¹ˆå°±å†™ä»€ä¹ˆå§ã€‚&lt;/p>
&lt;p>ä»Šå¹´æœ¬æ¥æƒ³å¤šè¯»ä¸€äº›ä¹¦çš„ï¼Œç»“æœä¹Ÿæ²¡è¯»å‡ æœ¬ã€‚ä½†æ˜¯ä¹Ÿæ˜¯å› ä¸ºå„ç§åŸå› ï¼Œæ²¡èƒ½åšæŒä¸‹æ¥ã€‚æ˜å¹´ç»§ç»­åŠªåŠ›å§ã€‚ä½†æ˜¯ä»Šå¹´æˆ‘å‘ç°äº†ä¸€æœ¬æŒºå¥½çš„ä¹¦ï¼Œå«ã€Šå…«æ¬¡å±æœºã€‹ï¼Œæ¸©é“å†›è€å¸ˆæ˜¯çœŸæ•¢è¯´ã€‚2026å¹´ä¸€å®šè¦è¯»å®Œè¿™æœ¬ä¹¦ã€‚&lt;/p>
&lt;p>ä»Šå¹´éª‘è½¦çš„æ¬¡æ•°ä¹Ÿæ¯”å»å¹´å°‘äº†å¾ˆå¤šï¼Œæ—¶é—´å°‘äº†æ˜¯ä¸€éƒ¨åˆ†åŸå› ï¼Œéª‘è¡Œçš„çƒ­åº¦ä¸‹é™ä¹Ÿæœ‰éƒ¨åˆ†åŸå› ï¼Œç¾¤é‡Œæ˜æ˜¾ä¸å¦‚2024å¹´æ´»è·ƒäº†ã€‚å¸Œæœ›æ˜å¹´èƒ½é‡æ–°æ‰¾å›éª‘è¡Œçš„çƒ­æƒ…å§ã€‚&lt;/p>
&lt;p>ä»Šå¹´å†™æ–‡ç« çš„æ¬¡æ•°ä¹Ÿæ¯”å»å¹´å¤šäº†ä¸€äº›ï¼Œä»Šå¹´çš„å­¦ä¹ é‡ç‚¹ä¸»è¦åœ¨C++å’Œå¼‚æ­¥IOç›¸å…³çš„å†…å®¹ä¸Šã€‚å¸Œæœ›æ˜å¹´èƒ½ç»§ç»­åšæŒå†™æ–‡ç« ï¼Œåˆ†äº«è‡ªå·±çš„å­¦ä¹ å¿ƒå¾—ã€‚äº‰å–èƒ½æ—©æ—¥å®Œæˆè‡ªå·±çš„C++åç¨‹+å¼‚æ­¥IOçš„åŸºç¡€åº“ã€‚&lt;/p>
&lt;p>å¿«åˆ°å¹´åº•çš„æ—¶å€™ï¼Œå¼€å§‹å¯¹SLGæ¸¸æˆæ„Ÿå…´è¶£äº†ã€‚åˆæƒ³èµ·äº†è‡ªå·±é«˜ä¸­çš„æ—¶å€™ï¼Œè‡ªå·±æƒ³åšçš„é‚£æ¬¾æ¸¸æˆã€‚é‚£æ—¶å€™è¿˜æ˜¯MMORPGç››è¡Œçš„å¹´ä»£ï¼Œè‡ªå·±æ˜¯æŒ‰ç…§MMOæ¥è®¾æƒ³çš„æ¸¸æˆã€‚ä½†æ˜¯ç°åœ¨çœ‹æ¥ï¼ŒMMOå·²ç»ä¸å¤ªé€‚åˆç°åœ¨çš„å¸‚åœºäº†ï¼ŒSLGå¯èƒ½æ›´é€‚åˆä¸€äº›ã€‚æ„Ÿè§‰è‡ªå·±è®¾æƒ³çš„è¿™æ¬¾æ¸¸æˆï¼Œæ›´é€‚åˆSLGã€‚&lt;/p>
&lt;p>æ‰€ä»¥ä»Šå¹´å°†ä¼šé¢ä¸´ä¸€ä¸ªé€‰æ‹©ï¼Œæ˜¯ç»§ç»­åšæ¸¸æˆè¿˜æ˜¯æ¢æ–¹å‘å»åšå…¶ä»–çš„ä¸œè¥¿ã€‚è¿™ä¸ªé—®é¢˜ï¼Œåœ¨3é¢çš„æ—¶å€™ï¼Œé¢è¯•å®˜ä¹Ÿé—®è¿‡æˆ‘ï¼Œä¸ºä»€ä¹ˆåšäº†è¿™ä¹ˆå¤šå¹´æ¸¸æˆï¼Œç°åœ¨è¦æ¢æ–¹å‘å»åšå…¶ä»–çš„ä¸œè¥¿ã€‚æˆ‘å½“æ—¶çš„å›ç­”æ˜¯ï¼Œè‡ªå·±å¯¹æ¸¸æˆå¼€å‘è¿˜æ˜¯å¾ˆæœ‰çƒ­æƒ…çš„ï¼Œåªæ˜¯ç°åœ¨çš„å²—ä½å·²ç»æ²¡æœ‰å¤ªå¤šæˆé•¿ç©ºé—´äº†ï¼Œæ‰€ä»¥æƒ³æ¢ä¸ªæ–¹å‘ï¼Œå»å­¦ä¹ ä¸€äº›æ–°çš„æŠ€æœ¯å’ŒçŸ¥è¯†ã€‚åé¢è¿™ä½å‰è¾ˆä¹Ÿå¯¹æˆ‘è¯´ï¼Œè¿™å¯èƒ½æ˜¯æˆ‘èŒä¸šç”Ÿæ¶¯ä¸­çš„ä¸€ä¸ªè½¬æŠ˜ç‚¹ï¼Œé€‰æ‹©å¾ˆé‡è¦ï¼Œè¿™æ¬¡æ¢æ–¹å‘å¯èƒ½ä¼šå½±å“æˆ‘æœªæ¥çš„å‘å±•ã€‚&lt;/p>
&lt;p>ä»Šå¹´å¹´åˆå®¶é‡Œç»™ä»‹ç»äº†ä¸€ä¸ªå¥³å­©ï¼Œä¸€å¼€å§‹èŠå¾—è¿˜ä¸é”™ï¼Œä½†æ˜¯å› ä¸ºä¸¤äººåœ¨ä¸åŒçš„åŸå¸‚ï¼Œè§é¢çš„æœºä¼šæ¯”è¾ƒå°‘ï¼Œåæ¥æ…¢æ…¢å°±æ²¡ä»€ä¹ˆè”ç³»äº†ã€‚å›½åº†æœŸé—´åˆä»‹ç»äº†ä¸€ä¸ªï¼Œç»“æœè¿˜æ˜¯å› ä¸ºè·ç¦»é—®é¢˜ï¼Œæ²¡èƒ½ç»§ç»­å‘å±•ä¸‹å»ã€‚æ„Ÿè§‰ç°åœ¨æ‰¾å¯¹è±¡çœŸçš„æ˜¯è¶Šæ¥è¶Šéš¾äº†ã€‚å¸Œæœ›æ˜å¹´èƒ½æœ‰å¥½è¿æ°”å§ã€‚&lt;/p>
&lt;h2 id="2026">&lt;a href="#2026" class="header-anchor">&lt;/a>2026
&lt;/h2>&lt;p>2026å¹´çœŸçš„åº”è¯¥è¦åšå‡ºä¸€äº›é€‰æ‹©äº†ï¼Œç°åœ¨å›é¦–æ¥çœ‹ï¼Œå‰ä¸¤å¹´çš„é€‰æ‹©æ˜¯æ²¡æœ‰è¾¾åˆ°é¢„æœŸçš„ï¼Œå¸Œæœ›2026å¹´èƒ½æœ‰ä¸€ä¸ªå¥½çš„è½¬æŠ˜ç‚¹å§ã€‚&lt;/p>
&lt;p>&lt;strong>Good luck next year&lt;/strong>&lt;/p></description></item><item><title>Redis8.0 æºç  ç½‘ç»œæ¨¡å—ï¼Œå¤šçº¿ç¨‹æ¨¡å—</title><link>https://lqxhub.github.io/posts/94b79760/</link><pubDate>Sat, 15 Nov 2025 10:10:02 +0800</pubDate><guid>https://lqxhub.github.io/posts/94b79760/</guid><description>&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/b6829b1bf489add61640750d4fd21727b3b441b3.webp" alt="Featured image of post Redis8.0 æºç  ç½‘ç»œæ¨¡å—ï¼Œå¤šçº¿ç¨‹æ¨¡å—" />&lt;p>å¥½ä¹…æ²¡æœ‰å†™ä¸œè¥¿äº†ï¼Œæœ€è¿‘æœ‰ç‚¹æ—¶é—´äº†ï¼Œå°±ç»§ç»­å†™å†™Redisæºç å­¦ä¹ ç³»åˆ—æ–‡ç« å§ã€‚åœ¨ä»Šå¹´5æœˆï¼Œrediså‘å¸ƒäº†8.0æ­£å¼ç‰ˆï¼Œ8.0è¿™ä¸ªç‰ˆæœ¬åšäº†å¾ˆå¤šä¼˜åŒ–ï¼Œå…¶ä¸­éå¸¸é‡è¦çš„ä¸€ä¸ªåŠŸèƒ½å°±æ˜¯ä¼˜åŒ–äº†å¤šçº¿ç¨‹æ¨¡å—ã€‚&lt;/p>
&lt;p>æ—©åœ¨ 6.0 ç‰ˆæœ¬ï¼Œrediså°±æ”¯æŒäº† IO å¤šçº¿ç¨‹ï¼Œä¹‹å‰ä¹Ÿå†™è¿‡ä¸€ç¯‡æ–‡ç« ä»‹ç» redis IO å¤šçº¿ç¨‹çš„å®ç°åŸç†ï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥çœ‹ä¸€ä¸‹ï¼š&lt;a class="link" href="https://lqxhub.github.io/posts/bce71a0" >Redis 6.0ç½‘ç»œ&lt;/a>ã€‚åœ¨ 6.0 ç‰ˆæœ¬ä¸­ã€‚å¤šçº¿ç¨‹åªç”¨æ¥å¤„ç†ç½‘ç»œ IO æ“ä½œï¼Œå…¶ä»–çš„æ“ä½œè¿˜æ˜¯åœ¨ä¸»çº¿ç¨‹ä¸­å®Œæˆçš„ã€‚åœ¨ 8.0 ç‰ˆæœ¬ä¸­ï¼Œå¤šçº¿ç¨‹ä¹Ÿæ˜¯åªç”¨æ¥å¤„ç†ç½‘ç»œ IO æ“ä½œï¼Œå…·ä½“æ‰§è¡Œå‘½ä»¤è¿˜æ˜¯åœ¨ä¸»çº¿ç¨‹ä¸­ï¼Œä½†æ˜¯åšäº†å¾ˆå¤šä¼˜åŒ–ã€‚&lt;/p>
&lt;p>å…ˆæ¥çœ‹ä¸€ä¸‹ 6.0 ç‰ˆæœ¬å¤šçº¿ç¨‹å­˜åœ¨çš„é—®é¢˜ï¼š&lt;/p>
&lt;p>æ¯”è¾ƒå½±å“æ€§èƒ½çš„ä¸€ä¸ªé—®é¢˜å°±æ˜¯ï¼Œæ‰€æœ‰ IO çº¿ç¨‹åœ¨è¯»å–æ•°æ®æ—¶ï¼Œmain çº¿ç¨‹éœ€è¦ç­‰å¾…æ‰€æœ‰ IO çº¿ç¨‹è¯»å–å®Œæ•°æ®ä¹‹åï¼Œæ‰èƒ½ç»§ç»­å¤„ç†å‘½ä»¤ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœæœ‰ä¸€ä¸ª IO çº¿ç¨‹è¯»å–æ•°æ®æ¯”è¾ƒæ…¢ï¼Œé‚£ä¹ˆ main çº¿ç¨‹å°±ä¼šè¢«é˜»å¡ï¼Œç­‰å¾…è¿™ä¸ªæ…¢çš„ IO çº¿ç¨‹è¯»å–å®Œæ•°æ®ä¹‹åï¼Œæ‰èƒ½ç»§ç»­å¤„ç†å‘½ä»¤ï¼Œåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œmain çº¿ç¨‹åªèƒ½å¹²ç­‰å¾…ï¼Œè¿™ä¸ªæ…¢çš„ IO çº¿ç¨‹ä¼šæ‹–ç´¯æ•´ä¸ªç³»ç»Ÿçš„æ€§èƒ½ã€‚&lt;/p>
&lt;p>ç†æƒ³æƒ…å†µä¸‹ï¼Œåº”è¯¥æ˜¯æ¯ä¸ªIOçº¿ç¨‹è¯»å–å®Œæ•°æ®ä¹‹åï¼Œå°±å¯ä»¥ç«‹å³é€šçŸ¥ main çº¿ç¨‹ï¼Œmain çº¿ç¨‹å¯ä»¥ç«‹å³å¤„ç†è¿™äº›å·²ç»è¯»å–å®Œæ•°æ®çš„å‘½ä»¤ï¼Œè€Œä¸éœ€è¦ç­‰å¾…å…¶ä»– IO çº¿ç¨‹è¯»å–å®Œæ•°æ®ä¹‹åï¼Œæ‰èƒ½ç»§ç»­å¤„ç†å‘½ä»¤ã€‚&lt;/p>
&lt;p>åœ¨ 8.0 ç‰ˆæœ¬ä¸­ï¼Œredisè§£å†³äº†è¿™ä¸ªé—®é¢˜ï¼Œå®ç°äº†æ¯ä¸ª IO çº¿ç¨‹è¯»å–å®Œæ•°æ®ä¹‹åï¼Œå°±å¯ä»¥ç«‹å³é€šçŸ¥ main çº¿ç¨‹ï¼Œmain çº¿ç¨‹å¯ä»¥ç«‹å³å¤„ç†è¿™äº›å·²ç»è¯»å–å®Œæ•°æ®çš„å‘½ä»¤ï¼Œè€Œä¸éœ€è¦ç­‰å¾…å…¶ä»– IO çº¿ç¨‹è¯»å–å®Œæ•°æ®ä¹‹åï¼Œæ‰èƒ½ç»§ç»­å¤„ç†å‘½ä»¤ã€‚&lt;/p>
&lt;p>&lt;a class="link" href="https://github.com/redis/redis/pull/13665" target="_blank" rel="noopener"
>Github PR&lt;/a> è¿™æ˜¯ redis 8.0 ç‰ˆæœ¬å¤šçº¿ç¨‹ä¼˜åŒ–çš„ PRï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥çœ‹ä¸€ä¸‹ã€‚&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/7f68ee43ae37a4b52c232b1be42f099f222c74a7.png">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/7f68ee43ae37a4b52c232b1be42f099f222c74a7.png" alt="" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>è¿™æ˜¯ä½œè€…åœ¨ PR ä¸­ç”»çš„ç¤ºæ„å›¾ã€‚&lt;/p>
&lt;p>å›é¦–çœ‹ä¹‹å‰å†™çš„é‚£ç¯‡æ–‡ç« ï¼Œå½“æ—¶å­¦ç–æ‰æµ…ï¼Œæ–‡ç« æ•´ä½“é€»è¾‘ä¸å¤Ÿæ¸…æ™°ï¼Œä¸€äº›åœ°æ–¹æ²¡æœ‰è®²æ¸…æ¥šï¼Œå¯èƒ½é˜…è¯»èµ·æ¥ä¸æ˜¯å¾ˆè¿è´¯ï¼Œä½†æ˜¯åº”è¯¥æ²¡æœ‰å¤§çš„é”™è¯¯ã€‚ç°åœ¨é‡æ–°å­¦ä¹ äº† 8.0 ç‰ˆæœ¬çš„ç½‘ç»œå®ç°ä¹‹åï¼Œé‡æ–°æ¢³ç†äº†ä¸€ä¸‹æ€è·¯ï¼Œå†™ä¸‹è¿™ç¯‡æ–‡ç« ï¼Œå¸Œæœ›èƒ½æŠŠ redis 8.0 ç‰ˆæœ¬çš„ç½‘ç»œå®ç°è®²æ¸…æ¥šã€‚&lt;/p>
&lt;p>æœ¬ç¯‡æ–‡ç« ä½¿ç”¨çš„ä»£ç æ˜¯ &lt;strong>redis 8.2.3&lt;/strong> ä¸åŒçš„ç‰ˆæœ¬å¯èƒ½ä¼šæœ‰ä¸€äº›å·®å¼‚ã€‚&lt;/p>
&lt;p>æœ¬ç¯‡æ–‡ä¸­ï¼Œä¸»è¦ä» &lt;strong>ç½‘ç»œåˆå§‹åŒ–&lt;/strong> ï¼Œ &lt;strong>æ–°é“¾æ¥å¤„ç†&lt;/strong> ï¼Œ &lt;strong>IOçº¿ç¨‹é€»è¾‘&lt;/strong> ï¼Œ &lt;strong>ä¸»çº¿ç¨‹é€»è¾‘&lt;/strong> ï¼Œ &lt;strong>æ•°æ®è¯»å†™&lt;/strong> äº”ä¸ªæ–¹é¢æ¥ä»‹ç» redis 8.0 ç‰ˆæœ¬çš„ç½‘ç»œå®ç°ã€‚&lt;/p>
&lt;p>åœ¨å¼€å§‹å‰ï¼Œéœ€è¦å…ˆäº†è§£ redis ä¸­å‡ ä¸ªé‡è¦çš„æ•°æ®ç»“æ„ï¼š&lt;/p>
&lt;p>&lt;strong>aeEventLoop&lt;/strong>ï¼šäº‹ä»¶å¾ªç¯ç»“æ„ä½“ï¼Œè´Ÿè´£ç®¡ç†æ‰€æœ‰çš„ç½‘ç»œäº‹ä»¶ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">typedef&lt;/span> &lt;span style="color:#ff79c6">struct&lt;/span> aeEventLoop {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span> &lt;span style="color:#8be9fd">int&lt;/span> maxfd; &lt;span style="color:#6272a4">/* fd çš„æœ€å¤§å€¼ */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span> &lt;span style="color:#8be9fd">int&lt;/span> setsize; &lt;span style="color:#6272a4">/* è¿½è¸ªçš„æœ€å¤§fdæ•°é‡ */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span> &lt;span style="color:#8be9fd">long&lt;/span> &lt;span style="color:#8be9fd">long&lt;/span> timeEventNextId;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span> &lt;span style="color:#8be9fd">int&lt;/span> nevents; &lt;span style="color:#6272a4">/* å½“å‰æ³¨å†Œçš„äº‹ä»¶æ•°é‡ */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span> aeFileEvent &lt;span style="color:#ff79c6">*&lt;/span>events; &lt;span style="color:#6272a4">/* å·²æ³¨å†Œçš„äº‹ä»¶(å…¶å®æ˜¯æ•°ç»„) */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span> aeFiredEvent &lt;span style="color:#ff79c6">*&lt;/span>fired; &lt;span style="color:#6272a4">/* è§¦å‘çš„äº‹ä»¶ */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span> aeTimeEvent &lt;span style="color:#ff79c6">*&lt;/span>timeEventHead; &lt;span style="color:#6272a4">/* å®šæ—¶äº‹ä»¶é“¾è¡¨å¤´ */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span> &lt;span style="color:#8be9fd">int&lt;/span> stop; &lt;span style="color:#6272a4">/* åœæ­¢æ ‡å¿— */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span> &lt;span style="color:#8be9fd">void&lt;/span> &lt;span style="color:#ff79c6">*&lt;/span>apidata; &lt;span style="color:#6272a4">/* ä¸åŒå¹³å°çš„äº‹ä»¶è½®è®­å™¨æŒ‡é’ˆ(linuxä½¿ç”¨epoll) */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span> aeBeforeSleepProc &lt;span style="color:#ff79c6">*&lt;/span>beforesleep; &lt;span style="color:#6272a4">/* äº‹ä»¶å¾ªç¯ç¡çœ å‰çš„å›è°ƒå‡½æ•° */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span> aeBeforeSleepProc &lt;span style="color:#ff79c6">*&lt;/span>aftersleep; &lt;span style="color:#6272a4">/* äº‹ä»¶å¾ªç¯ç¡çœ åçš„å›è°ƒå‡½æ•° */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span> &lt;span style="color:#8be9fd">int&lt;/span> flags; &lt;span style="color:#6272a4">/* äº‹ä»¶å¾ªç¯æ ‡å¿— */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span> &lt;span style="color:#8be9fd">void&lt;/span> &lt;span style="color:#ff79c6">*&lt;/span>privdata[&lt;span style="color:#bd93f9">2&lt;/span>]; &lt;span style="color:#6272a4">/* ç§æœ‰æ•°æ®æŒ‡é’ˆ */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15&lt;/span>&lt;span>} aeEventLoop;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>é€šè¿‡ &lt;code>aeCreateEventLoop&lt;/code> å‡½æ•°åˆ›å»ºï¼š&lt;/p>
&lt;p>é¦–å…ˆä¼šåœ¨ æœåŠ¡å¯åŠ¨æ—¶ï¼Œåœ¨ä¸»çº¿çº¿ç¨‹åˆ›å»ºä¸€ä¸ª &lt;code>aeEventLoop&lt;/code>ï¼Œæ”¾åˆ° &lt;code>server.el&lt;/code> ä¸­ï¼Œå¦‚æœå¯ç”¨äº†å¤šçº¿ç¨‹ï¼Œè¿˜ä¼šä¸ºæ¯ä¸ª IO çº¿ç¨‹åˆ›å»ºä¸€ä¸ª &lt;code>aeEventLoop&lt;/code>ï¼Œæ”¾åˆ° &lt;code>server.io_threads[i]-&amp;gt;el&lt;/code> ä¸­ã€‚&lt;/p>
&lt;p>&lt;strong>connection&lt;/strong>ï¼šè¿æ¥ç»“æ„ä½“ï¼Œè¡¨ç¤ºä¸€ä¸ªç½‘ç»œè¿æ¥ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">struct&lt;/span> connection {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span> ConnectionType &lt;span style="color:#ff79c6">*&lt;/span>type; &lt;span style="color:#6272a4">/* è¿æ¥ç±»å‹,æœ¬æ¬¡åªå…³æ³¨ socketç±»å‹ */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span> ConnectionState state; &lt;span style="color:#6272a4">/* è¿æ¥çŠ¶æ€ */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span> &lt;span style="color:#8be9fd">int&lt;/span> last_errno; &lt;span style="color:#6272a4">/* æœ€è¿‘ä¸€æ¬¡é”™è¯¯ç  */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span> &lt;span style="color:#8be9fd">int&lt;/span> fd; &lt;span style="color:#6272a4">/* å½“å‰è¿æ¥çš„æ–‡ä»¶æè¿°ç¬¦ (fd) */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span> &lt;span style="color:#8be9fd">short&lt;/span> &lt;span style="color:#8be9fd">int&lt;/span> flags; &lt;span style="color:#6272a4">/* è¿æ¥æ ‡å¿— */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span> &lt;span style="color:#8be9fd">short&lt;/span> &lt;span style="color:#8be9fd">int&lt;/span> refs; &lt;span style="color:#6272a4">/* è¿æ¥å¼•ç”¨è®¡æ•° */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span> &lt;span style="color:#8be9fd">unsigned&lt;/span> &lt;span style="color:#8be9fd">short&lt;/span> &lt;span style="color:#8be9fd">int&lt;/span> iovcnt; &lt;span style="color:#6272a4">/* å½“å‰ iovec æ•°é‡ */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span> &lt;span style="color:#8be9fd">void&lt;/span> &lt;span style="color:#ff79c6">*&lt;/span>private_data; &lt;span style="color:#6272a4">/* ç§æœ‰æ•°æ®æŒ‡é’ˆ */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span> &lt;span style="color:#ff79c6">struct&lt;/span> aeEventLoop &lt;span style="color:#ff79c6">*&lt;/span>el; &lt;span style="color:#6272a4">/* å…³è”çš„äº‹ä»¶å¾ªç¯ */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span> ConnectionCallbackFunc conn_handler; &lt;span style="color:#6272a4">/* è¿æ¥å¤„ç†å›è°ƒå‡½æ•° */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span> ConnectionCallbackFunc write_handler; &lt;span style="color:#6272a4">/* å†™å¤„ç†å›è°ƒå‡½æ•° */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span> ConnectionCallbackFunc read_handler; &lt;span style="color:#6272a4">/* è¯»å¤„ç†å›è°ƒå‡½æ•° */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span>};
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>ConnectionType&lt;/code> ç»“æ„ä½“å®šä¹‰äº†è¿æ¥çš„å„ç§æ“ä½œå‡½æ•°æŒ‡é’ˆï¼Œä¸åŒç±»å‹çš„è¿æ¥(æ¯”å¦‚ TCP è¿æ¥ã€TLS è¿æ¥ç­‰)ä¼šæœ‰ä¸åŒçš„å®ç°ã€‚æœ¬æ¬¡åªå…³æ³¨ socket ç±»å‹çš„è¿æ¥ã€‚è¿™é‡Œå› ä¸º &lt;code>ConnectionType&lt;/code> ç»“æ„ä½“æ¯”è¾ƒå¤§ï¼Œå…ˆè´´å‡ºæ¥ï¼Œä¸å±•å¼€è®²è§£ï¼Œåé¢ç”¨åˆ°çš„åœ°æ–¹ä¼šæŒ‡å‡ºå’Œè§£é‡Šã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">typedef&lt;/span> &lt;span style="color:#ff79c6">struct&lt;/span> ConnectionType {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span> &lt;span style="color:#6272a4">/* connection type */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span> &lt;span style="color:#ff79c6">const&lt;/span> &lt;span style="color:#8be9fd">char&lt;/span> &lt;span style="color:#ff79c6">*&lt;/span>(&lt;span style="color:#ff79c6">*&lt;/span>get_type)(&lt;span style="color:#ff79c6">struct&lt;/span> connection &lt;span style="color:#ff79c6">*&lt;/span>conn);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span> &lt;span style="color:#6272a4">/* connection type initialize &amp;amp; finalize &amp;amp; configure */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span> &lt;span style="color:#8be9fd">void&lt;/span> (&lt;span style="color:#ff79c6">*&lt;/span>init)(&lt;span style="color:#8be9fd">void&lt;/span>); &lt;span style="color:#6272a4">/* auto-call during register */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span> &lt;span style="color:#8be9fd">void&lt;/span> (&lt;span style="color:#ff79c6">*&lt;/span>cleanup)(&lt;span style="color:#8be9fd">void&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span> &lt;span style="color:#8be9fd">int&lt;/span> (&lt;span style="color:#ff79c6">*&lt;/span>configure)(&lt;span style="color:#8be9fd">void&lt;/span> &lt;span style="color:#ff79c6">*&lt;/span>priv, &lt;span style="color:#8be9fd">int&lt;/span> reconfigure);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span> &lt;span style="color:#6272a4">/* ae &amp;amp; accept &amp;amp; listen &amp;amp; error &amp;amp; address handler */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span> &lt;span style="color:#8be9fd">void&lt;/span> (&lt;span style="color:#ff79c6">*&lt;/span>ae_handler)(&lt;span style="color:#ff79c6">struct&lt;/span> aeEventLoop &lt;span style="color:#ff79c6">*&lt;/span>el, &lt;span style="color:#8be9fd">int&lt;/span> fd, &lt;span style="color:#8be9fd">void&lt;/span> &lt;span style="color:#ff79c6">*&lt;/span>clientData, &lt;span style="color:#8be9fd">int&lt;/span> mask);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span> aeFileProc &lt;span style="color:#ff79c6">*&lt;/span>accept_handler;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span> &lt;span style="color:#8be9fd">int&lt;/span> (&lt;span style="color:#ff79c6">*&lt;/span>addr)(connection &lt;span style="color:#ff79c6">*&lt;/span>conn, &lt;span style="color:#8be9fd">char&lt;/span> &lt;span style="color:#ff79c6">*&lt;/span>ip, &lt;span style="color:#8be9fd">size_t&lt;/span> ip_len, &lt;span style="color:#8be9fd">int&lt;/span> &lt;span style="color:#ff79c6">*&lt;/span>port, &lt;span style="color:#8be9fd">int&lt;/span> remote);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span> &lt;span style="color:#8be9fd">int&lt;/span> (&lt;span style="color:#ff79c6">*&lt;/span>is_local)(connection &lt;span style="color:#ff79c6">*&lt;/span>conn);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15&lt;/span>&lt;span> &lt;span style="color:#8be9fd">int&lt;/span> (&lt;span style="color:#ff79c6">*&lt;/span>listen)(connListener &lt;span style="color:#ff79c6">*&lt;/span>listener);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17&lt;/span>&lt;span> &lt;span style="color:#6272a4">/* create/shutdown/close connection */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18&lt;/span>&lt;span> connection&lt;span style="color:#ff79c6">*&lt;/span> (&lt;span style="color:#ff79c6">*&lt;/span>conn_create)(&lt;span style="color:#ff79c6">struct&lt;/span> aeEventLoop &lt;span style="color:#ff79c6">*&lt;/span>el);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19&lt;/span>&lt;span> connection&lt;span style="color:#ff79c6">*&lt;/span> (&lt;span style="color:#ff79c6">*&lt;/span>conn_create_accepted)(&lt;span style="color:#ff79c6">struct&lt;/span> aeEventLoop &lt;span style="color:#ff79c6">*&lt;/span>el, &lt;span style="color:#8be9fd">int&lt;/span> fd, &lt;span style="color:#8be9fd">void&lt;/span> &lt;span style="color:#ff79c6">*&lt;/span>priv);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20&lt;/span>&lt;span> &lt;span style="color:#8be9fd">void&lt;/span> (&lt;span style="color:#ff79c6">*&lt;/span>shutdown)(&lt;span style="color:#ff79c6">struct&lt;/span> connection &lt;span style="color:#ff79c6">*&lt;/span>conn);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21&lt;/span>&lt;span> &lt;span style="color:#8be9fd">void&lt;/span> (&lt;span style="color:#ff79c6">*&lt;/span>close)(&lt;span style="color:#ff79c6">struct&lt;/span> connection &lt;span style="color:#ff79c6">*&lt;/span>conn);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23&lt;/span>&lt;span> &lt;span style="color:#6272a4">/* connect &amp;amp; accept */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24&lt;/span>&lt;span> &lt;span style="color:#8be9fd">int&lt;/span> (&lt;span style="color:#ff79c6">*&lt;/span>connect)(&lt;span style="color:#ff79c6">struct&lt;/span> connection &lt;span style="color:#ff79c6">*&lt;/span>conn, &lt;span style="color:#ff79c6">const&lt;/span> &lt;span style="color:#8be9fd">char&lt;/span> &lt;span style="color:#ff79c6">*&lt;/span>addr, &lt;span style="color:#8be9fd">int&lt;/span> port, &lt;span style="color:#ff79c6">const&lt;/span> &lt;span style="color:#8be9fd">char&lt;/span> &lt;span style="color:#ff79c6">*&lt;/span>source_addr, ConnectionCallbackFunc connect_handler);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25&lt;/span>&lt;span> &lt;span style="color:#8be9fd">int&lt;/span> (&lt;span style="color:#ff79c6">*&lt;/span>blocking_connect)(&lt;span style="color:#ff79c6">struct&lt;/span> connection &lt;span style="color:#ff79c6">*&lt;/span>conn, &lt;span style="color:#ff79c6">const&lt;/span> &lt;span style="color:#8be9fd">char&lt;/span> &lt;span style="color:#ff79c6">*&lt;/span>addr, &lt;span style="color:#8be9fd">int&lt;/span> port, &lt;span style="color:#8be9fd">long&lt;/span> &lt;span style="color:#8be9fd">long&lt;/span> timeout);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26&lt;/span>&lt;span> &lt;span style="color:#8be9fd">int&lt;/span> (&lt;span style="color:#ff79c6">*&lt;/span>accept)(&lt;span style="color:#ff79c6">struct&lt;/span> connection &lt;span style="color:#ff79c6">*&lt;/span>conn, ConnectionCallbackFunc accept_handler);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28&lt;/span>&lt;span> &lt;span style="color:#6272a4">/* IO */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29&lt;/span>&lt;span> &lt;span style="color:#8be9fd">int&lt;/span> (&lt;span style="color:#ff79c6">*&lt;/span>write)(&lt;span style="color:#ff79c6">struct&lt;/span> connection &lt;span style="color:#ff79c6">*&lt;/span>conn, &lt;span style="color:#ff79c6">const&lt;/span> &lt;span style="color:#8be9fd">void&lt;/span> &lt;span style="color:#ff79c6">*&lt;/span>data, &lt;span style="color:#8be9fd">size_t&lt;/span> data_len);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30&lt;/span>&lt;span> &lt;span style="color:#8be9fd">int&lt;/span> (&lt;span style="color:#ff79c6">*&lt;/span>writev)(&lt;span style="color:#ff79c6">struct&lt;/span> connection &lt;span style="color:#ff79c6">*&lt;/span>conn, &lt;span style="color:#ff79c6">const&lt;/span> &lt;span style="color:#ff79c6">struct&lt;/span> iovec &lt;span style="color:#ff79c6">*&lt;/span>iov, &lt;span style="color:#8be9fd">int&lt;/span> iovcnt);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31&lt;/span>&lt;span> &lt;span style="color:#8be9fd">int&lt;/span> (&lt;span style="color:#ff79c6">*&lt;/span>read)(&lt;span style="color:#ff79c6">struct&lt;/span> connection &lt;span style="color:#ff79c6">*&lt;/span>conn, &lt;span style="color:#8be9fd">void&lt;/span> &lt;span style="color:#ff79c6">*&lt;/span>buf, &lt;span style="color:#8be9fd">size_t&lt;/span> buf_len);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32&lt;/span>&lt;span> &lt;span style="color:#8be9fd">int&lt;/span> (&lt;span style="color:#ff79c6">*&lt;/span>set_write_handler)(&lt;span style="color:#ff79c6">struct&lt;/span> connection &lt;span style="color:#ff79c6">*&lt;/span>conn, ConnectionCallbackFunc handler, &lt;span style="color:#8be9fd">int&lt;/span> barrier);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33&lt;/span>&lt;span> &lt;span style="color:#8be9fd">int&lt;/span> (&lt;span style="color:#ff79c6">*&lt;/span>set_read_handler)(&lt;span style="color:#ff79c6">struct&lt;/span> connection &lt;span style="color:#ff79c6">*&lt;/span>conn, ConnectionCallbackFunc handler);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34&lt;/span>&lt;span> &lt;span style="color:#ff79c6">const&lt;/span> &lt;span style="color:#8be9fd">char&lt;/span> &lt;span style="color:#ff79c6">*&lt;/span>(&lt;span style="color:#ff79c6">*&lt;/span>get_last_error)(&lt;span style="color:#ff79c6">struct&lt;/span> connection &lt;span style="color:#ff79c6">*&lt;/span>conn);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35&lt;/span>&lt;span> &lt;span style="color:#8be9fd">ssize_t&lt;/span> (&lt;span style="color:#ff79c6">*&lt;/span>sync_write)(&lt;span style="color:#ff79c6">struct&lt;/span> connection &lt;span style="color:#ff79c6">*&lt;/span>conn, &lt;span style="color:#8be9fd">char&lt;/span> &lt;span style="color:#ff79c6">*&lt;/span>ptr, &lt;span style="color:#8be9fd">ssize_t&lt;/span> size, &lt;span style="color:#8be9fd">long&lt;/span> &lt;span style="color:#8be9fd">long&lt;/span> timeout);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36&lt;/span>&lt;span> &lt;span style="color:#8be9fd">ssize_t&lt;/span> (&lt;span style="color:#ff79c6">*&lt;/span>sync_read)(&lt;span style="color:#ff79c6">struct&lt;/span> connection &lt;span style="color:#ff79c6">*&lt;/span>conn, &lt;span style="color:#8be9fd">char&lt;/span> &lt;span style="color:#ff79c6">*&lt;/span>ptr, &lt;span style="color:#8be9fd">ssize_t&lt;/span> size, &lt;span style="color:#8be9fd">long&lt;/span> &lt;span style="color:#8be9fd">long&lt;/span> timeout);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37&lt;/span>&lt;span> &lt;span style="color:#8be9fd">ssize_t&lt;/span> (&lt;span style="color:#ff79c6">*&lt;/span>sync_readline)(&lt;span style="color:#ff79c6">struct&lt;/span> connection &lt;span style="color:#ff79c6">*&lt;/span>conn, &lt;span style="color:#8be9fd">char&lt;/span> &lt;span style="color:#ff79c6">*&lt;/span>ptr, &lt;span style="color:#8be9fd">ssize_t&lt;/span> size, &lt;span style="color:#8be9fd">long&lt;/span> &lt;span style="color:#8be9fd">long&lt;/span> timeout);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39&lt;/span>&lt;span> &lt;span style="color:#6272a4">/* event loop */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40&lt;/span>&lt;span> &lt;span style="color:#8be9fd">void&lt;/span> (&lt;span style="color:#ff79c6">*&lt;/span>unbind_event_loop)(&lt;span style="color:#ff79c6">struct&lt;/span> connection &lt;span style="color:#ff79c6">*&lt;/span>conn);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41&lt;/span>&lt;span> &lt;span style="color:#8be9fd">int&lt;/span> (&lt;span style="color:#ff79c6">*&lt;/span>rebind_event_loop)(&lt;span style="color:#ff79c6">struct&lt;/span> connection &lt;span style="color:#ff79c6">*&lt;/span>conn, aeEventLoop &lt;span style="color:#ff79c6">*&lt;/span>el);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43&lt;/span>&lt;span> &lt;span style="color:#6272a4">/* pending data */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44&lt;/span>&lt;span> &lt;span style="color:#8be9fd">int&lt;/span> (&lt;span style="color:#ff79c6">*&lt;/span>has_pending_data)(&lt;span style="color:#ff79c6">struct&lt;/span> aeEventLoop &lt;span style="color:#ff79c6">*&lt;/span>el);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45&lt;/span>&lt;span> &lt;span style="color:#8be9fd">int&lt;/span> (&lt;span style="color:#ff79c6">*&lt;/span>process_pending_data)(&lt;span style="color:#ff79c6">struct&lt;/span> aeEventLoop &lt;span style="color:#ff79c6">*&lt;/span>el);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47&lt;/span>&lt;span> &lt;span style="color:#6272a4">/* TLS specified methods */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48&lt;/span>&lt;span> &lt;span style="color:#50fa7b">sds&lt;/span> (&lt;span style="color:#ff79c6">*&lt;/span>get_peer_cert)(&lt;span style="color:#ff79c6">struct&lt;/span> connection &lt;span style="color:#ff79c6">*&lt;/span>conn);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49&lt;/span>&lt;span>} ConnectionType;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æ¯ä¸ªè¿æ¥éƒ½ä¼šå¯¹åº”ä¸€ä¸ª &lt;code>connection&lt;/code> ç»“æ„ä½“ï¼Œè¡¨ç¤ºè¿™ä¸ªè¿æ¥çš„å„ç§ä¿¡æ¯ï¼Œæ¯”å¦‚æ–‡ä»¶æè¿°ç¬¦ã€è¿æ¥çŠ¶æ€ã€è¯»å†™å¤„ç†å‡½æ•°ç­‰ã€‚åœ¨ redis ä¸­ï¼Œæ‰€æœ‰çš„ç½‘ç»œè¿æ¥éƒ½æ˜¯é€šè¿‡ &lt;code>connection&lt;/code> ç»“æ„ä½“æ¥ç®¡ç†çš„ã€‚&lt;/p>
&lt;p>&lt;strong>eventNotifier&lt;/strong>ï¼šäº‹ä»¶é€šçŸ¥å™¨ç»“æ„ä½“ï¼Œè´Ÿè´£åœ¨ IO çº¿ç¨‹å’Œä¸»çº¿ç¨‹ä¹‹é—´ä¼ é€’äº‹ä»¶é€šçŸ¥ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">typedef&lt;/span> &lt;span style="color:#ff79c6">struct&lt;/span> eventNotifier {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span>&lt;span style="color:#ff79c6">#ifdef HAVE_EVENT_FD
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3&lt;/span>&lt;span>&lt;span style="color:#ff79c6">&lt;/span> &lt;span style="color:#8be9fd">int&lt;/span> efd;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4&lt;/span>&lt;span>&lt;span style="color:#ff79c6">#else
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5&lt;/span>&lt;span>&lt;span style="color:#ff79c6">&lt;/span> &lt;span style="color:#8be9fd">int&lt;/span> pipefd[&lt;span style="color:#bd93f9">2&lt;/span>];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6&lt;/span>&lt;span>&lt;span style="color:#ff79c6">#endif
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7&lt;/span>&lt;span>&lt;span style="color:#ff79c6">&lt;/span>} eventNotifier;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æ ¹æ®ä¸åŒçš„å¹³å°ï¼Œä½¿ç”¨ä¸åŒçš„æ–¹å¼å®ç°äº‹ä»¶é€šçŸ¥ã€‚åœ¨ linux å¹³å°ä¸Šï¼Œä½¿ç”¨ eventfd æ¥å®ç°äº‹ä»¶é€šçŸ¥ï¼›åœ¨å…¶ä»–å¹³å°ä¸Šï¼Œä½¿ç”¨ç®¡é“(pipe)æ¥å®ç°äº‹ä»¶é€šçŸ¥ã€‚è¿™ä¸ªç»“æ„ä½“ä¸»è¦ç”¨äº IO çº¿ç¨‹å’Œä¸»çº¿ç¨‹ä¹‹é—´çš„é€šä¿¡ã€‚&lt;/p>
&lt;p>ä¸‹é¢å¼€å§‹ä¸€ç‚¹ç‚¹åˆ†ææºç ã€‚&lt;/p>
&lt;h2 id="ç½‘ç»œåˆå§‹åŒ–">&lt;a href="#%e7%bd%91%e7%bb%9c%e5%88%9d%e5%a7%8b%e5%8c%96" class="header-anchor">&lt;/a>ç½‘ç»œåˆå§‹åŒ–
&lt;/h2>&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/ca4872343ceaf5c5142536b8ed811bce4097b77f.svg">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/ca4872343ceaf5c5142536b8ed811bce4097b77f.svg" alt="" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>è¿™æ˜¯ä¸€ä¸ªå¤§æ¦‚çš„ç½‘ç»œåˆå§‹åŒ–æµç¨‹å›¾ï¼Œä¸»è¦åŒ…æ‹¬ä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š&lt;/p>
&lt;ol>
&lt;li>&lt;strong>åˆ›å»ºä¸»äº‹ä»¶å¾ªç¯&lt;/strong>ï¼š&lt;/li>
&lt;/ol>
&lt;p>åœ¨ &lt;code>main&lt;/code> å‡½æ•°ä¸­ï¼Œè°ƒç”¨ &lt;code>initServer&lt;/code> å‡½æ•°åˆå§‹åŒ– redis æœåŠ¡å™¨ï¼Œä¸»è¦æ˜¯ä¸º &lt;code>redisServer&lt;/code> è¿™ä¸ªç»“æ„ä½“åˆå§‹åŒ–å„ç§å‚æ•°ã€‚å…¶ä¸­å’Œç½‘ç»œç›¸å…³çš„æ˜¯&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>server.el &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#50fa7b">aeCreateEventLoop&lt;/span>(server.maxclients&lt;span style="color:#ff79c6">+&lt;/span>CONFIG_FDSET_INCR);
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™è¡Œä»£ç åˆ›å»ºäº†ä¸»äº‹ä»¶å¾ªç¯ &lt;code>aeEventLoop&lt;/code>ï¼Œå¹¶å°†å…¶èµ‹å€¼ç»™ &lt;code>server.el&lt;/code>ã€‚&lt;/p>
&lt;p>&lt;code>main&lt;/code> å‡½æ•°ç»§ç»­æ‰§è¡Œï¼Œè°ƒç”¨ &lt;code>initListeners&lt;/code> å‡½æ•°åˆå§‹åŒ–ç›‘å¬å¥—æ¥å­—ï¼Œä¸»è¦æ˜¯åˆ›å»ºç›‘å¬å¥—æ¥å­—ï¼Œå¹¶å°†å…¶æ³¨å†Œåˆ°ä¸»äº‹ä»¶å¾ªç¯ä¸­ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#8be9fd">void&lt;/span> &lt;span style="color:#50fa7b">initListeners&lt;/span>(&lt;span style="color:#8be9fd">void&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span> &lt;span style="color:#8be9fd">int&lt;/span> conn_index;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span> connListener &lt;span style="color:#ff79c6">*&lt;/span>listener;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span> &lt;span style="color:#6272a4">//å¦‚æœé…ç½®äº†ç«¯å£ï¼Œå°±åˆ›å»º socket ç›‘å¬å™¨
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">if&lt;/span> (server.port &lt;span style="color:#ff79c6">!=&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span> conn_index &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#50fa7b">connectionIndexByType&lt;/span>(CONN_TYPE_SOCKET);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (conn_index &lt;span style="color:#ff79c6">&amp;lt;&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span> &lt;span style="color:#50fa7b">serverPanic&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;Failed finding connection listener of %s&amp;#34;&lt;/span>, CONN_TYPE_SOCKET);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span> listener &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#ff79c6">&amp;amp;&lt;/span>server.listeners[conn_index];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span> listener&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>bindaddr &lt;span style="color:#ff79c6">=&lt;/span> server.bindaddr;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span> listener&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>bindaddr_count &lt;span style="color:#ff79c6">=&lt;/span> server.bindaddr_count;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span> listener&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>port &lt;span style="color:#ff79c6">=&lt;/span> server.port;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span> listener&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>ct &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#50fa7b">connectionByType&lt;/span>(CONN_TYPE_SOCKET);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16&lt;/span>&lt;span> &lt;span style="color:#6272a4">//çœç•¥unixdomainå’Œtlsç›‘å¬å™¨çš„ç›¸å…³é€»è¾‘
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> ......
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19&lt;/span>&lt;span> &lt;span style="color:#6272a4">/* create all the configured listener, and add handler to start to accept */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20&lt;/span>&lt;span> &lt;span style="color:#8be9fd">int&lt;/span> listen_fds &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21&lt;/span>&lt;span> &lt;span style="color:#ff79c6">for&lt;/span> (&lt;span style="color:#8be9fd">int&lt;/span> j &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>; j &lt;span style="color:#ff79c6">&amp;lt;&lt;/span> CONN_TYPE_MAX; j&lt;span style="color:#ff79c6">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22&lt;/span>&lt;span> listener &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#ff79c6">&amp;amp;&lt;/span>server.listeners[j];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (listener&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>ct &lt;span style="color:#ff79c6">==&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">NULL&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24&lt;/span>&lt;span> &lt;span style="color:#ff79c6">continue&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26&lt;/span>&lt;span> &lt;span style="color:#6272a4">// åˆ›å»ºç›‘å¬socket
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">if&lt;/span> (&lt;span style="color:#50fa7b">connListen&lt;/span>(listener) &lt;span style="color:#ff79c6">==&lt;/span> C_ERR) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28&lt;/span>&lt;span> &lt;span style="color:#50fa7b">serverLog&lt;/span>(LL_WARNING, &lt;span style="color:#f1fa8c">&amp;#34;Failed listening on port %u (%s), aborting.&amp;#34;&lt;/span>, listener&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>port, listener&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>ct&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>&lt;span style="color:#50fa7b">get_type&lt;/span>(&lt;span style="color:#8be9fd;font-style:italic">NULL&lt;/span>));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29&lt;/span>&lt;span> &lt;span style="color:#50fa7b">exit&lt;/span>(&lt;span style="color:#bd93f9">1&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31&lt;/span>&lt;span> &lt;span style="color:#6272a4">// ä¸ºç›‘å¬socketåˆ›å»ºacceptå¤„ç†å™¨ï¼Œå¹¶æ³¨å†Œåˆ°server.elä¸­
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">if&lt;/span> (&lt;span style="color:#50fa7b">createSocketAcceptHandler&lt;/span>(listener, &lt;span style="color:#50fa7b">connAcceptHandler&lt;/span>(listener&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>ct)) &lt;span style="color:#ff79c6">!=&lt;/span> C_OK)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33&lt;/span>&lt;span> &lt;span style="color:#50fa7b">serverPanic&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;Unrecoverable error creating %s listener accept handler.&amp;#34;&lt;/span>, listener&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>ct&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>&lt;span style="color:#50fa7b">get_type&lt;/span>(&lt;span style="color:#8be9fd;font-style:italic">NULL&lt;/span>));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35&lt;/span>&lt;span> listen_fds &lt;span style="color:#ff79c6">+=&lt;/span> listener&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>count;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (listen_fds &lt;span style="color:#ff79c6">==&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39&lt;/span>&lt;span> &lt;span style="color:#50fa7b">serverLog&lt;/span>(LL_WARNING, &lt;span style="color:#f1fa8c">&amp;#34;Configured to not listen anywhere, exiting.&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40&lt;/span>&lt;span> &lt;span style="color:#50fa7b">exit&lt;/span>(&lt;span style="color:#bd93f9">1&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>createSocketAcceptHandler&lt;/code> å‡½æ•°æœ€ç»ˆä¼šæŠŠ &lt;code>connSocketAcceptHandler&lt;/code> æ³¨å†Œåˆ°ä¸»äº‹ä»¶å¾ªç¯ &lt;code>server.el&lt;/code> ä¸­ï¼Œå½“æœ‰æ–°çš„è¿æ¥åˆ°æ¥æ—¶ï¼Œä¸»äº‹ä»¶å¾ªç¯ä¼šè°ƒç”¨è¿™ä¸ªå¤„ç†å™¨æ¥å¤„ç†æ–°è¿æ¥ã€‚&lt;/p>
&lt;p>&lt;code>connListen&lt;/code> å‡½æ•°&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">static&lt;/span> &lt;span style="color:#ff79c6">inline&lt;/span> &lt;span style="color:#8be9fd">int&lt;/span> &lt;span style="color:#50fa7b">connListen&lt;/span>(connListener &lt;span style="color:#ff79c6">*&lt;/span>listener) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> listener&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>ct&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>&lt;span style="color:#50fa7b">listen&lt;/span>(listener);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è°ƒç”¨ &lt;code>ConnectionType&lt;/code> ç»“æ„ä½“ä¸­çš„ &lt;code>listen&lt;/code> å‡½æ•°æŒ‡é’ˆ(æŒ‡å‘ &lt;code>connSocketListen&lt;/code>)ï¼Œåˆ›å»ºç›‘å¬ socketï¼Œå¹¶ç»‘å®šåˆ°æŒ‡å®šçš„åœ°å€å’Œç«¯å£ã€‚&lt;/p>
&lt;p>&lt;code>createSocketAcceptHandler&lt;/code> å‡½æ•°&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#8be9fd">int&lt;/span> &lt;span style="color:#50fa7b">createSocketAcceptHandler&lt;/span>(connListener &lt;span style="color:#ff79c6">*&lt;/span>sfd, aeFileProc &lt;span style="color:#ff79c6">*&lt;/span>accept_handler) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span> &lt;span style="color:#8be9fd">int&lt;/span> j;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span> &lt;span style="color:#ff79c6">for&lt;/span> (j &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>; j &lt;span style="color:#ff79c6">&amp;lt;&lt;/span> sfd&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>count; j&lt;span style="color:#ff79c6">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (&lt;span style="color:#50fa7b">aeCreateFileEvent&lt;/span>(server.el, sfd&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>fd[j], AE_READABLE, accept_handler,sfd) &lt;span style="color:#ff79c6">==&lt;/span> AE_ERR) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span> &lt;span style="color:#6272a4">/* Rollback */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span> &lt;span style="color:#ff79c6">for&lt;/span> (j &lt;span style="color:#ff79c6">=&lt;/span> j&lt;span style="color:#ff79c6">-&lt;/span>&lt;span style="color:#bd93f9">1&lt;/span>; j &lt;span style="color:#ff79c6">&amp;gt;=&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>; j&lt;span style="color:#ff79c6">--&lt;/span>) &lt;span style="color:#50fa7b">aeDeleteFileEvent&lt;/span>(server.el, sfd&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>fd[j], AE_READABLE);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> C_ERR;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> C_OK;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™ä¸ªå‡½æ•°ä¸ºæ¯ä¸ªç›‘å¬ socket åˆ›å»ºä¸€ä¸ª accept å¤„ç†å™¨ï¼Œå¹¶å°†å…¶æ³¨å†Œåˆ°ä¸»äº‹ä»¶å¾ªç¯ &lt;code>server.el&lt;/code> ä¸­ã€‚å½“æœ‰æ–°çš„è¿æ¥åˆ°æ¥æ—¶ï¼Œä¸»äº‹ä»¶å¾ªç¯ä¼šè°ƒç”¨è¿™ä¸ª accept å¤„ç†å™¨æ¥å¤„ç†æ–°è¿æ¥ã€‚&lt;/p>
&lt;p>&lt;code>main&lt;/code> å‡½æ•°ç»§ç»­æ‰§è¡Œï¼Œè°ƒç”¨ &lt;code>InitServerLast&lt;/code> å‡½æ•°å®Œæˆ å¤šçº¿ç¨‹ç›¸å…³çš„åˆå§‹åŒ–&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>&lt;span style="color:#8be9fd">void&lt;/span> &lt;span style="color:#50fa7b">InitServerLast&lt;/span>(&lt;span style="color:#8be9fd">void&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span> &lt;span style="color:#50fa7b">bioInit&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3&lt;/span>&lt;span> &lt;span style="color:#50fa7b">initThreadedIO&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4&lt;/span>&lt;span> &lt;span style="color:#50fa7b">set_jemalloc_bg_thread&lt;/span>(server.jemalloc_bg_thread);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5&lt;/span>&lt;span> server.initial_memory_usage &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#50fa7b">zmalloc_used_memory&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>initThreadedIO&lt;/code> å‡½æ•°&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#8be9fd">void&lt;/span> &lt;span style="color:#50fa7b">initThreadedIO&lt;/span>(&lt;span style="color:#8be9fd">void&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span> &lt;span style="color:#6272a4">//å¦‚æœæ²¡æœ‰å¯ç”¨å¤šçº¿ç¨‹ï¼Œç›´æ¥è¿”å›
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">if&lt;/span> (server.io_threads_num &lt;span style="color:#ff79c6">&amp;lt;=&lt;/span> &lt;span style="color:#bd93f9">1&lt;/span>) &lt;span style="color:#ff79c6">return&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span> &lt;span style="color:#6272a4">//æŠŠIOçº¿ç¨‹æ ‡è®°ä¸ºæ¿€æ´»çŠ¶æ€
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> server.io_threads_active &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#bd93f9">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span> ........
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span> &lt;span style="color:#6272a4">//ä¸ºæ¯ä¸ªIOçº¿ç¨‹åˆ›å»ºäº‹ä»¶å¾ªç¯å’Œç›¸å…³æ•°æ®ç»“æ„
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">for&lt;/span> (&lt;span style="color:#8be9fd">int&lt;/span> i &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#bd93f9">1&lt;/span>; i &lt;span style="color:#ff79c6">&amp;lt;&lt;/span> server.io_threads_num; i&lt;span style="color:#ff79c6">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span> IOThread &lt;span style="color:#ff79c6">*&lt;/span>t &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#ff79c6">&amp;amp;&lt;/span>IOThreads[i];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span> t&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>id &lt;span style="color:#ff79c6">=&lt;/span> i;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span> t&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>el &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#50fa7b">aeCreateEventLoop&lt;/span>(server.maxclients&lt;span style="color:#ff79c6">+&lt;/span>CONFIG_FDSET_INCR);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15&lt;/span>&lt;span> .............
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16&lt;/span>&lt;span> &lt;span style="color:#6272a4">//åˆ›å»ºé€šçŸ¥å™¨ï¼Œç”¨äºIOçº¿ç¨‹é€šçŸ¥ä¸»çº¿ç¨‹æœ‰æ–°æ•°æ®å¯è¯»
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> t&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>pending_clients_notifier &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#50fa7b">createEventNotifier&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18&lt;/span>&lt;span> &lt;span style="color:#6272a4">//ä¸ºIOçº¿ç¨‹åˆ›å»ºå¤„ç†å‡½æ•°ï¼Œå½“ä¸»çº¿ç¨‹éœ€è¦è°ƒç”¨IOçº¿ç¨‹æ¥å¤„ç†æ—¶ï¼Œå¯ä»¥é€šè¿‡è§¦å‘è¿™ä¸ªé€šçŸ¥å™¨ï¼Œ
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#6272a4">//è°ƒç”¨handleClientsFromMainThreadå‡½æ•°å¤„ç†
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">if&lt;/span> (&lt;span style="color:#50fa7b">aeCreateFileEvent&lt;/span>(t&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>el, &lt;span style="color:#50fa7b">getReadEventFd&lt;/span>(t&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>pending_clients_notifier),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21&lt;/span>&lt;span> AE_READABLE, handleClientsFromMainThread, t) &lt;span style="color:#ff79c6">!=&lt;/span> AE_OK)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22&lt;/span>&lt;span> {.................}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24&lt;/span>&lt;span> ............
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26&lt;/span>&lt;span> &lt;span style="color:#6272a4">//åˆ›å»ºIOçº¿ç¨‹
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">if&lt;/span> (&lt;span style="color:#50fa7b">pthread_create&lt;/span>(&lt;span style="color:#ff79c6">&amp;amp;&lt;/span>t&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>tid, &lt;span style="color:#8be9fd;font-style:italic">NULL&lt;/span>, IOThreadMain, (&lt;span style="color:#8be9fd">void&lt;/span>&lt;span style="color:#ff79c6">*&lt;/span>)t) &lt;span style="color:#ff79c6">!=&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28&lt;/span>&lt;span> &lt;span style="color:#50fa7b">serverLog&lt;/span>(LL_WARNING, &lt;span style="color:#f1fa8c">&amp;#34;Fatal: Can&amp;#39;t initialize IO thread.&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29&lt;/span>&lt;span> &lt;span style="color:#50fa7b">exit&lt;/span>(&lt;span style="color:#bd93f9">1&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32&lt;/span>&lt;span> &lt;span style="color:#6272a4">//ä¸ºä¸»çº¿ç¨‹åˆ›å»ºç›¸å…³æ•°æ®ç»“æ„ï¼Œç”¨äºæ¥æ”¶IOçº¿ç¨‹çš„é€šçŸ¥,åé¢ä¼šè¯¦ç»†ä»‹ç»
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> mainThreadPendingClientsToIOThreads[i] &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#50fa7b">listCreate&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34&lt;/span>&lt;span> mainThreadPendingClients[i] &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#50fa7b">listCreate&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35&lt;/span>&lt;span> mainThreadProcessingClients[i] &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#50fa7b">listCreate&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36&lt;/span>&lt;span> &lt;span style="color:#50fa7b">pthread_mutex_init&lt;/span>(&lt;span style="color:#ff79c6">&amp;amp;&lt;/span>mainThreadPendingClientsMutexes[i], attr);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37&lt;/span>&lt;span> &lt;span style="color:#6272a4">//åˆ›å»ºé€šçŸ¥å™¨ï¼Œç”¨äºIOçº¿ç¨‹é€šçŸ¥ä¸»çº¿ç¨‹æœ‰æ–°æ•°æ®å¯è¯»
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> mainThreadPendingClientsNotifiers[i] &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#50fa7b">createEventNotifier&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39&lt;/span>&lt;span> &lt;span style="color:#6272a4">//ä¸ºä¸»çº¿ç¨‹åˆ›å»ºå¤„ç†å‡½æ•°ï¼Œå½“IOçº¿ç¨‹è¯»å–å®Œæ•°æ®åï¼Œå¯ä»¥é€šè¿‡è§¦å‘è¿™ä¸ªé€šçŸ¥å™¨ï¼Œ
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#6272a4">//è°ƒç”¨handleClientsFromIOThreadå‡½æ•°å¤„ç†
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">if&lt;/span> (&lt;span style="color:#50fa7b">aeCreateFileEvent&lt;/span>(server.el, &lt;span style="color:#50fa7b">getReadEventFd&lt;/span>(mainThreadPendingClientsNotifiers[i]),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42&lt;/span>&lt;span> AE_READABLE, handleClientsFromIOThread, t) &lt;span style="color:#ff79c6">!=&lt;/span> AE_OK)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43&lt;/span>&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44&lt;/span>&lt;span> &lt;span style="color:#50fa7b">exit&lt;/span>(&lt;span style="color:#bd93f9">1&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (attr) &lt;span style="color:#50fa7b">zfree&lt;/span>(attr);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>åˆ°è¿™é‡Œï¼Œç½‘ç»œåˆå§‹åŒ–çš„å·¥ä½œå°±å®Œæˆäº†ï¼Œä¸»äº‹ä»¶å¾ªç¯åˆ›å»ºå¥½äº†ï¼Œç›‘å¬ socket åˆ›å»ºå¥½äº†ï¼Œå¹¶æ³¨å†Œåˆ°äº†ä¸»äº‹ä»¶å¾ªç¯ä¸­ï¼ŒIO çº¿ç¨‹ä¹Ÿåˆ›å»ºå¥½äº†ï¼Œå¹¶ä¸ºæ¯ä¸ª IO çº¿ç¨‹åˆ›å»ºäº†äº‹ä»¶å¾ªç¯å’Œç›¸å…³æ•°æ®ç»“æ„ã€‚&lt;/p>
&lt;h2 id="æ–°è¿æ¥å¤„ç†">&lt;a href="#%e6%96%b0%e8%bf%9e%e6%8e%a5%e5%a4%84%e7%90%86" class="header-anchor">&lt;/a>æ–°è¿æ¥å¤„ç†
&lt;/h2>&lt;p>å…ˆæ¥çœ‹ä¸€ä¸‹æ–°è¿æ¥çš„å¤„ç†æµç¨‹å›¾ï¼š&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/b2e99f15fdc7a35fec0747493963cbcdb7cf4505.svg">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/b2e99f15fdc7a35fec0747493963cbcdb7cf4505.svg" alt="" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>å½“æœ‰æ–°çš„è¿æ¥åˆ°æ¥æ—¶ï¼Œä¼šåœ¨ä¸»çº¿çº¿ç¨‹çš„äº‹ä»¶å¾ªç¯ä¸­è§¦å‘ç›‘å¬ socket çš„å¯è¯»äº‹ä»¶ï¼Œç„¶åå†æŠŠè¿™ä¸ªè¿æ¥åˆ†é…åˆ°æŸä¸ª IO çº¿ç¨‹ä¸­å»å¤„ç†ã€‚&lt;/p>
&lt;p>æœ€ç»ˆä¼šé€šè¿‡ &lt;code>ConnectionType&lt;/code> ç»“æ„ä½“ä¸­çš„ &lt;code>accept&lt;/code> å‡½æ•°æŒ‡é’ˆ(æŒ‡å‘ &lt;code>connSocketAccept&lt;/code>)æ¥å¤„ç†æ–°è¿æ¥ã€‚
&lt;code>connSocketAccept&lt;/code> å‡½æ•°&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">static&lt;/span> &lt;span style="color:#8be9fd">int&lt;/span> &lt;span style="color:#50fa7b">connSocketAccept&lt;/span>(connection &lt;span style="color:#ff79c6">*&lt;/span>conn, ConnectionCallbackFunc accept_handler) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span> ...............
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (&lt;span style="color:#ff79c6">!&lt;/span>&lt;span style="color:#50fa7b">callHandler&lt;/span>(conn, accept_handler)) ret &lt;span style="color:#ff79c6">=&lt;/span> C_ERR;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4&lt;/span>&lt;span> ...............
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> ret;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>accept_handler&lt;/code> æŒ‡å‘ &lt;code>connSocketAcceptHandler&lt;/code> å‡½æ•°&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">static&lt;/span> &lt;span style="color:#8be9fd">void&lt;/span> &lt;span style="color:#50fa7b">connSocketAcceptHandler&lt;/span>(aeEventLoop &lt;span style="color:#ff79c6">*&lt;/span>el, &lt;span style="color:#8be9fd">int&lt;/span> fd, &lt;span style="color:#8be9fd">void&lt;/span> &lt;span style="color:#ff79c6">*&lt;/span>privdata, &lt;span style="color:#8be9fd">int&lt;/span> mask) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span> &lt;span style="color:#8be9fd">int&lt;/span> cport, cfd;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span> &lt;span style="color:#8be9fd">int&lt;/span> max &lt;span style="color:#ff79c6">=&lt;/span> server.max_new_conns_per_cycle;&lt;span style="color:#6272a4">//æ¯æ¬¡å¾ªç¯æœ€å¤šæ¥å—çš„è¿æ¥æ•°
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> ...............
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span> &lt;span style="color:#ff79c6">while&lt;/span>(max&lt;span style="color:#ff79c6">--&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span> cfd &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#50fa7b">anetTcpAccept&lt;/span>(server.neterr, fd, cip, &lt;span style="color:#ff79c6">sizeof&lt;/span>(cip), &lt;span style="color:#ff79c6">&amp;amp;&lt;/span>cport);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span> ...............
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span> &lt;span style="color:#50fa7b">acceptCommonHandler&lt;/span>(&lt;span style="color:#50fa7b">connCreateAcceptedSocket&lt;/span>(el,cfd,&lt;span style="color:#8be9fd;font-style:italic">NULL&lt;/span>), &lt;span style="color:#bd93f9">0&lt;/span>, cip);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>åœ¨è¿™ä¸ªå‡½æ•°ä¸­ï¼Œä¼šå¾ªç¯æ¥å—æ–°çš„è¿æ¥ï¼Œå¹¶ä¸ºæ¯ä¸ªæ–°è¿æ¥åˆ›å»ºä¸€ä¸ª &lt;code>connection&lt;/code> ç»“æ„ä½“ï¼Œç„¶åè°ƒç”¨ &lt;code>acceptCommonHandler&lt;/code> å‡½æ•°å¤„ç†æ–°è¿æ¥ã€‚&lt;/p>
&lt;p>&lt;code>acceptCommonHandler&lt;/code> å‡½æ•° å°±ä¸å±•å¼€åˆ†æäº†ï¼Œä¸»è¦æ˜¯å¯¹æ–°è¿æ¥è¿›è¡Œä¸€äº›åˆå§‹åŒ–æ“ä½œï¼Œæœ€ç»ˆæ˜¯é€šè¿‡ &lt;code>accept&lt;/code> æˆ–è€… &lt;code>accept4&lt;/code> å‡½æ•°åˆ›å»ºæ–°çš„ socket è¿æ¥ã€‚&lt;/p>
&lt;p>&lt;code>acceptCommonHandler&lt;/code> å‡½æ•°ä¼šå®Œæˆ connection ç»“æ„ä½“çš„åˆå§‹åŒ–å·¥ä½œï¼ŒåŒ…æ‹¬ä¸ºè¿™ä¸ªè¿æ¥åˆ›å»ºä¸€ä¸ª &lt;code>client&lt;/code> ç»“æ„ä½“ï¼Œå¹¶å°†è¿™ä¸ªè¿æ¥åˆ†é…åˆ°æŸä¸ª IO çº¿ç¨‹ä¸­å»å¤„ç†ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#8be9fd">void&lt;/span> &lt;span style="color:#50fa7b">acceptCommonHandler&lt;/span>(connection &lt;span style="color:#ff79c6">*&lt;/span>conn, &lt;span style="color:#8be9fd">int&lt;/span> flags, &lt;span style="color:#8be9fd">char&lt;/span> &lt;span style="color:#ff79c6">*&lt;/span>ip) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span> &lt;span style="color:#6272a4">//æ£€æŸ¥æœ€å¤§è¿æ¥æ•°
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">if&lt;/span> (&lt;span style="color:#50fa7b">listLength&lt;/span>(server.clients) &lt;span style="color:#ff79c6">+&lt;/span> &lt;span style="color:#50fa7b">getClusterConnectionsCount&lt;/span>()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span> &lt;span style="color:#ff79c6">&amp;gt;=&lt;/span> server.maxclients)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span> &lt;span style="color:#8be9fd">char&lt;/span> &lt;span style="color:#ff79c6">*&lt;/span>err;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (server.cluster_enabled)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span> err &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;-ERR max number of clients + cluster &amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span> &lt;span style="color:#f1fa8c">&amp;#34;connections reached&lt;/span>&lt;span style="color:#f1fa8c">\r\n&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span> &lt;span style="color:#ff79c6">else&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span> err &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;-ERR max number of clients reached&lt;/span>&lt;span style="color:#f1fa8c">\r\n&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span> &lt;span style="color:#6272a4">// è¿”å›å®¢æˆ·ç«¯é”™è¯¯ä¿¡æ¯
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">if&lt;/span> (&lt;span style="color:#50fa7b">connWrite&lt;/span>(conn,err,&lt;span style="color:#50fa7b">strlen&lt;/span>(err)) &lt;span style="color:#ff79c6">==&lt;/span> &lt;span style="color:#ff79c6">-&lt;/span>&lt;span style="color:#bd93f9">1&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span> &lt;span style="color:#6272a4">/* Nothing to do, Just to avoid the warning... */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16&lt;/span>&lt;span> server.stat_rejected_conn&lt;span style="color:#ff79c6">++&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17&lt;/span>&lt;span> &lt;span style="color:#50fa7b">connClose&lt;/span>(conn);&lt;span style="color:#6272a4">//å…³é—­è¿æ¥
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">return&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21&lt;/span>&lt;span> &lt;span style="color:#6272a4">//ä¸ºè¿æ¥åˆ›å»º client ç»“æ„ä½“
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">if&lt;/span> ((c &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#50fa7b">createClient&lt;/span>(conn)) &lt;span style="color:#ff79c6">==&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">NULL&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23&lt;/span>&lt;span> .........
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27&lt;/span>&lt;span> &lt;span style="color:#6272a4">//æœ€ç»ˆä¼šè°ƒç”¨ clientAcceptHandler å‡½æ•°å¤„ç†æ–°è¿æ¥
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">if&lt;/span> (&lt;span style="color:#50fa7b">connAccept&lt;/span>(conn, clientAcceptHandler) &lt;span style="color:#ff79c6">==&lt;/span> C_ERR) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (&lt;span style="color:#50fa7b">connGetState&lt;/span>(conn) &lt;span style="color:#ff79c6">==&lt;/span> CONN_STATE_ERROR)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30&lt;/span>&lt;span> &lt;span style="color:#50fa7b">serverLog&lt;/span>(LL_WARNING,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31&lt;/span>&lt;span> &lt;span style="color:#f1fa8c">&amp;#34;Error accepting a client connection: %s (addr=%s laddr=%s)&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32&lt;/span>&lt;span> &lt;span style="color:#50fa7b">connGetLastError&lt;/span>(conn), &lt;span style="color:#50fa7b">getClientPeerId&lt;/span>(c), &lt;span style="color:#50fa7b">getClientSockname&lt;/span>(c));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33&lt;/span>&lt;span> &lt;span style="color:#50fa7b">freeClient&lt;/span>(&lt;span style="color:#50fa7b">connGetPrivateData&lt;/span>(conn));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>createClient&lt;/code> å‡½æ•°ä¸ºè¿™ä¸ªè¿æ¥åˆ›å»ºä¸€ä¸ª &lt;code>client&lt;/code> ç»“æ„ä½“ï¼Œå¹¶å°†å…¶åˆå§‹åŒ–ã€‚æ¯”è¾ƒé‡è¦çš„ä¸€ç‚¹æ˜¯æŠŠ &lt;code>readQueryFromClient&lt;/code> å‡½æ•°è®¾ç½®ä¸ºè¿™ä¸ªè¿æ¥çš„è¯»å¤„ç†å‡½æ•°ã€‚åç»­å½“è¿™ä¸ªè¿æ¥æœ‰æ•°æ®å¯è¯»æ—¶ï¼Œå°±ä¼šè°ƒç”¨è¿™ä¸ªå‡½æ•°æ¥è¯»å–æ•°æ®ã€‚&lt;/p>
&lt;p>&lt;code>connAccpet&lt;/code> å‡½æ•° ä¼šä½¿ç”¨ &lt;code>conn-&amp;gt;type-&amp;gt;accept&lt;/code> å‡½æ•°æŒ‡é’ˆ(æŒ‡å‘ &lt;code>connSocketAccept&lt;/code>)æ¥å¤„ç†æ–°è¿æ¥ï¼Œæœ€ç»ˆä¼šè°ƒç”¨åˆ° &lt;code>clientAcceptHandler&lt;/code> å‡½æ•°ã€‚&lt;/p>
&lt;p>&lt;code>clientAcceptHandler&lt;/code> ä¼šåšä¸€äº›æ£€æŸ¥ï¼Œæœ€ç»ˆè°ƒç”¨ &lt;code>assignClientToIOThread&lt;/code> å‡½æ•°æŠŠè¿™ä¸ªè¿æ¥åˆ†é…åˆ°æŸä¸ª IO çº¿ç¨‹ä¸­å»å¤„ç†ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#8be9fd">void&lt;/span> &lt;span style="color:#50fa7b">assignClientToIOThread&lt;/span>(client &lt;span style="color:#ff79c6">*&lt;/span>c) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span> &lt;span style="color:#50fa7b">serverAssert&lt;/span>(c&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>tid &lt;span style="color:#ff79c6">==&lt;/span> IOTHREAD_MAIN_THREAD_ID);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span> &lt;span style="color:#6272a4">// æ‰¾åˆ°å½“å‰è¿æ¥æ•°æœ€å°‘çš„ IO çº¿ç¨‹
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#8be9fd">int&lt;/span> min_id &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span> &lt;span style="color:#8be9fd">int&lt;/span> min &lt;span style="color:#ff79c6">=&lt;/span> INT_MAX;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span> &lt;span style="color:#ff79c6">for&lt;/span> (&lt;span style="color:#8be9fd">int&lt;/span> i &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#bd93f9">1&lt;/span>; i &lt;span style="color:#ff79c6">&amp;lt;&lt;/span> server.io_threads_num; i&lt;span style="color:#ff79c6">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (server.io_threads_clients_num[i] &lt;span style="color:#ff79c6">&amp;lt;&lt;/span> min) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span> min &lt;span style="color:#ff79c6">=&lt;/span> server.io_threads_clients_num[i];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span> min_id &lt;span style="color:#ff79c6">=&lt;/span> i;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span> &lt;span style="color:#6272a4">// æŠŠè¿æ¥åˆ†é…åˆ°è¿™ä¸ª IO çº¿ç¨‹ä¸­å»
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> server.io_threads_clients_num[c&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>tid]&lt;span style="color:#ff79c6">--&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15&lt;/span>&lt;span> c&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>tid &lt;span style="color:#ff79c6">=&lt;/span> min_id;&lt;span style="color:#6272a4">//æŠŠclientä¸­tid,ä¹Ÿå°±æ˜¯æ‰€å±IOçº¿ç¨‹idè®¾ç½®ä¸ºå½“å‰IOçº¿ç¨‹id
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> c&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>running_tid &lt;span style="color:#ff79c6">=&lt;/span> min_id;&lt;span style="color:#6272a4">//æŠŠclientä¸­running_tidä¹Ÿè®¾ç½®ä¸ºå½“å‰IOçº¿ç¨‹id
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> server.io_threads_clients_num[min_id]&lt;span style="color:#ff79c6">++&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18&lt;/span>&lt;span> ..........
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19&lt;/span>&lt;span> &lt;span style="color:#6272a4">//socketç±»å‹çš„è¿æ¥ä¸­,è¿™é‡Œä¸ä¼šè°ƒç”¨unbind_event_loopå‡½æ•°
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#50fa7b">connUnbindEventLoop&lt;/span>(c&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>conn);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21&lt;/span>&lt;span> c&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>io_flags &lt;span style="color:#ff79c6">&amp;amp;=&lt;/span> &lt;span style="color:#ff79c6">~&lt;/span>(CLIENT_IO_READ_ENABLED &lt;span style="color:#ff79c6">|&lt;/span> CLIENT_IO_WRITE_ENABLED);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22&lt;/span>&lt;span> &lt;span style="color:#50fa7b">listAddNodeTail&lt;/span>(mainThreadPendingClientsToIOThreads[c&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>tid], c);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>åˆ°è¿™é‡Œï¼Œæ–°è¿æ¥å¤„ç†çš„å·¥ä½œå°±å®Œæˆäº†ï¼Œè¿æ¥å·²ç»åˆ†é…åˆ°æŸä¸ª IO çº¿ç¨‹ä¸­å»å¤„ç†äº†ï¼Œæ¥ä¸‹æ¥å°±çœ‹ IO çº¿ç¨‹æ˜¯å¦‚ä½•å¤„ç†è¿™äº›è¿æ¥çš„ã€‚&lt;/p>
&lt;h2 id="ioçº¿ç¨‹é€»è¾‘">&lt;a href="#io%e7%ba%bf%e7%a8%8b%e9%80%bb%e8%be%91" class="header-anchor">&lt;/a>IOçº¿ç¨‹é€»è¾‘
&lt;/h2>&lt;p>åœ¨è®² IO çº¿ç¨‹é€»è¾‘å‰ï¼Œéœ€è¦å…ˆäº†è§£å‡ ä¸ªé‡è¦çš„æ•°æ®ç»“æ„ï¼š&lt;/p>
&lt;p>é¦–å…ˆæ˜¯ &lt;code>IOThread&lt;/code> ç»“æ„ä½“ï¼Œè¡¨ç¤ºä¸€ä¸ª IO çº¿ç¨‹ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">typedef&lt;/span> &lt;span style="color:#ff79c6">struct&lt;/span> &lt;span style="color:#50fa7b">__attribute__&lt;/span>((&lt;span style="color:#50fa7b">aligned&lt;/span>(CACHE_LINE_SIZE))) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span> &lt;span style="color:#8be9fd">uint8_t&lt;/span> id; &lt;span style="color:#6272a4">// å½“å‰ IO çº¿ç¨‹çš„ ID
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#8be9fd">pthread_t&lt;/span> tid; &lt;span style="color:#6272a4">// æ“ä½œç³»ç»Ÿçº¿ç¨‹ ID
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> redisAtomic &lt;span style="color:#8be9fd">int&lt;/span> paused; &lt;span style="color:#6272a4">// å½“å‰ IO çº¿ç¨‹æ˜¯å¦æš‚åœ
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> redisAtomic &lt;span style="color:#8be9fd">int&lt;/span> running; &lt;span style="color:#6272a4">// å½“å‰ IO çº¿ç¨‹æ˜¯å¦åœ¨è¿è¡Œ
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> aeEventLoop &lt;span style="color:#ff79c6">*&lt;/span>el; &lt;span style="color:#6272a4">// å½“å‰çº¿ç¨‹çš„äº‹ä»¶å¾ªç¯,åœ¨ initThreadedIO ä¸­åˆ›å»ºï¼Œåº•å±‚ä½¿ç”¨ epoll å®ç°
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> list &lt;span style="color:#ff79c6">*&lt;/span>pending_clients; &lt;span style="color:#6272a4">// ç­‰å¾…å¤„ç†çš„å®¢æˆ·ç«¯list
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> list &lt;span style="color:#ff79c6">*&lt;/span>processing_clients; &lt;span style="color:#6272a4">// æ­£åœ¨å¤„ç†çš„å®¢æˆ·ç«¯list
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> eventNotifier &lt;span style="color:#ff79c6">*&lt;/span>pending_clients_notifier; &lt;span style="color:#6272a4">// é€šçŸ¥å™¨ï¼Œç”¨äºé€šçŸ¥ä¸»çº¿ç¨‹æœ‰äº‹ä»¶éœ€è¦å¤„ç†
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#8be9fd">pthread_mutex_t&lt;/span> pending_clients_mutex; &lt;span style="color:#6272a4">// äº’æ–¥é”ï¼Œä¿æŠ¤ pending_clients åˆ—è¡¨
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> list &lt;span style="color:#ff79c6">*&lt;/span>pending_clients_to_main_thread; &lt;span style="color:#6272a4">// ä¸»çº¿ç¨‹åˆ†é…ç»™ IO çº¿ç¨‹çš„å®¢æˆ·ç«¯list
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> list &lt;span style="color:#ff79c6">*&lt;/span>clients; &lt;span style="color:#6272a4">// å½“å‰ IO çº¿ç¨‹ç®¡ç†çš„å®¢æˆ·ç«¯list
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span>} IOThread;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™ä¸ªç»“æ„ä½“åœ¨ &lt;code>initThreadedIO&lt;/code> å‡½æ•°ä¸­åˆ›å»ºï¼Œä¸ºæ¯ä¸ª IO çº¿ç¨‹åˆ›å»ºä¸€ä¸ª &lt;code>IOThread&lt;/code> ç»“æ„ä½“ï¼Œå¹¶åˆå§‹åŒ–ç›¸å…³æ•°æ®ç»“æ„ã€‚&lt;code>el&lt;/code> æ˜¯ IO çº¿ç¨‹çš„äº‹ä»¶å¾ªç¯ï¼Œå’Œ &lt;code>server.el&lt;/code> ä½œç”¨ç±»ä¼¼ï¼Œåªä¸è¿‡æ˜¯æ¯ä¸ª IO çº¿ç¨‹è‡ªå·±çš„äº‹ä»¶å¾ªç¯ï¼Œåœ¨linuxå¹³å°ä¸Šï¼Œåº•å±‚ä½¿ç”¨ epoll å®ç°ã€‚&lt;/p>
&lt;p>ä¸‹é¢æ˜¯ä¸€äº›å…¨å±€å˜é‡ï¼Œä¸»è¦ç”¨äºä¸»çº¿ç¨‹å’Œ IO çº¿ç¨‹ä¹‹é—´çš„é€šä¿¡ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#6272a4">// IO çº¿ç¨‹æ•°ç»„
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span>&lt;span style="color:#ff79c6">static&lt;/span> IOThread IOThreads[IO_THREADS_MAX_NUM];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span>&lt;span style="color:#6272a4">// ä¸»çº¿ç¨‹å’Œ IO çº¿ç¨‹ä¹‹é—´çš„é€šä¿¡æ•°æ®ç»“æ„
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span>&lt;span style="color:#6272a4">// listé“¾è¡¨çš„æ•°ç»„ï¼Œä¸»çº¿ç¨‹å¤„ç†å®Œæˆåè¦äº¤å›ç»™ç›¸åº” IO çº¿ç¨‹ç»§ç»­å¤„ç†çš„å®¢æˆ·ç«¯æ”¾åˆ°è¿™é‡Œ
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span>&lt;span style="color:#ff79c6">static&lt;/span> list &lt;span style="color:#ff79c6">*&lt;/span>mainThreadPendingClientsToIOThreads[IO_THREADS_MAX_NUM];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span>&lt;span style="color:#6272a4">// ä¸»çº¿ç¨‹ä» mainThreadPendingClients æŠŠå¾…å¤„ç†çš„å®¢æˆ·ç«¯æ¬åˆ°è¿™ä¸ªåˆ—è¡¨ï¼Œ
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span>&lt;span style="color:#6272a4">// è¡¨ç¤ºå½“å‰æ­£åœ¨ä¸»çº¿ç¨‹ä¸Šä¸‹æ–‡ä¸­é€ä¸€å¤„ç†çš„å®¢æˆ·ç«¯ï¼ˆé¿å…åœ¨å¤„ç†è¿‡ç¨‹ä¸­è¢«å…¶ä»–çº¿ç¨‹ä¿®æ”¹ï¼‰
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span>&lt;span style="color:#ff79c6">static&lt;/span> list &lt;span style="color:#ff79c6">*&lt;/span>mainThreadProcessingClients[IO_THREADS_MAX_NUM];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span>&lt;span style="color:#6272a4">// ä¸»çº¿ç¨‹ä» IO çº¿ç¨‹æ¥æ”¶å¾…å¤„ç†çš„å®¢æˆ·ç«¯æ”¾åˆ°è¿™é‡Œï¼Œå½“éœ€è¦é€šçŸ¥ä¸»çº¿ç¨‹æœ‰æ¥è‡ªæŸä¸ª IO çº¿ç¨‹çš„æ–°å®¢æˆ·ç«¯å¯å¤„ç†æ—¶ï¼Œ
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span>&lt;span style="color:#6272a4">// IO çº¿ç¨‹ä½¿ç”¨å¯¹åº”çš„ notifier å”¤é†’ä¸»çº¿ç¨‹ï¼›
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span>&lt;span style="color:#ff79c6">static&lt;/span> list &lt;span style="color:#ff79c6">*&lt;/span>mainThreadPendingClients[IO_THREADS_MAX_NUM];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17&lt;/span>&lt;span>&lt;span style="color:#6272a4">// ä¿æŠ¤ mainThreadPendingClients åˆ—è¡¨çš„äº’æ–¥é”æ•°ç»„
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span>&lt;span style="color:#ff79c6">static&lt;/span> &lt;span style="color:#8be9fd">pthread_mutex_t&lt;/span> mainThreadPendingClientsMutexes[IO_THREADS_MAX_NUM];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20&lt;/span>&lt;span>&lt;span style="color:#6272a4">// ç”¨äºé€šçŸ¥ä¸»çº¿ç¨‹æœ‰æ–°å®¢æˆ·ç«¯å¯å¤„ç†çš„é€šçŸ¥å™¨æ•°ç»„
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span>&lt;span style="color:#ff79c6">static&lt;/span> eventNotifier&lt;span style="color:#ff79c6">*&lt;/span> mainThreadPendingClientsNotifiers[IO_THREADS_MAX_NUM];
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>çœ‹ä¸€ä¸‹å¤§æ¦‚çš„ IO çº¿ç¨‹é€»è¾‘æµç¨‹å›¾ï¼š&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/e125e34ed63d56e8276b7bd36452f1830b1a1bb7.svg">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/e125e34ed63d56e8276b7bd36452f1830b1a1bb7.svg" alt="" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>è¿™é‡Œçš„ &lt;code>el&lt;/code> å°±æ˜¯ IO çº¿ç¨‹è‡ªå·±çš„äº‹ä»¶å¾ªç¯ï¼Œåœ¨ &lt;code>initThreadedIO&lt;/code> å‡½æ•°ä¸­åˆ›å»ºå¥½äº†ã€‚&lt;code>pending_clients&lt;/code> åˆ—è¡¨ç”¨äºå­˜æ”¾ä¸»çº¿ç¨‹åˆ†é…ç»™ IO çº¿ç¨‹çš„å¾…å¤„ç†å®¢æˆ·ç«¯ï¼Œ&lt;code>processing_clients&lt;/code> åˆ—è¡¨ç”¨äºå­˜æ”¾å½“å‰æ­£åœ¨å¤„ç†çš„å®¢æˆ·ç«¯ï¼Œ&lt;code>clients&lt;/code> åˆ—è¡¨ç”¨äºå­˜æ”¾å½“å‰ IO çº¿ç¨‹ç®¡ç†çš„æ‰€æœ‰å®¢æˆ·ç«¯ã€‚&lt;/p>
&lt;p>åœ¨ &lt;code>initThreadedIO&lt;/code> å‡½æ•°ä¸­ï¼Œè¿™äº›æ•°æ®ç»“æ„ä¹Ÿéƒ½åˆ›å»ºå¥½äº†ã€‚åŒæ—¶ä¹Ÿä¸ºæ¯ä¸ª IO çº¿ç¨‹åˆ›å»º &lt;code>el&lt;/code>ï¼Œå½“ &lt;code>el&lt;/code> ä¸­æœ‰äº‹ä»¶å‘ç”Ÿæ—¶ï¼Œä¼šè°ƒç”¨ &lt;code>handleClientsFromMainThread&lt;/code> å‡½æ•°æ¥å¤„ç†ã€‚&lt;/p>
&lt;p>æœ€ç»ˆä¼šè°ƒç”¨åˆ° &lt;code>processClientsFromMainThread&lt;/code> å‡½æ•°æ¥å¤„ç†&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#8be9fd">int&lt;/span> &lt;span style="color:#50fa7b">processClientsFromMainThread&lt;/span>(IOThread &lt;span style="color:#ff79c6">*&lt;/span>t) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span> &lt;span style="color:#50fa7b">pthread_mutex_lock&lt;/span>(&lt;span style="color:#ff79c6">&amp;amp;&lt;/span>t&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>pending_clients_mutex);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span> &lt;span style="color:#6272a4">// æŠŠä¸»çº¿ç¨‹åˆ†é…ç»™ IO çº¿ç¨‹çš„å¾…å¤„ç†å®¢æˆ·ç«¯æ¬åˆ° IO çº¿ç¨‹è‡ªå·±çš„å¾…å¤„ç†åˆ—è¡¨ä¸­
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#50fa7b">listJoin&lt;/span>(t&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>processing_clients, t&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>pending_clients);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span> &lt;span style="color:#50fa7b">pthread_mutex_unlock&lt;/span>(&lt;span style="color:#ff79c6">&amp;amp;&lt;/span>t&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>pending_clients_mutex);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span> &lt;span style="color:#8be9fd">size_t&lt;/span> processed &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#50fa7b">listLength&lt;/span>(t&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>processing_clients);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (processed &lt;span style="color:#ff79c6">==&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>) &lt;span style="color:#ff79c6">return&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span> listIter li;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span> listNode &lt;span style="color:#ff79c6">*&lt;/span>ln;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span> &lt;span style="color:#50fa7b">listRewind&lt;/span>(t&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>processing_clients, &lt;span style="color:#ff79c6">&amp;amp;&lt;/span>li);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span> &lt;span style="color:#6272a4">// éå†æ‰€æœ‰å¾…å¤„ç†å®¢æˆ·ç«¯
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">while&lt;/span>((ln &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#50fa7b">listNext&lt;/span>(&lt;span style="color:#ff79c6">&amp;amp;&lt;/span>li))) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span> client &lt;span style="color:#ff79c6">*&lt;/span>c &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#50fa7b">listNodeValue&lt;/span>(ln);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15&lt;/span>&lt;span> ..............
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16&lt;/span>&lt;span> &lt;span style="color:#50fa7b">listUnlinkNode&lt;/span>(t&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>processing_clients, ln);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17&lt;/span>&lt;span> &lt;span style="color:#50fa7b">listLinkNodeTail&lt;/span>(t&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>clients, ln);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18&lt;/span>&lt;span> c&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>io_thread_client_list_node &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#50fa7b">listLast&lt;/span>(t&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>clients);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19&lt;/span>&lt;span> &lt;span style="color:#6272a4">// å¦‚æœè¿æ¥æ²¡æœ‰ç»‘å®šäº‹ä»¶å¾ªç¯(ç¬¬ä¸€æ¬¡)ï¼Œå°±ç»‘å®šåˆ°å½“å‰ IO çº¿ç¨‹çš„äº‹ä»¶å¾ªç¯ä¸­,
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#6272a4">// å¹¶è®¾ç½®è¯»å¤„ç†å‡½æ•°ä¸º readQueryFromClient
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">if&lt;/span> (&lt;span style="color:#ff79c6">!&lt;/span>&lt;span style="color:#50fa7b">connHasEventLoop&lt;/span>(c&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>conn)) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22&lt;/span>&lt;span> &lt;span style="color:#50fa7b">connRebindEventLoop&lt;/span>(c&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>conn, t&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>el);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23&lt;/span>&lt;span> &lt;span style="color:#50fa7b">serverAssert&lt;/span>(&lt;span style="color:#ff79c6">!&lt;/span>&lt;span style="color:#50fa7b">connHasReadHandler&lt;/span>(c&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>conn));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24&lt;/span>&lt;span> &lt;span style="color:#50fa7b">connSetReadHandler&lt;/span>(c&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>conn, readQueryFromClient);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27&lt;/span>&lt;span> &lt;span style="color:#6272a4">// å¦‚æœè¿æ¥æœ‰æœªå¤„ç†çš„å›å¤æ•°æ®ï¼Œå°±å…ˆå†™æ•°æ®ç»™å®¢æˆ·ç«¯
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">if&lt;/span> (&lt;span style="color:#50fa7b">clientHasPendingReplies&lt;/span>(c)) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29&lt;/span>&lt;span> &lt;span style="color:#50fa7b">writeToClient&lt;/span>(c, &lt;span style="color:#bd93f9">0&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (&lt;span style="color:#ff79c6">!&lt;/span>(c&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>io_flags &lt;span style="color:#ff79c6">&amp;amp;&lt;/span> CLIENT_IO_CLOSE_ASAP) &lt;span style="color:#ff79c6">&amp;amp;&amp;amp;&lt;/span> &lt;span style="color:#50fa7b">clientHasPendingReplies&lt;/span>(c)) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31&lt;/span>&lt;span> &lt;span style="color:#50fa7b">connSetWriteHandler&lt;/span>(c&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>conn, sendReplyToClient);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35&lt;/span>&lt;span> &lt;span style="color:#50fa7b">serverAssert&lt;/span>(&lt;span style="color:#50fa7b">listLength&lt;/span>(t&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>processing_clients) &lt;span style="color:#ff79c6">==&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> processed;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>åœ¨è¿™ä¸ªå‡½æ•°ä¸­ï¼ŒIO çº¿ç¨‹ä¼šå¤„ç†ä¸»çº¿ç¨‹åˆ†é…ç»™å®ƒçš„å¾…å¤„ç†å®¢æˆ·ç«¯ã€‚ä¸»è¦åšäº†ä»¥ä¸‹å‡ ä»¶äº‹ï¼š&lt;/p>
&lt;ol>
&lt;li>æŠŠä¸»çº¿ç¨‹åˆ†é…ç»™ IO çº¿ç¨‹çš„å¾…å¤„ç†å®¢æˆ·ç«¯æ¬åˆ° IO çº¿ç¨‹è‡ªå·±çš„å¾…å¤„ç†åˆ—è¡¨ä¸­ã€‚&lt;/li>
&lt;li>éå†æ‰€æœ‰å¾…å¤„ç†å®¢æˆ·ç«¯ï¼Œå¦‚æœè¿æ¥æ²¡æœ‰ç»‘å®šäº‹ä»¶å¾ªç¯(ç¬¬ä¸€æ¬¡)ï¼Œå°±ç»‘å®šåˆ°å½“å‰ IO çº¿ç¨‹çš„äº‹ä»¶å¾ªç¯ä¸­ï¼Œå¹¶è®¾ç½®è¯»å¤„ç†å‡½æ•°ä¸º &lt;code>readQueryFromClient&lt;/code>ã€‚&lt;/li>
&lt;li>å¦‚æœè¿æ¥æœ‰æœªå¤„ç†çš„å›å¤æ•°æ®ï¼Œå°±å…ˆå†™æ•°æ®ç»™å®¢æˆ·ç«¯ã€‚&lt;/li>
&lt;li>æœ€åæŠŠå®¢æˆ·ç«¯ä»å¾…å¤„ç†åˆ—è¡¨ä¸­ç§»é™¤ï¼ŒåŠ å…¥åˆ° IO çº¿ç¨‹ç®¡ç†çš„å®¢æˆ·ç«¯åˆ—è¡¨ä¸­ã€‚&lt;/li>
&lt;/ol>
&lt;p>&lt;code>IOThreadBeforeSleep&lt;/code> å‡½æ•° åœ¨ IO çº¿ç¨‹äº‹ä»¶å¾ªç¯ç¡çœ å‰è°ƒç”¨ï¼Œä¸»è¦æ˜¯å¤„ç†ä¸€äº›å¾…å¤„ç†çš„å®¢æˆ·ç«¯ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#8be9fd">void&lt;/span> &lt;span style="color:#50fa7b">IOThreadBeforeSleep&lt;/span>(&lt;span style="color:#ff79c6">struct&lt;/span> aeEventLoop &lt;span style="color:#ff79c6">*&lt;/span>el) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span> IOThread &lt;span style="color:#ff79c6">*&lt;/span>t &lt;span style="color:#ff79c6">=&lt;/span> el&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>privdata[&lt;span style="color:#bd93f9">0&lt;/span>];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span> &lt;span style="color:#6272a4">//socketç±»å‹çš„è¿æ¥ä¸­,è¿™é‡Œä¸ä¼šè°ƒç”¨processPendingDataå‡½æ•°
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#50fa7b">connTypeProcessPendingData&lt;/span>(el);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span> &lt;span style="color:#6272a4">// æ£€æŸ¥å½“å‰æ˜¯å¦æœ‰å¾…å¤„ç†çš„æ•°æ®,å¦‚æœæœ‰ï¼Œå°±ä¸è®©äº‹ä»¶å¾ªç¯ç¡çœ 
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#8be9fd">int&lt;/span> dont_sleep &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#50fa7b">connTypeHasPendingData&lt;/span>(el);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span> &lt;span style="color:#6272a4">// è°ƒç”¨ processClientsFromMainThread å¤„ç†ä¸»çº¿ç¨‹åˆ†é…ç»™ IO çº¿ç¨‹çš„å¾…å¤„ç†å®¢æˆ·ç«¯
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">if&lt;/span> (&lt;span style="color:#50fa7b">processClientsFromMainThread&lt;/span>(t) &lt;span style="color:#ff79c6">&amp;gt;&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span> dont_sleep &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#bd93f9">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (&lt;span style="color:#ff79c6">!&lt;/span>dont_sleep) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span> &lt;span style="color:#50fa7b">atomicSetWithSync&lt;/span>(t&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>running, &lt;span style="color:#bd93f9">0&lt;/span>);&lt;span style="color:#6272a4">//æ ‡è®°å½“å‰ IO çº¿ç¨‹ä¸åœ¨è¿è¡ŒçŠ¶æ€
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#6272a4">// å†æ¬¡è°ƒç”¨ processClientsFromMainThread å¤„ç†ä¸»çº¿ç¨‹åˆ†é…ç»™ IO çº¿ç¨‹çš„å¾…å¤„ç†å®¢æˆ·ç«¯
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#50fa7b">processClientsFromMainThread&lt;/span>(t);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18&lt;/span>&lt;span> &lt;span style="color:#50fa7b">aeSetDontWait&lt;/span>(t&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>el, dont_sleep);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20&lt;/span>&lt;span> &lt;span style="color:#6272a4">/* Check if i am being paused, pause myself and resume. */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21&lt;/span>&lt;span> &lt;span style="color:#50fa7b">handlePauseAndResume&lt;/span>(t);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22&lt;/span>&lt;span> &lt;span style="color:#6272a4">// åœ¨sleepä¹‹å‰ï¼Œé€šçŸ¥ä¸»çº¿ç¨‹å¤„ç†ä» IO çº¿ç¨‹è¯»å–å®Œæ•°æ®çš„å®¢æˆ·ç«¯
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#50fa7b">sendPendingClientsToMainThreadIfNeeded&lt;/span>(t, &lt;span style="color:#bd93f9">0&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>åœ¨è¿™ä¸ªå‡½æ•°ä¸­ï¼ŒIO çº¿ç¨‹ä¼šå¤„ç†ä¸€äº›å¾…å¤„ç†çš„å®¢æˆ·ç«¯ï¼Œä¸»è¦åšäº†ä»¥ä¸‹å‡ ä»¶äº‹ï¼š&lt;/p>
&lt;ol>
&lt;li>æ£€æŸ¥å½“å‰æ˜¯å¦æœ‰å¾…å¤„ç†çš„æ•°æ®,å¦‚æœæœ‰ï¼Œå°±ä¸è®©äº‹ä»¶å¾ªç¯ç¡çœ ã€‚&lt;/li>
&lt;li>è°ƒç”¨ &lt;code>processClientsFromMainThread&lt;/code> å¤„ç†ä¸»çº¿ç¨‹åˆ†é…ç»™ IO çº¿ç¨‹çš„å¾…å¤„ç†å®¢æˆ·ç«¯ã€‚&lt;/li>
&lt;li>å¦‚æœæ²¡æœ‰å¾…å¤„ç†çš„æ•°æ®ï¼Œå°±æ ‡è®°å½“å‰ IO çº¿ç¨‹ä¸åœ¨è¿è¡ŒçŠ¶æ€ã€‚&lt;/li>
&lt;li>å†æ¬¡è°ƒç”¨ &lt;code>processClientsFromMainThread&lt;/code> å¤„ç†ä¸»çº¿ç¨‹åˆ†é…ç»™ IO çº¿ç¨‹çš„å¾…å¤„ç†å®¢æˆ·ç«¯ã€‚&lt;/li>
&lt;li>åœ¨ sleep ä¹‹å‰ï¼Œé€šçŸ¥ä¸»çº¿ç¨‹å¤„ç†ä» IO çº¿ç¨‹è¯»å–å®Œæ•°æ®çš„å®¢æˆ·ç«¯ã€‚&lt;/li>
&lt;/ol>
&lt;p>&lt;code>IOThreadAfterSleep&lt;/code> å‡½æ•° åœ¨ IO çº¿ç¨‹äº‹ä»¶å¾ªç¯ç¡çœ åè°ƒç”¨ï¼Œä¸»è¦æ˜¯æ ‡è®°å½“å‰ IO çº¿ç¨‹åœ¨è¿è¡ŒçŠ¶æ€ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>&lt;span style="color:#8be9fd">void&lt;/span> &lt;span style="color:#50fa7b">IOThreadAfterSleep&lt;/span>(&lt;span style="color:#ff79c6">struct&lt;/span> aeEventLoop &lt;span style="color:#ff79c6">*&lt;/span>el) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span> IOThread &lt;span style="color:#ff79c6">*&lt;/span>t &lt;span style="color:#ff79c6">=&lt;/span> el&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>privdata[&lt;span style="color:#bd93f9">0&lt;/span>];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3&lt;/span>&lt;span> &lt;span style="color:#50fa7b">atomicSetWithSync&lt;/span>(t&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>running, &lt;span style="color:#bd93f9">1&lt;/span>);&lt;span style="color:#6272a4">//æ ‡è®°å½“å‰ IO çº¿ç¨‹åœ¨è¿è¡ŒçŠ¶æ€
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æ•´ä¸ª IO çº¿ç¨‹é€»è¾‘ä¸»è¦å°±æ˜¯é€šè¿‡äº‹ä»¶å¾ªç¯æ¥å¤„ç†ä¸»çº¿ç¨‹åˆ†é…ç»™å®ƒçš„å¾…å¤„ç†å®¢æˆ·ç«¯ï¼Œå¹¶åœ¨ sleep å‰é€šçŸ¥ä¸»çº¿ç¨‹å¤„ç†ä» IO çº¿ç¨‹è¯»å–å®Œæ•°æ®çš„å®¢æˆ·ç«¯ã€‚&lt;/p>
&lt;h2 id="ä¸»çº¿ç¨‹é€»è¾‘">&lt;a href="#%e4%b8%bb%e7%ba%bf%e7%a8%8b%e9%80%bb%e8%be%91" class="header-anchor">&lt;/a>ä¸»çº¿ç¨‹é€»è¾‘
&lt;/h2>&lt;p>å…ˆæ¥çœ‹ä¸€ä¸‹ä¸»çº¿ç¨‹é€»è¾‘çš„å¤§æ¦‚æµç¨‹å›¾ï¼š&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/b5a700c5fe04b0d8819c2abf3dc87b9706a64884.svg">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/b5a700c5fe04b0d8819c2abf3dc87b9706a64884.svg" alt="" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>ç›¸æ¯”ä¹‹ä¸‹ï¼Œä¸»çº¿ç¨‹åšçš„å·¥ä½œæ›´å¤šä¸€äº›ï¼Œè¿™é‡Œåªä»‹ç»å‘½ä»¤å¤„ç†çš„ç›¸å…³é€»è¾‘ï¼Œå…¶ä»–çš„é€»è¾‘å°±ä¸å±•å¼€åˆ†æäº†ã€‚&lt;/p>
&lt;p>ä¸»çº¿ç¨‹çš„äº‹ä»¶å¾ªç¯æ˜¯ &lt;code>server.el&lt;/code>ï¼Œåœ¨ &lt;code>initServer&lt;/code> å‡½æ•°ä¸­åˆ›å»ºå¥½äº†ã€‚å½“ &lt;code>server.el&lt;/code> ä¸­æœ‰äº‹ä»¶å‘ç”Ÿæ—¶ï¼Œä¼šè°ƒç”¨ &lt;code>handleClientsFromIOThread&lt;/code> å‡½æ•°æ¥å¤„ç†ï¼Œç„¶åè°ƒç”¨ &lt;code>processClientsFromIOThread&lt;/code> å‡½æ•°æ¥å¤„ç†ä» IO çº¿ç¨‹è¯»å–å®Œæ•°æ®çš„å®¢æˆ·ç«¯ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#8be9fd">int&lt;/span> &lt;span style="color:#50fa7b">processClientsFromIOThread&lt;/span>(IOThread &lt;span style="color:#ff79c6">*&lt;/span>t) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span> &lt;span style="color:#6272a4">/* Get the list of clients to process. */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span> &lt;span style="color:#50fa7b">pthread_mutex_lock&lt;/span>(&lt;span style="color:#ff79c6">&amp;amp;&lt;/span>mainThreadPendingClientsMutexes[t&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>id]);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span> &lt;span style="color:#6272a4">// æŠŠä» IO çº¿ç¨‹è¯»å–å®Œæ•°æ®çš„å®¢æˆ·ç«¯æ¬åˆ°ä¸»çº¿ç¨‹è‡ªå·±çš„å¾…å¤„ç†åˆ—è¡¨ä¸­
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#50fa7b">listJoin&lt;/span>(mainThreadProcessingClients[t&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>id], mainThreadPendingClients[t&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>id]);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span> &lt;span style="color:#50fa7b">pthread_mutex_unlock&lt;/span>(&lt;span style="color:#ff79c6">&amp;amp;&lt;/span>mainThreadPendingClientsMutexes[t&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>id]);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span> &lt;span style="color:#8be9fd">size_t&lt;/span> processed &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#50fa7b">listLength&lt;/span>(mainThreadProcessingClients[t&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>id]);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (processed &lt;span style="color:#ff79c6">==&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>) &lt;span style="color:#ff79c6">return&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span> &lt;span style="color:#8be9fd">int&lt;/span> prefetch_clients &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span> &lt;span style="color:#50fa7b">resetCommandsBatch&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span> listNode &lt;span style="color:#ff79c6">*&lt;/span>node &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">NULL&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span> &lt;span style="color:#ff79c6">while&lt;/span> (&lt;span style="color:#50fa7b">listLength&lt;/span>(mainThreadProcessingClients[t&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>id])) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15&lt;/span>&lt;span> &lt;span style="color:#6272a4">// å¦‚æœæ²¡æœ‰é¢„å–çš„å®¢æˆ·ç«¯ï¼Œå°±é¢„å–ä¸€æ‰¹å®¢æˆ·ç«¯
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">if&lt;/span> (prefetch_clients &lt;span style="color:#ff79c6">&amp;lt;=&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>) prefetch_clients &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#50fa7b">prefetchIOThreadCommands&lt;/span>(t);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17&lt;/span>&lt;span> &lt;span style="color:#6272a4">// æ¯å¤„ç†å®Œä¸€ä¸ªå®¢æˆ·ç«¯ï¼Œå°±å‡å°‘é¢„å–çš„å®¢æˆ·ç«¯æ•°é‡
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">if&lt;/span> (&lt;span style="color:#ff79c6">--&lt;/span>prefetch_clients &lt;span style="color:#ff79c6">&amp;lt;=&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>) &lt;span style="color:#50fa7b">resetCommandsBatch&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20&lt;/span>&lt;span> &lt;span style="color:#6272a4">// å–å‡ºä¸€ä¸ªå®¢æˆ·ç«¯è¿›è¡Œå¤„ç†
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">if&lt;/span> (node) &lt;span style="color:#50fa7b">zfree&lt;/span>(node);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22&lt;/span>&lt;span> node &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#50fa7b">listFirst&lt;/span>(mainThreadProcessingClients[t&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>id]);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23&lt;/span>&lt;span> &lt;span style="color:#50fa7b">listUnlinkNode&lt;/span>(mainThreadProcessingClients[t&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>id], node);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24&lt;/span>&lt;span> client &lt;span style="color:#ff79c6">*&lt;/span>c &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#50fa7b">listNodeValue&lt;/span>(node);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25&lt;/span>&lt;span> ................
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26&lt;/span>&lt;span> &lt;span style="color:#6272a4">// æŠŠclientçš„running_tidè®¾ç½®ä¸ºä¸»çº¿ç¨‹id
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> c&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>running_tid &lt;span style="color:#ff79c6">=&lt;/span> IOTHREAD_MAIN_THREAD_ID;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (c&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>read_error) &lt;span style="color:#50fa7b">handleClientReadError&lt;/span>(c);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30&lt;/span>&lt;span> &lt;span style="color:#6272a4">// å¦‚æœå®¢æˆ·ç«¯è¢«æ ‡è®°ä¸ºå…³é—­ï¼Œå°±é‡Šæ”¾å®¢æˆ·ç«¯
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">if&lt;/span> (c&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>io_flags &lt;span style="color:#ff79c6">&amp;amp;&lt;/span> CLIENT_IO_CLOSE_ASAP) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32&lt;/span>&lt;span> &lt;span style="color:#50fa7b">freeClient&lt;/span>(c);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33&lt;/span>&lt;span> &lt;span style="color:#ff79c6">continue&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36&lt;/span>&lt;span> &lt;span style="color:#6272a4">// å¤„ç†å®šæ—¶ä»»åŠ¡
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">if&lt;/span> (c&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>last_cron_check_time &lt;span style="color:#ff79c6">+&lt;/span> &lt;span style="color:#bd93f9">1000&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;=&lt;/span> server.mstime &lt;span style="color:#ff79c6">||&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38&lt;/span>&lt;span> c&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>io_flags &lt;span style="color:#ff79c6">&amp;amp;&lt;/span> CLIENT_IO_PENDING_CRON)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39&lt;/span>&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40&lt;/span>&lt;span> c&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>last_cron_check_time &lt;span style="color:#ff79c6">=&lt;/span> server.mstime;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (&lt;span style="color:#50fa7b">clientsCronRunClient&lt;/span>(c)) &lt;span style="color:#ff79c6">continue&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42&lt;/span>&lt;span> } &lt;span style="color:#ff79c6">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43&lt;/span>&lt;span> &lt;span style="color:#6272a4">// æ›´æ–°å®¢æˆ·ç«¯å†…å­˜ä½¿ç”¨æƒ…å†µ
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#50fa7b">updateClientMemUsageAndBucket&lt;/span>(c);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (&lt;span style="color:#ff79c6">!&lt;/span>c&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>read_error &lt;span style="color:#ff79c6">&amp;amp;&amp;amp;&lt;/span> c&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>io_flags &lt;span style="color:#ff79c6">&amp;amp;&lt;/span> CLIENT_IO_PENDING_COMMAND) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48&lt;/span>&lt;span> c&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>flags &lt;span style="color:#ff79c6">|=&lt;/span> CLIENT_PENDING_COMMAND;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49&lt;/span>&lt;span> &lt;span style="color:#6272a4">// å¤„ç†æŒ‚èµ·çš„å‘½ä»¤å’Œè¯»å–ç¼“å†²åŒº
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">if&lt;/span> (&lt;span style="color:#50fa7b">processPendingCommandAndInputBuffer&lt;/span>(c) &lt;span style="color:#ff79c6">==&lt;/span> C_ERR) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">51&lt;/span>&lt;span> &lt;span style="color:#6272a4">// å¦‚æœå¤„ç†å‘½ä»¤å¤±è´¥,è·³è¿‡è¯¥å®¢æˆ·ç«¯
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">52&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">continue&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">53&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">54&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">55&lt;/span>&lt;span> &lt;span style="color:#6272a4">// å¦‚æœå®¢æˆ·ç«¯æœ‰æœªå¤„ç†çš„å›å¤æ•°æ®ï¼Œå°±æŠŠå®¢æˆ·ç«¯æ”¾åˆ°å¾…å†™é˜Ÿåˆ—ä¸­
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">56&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">if&lt;/span> (&lt;span style="color:#ff79c6">!&lt;/span>(c&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>flags &lt;span style="color:#ff79c6">&amp;amp;&lt;/span> CLIENT_PENDING_WRITE) &lt;span style="color:#ff79c6">&amp;amp;&amp;amp;&lt;/span> &lt;span style="color:#50fa7b">clientHasPendingReplies&lt;/span>(c))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">57&lt;/span>&lt;span> &lt;span style="color:#50fa7b">putClientInPendingWriteQueue&lt;/span>(c);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">58&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">59&lt;/span>&lt;span> &lt;span style="color:#6272a4">// å¦‚æœå®¢æˆ·ç«¯å¿…é¡»åœ¨ä¸»çº¿ç¨‹å¤„ç†ï¼Œå°±æŠŠå®¢æˆ·ç«¯ä¿ç•™åœ¨ä¸»çº¿ç¨‹ä¸­
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">60&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#6272a4">/*CLIENT_CLOSE_ASAP | CLIENT_MASTER | CLIENT_SLAVE |
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">61&lt;/span>&lt;span>&lt;span style="color:#6272a4"> CLIENT_PUBSUB | CLIENT_MONITOR | CLIENT_BLOCKED |
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">62&lt;/span>&lt;span>&lt;span style="color:#6272a4"> CLIENT_UNBLOCKED | CLIENT_TRACKING | CLIENT_LUA_DEBUG |
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">63&lt;/span>&lt;span>&lt;span style="color:#6272a4"> CLIENT_LUA_DEBUG_SYNC)*/&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">64&lt;/span>&lt;span> &lt;span style="color:#6272a4">// è¿™äº›ç±»å‹çš„å®¢æˆ·ç«¯å¿…é¡»åœ¨ä¸»çº¿ç¨‹å¤„ç†
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">65&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">if&lt;/span> (&lt;span style="color:#50fa7b">isClientMustHandledByMainThread&lt;/span>(c)) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">66&lt;/span>&lt;span> &lt;span style="color:#50fa7b">keepClientInMainThread&lt;/span>(c);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">67&lt;/span>&lt;span> &lt;span style="color:#ff79c6">continue&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">68&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">69&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">70&lt;/span>&lt;span> &lt;span style="color:#6272a4">// æŠŠclientä»ä¸»çº¿ç¨‹å¾…å¤„ç†åˆ—è¡¨ä¸­ç§»é™¤(æœ‰äº›clientå¯èƒ½æ²¡æœ‰å›å¤æ•°æ®éœ€è¦å†™)
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">71&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">if&lt;/span> (c&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>flags &lt;span style="color:#ff79c6">&amp;amp;&lt;/span> CLIENT_PENDING_WRITE) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">72&lt;/span>&lt;span> c&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>flags &lt;span style="color:#ff79c6">&amp;amp;=&lt;/span> &lt;span style="color:#ff79c6">~&lt;/span>CLIENT_PENDING_WRITE;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">73&lt;/span>&lt;span> &lt;span style="color:#50fa7b">listUnlinkNode&lt;/span>(server.clients_pending_write, &lt;span style="color:#ff79c6">&amp;amp;&lt;/span>c&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>clients_pending_write_node);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">74&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">75&lt;/span>&lt;span> &lt;span style="color:#6272a4">//åˆ°è¿™,ä¸»çº¿ç¨‹å¯¹è¿™ä¸ªclientçš„å¤„ç†å°±å®Œæˆäº†,æŠŠclientå‘é€å›å¯¹åº”çš„IOçº¿ç¨‹ç»§ç»­å¤„ç†
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">76&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> c&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>running_tid &lt;span style="color:#ff79c6">=&lt;/span> c&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>tid;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">77&lt;/span>&lt;span> &lt;span style="color:#50fa7b">listLinkNodeHead&lt;/span>(mainThreadPendingClientsToIOThreads[c&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>tid], node);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">78&lt;/span>&lt;span> node &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">NULL&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">79&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">80&lt;/span>&lt;span> &lt;span style="color:#6272a4">// ä¸»çº¿ç¨‹å¤„ç†äº†ä¸€å®šæ•°é‡çš„å®¢æˆ·ç«¯ï¼Œå°±æŠŠè¿™äº›å®¢æˆ·ç«¯å‘é€å›å¯¹åº”çš„ IO çº¿ç¨‹ç»§ç»­å¤„ç†
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">81&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#50fa7b">sendPendingClientsToIOThreadIfNeeded&lt;/span>(t, &lt;span style="color:#bd93f9">1&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">82&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">83&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (node) &lt;span style="color:#50fa7b">zfree&lt;/span>(node);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">84&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">85&lt;/span>&lt;span> &lt;span style="color:#6272a4">// å¤„ç†å®Œæ‰€æœ‰å®¢æˆ·ç«¯åï¼Œå†æŠŠå‰©ä½™çš„å®¢æˆ·ç«¯å‘é€å›å¯¹åº”çš„ IO çº¿ç¨‹ç»§ç»­å¤„ç†
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">86&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#50fa7b">sendPendingClientsToIOThreadIfNeeded&lt;/span>(t, &lt;span style="color:#bd93f9">0&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">87&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">88&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> processed;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">89&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>processPendingCommandAndInputBuffer&lt;/code> å‡½æ•° ä¸»è¦æ˜¯å¤„ç†å®¢æˆ·ç«¯çš„æŒ‚èµ·å‘½ä»¤å’Œè¯»å–ç¼“å†²åŒºã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#8be9fd">int&lt;/span> &lt;span style="color:#50fa7b">processPendingCommandAndInputBuffer&lt;/span>(client &lt;span style="color:#ff79c6">*&lt;/span>c) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span> &lt;span style="color:#6272a4">// å¦‚æœå½“å‰clientçš„æ•°æ®å·²ç»å‡†å¤‡å¥½ï¼Œå¯ä»¥å¤„ç†æŒ‚èµ·çš„å‘½ä»¤
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">if&lt;/span> (c&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>flags &lt;span style="color:#ff79c6">&amp;amp;&lt;/span> CLIENT_PENDING_COMMAND) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span> c&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>flags &lt;span style="color:#ff79c6">&amp;amp;=&lt;/span> &lt;span style="color:#ff79c6">~&lt;/span>CLIENT_PENDING_COMMAND;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (&lt;span style="color:#50fa7b">processCommandAndResetClient&lt;/span>(c) &lt;span style="color:#ff79c6">==&lt;/span> C_ERR) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> C_ERR;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span> &lt;span style="color:#6272a4">// ç»§ç»­ä»ç½‘ç»œä¸­è¯»å–æ•°æ®,è§£æ resp åè®®
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">if&lt;/span> (c&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>querybuf &lt;span style="color:#ff79c6">&amp;amp;&amp;amp;&lt;/span> &lt;span style="color:#50fa7b">sdslen&lt;/span>(c&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>querybuf) &lt;span style="color:#ff79c6">&amp;gt;&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> &lt;span style="color:#50fa7b">processInputBuffer&lt;/span>(c);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> C_OK;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>processCommandAndResetClient&lt;/code> å‡½æ•° ä¸»è¦æ˜¯å¤„ç†å®¢æˆ·ç«¯çš„å‘½ä»¤ã€‚æœ€åä¼šè°ƒç”¨ &lt;code>processCommand&lt;/code> å‡½æ•°æ¥å¤„ç†è¿™ä¸ª client çš„å‘½ä»¤ã€‚æœ€ç»ˆä¼šè°ƒç”¨åˆ° &lt;code>client&lt;/code> çš„ &lt;code>proc&lt;/code> å‡½æ•°æ¥æ‰§è¡Œå…·ä½“çš„å‘½ä»¤å¤„ç†å‡½æ•°ã€‚&lt;/p>
&lt;p>åœ¨è¿™ä¸ªå‡½æ•°ä¸­ï¼Œä¸»çº¿ç¨‹ä¼šå¤„ç†ä» IO çº¿ç¨‹è¯»å–å®Œæ•°æ®çš„å®¢æˆ·ç«¯ã€‚ä¸»è¦åšäº†ä»¥ä¸‹å‡ ä»¶äº‹ï¼š&lt;/p>
&lt;ol>
&lt;li>æŠŠä» IO çº¿ç¨‹è¯»å–å®Œæ•°æ®çš„å®¢æˆ·ç«¯æ¬åˆ°ä¸»çº¿ç¨‹è‡ªå·±çš„å¾…å¤„ç†åˆ—è¡¨ä¸­ã€‚&lt;/li>
&lt;li>éå†æ‰€æœ‰å¾…å¤„ç†å®¢æˆ·ç«¯ï¼Œå¤„ç†æ¯ä¸ªå®¢æˆ·ç«¯çš„å‘½ä»¤ã€‚&lt;/li>
&lt;li>å¦‚æœå®¢æˆ·ç«¯è¢«æ ‡è®°ä¸ºå…³é—­ï¼Œå°±é‡Šæ”¾å®¢æˆ·ç«¯ã€‚&lt;/li>
&lt;li>å¤„ç†å®šæ—¶ä»»åŠ¡ã€‚&lt;/li>
&lt;li>å¤„ç†æŒ‚èµ·çš„å‘½ä»¤å’Œè¯»å–ç¼“å†²åŒºã€‚&lt;/li>
&lt;li>å¦‚æœå®¢æˆ·ç«¯æœ‰æœªå¤„ç†çš„å›å¤æ•°æ®ï¼Œå°±æŠŠå®¢æˆ·ç«¯æ”¾åˆ°å¾…å†™é˜Ÿåˆ—ä¸­ã€‚&lt;/li>
&lt;li>å¦‚æœå®¢æˆ·ç«¯å¿…é¡»åœ¨ä¸»çº¿ç¨‹å¤„ç†ï¼Œå°±æŠŠå®¢æˆ·ç«¯ä¿ç•™åœ¨ä¸»çº¿ç¨‹ä¸­ã€‚&lt;/li>
&lt;li>æŠŠå®¢æˆ·ç«¯å‘é€å›å¯¹åº”çš„ IO çº¿ç¨‹ç»§ç»­å¤„ç†ã€‚&lt;/li>
&lt;/ol>
&lt;p>åˆ°è¿™é‡Œï¼Œä¸»çº¿ç¨‹é€»è¾‘çš„å·¥ä½œå°±å®Œæˆäº†ï¼Œä¸»çº¿ç¨‹å·²ç»å¤„ç†å®Œä» IO çº¿ç¨‹è¯»å–å®Œæ•°æ®çš„å®¢æˆ·ç«¯ï¼Œå¹¶æŠŠè¿™äº›å®¢æˆ·ç«¯å‘é€å›å¯¹åº”çš„ IO çº¿ç¨‹ç»§ç»­å¤„ç†äº†ã€‚&lt;/p>
&lt;h2 id="æ•°æ®è¯»å†™">&lt;a href="#%e6%95%b0%e6%8d%ae%e8%af%bb%e5%86%99" class="header-anchor">&lt;/a>æ•°æ®è¯»å†™
&lt;/h2>&lt;h3 id="æ•°æ®è¯»å–">&lt;a href="#%e6%95%b0%e6%8d%ae%e8%af%bb%e5%8f%96" class="header-anchor">&lt;/a>æ•°æ®è¯»å–
&lt;/h3>&lt;p>å…ˆæ¥çœ‹ä¸€ä¸‹æ•°æ®è¯»å–çš„å¤§æ¦‚æµç¨‹å›¾ï¼š&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/420d29e3b6fb9508a22f7ba3c85c514d4e5f0ed6.svg">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/420d29e3b6fb9508a22f7ba3c85c514d4e5f0ed6.svg" alt="" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>è¿æ¥ (conn) è¢«åˆ†é…åˆ° IO çº¿ç¨‹åï¼Œæœ€ç»ˆä¼šæŠŠ conn æ”¾åˆ° IOçº¿ç¨‹çš„ &lt;code>el&lt;/code> ä¸­ç®¡ç†ï¼Œå¹¶è®¾ç½®è¯»å¤„ç†å‡½æ•°ä¸º &lt;code>readQueryFromClient&lt;/code>ã€‚&lt;/p>
&lt;p>å½“æœ‰æ•°æ®å¯è¯»æ—¶ï¼ŒIO çº¿ç¨‹çš„äº‹ä»¶å¾ªç¯ä¼šè°ƒç”¨ &lt;code>readQueryFromClient&lt;/code> å‡½æ•°æ¥è¯»å–æ•°æ®ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#8be9fd">void&lt;/span> &lt;span style="color:#50fa7b">readQueryFromClient&lt;/span>(connection &lt;span style="color:#ff79c6">*&lt;/span>conn) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span> client &lt;span style="color:#ff79c6">*&lt;/span>c &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#50fa7b">connGetPrivateData&lt;/span>(conn);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span> ..................
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span> &lt;span style="color:#6272a4">// æœ€ç»ˆä¼šè°ƒç”¨åˆ°ä¸‹é¢çš„ä»£ç  ä» ç½‘ç»œä¸­è¯»å–æ•°æ®
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> nread &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#50fa7b">connRead&lt;/span>(c&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>conn, c&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>querybuf&lt;span style="color:#ff79c6">+&lt;/span>qblen, readlen);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (nread &lt;span style="color:#ff79c6">==&lt;/span> &lt;span style="color:#ff79c6">-&lt;/span>&lt;span style="color:#bd93f9">1&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (&lt;span style="color:#50fa7b">connGetState&lt;/span>(conn) &lt;span style="color:#ff79c6">==&lt;/span> CONN_STATE_CONNECTED) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span> &lt;span style="color:#ff79c6">goto&lt;/span> done;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span> } &lt;span style="color:#ff79c6">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span> c&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>read_error &lt;span style="color:#ff79c6">=&lt;/span> CLIENT_READ_CONN_DISCONNECTED;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span> &lt;span style="color:#50fa7b">freeClientAsync&lt;/span>(c);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span> &lt;span style="color:#ff79c6">goto&lt;/span> done;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span> } &lt;span style="color:#ff79c6">else&lt;/span> &lt;span style="color:#ff79c6">if&lt;/span> (nread &lt;span style="color:#ff79c6">==&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15&lt;/span>&lt;span> c&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>read_error &lt;span style="color:#ff79c6">=&lt;/span> CLIENT_READ_CONN_CLOSED;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16&lt;/span>&lt;span> &lt;span style="color:#50fa7b">freeClientAsync&lt;/span>(c);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17&lt;/span>&lt;span> &lt;span style="color:#ff79c6">goto&lt;/span> done;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20&lt;/span>&lt;span> ....................
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21&lt;/span>&lt;span> &lt;span style="color:#6272a4">// è¯»å–åˆ°æ•°æ®åï¼Œå¼€å§‹è§£æ resp åè®®,æœ€ç»ˆä¼šè°ƒç”¨ enqueuePendingClientsToMainThread å‡½æ•°
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#6272a4">// æŠŠå½“å‰ client æ”¾åˆ°ä¸»çº¿ç¨‹å¾…å¤„ç†åˆ—è¡¨ä¸­
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">if&lt;/span> (&lt;span style="color:#50fa7b">processInputBuffer&lt;/span>(c) &lt;span style="color:#ff79c6">==&lt;/span> C_ERR)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24&lt;/span>&lt;span> c &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">NULL&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26&lt;/span>&lt;span> ...................
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>åœ¨è¿™ä¸ªå‡½æ•°ä¸­ï¼ŒIO çº¿ç¨‹ä¼šä»ç½‘ç»œä¸­è¯»å–æ•°æ®ï¼Œå¹¶æŠŠæ•°æ®æ”¾åˆ°å®¢æˆ·ç«¯çš„ &lt;code>querybuf&lt;/code> ä¸­ã€‚ç„¶åè°ƒç”¨ &lt;code>processInputBuffer&lt;/code> å‡½æ•°æ¥è§£æ resp åè®®ã€‚æœ€ç»ˆä¼šè°ƒç”¨ &lt;code>enqueuePendingClientsToMainThread&lt;/code> å‡½æ•°ï¼Œç„¶åè°ƒç”¨ &lt;code>sendPendingClientsToMainThreadIfNeeded&lt;/code> å‡½æ•°é€šçŸ¥ä¸»çº¿ç¨‹æœ‰æ–°å®¢æˆ·ç«¯å¯å¤„ç†ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">static&lt;/span> &lt;span style="color:#ff79c6">inline&lt;/span> &lt;span style="color:#8be9fd">void&lt;/span> &lt;span style="color:#50fa7b">sendPendingClientsToMainThreadIfNeeded&lt;/span>(IOThread &lt;span style="color:#ff79c6">*&lt;/span>t, &lt;span style="color:#8be9fd">int&lt;/span> check_size) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span> &lt;span style="color:#8be9fd">size_t&lt;/span> len &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#50fa7b">listLength&lt;/span>(t&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>pending_clients_to_main_thread);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (len &lt;span style="color:#ff79c6">==&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span> &lt;span style="color:#ff79c6">||&lt;/span> (check_size &lt;span style="color:#ff79c6">&amp;amp;&amp;amp;&lt;/span> len &lt;span style="color:#ff79c6">&amp;lt;&lt;/span> IO_THREAD_MAX_PENDING_CLIENTS)) &lt;span style="color:#ff79c6">return&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span> &lt;span style="color:#8be9fd">int&lt;/span> running &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>, pending &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span> &lt;span style="color:#50fa7b">pthread_mutex_lock&lt;/span>(&lt;span style="color:#ff79c6">&amp;amp;&lt;/span>mainThreadPendingClientsMutexes[t&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>id]);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span> pending &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#50fa7b">listLength&lt;/span>(mainThreadPendingClients[t&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>id]);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span> &lt;span style="color:#6272a4">// æŠŠå¾…å¤„ç†çš„å®¢æˆ·ç«¯æ¬åˆ°ä¸»çº¿ç¨‹çš„å¾…å¤„ç† list ä¸­
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#50fa7b">listJoin&lt;/span>(mainThreadPendingClients[t&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>id], t&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>pending_clients_to_main_thread);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span> &lt;span style="color:#50fa7b">pthread_mutex_unlock&lt;/span>(&lt;span style="color:#ff79c6">&amp;amp;&lt;/span>mainThreadPendingClientsMutexes[t&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>id]);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (&lt;span style="color:#ff79c6">!&lt;/span>pending) &lt;span style="color:#50fa7b">atomicGetWithSync&lt;/span>(server.running, running);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span> &lt;span style="color:#6272a4">// å¦‚æœä¸»çº¿ç¨‹æ²¡æœ‰åœ¨è¿è¡Œï¼Œå¹¶ä¸”æ²¡æœ‰å¾…å¤„ç†çš„å®¢æˆ·ç«¯ï¼Œå°±è§¦å‘é€šçŸ¥å™¨ï¼Œå”¤é†’ä¸»çº¿ç¨‹å¤„ç†
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">if&lt;/span> (&lt;span style="color:#ff79c6">!&lt;/span>running &lt;span style="color:#ff79c6">&amp;amp;&amp;amp;&lt;/span> &lt;span style="color:#ff79c6">!&lt;/span>pending) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15&lt;/span>&lt;span> &lt;span style="color:#50fa7b">triggerEventNotifier&lt;/span>(mainThreadPendingClientsNotifiers[t&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>id]);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>åˆ°è¿™ï¼Œæ•°æ®è¯»å–çš„å·¥ä½œå°±å®Œæˆäº†ï¼ŒIO çº¿ç¨‹å·²ç»ä»ç½‘ç»œä¸­è¯»å–æ•°æ®ï¼Œå¹¶æŠŠå®¢æˆ·ç«¯å‘é€åˆ°ä¸»çº¿ç¨‹è¿›è¡Œå¤„ç†äº†ã€‚&lt;/p>
&lt;h3 id="æ•°æ®å†™å…¥">&lt;a href="#%e6%95%b0%e6%8d%ae%e5%86%99%e5%85%a5" class="header-anchor">&lt;/a>æ•°æ®å†™å…¥
&lt;/h3>&lt;p>æ•°æ®å†™å…¥çš„å¤§æ¦‚æµç¨‹å›¾ï¼š&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/55348092a2f74b9182fb26f1b333a86c866f8d47.svg">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/55348092a2f74b9182fb26f1b333a86c866f8d47.svg" alt="" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>IO çº¿ç¨‹çš„ &lt;code>el&lt;/code> æ”¶åˆ°ä¸»çº¿ç¨‹å‘æ¥çš„é€šçŸ¥ (ä½¿ç”¨ &lt;code>pending_clients_notifier&lt;/code>) ï¼Œä¼šè°ƒç”¨ &lt;code>handleClientsFromMainThread&lt;/code> ç„¶åä¼šè°ƒç”¨ &lt;code>processClientsFromMainThread&lt;/code> å‡½æ•°æ¥å¤„ç†ä¸»çº¿ç¨‹åˆ†é…ç»™å®ƒçš„å¾…å¤„ç†å®¢æˆ·ç«¯ã€‚&lt;/p>
&lt;p>è¿™ä¸ªå‡½æ•°åœ¨ IO çº¿ç¨‹é€»è¾‘é‚£é‡Œå·²ç»åˆ†æè¿‡äº†ï¼Œå°±ä¸å®Œå…¨å±•å¼€äº†&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#8be9fd">int&lt;/span> &lt;span style="color:#50fa7b">processClientsFromMainThread&lt;/span>(IOThread &lt;span style="color:#ff79c6">*&lt;/span>t) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span> &lt;span style="color:#50fa7b">pthread_mutex_lock&lt;/span>(&lt;span style="color:#ff79c6">&amp;amp;&lt;/span>t&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>pending_clients_mutex);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span> &lt;span style="color:#6272a4">// æŠŠä¸»çº¿ç¨‹åˆ†é…ç»™ IO çº¿ç¨‹çš„å¾…å¤„ç†å®¢æˆ·ç«¯æ¬åˆ° IO çº¿ç¨‹è‡ªå·±çš„å¾…å¤„ç†åˆ—è¡¨ä¸­
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#50fa7b">listJoin&lt;/span>(t&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>processing_clients, t&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>pending_clients);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span> &lt;span style="color:#50fa7b">pthread_mutex_unlock&lt;/span>(&lt;span style="color:#ff79c6">&amp;amp;&lt;/span>t&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>pending_clients_mutex);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span> &lt;span style="color:#8be9fd">size_t&lt;/span> processed &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#50fa7b">listLength&lt;/span>(t&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>processing_clients);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (processed &lt;span style="color:#ff79c6">==&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>) &lt;span style="color:#ff79c6">return&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span> &lt;span style="color:#ff79c6">while&lt;/span>((ln &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#50fa7b">listNext&lt;/span>(&lt;span style="color:#ff79c6">&amp;amp;&lt;/span>li))) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span> client &lt;span style="color:#ff79c6">*&lt;/span>c &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#50fa7b">listNodeValue&lt;/span>(ln);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span> ..............
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span> &lt;span style="color:#6272a4">// æŠŠå®¢æˆ·ç«¯ä»å¾…å¤„ç†åˆ—è¡¨ä¸­ç§»é™¤ï¼ŒåŠ å…¥åˆ° IO çº¿ç¨‹ç®¡ç†çš„å®¢æˆ·ç«¯åˆ—è¡¨ä¸­
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#50fa7b">listUnlinkNode&lt;/span>(t&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>processing_clients, ln);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span> &lt;span style="color:#50fa7b">listLinkNodeTail&lt;/span>(t&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>clients, ln);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span> c&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>io_thread_client_list_node &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#50fa7b">listLast&lt;/span>(t&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>clients);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15&lt;/span>&lt;span> &lt;span style="color:#6272a4">// å¦‚æœå®¢æˆ·ç«¯è¢«æ ‡è®°ä¸ºå…³é—­ï¼Œå°±æŠŠå®¢æˆ·ç«¯å‘é€å›ä¸»çº¿ç¨‹å¤„ç†
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">if&lt;/span> (c&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>io_flags &lt;span style="color:#ff79c6">&amp;amp;&lt;/span> CLIENT_IO_CLOSE_ASAP) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17&lt;/span>&lt;span> &lt;span style="color:#50fa7b">enqueuePendingClientsToMainThread&lt;/span>(c, &lt;span style="color:#bd93f9">1&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18&lt;/span>&lt;span> &lt;span style="color:#ff79c6">continue&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21&lt;/span>&lt;span> &lt;span style="color:#6272a4">// å¦‚æœæœ‰éœ€è¦å†™å…¥çš„æ•°æ®ï¼Œå°±å†™æ•°æ®ç»™å®¢æˆ·ç«¯
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">if&lt;/span> (&lt;span style="color:#50fa7b">clientHasPendingReplies&lt;/span>(c)) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23&lt;/span>&lt;span> &lt;span style="color:#6272a4">//writeToClientå‡½æ•°è´Ÿè´£æŠŠå›å¤æ•°æ®å†™å…¥åˆ°ç½‘ç»œä¸­
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#50fa7b">writeToClient&lt;/span>(c, &lt;span style="color:#bd93f9">0&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> processed;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>é™¤äº† &lt;code>el&lt;/code> ä¸­çš„ &lt;code>fileProc&lt;/code> å¤„ç†å‡½æ•°å¤–ï¼Œè¿˜ä¼šåœ¨ &lt;code>IOThreadBeforeSleep&lt;/code> å‡½æ•°ä¸­è°ƒç”¨ &lt;code>processClientsFromMainThread&lt;/code> æ¥å¤„ç†&lt;/p>
&lt;p>å› ä¸ºä¸»çº¿ç¨‹å¯èƒ½ä¼šåœ¨ IO çº¿ç¨‹å¤„ç†äº‹ä»¶æœŸé—´ä¼ é€’å®¢æˆ·ç«¯è€Œä¸å‘å‡ºé€šçŸ¥ï¼Œæ‰€ä»¥åœ¨ IO çº¿ç¨‹è¿›å…¥ç¡çœ ä¹‹å‰å†è°ƒç”¨ä¸€æ¬¡ &lt;code>processClientsFromMainThread&lt;/code> ç¡®ä¿ä¸ä¼šé—æ¼ä»»ä½•å¾…å¤„ç†çš„å®¢æˆ·ç«¯ã€‚&lt;/p>
&lt;h2 id="æ€»ç»“">&lt;a href="#%e6%80%bb%e7%bb%93" class="header-anchor">&lt;/a>æ€»ç»“
&lt;/h2>&lt;p>æ´‹æ´‹æ´’æ´’å†™äº†è¿™ä¹ˆå¤šï¼Œåº”è¯¥æ˜¯èƒ½æŠŠ redis å¤šçº¿ç¨‹ IO æ¨¡å‹çš„å¤§æ¦‚çš„æ¡†æ¶ç†æ¸…æ¥šäº†ã€‚&lt;/p>
&lt;p>ç›¸æ¯”ä¹‹å‰çš„ç‰ˆæœ¬(6.0ç‰ˆæœ¬)ï¼Œè¿™æ¬¡æ›´æ–°ä¸»è¦æ˜¯æŠŠç½‘ç»œ IO æ“ä½œå®Œå…¨æ”¾åˆ°äº† IO çº¿ç¨‹ä¸­å»å¤„ç†ã€‚å¹¶ä¸”ä¸»çº¿ç¨‹ä¸ä¼šç­‰å¾…æ‰€æœ‰ IO çº¿ç¨‹å¤„ç†å®Œæ•°æ®åå†ç»§ç»­å¤„ç†ï¼Œè€Œæ˜¯é€šè¿‡é€šçŸ¥å™¨çš„æ–¹å¼ï¼Œè®©ä¸»çº¿ç¨‹å’Œ IO çº¿ç¨‹å¹¶è¡Œå¤„ç†æ•°æ®ï¼Œä»è€Œæé«˜äº†æ•´ä½“çš„ååé‡ã€‚è¿™å¯¹äº IO å¯†é›†å‹çš„åº”ç”¨åœºæ™¯æ¥è¯´ï¼Œæå‡è¿˜æ˜¯æ¯”è¾ƒæ˜æ˜¾çš„ã€‚&lt;/p>
&lt;p>è¿™å…¶ä¸­ï¼Œéå¸¸å·§å¦™çš„ä½¿ç”¨äº†äº‹ä»¶é€šçŸ¥å™¨(eventNotifier)æ¥å®ç°ä¸»çº¿ç¨‹å’Œ IO çº¿ç¨‹ä¹‹é—´çš„é€šä¿¡ï¼Œä»è€Œé¿å…äº†å¤æ‚çš„é”æœºåˆ¶ï¼Œæé«˜äº†å¹¶å‘æ€§èƒ½ã€‚&lt;/p>
&lt;p>å¦‚æœ C è¯­è¨€ä¸­æœ‰æ›´é«˜çº§çš„å¹¶å‘ç¼–ç¨‹æ¨¡å‹(æ¯”å¦‚ Golang çš„åç¨‹å’Œé€šé“)ï¼Œå®ç°èµ·æ¥ä¼šæ›´åŠ ç®€æ´å’Œæ¸…æ™°ã€‚ä½¿ç”¨ C è¯­è¨€å®ç°å¤šçº¿ç¨‹ IO æ¨¡å‹ï¼Œä»£ç ä¼šæ¯”è¾ƒå¤æ‚ï¼Œéœ€è¦æ‰‹åŠ¨ç®¡ç†çº¿ç¨‹å’ŒåŒæ­¥æœºåˆ¶ã€‚å°¤å…¶æ˜¯å¤§é‡ä½¿ç”¨äº†å‡½æ•°æŒ‡é’ˆç­‰å¾…å›è°ƒå‡½æ•°ï¼Œç¬¬ä¸€æ¬¡é˜…è¯»æºç æ—¶ï¼Œç†è§£èµ·æ¥ä¼šæ¯”è¾ƒåƒåŠ›ã€‚ä¸è¿‡é€šè¿‡è¿™æ¬¡åˆ†æï¼Œè¿˜æ˜¯å¯¹ redis çš„å¤šçº¿ç¨‹ IO æ¨¡å‹æœ‰äº†æ›´æ·±å…¥çš„ç†è§£ã€‚&lt;/p>
&lt;p>è¿™æ¬¡åªæ˜¯ç®€å•çš„å­¦ä¹ äº†ä¸€ä¸‹å¤§æ¦‚çš„æ¡†æ¶ï¼Œå…¶ä¸­çš„ä¸€äº›ç»†èŠ‚å’Œä¼˜åŒ–æ‰‹æ®µæ²¡æœ‰å±•å¼€åˆ†æï¼Œæ¯”å¦‚å‘½ä»¤é¢„å–æœºåˆ¶ã€IO çº¿ç¨‹çš„æš‚åœå’Œæ¢å¤æœºåˆ¶ç­‰ï¼Œåç»­æœ‰æ—¶é—´å†æ·±å…¥ç ”ç©¶ä¸€ä¸‹ã€‚&lt;/p></description></item><item><title>ä½¿ç”¨C++åç¨‹+liburingçš„HTTP server å’Œ epoll çš„ HTTP server æ€§èƒ½å¯¹æ¯”</title><link>https://lqxhub.github.io/posts/6da4ad2d/</link><pubDate>Sat, 13 Sep 2025 19:04:48 +0800</pubDate><guid>https://lqxhub.github.io/posts/6da4ad2d/</guid><description>&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/1ca5f47363ab61f726ef725e58827790e00be3f7.jpg" alt="Featured image of post ä½¿ç”¨C++åç¨‹+liburingçš„HTTP server å’Œ epoll çš„ HTTP server æ€§èƒ½å¯¹æ¯”" />&lt;p>å‰æ®µæ—¶é—´ï¼Œä½¿ç”¨C++åç¨‹+liburingå®ç°äº†ä¸€ä¸ªç®€å•çš„ echo serverï¼Œ&lt;a class="link" href="https://lqxhub.github.io/posts/d26369fd" >æ–‡ç« åœ°å€&lt;/a>ã€‚&lt;/p>
&lt;p>éƒ½è¯´ä½¿ç”¨ uring å¯ä»¥è·å¾—æ›´å¥½çš„æ€§èƒ½ï¼Œä½†æ˜¯ç©¶ç«Ÿèƒ½æå‡å¤šå°‘å‘¢ï¼Ÿæ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ¥å¯¹æ¯”ä¸€ä¸‹ liburing å’Œ epoll çš„æ€§èƒ½ã€‚&lt;/p>
&lt;h2 id="æµ‹è¯•æ–¹å¼">&lt;a href="#%e6%b5%8b%e8%af%95%e6%96%b9%e5%bc%8f" class="header-anchor">&lt;/a>æµ‹è¯•æ–¹å¼
&lt;/h2>&lt;p>åœ¨åŸæ¥çš„ echo server åŸºç¡€ä¸Šæ”¹åŠ¨äº†ä¸€ä¸‹ï¼ŒæŠŠ echo server æ”¹æˆäº†ä¸€ä¸ªç®€å•çš„ HTTP serverï¼Œè¿”å›ä¸€ä¸ªå›ºå®šçš„ HTML å†…å®¹ã€‚&lt;/p>
&lt;p>ç„¶åä½¿ç”¨ &lt;a class="link" href="https://github.com/link1st/go-stress-testing" target="_blank" rel="noopener"
>go-stress-testing&lt;/a> è¿™ä¸ªå·¥å…·è¿›è¡Œå‹åŠ›æµ‹è¯•ã€‚&lt;/p>
&lt;p>æµ‹è¯•å·¥å…·åœ¨windows 10 ä¸Šã€‚HTTP æœåŠ¡è¿è¡Œè¿™ä¸ªwindows 10 çš„ VMè™šæ‹Ÿæœºä¸Šã€‚ç³»ç»Ÿæ˜¯ debian13ï¼Œlinuxå†…æ ¸æ˜¯ 6.12.41-amd64&lt;/p>
&lt;p>ç¼–è¯‘å™¨ä½¿ç”¨ &lt;code>clang-18&lt;/code> ç¼–è¯‘å‚æ•° &lt;code>-O2 stdlib=libc++ -std=c++23&lt;/code> è¿›è¡Œç¼–è¯‘ã€‚&lt;/p>
&lt;p>uring æœåŠ¡å’Œ epoll æœåŠ¡éƒ½æ˜¯å•çº¿ç¨‹æ¨¡å‹ï¼Œå•çº¿ç¨‹å¤„ç†æ‰€æœ‰è¿æ¥ã€‚&lt;/p>
&lt;h2 id="æµ‹è¯•ä»£ç ">&lt;a href="#%e6%b5%8b%e8%af%95%e4%bb%a3%e7%a0%81" class="header-anchor">&lt;/a>æµ‹è¯•ä»£ç 
&lt;/h2>&lt;p>è¿™é‡Œå°±ä¸è´´æ‰€æœ‰ä»£ç äº†ï¼Œä¸»è¦è´´ä¸€ä¸‹å…³é”®éƒ¨åˆ†ã€‚&lt;/p>
&lt;h3 id="uring-ç‰ˆæœ¬">&lt;a href="#uring-%e7%89%88%e6%9c%ac" class="header-anchor">&lt;/a>uring ç‰ˆæœ¬
&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>Task&lt;span style="color:#ff79c6">&amp;lt;&lt;/span>&lt;span style="color:#8be9fd;font-style:italic">false&lt;/span>&lt;span style="color:#ff79c6">&amp;gt;&lt;/span> IoUring&lt;span style="color:#ff79c6">::&lt;/span>startSession(&lt;span style="color:#8be9fd">int&lt;/span> fd, &lt;span style="color:#8be9fd">uint64_t&lt;/span> connId) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span> std&lt;span style="color:#ff79c6">::&lt;/span>string buffer;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span> buffer.resize(&lt;span style="color:#bd93f9">1024&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span> &lt;span style="color:#8be9fd">bool&lt;/span> closed &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">false&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span> &lt;span style="color:#ff79c6">while&lt;/span> (&lt;span style="color:#ff79c6">!&lt;/span>closed) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span> &lt;span style="color:#ff79c6">auto&lt;/span> aRead &lt;span style="color:#ff79c6">=&lt;/span> AwaitableRead(&lt;span style="color:#ff79c6">this&lt;/span>, fd, buffer);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span> &lt;span style="color:#ff79c6">while&lt;/span> (&lt;span style="color:#8be9fd;font-style:italic">true&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span> &lt;span style="color:#8be9fd">int&lt;/span> res &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#ff79c6">co_await&lt;/span> aRead;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (res &lt;span style="color:#ff79c6">&amp;lt;=&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>) { &lt;span style="color:#6272a4">// è¿æ¥å…³é—­æˆ–è€…è¯»å–é”™è¯¯
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> closed &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">true&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span> &lt;span style="color:#ff79c6">break&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (res &lt;span style="color:#ff79c6">==&lt;/span> &lt;span style="color:#bd93f9">1&lt;/span>) { &lt;span style="color:#6272a4">// è¯»å®Œäº†
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">break&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (closed) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18&lt;/span>&lt;span> &lt;span style="color:#ff79c6">break&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21&lt;/span>&lt;span> &lt;span style="color:#6272a4">// std::cout &amp;lt;&amp;lt; &amp;#34;Received data: &amp;#34;;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23&lt;/span>&lt;span> std&lt;span style="color:#ff79c6">::&lt;/span>string response;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24&lt;/span>&lt;span> std&lt;span style="color:#ff79c6">::&lt;/span>string body &lt;span style="color:#ff79c6">=&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25&lt;/span>&lt;span> &lt;span style="color:#f1fa8c">&amp;#34;&amp;lt;!DOCTYPE html&amp;gt;&amp;lt;html&amp;gt;&amp;lt;head&amp;gt;&amp;lt;title&amp;gt;Test Page&amp;lt;/title&amp;gt;&amp;lt;/head&amp;gt;&amp;lt;body&amp;gt;&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26&lt;/span>&lt;span> &lt;span style="color:#f1fa8c">&amp;#34;&amp;lt;p&amp;gt;Hello, this is a test HTML content for HTTP response.&amp;lt;/p&amp;gt;&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27&lt;/span>&lt;span> &lt;span style="color:#f1fa8c">&amp;#34;&amp;lt;/body&amp;gt;&amp;lt;/html&amp;gt;&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28&lt;/span>&lt;span> response.reserve(&lt;span style="color:#bd93f9">128&lt;/span> &lt;span style="color:#ff79c6">+&lt;/span> body.size()); &lt;span style="color:#6272a4">// å‡å°‘æ‹·è´
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30&lt;/span>&lt;span> response &lt;span style="color:#ff79c6">+=&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;HTTP/1.1 200 OK&lt;/span>&lt;span style="color:#f1fa8c">\r\n&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31&lt;/span>&lt;span> &lt;span style="color:#f1fa8c">&amp;#34;Content-Length: &amp;#34;&lt;/span> &lt;span style="color:#ff79c6">+&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32&lt;/span>&lt;span> std&lt;span style="color:#ff79c6">::&lt;/span>to_string(body.size()) &lt;span style="color:#ff79c6">+&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33&lt;/span>&lt;span> &lt;span style="color:#f1fa8c">&amp;#34;&lt;/span>&lt;span style="color:#f1fa8c">\r\n&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34&lt;/span>&lt;span> &lt;span style="color:#f1fa8c">&amp;#34;Content-Type: text/html; charset=UTF-8&lt;/span>&lt;span style="color:#f1fa8c">\r\n&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35&lt;/span>&lt;span> &lt;span style="color:#f1fa8c">&amp;#34;Connection: close&lt;/span>&lt;span style="color:#f1fa8c">\r\n&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36&lt;/span>&lt;span> &lt;span style="color:#f1fa8c">&amp;#34;Date: Mon, 21 Oct 2024 13:24:24 GMT&lt;/span>&lt;span style="color:#f1fa8c">\r\n\r\n&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37&lt;/span>&lt;span> response &lt;span style="color:#ff79c6">+=&lt;/span> body;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39&lt;/span>&lt;span> &lt;span style="color:#ff79c6">auto&lt;/span> aWrite &lt;span style="color:#ff79c6">=&lt;/span> AwaitableWrite(&lt;span style="color:#ff79c6">this&lt;/span>, fd, std&lt;span style="color:#ff79c6">::&lt;/span>move(std&lt;span style="color:#ff79c6">::&lt;/span>string(response)));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40&lt;/span>&lt;span> &lt;span style="color:#ff79c6">while&lt;/span> (&lt;span style="color:#8be9fd;font-style:italic">true&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41&lt;/span>&lt;span> &lt;span style="color:#8be9fd">int&lt;/span> res &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#ff79c6">co_await&lt;/span> aWrite;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (res &lt;span style="color:#ff79c6">&amp;lt;&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>) { &lt;span style="color:#6272a4">// å†™å‡ºé”™äº†
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> closed &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">true&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44&lt;/span>&lt;span> &lt;span style="color:#ff79c6">break&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (res &lt;span style="color:#ff79c6">==&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>) { &lt;span style="color:#6272a4">// å†™å®Œäº†
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">break&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">51&lt;/span>&lt;span> close(fd);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">52&lt;/span>&lt;span> &lt;span style="color:#ff79c6">co_return&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">53&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>åœ¨åŸæ¥çš„ echo server åŸºç¡€ä¸Šï¼Œæ”¹æˆäº† HTTP serverã€‚ç„¶åä½¿ç”¨åç¨‹å¤„ç†æ¯ä¸ªè¿æ¥ã€‚&lt;/p>
&lt;h3 id="epoll-ç‰ˆæœ¬">&lt;a href="#epoll-%e7%89%88%e6%9c%ac" class="header-anchor">&lt;/a>epoll ç‰ˆæœ¬
&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#8be9fd">void&lt;/span> Epoll&lt;span style="color:#ff79c6">::&lt;/span>run()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span> std&lt;span style="color:#ff79c6">::&lt;/span>cout &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;Epoll::run&amp;#34;&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> std&lt;span style="color:#ff79c6">::&lt;/span>endl;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span> epoll_event events[EVENT_SIZE];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span> &lt;span style="color:#ff79c6">while&lt;/span> (&lt;span style="color:#8be9fd;font-style:italic">true&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span> &lt;span style="color:#8be9fd">int&lt;/span> nfds &lt;span style="color:#ff79c6">=&lt;/span> epoll_wait(ePollFd_, events, EVENT_SIZE, &lt;span style="color:#ff79c6">-&lt;/span>&lt;span style="color:#bd93f9">1&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (nfds &lt;span style="color:#ff79c6">&amp;lt;&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span> std&lt;span style="color:#ff79c6">::&lt;/span>cerr &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;epoll_wait failed nfds:&amp;#34;&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> nfds &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;errno:&amp;#34;&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> errno &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> std&lt;span style="color:#ff79c6">::&lt;/span>endl;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span> &lt;span style="color:#ff79c6">break&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (errno &lt;span style="color:#ff79c6">==&lt;/span> EINTR)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15&lt;/span>&lt;span> &lt;span style="color:#6272a4">// ç³»ç»Ÿè°ƒç”¨è¢«ä¸­æ–­ï¼Œç»§ç»­é‡è¯•
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">continue&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18&lt;/span>&lt;span> &lt;span style="color:#ff79c6">for&lt;/span> (&lt;span style="color:#8be9fd">int&lt;/span> i &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>; i &lt;span style="color:#ff79c6">&amp;lt;&lt;/span> nfds; &lt;span style="color:#ff79c6">++&lt;/span>i)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19&lt;/span>&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (events[i].events &lt;span style="color:#ff79c6">&amp;amp;&lt;/span> EPOLLERR &lt;span style="color:#ff79c6">||&lt;/span> events[i].events &lt;span style="color:#ff79c6">&amp;amp;&lt;/span> EPOLLHUP)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21&lt;/span>&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22&lt;/span>&lt;span> std&lt;span style="color:#ff79c6">::&lt;/span>cout &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;epoll_wait failed errno:&amp;#34;&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> errno &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> std&lt;span style="color:#ff79c6">::&lt;/span>endl;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23&lt;/span>&lt;span> delFd(events[i].data.fd);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24&lt;/span>&lt;span> close(events[i].data.fd);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25&lt;/span>&lt;span> &lt;span style="color:#ff79c6">continue&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (events[i].events &lt;span style="color:#ff79c6">&amp;amp;&lt;/span> EPOLLIN)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28&lt;/span>&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (events[i].data.fd &lt;span style="color:#ff79c6">==&lt;/span> listenFd_)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30&lt;/span>&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31&lt;/span>&lt;span> sockaddr_in cliAddr{};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32&lt;/span>&lt;span> socklen_t length &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#ff79c6">sizeof&lt;/span>(cliAddr);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33&lt;/span>&lt;span> &lt;span style="color:#8be9fd">int&lt;/span> clientFd &lt;span style="color:#ff79c6">=&lt;/span> accept4(listenFd_, &lt;span style="color:#ff79c6">reinterpret_cast&lt;/span>&lt;span style="color:#ff79c6">&amp;lt;&lt;/span>sockaddr&lt;span style="color:#ff79c6">*&amp;gt;&lt;/span>(&lt;span style="color:#ff79c6">&amp;amp;&lt;/span>cliAddr), &lt;span style="color:#ff79c6">&amp;amp;&lt;/span>length,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34&lt;/span>&lt;span> &lt;span style="color:#bd93f9">0&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (clientFd &lt;span style="color:#ff79c6">&amp;lt;&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36&lt;/span>&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37&lt;/span>&lt;span> std&lt;span style="color:#ff79c6">::&lt;/span>cerr &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;accept failed fd:&amp;#34;&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> clientFd &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;errno:&amp;#34;&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> errno &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> std&lt;span style="color:#ff79c6">::&lt;/span>endl;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38&lt;/span>&lt;span> &lt;span style="color:#ff79c6">continue&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40&lt;/span>&lt;span> std&lt;span style="color:#ff79c6">::&lt;/span>cout &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;new client fd&amp;#34;&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> clientFd &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> std&lt;span style="color:#ff79c6">::&lt;/span>endl;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41&lt;/span>&lt;span> addRead(clientFd);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43&lt;/span>&lt;span> &lt;span style="color:#ff79c6">else&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44&lt;/span>&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45&lt;/span>&lt;span> &lt;span style="color:#8be9fd">char&lt;/span> buff[&lt;span style="color:#bd93f9">1024&lt;/span>];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46&lt;/span>&lt;span> &lt;span style="color:#8be9fd">int&lt;/span> n &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#ff79c6">::&lt;/span>read(events[i].data.fd, buff, &lt;span style="color:#ff79c6">sizeof&lt;/span>(buff));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (n &lt;span style="color:#ff79c6">&amp;lt;=&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48&lt;/span>&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49&lt;/span>&lt;span> std&lt;span style="color:#ff79c6">::&lt;/span>cout &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;close fd:&amp;#34;&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> events[i].data.fd &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> std&lt;span style="color:#ff79c6">::&lt;/span>endl;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50&lt;/span>&lt;span> delFd(events[i].data.fd);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">51&lt;/span>&lt;span> close(events[i].data.fd);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">52&lt;/span>&lt;span> &lt;span style="color:#ff79c6">continue&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">53&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">54&lt;/span>&lt;span> std&lt;span style="color:#ff79c6">::&lt;/span>string response;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">55&lt;/span>&lt;span> response.reserve(&lt;span style="color:#bd93f9">128&lt;/span> &lt;span style="color:#ff79c6">+&lt;/span> image.size()); &lt;span style="color:#6272a4">// å‡å°‘æ‹·è´
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">56&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> response &lt;span style="color:#ff79c6">+=&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;HTTP/1.1 200 OK&lt;/span>&lt;span style="color:#f1fa8c">\r\n&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">57&lt;/span>&lt;span> &lt;span style="color:#f1fa8c">&amp;#34;Content-Length: &amp;#34;&lt;/span> &lt;span style="color:#ff79c6">+&lt;/span> std&lt;span style="color:#ff79c6">::&lt;/span>to_string(image.size()) &lt;span style="color:#ff79c6">+&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;&lt;/span>&lt;span style="color:#f1fa8c">\r\n&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">58&lt;/span>&lt;span> &lt;span style="color:#f1fa8c">&amp;#34;Content-Type: image/jpeg&lt;/span>&lt;span style="color:#f1fa8c">\r\n&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">59&lt;/span>&lt;span> &lt;span style="color:#f1fa8c">&amp;#34;Connection: close&lt;/span>&lt;span style="color:#f1fa8c">\r\n&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">60&lt;/span>&lt;span> &lt;span style="color:#f1fa8c">&amp;#34;Date: Mon, 21 Oct 2024 13:24:24 GMT&lt;/span>&lt;span style="color:#f1fa8c">\r\n\r\n&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">61&lt;/span>&lt;span> response &lt;span style="color:#ff79c6">+=&lt;/span> image;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">62&lt;/span>&lt;span> write(events[i].data.fd, response.data(), response.size());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">63&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">64&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">65&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">66&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">67&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>epoll ç‰ˆæœ¬æ²¡æœ‰ä½¿ç”¨åç¨‹ï¼Œç›´æ¥åœ¨äº‹ä»¶å¾ªç¯ä¸­å¤„ç†æ‰€æœ‰è¿æ¥ã€‚ä¸¤ä¸ªHTTP server å¤„ç†é€»è¾‘æ˜¯ä¸€æ ·çš„ï¼Œéƒ½æ˜¯è¯»å–è¯·æ±‚ï¼Œç„¶åè¿”å›ä¸€ä¸ªå›ºå®šçš„ HTML å†…å®¹ã€‚&lt;/p>
&lt;h2 id="æµ‹è¯•ç»“æœ">&lt;a href="#%e6%b5%8b%e8%af%95%e7%bb%93%e6%9e%9c" class="header-anchor">&lt;/a>æµ‹è¯•ç»“æœ
&lt;/h2>&lt;p>&lt;strong>æœ¬æ¬¡æµ‹è¯• io_uringä½¿ç”¨ ä¸­æ–­æ¨¡å¼&lt;/strong>&lt;/p>
&lt;p>ä¸­æ–­æ¨¡å¼ä¹Ÿæ˜¯ &lt;code>io_uring&lt;/code> çš„é»˜è®¤æ¨¡å¼ï¼Œå…³äº &lt;code>io_uring&lt;/code> çš„ä¸¤ç§æ¨¡å¼ï¼Œ&lt;strong>ä¸­æ–­æ¨¡å¼&lt;/strong> &lt;strong>è½®è¯¢æ¨¡å¼&lt;/strong> å’Œ &lt;strong>å†…æ ¸è½®è¯¢æ¨¡å¼&lt;/strong> çš„åŒºåˆ«ï¼Œ å…ˆæŒ–ä¸ªå‘ï¼Œåç»­å†å†™ä¸€ç¯‡æ–‡ç« è¿›è¡Œä»‹ç»ã€‚&lt;/p>
&lt;p>è¿™ä¸ªHTTP server è¿”å›ä¸€ä¸ªç®€å•çš„ HTML å†…å®¹ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-html" data-lang="html">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">&amp;lt;!DOCTYPE html&amp;gt;&lt;/span>&amp;lt;&lt;span style="color:#ff79c6">html&lt;/span>&amp;gt;&amp;lt;&lt;span style="color:#ff79c6">head&lt;/span>&amp;gt;&amp;lt;&lt;span style="color:#ff79c6">title&lt;/span>&amp;gt;Test Page&amp;lt;/&lt;span style="color:#ff79c6">title&lt;/span>&amp;gt;&amp;lt;/&lt;span style="color:#ff79c6">head&lt;/span>&amp;gt;&amp;lt;&lt;span style="color:#ff79c6">body&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span> &amp;lt;&lt;span style="color:#ff79c6">p&lt;/span>&amp;gt;Hello, this is a test HTML content for HTTP response.&amp;lt;/&lt;span style="color:#ff79c6">p&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3&lt;/span>&lt;span>&amp;lt;/&lt;span style="color:#ff79c6">body&lt;/span>&amp;gt;&amp;lt;/&lt;span style="color:#ff79c6">html&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä½¿ç”¨ go-stress-testing è¿›è¡Œå‹åŠ›æµ‹è¯•ï¼Œæµ‹è¯•å‘½ä»¤å¦‚ä¸‹ï¼š&lt;/p>
&lt;p>å¼€å¯ 100 ä¸ªå¹¶å‘è¿æ¥ï¼Œæ¯ä¸ªè¿æ¥å‘é€ 100 æ¬¡è¯·æ±‚ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>go-stress-testing-win.exe -u &lt;span style="color:#f1fa8c">&amp;#34;http://192.168.1.19:8088&amp;#34;&lt;/span> -c &lt;span style="color:#bd93f9">100&lt;/span> -n &lt;span style="color:#bd93f9">100&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>uring ç‰ˆæœ¬æµ‹è¯•ç»“æœ&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/2ee22b6ac54c63b68eef982c2f3dd23d346c1107.png">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/2ee22b6ac54c63b68eef982c2f3dd23d346c1107.png" alt="" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>å¯ä»¥çœ‹åˆ° QPS è¾¾åˆ°äº† 4800+ï¼Œå¹³å‡å“åº”æ—¶é—´ 20msã€‚&lt;/p>
&lt;p>epoll ç‰ˆæœ¬æµ‹è¯•ç»“æœ&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/2cc64d644c2e50030d1c23e074ac0658800a91c4.png">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/2cc64d644c2e50030d1c23e074ac0658800a91c4.png" alt="" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>å¯ä»¥çœ‹åˆ° QPS åªæœ‰ 4000+ï¼Œå¹³å‡å“åº”æ—¶é—´ 23msã€‚&lt;/p>
&lt;p>uring ç‰ˆæœ¬çš„æ€§èƒ½æ¯” epoll ç‰ˆæœ¬æå‡äº† 20% å·¦å³ã€‚&lt;/p>
&lt;h2 id="æµ‹è¯•2">&lt;a href="#%e6%b5%8b%e8%af%952" class="header-anchor">&lt;/a>æµ‹è¯•2
&lt;/h2>&lt;p>ä¸Šé¢çš„æµ‹è¯•ä¸­ï¼ŒHTMLè¿”å›äº†ä¸€ä¸ªç®€å•çš„ç½‘é¡µï¼Œç°åœ¨æ”¹æˆè¿”å›ä¸€ä¸ª148KB çš„å›¾ç‰‡ï¼Œä¸ºäº†é˜²æ­¢ç½‘ç»œæˆä¸ºç“¶é¢ˆï¼Œè¿™æ¬¡å¹¶å‘æ•°æ”¹æˆ 50ï¼Œè¿æ¥æ•°æ”¹æˆ 50ã€‚&lt;/p>
&lt;p>åœ¨è¿›ç¨‹å¯åŠ¨çš„æ—¶å€™ï¼ŒæŠŠå›¾ç‰‡è¯»åˆ°å†…å­˜ä¸­ï¼Œé¿å…æ¯æ¬¡éƒ½è¯»ç£ç›˜ï¼Œç„¶åæ¯æ¬¡è¯·æ±‚éƒ½è¿”å›è¿™ä¸ªå›¾ç‰‡ã€‚&lt;/p>
&lt;p>è¿™ä¸ªæ”¹åŠ¨æ¯”è¾ƒå°ï¼Œåªä¸€ä¸‹ response çš„å†…å®¹ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span> response.reserve(&lt;span style="color:#bd93f9">128&lt;/span> &lt;span style="color:#ff79c6">+&lt;/span> image.size()); &lt;span style="color:#6272a4">// å‡å°‘æ‹·è´
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span> response &lt;span style="color:#ff79c6">+=&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;HTTP/1.1 200 OK&lt;/span>&lt;span style="color:#f1fa8c">\r\n&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span> &lt;span style="color:#f1fa8c">&amp;#34;Content-Length: &amp;#34;&lt;/span> &lt;span style="color:#ff79c6">+&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span> std&lt;span style="color:#ff79c6">::&lt;/span>to_string(image.size()) &lt;span style="color:#ff79c6">+&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span> &lt;span style="color:#f1fa8c">&amp;#34;&lt;/span>&lt;span style="color:#f1fa8c">\r\n&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span> &lt;span style="color:#f1fa8c">&amp;#34;Content-Type: image/jpeg&lt;/span>&lt;span style="color:#f1fa8c">\r\n&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span> &lt;span style="color:#f1fa8c">&amp;#34;Connection: close&lt;/span>&lt;span style="color:#f1fa8c">\r\n&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span> &lt;span style="color:#f1fa8c">&amp;#34;Date: Mon, 21 Oct 2024 13:24:24 GMT&lt;/span>&lt;span style="color:#f1fa8c">\r\n\r\n&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span> response &lt;span style="color:#ff79c6">+=&lt;/span> image;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä½¿ç”¨ go-stress-testing è¿›è¡Œå‹åŠ›æµ‹è¯•ï¼Œæµ‹è¯•å‘½ä»¤å¦‚ä¸‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>go-stress-testing-win.exe -u &lt;span style="color:#f1fa8c">&amp;#34;http://192.168.1.19:8088&amp;#34;&lt;/span> -c &lt;span style="color:#bd93f9">50&lt;/span> -n &lt;span style="color:#bd93f9">50&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å¼€å¯ 50 ä¸ªå¹¶å‘è¿æ¥ï¼Œæ¯ä¸ªè¿æ¥å‘é€ 50 æ¬¡è¯·æ±‚ã€‚&lt;/p>
&lt;p>uring ç‰ˆæœ¬æµ‹è¯•ç»“æœ&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/ae8ac9a2b8045857abfddf2f01bfcbf0ff25798b.png">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/ae8ac9a2b8045857abfddf2f01bfcbf0ff25798b.png" alt="" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>å¯ä»¥çœ‹åˆ° QPS è¾¾åˆ°äº† 1300+ï¼Œå¹³å‡å“åº”æ—¶é—´ 37msã€‚&lt;/p>
&lt;p>epoll ç‰ˆæœ¬æµ‹è¯•ç»“æœ&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/32a5770fb20f16abca3f7d48d51e2b21374a8e2b.png">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/32a5770fb20f16abca3f7d48d51e2b21374a8e2b.png" alt="" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>å¯ä»¥çœ‹åˆ° QPS åªæœ‰ 520+ï¼Œå¹³å‡å“åº”æ—¶é—´ 93msã€‚&lt;/p>
&lt;p>å¯ä»¥çœ‹åˆ°ï¼Œuring ç‰ˆæœ¬çš„æ€§èƒ½æ˜¯ epoll ç‰ˆæœ¬çš„ 2.5 å€å·¦å³ã€‚è¿™ä¸ªæå‡è¿˜æ˜¯éå¸¸æ˜æ˜¾çš„ã€‚&lt;/p>
&lt;h2 id="æ€»ç»“">&lt;a href="#%e6%80%bb%e7%bb%93" class="header-anchor">&lt;/a>æ€»ç»“
&lt;/h2>&lt;p>é€šè¿‡ä¸Šé¢çš„æµ‹è¯•ï¼Œå¯ä»¥çœ‹åˆ° &lt;code>liburing&lt;/code> ç›¸æ¯” &lt;code>epoll&lt;/code> åœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹ï¼Œä¸ç®¡æ˜¯ &lt;strong>QPS&lt;/strong> è¿˜æ˜¯ &lt;strong>å“åº”è€—æ—¶&lt;/strong>ï¼Œæ€§èƒ½æå‡è¿˜æ˜¯æ¯”è¾ƒæ˜æ˜¾çš„ã€‚&lt;/p>
&lt;p>å…·ä½“æ¥è¯´ï¼Œuring ç‰ˆæœ¬åœ¨å¤„ç†å°æ–‡ä»¶æ—¶çš„ QPS æ¯” epoll ç‰ˆæœ¬é«˜å‡º &lt;strong>20%&lt;/strong> å·¦å³ï¼Œè€Œåœ¨å¤„ç†å¤§æ–‡ä»¶æ—¶çš„ QPS åˆ™é«˜å‡º &lt;strong>2.5&lt;/strong> å€å·¦å³ã€‚è¿™äº›æµ‹è¯•ç»“æœè¡¨æ˜ï¼Œliburing åœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹å…·æœ‰æ›´å¥½çš„æ€§èƒ½è¡¨ç°ï¼Œå°¤å…¶æ˜¯åœ¨è¯»å–å’Œå†™å…¥å¤§çš„æ•°æ®æ—¶ï¼Œä¼˜åŠ¿æ›´åŠ æ˜æ˜¾ã€‚è¿™è¿˜æ˜¯æå‰ä»æ–‡ä»¶ä¸­è¯»å–åˆ°å†…å­˜ä¸­ï¼Œé¿å…äº†ç£ç›˜ I/O çš„å½±å“ã€‚å¦‚æœæ˜¯æ¯æ¬¡éƒ½ä»ç£ç›˜è¯»å–ï¼Œä½¿ç”¨ liburing å¼‚æ­¥è¯»å–å’Œæ™®é€šçš„ &lt;code>read&lt;/code> å‡½æ•°è¯»å–å¯¹æ¯”ï¼Œæ€§èƒ½å·®è·å¯èƒ½ä¼šæ›´å¤§ã€‚
è¿™ä¹Ÿæ˜¯å› ä¸º liburing èƒ½å¤Ÿæ›´é«˜æ•ˆåœ°åˆ©ç”¨å†…æ ¸çš„å¼‚æ­¥ I/O èƒ½åŠ›ï¼Œå‡å°‘äº†ç³»ç»Ÿè°ƒç”¨çš„å¼€é”€ï¼Œä»è€Œæå‡äº†æ•´ä½“çš„ååé‡å’Œå“åº”é€Ÿåº¦ã€‚&lt;/p></description></item><item><title>ç”¨goå®ç°ä¸€ä¸ªæ”¯æŒSSHéš§é“è½¬å‘ (SSH port forwarding) çš„ redis-cli å·¥å…·</title><link>https://lqxhub.github.io/posts/61c8dafe/</link><pubDate>Sun, 07 Sep 2025 15:48:48 +0800</pubDate><guid>https://lqxhub.github.io/posts/61c8dafe/</guid><description>&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/a44968f29f6744f2fe0b1d4b640fd6e70776356e.jpg" alt="Featured image of post ç”¨goå®ç°ä¸€ä¸ªæ”¯æŒSSHéš§é“è½¬å‘ (SSH port forwarding) çš„ redis-cli å·¥å…·" />&lt;p>å…ˆèŠä¸€ä¸‹ä»€ä¹ˆæ˜¯SSHéš§é“è½¬å‘å§ï¼Œéš§é“è½¬å‘ä¹Ÿè¢«ç§°ä½œæ˜¯SSH ç«¯å£è½¬å‘ï¼Œæ˜¯ä¸€ç§é€šè¿‡SSHåè®®å°†æœ¬åœ°ç«¯å£è½¬å‘åˆ°è¿œç¨‹ä¸»æœºçš„æŠ€æœ¯ã€‚å®ƒå¯ä»¥å®ç°å®‰å…¨çš„ç½‘ç»œè¿æ¥ï¼Œå¸¸ç”¨äºç©¿è¶Šé˜²ç«å¢™æˆ–è®¿é—®å†…ç½‘æœåŠ¡ã€‚&lt;/p>
&lt;p>SSHéš§é“è½¬å‘çš„å·¥ä½œåŸç†æ˜¯ï¼Œåœ¨SSHè¿æ¥å»ºç«‹åï¼Œé€šè¿‡SSHåè®®å°†æœ¬åœ°ç«¯å£çš„æµé‡åŠ å¯†åè½¬å‘åˆ°è¿œç¨‹ä¸»æœºçš„æŒ‡å®šç«¯å£ã€‚è¿™æ ·ï¼Œç”¨æˆ·å°±å¯ä»¥é€šè¿‡æœ¬åœ°ç«¯å£è®¿é—®è¿œç¨‹ä¸»æœºçš„æœåŠ¡ï¼Œè€Œä¸å¿…ç›´æ¥æš´éœ²è¿œç¨‹ä¸»æœºçš„ç«¯å£ã€‚æœ€å¸¸è§çš„åº”ç”¨åœºæ™¯æ˜¯åœ¨æœ¬åœ°è¿æ¥äº‘æœåŠ¡çš„æ•°æ®åº“ï¼Œæˆ–è€…è®¿é—®å…¬å¸å†…ç½‘çš„èµ„æºã€‚ä¸€èˆ¬äº‘MySQLæ•°æ®åº“éƒ½æ˜¯ä¸å¼€æ”¾å…¬ç½‘çš„ï¼Œåªèƒ½åœ¨å†…ç½‘ä¸­è®¿é—®ï¼Œä¸ºäº†åœ¨å…¬ç½‘èƒ½è®¿é—®è¿™äº›èµ„æºï¼Œå°±éœ€è¦ä½¿ç”¨SSHéš§é“è½¬å‘ã€‚&lt;/p>
&lt;p>åœ¨ Navicat ä¸­è¿æ¥MySQL æ•°æ®åº“æ—¶ï¼Œå¯ä»¥é€šè¿‡SSHéš§é“è½¬å‘æ¥è¿æ¥æ²¡æœ‰å…¬ç½‘IPçš„æ•°æ®åº“ï¼Œè¿æ¥é…ç½®å¦‚ä¸‹å›¾&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/55024f7010d68e86b4a35b49ebf3b0526872276d.png">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/55024f7010d68e86b4a35b49ebf3b0526872276d.png" alt="" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>ä¸ºä»€ä¹ˆè¦ç”¨goå®ç°ä¸€ä¸ªSSH éš§é“è½¬å‘ä»£ç†å‘¢ï¼Ÿä¸»è¦æ˜¯æˆ‘ä»¬å…¬å¸çš„å¾ˆå¤šrediså®ä¾‹éƒ½åœ¨äº‘ä¸Šï¼Œæ— æ³•ç›´æ¥åœ¨å…¬ç½‘ä¸­è®¿é—®ã€‚é€šè¿‡SSHéš§é“è½¬å‘ï¼Œå¯ä»¥å®ç°åœ¨å…¬ç½‘ä¸­è®¿é—®è¿™äº›äº‘ä¸Šçš„rediså®ä¾‹ã€‚ä¸ºä»€ä¹ˆä¸ç”¨ç°æˆçš„å·¥å…·å‘¢ï¼Ÿ&lt;/p>
&lt;p>é¦–å…ˆ redis-cli å·¥å…·ä¸æ”¯æŒSSHéš§é“è½¬å‘ï¼Œè¦è§£å†³é—®é¢˜ï¼Œæœ‰ä¸¤ç§é€‰æ‹©&lt;/p>
&lt;ol>
&lt;li>é€‰æ‹©ä¸€äº›GUIçš„rediså®¢æˆ·ç«¯å·¥å…·ï¼Œä½†æ˜¯è¿™äº›å·¥å…·å¾€å¾€éœ€è¦é¢å¤–çš„é…ç½®ï¼Œä½¿ç”¨èµ·æ¥ä¸å¤Ÿæ–¹ä¾¿ã€‚æ‰€ä»¥è€ƒè™‘è‡ªå·±å†™ä¸€ä¸ªç®€å•çš„å‘½ä»¤è¡Œå·¥å…·æ¥å®ç°è¿™ä¸ªåŠŸèƒ½ã€‚&lt;/li>
&lt;li>ç›´æ¥ä½¿ç”¨SSHå‘½ä»¤è¿›è¡Œç«¯å£è½¬å‘ï¼Œç„¶åå†ä½¿ç”¨redis-cliè¿æ¥æœ¬åœ°ç«¯å£ã€‚è¿™ç§æ–¹å¼æ¯”è¾ƒç®€å•ï¼Œä½†éœ€è¦æ‰‹åŠ¨ç®¡ç†SSHè¿æ¥&lt;/li>
&lt;/ol>
&lt;p>ä½¿ç”¨è¿™ä¸¤ä¸ªæ–¹æ¡ˆè¿˜æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œè¦å¯¹æ‰€æœ‰äººå…¬å¼€SSHæœºå™¨çš„è´¦å·å¯†ç ï¼Œå­˜åœ¨å®‰å…¨éšæ‚£ã€‚&lt;/p>
&lt;p>æ‰€ä»¥è‡ªå·±å®ç°ä¸€ä¸ªç®€å•çš„ æ”¯æŒ SSH éš§é“è½¬å‘çš„ redis-cli å·¥å…·æ˜¯ä¸€ä¸ªä¸é”™çš„é€‰æ‹©ï¼Œæ­£å¥½å¯ä»¥å€Ÿè¿™ä¸ªæœºä¼šå­¦ä¹ ä¸€ä¸‹ç›¸å…³çš„æŠ€æœ¯ã€‚è¿™ä¸ªå·¥å…·è¦æœ‰ä»¥ä¸‹åŠŸèƒ½ï¼š&lt;/p>
&lt;ol>
&lt;li>æ”¯æŒé€šè¿‡SSHéš§é“è¿æ¥åˆ°è¿œç¨‹Rediså®ä¾‹&lt;/li>
&lt;li>å¯¹ä½¿ç”¨è€…é€æ˜SSHè¿æ¥çš„å»ºç«‹å’Œæ–­å¼€&lt;/li>
&lt;li>æ”¯æŒé…ç½®æ–‡ä»¶ï¼Œæˆ–è€…ç›´æ¥æŠŠSSHç›¸å…³çš„ä¿¡æ¯ç¼–è¯‘åœ¨ä»£ç ä¸­&lt;/li>
&lt;/ol>
&lt;p>å¤§æ¦‚çš„åŸç†å¦‚å›¾ï¼š&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/98e933e79124f76dfb1d989d92cdcf466d6c8dac.svg">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/98e933e79124f76dfb1d989d92cdcf466d6c8dac.svg" alt="" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>&lt;strong>tun redis-cli&lt;/strong> æ˜¯è¦é€šè¿‡SSHéš§é“è¿æ¥åˆ°è¿œç¨‹Rediså®ä¾‹çš„å·¥å…·ã€‚ &lt;strong>SSH server&lt;/strong> æ˜¯æˆ‘ä»¬ç”¨æ¥å»ºç«‹SSHè¿æ¥çš„ä¸­é—´æœåŠ¡å™¨ã€‚ &lt;strong>redis server&lt;/strong> æ˜¯æˆ‘ä»¬è¦è®¿é—®çš„è¿œç¨‹Rediså®ä¾‹ã€‚&lt;/p>
&lt;p>tun redis-cli é€šè¿‡ SSH å…ˆè¿æ¥åˆ° å…·æœ‰å…¬ç½‘IPçš„ SSH server ä¸Šï¼Œç„¶åå†é€šè¿‡ SSH éš§é“è¿æ¥åˆ° redis serverã€‚&lt;/p>
&lt;p>ä¸‹é¢å¼€å§‹æ’¸ä»£ç ï¼Œå®ç°è¿™ä¸ªå·¥å…·&lt;/p>
&lt;h2 id="ssh-éš§é“è½¬å‘">&lt;a href="#ssh-%e9%9a%a7%e9%81%93%e8%bd%ac%e5%8f%91" class="header-anchor">&lt;/a>SSH éš§é“è½¬å‘
&lt;/h2>&lt;p>å…ˆæ¥å®ç°æœ€æ ¸å¿ƒçš„åŠŸèƒ½ï¼ŒSSH éš§é“è½¬å‘ã€‚æˆ‘ä»¬éœ€è¦ä½¿ç”¨ Go çš„ &lt;code>golang.org/x/crypto/ssh&lt;/code> åŒ…æ¥å®ç° SSH è¿æ¥å’Œç«¯å£è½¬å‘ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">package&lt;/span> main
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span>&lt;span style="color:#ff79c6">import&lt;/span> (
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span> &lt;span style="color:#f1fa8c">&amp;#34;errors&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span> &lt;span style="color:#f1fa8c">&amp;#34;fmt&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span> &lt;span style="color:#f1fa8c">&amp;#34;golang.org/x/crypto/ssh&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span> &lt;span style="color:#f1fa8c">&amp;#34;os&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">type&lt;/span> SSHConfig &lt;span style="color:#8be9fd;font-style:italic">struct&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span> SSHHost &lt;span style="color:#8be9fd">string&lt;/span> &lt;span style="color:#6272a4">//SSHæœåŠ¡å™¨åœ°å€
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> SSHUser &lt;span style="color:#8be9fd">string&lt;/span> &lt;span style="color:#6272a4">//SSHç”¨æˆ·å
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> SSHPassword &lt;span style="color:#8be9fd">string&lt;/span> &lt;span style="color:#6272a4">//SSHå¯†ç 
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> SSHKey &lt;span style="color:#8be9fd">string&lt;/span> &lt;span style="color:#6272a4">//ç§˜é’¥æ–‡ä»¶è·¯å¾„
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> &lt;span style="color:#50fa7b">GetSSHClient&lt;/span>(config &lt;span style="color:#ff79c6">*&lt;/span>SSHConfig) (&lt;span style="color:#ff79c6">*&lt;/span>ssh.Client, &lt;span style="color:#8be9fd">error&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> config.SSHHost &lt;span style="color:#ff79c6">==&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;&amp;#34;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> &lt;span style="color:#ff79c6">nil&lt;/span>, errors.&lt;span style="color:#50fa7b">New&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;SSHHost must be provided&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> config.SSHUser &lt;span style="color:#ff79c6">==&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;&amp;#34;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> &lt;span style="color:#ff79c6">nil&lt;/span>, errors.&lt;span style="color:#50fa7b">New&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;SSHUser must be provided&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> config.SSHKey &lt;span style="color:#ff79c6">==&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;&amp;#34;&lt;/span> &lt;span style="color:#ff79c6">&amp;amp;&amp;amp;&lt;/span> config.SSHPassword &lt;span style="color:#ff79c6">==&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;&amp;#34;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> &lt;span style="color:#ff79c6">nil&lt;/span>, errors.&lt;span style="color:#50fa7b">New&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;SSHKey or SSHPassword must be provided&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28&lt;/span>&lt;span> sshConfig &lt;span style="color:#ff79c6">:=&lt;/span> &lt;span style="color:#ff79c6">&amp;amp;&lt;/span>ssh.ClientConfig{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29&lt;/span>&lt;span> User: config.SSHUser,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30&lt;/span>&lt;span> HostKeyCallback: ssh.&lt;span style="color:#50fa7b">InsecureIgnoreHostKey&lt;/span>(),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> config.SSHPassword &lt;span style="color:#ff79c6">!=&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;&amp;#34;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34&lt;/span>&lt;span> sshConfig.Auth = []ssh.AuthMethod{ssh.&lt;span style="color:#50fa7b">Password&lt;/span>(config.SSHPassword)}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35&lt;/span>&lt;span> } &lt;span style="color:#ff79c6">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> config.SSHKey &lt;span style="color:#ff79c6">!=&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;&amp;#34;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37&lt;/span>&lt;span> keyContent, err &lt;span style="color:#ff79c6">:=&lt;/span> os.&lt;span style="color:#50fa7b">ReadFile&lt;/span>(config.SSHKey)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> err &lt;span style="color:#ff79c6">!=&lt;/span> &lt;span style="color:#ff79c6">nil&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> &lt;span style="color:#ff79c6">nil&lt;/span>, fmt.&lt;span style="color:#50fa7b">Errorf&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;failed to read SSH key file:%s: error:%w&amp;#34;&lt;/span>, config.SSHKey, err)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41&lt;/span>&lt;span> signer, err &lt;span style="color:#ff79c6">:=&lt;/span> ssh.&lt;span style="color:#50fa7b">ParsePrivateKey&lt;/span>(keyContent)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> err &lt;span style="color:#ff79c6">!=&lt;/span> &lt;span style="color:#ff79c6">nil&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> &lt;span style="color:#ff79c6">nil&lt;/span>, fmt.&lt;span style="color:#50fa7b">Errorf&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;failed to parse SSH key: %w&amp;#34;&lt;/span>, err)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45&lt;/span>&lt;span> sshConfig.Auth = &lt;span style="color:#8be9fd;font-style:italic">append&lt;/span>(sshConfig.Auth, ssh.&lt;span style="color:#50fa7b">PublicKeys&lt;/span>(signer))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49&lt;/span>&lt;span> sshConfig.HostKeyCallback = ssh.&lt;span style="color:#50fa7b">InsecureIgnoreHostKey&lt;/span>()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">51&lt;/span>&lt;span> client, err &lt;span style="color:#ff79c6">:=&lt;/span> ssh.&lt;span style="color:#50fa7b">Dial&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;tcp&amp;#34;&lt;/span>, config.SSHHost, sshConfig)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">52&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> err &lt;span style="color:#ff79c6">!=&lt;/span> &lt;span style="color:#ff79c6">nil&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">53&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> &lt;span style="color:#ff79c6">nil&lt;/span>, err
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">54&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">55&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> client, &lt;span style="color:#ff79c6">nil&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">56&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä¸Šé¢çš„ä»£ç å®šä¹‰äº†ä¸€ä¸ª &lt;code>SSHConfig&lt;/code> ç»“æ„ä½“æ¥å­˜å‚¨ SSH è¿æ¥çš„é…ç½®ä¿¡æ¯ï¼ŒåŒ…æ‹¬ SSH æœåŠ¡å™¨åœ°å€ã€ç”¨æˆ·åã€å¯†ç å’Œç§˜é’¥æ–‡ä»¶è·¯å¾„ã€‚&lt;code>GetSSHClient&lt;/code> å‡½æ•°æ ¹æ®è¿™äº›é…ç½®ä¿¡æ¯åˆ›å»ºå¹¶è¿”å›ä¸€ä¸ª SSH å®¢æˆ·ç«¯ã€‚&lt;/p>
&lt;p>sshæœ‰å¤šç§èº«ä»½éªŒè¯æ–¹å¼ï¼ŒåŒ…æ‹¬å¯†ç éªŒè¯å’Œå…¬é’¥éªŒè¯ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œæˆ‘ä»¬æ”¯æŒè¿™ä¸¤ç§æ–¹å¼ã€‚ç”¨æˆ·å¯ä»¥é€šè¿‡è®¾ç½® &lt;code>SSHPassword&lt;/code> æˆ– &lt;code>SSHKey&lt;/code> å­—æ®µæ¥é€‰æ‹©èº«ä»½éªŒè¯æ–¹å¼ã€‚å¦‚æœåŒæ—¶è®¾ç½®äº†è¿™ä¸¤ä¸ªå­—æ®µï¼Œç¨‹åºå°†ä¼˜å…ˆä½¿ç”¨å¯†ç éªŒè¯ã€‚&lt;/p>
&lt;p>ç°åœ¨å·²ç»åˆ›å»ºå¥½äº†ä¸€ä¸ªSSHçš„å®¢æˆ·ç«¯ï¼Œå¯ä»¥ç”¨æ¥è¿›è¡Œåç»­çš„æ“ä½œï¼Œå»ºç«‹ redis è¿æ¥ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">type&lt;/span> RedisClient &lt;span style="color:#8be9fd;font-style:italic">struct&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span> conn net.Conn
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span> writeBuff &lt;span style="color:#ff79c6">*&lt;/span>bytes.Buffer
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span> read &lt;span style="color:#ff79c6">*&lt;/span>bufio.Reader
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span> outPut &lt;span style="color:#ff79c6">*&lt;/span>bytes.Buffer
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span>&lt;span style="color:#6272a4">// GetRedisClient åˆ›å»ºä¸€ä¸ª RedisClient å®ä¾‹
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span>&lt;span style="color:#6272a4">// address æ˜¯ Redis æœåŠ¡å™¨çš„åœ°å€, IP:port æ ¼å¼
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> &lt;span style="color:#50fa7b">GetRedisClient&lt;/span>(sshClient &lt;span style="color:#ff79c6">*&lt;/span>ssh.Client, address &lt;span style="color:#8be9fd">string&lt;/span>) (&lt;span style="color:#ff79c6">*&lt;/span>RedisClient, &lt;span style="color:#8be9fd">error&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> sshClient &lt;span style="color:#ff79c6">==&lt;/span> &lt;span style="color:#ff79c6">nil&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> &lt;span style="color:#ff79c6">nil&lt;/span>, errors.&lt;span style="color:#50fa7b">New&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;SSH client is nil&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span> remoteConn, err &lt;span style="color:#ff79c6">:=&lt;/span> sshClient.&lt;span style="color:#50fa7b">Dial&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;tcp&amp;#34;&lt;/span>, address)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> err &lt;span style="color:#ff79c6">!=&lt;/span> &lt;span style="color:#ff79c6">nil&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> &lt;span style="color:#ff79c6">nil&lt;/span>, fmt.&lt;span style="color:#50fa7b">Errorf&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;failed to connect to Redis server at %s: %w&amp;#34;&lt;/span>, address, err)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18&lt;/span>&lt;span> redisCli &lt;span style="color:#ff79c6">:=&lt;/span> &lt;span style="color:#ff79c6">&amp;amp;&lt;/span>RedisClient{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19&lt;/span>&lt;span> conn: remoteConn,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20&lt;/span>&lt;span> writeBuff: bytes.&lt;span style="color:#50fa7b">NewBuffer&lt;/span>(&lt;span style="color:#8be9fd;font-style:italic">make&lt;/span>([]&lt;span style="color:#8be9fd">byte&lt;/span>, &lt;span style="color:#bd93f9">0&lt;/span>, &lt;span style="color:#bd93f9">1024&lt;/span>)),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21&lt;/span>&lt;span> read: bufio.&lt;span style="color:#50fa7b">NewReaderSize&lt;/span>(remoteConn, &lt;span style="color:#bd93f9">4096&lt;/span>),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22&lt;/span>&lt;span> outPut: bytes.&lt;span style="color:#50fa7b">NewBuffer&lt;/span>(&lt;span style="color:#8be9fd;font-style:italic">make&lt;/span>([]&lt;span style="color:#8be9fd">byte&lt;/span>, &lt;span style="color:#bd93f9">0&lt;/span>, &lt;span style="color:#bd93f9">4096&lt;/span>)),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> redisCli, &lt;span style="color:#ff79c6">nil&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>é€šè¿‡SSHå®¢æˆ·ç«¯çš„ &lt;code>Dial&lt;/code> æ–¹æ³•ï¼Œå¯ä»¥è¿æ¥åˆ°å†…ç½‘çš„ Redis æœåŠ¡å™¨ã€‚&lt;code>GetRedisClient&lt;/code> å‡½æ•°æ¥å—ä¸€ä¸ª SSH å®¢æˆ·ç«¯å’Œ Redis æœåŠ¡å™¨åœ°å€ï¼Œè¿”å›ä¸€ä¸ª &lt;code>RedisClient&lt;/code> å®ä¾‹ã€‚&lt;code>RedisClient&lt;/code> ç»“æ„ä½“å°è£…äº†ä¸ Redis æœåŠ¡å™¨çš„è¿æ¥ï¼Œå¹¶æä¾›äº†è¯»å†™æ“ä½œçš„ç¼“å†²åŒºã€‚&lt;/p>
&lt;p>åˆ°è¿™ï¼ŒåŸºæœ¬å®ç°äº† SSH éš§é“è½¬å‘çš„åŠŸèƒ½ï¼Œå¯ä»¥è®¿é—®å†…ç½‘çš„redisæœåŠ¡äº†ã€‚ä½†æ˜¯è¿˜ç¼ºå°‘redisåè®®è§£æåŠŸèƒ½ã€‚&lt;/p>
&lt;h2 id="redis-åè®®è§£æ">&lt;a href="#redis-%e5%8d%8f%e8%ae%ae%e8%a7%a3%e6%9e%90" class="header-anchor">&lt;/a>redis åè®®è§£æ
&lt;/h2>&lt;p>redis åè®®ç®€ç§° &lt;strong>RESP&lt;/strong>ï¼Œæ˜¯ Redis ä½¿ç”¨çš„é€šä¿¡åè®®ã€‚RESP åè®®ç®€å•é«˜æ•ˆï¼Œæ˜“äºè§£æã€‚
RESPåè®®ç°åœ¨æœ‰ &lt;code>RESP2&lt;/code> å’Œ &lt;code>RESP3&lt;/code> ä¸¤ä¸ªç‰ˆæœ¬ã€‚ç°åœ¨å¸¸ç”¨çš„è¿˜æ˜¯ &lt;code>RESP2&lt;/code>ã€‚&lt;/p>
&lt;p>&lt;code>RESP2&lt;/code> åè®®æœ‰äº”ç§æ•°æ®ç±»å‹ï¼š&lt;/p>
&lt;ol>
&lt;li>&lt;strong>ç®€å•å­—ç¬¦ä¸²&lt;/strong>ï¼šä»¥ &lt;code>+&lt;/code> å¼€å¤´ï¼Œç›´åˆ° &lt;code>\r\n&lt;/code> ç»“æŸã€‚&lt;/li>
&lt;li>&lt;strong>é”™è¯¯&lt;/strong>ï¼šä»¥ &lt;code>-&lt;/code> å¼€å¤´ï¼Œç›´åˆ° &lt;code>\r\n&lt;/code> ç»“æŸã€‚&lt;/li>
&lt;li>&lt;strong>æ•´æ•°&lt;/strong>ï¼šä»¥ &lt;code>:&lt;/code> å¼€å¤´ï¼Œç›´åˆ° &lt;code>\r\n&lt;/code> ç»“æŸã€‚&lt;/li>
&lt;li>&lt;strong>æ•°ç»„&lt;/strong>ï¼šä»¥ &lt;code>*&lt;/code> å¼€å¤´ï¼Œåæ¥æ•°ç»„é•¿åº¦ï¼Œç›´åˆ° &lt;code>\r\n&lt;/code> ç»“æŸã€‚æ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ éƒ½æ˜¯ä¸€ä¸ª RESP ç±»å‹ã€‚&lt;/li>
&lt;li>&lt;strong>äºŒè¿›åˆ¶å®‰å…¨å­—ç¬¦ä¸²&lt;/strong>ï¼šä»¥ &lt;code>$&lt;/code> å¼€å¤´ï¼Œåæ¥å­—ç¬¦ä¸²é•¿åº¦ï¼Œç›´åˆ° &lt;code>\r\n&lt;/code> ç»“æŸã€‚&lt;/li>
&lt;/ol>
&lt;p>ä¸‹é¢å°±è‡ªå·±å®ç°ä¸€ä¸ªç®€å•çš„ RESP åè®®è§£æå™¨ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> (r &lt;span style="color:#ff79c6">*&lt;/span>RedisClient) &lt;span style="color:#50fa7b">Read&lt;/span>() &lt;span style="color:#8be9fd">error&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span> b, err &lt;span style="color:#ff79c6">:=&lt;/span> r.read.&lt;span style="color:#50fa7b">ReadBytes&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#39;\n&amp;#39;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> err &lt;span style="color:#ff79c6">!=&lt;/span> &lt;span style="color:#ff79c6">nil&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> fmt.&lt;span style="color:#50fa7b">Errorf&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;failed to read from Redis connection: %w&amp;#34;&lt;/span>, err)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">len&lt;/span>(b) &lt;span style="color:#ff79c6">&amp;lt;=&lt;/span> &lt;span style="color:#bd93f9">2&lt;/span> &lt;span style="color:#ff79c6">||&lt;/span> b[&lt;span style="color:#8be9fd;font-style:italic">len&lt;/span>(b)&lt;span style="color:#ff79c6">-&lt;/span>&lt;span style="color:#bd93f9">2&lt;/span>] &lt;span style="color:#ff79c6">!=&lt;/span> &lt;span style="color:#f1fa8c">&amp;#39;\r&amp;#39;&lt;/span> &lt;span style="color:#ff79c6">||&lt;/span> b[&lt;span style="color:#8be9fd;font-style:italic">len&lt;/span>(b)&lt;span style="color:#ff79c6">-&lt;/span>&lt;span style="color:#bd93f9">1&lt;/span>] &lt;span style="color:#ff79c6">!=&lt;/span> &lt;span style="color:#f1fa8c">&amp;#39;\n&amp;#39;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> errors.&lt;span style="color:#50fa7b">New&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;invalid Redis response format&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span> bf &lt;span style="color:#ff79c6">:=&lt;/span> b[&lt;span style="color:#bd93f9">0&lt;/span>]
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span> b = b[&lt;span style="color:#bd93f9">1&lt;/span> : &lt;span style="color:#8be9fd;font-style:italic">len&lt;/span>(b)&lt;span style="color:#ff79c6">-&lt;/span>&lt;span style="color:#bd93f9">2&lt;/span>] &lt;span style="color:#6272a4">// Remove the trailing \r\n
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">switch&lt;/span> bf {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span> &lt;span style="color:#ff79c6">case&lt;/span> &lt;span style="color:#f1fa8c">&amp;#39;+&amp;#39;&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span> &lt;span style="color:#6272a4">// Simple string reply
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> r.outPut.&lt;span style="color:#50fa7b">Write&lt;/span>(b)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15&lt;/span>&lt;span> &lt;span style="color:#ff79c6">case&lt;/span> &lt;span style="color:#f1fa8c">&amp;#39;-&amp;#39;&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16&lt;/span>&lt;span> &lt;span style="color:#6272a4">// Error reply
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> r.outPut.&lt;span style="color:#50fa7b">WriteString&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;(error) ERR &amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18&lt;/span>&lt;span> r.outPut.&lt;span style="color:#50fa7b">Write&lt;/span>(b)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19&lt;/span>&lt;span> &lt;span style="color:#ff79c6">case&lt;/span> &lt;span style="color:#f1fa8c">&amp;#39;:&amp;#39;&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20&lt;/span>&lt;span> &lt;span style="color:#6272a4">// Integer reply
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> r.outPut.&lt;span style="color:#50fa7b">WriteString&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;(integer) &amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22&lt;/span>&lt;span> r.outPut.&lt;span style="color:#50fa7b">Write&lt;/span>(b)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23&lt;/span>&lt;span> &lt;span style="color:#ff79c6">case&lt;/span> &lt;span style="color:#f1fa8c">&amp;#39;$&amp;#39;&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24&lt;/span>&lt;span> l, err &lt;span style="color:#ff79c6">:=&lt;/span> strconv.&lt;span style="color:#50fa7b">Atoi&lt;/span>(&lt;span style="color:#8be9fd;font-style:italic">string&lt;/span>(b))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> err &lt;span style="color:#ff79c6">!=&lt;/span> &lt;span style="color:#ff79c6">nil&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> fmt.&lt;span style="color:#50fa7b">Errorf&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;failed to parse bulk string length: %w&amp;#34;&lt;/span>, err)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> l &lt;span style="color:#ff79c6">==&lt;/span> &lt;span style="color:#ff79c6">-&lt;/span>&lt;span style="color:#bd93f9">1&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29&lt;/span>&lt;span> r.outPut.&lt;span style="color:#50fa7b">WriteString&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;(nil)&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> &lt;span style="color:#ff79c6">nil&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32&lt;/span>&lt;span> rl &lt;span style="color:#ff79c6">:=&lt;/span> l &lt;span style="color:#ff79c6">+&lt;/span> &lt;span style="color:#bd93f9">2&lt;/span> &lt;span style="color:#6272a4">// +2 for \r\n
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> bulkData &lt;span style="color:#ff79c6">:=&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">make&lt;/span>([]&lt;span style="color:#8be9fd">byte&lt;/span>, rl)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34&lt;/span>&lt;span> rl = &lt;span style="color:#bd93f9">0&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35&lt;/span>&lt;span> &lt;span style="color:#ff79c6">for&lt;/span> rl &amp;lt; l {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36&lt;/span>&lt;span> n, err &lt;span style="color:#ff79c6">:=&lt;/span> r.read.&lt;span style="color:#50fa7b">Read&lt;/span>(bulkData[rl:])
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> err &lt;span style="color:#ff79c6">!=&lt;/span> &lt;span style="color:#ff79c6">nil&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> fmt.&lt;span style="color:#50fa7b">Errorf&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;failed to read bulk string data: %w&amp;#34;&lt;/span>, err)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40&lt;/span>&lt;span> rl &lt;span style="color:#ff79c6">+=&lt;/span> n
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> rl &lt;span style="color:#ff79c6">&amp;gt;=&lt;/span> l {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42&lt;/span>&lt;span> &lt;span style="color:#ff79c6">break&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45&lt;/span>&lt;span> r.outPut.&lt;span style="color:#50fa7b">Write&lt;/span>(bulkData[:l]) &lt;span style="color:#6272a4">// Write only the bulk string data
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47&lt;/span>&lt;span> &lt;span style="color:#ff79c6">case&lt;/span> &lt;span style="color:#f1fa8c">&amp;#39;*&amp;#39;&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48&lt;/span>&lt;span> l, err &lt;span style="color:#ff79c6">:=&lt;/span> strconv.&lt;span style="color:#50fa7b">Atoi&lt;/span>(&lt;span style="color:#8be9fd;font-style:italic">string&lt;/span>(b))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> err &lt;span style="color:#ff79c6">!=&lt;/span> &lt;span style="color:#ff79c6">nil&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> fmt.&lt;span style="color:#50fa7b">Errorf&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;failed to parse array length: %w&amp;#34;&lt;/span>, err)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">51&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">52&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> l &lt;span style="color:#ff79c6">==&lt;/span> &lt;span style="color:#ff79c6">-&lt;/span>&lt;span style="color:#bd93f9">1&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">53&lt;/span>&lt;span> r.outPut.&lt;span style="color:#50fa7b">WriteString&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;(nil)&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">54&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> &lt;span style="color:#ff79c6">nil&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">55&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">56&lt;/span>&lt;span> r.outPut.&lt;span style="color:#50fa7b">WriteString&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;(array)\n&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">57&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> l &lt;span style="color:#ff79c6">==&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">58&lt;/span>&lt;span> r.outPut.&lt;span style="color:#50fa7b">WriteString&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;[]&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">59&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> &lt;span style="color:#ff79c6">nil&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">60&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">61&lt;/span>&lt;span> &lt;span style="color:#ff79c6">for&lt;/span> i &lt;span style="color:#ff79c6">:=&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>; i &amp;lt; l; i&lt;span style="color:#ff79c6">++&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">62&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> err = r.&lt;span style="color:#50fa7b">Read&lt;/span>(); err &lt;span style="color:#ff79c6">!=&lt;/span> &lt;span style="color:#ff79c6">nil&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">63&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> err
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">64&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">65&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> i &amp;lt; l&lt;span style="color:#ff79c6">-&lt;/span>&lt;span style="color:#bd93f9">1&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">66&lt;/span>&lt;span> r.outPut.&lt;span style="color:#50fa7b">WriteByte&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#39;\n&amp;#39;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">67&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">68&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">69&lt;/span>&lt;span> &lt;span style="color:#ff79c6">default&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">70&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> fmt.&lt;span style="color:#50fa7b">Errorf&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;unknown Redis response type: %c&amp;#34;&lt;/span>, bf)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">71&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">72&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> &lt;span style="color:#ff79c6">nil&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">73&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">74&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">75&lt;/span>&lt;span>&lt;span style="color:#6272a4">//æŠŠç”¨æˆ·è¾“å…¥çš„å‘½ä»¤å†™å…¥ Redis
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">76&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> (r &lt;span style="color:#ff79c6">*&lt;/span>RedisClient) &lt;span style="color:#50fa7b">Write&lt;/span>(str &lt;span style="color:#8be9fd">string&lt;/span>) &lt;span style="color:#8be9fd">error&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">77&lt;/span>&lt;span> split &lt;span style="color:#ff79c6">:=&lt;/span> strings.&lt;span style="color:#50fa7b">Split&lt;/span>(str, &lt;span style="color:#f1fa8c">&amp;#34; &amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">78&lt;/span>&lt;span> r.writeBuff.&lt;span style="color:#50fa7b">Reset&lt;/span>()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">79&lt;/span>&lt;span> &lt;span style="color:#ff79c6">for&lt;/span> i, s &lt;span style="color:#ff79c6">:=&lt;/span> &lt;span style="color:#ff79c6">range&lt;/span> split {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">80&lt;/span>&lt;span> r.writeBuff.&lt;span style="color:#50fa7b">WriteString&lt;/span>(s)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">81&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> i &amp;lt; &lt;span style="color:#8be9fd;font-style:italic">len&lt;/span>(split)&lt;span style="color:#ff79c6">-&lt;/span>&lt;span style="color:#bd93f9">1&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">82&lt;/span>&lt;span> r.writeBuff.&lt;span style="color:#50fa7b">WriteByte&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#39; &amp;#39;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">83&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">84&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">85&lt;/span>&lt;span> r.writeBuff.&lt;span style="color:#50fa7b">WriteString&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;\r\n&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">86&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">87&lt;/span>&lt;span> _, err &lt;span style="color:#ff79c6">:=&lt;/span> r.conn.&lt;span style="color:#50fa7b">Write&lt;/span>(r.writeBuff.&lt;span style="color:#50fa7b">Bytes&lt;/span>())
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">88&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> err
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">89&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">90&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">91&lt;/span>&lt;span>&lt;span style="color:#6272a4">//è¾“å‡º Redis å“åº”ç»“æœ
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">92&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> (r &lt;span style="color:#ff79c6">*&lt;/span>RedisClient) &lt;span style="color:#50fa7b">Print&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">93&lt;/span>&lt;span> fmt.&lt;span style="color:#50fa7b">Printf&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;%s\n&amp;#34;&lt;/span>, r.outPut.&lt;span style="color:#50fa7b">String&lt;/span>())
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">94&lt;/span>&lt;span> r.outPut.&lt;span style="color:#50fa7b">Reset&lt;/span>()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">95&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æŠŠredisåè®®çš„è§£æåŠŸèƒ½é›†æˆåˆ° &lt;code>RedisClient&lt;/code> ç»“æ„ä½“ä¸­ã€‚&lt;code>Read&lt;/code> æ–¹æ³•è¯»å–å¹¶è§£æ Redis æœåŠ¡å™¨çš„å“åº”ï¼Œ&lt;code>Write&lt;/code> æ–¹æ³•å°†ç”¨æˆ·è¾“å…¥çš„å‘½ä»¤å‘é€åˆ° Redis æœåŠ¡å™¨ï¼Œ&lt;code>Print&lt;/code> æ–¹æ³•è¾“å‡ºè§£æåçš„ç»“æœã€‚åœ¨è§£ææ•°æ®æ—¶ï¼ŒæŠŠéœ€è¦å®ç°çš„å†…å®¹åŒæ­¥å†™å…¥åˆ° &lt;code>outPut&lt;/code> ä¸­ã€‚&lt;/p>
&lt;p>å‘½ä»¤è¡Œçš„è¾“å…¥æ•°æ®å› ç›®å‰ä¸ä¼šæ¶‰åŠåˆ°å¤æ‚çš„å‘½ä»¤ï¼Œä¸€èˆ¬å°±æ˜¯æŸ¥è¯¢æŒ‡å®škeyçš„å†…å®¹ï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥ç”¨ RESP çš„ inline å‘½ä»¤æ ¼å¼ï¼Œæ¯”å¦‚ &lt;code>SET key value&lt;/code>ï¼Œ&lt;code>GET key&lt;/code>ï¼Œ&lt;code>HGETALL key&lt;/code> ç­‰ç­‰ã€‚&lt;/p>
&lt;h2 id="æ•´åˆ">&lt;a href="#%e6%95%b4%e5%90%88" class="header-anchor">&lt;/a>æ•´åˆ
&lt;/h2>&lt;p>åŸºæœ¬åŠŸèƒ½æ¨¡å—å®Œæˆåï¼Œå°±å¯ä»¥æŠŠè¿™äº›åŠŸèƒ½ç»„åˆèµ·æ¥ï¼Œç„¶åæµ‹è¯•äº†&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">package&lt;/span> main
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span>&lt;span style="color:#ff79c6">import&lt;/span> (
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span> &lt;span style="color:#f1fa8c">&amp;#34;bufio&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span> &lt;span style="color:#f1fa8c">&amp;#34;flag&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span> &lt;span style="color:#f1fa8c">&amp;#34;fmt&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span> &lt;span style="color:#f1fa8c">&amp;#34;io&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span> &lt;span style="color:#f1fa8c">&amp;#34;os&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span> &lt;span style="color:#f1fa8c">&amp;#34;strings&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">var&lt;/span> sshHost = flag.&lt;span style="color:#50fa7b">String&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;sshHost&amp;#34;&lt;/span>, &lt;span style="color:#f1fa8c">&amp;#34;&amp;#34;&lt;/span>, &lt;span style="color:#f1fa8c">&amp;#34;SSH server address&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">var&lt;/span> sshUser = flag.&lt;span style="color:#50fa7b">String&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;sshUser&amp;#34;&lt;/span>, &lt;span style="color:#f1fa8c">&amp;#34;&amp;#34;&lt;/span>, &lt;span style="color:#f1fa8c">&amp;#34;SSH username&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">var&lt;/span> sshPassword = flag.&lt;span style="color:#50fa7b">String&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;sshPassword&amp;#34;&lt;/span>, &lt;span style="color:#f1fa8c">&amp;#34;&amp;#34;&lt;/span>, &lt;span style="color:#f1fa8c">&amp;#34;SSH password&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">var&lt;/span> sshKey = flag.&lt;span style="color:#50fa7b">String&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;sshKey&amp;#34;&lt;/span>, &lt;span style="color:#f1fa8c">&amp;#34;&amp;#34;&lt;/span>, &lt;span style="color:#f1fa8c">&amp;#34;Path to SSH private key file path&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">var&lt;/span> redisHost = flag.&lt;span style="color:#50fa7b">String&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;h&amp;#34;&lt;/span>, &lt;span style="color:#f1fa8c">&amp;#34;127.0.0.1&amp;#34;&lt;/span>, &lt;span style="color:#f1fa8c">&amp;#34;Redis server address&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">var&lt;/span> redisPort = flag.&lt;span style="color:#50fa7b">Int&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;p&amp;#34;&lt;/span>, &lt;span style="color:#bd93f9">6379&lt;/span>, &lt;span style="color:#f1fa8c">&amp;#34;Redis server port&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> &lt;span style="color:#50fa7b">main&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21&lt;/span>&lt;span> flag.&lt;span style="color:#50fa7b">Parse&lt;/span>()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> &lt;span style="color:#ff79c6">*&lt;/span>redisHost &lt;span style="color:#ff79c6">==&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;&amp;#34;&lt;/span> &lt;span style="color:#ff79c6">||&lt;/span> &lt;span style="color:#ff79c6">*&lt;/span>redisPort &lt;span style="color:#ff79c6">==&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23&lt;/span>&lt;span> fmt.&lt;span style="color:#50fa7b">Println&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;Redis server address and port must be provided&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24&lt;/span>&lt;span> os.&lt;span style="color:#50fa7b">Exit&lt;/span>(&lt;span style="color:#bd93f9">1&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26&lt;/span>&lt;span> sshConfig &lt;span style="color:#ff79c6">:=&lt;/span> &lt;span style="color:#50fa7b">GetSSHConfig&lt;/span>()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28&lt;/span>&lt;span> sshClient, err &lt;span style="color:#ff79c6">:=&lt;/span> &lt;span style="color:#50fa7b">GetSSHClient&lt;/span>(sshConfig)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> err &lt;span style="color:#ff79c6">!=&lt;/span> &lt;span style="color:#ff79c6">nil&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30&lt;/span>&lt;span> fmt.&lt;span style="color:#50fa7b">Printf&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;Failed to create SSH client: %v\n&amp;#34;&lt;/span>, err)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31&lt;/span>&lt;span> os.&lt;span style="color:#50fa7b">Exit&lt;/span>(&lt;span style="color:#bd93f9">1&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33&lt;/span>&lt;span> fmt.&lt;span style="color:#50fa7b">Printf&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;Connecting to SSH server at %s\r&amp;#34;&lt;/span>, &lt;span style="color:#ff79c6">*&lt;/span>sshHost)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34&lt;/span>&lt;span> &lt;span style="color:#ff79c6">defer&lt;/span> sshClient.&lt;span style="color:#50fa7b">Close&lt;/span>()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36&lt;/span>&lt;span> redisClient, err &lt;span style="color:#ff79c6">:=&lt;/span> &lt;span style="color:#50fa7b">GetRedisClient&lt;/span>(sshClient, fmt.&lt;span style="color:#50fa7b">Sprintf&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;%s:%d&amp;#34;&lt;/span>, &lt;span style="color:#ff79c6">*&lt;/span>redisHost, &lt;span style="color:#ff79c6">*&lt;/span>redisPort))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> err &lt;span style="color:#ff79c6">!=&lt;/span> &lt;span style="color:#ff79c6">nil&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38&lt;/span>&lt;span> fmt.&lt;span style="color:#50fa7b">Printf&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;Failed to connect to Redis server: %v\n&amp;#34;&lt;/span>, err)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39&lt;/span>&lt;span> os.&lt;span style="color:#50fa7b">Exit&lt;/span>(&lt;span style="color:#bd93f9">1&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41&lt;/span>&lt;span> &lt;span style="color:#ff79c6">defer&lt;/span> redisClient.&lt;span style="color:#50fa7b">Close&lt;/span>()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43&lt;/span>&lt;span> fmt.&lt;span style="color:#50fa7b">Printf&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;Connected to Redis server at %s:%d via SSH\r&amp;#34;&lt;/span>, &lt;span style="color:#ff79c6">*&lt;/span>redisHost, &lt;span style="color:#ff79c6">*&lt;/span>redisPort)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45&lt;/span>&lt;span> fmt.&lt;span style="color:#50fa7b">Printf&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;input &amp;#39;exit&amp;#39; or &amp;#39;quit&amp;#39; to exiting process!!!\n&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47&lt;/span>&lt;span> &lt;span style="color:#6272a4">//ä»æ ‡å‡†è¾“å…¥è¯»å–æ•°æ®
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> reader &lt;span style="color:#ff79c6">:=&lt;/span> bufio.&lt;span style="color:#50fa7b">NewReader&lt;/span>(os.Stdin)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49&lt;/span>&lt;span> &lt;span style="color:#ff79c6">for&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50&lt;/span>&lt;span> line, err &lt;span style="color:#ff79c6">:=&lt;/span> reader.&lt;span style="color:#50fa7b">ReadString&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#39;\n&amp;#39;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">51&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> err &lt;span style="color:#ff79c6">!=&lt;/span> &lt;span style="color:#ff79c6">nil&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">52&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> err &lt;span style="color:#ff79c6">==&lt;/span> io.EOF {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">53&lt;/span>&lt;span> fmt.&lt;span style="color:#50fa7b">Println&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;Exiting...&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">54&lt;/span>&lt;span> &lt;span style="color:#ff79c6">break&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">55&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">56&lt;/span>&lt;span> _, _ = fmt.&lt;span style="color:#50fa7b">Fprintf&lt;/span>(os.Stderr, &lt;span style="color:#f1fa8c">&amp;#34;è¯»å–é”™è¯¯: %v\n&amp;#34;&lt;/span>, err)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">57&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">58&lt;/span>&lt;span> line = strings.&lt;span style="color:#50fa7b">TrimSpace&lt;/span>(line)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">59&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> line &lt;span style="color:#ff79c6">==&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;&amp;#34;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">60&lt;/span>&lt;span> &lt;span style="color:#ff79c6">continue&lt;/span> &lt;span style="color:#6272a4">// Skip empty lines
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">61&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">62&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> line &lt;span style="color:#ff79c6">==&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;exit&amp;#34;&lt;/span> &lt;span style="color:#ff79c6">||&lt;/span> line &lt;span style="color:#ff79c6">==&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;quit&amp;#34;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">63&lt;/span>&lt;span> fmt.&lt;span style="color:#50fa7b">Println&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;Exiting...&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">64&lt;/span>&lt;span> &lt;span style="color:#ff79c6">break&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">65&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">66&lt;/span>&lt;span> &lt;span style="color:#6272a4">//å¤„ç†è¾“å…¥çš„å‘½ä»¤
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">67&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">if&lt;/span> err = redisClient.&lt;span style="color:#50fa7b">Write&lt;/span>(line); err &lt;span style="color:#ff79c6">!=&lt;/span> &lt;span style="color:#ff79c6">nil&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">68&lt;/span>&lt;span> _, _ = fmt.&lt;span style="color:#50fa7b">Fprintf&lt;/span>(os.Stderr, &lt;span style="color:#f1fa8c">&amp;#34;å†™å…¥é”™è¯¯: %v\n&amp;#34;&lt;/span>, err)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">69&lt;/span>&lt;span> &lt;span style="color:#ff79c6">continue&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">70&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">71&lt;/span>&lt;span> redisClient.outPut.&lt;span style="color:#50fa7b">Reset&lt;/span>()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">72&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> err = redisClient.&lt;span style="color:#50fa7b">Read&lt;/span>(); err &lt;span style="color:#ff79c6">!=&lt;/span> &lt;span style="color:#ff79c6">nil&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">73&lt;/span>&lt;span> _, _ = fmt.&lt;span style="color:#50fa7b">Fprintf&lt;/span>(os.Stderr, &lt;span style="color:#f1fa8c">&amp;#34;è¯»å–é”™è¯¯: %v\n&amp;#34;&lt;/span>, err)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">74&lt;/span>&lt;span> &lt;span style="color:#ff79c6">continue&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">75&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">76&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">77&lt;/span>&lt;span> redisClient.&lt;span style="color:#50fa7b">Print&lt;/span>()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">78&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">79&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">80&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">81&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> &lt;span style="color:#50fa7b">GetSSHConfig&lt;/span>() &lt;span style="color:#ff79c6">*&lt;/span>SSHConfig {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">82&lt;/span>&lt;span> sshConfig &lt;span style="color:#ff79c6">:=&lt;/span> &lt;span style="color:#ff79c6">&amp;amp;&lt;/span>SSHConfig{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">83&lt;/span>&lt;span> SSHHost: &lt;span style="color:#ff79c6">*&lt;/span>sshHost,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">84&lt;/span>&lt;span> SSHUser: &lt;span style="color:#ff79c6">*&lt;/span>sshUser,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">85&lt;/span>&lt;span> SSHPassword: &lt;span style="color:#ff79c6">*&lt;/span>sshPassword,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">86&lt;/span>&lt;span> SSHKey: &lt;span style="color:#ff79c6">*&lt;/span>sshKey,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">87&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">88&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> sshConfig
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">89&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>é€šè¿‡å‘½ä»¤è¡Œè·å–ç›¸å…³çš„å‚æ•°ï¼Œå¾ªç¯è¯»å–ç”¨æˆ·è¾“å…¥çš„å‘½ä»¤å¹¶å¤„ç†ï¼Œæœ€ç»ˆå°†redisè¿”å›çš„æ•°æ®è¾“å‡ºåˆ°æ ‡å‡†è¾“å‡ºã€‚&lt;/p>
&lt;p>åˆ°è¿™ï¼Œä¸€ä¸ªç®€å•çš„ SSH éš§é“è½¬å‘çš„ redis-cli å·¥å…·å°±å®Œæˆäº†ã€‚&lt;/p>
&lt;p>æœ€åé™„ä¸Š go.mod æ–‡ä»¶çš„å†…å®¹ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-txt" data-lang="txt">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>module tun_redis_cli
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3&lt;/span>&lt;span>go 1.23.1
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5&lt;/span>&lt;span>require (
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6&lt;/span>&lt;span> golang.org/x/crypto v0.41.0 // indirect
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7&lt;/span>&lt;span> golang.org/x/sys v0.35.0 // indirect
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8&lt;/span>&lt;span>)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>ä¸€æ–‡è®²æ¸…æ¥šæ‰€æœ‰IOï¼ŒåŒæ­¥IOï¼Œå¼‚æ­¥IOï¼Œé˜»å¡IOï¼Œéé˜»å¡IOï¼ŒIOå¤šè·¯å¤ç”¨ï¼Œç½‘ç»œç¼–ç¨‹</title><link>https://lqxhub.github.io/posts/fad3c120/</link><pubDate>Sun, 24 Aug 2025 15:09:50 +0800</pubDate><guid>https://lqxhub.github.io/posts/fad3c120/</guid><description>&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/6d6b0bc8be14ed7f83dc3fc00e09b7e1490f76d1.jpg" alt="Featured image of post ä¸€æ–‡è®²æ¸…æ¥šæ‰€æœ‰IOï¼ŒåŒæ­¥IOï¼Œå¼‚æ­¥IOï¼Œé˜»å¡IOï¼Œéé˜»å¡IOï¼ŒIOå¤šè·¯å¤ç”¨ï¼Œç½‘ç»œç¼–ç¨‹" />&lt;p>å‰ä¸¤å¤©å†™äº†ä¸€ç¯‡ &lt;strong>C++åç¨‹ + io_uring&lt;/strong> çš„ &lt;a class="link" href="https://lqxhub.github.io/posts/d26369fd" >æ–‡ç« &lt;/a> ï¼Œé‡Œé¢ä»‹ç»äº†å¦‚ä½•åœ¨ C++ ä¸­ç»“åˆä½¿ç”¨åç¨‹å’Œ io_uring æ¥å®ç°å¼‚æ­¥ I/O æ“ä½œã€‚å†™å®Œè‡ªå·±åœ¨å®¡é˜…æ—¶ï¼Œå›æƒ³èµ·æ¥è‡ªå·±åˆšæ¥è§¦ linux ç½‘ç»œç¼–ç¨‹æ—¶èµ°è¿‡çš„ä¸€äº›å¼¯è·¯ï¼Œä¸€äº›é”™è¯¯çš„ç†è§£ã€‚æ‰€æœ‰å°±æƒ³ç€å†™ä¸€ç¯‡ I/O çš„æ–‡ç« æ€»ç»“ä¸€ä¸‹ã€‚ æ‰€ä»¥ä»Šå¤©æˆ‘ä»¬å°±æ¥èŠèŠå¸¸è§çš„IOç±»å‹ï¼ŒåŒæ­¥ I/O ï¼Œå¼‚æ­¥ I/O ï¼Œé˜»å¡ I/O ï¼Œéé˜»å¡ I/O è¿˜æœ‰ IO å¤šè·¯å¤ç”¨ã€‚&lt;/p>
&lt;p>ä¸€å¼€å§‹æˆ‘é”™è¯¯çš„è®¤ä¸ºï¼Œéé˜»å¡ I/O å°±æ˜¯å¼‚æ­¥ I/O ï¼Œé˜»å¡ I/O å°±æ˜¯åŒæ­¥ I/O ã€‚åæ¥æ‰å‘ç°ï¼ŒåŸæ¥å¹¶ä¸æ˜¯è¿™æ ·çš„ã€‚IO çš„åˆ†ç±»æœ‰ä¸¤ä¸ªç»´åº¦ï¼Œä¸€ä¸ªæ˜¯æŒ‰è°ƒç”¨æ–¹å¼åˆ†ä¸ºï¼š&lt;strong>åŒæ­¥&lt;/strong> å’Œ &lt;strong>å¼‚æ­¥&lt;/strong>ï¼›å¦ä¸€ä¸ªæ˜¯æŒ‰ç­‰å¾…æ–¹å¼åˆ†ä¸ºï¼š&lt;strong>é˜»å¡&lt;/strong> å’Œ &lt;strong>éé˜»å¡&lt;/strong>ã€‚&lt;/p>
&lt;p>ç®€å•è¯´ &lt;strong>é˜»å¡/éé˜»å¡ æ˜¯æŒ‡ å‡½æ•°è°ƒç”¨æ—¶çš„è¿”å›è¡Œä¸º&lt;/strong> ï¼Œè€Œ &lt;strong>åŒæ­¥/å¼‚æ­¥ æ˜¯æŒ‡ I/Oçš„å®Œæˆé€šçŸ¥&lt;/strong> ã€‚
è€Œ &lt;strong>I/Oå¤šè·¯å¤ç”¨&lt;/strong> åˆ™æ˜¯ä¸€ç§ç‰¹æ®Šçš„æŠ€æœ¯ï¼Œæ˜¯æå‡æ•ˆç‡çš„ä¸€ç§æœºåˆ¶ï¼Œå®ƒå…è®¸å•ä¸ªçº¿ç¨‹åŒæ—¶ç®¡ç†å¤šä¸ª I/O æ“ä½œã€‚é€šè¿‡ä½¿ç”¨ &lt;code>select&lt;/code>ã€&lt;code>poll&lt;/code> æˆ– &lt;code>epoll&lt;/code> ç­‰ç³»ç»Ÿè°ƒç”¨ï¼Œåº”ç”¨ç¨‹åºå¯ä»¥åœ¨å¤šä¸ªæ–‡ä»¶æè¿°ç¬¦ä¸Šç­‰å¾…äº‹ä»¶çš„å‘ç”Ÿï¼Œä»è€Œå®ç°é«˜æ•ˆçš„ I/O å¤„ç†ã€‚I/Oå¤šè·¯å¤ç”¨é€šå¸¸ä¸éé˜»å¡ I/O ç»“åˆä½¿ç”¨ï¼Œä»¥æé«˜æ€§èƒ½å’Œå“åº”èƒ½åŠ›ã€‚&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>æ¨¡å‹&lt;/th>
&lt;th>åº”ç”¨è¡Œä¸º&lt;/th>
&lt;th>ç­‰å¾…ä½ç½®&lt;/th>
&lt;th>ä¼˜ç¼ºç‚¹&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>åŒæ­¥ I/O&lt;/td>
&lt;td>ç­‰å¾…å®Œæˆ&lt;/td>
&lt;td>åº”ç”¨è‡ªå·±é˜»å¡&lt;/td>
&lt;td>ç®€å•ï¼Œä½†æ•ˆç‡ä½&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>å¼‚æ­¥ I/O&lt;/td>
&lt;td>å‘èµ·è¯·æ±‚ç«‹åˆ»è¿”å›ï¼Œå®Œæˆåé€šçŸ¥&lt;/td>
&lt;td>å†…æ ¸å¼‚æ­¥å®Œæˆ&lt;/td>
&lt;td>æœ€ç†æƒ³ï¼Œä½†å®ç°å¤æ‚&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>é˜»å¡ I/O&lt;/td>
&lt;td>è°ƒç”¨é˜»å¡ç›´åˆ°æ•°æ®å°±ç»ª&lt;/td>
&lt;td>åº”ç”¨é˜»å¡&lt;/td>
&lt;td>ç¼–ç¨‹ç®€å•ï¼Œä½†æµªè´¹ç­‰å¾…æ—¶é—´&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>éé˜»å¡ I/O&lt;/td>
&lt;td>æ•°æ®æ²¡å¥½ç«‹å³è¿”å›ï¼Œéœ€è¦è½®è¯¢&lt;/td>
&lt;td>åº”ç”¨å±‚è½®è¯¢&lt;/td>
&lt;td>é¿å…é˜»å¡ï¼Œä½†æ•ˆç‡å·®&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>I/O å¤šè·¯å¤ç”¨&lt;/td>
&lt;td>ç»Ÿä¸€ç­‰å¾…å¤šä¸ª I/O å°±ç»ª&lt;/td>
&lt;td>å†…æ ¸ç­‰å¾…ï¼Œåº”ç”¨ä¸€æ¬¡é†’æ¥å¤„ç†&lt;/td>
&lt;td>é«˜æ•ˆï¼Œå¸¸ç”¨äºé«˜å¹¶å‘æœåŠ¡å™¨&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>ä¸‹é¢ç”¨ C ä¸ºæ¯ç§ I/O ç±»å‹å†™ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼Œæ¥å¸®åŠ©ç†è§£ã€‚&lt;/p>
&lt;p>åœ¨linuxä¸­ï¼Œä¸€åˆ‡éƒ½æ˜¯æ–‡ä»¶ï¼ŒåŒ…æ‹¬ç½‘ç»œè¿æ¥å’Œè®¾å¤‡ã€‚é€šè¿‡æ–‡ä»¶æè¿°ç¬¦ï¼Œåº”ç”¨ç¨‹åºå¯ä»¥ä»¥ç»Ÿä¸€çš„æ–¹å¼è¿›è¡ŒI/Oæ“ä½œï¼Œæ‰€ä»¥æœ‰äº›ä¾‹å­ä¸­ï¼Œä½¿ç”¨ &lt;code>open&lt;/code>ã€&lt;code>read&lt;/code> å’Œ &lt;code>close&lt;/code> ç­‰ç³»ç»Ÿè°ƒç”¨æ¥è¿›è¡Œæ–‡ä»¶çš„è¯»å–æ“ä½œã€‚å¯¹äºç½‘ç»œ I/Oï¼Œåº”ç”¨ç¨‹åºå¯ä»¥ä½¿ç”¨ç›¸åŒçš„æ¥å£æ¥è¿›è¡Œæ•°æ®çš„å‘é€å’Œæ¥æ”¶ã€‚&lt;/p>
&lt;h2 id="é˜»å¡io">&lt;a href="#%e9%98%bb%e5%a1%9eio" class="header-anchor">&lt;/a>é˜»å¡I/O
&lt;/h2>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">#include&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;stdio.h&amp;gt;&lt;/span>&lt;span style="color:#ff79c6">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span>&lt;span style="color:#ff79c6">#include&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;stdlib.h&amp;gt;&lt;/span>&lt;span style="color:#ff79c6">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span>&lt;span style="color:#ff79c6">#include&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;unistd.h&amp;gt;&lt;/span>&lt;span style="color:#ff79c6">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span>&lt;span style="color:#ff79c6">#include&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;fcntl.h&amp;gt;&lt;/span>&lt;span style="color:#ff79c6">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span>&lt;span style="color:#ff79c6">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span>&lt;span style="color:#8be9fd">int&lt;/span> &lt;span style="color:#50fa7b">main&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span> &lt;span style="color:#8be9fd">char&lt;/span> buffer[&lt;span style="color:#bd93f9">1024&lt;/span>];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span> &lt;span style="color:#8be9fd">int&lt;/span> fd &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#50fa7b">open&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;file.txt&amp;#34;&lt;/span>, O_RDONLY);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (fd &lt;span style="color:#ff79c6">==&lt;/span> &lt;span style="color:#ff79c6">-&lt;/span>&lt;span style="color:#bd93f9">1&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span> &lt;span style="color:#50fa7b">perror&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;open&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> &lt;span style="color:#bd93f9">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span> &lt;span style="color:#8be9fd">ssize_t&lt;/span> bytesRead &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#50fa7b">read&lt;/span>(fd, buffer, &lt;span style="color:#ff79c6">sizeof&lt;/span>(buffer));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (bytesRead &lt;span style="color:#ff79c6">==&lt;/span> &lt;span style="color:#ff79c6">-&lt;/span>&lt;span style="color:#bd93f9">1&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15&lt;/span>&lt;span> &lt;span style="color:#50fa7b">perror&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;read&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16&lt;/span>&lt;span> &lt;span style="color:#50fa7b">close&lt;/span>(fd);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> &lt;span style="color:#bd93f9">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19&lt;/span>&lt;span> &lt;span style="color:#50fa7b">printf&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;Read %zd bytes: %.*s&lt;/span>&lt;span style="color:#f1fa8c">\n&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;&lt;/span>, bytesRead, (&lt;span style="color:#8be9fd">int&lt;/span>)bytesRead, buffer);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20&lt;/span>&lt;span> &lt;span style="color:#50fa7b">close&lt;/span>(fd);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>read&lt;/code> å‡½æ•° æ“ä½œé»˜è®¤çš„ æ–‡ä»¶æè¿°ç¬¦ (fd) æ˜¯é˜»å¡çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœæ²¡æœ‰æ•°æ®å¯è¯»ï¼Œå®ƒä¼šä¸€ç›´ç­‰å¾…ï¼Œç›´åˆ°æœ‰æ•°æ®å¯è¯»ä¸ºæ­¢ã€‚è¿™ç§æ–¹å¼åœ¨æŸäº›æƒ…å†µä¸‹æ˜¯åˆé€‚çš„ï¼Œä½†åœ¨é«˜å¹¶å‘çš„ç½‘ç»œåº”ç”¨ä¸­ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ€§èƒ½ç“¶é¢ˆã€‚
ä¼˜åŠ¿å°±æ˜¯è¿™ç§é˜»å¡æ–¹å¼ç¼–ç¨‹ç®€å•ï¼Œå®¹æ˜“ç†è§£ã€‚&lt;/p>
&lt;h2 id="éé˜»å¡io">&lt;a href="#%e9%9d%9e%e9%98%bb%e5%a1%9eio" class="header-anchor">&lt;/a>éé˜»å¡I/O
&lt;/h2>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">#include&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;stdio.h&amp;gt;&lt;/span>&lt;span style="color:#ff79c6">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span>&lt;span style="color:#ff79c6">#include&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;unistd.h&amp;gt;&lt;/span>&lt;span style="color:#ff79c6">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span>&lt;span style="color:#ff79c6">#include&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;fcntl.h&amp;gt;&lt;/span>&lt;span style="color:#ff79c6">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span>&lt;span style="color:#ff79c6">#include&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;errno.h&amp;gt;&lt;/span>&lt;span style="color:#ff79c6">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span>&lt;span style="color:#ff79c6">#include&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;string.h&amp;gt;&lt;/span>&lt;span style="color:#ff79c6">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span>&lt;span style="color:#ff79c6">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span>&lt;span style="color:#8be9fd">int&lt;/span> &lt;span style="color:#50fa7b">main&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span> &lt;span style="color:#8be9fd">char&lt;/span> buf[&lt;span style="color:#bd93f9">100&lt;/span>];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span> &lt;span style="color:#8be9fd">int&lt;/span> flags &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#50fa7b">fcntl&lt;/span>(STDIN_FILENO, F_GETFL, &lt;span style="color:#bd93f9">0&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span> &lt;span style="color:#50fa7b">fcntl&lt;/span>(STDIN_FILENO, F_SETFL, flags &lt;span style="color:#ff79c6">|&lt;/span> O_NONBLOCK); &lt;span style="color:#6272a4">// è®¾ç½®éé˜»å¡
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span> &lt;span style="color:#50fa7b">printf&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;éé˜»å¡è¾“å…¥ï¼ˆæ²¡æœ‰è¾“å…¥æ—¶ç«‹å³è¿”å›ï¼‰ï¼š&lt;/span>&lt;span style="color:#f1fa8c">\n&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span> &lt;span style="color:#ff79c6">while&lt;/span> (&lt;span style="color:#bd93f9">1&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span> &lt;span style="color:#8be9fd">ssize_t&lt;/span> n &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#50fa7b">read&lt;/span>(STDIN_FILENO, buf, &lt;span style="color:#ff79c6">sizeof&lt;/span>(buf)&lt;span style="color:#ff79c6">-&lt;/span>&lt;span style="color:#bd93f9">1&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (n &lt;span style="color:#ff79c6">&amp;gt;&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16&lt;/span>&lt;span> buf[n] &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#f1fa8c">&amp;#39;\0&amp;#39;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17&lt;/span>&lt;span> &lt;span style="color:#50fa7b">printf&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;ä½ è¾“å…¥äº†ï¼š%s&lt;/span>&lt;span style="color:#f1fa8c">\n&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;&lt;/span>, buf);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18&lt;/span>&lt;span> &lt;span style="color:#ff79c6">break&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19&lt;/span>&lt;span> } &lt;span style="color:#ff79c6">else&lt;/span> &lt;span style="color:#ff79c6">if&lt;/span> (n &lt;span style="color:#ff79c6">&amp;lt;&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span> &lt;span style="color:#ff79c6">&amp;amp;&amp;amp;&lt;/span> errno &lt;span style="color:#ff79c6">==&lt;/span> EAGAIN) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20&lt;/span>&lt;span> &lt;span style="color:#50fa7b">printf&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;æš‚æ—¶æ²¡æœ‰è¾“å…¥ï¼Œå¹²ç‚¹åˆ«çš„äº‹...&lt;/span>&lt;span style="color:#f1fa8c">\n&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21&lt;/span>&lt;span> &lt;span style="color:#50fa7b">sleep&lt;/span>(&lt;span style="color:#bd93f9">1&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22&lt;/span>&lt;span> } &lt;span style="color:#ff79c6">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23&lt;/span>&lt;span> &lt;span style="color:#ff79c6">break&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™æ¬¡ä½¿ç”¨ æ ‡å‡†è¾“å…¥ï¼ˆ&lt;code>STDIN_FILENO&lt;/code>ï¼‰è¿›è¡Œéé˜»å¡è¯»å–ã€‚&lt;/p>
&lt;p>ä½¿ç”¨ &lt;code>fcntl&lt;/code> å‡½æ•°è®¾ç½®æ–‡ä»¶æè¿°ç¬¦çš„æ ‡å¿—ä½ä¸ºéé˜»å¡ã€‚
åç»­ä½¿ç”¨ &lt;code>read&lt;/code> å‡½æ•°æ“ä½œ è¿™ä¸ªæ–‡ä»¶æè¿°ç¬¦æ—¶ï¼Œå°±ä¼šå˜æˆ &lt;strong>éé˜»å¡I/O&lt;/strong> äº†ã€‚ åœ¨æ²¡æœ‰æ•°æ®å¯è¯»æ—¶ä¼šç«‹å³è¿”å›ï¼Œè€Œä¸æ˜¯é˜»å¡ç­‰å¾…ã€‚ä½¿ç”¨éé˜»å¡I/O ç¼–ç¨‹æ—¶ï¼Œéœ€è¦åˆ¤æ–­ &lt;code>errno&lt;/code> çš„å€¼æ¥åˆ¤æ–­å½“å‰ &lt;code>fd&lt;/code> çš„çŠ¶æ€ã€‚&lt;/p>
&lt;p>å¸¸è§çš„é”™è¯¯ç æœ‰ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;code>EAGAIN&lt;/code>ï¼šè¡¨ç¤ºå½“å‰æ²¡æœ‰æ•°æ®å¯è¯»ï¼Œéé˜»å¡I/Oæ¨¡å¼ä¸‹ä¼šç«‹å³è¿”å›ã€‚&lt;/li>
&lt;li>&lt;code>EINTR&lt;/code>ï¼šè¡¨ç¤ºç³»ç»Ÿè°ƒç”¨è¢«ä¿¡å·ä¸­æ–­ï¼Œå¯èƒ½éœ€è¦é‡è¯•ã€‚&lt;/li>
&lt;li>&lt;code>EINVAL&lt;/code>ï¼šè¡¨ç¤ºæ— æ•ˆçš„æ–‡ä»¶æè¿°ç¬¦æˆ–å‚æ•°ã€‚&lt;/li>
&lt;li>&lt;code>ENETDOWN&lt;/code>ï¼šè¡¨ç¤ºç½‘ç»œå…³é—­ã€‚&lt;/li>
&lt;li>&lt;code>EIO&lt;/code>ï¼šè¡¨ç¤º I/O é”™è¯¯ã€‚&lt;/li>
&lt;li>&lt;code>ETIMEDOUT&lt;/code>ï¼šè¡¨ç¤ºæ“ä½œè¶…æ—¶ã€‚&lt;/li>
&lt;/ul>
&lt;p>åœ¨ç½‘ç»œç¼–ç¨‹ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ &lt;code>accept4&lt;/code> å‡½æ•°æ¥åˆ›å»ºéé˜»å¡çš„ socketã€‚&lt;/p>
&lt;p>å‡½æ•°å®šä¹‰&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>&lt;span style="color:#8be9fd">int&lt;/span> &lt;span style="color:#50fa7b">accept4&lt;/span>(&lt;span style="color:#8be9fd">int&lt;/span> sockfd, &lt;span style="color:#ff79c6">struct&lt;/span> sockaddr &lt;span style="color:#ff79c6">*&lt;/span>addr,&lt;span style="color:#8be9fd">socklen_t&lt;/span> &lt;span style="color:#ff79c6">*&lt;/span>addrlen, &lt;span style="color:#8be9fd">int&lt;/span> flags);
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>sockfdï¼šç›‘å¬socket fdï¼ˆå¿…é¡»æ˜¯ listen çŠ¶æ€ï¼‰ã€‚&lt;/li>
&lt;li>addrï¼šè¿”å›å¯¹ç«¯åœ°å€ï¼ˆå®¢æˆ·ç«¯ IP + ç«¯å£ï¼‰ã€‚å¦‚æœä¸å…³å¿ƒï¼Œå¯ä»¥ä¼  NULLã€‚&lt;/li>
&lt;li>addrlenï¼šè¾“å…¥è¾“å‡ºå‚æ•°ï¼Œä¼ å…¥æ—¶ä¸º addr çš„å¤§å°ï¼Œè¿”å›æ—¶è¡¨ç¤ºå®é™…é•¿åº¦ã€‚&lt;/li>
&lt;li>flagsï¼šé¢å¤–é€‰é¡¹ï¼Œå¯ä»¥æ˜¯ä»¥ä¸‹çš„ æŒ‰ä½æˆ–ï¼š
&lt;code>SOCK_NONBLOCK&lt;/code> è®¾ç½®æ–° socket ä¸ºéé˜»å¡æ¨¡å¼ã€‚
&lt;code>SOCK_CLOEXEC&lt;/code> è®¾ç½® FD_CLOEXECï¼ˆæ‰§è¡Œ exec æ—¶è‡ªåŠ¨å…³é—­ fdï¼‰ã€‚&lt;/li>
&lt;/ul>
&lt;p>è°ƒç”¨æ–¹å¼&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">struct&lt;/span> sockaddr_in cliaddr;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span>&lt;span style="color:#8be9fd">socklen_t&lt;/span> clilen &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#ff79c6">sizeof&lt;/span>(cliaddr);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3&lt;/span>&lt;span>&lt;span style="color:#8be9fd">int&lt;/span> fd &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#50fa7b">accept4&lt;/span>(listenfd,(&lt;span style="color:#ff79c6">struct&lt;/span> sockaddr&lt;span style="color:#ff79c6">*&lt;/span>)&lt;span style="color:#ff79c6">&amp;amp;&lt;/span>cliaddr,&lt;span style="color:#ff79c6">&amp;amp;&lt;/span>clilen, SOCK_NONBLOCK &lt;span style="color:#ff79c6">|&lt;/span> SOCK_CLOEXEC);
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä½¿ç”¨éé˜»å¡I/O å¯ä»¥é¿å…åº”ç”¨ç¨‹åºåœ¨ç­‰å¾… I/O æ“ä½œå®Œæˆæ—¶è¢«é˜»å¡ï¼Œä»è€Œæé«˜æ•´ä½“çš„å“åº”èƒ½åŠ›å’Œå¹¶å‘å¤„ç†èƒ½åŠ›ã€‚&lt;/p>
&lt;p>ä¸€èˆ¬æ¥è¯´ï¼Œéé˜»å¡I/O é€‚ç”¨äºå¯¹å“åº”æ—¶é—´è¦æ±‚è¾ƒé«˜çš„åœºæ™¯ï¼Œæ¯”å¦‚ç½‘ç»œæœåŠ¡ã€å®æ—¶æ•°æ®å¤„ç†ç­‰ã€‚è€Œé˜»å¡I/O åˆ™æ›´é€‚åˆå¯¹æ€§èƒ½è¦æ±‚ä¸é«˜çš„åœºæ™¯ï¼Œæ¯”å¦‚ç®€å•çš„æ–‡ä»¶è¯»å–ç­‰ã€‚&lt;/p>
&lt;p>éé˜»å¡I/O éœ€è¦æ­é… å¤šè·¯å¤ç”¨æŠ€æœ¯ä¸€èµ·ä½¿ç”¨ï¼Œæ‰èƒ½å‘æŒ¥å‡ºæ›´å¥½çš„æ€§èƒ½ã€‚é€šè¿‡ä½¿ç”¨ &lt;code>select&lt;/code>ã€&lt;code>poll&lt;/code> æˆ– &lt;code>epoll&lt;/code> ç­‰ç³»ç»Ÿè°ƒç”¨ï¼Œåº”ç”¨ç¨‹åºå¯ä»¥åœ¨å¤šä¸ªæ–‡ä»¶æè¿°ç¬¦ä¸Šç­‰å¾…äº‹ä»¶çš„å‘ç”Ÿï¼Œä»è€Œå®ç°é«˜æ•ˆçš„ I/O å¤„ç†ï¼Œå…³äºå¤šè·¯å¤ç”¨ï¼Œåé¢ä¼šä»‹ç»&lt;/p>
&lt;h2 id="åŒæ­¥-io">&lt;a href="#%e5%90%8c%e6%ad%a5-io" class="header-anchor">&lt;/a>åŒæ­¥ I/O
&lt;/h2>&lt;p>åœ¨ POSIX è¯­ä¹‰é‡Œï¼Œé˜»å¡ I/O æœ¬è´¨å°±æ˜¯åŒæ­¥ I/Oã€‚è¿˜æœ‰ä¸Šé¢æåˆ°çš„éé˜»å¡ I/Oï¼Œè™½ç„¶å®ƒçš„è¿”å›è¡Œä¸ºæ˜¯éé˜»å¡çš„ï¼Œä½†åœ¨æ•°æ®å‡†å¤‡å¥½ä¹‹å‰ï¼Œåº”ç”¨ç¨‹åºä»ç„¶éœ€è¦ä¸»åŠ¨å»æŸ¥è¯¢çŠ¶æ€ï¼Œè¿™ç§è¡Œä¸ºåœ¨æŸç§ç¨‹åº¦ä¸Šä¹Ÿå¯ä»¥è§†ä¸ºä¸€ç§åŒæ­¥ã€‚&lt;/p>
&lt;p>æ‰€ä»¥å°±ä¸å†é‡å¤è¿™äº›å†…å®¹äº†ã€‚&lt;/p>
&lt;h2 id="å¼‚æ­¥-io">&lt;a href="#%e5%bc%82%e6%ad%a5-io" class="header-anchor">&lt;/a>å¼‚æ­¥ I/O
&lt;/h2>&lt;p>æ‰€è°“çš„ å¼‚æ­¥ I/O ï¼Œæ˜¯æŒ‡åº”ç”¨ç¨‹åºå‘èµ· I/O è¯·æ±‚åï¼Œä¸éœ€è¦ç­‰å¾…æ“ä½œå®Œæˆï¼Œè€Œæ˜¯å¯ä»¥ç»§ç»­æ‰§è¡Œå…¶ä»–ä»»åŠ¡ã€‚å½“ I/O æ“ä½œå®Œæˆåï¼Œå†…æ ¸ä¼šé€šè¿‡æŸç§æœºåˆ¶ï¼ˆå¦‚ä¿¡å·ã€å›è°ƒå‡½æ•°æˆ–äº‹ä»¶é€šçŸ¥ï¼‰æ¥é€šçŸ¥åº”ç”¨ç¨‹åºã€‚&lt;/p>
&lt;p>åœ¨ Linux 5.1 ç‰ˆæœ¬ä¸­ï¼Œå¼•å…¥äº†æ–°çš„å¼‚æ­¥ I/O æ¥å£ï¼ˆ&lt;code>io_uring&lt;/code>ï¼‰ï¼Œå®ƒæä¾›äº†ä¸€ç§æ›´é«˜æ•ˆçš„æ–¹å¼æ¥è¿›è¡Œå¼‚æ­¥ I/O æ“ä½œã€‚é€šè¿‡ &lt;code>io_uring&lt;/code>ï¼Œåº”ç”¨ç¨‹åºå¯ä»¥å°† I/O è¯·æ±‚æäº¤åˆ°å†…æ ¸ï¼Œå¹¶åœ¨è¯·æ±‚å®Œæˆæ—¶è·å¾—é€šçŸ¥ï¼Œä»è€Œå®ç°çœŸæ­£çš„å¼‚æ­¥ I/Oã€‚&lt;/p>
&lt;p>ä¸¾ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼Œæˆ‘å»éº¦å½“åŠ³ç‚¹é¤ã€‚&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/8189404dbacca5d8b4903914b3409258a62e29ac.jpg">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/8189404dbacca5d8b4903914b3409258a62e29ac.jpg" alt="" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>&lt;strong>åŒæ­¥ I/Oï¼š&lt;/strong> æˆ‘èµ°åˆ°æŸœå°å‰ï¼Œå‘Šè¯‰æœåŠ¡å‘˜æˆ‘è¦ç‚¹ä»€ä¹ˆï¼Œç„¶åç«™åœ¨é‚£é‡Œç­‰ç€ï¼Œç›´åˆ°å°å§å§æŠŠæˆ‘çš„é¤ç»™æˆ‘ä¸ºæ­¢ã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­æˆ‘åªèƒ½åœ¨æŸœå°å‰ç­‰å¾…ï¼Œæˆ‘ä¸èƒ½åšå…¶ä»–äº‹æƒ…ï¼Œåªèƒ½ç­‰å¾…ã€‚&lt;/p>
&lt;p>&lt;strong>å¼‚æ­¥ I/Oï¼š&lt;/strong> æˆ‘èµ°åˆ°æŸœå°å‰ï¼Œå‘Šè¯‰æœåŠ¡å‘˜æˆ‘è¦ç‚¹ä»€ä¹ˆï¼Œç„¶åå°±å»æ‰¾åœ°æ–¹åç€ç©æ‰‹æœºäº†ï¼Œç”šè‡³å¯ä»¥å»ä¸Šä¸ªå•æ‰€ã€‚å½“é¤ç‚¹å‡†å¤‡å¥½åï¼Œå°å§å§ä¼šé€šè¿‡æŸç§æ–¹å¼é€šçŸ¥æˆ‘å–é¤ï¼Œæ¯”å¦‚å–Šä¸€å£°XXXå·é¤å¥½äº†ã€‚&lt;/p>
&lt;p>å›åˆ°ç¨‹åºä¸­ï¼ŒåŒæ­¥ I/O åº”ç”¨ç¨‹åºå‘èµ· I/O è¯·æ±‚åï¼Œå¿…é¡»ç­‰å¾…å†…æ ¸å®Œæˆæ“ä½œæ‰èƒ½ç»§ç»­æ‰§è¡Œåç»­ä»£ç ã€‚è€Œå¼‚æ­¥ I/O åˆ™å…è®¸åº”ç”¨ç¨‹åºåœ¨å‘èµ·è¯·æ±‚åç«‹å³è¿”å›ï¼Œç»§ç»­æ‰§è¡Œå…¶ä»–ä»»åŠ¡ï¼Œå†…æ ¸ä¼šåœ¨æ“ä½œå®Œæˆåé€šè¿‡å›è°ƒæˆ–ä¿¡å·çš„æ–¹å¼é€šçŸ¥åº”ç”¨ç¨‹åºã€‚&lt;/p>
&lt;p>å¼‚æ­¥ I/O çš„ä»£ç æ¯”è¾ƒå¤šï¼Œå°±ä¸åœ¨è¿™é‡Œå±•ç¤ºäº†ï¼Œå¯ä»¥å» &lt;a class="link" href="https://lqxhub.github.io/posts/f0e9829c/" >io_uring&lt;/a> å’Œ &lt;a class="link" href="https://lqxhub.github.io/posts/d26369fd/" >C++åç¨‹+io_uring&lt;/a> æŸ¥çœ‹ç›¸å…³å†…å®¹ã€‚&lt;/p>
&lt;h2 id="å¤šè·¯å¤ç”¨">&lt;a href="#%e5%a4%9a%e8%b7%af%e5%a4%8d%e7%94%a8" class="header-anchor">&lt;/a>å¤šè·¯å¤ç”¨
&lt;/h2>&lt;p>ä¹ä¸€å¬è¿™ä¸ªåå­—è¿˜æŒºé«˜å¤§ä¸Šçš„ï¼Œå…¶å®å®ƒçš„æ ¸å¿ƒæ€æƒ³å°±æ˜¯è®©ä¸€ä¸ªçº¿ç¨‹åŒæ—¶ç®¡ç†å¤šä¸ª I/O æ“ä½œï¼Œä»è€Œæé«˜æ•ˆç‡ã€‚æœ€æ—©çš„ç½‘ç»œç¼–ç¨‹ä¸­ï¼Œé€šå¸¸æ˜¯ä¸ºæ¯ä¸ªè¿æ¥åˆ›å»ºä¸€ä¸ªçº¿ç¨‹ï¼Œè¿™æ ·è™½ç„¶ç®€å•ï¼Œä½†åœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹ä¼šå¯¼è‡´çº¿ç¨‹æ•°é‡æ¿€å¢ï¼Œç³»ç»Ÿèµ„æºè€—å°½ã€‚æ‰€æœ‰æœ‰äº† &lt;a class="link" href="https://en.wikipedia.org/wiki/C10k_problem" target="_blank" rel="noopener"
>C10K&lt;/a> è¿æ¥çš„é—®é¢˜ã€‚&lt;/p>
&lt;p>å¾ˆå¤šç¨‹åºå°±æ˜¯ä½¿ç”¨è¿™ç§æ¯ä¸ªçº¿ç¨‹å¤„ç†ä¸€ä¸ªè¿æ¥çš„æ–¹å¼ï¼Œåƒæ˜¯ &lt;strong>Apache HTTP Server&lt;/strong>ï¼Œ&lt;strong>MySQL&lt;/strong> ç¤¾åŒºç‰ˆï¼ˆå¬è¯´ä»˜è´¹ç‰ˆä½¿ç”¨äº†å¤šè·¯å¤ç”¨ï¼‰ç­‰ã€‚&lt;/p>
&lt;p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå‡ºç°äº† I/O å¤šè·¯å¤ç”¨æŠ€æœ¯ã€‚å®ƒå…è®¸ä¸€ä¸ªçº¿ç¨‹åŒæ—¶ç›‘è§†å¤šä¸ª I/O æµï¼Œå¹¶åœ¨å…¶ä¸­ä»»ä½•ä¸€ä¸ªæµå‡†å¤‡å¥½æ—¶è¿›è¡Œå¤„ç†ã€‚å¸¸è§çš„ I/O å¤šè·¯å¤ç”¨æœºåˆ¶æœ‰ &lt;code>select&lt;/code>ã€&lt;code>poll&lt;/code>ã€ &lt;code>epoll&lt;/code> å’Œ &lt;code>kqueue&lt;/code>ã€‚&lt;/p>
&lt;h3 id="select">&lt;a href="#select" class="header-anchor">&lt;/a>select
&lt;/h3>&lt;p>&lt;code>select&lt;/code> æ˜¯ æœ€å¸¸è§çš„ä¸€ç§ å¤šè·¯å¤ç”¨æŠ€æœ¯ï¼Œå‡ ä¹æ‰€æœ‰çš„æ“ä½œç³»ç»Ÿéƒ½æ”¯æŒã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">#include&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;stdio.h&amp;gt;&lt;/span>&lt;span style="color:#ff79c6">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span>&lt;span style="color:#ff79c6">#include&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;unistd.h&amp;gt;&lt;/span>&lt;span style="color:#ff79c6">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span>&lt;span style="color:#ff79c6">#include&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;sys/select.h&amp;gt;&lt;/span>&lt;span style="color:#ff79c6">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span>&lt;span style="color:#ff79c6">#include&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;string.h&amp;gt;&lt;/span>&lt;span style="color:#ff79c6">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span>&lt;span style="color:#ff79c6">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span>&lt;span style="color:#8be9fd">int&lt;/span> &lt;span style="color:#50fa7b">main&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span> &lt;span style="color:#8be9fd">char&lt;/span> buf[&lt;span style="color:#bd93f9">100&lt;/span>];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span> fd_set rfds;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span> &lt;span style="color:#50fa7b">printf&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;å¤šè·¯å¤ç”¨ç­‰å¾…è¾“å…¥ (5ç§’è¶…æ—¶)ï¼š&lt;/span>&lt;span style="color:#f1fa8c">\n&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span> &lt;span style="color:#50fa7b">FD_ZERO&lt;/span>(&lt;span style="color:#ff79c6">&amp;amp;&lt;/span>rfds);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span> &lt;span style="color:#50fa7b">FD_SET&lt;/span>(STDIN_FILENO, &lt;span style="color:#ff79c6">&amp;amp;&lt;/span>rfds);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span> &lt;span style="color:#ff79c6">struct&lt;/span> timeval tv &lt;span style="color:#ff79c6">=&lt;/span> {&lt;span style="color:#bd93f9">5&lt;/span>, &lt;span style="color:#bd93f9">0&lt;/span>}; &lt;span style="color:#6272a4">// 5ç§’è¶…æ—¶
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#8be9fd">int&lt;/span> ret &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#50fa7b">select&lt;/span>(STDIN_FILENO&lt;span style="color:#ff79c6">+&lt;/span>&lt;span style="color:#bd93f9">1&lt;/span>, &lt;span style="color:#ff79c6">&amp;amp;&lt;/span>rfds, &lt;span style="color:#8be9fd;font-style:italic">NULL&lt;/span>, &lt;span style="color:#8be9fd;font-style:italic">NULL&lt;/span>, &lt;span style="color:#ff79c6">&amp;amp;&lt;/span>tv);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (ret &lt;span style="color:#ff79c6">&amp;gt;&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span> &lt;span style="color:#ff79c6">&amp;amp;&amp;amp;&lt;/span> &lt;span style="color:#50fa7b">FD_ISSET&lt;/span>(STDIN_FILENO, &lt;span style="color:#ff79c6">&amp;amp;&lt;/span>rfds)) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17&lt;/span>&lt;span> &lt;span style="color:#8be9fd">ssize_t&lt;/span> n &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#50fa7b">read&lt;/span>(STDIN_FILENO, buf, &lt;span style="color:#ff79c6">sizeof&lt;/span>(buf)&lt;span style="color:#ff79c6">-&lt;/span>&lt;span style="color:#bd93f9">1&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18&lt;/span>&lt;span> buf[n] &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#f1fa8c">&amp;#39;\0&amp;#39;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19&lt;/span>&lt;span> &lt;span style="color:#50fa7b">printf&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;ä½ è¾“å…¥äº†ï¼š%s&lt;/span>&lt;span style="color:#f1fa8c">\n&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;&lt;/span>, buf);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20&lt;/span>&lt;span> } &lt;span style="color:#ff79c6">else&lt;/span> &lt;span style="color:#ff79c6">if&lt;/span> (ret &lt;span style="color:#ff79c6">==&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21&lt;/span>&lt;span> &lt;span style="color:#50fa7b">printf&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;5ç§’å†…æ²¡æœ‰è¾“å…¥ï¼Œè¶…æ—¶ï¼&lt;/span>&lt;span style="color:#f1fa8c">\n&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22&lt;/span>&lt;span> } &lt;span style="color:#ff79c6">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23&lt;/span>&lt;span> &lt;span style="color:#50fa7b">perror&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;select å‡ºé”™&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>select&lt;/code> ä¹Ÿæœ‰ä¸è¶³ä¹‹å¤„ï¼Œæ¯”å¦‚ï¼š&lt;/p>
&lt;ol>
&lt;li>&lt;strong>æ€§èƒ½é—®é¢˜&lt;/strong>ï¼š&lt;code>select&lt;/code> åœ¨æ¯æ¬¡è°ƒç”¨æ—¶éƒ½éœ€è¦æŠŠè¢«ç›‘æ§çš„fdsé›†åˆä»ç”¨æˆ·æ€ç©ºé—´æ‹·è´åˆ°å†…æ ¸æ€ç©ºé—´ï¼Œè¿™åœ¨æ–‡ä»¶æè¿°ç¬¦æ•°é‡è¾ƒå¤šæ—¶ä¼šå¯¼è‡´æ€§èƒ½ä¸‹é™ã€‚&lt;/li>
&lt;li>&lt;strong>æ–‡ä»¶æè¿°ç¬¦æ•°é‡é™åˆ¶&lt;/strong>ï¼š&lt;code>select&lt;/code> å¯¹æ–‡ä»¶æè¿°ç¬¦çš„æ•°é‡æœ‰é™åˆ¶ï¼ˆé€šå¸¸æ˜¯ 1024ï¼‰ï¼Œè¿™åœ¨å¤§é‡è¿æ¥çš„åœºæ™¯ä¸‹å¯èƒ½æˆä¸ºç“¶é¢ˆã€‚&lt;/li>
&lt;li>&lt;strong>è¿”å›çš„æ–‡ä»¶æè¿°ç¬¦é›†åˆéœ€è¦éå†&lt;/strong>ï¼š&lt;code>select&lt;/code> è¿”å›åï¼Œåº”ç”¨ç¨‹åºéœ€è¦éå†æ•´ä¸ªæ–‡ä»¶æè¿°ç¬¦é›†åˆæ¥æ£€æŸ¥å“ªäº›æ–‡ä»¶æè¿°ç¬¦å‡†å¤‡å¥½äº†ï¼Œè¿™åœ¨æ–‡ä»¶æè¿°ç¬¦æ•°é‡è¾ƒå¤šæ—¶æ•ˆç‡è¾ƒä½ã€‚&lt;/li>
&lt;/ol>
&lt;h3 id="poll">&lt;a href="#poll" class="header-anchor">&lt;/a>poll
&lt;/h3>&lt;p>åæ¥ä¸ºäº†è§£å†³ &lt;code>select&lt;/code> çš„ä¸€äº›ä¸è¶³ä¹‹å¤„ï¼Œå‡ºç°äº† &lt;code>poll&lt;/code>ã€‚&lt;code>poll&lt;/code> çš„ä½¿ç”¨æ–¹å¼ä¸ &lt;code>select&lt;/code> ç±»ä¼¼ï¼Œä½†å®ƒä¸å†ä½¿ç”¨å›ºå®šå¤§å°çš„æ–‡ä»¶æè¿°ç¬¦é›†åˆï¼Œè€Œæ˜¯ä½¿ç”¨ä¸€ä¸ªæ•°ç»„æ¥è¡¨ç¤ºæ‰€æœ‰å¾…ç›‘è§†çš„æ–‡ä»¶æè¿°ç¬¦ã€‚è¿™ä½¿å¾— &lt;code>poll&lt;/code> å¯ä»¥æ”¯æŒæ›´å¤šçš„æ–‡ä»¶æè¿°ç¬¦ã€‚ä½†æ˜¯ï¼Œ&lt;code>poll&lt;/code> ä»ç„¶éœ€è¦åœ¨æ¯æ¬¡è°ƒç”¨æ—¶éå†æ•´ä¸ªæ•°ç»„ï¼Œæ€§èƒ½ä¸Šä»ç„¶ä¸å¤Ÿç†æƒ³ã€‚&lt;/p>
&lt;h3 id="epoll">&lt;a href="#epoll" class="header-anchor">&lt;/a>epoll
&lt;/h3>&lt;p>&lt;code>epoll&lt;/code> æ˜¯ Linux 2.6 å¼€å§‹æ”¯æŒçš„ä¸€ç§å¤šè·¯å¤ç”¨æŠ€æœ¯ï¼Œå®ƒå…‹æœäº† &lt;code>select&lt;/code> å’Œ &lt;code>poll&lt;/code> çš„ä¸€äº›ç¼ºç‚¹ã€‚&lt;code>epoll&lt;/code> ä½¿ç”¨äº‹ä»¶é€šçŸ¥æœºåˆ¶ï¼Œå¯ä»¥åœ¨æ–‡ä»¶æè¿°ç¬¦çŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶ç«‹å³é€šçŸ¥åº”ç”¨ç¨‹åºï¼Œè€Œä¸éœ€è¦è½®è¯¢ã€‚è¿™ä½¿å¾— &lt;code>epoll&lt;/code> åœ¨å¤„ç†å¤§é‡å¹¶å‘è¿æ¥æ—¶å…·æœ‰æ›´å¥½çš„æ€§èƒ½ã€‚&lt;/p>
&lt;p>ç¼ºç‚¹å°±æ˜¯å¸¦æ¥äº†æ›´é«˜çš„å¤æ‚æ€§ï¼Œä½¿ç”¨èµ·æ¥ç›¸å¯¹è¾ƒä¸ºå¤æ‚ã€‚&lt;/p>
&lt;p>&lt;a class="link" href="https://lqxhub.github.io/posts/91655bdf" >epoll server&lt;/a> å’Œ &lt;a class="link" href="https://lqxhub.github.io/posts/4f5e5c5f" >epoll æƒŠç¾¤é—®é¢˜&lt;/a> è¿™ä¸¤ç¯‡æ–‡ç« è¯¦ç»†ä»‹ç»äº† &lt;code>epoll&lt;/code> çš„ä½¿ç”¨å’Œæ³¨æ„äº‹é¡¹ã€‚&lt;/p>
&lt;h3 id="kqueue">&lt;a href="#kqueue" class="header-anchor">&lt;/a>kqueue
&lt;/h3>&lt;p>&lt;code>kqueue&lt;/code> æ˜¯ BSD ç³»ç»Ÿç‰¹æœ‰çš„ä¸€ç§å¤šè·¯å¤ç”¨æŠ€æœ¯ï¼Œå®ƒä¸ &lt;code>epoll&lt;/code> ç±»ä¼¼ï¼Œä½¿ç”¨äº‹ä»¶é€šçŸ¥æœºåˆ¶æ¥æé«˜æ€§èƒ½ã€‚&lt;code>kqueue&lt;/code> å¯ä»¥ç›‘è§†æ–‡ä»¶æè¿°ç¬¦ã€ä¿¡å·ã€å®šæ—¶å™¨ç­‰å¤šç§äº‹ä»¶ï¼Œå¹¶åœ¨äº‹ä»¶å‘ç”Ÿæ—¶é€šçŸ¥åº”ç”¨ç¨‹åºã€‚&lt;/p>
&lt;p>&lt;code>kqueue&lt;/code> æ˜¯ BSD ç³»ç»Ÿç‰¹æœ‰çš„æŠ€æœ¯ï¼Œæ— æ³•åœ¨ Linux ä¸Šä½¿ç”¨ã€‚æˆ‘å¹³æ—¶ä¸»è¦åœ¨ Linux ä¸Šè¿›è¡Œå¼€å‘ï¼Œæ‰€ä»¥å°±ä¸åœ¨è¿™é‡Œè´´ä»£ç äº†ã€‚æƒ³è¦äº†è§£å¯ä»¥å»çœ‹ redis çš„æºç ï¼Œé‡Œé¢æœ‰ä½¿ç”¨ &lt;code>kqueue&lt;/code> çš„ä¾‹å­ã€‚&lt;/p>
&lt;p>&lt;a class="link" href="https://github.com/redis/redis/blob/d2c8a4b91e8c0e6aefd1f5bc0bf582cddbe046b7/src/ae_kqueue.c" target="_blank" rel="noopener"
>redis kqueue æºç &lt;/a>&lt;/p>
&lt;p>æˆ‘ä¹‹å‰ä¸º kiwi æ•°æ®åº“å†™è¿‡ä¸€å¥—è·¨å¹³å°çš„ç½‘ç»œåº“ï¼Œé‡Œé¢ä¹Ÿæœ‰ &lt;code>kqueue&lt;/code> çš„å®ç°ã€‚
&lt;a class="link" href="https://github.com/arana-db/kiwi-cpp/blob/unstable/src/net/kqueue_event.cc" target="_blank" rel="noopener"
>kqueue&lt;/a>&lt;/p>
&lt;h3 id="ä¸åŒå¤šè·¯å¤ç”¨åŒºåˆ«">&lt;a href="#%e4%b8%8d%e5%90%8c%e5%a4%9a%e8%b7%af%e5%a4%8d%e7%94%a8%e5%8c%ba%e5%88%ab" class="header-anchor">&lt;/a>ä¸åŒå¤šè·¯å¤ç”¨åŒºåˆ«
&lt;/h3>&lt;table>
&lt;thead>
&lt;tr>
&lt;th>ç‰¹æ€§&lt;/th>
&lt;th>select&lt;/th>
&lt;th>poll&lt;/th>
&lt;th>epoll&lt;/th>
&lt;th>kqueue&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>fd ä¸Šé™&lt;/td>
&lt;td>1024 (FD_SETSIZE)&lt;/td>
&lt;td>æ— å›ºå®šä¸Šé™&lt;/td>
&lt;td>æ— å›ºå®šä¸Šé™&lt;/td>
&lt;td>æ— å›ºå®šä¸Šé™&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>fd é›†åˆç®¡ç†&lt;/td>
&lt;td>ä½å›¾ï¼Œæ¯æ¬¡é‡ç½®&lt;/td>
&lt;td>æ•°ç»„ï¼Œæ¯æ¬¡é‡ç½®&lt;/td>
&lt;td>å†…æ ¸ç»´æŠ¤çº¢é»‘æ ‘&lt;/td>
&lt;td>å†…æ ¸ç»´æŠ¤&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>è¿”å›ç»“æœ&lt;/td>
&lt;td>éå†æ‰€æœ‰ fd&lt;/td>
&lt;td>éå†æ‰€æœ‰ fd&lt;/td>
&lt;td>ç›´æ¥è¿”å›æ´»è·ƒ fd&lt;/td>
&lt;td>ç›´æ¥è¿”å›æ´»è·ƒ fd&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>æ—¶é—´å¤æ‚åº¦&lt;/td>
&lt;td>O(n)&lt;/td>
&lt;td>O(n)&lt;/td>
&lt;td>O(æ´»è·ƒ fd)&lt;/td>
&lt;td>O(æ´»è·ƒ fd)&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>è§¦å‘æ–¹å¼&lt;/td>
&lt;td>æ°´å¹³è§¦å‘&lt;/td>
&lt;td>æ°´å¹³è§¦å‘&lt;/td>
&lt;td>æ°´å¹³ + è¾¹ç¼˜è§¦å‘&lt;/td>
&lt;td>æ°´å¹³ + è¾¹ç¼˜è§¦å‘&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>&lt;code>epoll&lt;/code>ï¼Œ&lt;code>kqueue&lt;/code> æ¯” &lt;code>select&lt;/code>ï¼Œ&lt;code>poll&lt;/code> æ›´åŠ é«˜æ•ˆçš„åŸå› ã€‚&lt;/p>
&lt;ol>
&lt;li>&lt;strong>äº‹ä»¶é©±åŠ¨æœºåˆ¶&lt;/strong>ï¼š&lt;code>epoll&lt;/code> å’Œ &lt;code>kqueue&lt;/code> éƒ½æ˜¯åŸºäºäº‹ä»¶é©±åŠ¨çš„æ¨¡å‹ï¼Œå†…æ ¸ä¼šåœ¨äº‹ä»¶å‘ç”Ÿæ—¶é€šçŸ¥åº”ç”¨ç¨‹åºï¼Œè€Œä¸”åªå…³æ³¨é‚£äº›å·²ç»å°±ç»ªçš„fdå³å¯ï¼Œè€Œä¸æ˜¯åƒ &lt;code>select&lt;/code> å’Œ &lt;code>poll&lt;/code> æ¯æ¬¡éƒ½éœ€è¦éå†æ‰€æœ‰ fd&lt;/li>
&lt;li>&lt;strong>é¿å…é¢‘ç¹çš„æ•°æ®æ‹·è´&lt;/strong>ï¼šæ¯æ¬¡è°ƒç”¨ select æˆ– poll æ—¶ï¼Œéƒ½éœ€è¦å°†æ•´ä¸ª fd é›†åˆä»ç”¨æˆ·æ€å¤åˆ¶åˆ°å†…æ ¸æ€ï¼Œè°ƒç”¨ç»“æŸåå†å°†ç»“æœä»å†…æ ¸æ€å¤åˆ¶å›ç”¨æˆ·æ€ã€‚è¿™ç§é¢‘ç¹çš„æ•°æ®æ‹·è´åœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹ä¼šå¸¦æ¥è¾ƒå¤§çš„æ€§èƒ½å¼€é”€ã€‚epoll å’Œ kqueue ä½¿ç”¨äº†å†…å­˜æ˜ å°„ï¼Œå†…æ ¸æ€å’Œç”¨æˆ·æ€å¯ä»¥è®¿é—®åŒä¸€å—ç‰©ç†å†…å­˜ï¼Œé¿å…äº†è¿™ç§é¢‘ç¹çš„æ•°æ®æ‹·è´ï¼Œæå‡äº†æ€§èƒ½ã€‚&lt;/li>
&lt;li>&lt;strong>æ”¯æŒå¤§è§„æ¨¡å¹¶å‘&lt;/strong>ï¼š&lt;code>epoll&lt;/code> å’Œ &lt;code>kqueue&lt;/code> éƒ½å¯ä»¥æ”¯æŒå¤§é‡çš„å¹¶å‘è¿æ¥ï¼Œè€Œ &lt;code>select&lt;/code> å’Œ &lt;code>poll&lt;/code> åœ¨æ–‡ä»¶æè¿°ç¬¦æ•°é‡è¾ƒå¤šæ—¶ä¼šå‡ºç°æ€§èƒ½ç“¶é¢ˆã€‚&lt;/li>
&lt;li>&lt;strong>æ›´çµæ´»çš„è§¦å‘æ–¹å¼&lt;/strong>ï¼š&lt;code>epoll&lt;/code> å’Œ &lt;code>kqueue&lt;/code> æ”¯æŒæ°´å¹³è§¦å‘å’Œè¾¹ç¼˜è§¦å‘ï¼Œåº”ç”¨ç¨‹åºå¯ä»¥æ ¹æ®éœ€è¦é€‰æ‹©åˆé€‚çš„è§¦å‘æ–¹å¼ï¼Œä»è€Œæé«˜æ€§èƒ½ã€‚&lt;/li>
&lt;/ol>
&lt;p>å†æ¥èŠä¸€ä¸‹ &lt;strong>æ°´å¹³è§¦å‘ï¼ˆLTï¼‰&lt;/strong> å’Œ &lt;strong>è¾¹ç¼˜è§¦å‘ï¼ˆETï¼‰&lt;/strong> çš„åŒºåˆ«ã€‚&lt;/p>
&lt;ul>
&lt;li>
&lt;p>&lt;strong>æ°´å¹³è§¦å‘ï¼ˆLTï¼‰&lt;/strong>ï¼šå½“æ–‡ä»¶æè¿°ç¬¦çš„çŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶ï¼Œå†…æ ¸ä¼šé€šçŸ¥åº”ç”¨ç¨‹åºã€‚åº”ç”¨ç¨‹åºéœ€è¦åœ¨æ¯æ¬¡è°ƒç”¨æ—¶æ£€æŸ¥æ–‡ä»¶æè¿°ç¬¦çš„çŠ¶æ€ï¼Œå¦‚æœçŠ¶æ€ä»ç„¶å°±ç»ªï¼Œåˆ™ä¼šé‡å¤æ¥æ”¶é€šçŸ¥ã€‚è¿™ç§æ–¹å¼ç®€å•æ˜“ç”¨ï¼Œä½†åœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹å¯èƒ½å¯¼è‡´å¤§é‡é‡å¤é€šçŸ¥ï¼Œæµªè´¹ CPU èµ„æºã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>è¾¹ç¼˜è§¦å‘ï¼ˆETï¼‰&lt;/strong>ï¼šåªæœ‰å½“æ–‡ä»¶æè¿°ç¬¦çš„çŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶ï¼Œå†…æ ¸æ‰ä¼šé€šçŸ¥åº”ç”¨ç¨‹åºã€‚åº”ç”¨ç¨‹åºåœ¨æ¥æ”¶åˆ°é€šçŸ¥åï¼Œéœ€è¦ç«‹å³è¯»å–æ‰€æœ‰å¯ç”¨æ•°æ®ï¼Œç›´åˆ°è¿”å› EAGAIN é”™è¯¯ã€‚è¿™ç§æ–¹å¼å¯ä»¥å‡å°‘é‡å¤é€šçŸ¥ï¼Œæé«˜æ€§èƒ½ï¼Œä½†å®ç°èµ·æ¥ç›¸å¯¹å¤æ‚ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h2 id="æ€»ç»“">&lt;a href="#%e6%80%bb%e7%bb%93" class="header-anchor">&lt;/a>æ€»ç»“
&lt;/h2>&lt;p>ä»¥ä¸Šå°±æ˜¯å¯¹é˜»å¡ I/Oã€éé˜»å¡ I/Oã€åŒæ­¥ I/Oã€å¼‚æ­¥ I/O å’Œå¤šè·¯å¤ç”¨ç­‰æ¦‚å¿µçš„ä»‹ç»ã€‚é€šè¿‡å¯¹æ¯”ä¸åŒ I/O æ¨¡å‹çš„ä¼˜ç¼ºç‚¹å’Œé€‚ç”¨åœºæ™¯ï¼Œå¯ä»¥åœ¨å®é™…å¼€å‘ä¸­é€‰æ‹©åˆé€‚çš„ I/O æ¨¡å‹ï¼Œä»¥æé«˜åº”ç”¨ç¨‹åºçš„æ€§èƒ½å’Œå“åº”èƒ½åŠ›ã€‚&lt;/p>
&lt;p>æ²¡æœ‰ä¸‡èƒ½çš„è§£å†³æ–¹æ¡ˆï¼Œåªæœ‰æœ€åˆé€‚çš„é€‰æ‹©ï¼Œç›®å‰æˆ‘äº†è§£åˆ°çš„ï¼Œå®Œå…¨ç”¨å¼‚æ­¥ I/O çš„æœåŠ¡ç«¯è¿˜æ˜¯æ¯”è¾ƒå°‘ï¼Œæ¯”è¾ƒå¸¸ç”¨çš„è¿˜æ˜¯ éé˜»å¡ I/O+å¤šè·¯å¤ç”¨æŠ€æœ¯ã€‚&lt;/p>
&lt;p>ä»¥ä¸Šéƒ½æ˜¯ç”¨ C/C++ ç¼–ç¨‹æ—¶ï¼Œè‡ªå·±æ‰‹å†™çš„I/Oæ“ä½œç¤ºä¾‹ã€‚å› ä¸º C++ STL æ²¡æœ‰æä¾›ç½‘ç»œåº“ï¼ŒIOåº“ï¼Œæ‰€ä»¥éœ€è¦æ‰‹åŠ¨å®ç°è¿™äº›åŠŸèƒ½ã€‚&lt;/p>
&lt;p>å¦‚æœæ˜¯ä½¿ç”¨ golang è¿™äº›æ–°çš„è¯­è¨€ï¼Œå¾ˆå¤šI/Oæ“ä½œéƒ½è¢«å°è£…å¥½äº†ï¼Œç›´æ¥è°ƒç”¨å°±è¡Œäº†ã€‚æ ¹æœ¬ä¸ç”¨å…³å¿ƒåº•å±‚çš„å®ç°ç»†èŠ‚ã€‚&lt;/p>
&lt;p>ä½†æ˜¯è¿™äº›åº•å±‚çš„çŸ¥è¯†å¤šäº†è§£ä¸€ç‚¹è¿˜æ˜¯æœ‰ç”¨å¤„çš„ã€‚&lt;/p></description></item><item><title>linuxä¸­io_uringå’ŒC++åç¨‹çš„ç»“åˆï¼Œå®ç°çœŸæ­£çš„å¼‚æ­¥I/Oã€‚ç®€å•çš„TCP echo server</title><link>https://lqxhub.github.io/posts/d26369fd/</link><pubDate>Sat, 23 Aug 2025 17:04:05 +0800</pubDate><guid>https://lqxhub.github.io/posts/d26369fd/</guid><description>&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/cc0fd96def7c84c2e2b5d6a00915b3b8175116cf.jpg" alt="Featured image of post linuxä¸­io_uringå’ŒC++åç¨‹çš„ç»“åˆï¼Œå®ç°çœŸæ­£çš„å¼‚æ­¥I/Oã€‚ç®€å•çš„TCP echo server" />&lt;p>å‰ä¸¤å¤©åˆšå†™äº†ä¸€ç¯‡æ–‡ç« ï¼Œæ€æ ·åœ¨C++ä¸­ä½¿ç”¨åç¨‹ &lt;a class="link" href="https://lqxhub.github.io/posts/541b707d" >ä¼ é€é—¨&lt;/a>ã€‚é‚£ä¸ªåªæ˜¯ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼Œä»Šå¤©æˆ‘ä»¬æ¥èŠèŠå¦‚ä½•å°†åç¨‹ä¸ io_uring ç»“åˆèµ·æ¥ä½¿ç”¨ï¼Œå®ç°çœŸæ­£çš„å¼‚æ­¥ I/O æ“ä½œã€‚
æˆ‘ä¸ªäººè§‰å¾—ï¼ŒC++åç¨‹æœ€å¥½çš„ä½¿ç”¨åœºæ™¯å°±æ˜¯é…åˆå¼‚æ­¥ I/Oã€‚&lt;/p>
&lt;p>ä»¥å‰ä¹Ÿå†™è¿‡ä¸€ç¯‡å…³äº io_uring çš„æ–‡ç«  &lt;a class="link" href="https://lqxhub.github.io/posts/f0e9829c" >ä¼ é€é—¨&lt;/a>ï¼Œé‡Œé¢ä»‹ç»äº† io_uring çš„åŸºæœ¬æ¦‚å¿µå’Œä½¿ç”¨æ–¹æ³•ã€‚ä»Šå¤©æˆ‘ä»¬å°±åŸºäºé‚£ä¸ªä¾‹å­ï¼Œæ¥å®ç°ä¸€ä¸ªç®€å•çš„ echo æœåŠ¡å™¨ï¼Œä½¿ç”¨åç¨‹æ¥å¤„ç†å®¢æˆ·ç«¯çš„è¿æ¥å’Œæ•°æ®æ”¶å‘ã€‚&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/872dbc550f1e63b8d6052bf661f991174671534b.svg">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/872dbc550f1e63b8d6052bf661f991174671534b.svg" alt="" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>ç®€å•ç”»ä¸€ä¸ªå›¾ï¼Œæ¯ä¸€ä¸ª &lt;code>Awaitable&lt;/code> éƒ½æ˜¯ä¸€ä¸ªåç¨‹ï¼Œåœ¨ä¸€ä¸ªè¿›ç¨‹ä¸­ï¼Œæ¯ä¸€ä¸ªè¿æ¥éƒ½æœ‰ä¸¤ä¸ªåç¨‹ï¼ˆä¸€ä¸ªç”¨äºè¯»ï¼Œä¸€ä¸ªç”¨äºå†™ï¼‰ã€‚è¿˜æœ‰ä¸€ä¸ªç‰¹æ®Šçš„åç¨‹ &lt;code>AwaitableAccept&lt;/code> ç”¨æ¥å¤„ç†æ¥å—è¿æ¥çš„æ“ä½œã€‚
åŒä¸€æ—¶åˆ»ï¼Œæœ€å¤šåªèƒ½æœ‰ä¸€ä¸ªåç¨‹åœ¨æ‰§è¡Œã€‚å…¶ä»–çš„åç¨‹ä¼šè¢«æŒ‚èµ·ï¼Œç­‰å¾…å½“å‰åç¨‹å®Œæˆåå†æ¢å¤æ‰§è¡Œã€‚&lt;/p>
&lt;p>å› ä¸ºåç¨‹å¯ä»¥è®©æˆ‘ä»¬ä»¥åŒæ­¥çš„æ–¹å¼ç¼–å†™å¼‚æ­¥ä»£ç ï¼Œé¿å…ä¼ ç»Ÿçš„â€œå›è°ƒå‡½æ•°åœ°ç‹±â€ï¼Œä»è€Œæé«˜ä»£ç çš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚è€Œ io_uring åˆ™æ˜¯ Linux æä¾›çš„ä¸€ç§é«˜æ€§èƒ½å¼‚æ­¥ I/O æ¥å£ï¼Œå¯ä»¥ä¸åç¨‹ç»“åˆä½¿ç”¨ï¼Œè¿›ä¸€æ­¥æå‡æ€§èƒ½ã€‚&lt;/p>
&lt;p>å› ä¸ºä»£ç é‡æœ‰ç‚¹å¤§ï¼Œå°±ä¸å…¨è´´åœ¨è¿™é‡Œäº†ï¼Œå·²ç»ä¸Šä¼ åˆ°GitHubä¸Šï¼Œå¯ä»¥å»è¿™é‡ŒæŸ¥çœ‹ &lt;a class="link" href="https://github.com/lqxhub/co_uring_server" target="_blank" rel="noopener"
>ä¼ é€é—¨&lt;/a>ã€‚&lt;/p>
&lt;p>ä¸åºŸè¯äº†ï¼Œç›´æ¥ä¸Šä»£ç &lt;/p>
&lt;h2 id="coroutine-handle">&lt;a href="#coroutine-handle" class="header-anchor">&lt;/a>coroutine handle
&lt;/h2>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">#ifndef TASK_H
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span>&lt;span style="color:#ff79c6">#define TASK_H
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span>&lt;span style="color:#ff79c6">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span>&lt;span style="color:#ff79c6">#include&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;coroutine&amp;gt;&lt;/span>&lt;span style="color:#ff79c6">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span>&lt;span style="color:#ff79c6">#include&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;exception&amp;gt;&lt;/span>&lt;span style="color:#ff79c6">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span>&lt;span style="color:#ff79c6">#include&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;functional&amp;gt;&lt;/span>&lt;span style="color:#ff79c6">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span>&lt;span style="color:#ff79c6">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span>&lt;span style="color:#ff79c6">template&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;&lt;/span>&lt;span style="color:#8be9fd">bool&lt;/span> initialSuspend&lt;span style="color:#ff79c6">&amp;gt;&lt;/span> &lt;span style="color:#ff79c6">struct&lt;/span> &lt;span style="color:#50fa7b">Task&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span> &lt;span style="color:#ff79c6">struct&lt;/span> &lt;span style="color:#50fa7b">promise_type&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span> std&lt;span style="color:#ff79c6">::&lt;/span>coroutine_handle&lt;span style="color:#ff79c6">&amp;lt;&amp;gt;&lt;/span> handle;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span> std&lt;span style="color:#ff79c6">::&lt;/span>function&lt;span style="color:#ff79c6">&amp;lt;&lt;/span>&lt;span style="color:#8be9fd">void&lt;/span>()&lt;span style="color:#ff79c6">&amp;gt;&lt;/span> onDone; &lt;span style="color:#6272a4">// åç¨‹ç»“æŸæ—¶è°ƒç”¨çš„æ¸…ç†å›è°ƒ
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span> &lt;span style="color:#ff79c6">auto&lt;/span> &lt;span style="color:#50fa7b">get_return_object&lt;/span>() { &lt;span style="color:#ff79c6">return&lt;/span> Task{&lt;span style="color:#ff79c6">*&lt;/span>&lt;span style="color:#ff79c6">this&lt;/span>}; }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15&lt;/span>&lt;span> &lt;span style="color:#ff79c6">auto&lt;/span> &lt;span style="color:#50fa7b">initial_suspend&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> &lt;span style="color:#ff79c6">constexpr&lt;/span> (initialSuspend) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> std&lt;span style="color:#ff79c6">::&lt;/span>suspend_always{};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18&lt;/span>&lt;span> } &lt;span style="color:#ff79c6">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> std&lt;span style="color:#ff79c6">::&lt;/span>suspend_never{};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23&lt;/span>&lt;span> &lt;span style="color:#ff79c6">auto&lt;/span> &lt;span style="color:#50fa7b">final_suspend&lt;/span>() &lt;span style="color:#ff79c6">noexcept&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24&lt;/span>&lt;span> &lt;span style="color:#ff79c6">struct&lt;/span> &lt;span style="color:#50fa7b">Awaiter&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25&lt;/span>&lt;span> &lt;span style="color:#8be9fd">bool&lt;/span> await_ready() &lt;span style="color:#ff79c6">noexcept&lt;/span> { &lt;span style="color:#ff79c6">return&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">false&lt;/span>; }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27&lt;/span>&lt;span> &lt;span style="color:#8be9fd">void&lt;/span> await_suspend(std&lt;span style="color:#ff79c6">::&lt;/span>coroutine_handle&lt;span style="color:#ff79c6">&amp;lt;&lt;/span>promise_type&lt;span style="color:#ff79c6">&amp;gt;&lt;/span> h) &lt;span style="color:#ff79c6">noexcept&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (h.promise().onDone) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29&lt;/span>&lt;span> h.promise().onDone();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33&lt;/span>&lt;span> &lt;span style="color:#8be9fd">void&lt;/span> await_resume() &lt;span style="color:#ff79c6">noexcept&lt;/span> {}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34&lt;/span>&lt;span> };
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> Awaiter{};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38&lt;/span>&lt;span> &lt;span style="color:#8be9fd">void&lt;/span> &lt;span style="color:#50fa7b">unhandled_exception&lt;/span>() { std&lt;span style="color:#ff79c6">::&lt;/span>terminate(); }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40&lt;/span>&lt;span> &lt;span style="color:#8be9fd">void&lt;/span> &lt;span style="color:#50fa7b">return_void&lt;/span>() {}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42&lt;/span>&lt;span> promise_type() &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#ff79c6">default&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43&lt;/span>&lt;span> &lt;span style="color:#ff79c6">~&lt;/span>promise_type() &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#ff79c6">default&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44&lt;/span>&lt;span> };
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46&lt;/span>&lt;span> &lt;span style="color:#ff79c6">explicit&lt;/span> &lt;span style="color:#50fa7b">Task&lt;/span>(promise_type &lt;span style="color:#ff79c6">&amp;amp;&lt;/span>promise)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47&lt;/span>&lt;span> &lt;span style="color:#ff79c6">:&lt;/span> handle_(std&lt;span style="color:#ff79c6">::&lt;/span>coroutine_handle&lt;span style="color:#ff79c6">&amp;lt;&lt;/span>promise_type&lt;span style="color:#ff79c6">&amp;gt;::&lt;/span>from_promise(promise)) {}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49&lt;/span>&lt;span> Task(Task &lt;span style="color:#ff79c6">&amp;amp;&amp;amp;&lt;/span>other) &lt;span style="color:#ff79c6">noexcept&lt;/span> &lt;span style="color:#ff79c6">:&lt;/span> handle_(other.handle_) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50&lt;/span>&lt;span> other.handle_ &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#ff79c6">nullptr&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">51&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">52&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">53&lt;/span>&lt;span> Task &lt;span style="color:#ff79c6">&amp;amp;&lt;/span>&lt;span style="color:#ff79c6">operator&lt;/span>&lt;span style="color:#ff79c6">=&lt;/span>(Task &lt;span style="color:#ff79c6">&amp;amp;&amp;amp;&lt;/span>other) &lt;span style="color:#ff79c6">noexcept&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">54&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (&lt;span style="color:#ff79c6">this&lt;/span> &lt;span style="color:#ff79c6">!=&lt;/span> &lt;span style="color:#ff79c6">&amp;amp;&lt;/span>other) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">55&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (handle_ &lt;span style="color:#ff79c6">&amp;amp;&amp;amp;&lt;/span> &lt;span style="color:#ff79c6">!&lt;/span>handle_.done())
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">56&lt;/span>&lt;span> handle_.destroy();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">57&lt;/span>&lt;span> handle_ &lt;span style="color:#ff79c6">=&lt;/span> other.handle_;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">58&lt;/span>&lt;span> other.handle_ &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#ff79c6">nullptr&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">59&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">60&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> &lt;span style="color:#ff79c6">*&lt;/span>&lt;span style="color:#ff79c6">this&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">61&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">62&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">63&lt;/span>&lt;span> Task(&lt;span style="color:#ff79c6">const&lt;/span> Task &lt;span style="color:#ff79c6">&amp;amp;&lt;/span>) &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#ff79c6">delete&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">64&lt;/span>&lt;span> Task &lt;span style="color:#ff79c6">&amp;amp;&lt;/span>&lt;span style="color:#ff79c6">operator&lt;/span>&lt;span style="color:#ff79c6">=&lt;/span>(&lt;span style="color:#ff79c6">const&lt;/span> Task &lt;span style="color:#ff79c6">&amp;amp;&lt;/span>) &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#ff79c6">delete&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">65&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">66&lt;/span>&lt;span> &lt;span style="color:#ff79c6">~&lt;/span>Task() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">67&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (handle_ &lt;span style="color:#ff79c6">&amp;amp;&amp;amp;&lt;/span> &lt;span style="color:#ff79c6">!&lt;/span>handle_.done())
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">68&lt;/span>&lt;span> handle_.destroy();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">69&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">70&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">71&lt;/span>&lt;span> &lt;span style="color:#8be9fd">void&lt;/span> &lt;span style="color:#50fa7b">resume&lt;/span>() { handle_.resume(); }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">72&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">73&lt;/span>&lt;span> &lt;span style="color:#8be9fd">void&lt;/span> &lt;span style="color:#50fa7b">setOnDone&lt;/span>(std&lt;span style="color:#ff79c6">::&lt;/span>function&lt;span style="color:#ff79c6">&amp;lt;&lt;/span>&lt;span style="color:#8be9fd">void&lt;/span>()&lt;span style="color:#ff79c6">&amp;gt;&lt;/span> onDone) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">74&lt;/span>&lt;span> handle_.promise().onDone &lt;span style="color:#ff79c6">=&lt;/span> std&lt;span style="color:#ff79c6">::&lt;/span>move(onDone);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">75&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">76&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">77&lt;/span>&lt;span>&lt;span style="color:#ff79c6">private&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">78&lt;/span>&lt;span> std&lt;span style="color:#ff79c6">::&lt;/span>coroutine_handle&lt;span style="color:#ff79c6">&amp;lt;&lt;/span>promise_type&lt;span style="color:#ff79c6">&amp;gt;&lt;/span> handle_;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">79&lt;/span>&lt;span>};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">80&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">81&lt;/span>&lt;span>&lt;span style="color:#ff79c6">#endif &lt;/span>&lt;span style="color:#6272a4">// TASK_H
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ç®€å•è¯´ä¸€ä¸‹å‡ ä¸ªå…³é”®ç‚¹ï¼š&lt;/p>
&lt;ol>
&lt;li>
&lt;p>ä½¿ç”¨æ¨¡æ¿å˜é‡ï¼Œæ¥æ§åˆ¶åç¨‹çš„åˆå§‹æŒ‚èµ·çŠ¶æ€ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>åœ¨åç¨‹ç»“æŸæ—¶ï¼Œå¯ä»¥é€šè¿‡ &lt;code>onDone&lt;/code> å›è°ƒæ¥æ‰§è¡Œæ¸…ç†æ“ä½œã€‚
åœ¨åç¨‹ç»“æŸæ—¶ï¼Œå¯ä»¥è°ƒç”¨è¿™ä¸ªå‡½æ•°ï¼Œå®Œæˆä¸€äº›è‡ªå®šä¹‰æ“ä½œï¼Œåé¢ä¼šç”¨åˆ°ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>åç¨‹ç»“æŸæ—¶ä¼šè‡ªåŠ¨è°ƒç”¨ &lt;code>final_suspend&lt;/code>ï¼Œå¯ä»¥åœ¨è¿™é‡Œè¿›è¡Œä¸€äº›æ”¶å°¾å·¥ä½œã€‚
final_suspendä¸­å®šä¹‰äº†ä¸€ä¸ª &lt;code>Awaiter&lt;/code>ï¼Œç”¨äºåœ¨åç¨‹ç»“æŸæ—¶æ‰§è¡Œæ¸…ç†æ“ä½œã€‚å½“åç¨‹ç»“æŸæ—¶ï¼Œ&lt;code>Awaiter&lt;/code> ä¼šè¢«å”¤é†’ï¼Œä»è€Œè°ƒç”¨ &lt;code>onDone&lt;/code> å›è°ƒã€‚å½“ &lt;code>onDone&lt;/code> æ‰§è¡Œå®Œæˆåï¼Œåç¨‹çš„èµ„æºä¼šè¢«é‡Šæ”¾ã€‚&lt;/p>
&lt;/li>
&lt;/ol>
&lt;h2 id="io_uring-wrapper">&lt;a href="#io_uring-wrapper" class="header-anchor">&lt;/a>io_uring wrapper
&lt;/h2>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">class&lt;/span> &lt;span style="color:#50fa7b">IoUring&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span>&lt;span style="color:#ff79c6">public&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span> &lt;span style="color:#ff79c6">explicit&lt;/span> IoUring(&lt;span style="color:#8be9fd">int&lt;/span> port) &lt;span style="color:#ff79c6">:&lt;/span> port_(port) {}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span> IoUring(&lt;span style="color:#ff79c6">const&lt;/span> IoUring &lt;span style="color:#ff79c6">&amp;amp;&lt;/span>) &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#ff79c6">delete&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span> IoUring &lt;span style="color:#ff79c6">&amp;amp;&lt;/span>&lt;span style="color:#ff79c6">operator&lt;/span>&lt;span style="color:#ff79c6">=&lt;/span>(&lt;span style="color:#ff79c6">const&lt;/span> IoUring &lt;span style="color:#ff79c6">&amp;amp;&lt;/span>) &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#ff79c6">delete&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span> IoUring(IoUring &lt;span style="color:#ff79c6">&amp;amp;&amp;amp;&lt;/span>) &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#ff79c6">delete&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span> IoUring &lt;span style="color:#ff79c6">&amp;amp;&lt;/span>&lt;span style="color:#ff79c6">operator&lt;/span>&lt;span style="color:#ff79c6">=&lt;/span>(IoUring &lt;span style="color:#ff79c6">&amp;amp;&amp;amp;&lt;/span>) &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#ff79c6">delete&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span> &lt;span style="color:#ff79c6">~&lt;/span>IoUring() &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#ff79c6">default&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span> &lt;span style="color:#8be9fd">void&lt;/span> &lt;span style="color:#50fa7b">Stop&lt;/span>() { running_.store(&lt;span style="color:#8be9fd;font-style:italic">false&lt;/span>); }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span> io_uring &lt;span style="color:#ff79c6">&amp;amp;&lt;/span>Uring() { &lt;span style="color:#ff79c6">return&lt;/span> ring_; }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16&lt;/span>&lt;span> std&lt;span style="color:#ff79c6">::&lt;/span>expected&lt;span style="color:#ff79c6">&amp;lt;&lt;/span>&lt;span style="color:#8be9fd">bool&lt;/span>, std&lt;span style="color:#ff79c6">::&lt;/span>string&lt;span style="color:#ff79c6">&amp;gt;&lt;/span> Init();&lt;span style="color:#6272a4">//åˆå§‹åŒ–io_uringå’Œç½‘ç»œ
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#8be9fd">void&lt;/span> &lt;span style="color:#50fa7b">run&lt;/span>();&lt;span style="color:#6272a4">//è¿è¡Œio_uringäº‹ä»¶å¾ªç¯
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> Task&lt;span style="color:#ff79c6">&amp;lt;&lt;/span>&lt;span style="color:#8be9fd;font-style:italic">true&lt;/span>&lt;span style="color:#ff79c6">&amp;gt;&lt;/span> acceptServer();&lt;span style="color:#6272a4">//æ¥å—å®¢æˆ·ç«¯è¿æ¥
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20&lt;/span>&lt;span> Task&lt;span style="color:#ff79c6">&amp;lt;&lt;/span>&lt;span style="color:#8be9fd;font-style:italic">false&lt;/span>&lt;span style="color:#ff79c6">&amp;gt;&lt;/span> startSession(&lt;span style="color:#8be9fd">int&lt;/span> fd, &lt;span style="color:#8be9fd">uint64_t&lt;/span> connId);&lt;span style="color:#6272a4">//å¤„ç†å®¢æˆ·ç«¯ä¼šè¯
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22&lt;/span>&lt;span>&lt;span style="color:#ff79c6">private&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23&lt;/span>&lt;span> std&lt;span style="color:#ff79c6">::&lt;/span>expected&lt;span style="color:#ff79c6">&amp;lt;&lt;/span>&lt;span style="color:#8be9fd">bool&lt;/span>, std&lt;span style="color:#ff79c6">::&lt;/span>string&lt;span style="color:#ff79c6">&amp;gt;&lt;/span> createListenSocket();&lt;span style="color:#6272a4">//åˆ›å»ºç›‘å¬socket
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25&lt;/span>&lt;span> &lt;span style="color:#ff79c6">static&lt;/span> &lt;span style="color:#8be9fd">int&lt;/span> &lt;span style="color:#50fa7b">set_nonblocking&lt;/span>(&lt;span style="color:#8be9fd">int&lt;/span> fd) {&lt;span style="color:#6272a4">//è®¾ç½®socketä¸ºéé˜»å¡IO
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">return&lt;/span> fcntl(fd, F_SETFL, fcntl(fd, F_GETFL, &lt;span style="color:#bd93f9">0&lt;/span>) &lt;span style="color:#ff79c6">|&lt;/span> O_NONBLOCK);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29&lt;/span>&lt;span> &lt;span style="color:#8be9fd">uint64_t&lt;/span> &lt;span style="color:#50fa7b">getConnId&lt;/span>() { &lt;span style="color:#ff79c6">return&lt;/span> &lt;span style="color:#ff79c6">++&lt;/span>connId; }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31&lt;/span>&lt;span> io_uring ring_{};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32&lt;/span>&lt;span> &lt;span style="color:#8be9fd">uint16_t&lt;/span> port_;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33&lt;/span>&lt;span> &lt;span style="color:#8be9fd">int&lt;/span> listenFd_ &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#ff79c6">-&lt;/span>&lt;span style="color:#bd93f9">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34&lt;/span>&lt;span> &lt;span style="color:#ff79c6">const&lt;/span> &lt;span style="color:#8be9fd">int&lt;/span> entries_ &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#bd93f9">256&lt;/span>; &lt;span style="color:#6272a4">// Default number of entries
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> std&lt;span style="color:#ff79c6">::&lt;/span>atomic&lt;span style="color:#ff79c6">&amp;lt;&lt;/span>&lt;span style="color:#8be9fd">bool&lt;/span>&lt;span style="color:#ff79c6">&amp;gt;&lt;/span> running_ &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">true&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37&lt;/span>&lt;span> &lt;span style="color:#8be9fd">uint64_t&lt;/span> connId &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>; &lt;span style="color:#6272a4">// Connection ID for tracking connections
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39&lt;/span>&lt;span> std&lt;span style="color:#ff79c6">::&lt;/span>unordered_map&lt;span style="color:#ff79c6">&amp;lt;&lt;/span>&lt;span style="color:#8be9fd">uint64_t&lt;/span>, Task&lt;span style="color:#ff79c6">&amp;lt;&lt;/span>&lt;span style="color:#8be9fd;font-style:italic">false&lt;/span>&lt;span style="color:#ff79c6">&amp;gt;&amp;gt;&lt;/span> sessions_;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40&lt;/span>&lt;span>};
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä»¥ä¸Šå°±æ˜¯å¯¹ io_uring çš„ä¸€ä¸ªç®€å•å°è£…ï¼Œä¸‹é¢æŒ‘å‡ ä¸ªå…³é”®çš„å‡½æ•°æ¥èŠä¸€ä¸‹&lt;/p>
&lt;h3 id="iouringrun">&lt;a href="#iouringrun" class="header-anchor">&lt;/a>IoUring::run
&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#8be9fd">void&lt;/span> IoUring&lt;span style="color:#ff79c6">::&lt;/span>run() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span> &lt;span style="color:#ff79c6">while&lt;/span> (running_.load()) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span> io_uring_cqe &lt;span style="color:#ff79c6">*&lt;/span>cqe &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#ff79c6">nullptr&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span> &lt;span style="color:#8be9fd">int&lt;/span> ret &lt;span style="color:#ff79c6">=&lt;/span> io_uring_wait_cqe(&lt;span style="color:#ff79c6">&amp;amp;&lt;/span>ring_, &lt;span style="color:#ff79c6">&amp;amp;&lt;/span>cqe);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (ret &lt;span style="color:#ff79c6">&amp;lt;&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (ret &lt;span style="color:#ff79c6">==&lt;/span> &lt;span style="color:#ff79c6">-&lt;/span>EINTR)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span> &lt;span style="color:#ff79c6">continue&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span> &lt;span style="color:#ff79c6">break&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span> &lt;span style="color:#6272a4">// user_data ä¿å­˜ç€ Op æŒ‡é’ˆ
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">auto&lt;/span> &lt;span style="color:#ff79c6">*&lt;/span>op &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#ff79c6">reinterpret_cast&lt;/span>&lt;span style="color:#ff79c6">&amp;lt;&lt;/span>AwaitableBaseOp &lt;span style="color:#ff79c6">*&amp;gt;&lt;/span>(cqe&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>user_data);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (&lt;span style="color:#ff79c6">!&lt;/span>op) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span> io_uring_cqe_seen(&lt;span style="color:#ff79c6">&amp;amp;&lt;/span>ring_, cqe);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span> &lt;span style="color:#ff79c6">continue&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16&lt;/span>&lt;span> op&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>SetRes(cqe&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>res);&lt;span style="color:#6272a4">//è®¾ç½®æ“ä½œç»“æœ
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> io_uring_cqe_seen(&lt;span style="color:#ff79c6">&amp;amp;&lt;/span>ring_, cqe);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19&lt;/span>&lt;span> op&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>resume();&lt;span style="color:#6272a4">//æ¢å¤åç¨‹æ‰§è¡Œ
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å¾ªç¯éå† &lt;code>io_uring&lt;/code> çš„å®Œæˆé˜Ÿåˆ—ï¼Œå¤„ç†æ¯ä¸ªå®Œæˆçš„æ“ä½œã€‚&lt;/p>
&lt;p>&lt;code>AwaitableBaseOp&lt;/code> æ˜¯æ‰€æœ‰å¯ç­‰å¾…æ“ä½œçš„åŸºç±»ï¼Œè´Ÿè´£ç®¡ç†åç¨‹çš„çŠ¶æ€å’Œç”Ÿå‘½å‘¨æœŸï¼Œåé¢ä¼šç”¨åˆ°ã€‚&lt;/p>
&lt;p>&lt;code>op-&amp;gt;SetRes(cqe-&amp;gt;res);&lt;/code> æŠŠio_uringçš„ç»“æœä¼ é€’ç»™æ“ä½œå¯¹è±¡ã€‚&lt;/p>
&lt;p>åœ¨ &lt;code>op-&amp;gt;resume()&lt;/code> è¢«è°ƒç”¨æ—¶ï¼Œåç¨‹ä¼šç»§ç»­æ‰§è¡Œï¼Œç›´è‡³ä¸‹ä¸€ä¸ªæŒ‚èµ·ç‚¹ã€‚&lt;/p>
&lt;h3 id="iouringstartsession">&lt;a href="#iouringstartsession" class="header-anchor">&lt;/a>IoUring::startSession
&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>Task&lt;span style="color:#ff79c6">&amp;lt;&lt;/span>&lt;span style="color:#8be9fd;font-style:italic">false&lt;/span>&lt;span style="color:#ff79c6">&amp;gt;&lt;/span> IoUring&lt;span style="color:#ff79c6">::&lt;/span>startSession(&lt;span style="color:#8be9fd">int&lt;/span> fd, &lt;span style="color:#8be9fd">uint64_t&lt;/span> connId) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span> std&lt;span style="color:#ff79c6">::&lt;/span>string buffer;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span> buffer.resize(&lt;span style="color:#bd93f9">1024&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span> &lt;span style="color:#ff79c6">while&lt;/span> (&lt;span style="color:#8be9fd;font-style:italic">true&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span> &lt;span style="color:#ff79c6">auto&lt;/span> res &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#ff79c6">co_await&lt;/span> AwaitableRead(&lt;span style="color:#ff79c6">this&lt;/span>, fd, buffer);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (res &lt;span style="color:#ff79c6">&amp;lt;=&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span> &lt;span style="color:#ff79c6">break&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span> std&lt;span style="color:#ff79c6">::&lt;/span>cout &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;Received data: &amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span> std&lt;span style="color:#ff79c6">::&lt;/span>cout.write(buffer.data(), res);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span> std&lt;span style="color:#ff79c6">::&lt;/span>cout &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> std&lt;span style="color:#ff79c6">::&lt;/span>endl;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span> res &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#ff79c6">co_await&lt;/span> AwaitableWrite(&lt;span style="color:#ff79c6">this&lt;/span>, fd, std&lt;span style="color:#ff79c6">::&lt;/span>move(std&lt;span style="color:#ff79c6">::&lt;/span>string(buffer)));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (res &lt;span style="color:#ff79c6">&amp;lt;=&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span> &lt;span style="color:#ff79c6">break&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17&lt;/span>&lt;span> close(fd);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18&lt;/span>&lt;span> &lt;span style="color:#ff79c6">co_return&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å¯åŠ¨ä¸€ä¸ªå®¢æˆ·ç«¯ä¼šè¯ï¼Œå¤„ç†æ•°æ®çš„è¯»å–å’Œå†™å…¥ã€‚&lt;/p>
&lt;p>ä½¿ç”¨ &lt;code>co_await&lt;/code> å…³é”®å­—æ¥ç­‰å¾…å¼‚æ­¥æ“ä½œçš„å®Œæˆã€‚&lt;/p>
&lt;p>&lt;code>co_await AwaitableRead&lt;/code> è¿™é‡Œä¼šæŠŠå½“å‰åç¨‹æŒ‚èµ·ï¼Œç„¶åå½“è¯»å–æ“ä½œå®Œæˆæ—¶ï¼Œåç¨‹ä¼šè¢«å”¤é†’ï¼Œå¹¶ä¸”å¯ä»¥è·å–åˆ°è¯»å–çš„ç»“æœã€‚&lt;/p>
&lt;p>&lt;code>co_await AwaitableWrite&lt;/code> è¿™é‡ŒåŒæ ·ä¼šæŠŠå½“å‰åç¨‹æŒ‚èµ·ï¼Œç­‰å¾…å†™å…¥æ“ä½œå®Œæˆã€‚&lt;/p>
&lt;h3 id="iouringacceptserver">&lt;a href="#iouringacceptserver" class="header-anchor">&lt;/a>IoUring::acceptServer
&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>Task&lt;span style="color:#ff79c6">&amp;lt;&lt;/span>&lt;span style="color:#8be9fd;font-style:italic">true&lt;/span>&lt;span style="color:#ff79c6">&amp;gt;&lt;/span> IoUring&lt;span style="color:#ff79c6">::&lt;/span>acceptServer() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span> &lt;span style="color:#ff79c6">while&lt;/span> (&lt;span style="color:#8be9fd;font-style:italic">true&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span> &lt;span style="color:#ff79c6">auto&lt;/span> clientFd &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#ff79c6">co_await&lt;/span> AwaitableAccept(&lt;span style="color:#ff79c6">this&lt;/span>, listenFd_);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span> std&lt;span style="color:#ff79c6">::&lt;/span>cout &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> clientFd &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> std&lt;span style="color:#ff79c6">::&lt;/span>endl;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (clientFd &lt;span style="color:#ff79c6">&amp;lt;&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span> &lt;span style="color:#ff79c6">break&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span> set_nonblocking(clientFd);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span> &lt;span style="color:#ff79c6">auto&lt;/span> connId &lt;span style="color:#ff79c6">=&lt;/span> getConnId();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span> &lt;span style="color:#ff79c6">auto&lt;/span> t &lt;span style="color:#ff79c6">=&lt;/span> startSession(clientFd, connId);&lt;span style="color:#6272a4">//å¯åŠ¨ä¸€ä¸ªå®¢æˆ·ç«¯ä¼šè¯ï¼Œå¤„ç†æ•°æ®çš„è¯»å–å’Œå†™å…¥ã€‚
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> t.setOnDone([connId, &lt;span style="color:#ff79c6">this&lt;/span>]() { sessions_.erase(connId); });
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span> sessions_.emplace(connId, std&lt;span style="color:#ff79c6">::&lt;/span>move(t));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span> close(listenFd_);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15&lt;/span>&lt;span> &lt;span style="color:#ff79c6">co_return&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å¼€å§‹ä¸€ä¸ªæœåŠ¡å™¨ç«¯çš„ä¼šè¯ï¼Œæ¥å—å®¢æˆ·ç«¯è¿æ¥ã€‚&lt;/p>
&lt;p>&lt;code>co_await AwaitableAccept&lt;/code> è¿™é‡Œä¼šæŠŠå½“å‰åç¨‹æŒ‚èµ·ï¼Œå½“æœ‰å®¢æˆ·ç«¯è¿æ¥æ—¶ï¼Œåç¨‹ä¼šè¢«å”¤é†’ï¼Œå¹¶ä¸”å¯ä»¥è·å–åˆ°æ¥å—çš„ç»“æœã€‚&lt;/p>
&lt;p>&lt;code>auto t = startSession(clientFd, connId);&lt;/code> è¿™é‡Œä¼šå¯åŠ¨ä¸€ä¸ªåç¨‹ï¼Œå¤„ç†æ•°æ®çš„è¯»å–å’Œå†™å…¥ã€‚
è¿™é‡Œæœ‰ä¸ªå…³é”®ç‚¹ï¼Œ&lt;code>startSession&lt;/code> ä¼šè¿”å›ä¸€ä¸ªåç¨‹çš„å¥æŸ„ï¼Œä¸€å®šè¦å¦¥å–„ä¿ç®¡è¿™ä¸ªå¥æŸ„ï¼Œå¦‚æœæ²¡æœ‰ä¿å­˜ï¼Œå½“ &lt;code>while&lt;/code> å¾ªç¯ç»“æŸæ—¶ï¼Œåç¨‹ä¼šè¢«é”€æ¯ï¼Œå¯¼è‡´å¼‚å¸¸ã€‚
æ‰€ä»¥è¦æŠŠåç¨‹çš„å¥æŸ„ä¿å­˜åœ¨ &lt;code>sessions_&lt;/code> è¿™ä¸ª map ä¸­ï¼Œä»¥ä¾¿åç»­ç®¡ç†ã€‚&lt;/p>
&lt;p>&lt;code>t.setOnDone([connId, this]() { sessions_.erase(connId); });&lt;/code> åœ¨è¿™é‡Œï¼Œé€šè¿‡è®¾ç½®å›è°ƒå‡½æ•°ï¼Œè®¾ç½®äº†åç¨‹å®Œæˆåçš„æ¸…ç†å·¥ä½œã€‚&lt;/p>
&lt;h3 id="awaitablebaseop">&lt;a href="#awaitablebaseop" class="header-anchor">&lt;/a>AwaitableBaseOp
&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">class&lt;/span> &lt;span style="color:#50fa7b">AwaitableBaseOp&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span>&lt;span style="color:#ff79c6">public&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span> &lt;span style="color:#ff79c6">explicit&lt;/span> AwaitableBaseOp(std&lt;span style="color:#ff79c6">::&lt;/span>coroutine_handle&lt;span style="color:#ff79c6">&amp;lt;&amp;gt;&lt;/span> h) &lt;span style="color:#ff79c6">:&lt;/span> coro_(h) {}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span> &lt;span style="color:#ff79c6">virtual&lt;/span> &lt;span style="color:#ff79c6">~&lt;/span>AwaitableBaseOp() &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#ff79c6">default&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span> &lt;span style="color:#8be9fd">void&lt;/span> &lt;span style="color:#50fa7b">resume&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (coro_ &lt;span style="color:#ff79c6">&amp;amp;&amp;amp;&lt;/span> &lt;span style="color:#ff79c6">!&lt;/span>coro_.done()) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span> coro_.resume();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span> &lt;span style="color:#8be9fd">void&lt;/span> &lt;span style="color:#50fa7b">SetRes&lt;/span>(&lt;span style="color:#8be9fd">int&lt;/span> res) { res_ &lt;span style="color:#ff79c6">=&lt;/span> res; }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15&lt;/span>&lt;span> &lt;span style="color:#8be9fd">int&lt;/span> &lt;span style="color:#50fa7b">GetRes&lt;/span>() &lt;span style="color:#ff79c6">const&lt;/span> { &lt;span style="color:#ff79c6">return&lt;/span> res_; }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17&lt;/span>&lt;span>&lt;span style="color:#ff79c6">protected&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18&lt;/span>&lt;span> std&lt;span style="color:#ff79c6">::&lt;/span>coroutine_handle&lt;span style="color:#ff79c6">&amp;lt;&amp;gt;&lt;/span> coro_;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19&lt;/span>&lt;span> &lt;span style="color:#8be9fd">int&lt;/span> res_ &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20&lt;/span>&lt;span>};
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å®šä¹‰äº†åç¨‹çš„åŸºæœ¬æ“ä½œï¼ŒåŒ…æ‹¬æ¢å¤åç¨‹å’Œè®¾ç½®ç»“æœã€‚è¿™ä¸ªç±»çš„å®ä¾‹çš„æŒ‡é’ˆä¼šè¢«ä¼ é€’ç»™ &lt;code>io_uring_sqe&lt;/code> çš„ user_data ä¸­ã€‚
å½“ &lt;code>io_uring&lt;/code> çš„å¼‚æ­¥æ“ä½œå®Œæˆæ—¶ï¼Œ&lt;code>io_uring&lt;/code> é€šè¿‡å¾—åˆ° &lt;code>io_uring_cqe&lt;/code> &lt;code>AwaitableBaseOp&lt;/code> çš„æŒ‡é’ˆï¼Œè°ƒç”¨ &lt;code>SetRes&lt;/code> æ¥è®¾ç½®ç»“æœï¼Œç„¶åè°ƒç”¨ &lt;code>resume&lt;/code> æ¥æ¢å¤åç¨‹ã€‚&lt;/p>
&lt;h3 id="awaitable">&lt;a href="#awaitable" class="header-anchor">&lt;/a>Awaitable
&lt;/h3>&lt;p>éœ€è¦åˆ° accept read write çš„æ“ä½œéƒ½å¯ä»¥å°è£…æˆä¸€ä¸ª Awaitable ç±»ï¼Œæ–¹ä¾¿ç®¡ç†åç¨‹çš„çŠ¶æ€å’Œç”Ÿå‘½å‘¨æœŸã€‚&lt;/p>
&lt;h4 id="accept">&lt;a href="#accept" class="header-anchor">&lt;/a>accept
&lt;/h4>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">class&lt;/span> &lt;span style="color:#50fa7b">AwaitableAccept&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span> IoUring &lt;span style="color:#ff79c6">*&lt;/span>uring_ &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#ff79c6">nullptr&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span> sockaddr_storage addr_{};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span> socklen_t addrlen_{};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span> &lt;span style="color:#8be9fd">int&lt;/span> serverFd_ &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span> AwaitableBaseOp &lt;span style="color:#ff79c6">*&lt;/span>op &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#ff79c6">nullptr&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span>&lt;span style="color:#ff79c6">public&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span> &lt;span style="color:#6272a4">//çœç•¥éƒ¨åˆ†ä»£ç 
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span> &lt;span style="color:#ff79c6">~&lt;/span>AwaitableAccept() &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#ff79c6">default&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span> &lt;span style="color:#8be9fd">bool&lt;/span> &lt;span style="color:#50fa7b">await_ready&lt;/span>() &lt;span style="color:#ff79c6">const&lt;/span> &lt;span style="color:#ff79c6">noexcept&lt;/span> { &lt;span style="color:#ff79c6">return&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">false&lt;/span>; }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16&lt;/span>&lt;span> &lt;span style="color:#8be9fd">void&lt;/span> &lt;span style="color:#50fa7b">await_suspend&lt;/span>(std&lt;span style="color:#ff79c6">::&lt;/span>coroutine_handle&lt;span style="color:#ff79c6">&amp;lt;&amp;gt;&lt;/span> h) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17&lt;/span>&lt;span> op &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#ff79c6">new&lt;/span> AwaitableBaseOp(h);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19&lt;/span>&lt;span> io_uring_sqe &lt;span style="color:#ff79c6">*&lt;/span>sqe &lt;span style="color:#ff79c6">=&lt;/span> io_uring_get_sqe(&lt;span style="color:#ff79c6">&amp;amp;&lt;/span>uring_&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>Uring());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20&lt;/span>&lt;span> io_uring_prep_accept(sqe, serverFd_, &lt;span style="color:#ff79c6">reinterpret_cast&lt;/span>&lt;span style="color:#ff79c6">&amp;lt;&lt;/span>sockaddr &lt;span style="color:#ff79c6">*&amp;gt;&lt;/span>(&lt;span style="color:#ff79c6">&amp;amp;&lt;/span>addr_),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21&lt;/span>&lt;span> &lt;span style="color:#ff79c6">&amp;amp;&lt;/span>addrlen_, &lt;span style="color:#bd93f9">0&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22&lt;/span>&lt;span> io_uring_sqe_set_data(sqe, op);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23&lt;/span>&lt;span> io_uring_submit(&lt;span style="color:#ff79c6">&amp;amp;&lt;/span>uring_&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>Uring());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26&lt;/span>&lt;span> &lt;span style="color:#8be9fd">int&lt;/span> &lt;span style="color:#50fa7b">await_resume&lt;/span>() &lt;span style="color:#ff79c6">const&lt;/span> &lt;span style="color:#ff79c6">noexcept&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27&lt;/span>&lt;span> &lt;span style="color:#8be9fd">int&lt;/span> res &lt;span style="color:#ff79c6">=&lt;/span> op&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>GetRes();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28&lt;/span>&lt;span> &lt;span style="color:#ff79c6">delete&lt;/span> op;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> res;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31&lt;/span>&lt;span>};
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™æ˜¯ &lt;code>AwaitableAccept&lt;/code> ç±»çš„å®ç°ï¼Œå°è£…äº†å¯¹ &lt;code>io_uring&lt;/code> çš„ accept æ“ä½œã€‚é€šè¿‡ä½¿ç”¨åç¨‹ï¼Œå¯ä»¥æ–¹ä¾¿åœ°ç®¡ç†å¼‚æ­¥ I/O æ“ä½œçš„çŠ¶æ€å’Œç”Ÿå‘½å‘¨æœŸã€‚&lt;/p>
&lt;p>&lt;code>await_suspend&lt;/code> å‡½æ•°ä¼šåœ¨åç¨‹æŒ‚èµ·æ—¶ï¼ˆco_await æ“ä½œï¼‰è¢«è°ƒç”¨ï¼Œè´Ÿè´£å°†åç¨‹çš„å¥æŸ„ä¸ &lt;code>io_uring&lt;/code> çš„è¯·æ±‚å…³è”èµ·æ¥ã€‚
åœ¨å‡½æ•°å†…éƒ¨ï¼Œåˆ›å»ºä¸€ä¸ª &lt;code>AwaitableBaseOp&lt;/code> å¯¹è±¡ï¼Œå¹¶å°†åç¨‹çš„å¥æŸ„ä¼ é€’ç»™å®ƒã€‚ç„¶åï¼Œå‡†å¤‡ä¸€ä¸ª &lt;code>io_uring&lt;/code> çš„æäº¤è¯·æ±‚ï¼Œå¹¶å°† &lt;code>AwaitableBaseOp&lt;/code> å¯¹è±¡çš„æŒ‡é’ˆè®¾ç½®ä¸ºè¯·æ±‚çš„ç”¨æˆ·æ•°æ®ã€‚æœ€åï¼Œæäº¤è¯·æ±‚åˆ° &lt;code>io_uring&lt;/code>ã€‚&lt;/p>
&lt;p>&lt;code>await_resume&lt;/code> å‡½æ•°ä¼šåœ¨åç¨‹æ¢å¤æ—¶ï¼ˆè°ƒç”¨ &lt;code>resume&lt;/code>ï¼‰è¢«è°ƒç”¨ï¼Œè´Ÿè´£è·å–å¼‚æ­¥æ“ä½œçš„ç»“æœå¹¶æ¸…ç†èµ„æºã€‚
è¿™é‡Œ &lt;code>return&lt;/code> æœ€åè¿”å›ç»“æœã€‚è¿™é‡Œ &lt;code>return&lt;/code> çš„å€¼ä¼šè¢« &lt;code>co_await&lt;/code> è¡¨è¾¾å¼çš„è°ƒç”¨è€…è·å–åˆ°ã€‚&lt;/p>
&lt;h4 id="read">&lt;a href="#read" class="header-anchor">&lt;/a>read
&lt;/h4>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">class&lt;/span> &lt;span style="color:#50fa7b">AwaitableRead&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span> IoUring &lt;span style="color:#ff79c6">*&lt;/span>uring_ &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#ff79c6">nullptr&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span> &lt;span style="color:#8be9fd">int&lt;/span> fd_ &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span> std&lt;span style="color:#ff79c6">::&lt;/span>string &lt;span style="color:#ff79c6">&amp;amp;&lt;/span>buffer_;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span> AwaitableBaseOp &lt;span style="color:#ff79c6">*&lt;/span>op_ &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#ff79c6">nullptr&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span>&lt;span style="color:#ff79c6">public&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span> &lt;span style="color:#6272a4">//çœç•¥éƒ¨åˆ†ä»£ç 
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#8be9fd">void&lt;/span> await_suspend(std&lt;span style="color:#ff79c6">::&lt;/span>coroutine_handle&lt;span style="color:#ff79c6">&amp;lt;&amp;gt;&lt;/span> h) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span> op_ &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#ff79c6">new&lt;/span> AwaitableBaseOp(h);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span> io_uring_sqe &lt;span style="color:#ff79c6">*&lt;/span>sqe &lt;span style="color:#ff79c6">=&lt;/span> io_uring_get_sqe(&lt;span style="color:#ff79c6">&amp;amp;&lt;/span>uring_&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>Uring());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span> io_uring_prep_recv(sqe, fd_, buffer_.data(), buffer_.size(), &lt;span style="color:#bd93f9">0&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15&lt;/span>&lt;span> io_uring_sqe_set_data(sqe, op_);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16&lt;/span>&lt;span> io_uring_submit(&lt;span style="color:#ff79c6">&amp;amp;&lt;/span>uring_&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>Uring());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18&lt;/span>&lt;span> &lt;span style="color:#6272a4">//çœç•¥éƒ¨åˆ†ä»£ç 
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span>};
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>AwaitableRead&lt;/code> ç±»çš„å®ç°ï¼Œå°è£…äº†å¯¹ &lt;code>io_uring&lt;/code> çš„è¯»å–æ“ä½œã€‚&lt;/p>
&lt;p>ä¸­é—´çœç•¥äº†ä¸€äº›ä»£ç ç»†èŠ‚ï¼Œä½†æ•´ä½“æ€è·¯å°±æ˜¯é€šè¿‡ &lt;code>AwaitableRead&lt;/code> ç±»æ¥ç®€åŒ–å¼‚æ­¥è¯»å–æ“ä½œçš„å®ç°ã€‚&lt;/p>
&lt;p>&lt;code>await_suspend&lt;/code> å‡½æ•°å†…éƒ¨ï¼Œå°†åç¨‹çš„å¥æŸ„ä¸ &lt;code>io_uring&lt;/code> çš„è¯·æ±‚å…³è”èµ·æ¥ã€‚ç„¶åï¼Œå‡†å¤‡ä¸€ä¸ª &lt;code>io_uring&lt;/code> çš„æäº¤è¯·æ±‚ï¼Œå¹¶å°† &lt;code>AwaitableBaseOp&lt;/code> å¯¹è±¡çš„æŒ‡é’ˆè®¾ç½®ä¸ºè¯·æ±‚çš„ç”¨æˆ·æ•°æ®ã€‚æœ€åï¼Œæäº¤è¯·æ±‚åˆ° &lt;code>io_uring&lt;/code>ã€‚&lt;/p>
&lt;p>&lt;code>await_resume&lt;/code> å‡½æ•°ä¼šåœ¨åç¨‹æ¢å¤æ—¶è¢«è°ƒç”¨ï¼Œè´Ÿè´£è·å–å¼‚æ­¥æ“ä½œçš„ç»“æœå¹¶æ¸…ç†èµ„æºã€‚è¿™é‡Œ &lt;code>return&lt;/code> æœ€åè¿”å›ç»“æœã€‚è¿™é‡Œ &lt;code>return&lt;/code> çš„å€¼ä¼šè¢« &lt;code>co_await&lt;/code> è¡¨è¾¾å¼çš„è°ƒç”¨è€…è·å–åˆ°ã€‚&lt;/p>
&lt;h4 id="write">&lt;a href="#write" class="header-anchor">&lt;/a>write
&lt;/h4>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">class&lt;/span> &lt;span style="color:#50fa7b">AwaitableWrite&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span> IoUring &lt;span style="color:#ff79c6">*&lt;/span>uring_ &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#ff79c6">nullptr&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span> &lt;span style="color:#8be9fd">int&lt;/span> fd_ &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span> std&lt;span style="color:#ff79c6">::&lt;/span>string buffer_;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span> AwaitableBaseOp &lt;span style="color:#ff79c6">*&lt;/span>op_ &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#ff79c6">nullptr&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span>&lt;span style="color:#ff79c6">public&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span> &lt;span style="color:#6272a4">//çœç•¥éƒ¨åˆ†ä»£ç 
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span> &lt;span style="color:#8be9fd">void&lt;/span> await_suspend(std&lt;span style="color:#ff79c6">::&lt;/span>coroutine_handle&lt;span style="color:#ff79c6">&amp;lt;&amp;gt;&lt;/span> h) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span> op_ &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#ff79c6">new&lt;/span> AwaitableBaseOp(h);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span> io_uring_sqe &lt;span style="color:#ff79c6">*&lt;/span>sqe &lt;span style="color:#ff79c6">=&lt;/span> io_uring_get_sqe(&lt;span style="color:#ff79c6">&amp;amp;&lt;/span>uring_&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>Uring());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span> io_uring_prep_write(sqe, fd_, buffer_.data(), buffer_.size(), &lt;span style="color:#bd93f9">0&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15&lt;/span>&lt;span> io_uring_sqe_set_data(sqe, op_);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16&lt;/span>&lt;span> io_uring_submit(&lt;span style="color:#ff79c6">&amp;amp;&lt;/span>uring_&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>Uring());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18&lt;/span>&lt;span> &lt;span style="color:#6272a4">//çœç•¥éƒ¨åˆ†ä»£ç 
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span>};
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>AwaitableWrite&lt;/code> ç±»çš„å®ç°ï¼Œå°è£…äº†å¯¹ &lt;code>io_uring&lt;/code> çš„å†™å…¥æ“ä½œã€‚åŸºæœ¬å’Œ &lt;code>AwaitableRead&lt;/code> ç±»ç±»ä¼¼ï¼Œé€šè¿‡åç¨‹çš„æ–¹å¼ç®€åŒ–äº†å¼‚æ­¥å†™å…¥çš„æµç¨‹ã€‚&lt;code>await_suspend&lt;/code> å‡½æ•°è´Ÿè´£å°†åç¨‹çš„å¥æŸ„ä¸ &lt;code>io_uring&lt;/code> çš„è¯·æ±‚å…³è”èµ·æ¥ï¼Œå¹¶æäº¤å†™å…¥è¯·æ±‚ã€‚&lt;code>await_resume&lt;/code> å‡½æ•°åˆ™è´Ÿè´£è·å–å†™å…¥æ“ä½œçš„ç»“æœå¹¶æ¸…ç†èµ„æºã€‚&lt;/p>
&lt;h2 id="run">&lt;a href="#run" class="header-anchor">&lt;/a>run
&lt;/h2>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#8be9fd">int&lt;/span> &lt;span style="color:#50fa7b">main&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span> IoUring ioUring(&lt;span style="color:#bd93f9">8088&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (&lt;span style="color:#ff79c6">auto&lt;/span> ret &lt;span style="color:#ff79c6">=&lt;/span> ioUring.Init(); &lt;span style="color:#ff79c6">!&lt;/span>ret) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span> std&lt;span style="color:#ff79c6">::&lt;/span>cout &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;uring init fail&amp;#34;&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> ret.error() &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> std&lt;span style="color:#ff79c6">::&lt;/span>endl;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> &lt;span style="color:#ff79c6">-&lt;/span>&lt;span style="color:#bd93f9">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span> &lt;span style="color:#ff79c6">auto&lt;/span> t &lt;span style="color:#ff79c6">=&lt;/span> ioUring.acceptServer();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span> std&lt;span style="color:#ff79c6">::&lt;/span>cout &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;Server started on port 8088.&amp;#34;&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> std&lt;span style="color:#ff79c6">::&lt;/span>endl;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span> t.resume();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span> ioUring.run();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿è¡Œè¿™ä¸ªç¨‹åº&lt;/p>
&lt;ol>
&lt;li>åˆ›å»ºä¸€ä¸ª &lt;code>IoUring&lt;/code> å¯¹è±¡ï¼Œç›‘å¬8088ç«¯å£ã€‚&lt;/li>
&lt;li>è°ƒç”¨ &lt;code>IoUring::Init&lt;/code> åˆå§‹åŒ– &lt;code>io_uring&lt;/code>ã€‚&lt;/li>
&lt;li>è°ƒç”¨ &lt;code>IoUring::acceptServer&lt;/code> å¼€å§‹æ¥å—è¿æ¥ã€‚&lt;/li>
&lt;li>è°ƒç”¨ &lt;code>IoUring::run&lt;/code> è¿›å…¥äº‹ä»¶å¾ªç¯ã€‚&lt;/li>
&lt;/ol>
&lt;p>åˆ°è¿™ï¼Œæ•´ä¸ªåç¨‹ä¸ &lt;code>io_uring&lt;/code> çš„ç»“åˆå°±å®Œæˆäº†ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ C++ ä¸­ä¼˜é›…åœ°å¤„ç†å¼‚æ­¥ I/O æ“ä½œï¼Œå……åˆ†åˆ©ç”¨åç¨‹çš„ä¼˜åŠ¿ï¼Œæé«˜ä»£ç çš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚
å¯èƒ½ä¼šæœ‰äººé—®ï¼Œæ€ä¹ˆæ²¡çœ‹åˆ°æœ‰å…³çº¿ç¨‹ &lt;code>std::thread&lt;/code> çš„ä»£ç ï¼Ÿå› ä¸ºè¿™ä¸ªä¾‹å­æ˜¯å•çº¿ç¨‹å†…ä½¿ç”¨åç¨‹çš„ï¼Œæ‰€æœ‰çš„æ“ä½œéƒ½æ˜¯åœ¨åŒä¸€ä¸ªçº¿ç¨‹ä¸­å®Œæˆçš„ã€‚æ‰€è°“çš„å¼‚æ­¥æ˜¯é€šè¿‡åç¨‹çš„æŒ‚èµ·å’Œæ¢å¤æ¥å®ç°çš„ï¼Œè€Œä¸æ˜¯é€šè¿‡å¤šçº¿ç¨‹å¹¶å‘æ‰§è¡Œã€‚é€šè¿‡å¼‚æ­¥ I/O è¯»å†™æ—¶ï¼Œä¸ä¼šé˜»å¡å½“å‰çº¿ç¨‹ï¼Œå½“è¯»å†™å®Œæˆåï¼Œé€šçŸ¥å½“å‰çº¿ç¨‹ï¼Œæ¥å®ç°çš„å¼‚æ­¥ã€‚&lt;/p>
&lt;p>é‚£è¿™æ ·è®¾è®¡çš„å¥½å¤„æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿé¦–å…ˆï¼Œå®ƒé¿å…äº†å¤šçº¿ç¨‹ç¼–ç¨‹ä¸­çš„è®¸å¤šå¤æ‚æ€§ï¼Œæ¯”å¦‚çº¿ç¨‹å®‰å…¨ã€é”ç«äº‰ç­‰é—®é¢˜ã€‚å…¶æ¬¡ï¼Œåç¨‹çš„ä¸Šä¸‹æ–‡åˆ‡æ¢æ¯”çº¿ç¨‹è½»é‡å¾—å¤šï¼Œæ€§èƒ½å¼€é”€æ›´å°ã€‚æœ€åï¼Œåç¨‹å¯ä»¥è®©å¼‚æ­¥ä»£ç çœ‹èµ·æ¥åƒåŒæ­¥ä»£ç ï¼Œæå¤§åœ°æé«˜äº†å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚&lt;/p>
&lt;p>å¦‚æœè¦ä½¿ç”¨å¤šçº¿ç¨‹æ¥å……åˆ†åˆ©ç”¨å¤šæ ¸ CPU çš„æ€§èƒ½ï¼Œå¯ä»¥åœ¨æ¯ä¸ªçº¿ç¨‹ä¸­åˆ›å»ºä¸€ä¸ª &lt;code>IoUring&lt;/code> å¯¹è±¡ï¼Œå¹¶ä½¿ç”¨åç¨‹æ¥å¤„ç†æ¯ä¸ªçº¿ç¨‹ä¸­çš„å¼‚æ­¥ I/O æ“ä½œã€‚è¿™æ ·å¯ä»¥åœ¨ä¿æŒä»£ç ç®€æ´çš„åŒæ—¶ï¼Œå……åˆ†åˆ©ç”¨å¤šæ ¸ CPU çš„ä¼˜åŠ¿ã€‚&lt;/p></description></item><item><title>C++20åç¨‹ï¼Œå…¥é—¨ï¼ŒåŸºç¡€ï¼Œå¼‚æ­¥ - QX's blog</title><link>https://lqxhub.github.io/posts/541b707d/</link><pubDate>Sun, 17 Aug 2025 20:19:20 +0800</pubDate><guid>https://lqxhub.github.io/posts/541b707d/</guid><description>&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/6271dad17bae0c4a3d2fd061106001be135c745e.jpg" alt="Featured image of post C++20åç¨‹ï¼Œå…¥é—¨ï¼ŒåŸºç¡€ï¼Œå¼‚æ­¥ - QX's blog" />&lt;p>å·®ä¸å¤šæœ‰åŠå¹´æ²¡æœ‰å†™ä¸œè¥¿äº†ï¼Œä¸»è¦æ˜¯è¿™æ®µæ—¶é—´å¤ªå¿™äº†ï¼Œä¸€ç›´æ²¡ç©ºï¼Œè¿™ä¸¤å‘¨å¼€å§‹æœ‰äº†ä¸€ç‚¹ç©ºé—²æ—¶é—´ï¼Œé‡æ–°æ¡èµ·äº†C++åç¨‹ç›¸å…³çš„çŸ¥è¯†ï¼Œåˆå­¦äº†ä¸€ä¸‹ï¼Œå†™ç¯‡æ–‡ç« ï¼Œåšç‚¹ç¬”è®°ã€‚
å»å¹´å°±äº†è§£äº†ä¸€ç‚¹C++åç¨‹ç›¸å…³çš„çŸ¥è¯†ï¼Œä½†æ˜¯å½“æ—¶åªæ˜¯æµ…æ˜¾çš„äº†è§£äº†ä¸€ä¸‹ï¼Œå¾ˆå¤šä¸œè¥¿æ²¡æœ‰å¼„æ¸…æ¥šï¼Œè¿™æ¬¡æ•´ç†äº†ä¸€äº›æ¦‚å¿µï¼Œå†™äº†ä¸€äº›demoã€‚&lt;/p>
&lt;p>C++çš„åç¨‹æ˜¯C++20å¼€å§‹æ”¯æŒçš„ï¼Œåç¨‹ä¹Ÿä¸æ˜¯ä»€ä¹ˆæ–°é²œä¸œè¥¿äº†ï¼Œè¯ç”Ÿäº2009å¹´çš„golangå‡ºç”Ÿå°±å¸¦åç¨‹ã€‚ä½¿ç”¨è¿‡golangåç¨‹çš„å¯èƒ½éƒ½æ·±æœ‰ä½“ä¼šï¼Œåç¨‹åœ¨å¼‚æ­¥ç¼–ç¨‹ä¸­æä¾›äº†å¾ˆå¥½çš„æ”¯æŒï¼Œå¯ä»¥å¤§å¹…åº¦ç®€åŒ–ä»£ç é€»è¾‘ã€‚ä½†æ˜¯è¯´å®è¯ï¼ŒC++è¿™ç‰ˆæœ¬çš„åç¨‹åªæ˜¯å®ç°äº†åŸºç¡€åŠŸèƒ½ï¼Œå¯¹äºå†™å…·ä½“ä¸šåŠ¡ä»£ç æ¥è¯´ï¼Œè¿˜æ˜¯å¾ˆä¸æ–¹ä¾¿çš„ï¼Œå¤ªå¤šçš„ä¸œè¥¿éœ€è¦è‡ªå·±è§£å†³ã€‚ä¸åƒgolangçš„åç¨‹ï¼Œä¸€ä¸ª &lt;code>go&lt;/code> å…³é”®å­—å°±è¡Œäº†ã€‚æ‰€ä»¥å¾ˆå¤šäººå¼€ç©ç¬‘è¯´ï¼Œè¿™ç‰ˆæœ¬çš„åç¨‹æ˜¯ç»™åº“ä½œè€…çš„ï¼Œä¸æ˜¯ç»™æ™®é€šå¼€å‘è€…çš„ã€‚è¿™æ ·ä¹Ÿæœ‰å¥½å¤„ï¼Œç»™äº†ä½¿ç”¨è€…æ›´å¤šçš„çµæ´»æ€§å’Œæ§åˆ¶æƒã€‚&lt;/p>
&lt;p>åœ¨å­¦ä¹ ä¹‹å‰ï¼Œå…ˆæ˜ç¡®ä¸€ä¸ªçŸ¥è¯†ç‚¹ï¼ŒC++20çš„åç¨‹ï¼Œå¦‚æœæ²¡æœ‰è‡ªå·±å®ç°å¤šçº¿ç¨‹çš„è°ƒåº¦é€»è¾‘ï¼Œéƒ½æ˜¯åœ¨å•çº¿ç¨‹ä¸­æ‰§è¡Œçš„ã€‚åªæ˜¯ &lt;strong>å¹¶å‘&lt;/strong> ä¸æ˜¯ &lt;strong>å¹¶è¡Œ&lt;/strong> ã€‚golangçš„åç¨‹èƒ½åšåˆ°å¹¶è¡Œï¼Œæ˜¯å› ä¸ºgoçš„runtimeå®ç°äº†å¤šçº¿ç¨‹çš„è°ƒåº¦é€»è¾‘ï¼Œè€ŒC++20çš„åç¨‹åªæ˜¯æä¾›äº†åç¨‹çš„è¯­æ³•å’ŒåŸºæœ¬çš„çŠ¶æ€æœºæ”¯æŒï¼Œå¹¶æ²¡æœ‰æä¾›å¤šçº¿ç¨‹çš„è°ƒåº¦é€»è¾‘ã€‚C++çš„åç¨‹ï¼Œæ˜¯é€šè¿‡å‡½æ•°çš„çŠ¶æ€åˆ‡æ¢ï¼ˆæŠŠæš‚æ—¶ä¸éœ€è¦ä½¿ç”¨CPUçš„å‡½æ•°æš‚åœï¼Œç­‰åˆ°åˆé€‚çš„æ—¶æœºå†æ¢å¤æ‰§è¡Œï¼‰æé«˜äº†CPUçš„åˆ©ç”¨æ•ˆç‡ï¼Œçœ‹ä¸Šå»åƒæ˜¯å¼‚æ­¥æ‰§è¡Œäº†ã€‚&lt;/p>
&lt;p>C++åç¨‹çš„å®ç°æ–¹å¼ï¼Œåé¢ä¼šæµ…æ˜¾ä»‹ç»ä¸€ä¸‹ã€‚å› ä¸ºå¤ªæ·±å…¥çš„æˆ‘ä¹Ÿäº†è§£ä¸å¤šã€‚ç›®å‰äº†è§£åˆ°çš„ï¼ŒC++çš„åç¨‹æ˜¯åŸºäºçŠ¶æ€æœºçš„å®ç°çš„ï¼Œç¼–è¯‘å™¨åœ¨ç¼–è¯‘åç¨‹æ—¶ï¼Œä¼šå°†åç¨‹è½¬æ¢ä¸ºçŠ¶æ€æœºçš„å½¢å¼ï¼Œä»è€Œå®ç°åç¨‹çš„è°ƒåº¦å’Œåˆ‡æ¢ã€‚&lt;/p>
&lt;p>è¯´åˆ°åç¨‹ï¼Œé¦–å…ˆè¦äº†è§£çš„æ˜¯åç¨‹çš„ä¸¤ç§åŸºæœ¬ç±»å‹ï¼šæœ‰æ ˆåç¨‹å’Œæ— æ ˆåç¨‹ã€‚&lt;/p>
&lt;h2 id="æœ‰æ ˆåç¨‹å’Œæ— æ ˆåç¨‹">&lt;a href="#%e6%9c%89%e6%a0%88%e5%8d%8f%e7%a8%8b%e5%92%8c%e6%97%a0%e6%a0%88%e5%8d%8f%e7%a8%8b" class="header-anchor">&lt;/a>æœ‰æ ˆåç¨‹å’Œæ— æ ˆåç¨‹
&lt;/h2>&lt;ul>
&lt;li>
&lt;p>æœ‰æ ˆåç¨‹ï¼š
åç¨‹åœ¨æ‰§è¡Œæ—¶ä¼šä½¿ç”¨è‡ªå·±çš„æ ˆç©ºé—´ï¼Œåç¨‹çš„è°ƒç”¨å’Œè¿”å›éƒ½æ˜¯é€šè¿‡æ ˆæ¥å®ç°çš„ã€‚è¿™ç§æ–¹å¼çš„ä¼˜ç‚¹æ˜¯å®ç°ç®€å•ï¼Œæ€§èƒ½è¾ƒå¥½ï¼Œä½†ç¼ºç‚¹æ˜¯æ ˆç©ºé—´æœ‰é™ï¼Œå®¹æ˜“å¯¼è‡´æ ˆæº¢å‡ºã€‚goè¯­è¨€çš„åç¨‹å°±æ˜¯æœ‰æ ˆåç¨‹çš„ä¸€ä¸ªå…¸å‹ä¾‹å­ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>æ— æ ˆåç¨‹ï¼š
åç¨‹åœ¨æ‰§è¡Œæ—¶ä¸ä½¿ç”¨è‡ªå·±çš„æ ˆç©ºé—´ï¼Œè€Œæ˜¯å°†æ‰€æœ‰çš„çŠ¶æ€ä¿¡æ¯ä¿å­˜åœ¨å †ä¸Šã€‚è¿™ç§æ–¹å¼çš„ä¼˜ç‚¹æ˜¯å¯ä»¥æ”¯æŒæ›´å¤§çš„åç¨‹æ ˆï¼Œä½†ç¼ºç‚¹æ˜¯å®ç°å¤æ‚ã€‚C#çš„åç¨‹å°±æ˜¯æ— æ ˆåç¨‹çš„ä¸€ä¸ªå…¸å‹ä¾‹å­ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>æ—¢ç„¶æ˜¯èŠC++çš„åç¨‹ï¼ˆæ²¡æœ‰ç‰¹æ®Šè¯´æ˜ï¼Œä¸‹æ–‡ä¸­æ‰€æåˆ°çš„C++åç¨‹éƒ½æ˜¯æŒ‡C++20çš„åŸç”Ÿåç¨‹ï¼‰ï¼Œé‚£å…³æ³¨ç‚¹å°±è¦æ”¾åœ¨C++çš„åç¨‹å®ç°ä¸Šï¼ŒC++çš„åç¨‹é‡‡ç”¨çš„å°±æ˜¯æ— æ ˆåç¨‹ï¼Œå½“ç„¶ä¹Ÿæœ‰ä¸€äº›ç¬¬ä¸‰æ–¹åç¨‹åº“æ˜¯æœ‰æ ˆåç¨‹ï¼Œè¿™ä¸ªä¸åœ¨æœ¬æ¬¡è®¨è®ºèŒƒå›´ã€‚C++çš„åç¨‹æ˜¯åŸºäºçŠ¶æ€æœºçš„å®ç°çš„ï¼Œç¼–è¯‘å™¨åœ¨ç¼–è¯‘åç¨‹æ—¶ï¼Œä¼šå°†åç¨‹è½¬æ¢ä¸ºçŠ¶æ€æœºçš„å½¢å¼ï¼Œä»è€Œå®ç°åç¨‹çš„è°ƒåº¦å’Œåˆ‡æ¢ã€‚&lt;/p>
&lt;p>è¯´çš„é€šä¿—ä¸€ç‚¹ï¼Œå°±æ˜¯ç¼–è¯‘å™¨åœ¨ç¼–è¯‘ä»£ç æ—¶ï¼ŒæŠŠåç¨‹å‡½æ•°ç¼–è¯‘æˆä¸€ä¸ªç‰¹æ®Šçš„å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°æœ‰å¾ˆå¤šçŠ¶æ€ï¼Œå¯ä»¥è¢«æŒ‚èµ·ï¼ˆè®©å‡ºCPUèµ„æºï¼Œä¹Ÿå«æš‚åœæ‰§è¡Œï¼‰ï¼Œæ¢å¤æ‰§è¡Œç­‰ç­‰ã€‚è¿™æ ·çš„å‡½æ•°ä¹Ÿå«åšå¯é‡å…¥å‡½æ•°ã€‚åç¨‹çš„çŠ¶æ€ä¿¡æ¯ï¼ˆå¦‚å±€éƒ¨å˜é‡ã€è¿”å›åœ°å€ç­‰ï¼‰ä¿å­˜åœ¨å †ä¸Šï¼Œè€Œä¸æ˜¯æ ˆä¸Šã€‚&lt;/p>
&lt;p>ç”»ä¸€ä¸‹åç¨‹çš„çŠ¶æ€æœºå›¾ï¼Œå¯èƒ½ä¼šæ›´æ¸…æ™°ä¸€äº›ï¼š&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/d31763e2ac703af0b000165eb12d05d98b8b7417.svg">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/d31763e2ac703af0b000165eb12d05d98b8b7417.svg" alt="" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>ä»è¿™ä¸ªå›¾ä¸­å¯ä»¥çœ‹å‡ºï¼Œåç¨‹å‡½æ•°å¯ä»¥è¢«æŒ‚èµ·ï¼ˆæš‚åœæ‰§è¡Œï¼‰å’Œæ¢å¤æ‰§è¡Œï¼Œåç¨‹å‡½æ•°å¯ä»¥åœ¨å¤šä¸ªçŠ¶æ€ä¹‹é—´åˆ‡æ¢ï¼Œè¿™äº›çŠ¶æ€åŒ…æ‹¬æŒ‚èµ·ã€æ¢å¤å’Œå®Œæˆç­‰ã€‚è¿™æ ·çš„è®¾è®¡ä½¿å¾—åç¨‹èƒ½å¤Ÿåœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­çµæ´»åœ°è®©å‡ºæ§åˆ¶æƒã€‚&lt;/p>
&lt;p>è‡³äºåç¨‹å‡½æ•°æ˜¯æ€æ ·è¢«æŒ‚èµ·å’Œæ¢å¤çš„ï¼Œä¸»è¦æ˜¯é€šè¿‡ç¼–è¯‘å™¨ç”Ÿæˆçš„çŠ¶æ€æœºæ¥å®ç°çš„ã€‚å½“åç¨‹å‡½æ•°è¢«æŒ‚èµ·æ—¶ï¼Œç¼–è¯‘å™¨ä¼šä¿å­˜å½“å‰çš„æ‰§è¡ŒçŠ¶æ€ï¼ˆå¦‚å±€éƒ¨å˜é‡ã€è¿”å›åœ°å€ç­‰ï¼‰ï¼Œå¹¶å°†æ§åˆ¶æƒäº¤å›ç»™è°ƒç”¨è€…ã€‚å½“åç¨‹å‡½æ•°è¢«æ¢å¤æ—¶ï¼Œç¼–è¯‘å™¨ä¼šæ¢å¤ä¹‹å‰ä¿å­˜çš„æ‰§è¡ŒçŠ¶æ€ï¼Œä»è€Œå®ç°åç¨‹çš„ç»§ç»­æ‰§è¡Œã€‚&lt;/p>
&lt;p>ä¸‹é¢å°†ä¸€ç‚¹ç‚¹æ¥åˆ†æåç¨‹å‡½æ•°çš„æ§åˆ¶ã€‚&lt;/p>
&lt;h2 id="cåç¨‹å‡½æ•°">&lt;a href="#c%e5%8d%8f%e7%a8%8b%e5%87%bd%e6%95%b0" class="header-anchor">&lt;/a>C++åç¨‹å‡½æ•°
&lt;/h2>&lt;p>C++åç¨‹å‡½æ•°çš„å®ç°ä¸»è¦ä¾èµ–äºç¼–è¯‘å™¨çš„æ”¯æŒã€‚åœ¨ç¼–å†™åç¨‹å‡½æ•°æ—¶ï¼Œå¼€å‘è€…åªéœ€ä½¿ç”¨ &lt;code>co_await&lt;/code>ã€&lt;code>co_yield&lt;/code> å’Œ &lt;code>co_return&lt;/code> ç­‰å…³é”®å­—æ¥å®šä¹‰åç¨‹çš„è¡Œä¸ºã€‚ç¼–è¯‘å™¨ä¼šæ ¹æ®è¿™äº›å…³é”®å­—ç”Ÿæˆç›¸åº”çš„çŠ¶æ€æœºä»£ç ï¼Œä»è€Œå®ç°åç¨‹çš„æŒ‚èµ·å’Œæ¢å¤ã€‚&lt;/p>
&lt;p>å…·ä½“æ¥è¯´ï¼Œå½“åç¨‹å‡½æ•°è¢«è°ƒç”¨æ—¶ï¼Œç¼–è¯‘å™¨ä¼šåˆ›å»ºä¸€ä¸ªçŠ¶æ€æœºå¯¹è±¡æ¥ç®¡ç†åç¨‹çš„çŠ¶æ€ã€‚è¿™ä¸ªçŠ¶æ€æœºå¯¹è±¡ä¼šä¿å­˜åç¨‹çš„å±€éƒ¨å˜é‡ã€è¿”å›åœ°å€ç­‰ä¿¡æ¯ã€‚å½“åç¨‹å‡½æ•°æ‰§è¡Œåˆ° &lt;code>co_await&lt;/code> æˆ– &lt;code>co_yield&lt;/code> æ—¶ï¼Œç¼–è¯‘å™¨ä¼šå°†å½“å‰çš„æ‰§è¡ŒçŠ¶æ€ä¿å­˜åˆ°çŠ¶æ€æœºå¯¹è±¡ä¸­ï¼Œå¹¶å°†æ§åˆ¶æƒäº¤å›ç»™è°ƒç”¨è€…ã€‚å½“åç¨‹å‡½æ•°è¢«æ¢å¤æ—¶ï¼Œç¼–è¯‘å™¨ä¼šä»çŠ¶æ€æœºå¯¹è±¡ä¸­æ¢å¤ä¹‹å‰ä¿å­˜çš„æ‰§è¡ŒçŠ¶æ€ï¼Œä»è€Œå®ç°åç¨‹çš„ç»§ç»­æ‰§è¡Œã€‚&lt;/p>
&lt;p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒC++åç¨‹å‡½æ•°çš„è¿”å›ç±»å‹å¹¶ä¸æ˜¯æ™®é€šçš„è¿”å›å€¼ï¼Œè€Œæ˜¯ä¸€ä¸ªç‰¹æ®Šçš„åç¨‹å¥æŸ„ï¼ˆcoroutine handleï¼‰ã€‚è¿™ä¸ªå¥æŸ„å¯ä»¥ç”¨æ¥ç®¡ç†åç¨‹çš„ç”Ÿå‘½å‘¨æœŸï¼Œä¾‹å¦‚å¯åŠ¨ã€æŒ‚èµ·å’Œæ¢å¤ç­‰æ“ä½œã€‚&lt;/p>
&lt;p>çœ‹åˆ°è¿™äº›å¯èƒ½ä¼šä¸€å¤´é›¾æ°´ï¼Œåˆ«ç€æ€¥ï¼Œè®©æˆ‘ä»¬ä¸€ç‚¹ç‚¹æ¥ã€‚&lt;/p>
&lt;h3 id="åç¨‹å‡½æ•°å’Œæ™®é€šå‡½æ•°çš„åŒºåˆ«">&lt;a href="#%e5%8d%8f%e7%a8%8b%e5%87%bd%e6%95%b0%e5%92%8c%e6%99%ae%e9%80%9a%e5%87%bd%e6%95%b0%e7%9a%84%e5%8c%ba%e5%88%ab" class="header-anchor">&lt;/a>åç¨‹å‡½æ•°å’Œæ™®é€šå‡½æ•°çš„åŒºåˆ«
&lt;/h3>&lt;p>æœ€æ˜æ˜¾çš„åŒºåˆ«æ˜¯åç¨‹å‡½æ•°å¯ä»¥è¢«æŒ‚èµ·å’Œæ¢å¤ã€‚ä½†æ˜¯æœ‰æ²¡æœ‰æƒ³è¿‡ï¼Œç¼–è¯‘å™¨åœ¨ç¼–è¯‘ä»£ç çš„æ—¶å€™ï¼Œæ˜¯æ€æ ·è¯†åˆ«ä¸€ä¸ªå‡½æ•°æ˜¯æ™®é€šå‡½æ•°è¿˜æ˜¯åç¨‹å‡½æ•°å‘¢ï¼Ÿ
è¿™ä¸»è¦æ˜¯é€šè¿‡åç¨‹å‡½æ•°çš„è¿”å›ç±»å‹æ¥åˆ¤æ–­çš„ã€‚åç¨‹å‡½æ•°çš„è¿”å›ç±»å‹æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„åç¨‹å¥æŸ„&lt;code>coroutine handle&lt;/code>ï¼Œè€Œä¸æ˜¯æ™®é€šçš„è¿”å›å€¼ã€‚è¿™ä¸ªåç¨‹å¥æŸ„å¯ä»¥ç”¨æ¥ç®¡ç†åç¨‹çš„ç”Ÿå‘½å‘¨æœŸã€‚&lt;/p>
&lt;p>æ‰€ä»¥å½“ç¼–è¯‘å™¨çœ‹åˆ°ä¸€ä¸ªå‡½æ•°çš„è¿”å›ç±»å‹æ˜¯&lt;code>coroutine handle&lt;/code>æ—¶ï¼Œå°±ä¼šå°†å…¶è¯†åˆ«ä¸ºåç¨‹å‡½æ•°ã€‚&lt;/p>
&lt;p>ä¸‹é¢æ¥çœ‹ä¸€ä¸‹ä»€ä¹ˆæ˜¯åç¨‹å¥æŸ„ &lt;code>coroutine handle&lt;/code>&lt;/p>
&lt;p>åç¨‹å¥æŸ„æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„å¯¹è±¡ï¼Œç”¨äºç®¡ç†åç¨‹çš„ç”Ÿå‘½å‘¨æœŸã€‚å®ƒå¯ä»¥ç”¨æ¥å¯åŠ¨ã€æŒ‚èµ·å’Œæ¢å¤åç¨‹ã€‚åç¨‹å¥æŸ„çš„å®ç°ä¾èµ–äºç¼–è¯‘å™¨ç”Ÿæˆçš„çŠ¶æ€æœºä»£ç ã€‚&lt;/p>
&lt;p>è¯´åˆ° &lt;code>coroutine_handle&lt;/code> å°±ä¸å¾—ä¸æåç¨‹çš„ &lt;code>promise&lt;/code>ã€‚&lt;code>promise&lt;/code> ç±»å‹æ˜¯åç¨‹çš„æ ¸å¿ƒï¼Œå®ƒè´Ÿè´£ç®¡ç†åç¨‹çš„çŠ¶æ€å’Œç”Ÿå‘½å‘¨æœŸã€‚æ¯ä¸ªåç¨‹éƒ½æœ‰ä¸€ä¸ªå¯¹åº”çš„ &lt;code>promise&lt;/code> å¯¹è±¡ï¼Œç”¨äºä¿å­˜åç¨‹çš„çŠ¶æ€ä¿¡æ¯ã€‚&lt;/p>
&lt;p>åœ¨ C++20 ä¸­ï¼Œåç¨‹å¥æŸ„çš„ç±»å‹æ˜¯ &lt;code>std::coroutine_handle&lt;/code>ã€‚è¿™ä¸ªç±»å‹æ˜¯ä¸€ä¸ªæ¨¡æ¿ç±»ï¼Œæ¥å—ä¸€ä¸ª &lt;code>promise&lt;/code> ç±»å‹ä½œä¸ºæ¨¡æ¿å‚æ•°ã€‚&lt;code>promise&lt;/code> ç±»å‹æ˜¯åç¨‹çš„çŠ¶æ€æœºå¯¹è±¡ï¼Œè´Ÿè´£ç®¡ç†åç¨‹çš„çŠ¶æ€ã€‚&lt;/p>
&lt;p>&lt;code>promise&lt;/code> ä¸æ˜¯ä¸€ä¸ªå…·ä½“çš„ç±»å‹ï¼Œé€šå¸¸éœ€è¦å®ç°ä»¥ä¸‹å‡ ä¸ªæ–¹æ³•çš„ç»“æ„ä½“å°±æ˜¯ &lt;code>promise&lt;/code>ç±»å‹ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;code>get_return_object()&lt;/code>ï¼šè¿”å›åç¨‹çš„å¥æŸ„&lt;/li>
&lt;li>&lt;code>initial_suspend()&lt;/code>ï¼šåç¨‹å¼€å§‹æ—¶æ˜¯å¦æŒ‚èµ·&lt;/li>
&lt;li>&lt;code>final_suspend()&lt;/code>ï¼šåç¨‹ç»“æŸæ—¶æ˜¯å¦æŒ‚èµ·&lt;/li>
&lt;li>&lt;code>yield_value()&lt;/code>ï¼šåç¨‹ä¸­ä½¿ç”¨ &lt;code>co_yield&lt;/code> è¿”å›å€¼æ—¶çš„å¤„ç†&lt;/li>
&lt;li>&lt;code>return_void()&lt;/code>ï¼šåç¨‹è¿”å›æ—¶æ˜¯å¦è¿”å›å€¼&lt;/li>
&lt;li>&lt;code>unhandled_exception()&lt;/code>ï¼šå¤„ç†æœªæ•è·çš„å¼‚å¸¸&lt;/li>
&lt;/ul>
&lt;p>é€šè¿‡è¿™äº›æ–¹æ³•ï¼Œåç¨‹çš„ &lt;code>promise&lt;/code> ç±»å‹å¯ä»¥ä¸åç¨‹å¥æŸ„è¿›è¡Œäº¤äº’ï¼Œä»è€Œå®ç°åç¨‹çš„æŒ‚èµ·å’Œæ¢å¤ã€‚&lt;/p>
&lt;p>ä¹Ÿå°±æ˜¯è¯´ï¼Œåªè¦ä¸€ä¸ªå‡½æ•°çš„è¿”å›å€¼æ˜¯ &lt;code>coroutine_handle&lt;/code> ç±»å‹ï¼Œç¼–è¯‘å™¨å°±ä¼šå°†å…¶è¯†åˆ«ä¸ºåç¨‹å‡½æ•°ï¼Œåç¨‹å‡½æ•°èƒ½å®ç°æŒ‚èµ·å’Œæ¢å¤çš„åŠŸèƒ½ï¼Œä¸»è¦æ˜¯é€šè¿‡ &lt;code>promise&lt;/code> å¯¹è±¡æ¥ç®¡ç†åç¨‹çš„çŠ¶æ€å’Œç”Ÿå‘½å‘¨æœŸã€‚&lt;/p>
&lt;h3 id="åç¨‹å…³é”®å­—">&lt;a href="#%e5%8d%8f%e7%a8%8b%e5%85%b3%e9%94%ae%e5%ad%97" class="header-anchor">&lt;/a>åç¨‹å…³é”®å­—
&lt;/h3>&lt;p>åœ¨C++20ä¸­ï¼Œåç¨‹å‡½æ•°ä½¿ç”¨äº†ä¸‰ä¸ªä¸ªå…³é”®å­—æ¥æ§åˆ¶åç¨‹è¡Œä¸º&lt;/p>
&lt;ol>
&lt;li>&lt;code>co_await&lt;/code>ï¼šç”¨äºæŒ‚èµ·åç¨‹å¹¶ç­‰å¾…ä¸€ä¸ªå¼‚æ­¥æ“ä½œçš„å®Œæˆã€‚&lt;/li>
&lt;li>&lt;code>co_yield&lt;/code>ï¼šç”¨äºè¿”å›ä¸€ä¸ªå€¼å¹¶æŒ‚èµ·åç¨‹çš„æ‰§è¡Œã€‚&lt;/li>
&lt;li>&lt;code>co_return&lt;/code>ï¼šç”¨äºè¿”å›åç¨‹çš„æœ€ç»ˆç»“æœã€‚&lt;/li>
&lt;/ol>
&lt;p>é€šè¿‡è¿™äº›å…³é”®å­—ï¼Œå¼€å‘è€…å¯ä»¥æ–¹ä¾¿åœ°å®šä¹‰åç¨‹çš„è¡Œä¸ºï¼Œä»è€Œå®ç°å¼‚æ­¥ç¼–ç¨‹çš„éœ€æ±‚ã€‚&lt;/p>
&lt;p>&lt;code>co_await&lt;/code> å’Œ &lt;code>co_yield&lt;/code> å…³é”®å­—å¯ä»¥ç”¨äºå®ç°åç¨‹çš„æŒ‚èµ·å’Œæ¢å¤ï¼Œè€Œ &lt;code>co_return&lt;/code> å…³é”®å­—åˆ™ç”¨äºè¿”å›åç¨‹çš„æœ€ç»ˆç»“æœã€‚&lt;/p>
&lt;p>å…¶ä¸­ &lt;code>co_await&lt;/code> æ˜¯ç”¨äºæŒ‚èµ·åç¨‹å¹¶ç­‰å¾…ä¸€ä¸ªå¼‚æ­¥æ“ä½œçš„å®Œæˆçš„å…³é”®å­—ã€‚&lt;/p>
&lt;p>è¯´åˆ° &lt;code>co_await&lt;/code>ï¼Œæˆ‘ä»¬å°±ä¸å¾—ä¸æä¸€ä¸‹å¯ç­‰å¾…å¯¹è±¡&lt;code>awaitable&lt;/code>ã€‚è¿™ä¸ªå¯¹è±¡å’Œ &lt;code>promise&lt;/code> æœ‰ç‚¹ç±»ä¼¼ï¼Œä¸æ˜¯ä¸€ä¸ªå…·ä½“çš„ç±»å‹ï¼Œè€Œæ˜¯ä¸€ä¸ªæ¥å£ã€‚è¿™ä¸ªå¯¹è±¡éœ€è¦å®ç°ä»¥ä¸‹ä¸‰ä¸ªæ–¹æ³•ï¼š&lt;/p>
&lt;ol>
&lt;li>&lt;code>await_ready()&lt;/code>ï¼šç”¨äºæ£€æŸ¥å¼‚æ­¥æ“ä½œæ˜¯å¦å·²ç»å®Œæˆã€‚&lt;/li>
&lt;li>&lt;code>await_suspend()&lt;/code>ï¼šç”¨äºæŒ‚èµ·åç¨‹å¹¶ç­‰å¾…å¼‚æ­¥æ“ä½œçš„å®Œæˆã€‚&lt;/li>
&lt;li>&lt;code>await_resume()&lt;/code>ï¼šç”¨äºæ¢å¤åç¨‹å¹¶è¿”å›å¼‚æ­¥æ“ä½œçš„ç»“æœã€‚&lt;/li>
&lt;/ol>
&lt;p>ä¸‹é¢ä¸€ä¸ªä¸ªæ¥ä»‹ç»ä¸€ä¸‹è¿™ä¸‰ä¸ªæ–¹æ³•çš„å…·ä½“å®ç°ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>&lt;span style="color:#8be9fd">bool&lt;/span> &lt;span style="color:#50fa7b">await_ready&lt;/span>() &lt;span style="color:#ff79c6">const&lt;/span> &lt;span style="color:#ff79c6">noexcept&lt;/span>;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™ä¸ªå‡½æ•°ç”¨äºæ£€æŸ¥å¼‚æ­¥æ“ä½œæ˜¯å¦å·²ç»å®Œæˆã€‚å¦‚æœå¼‚æ­¥æ“ä½œå·²ç»å®Œæˆï¼Œåˆ™è¿”å› &lt;code>true&lt;/code>ï¼Œå¦åˆ™è¿”å› &lt;code>false&lt;/code>ã€‚å¦‚æœè¿”å› &lt;code>true&lt;/code>ï¼Œåˆ™åç¨‹ä¼šç«‹å³æ¢å¤æ‰§è¡Œï¼Œè€Œä¸ä¼šæŒ‚èµ·ã€‚&lt;/p>
&lt;p>è¿™ä¸ªå‡½æ•°ä¸€èˆ¬ä¼šåœ¨åç¨‹çš„ &lt;code>await&lt;/code> è¡¨è¾¾å¼ä¸­è¢«è°ƒç”¨ã€‚å¦‚æœè¿”å› &lt;code>false&lt;/code>ï¼Œåˆ™åç¨‹ä¼šè¢«æŒ‚èµ·ï¼Œç­‰å¾…å¼‚æ­¥æ“ä½œçš„å®Œæˆã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>&lt;span style="color:#8be9fd">void&lt;/span> await_suspend(std&lt;span style="color:#ff79c6">::&lt;/span>coroutine_handle&lt;span style="color:#ff79c6">&amp;lt;&lt;/span>result&lt;span style="color:#ff79c6">::&lt;/span>promise_type&lt;span style="color:#ff79c6">&amp;gt;&lt;/span> coro)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™ä¸ªå‡½æ•°ç”¨äºæŒ‚èµ·åç¨‹å¹¶ç­‰å¾…å¼‚æ­¥æ“ä½œçš„å®Œæˆã€‚å®ƒæ¥å—ä¸€ä¸ªåç¨‹å¥æŸ„ä½œä¸ºå‚æ•°ï¼Œè¿™ä¸ªå¥æŸ„æŒ‡å‘å½“å‰åç¨‹çš„ &lt;code>promise&lt;/code> å¯¹è±¡ã€‚
å½“å¼‚æ­¥æ“ä½œå®Œæˆæ—¶ï¼Œåç¨‹ä¼šè¢«æ¢å¤æ‰§è¡Œã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>&lt;span style="color:#8be9fd">void&lt;/span> await_resume()
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™ä¸ªå‡½æ•°ç”¨äºæ¢å¤åç¨‹å¹¶è¿”å›å¼‚æ­¥æ“ä½œçš„ç»“æœã€‚å®ƒä¸€èˆ¬ä¼šåœ¨åç¨‹çš„ &lt;code>await&lt;/code> è¡¨è¾¾å¼ä¸­è¢«è°ƒç”¨ï¼Œç”¨äºè·å–å¼‚æ­¥æ“ä½œçš„ç»“æœã€‚&lt;/p>
&lt;p>å‡½æ•°çš„è¿”å›å€¼ç±»å‹å¯ä»¥æ˜¯ä»»æ„ç±»å‹ï¼Œé€šå¸¸æ˜¯å¼‚æ­¥æ“ä½œçš„ç»“æœç±»å‹ã€‚å¦‚æœå¼‚æ­¥æ“ä½œæ²¡æœ‰ç»“æœï¼Œåˆ™å¯ä»¥è¿”å› &lt;code>void&lt;/code>ã€‚&lt;/p>
&lt;p>è¿™é‡Œè¿˜æœ‰ä¸¤ä¸ªç‰¹æ®Šçš„ &lt;code>await&lt;/code>ï¼Œ &lt;code>std::suspend_always&lt;/code> å’Œ &lt;code>std::suspend_never&lt;/code>&lt;/p>
&lt;ul>
&lt;li>&lt;code>std::suspend_always&lt;/code>ï¼šè¡¨ç¤ºåç¨‹åœ¨æ¯æ¬¡æŒ‚èµ·æ—¶éƒ½ä¼šç­‰å¾…ï¼Œç›´åˆ°æ˜¾å¼è°ƒç”¨ &lt;code>resume()&lt;/code> æ¢å¤åç¨‹ã€‚&lt;/li>
&lt;li>&lt;code>std::suspend_never&lt;/code>ï¼šè¡¨ç¤ºåç¨‹åœ¨æŒ‚èµ·æ—¶ä¸ä¼šç­‰å¾…ï¼Œç›´æ¥è¿”å›æ§åˆ¶æƒç»™è°ƒç”¨è€…ã€‚&lt;/li>
&lt;/ul>
&lt;p>ç›´æ¥å»çœ‹ä¸€ä¸‹è¿™ä¸¤ä¸ªç±»å‹çš„å®ç°å°±æ˜ç™½äº†ï¼Œä¸‹é¢æ˜¯åœ¨ llvm-18 çš„ libc++ ä¸­çš„å®ç°ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">struct&lt;/span> &lt;span style="color:#50fa7b">suspend_never&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span> _LIBCPP_HIDE_FROM_ABI &lt;span style="color:#ff79c6">constexpr&lt;/span> &lt;span style="color:#8be9fd">bool&lt;/span> &lt;span style="color:#50fa7b">await_ready&lt;/span>() &lt;span style="color:#ff79c6">const&lt;/span> &lt;span style="color:#ff79c6">noexcept&lt;/span> { &lt;span style="color:#ff79c6">return&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">true&lt;/span>; }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span> _LIBCPP_HIDE_FROM_ABI &lt;span style="color:#ff79c6">constexpr&lt;/span> &lt;span style="color:#8be9fd">void&lt;/span> &lt;span style="color:#50fa7b">await_suspend&lt;/span>(coroutine_handle&lt;span style="color:#ff79c6">&amp;lt;&amp;gt;&lt;/span>) &lt;span style="color:#ff79c6">const&lt;/span> &lt;span style="color:#ff79c6">noexcept&lt;/span> {}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span> _LIBCPP_HIDE_FROM_ABI &lt;span style="color:#ff79c6">constexpr&lt;/span> &lt;span style="color:#8be9fd">void&lt;/span> &lt;span style="color:#50fa7b">await_resume&lt;/span>() &lt;span style="color:#ff79c6">const&lt;/span> &lt;span style="color:#ff79c6">noexcept&lt;/span> {}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span>};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span>&lt;span style="color:#ff79c6">struct&lt;/span> &lt;span style="color:#50fa7b">suspend_always&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span> _LIBCPP_HIDE_FROM_ABI &lt;span style="color:#ff79c6">constexpr&lt;/span> &lt;span style="color:#8be9fd">bool&lt;/span> &lt;span style="color:#50fa7b">await_ready&lt;/span>() &lt;span style="color:#ff79c6">const&lt;/span> &lt;span style="color:#ff79c6">noexcept&lt;/span> { &lt;span style="color:#ff79c6">return&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">false&lt;/span>; }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span> _LIBCPP_HIDE_FROM_ABI &lt;span style="color:#ff79c6">constexpr&lt;/span> &lt;span style="color:#8be9fd">void&lt;/span> &lt;span style="color:#50fa7b">await_suspend&lt;/span>(coroutine_handle&lt;span style="color:#ff79c6">&amp;lt;&amp;gt;&lt;/span>) &lt;span style="color:#ff79c6">const&lt;/span> &lt;span style="color:#ff79c6">noexcept&lt;/span> {}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span> _LIBCPP_HIDE_FROM_ABI &lt;span style="color:#ff79c6">constexpr&lt;/span> &lt;span style="color:#8be9fd">void&lt;/span> &lt;span style="color:#50fa7b">await_resume&lt;/span>() &lt;span style="color:#ff79c6">const&lt;/span> &lt;span style="color:#ff79c6">noexcept&lt;/span> {}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span>};
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="åç¨‹æ³¨æ„äº‹é¡¹">&lt;a href="#%e5%8d%8f%e7%a8%8b%e6%b3%a8%e6%84%8f%e4%ba%8b%e9%a1%b9" class="header-anchor">&lt;/a>åç¨‹æ³¨æ„äº‹é¡¹
&lt;/h3>&lt;ol>
&lt;li>
&lt;p>&lt;strong>åç¨‹çš„ç”Ÿå‘½å‘¨æœŸ&lt;/strong>ï¼šåç¨‹çš„ç”Ÿå‘½å‘¨æœŸç”±åç¨‹å¥æŸ„ &lt;code>coroutine_handle&lt;/code> ç®¡ç†ã€‚åç¨‹å¥æŸ„å¯ä»¥ç”¨æ¥å¯åŠ¨ã€æŒ‚èµ·å’Œæ¢å¤åç¨‹ã€‚å¼€å‘è€…éœ€è¦æ³¨æ„åç¨‹çš„ç”Ÿå‘½å‘¨æœŸï¼Œä»¥é¿å…æ‚¬ç©ºæŒ‡é’ˆå’Œèµ„æºæ³„éœ²ç­‰é—®é¢˜ã€‚
åç¨‹å¥æŸ„ä¸€å®šè¦å¦¥å–„å¤„ç†ï¼Œä¸€ä¸ªåç¨‹å¥æŸ„åªèƒ½è°ƒç”¨ä¸€æ¬¡ &lt;code>destroy()&lt;/code> æ–¹æ³•ã€‚è€Œä¸”åœ¨åç¨‹ç»“æŸåï¼Œåç¨‹å¥æŸ„ä¼šè¢«é”€æ¯ï¼Œå› æ­¤å¼€å‘è€…éœ€è¦ç¡®ä¿åœ¨åç¨‹ç»“æŸå‰å®Œæˆå¯¹åç¨‹å¥æŸ„çš„æ‰€æœ‰æ“ä½œã€‚å¦‚æœæ²¡æœ‰è°ƒç”¨ &lt;code>destroy()&lt;/code> æ–¹æ³•ï¼Œåç¨‹çš„èµ„æºå¯èƒ½æ— æ³•è¢«é‡Šæ”¾ï¼Œä»è€Œå¯¼è‡´å†…å­˜æ³„æ¼ã€‚å¦‚æœå¤šæ¬¡è°ƒç”¨ &lt;code>destroy()&lt;/code> æ–¹æ³•æˆ–è€…åœ¨è°ƒç”¨&lt;code>destroy()&lt;/code>å†æ¬¡è°ƒç”¨&lt;code>resume()&lt;/code>ï¼Œå¯èƒ½ä¼šå¯¼è‡´æœªå®šä¹‰è¡Œä¸ºã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>å¼‚å¸¸å¤„ç†&lt;/strong>ï¼šåç¨‹ä¸­çš„å¼‚å¸¸å¤„ç†ä¸æ™®é€šå‡½æ•°æœ‰æ‰€ä¸åŒã€‚åç¨‹å¯ä»¥é€šè¿‡ &lt;code>promise&lt;/code> å¯¹è±¡çš„ &lt;code>unhandled_exception()&lt;/code> æ–¹æ³•æ¥å¤„ç†æœªæ•è·çš„å¼‚å¸¸ã€‚å¼€å‘è€…éœ€è¦åœ¨ &lt;code>promise&lt;/code> ç±»å‹ä¸­å®ç°è¿™ä¸ªæ–¹æ³•ï¼Œä»¥ç¡®ä¿åç¨‹ä¸­çš„å¼‚å¸¸èƒ½å¤Ÿè¢«æ­£ç¡®å¤„ç†ã€‚&lt;/p>
&lt;/li>
&lt;/ol>
&lt;h2 id="åç¨‹ä¾‹å­">&lt;a href="#%e5%8d%8f%e7%a8%8b%e4%be%8b%e5%ad%90" class="header-anchor">&lt;/a>åç¨‹ä¾‹å­
&lt;/h2>&lt;p>è¯´äº†è¿™ä¹ˆå¤šï¼Œé€šè¿‡è¿™äº›æ–‡å­—å¯èƒ½è¿˜æ˜¯éš¾ä»¥ç†è§£ï¼Œä¸‹é¢é€šè¿‡ä¸€ä¸ªç®€å•çš„ä¾‹å­æ¥å¸®åŠ©ç†è§£åç¨‹çš„ä½¿ç”¨ã€‚&lt;/p>
&lt;p>æˆ‘æ„Ÿè§‰çœŸæ­£é€‚åˆåç¨‹çš„åœºæ™¯æ˜¯éœ€è¦ç­‰å¾…æŸä¸ªæ“ä½œå®Œæˆåå†ç»§ç»­æ‰§è¡Œåç»­é€»è¾‘çš„æƒ…å†µï¼Œæ¯”å¦‚ç½‘ç»œè¯·æ±‚ã€æ–‡ä»¶è¯»å†™ç­‰ã€‚æœ€å¥½çš„æ­æ¡£å°±æ˜¯å¼‚æ­¥IOçš„åœºæ™¯ã€‚ä½†æ˜¯ç›´æ¥æ‹¿ &lt;code>iouring&lt;/code> è¿™ç§é«˜æ€§èƒ½çš„å¼‚æ­¥IOåº“æ¥åšåç¨‹çš„è°ƒåº¦ï¼Œå¯èƒ½ä¼šæ¯”è¾ƒå¤æ‚ï¼Œå¢åŠ ç†è§£æˆæœ¬ã€‚&lt;/p>
&lt;p>æ‰€ä»¥å°±å…ˆæ‹¿ä¸€ä¸ªç®€å•çš„ä¾‹å­æ¥è¯´æ˜åç¨‹çš„ä½¿ç”¨ã€‚è¿™ä¸ªä¾‹å­æ˜¯ä¸€ä¸ªç®€å•çš„åç¨‹å‡½æ•°ï¼Œå®ƒä¼šæ‰“å°ä¸€äº›æ•°å­—ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">#include&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;coroutine&amp;gt;&lt;/span>&lt;span style="color:#ff79c6">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span>&lt;span style="color:#ff79c6">#include&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;iostream&amp;gt;&lt;/span>&lt;span style="color:#ff79c6">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span>&lt;span style="color:#ff79c6">#include&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;optional&amp;gt;&lt;/span>&lt;span style="color:#ff79c6">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span>&lt;span style="color:#ff79c6">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span>&lt;span style="color:#ff79c6">template&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;&lt;/span>&lt;span style="color:#ff79c6">typename&lt;/span> T&lt;span style="color:#ff79c6">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span>&lt;span style="color:#ff79c6">struct&lt;/span> &lt;span style="color:#50fa7b">Task&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span> &lt;span style="color:#ff79c6">struct&lt;/span> &lt;span style="color:#50fa7b">promise_type&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span> std&lt;span style="color:#ff79c6">::&lt;/span>optional&lt;span style="color:#ff79c6">&amp;lt;&lt;/span>T&lt;span style="color:#ff79c6">&amp;gt;&lt;/span> current_value;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span> &lt;span style="color:#ff79c6">auto&lt;/span> &lt;span style="color:#50fa7b">get_return_object&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> Task{std&lt;span style="color:#ff79c6">::&lt;/span>coroutine_handle&lt;span style="color:#ff79c6">&amp;lt;&lt;/span>promise_type&lt;span style="color:#ff79c6">&amp;gt;::&lt;/span>from_promise(&lt;span style="color:#ff79c6">*&lt;/span>&lt;span style="color:#ff79c6">this&lt;/span>)};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span> &lt;span style="color:#ff79c6">auto&lt;/span> &lt;span style="color:#50fa7b">initial_suspend&lt;/span>() { &lt;span style="color:#ff79c6">return&lt;/span> std&lt;span style="color:#ff79c6">::&lt;/span>suspend_always{}; }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15&lt;/span>&lt;span> &lt;span style="color:#ff79c6">auto&lt;/span> &lt;span style="color:#50fa7b">final_suspend&lt;/span>() &lt;span style="color:#ff79c6">noexcept&lt;/span> { &lt;span style="color:#ff79c6">return&lt;/span> std&lt;span style="color:#ff79c6">::&lt;/span>suspend_always{}; }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17&lt;/span>&lt;span> &lt;span style="color:#8be9fd">void&lt;/span> &lt;span style="color:#50fa7b">unhandled_exception&lt;/span>() { std&lt;span style="color:#ff79c6">::&lt;/span>terminate(); }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18&lt;/span>&lt;span> &lt;span style="color:#8be9fd">void&lt;/span> &lt;span style="color:#50fa7b">return_void&lt;/span>() {}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20&lt;/span>&lt;span> &lt;span style="color:#ff79c6">auto&lt;/span> &lt;span style="color:#50fa7b">yield_value&lt;/span>(T value) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21&lt;/span>&lt;span> current_value &lt;span style="color:#ff79c6">=&lt;/span> value;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> std&lt;span style="color:#ff79c6">::&lt;/span>suspend_always{}; &lt;span style="color:#6272a4">// æŒ‚èµ·ï¼Œç­‰å¾… next() æ¢å¤
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24&lt;/span>&lt;span> };
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26&lt;/span>&lt;span> std&lt;span style="color:#ff79c6">::&lt;/span>optional&lt;span style="color:#ff79c6">&amp;lt;&lt;/span>T&lt;span style="color:#ff79c6">&amp;gt;&lt;/span> next() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (&lt;span style="color:#ff79c6">!&lt;/span>handle_ &lt;span style="color:#ff79c6">||&lt;/span> handle_.done()) &lt;span style="color:#ff79c6">return&lt;/span> std&lt;span style="color:#ff79c6">::&lt;/span>nullopt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28&lt;/span>&lt;span> handle_.resume();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (handle_.done()) &lt;span style="color:#ff79c6">return&lt;/span> std&lt;span style="color:#ff79c6">::&lt;/span>nullopt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> std&lt;span style="color:#ff79c6">::&lt;/span>move(handle_.promise().current_value);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33&lt;/span>&lt;span> Task(std&lt;span style="color:#ff79c6">::&lt;/span>coroutine_handle&lt;span style="color:#ff79c6">&amp;lt;&lt;/span>promise_type&lt;span style="color:#ff79c6">&amp;gt;&lt;/span> h) &lt;span style="color:#ff79c6">:&lt;/span> handle_(h) {}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34&lt;/span>&lt;span> Task(Task&lt;span style="color:#ff79c6">&amp;amp;&amp;amp;&lt;/span> other) &lt;span style="color:#ff79c6">noexcept&lt;/span> &lt;span style="color:#ff79c6">:&lt;/span> handle_(other.handle_) { other.handle_ &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#ff79c6">nullptr&lt;/span>; }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35&lt;/span>&lt;span> Task&lt;span style="color:#ff79c6">&amp;amp;&lt;/span> &lt;span style="color:#ff79c6">operator&lt;/span>&lt;span style="color:#ff79c6">=&lt;/span>(Task&lt;span style="color:#ff79c6">&amp;amp;&amp;amp;&lt;/span> other) &lt;span style="color:#ff79c6">noexcept&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (&lt;span style="color:#ff79c6">this&lt;/span> &lt;span style="color:#ff79c6">!=&lt;/span> &lt;span style="color:#ff79c6">&amp;amp;&lt;/span>other) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (handle_) handle_.destroy();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38&lt;/span>&lt;span> handle_ &lt;span style="color:#ff79c6">=&lt;/span> other.handle_;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39&lt;/span>&lt;span> other.handle_ &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#ff79c6">nullptr&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> &lt;span style="color:#ff79c6">*&lt;/span>&lt;span style="color:#ff79c6">this&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44&lt;/span>&lt;span> &lt;span style="color:#ff79c6">~&lt;/span>Task() { &lt;span style="color:#ff79c6">if&lt;/span> (handle_) handle_.destroy(); }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46&lt;/span>&lt;span> std&lt;span style="color:#ff79c6">::&lt;/span>coroutine_handle&lt;span style="color:#ff79c6">&amp;lt;&lt;/span>promise_type&lt;span style="color:#ff79c6">&amp;gt;&lt;/span> handle_;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47&lt;/span>&lt;span>};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49&lt;/span>&lt;span>&lt;span style="color:#ff79c6">struct&lt;/span> &lt;span style="color:#50fa7b">Awaiter&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50&lt;/span>&lt;span> &lt;span style="color:#8be9fd">bool&lt;/span> &lt;span style="color:#50fa7b">await_ready&lt;/span>() &lt;span style="color:#ff79c6">const&lt;/span> &lt;span style="color:#ff79c6">noexcept&lt;/span> { &lt;span style="color:#ff79c6">return&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">false&lt;/span>; }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">51&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">52&lt;/span>&lt;span> &lt;span style="color:#8be9fd">void&lt;/span> &lt;span style="color:#50fa7b">await_suspend&lt;/span>(std&lt;span style="color:#ff79c6">::&lt;/span>coroutine_handle&lt;span style="color:#ff79c6">&amp;lt;&amp;gt;&lt;/span> h) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">53&lt;/span>&lt;span> std&lt;span style="color:#ff79c6">::&lt;/span>cout &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;Awaiter suspend &amp;#34;&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> input &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> std&lt;span style="color:#ff79c6">::&lt;/span>endl;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">54&lt;/span>&lt;span> &lt;span style="color:#6272a4">// è¿™é‡Œå¿…é¡»æ¢å¤åç¨‹
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">55&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> h.resume();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">56&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">57&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">58&lt;/span>&lt;span> &lt;span style="color:#8be9fd">int&lt;/span> &lt;span style="color:#50fa7b">await_resume&lt;/span>() &lt;span style="color:#ff79c6">noexcept&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">59&lt;/span>&lt;span> std&lt;span style="color:#ff79c6">::&lt;/span>cout &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;Awaiter resume &amp;#34;&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> input &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> std&lt;span style="color:#ff79c6">::&lt;/span>endl;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">60&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> input &lt;span style="color:#ff79c6">*&lt;/span> &lt;span style="color:#bd93f9">10&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">61&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">62&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">63&lt;/span>&lt;span> &lt;span style="color:#8be9fd">int&lt;/span> input &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">64&lt;/span>&lt;span>};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">65&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">66&lt;/span>&lt;span>Task&lt;span style="color:#ff79c6">&amp;lt;&lt;/span>&lt;span style="color:#8be9fd">int&lt;/span>&lt;span style="color:#ff79c6">&amp;gt;&lt;/span> AsyncFunction(&lt;span style="color:#8be9fd">int&lt;/span> n) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">67&lt;/span>&lt;span> &lt;span style="color:#ff79c6">for&lt;/span> (&lt;span style="color:#8be9fd">int&lt;/span> i &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>; i &lt;span style="color:#ff79c6">&amp;lt;&lt;/span> n; &lt;span style="color:#ff79c6">++&lt;/span>i) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">68&lt;/span>&lt;span> &lt;span style="color:#ff79c6">auto&lt;/span> ret &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#ff79c6">co_await&lt;/span> Awaiter{i &lt;span style="color:#ff79c6">+&lt;/span> &lt;span style="color:#bd93f9">1&lt;/span>};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">69&lt;/span>&lt;span> &lt;span style="color:#ff79c6">co_yield&lt;/span> ret;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">70&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">71&lt;/span>&lt;span> &lt;span style="color:#ff79c6">co_return&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">72&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">73&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">74&lt;/span>&lt;span>&lt;span style="color:#8be9fd">int&lt;/span> &lt;span style="color:#50fa7b">main&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">75&lt;/span>&lt;span> &lt;span style="color:#ff79c6">auto&lt;/span> t &lt;span style="color:#ff79c6">=&lt;/span> AsyncFunction(&lt;span style="color:#bd93f9">5&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">76&lt;/span>&lt;span> &lt;span style="color:#ff79c6">while&lt;/span> (&lt;span style="color:#ff79c6">auto&lt;/span> v &lt;span style="color:#ff79c6">=&lt;/span> t.next()) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">77&lt;/span>&lt;span> std&lt;span style="color:#ff79c6">::&lt;/span>cout &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;Received: &amp;#34;&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#ff79c6">*&lt;/span>v &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> std&lt;span style="color:#ff79c6">::&lt;/span>endl;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">78&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">79&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">80&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ç¨‹åºè¾“å‡ºå¦‚ä¸‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-fallback" data-lang="fallback">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>Awaiter suspend 1
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span>Awaiter resume 1
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span>Received: 10
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span>Awaiter suspend 2
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span>Awaiter resume 2
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span>Received: 20
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span>Awaiter suspend 3
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span>Awaiter resume 3
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span>Received: 30
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span>Awaiter suspend 4
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span>Awaiter resume 4
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span>Received: 40
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span>Awaiter suspend 5
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span>Awaiter resume 5
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15&lt;/span>&lt;span>Received: 50
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>é€šè¿‡æ‰“å°çš„ä¿¡æ¯å¯ä»¥çœ‹åˆ°ï¼Œåç¨‹å‡½æ•° &lt;code>AsyncFunction&lt;/code> åœ¨æ¯æ¬¡è¿­ä»£æ—¶éƒ½ä¼šæŒ‚èµ·ï¼Œå¹¶é€šè¿‡ &lt;code>co_yield&lt;/code> è¿”å›ä¸€ä¸ªå€¼ã€‚æ¯æ¬¡è°ƒç”¨ &lt;code>next()&lt;/code> æ–¹æ³•æ—¶ï¼Œåç¨‹ä¼šæ¢å¤æ‰§è¡Œï¼Œç›´åˆ°ä¸‹ä¸€ä¸ª &lt;code>co_yield&lt;/code> æˆ–åç¨‹ç»“æŸã€‚&lt;/p>
&lt;p>è¿™é‡Œæ˜¯ä¸ºäº†å±•ç¤º &lt;code>co_yield&lt;/code> çš„ç”¨æ³•ã€‚æ‰ä¼šåœ¨åç¨‹ä¸­ä½¿ç”¨ &lt;code>co_yield&lt;/code> æ¥è¿”å›å€¼ã€‚è¿™æ ·å†™æœ‰ç‚¹ç”»è›‡æ·»è¶³äº†ï¼Œå¦‚æœä¸éœ€è¦è¿”å›å€¼ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ &lt;code>co_await&lt;/code> æ¥ç­‰å¾…å¼‚æ­¥æ“ä½œçš„å®Œæˆã€‚è¿™æ ·å¯ä»¥ç®€åŒ–ä»£ç ï¼Œæ›´ç¬¦åˆåç¨‹çš„ä½¿ç”¨åœºæ™¯ã€‚&lt;/p>
&lt;p>ä¸‹é¢è®©æˆ‘ä»¬æ¥ç®€åŒ–ä¸€ä¸‹è¿™æ®µä»£ç &lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">#include&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;coroutine&amp;gt;&lt;/span>&lt;span style="color:#ff79c6">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span>&lt;span style="color:#ff79c6">#include&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;iostream&amp;gt;&lt;/span>&lt;span style="color:#ff79c6">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span>&lt;span style="color:#ff79c6">#include&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;thread&amp;gt;&lt;/span>&lt;span style="color:#ff79c6">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span>&lt;span style="color:#ff79c6">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span>&lt;span style="color:#ff79c6">struct&lt;/span> &lt;span style="color:#50fa7b">Task&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span> &lt;span style="color:#ff79c6">struct&lt;/span> &lt;span style="color:#50fa7b">promise_type&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span> &lt;span style="color:#ff79c6">auto&lt;/span> &lt;span style="color:#50fa7b">get_return_object&lt;/span>()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> Task{std&lt;span style="color:#ff79c6">::&lt;/span>coroutine_handle&lt;span style="color:#ff79c6">&amp;lt;&lt;/span>promise_type&lt;span style="color:#ff79c6">&amp;gt;::&lt;/span>from_promise(&lt;span style="color:#ff79c6">*&lt;/span>&lt;span style="color:#ff79c6">this&lt;/span>)};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span> &lt;span style="color:#ff79c6">auto&lt;/span> &lt;span style="color:#50fa7b">initial_suspend&lt;/span>() { &lt;span style="color:#ff79c6">return&lt;/span> std&lt;span style="color:#ff79c6">::&lt;/span>suspend_always{}; }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15&lt;/span>&lt;span> &lt;span style="color:#ff79c6">auto&lt;/span> &lt;span style="color:#50fa7b">final_suspend&lt;/span>() &lt;span style="color:#ff79c6">noexcept&lt;/span> { &lt;span style="color:#ff79c6">return&lt;/span> std&lt;span style="color:#ff79c6">::&lt;/span>suspend_always{}; }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17&lt;/span>&lt;span> &lt;span style="color:#8be9fd">void&lt;/span> &lt;span style="color:#50fa7b">unhandled_exception&lt;/span>() { std&lt;span style="color:#ff79c6">::&lt;/span>terminate(); }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19&lt;/span>&lt;span> &lt;span style="color:#8be9fd">void&lt;/span> &lt;span style="color:#50fa7b">return_void&lt;/span>()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20&lt;/span>&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22&lt;/span>&lt;span> };
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24&lt;/span>&lt;span> Task(std&lt;span style="color:#ff79c6">::&lt;/span>coroutine_handle&lt;span style="color:#ff79c6">&amp;lt;&lt;/span>promise_type&lt;span style="color:#ff79c6">&amp;gt;&lt;/span> h) &lt;span style="color:#ff79c6">:&lt;/span> handle_(h)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25&lt;/span>&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28&lt;/span>&lt;span> Task(Task&lt;span style="color:#ff79c6">&amp;amp;&amp;amp;&lt;/span> other) &lt;span style="color:#ff79c6">noexcept&lt;/span> &lt;span style="color:#ff79c6">:&lt;/span> handle_(other.handle_) { other.handle_ &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#ff79c6">nullptr&lt;/span>; }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30&lt;/span>&lt;span> Task&lt;span style="color:#ff79c6">&amp;amp;&lt;/span> &lt;span style="color:#ff79c6">operator&lt;/span>&lt;span style="color:#ff79c6">=&lt;/span>(Task&lt;span style="color:#ff79c6">&amp;amp;&amp;amp;&lt;/span> other) &lt;span style="color:#ff79c6">noexcept&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31&lt;/span>&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (&lt;span style="color:#ff79c6">this&lt;/span> &lt;span style="color:#ff79c6">!=&lt;/span> &lt;span style="color:#ff79c6">&amp;amp;&lt;/span>other)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33&lt;/span>&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (handle_) handle_.destroy();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35&lt;/span>&lt;span> handle_ &lt;span style="color:#ff79c6">=&lt;/span> other.handle_;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36&lt;/span>&lt;span> other.handle_ &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#ff79c6">nullptr&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> &lt;span style="color:#ff79c6">*&lt;/span>&lt;span style="color:#ff79c6">this&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41&lt;/span>&lt;span> &lt;span style="color:#ff79c6">~&lt;/span>Task() { &lt;span style="color:#ff79c6">if&lt;/span> (handle_) handle_.destroy(); }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43&lt;/span>&lt;span> std&lt;span style="color:#ff79c6">::&lt;/span>coroutine_handle&lt;span style="color:#ff79c6">&amp;lt;&lt;/span>promise_type&lt;span style="color:#ff79c6">&amp;gt;&lt;/span> handle_;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44&lt;/span>&lt;span>};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46&lt;/span>&lt;span>&lt;span style="color:#ff79c6">struct&lt;/span> &lt;span style="color:#50fa7b">Awaiter&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47&lt;/span>&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48&lt;/span>&lt;span> &lt;span style="color:#8be9fd">bool&lt;/span> &lt;span style="color:#50fa7b">await_ready&lt;/span>() &lt;span style="color:#ff79c6">const&lt;/span> &lt;span style="color:#ff79c6">noexcept&lt;/span> { &lt;span style="color:#ff79c6">return&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">false&lt;/span>; }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50&lt;/span>&lt;span> &lt;span style="color:#8be9fd">void&lt;/span> &lt;span style="color:#50fa7b">await_suspend&lt;/span>(std&lt;span style="color:#ff79c6">::&lt;/span>coroutine_handle&lt;span style="color:#ff79c6">&amp;lt;&amp;gt;&lt;/span> h)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">51&lt;/span>&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">52&lt;/span>&lt;span> std&lt;span style="color:#ff79c6">::&lt;/span>cout &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;Awaiter suspend &amp;#34;&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> input &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> std&lt;span style="color:#ff79c6">::&lt;/span>endl;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">53&lt;/span>&lt;span> std&lt;span style="color:#ff79c6">::&lt;/span>&lt;span style="color:#ff79c6">thread&lt;/span> t([h]()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">54&lt;/span>&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">55&lt;/span>&lt;span> &lt;span style="color:#6272a4">//æŠŠåç¨‹æŒ‚èµ·ä¸€æ®µæ—¶é—´ï¼Œæ¨¡æ‹Ÿå¼‚æ­¥æ“ä½œ
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">56&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> std&lt;span style="color:#ff79c6">::&lt;/span>this_thread&lt;span style="color:#ff79c6">::&lt;/span>sleep_for(std&lt;span style="color:#ff79c6">::&lt;/span>chrono&lt;span style="color:#ff79c6">::&lt;/span>seconds(&lt;span style="color:#bd93f9">1&lt;/span>));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">57&lt;/span>&lt;span> h.resume();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">58&lt;/span>&lt;span> });
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">59&lt;/span>&lt;span> t.detach(); &lt;span style="color:#6272a4">// åˆ†ç¦»çº¿ç¨‹ï¼Œé¿å…é˜»å¡
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">60&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">61&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">62&lt;/span>&lt;span> &lt;span style="color:#8be9fd">int&lt;/span> &lt;span style="color:#50fa7b">await_resume&lt;/span>() &lt;span style="color:#ff79c6">noexcept&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">63&lt;/span>&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">64&lt;/span>&lt;span> &lt;span style="color:#6272a4">//åç¨‹æ¢å¤æ—¶æ‰§è¡Œçš„æ“ä½œ
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">65&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> std&lt;span style="color:#ff79c6">::&lt;/span>cout &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;Awaiter resume &amp;#34;&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> input &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> std&lt;span style="color:#ff79c6">::&lt;/span>endl;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">66&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> input &lt;span style="color:#ff79c6">*&lt;/span> &lt;span style="color:#bd93f9">10&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">67&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">68&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">69&lt;/span>&lt;span> &lt;span style="color:#8be9fd">int&lt;/span> input &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">70&lt;/span>&lt;span>};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">71&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">72&lt;/span>&lt;span>Task &lt;span style="color:#50fa7b">AsyncFunction&lt;/span>(&lt;span style="color:#8be9fd">int&lt;/span> n)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">73&lt;/span>&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">74&lt;/span>&lt;span> &lt;span style="color:#ff79c6">for&lt;/span> (&lt;span style="color:#8be9fd">int&lt;/span> i &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>; i &lt;span style="color:#ff79c6">&amp;lt;&lt;/span> n; &lt;span style="color:#ff79c6">++&lt;/span>i)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">75&lt;/span>&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">76&lt;/span>&lt;span> &lt;span style="color:#ff79c6">auto&lt;/span> ret &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#ff79c6">co_await&lt;/span> Awaiter{i &lt;span style="color:#ff79c6">+&lt;/span> &lt;span style="color:#bd93f9">1&lt;/span>};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">77&lt;/span>&lt;span> std&lt;span style="color:#ff79c6">::&lt;/span>cout &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;Awaiter returned &amp;#34;&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> ret &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> std&lt;span style="color:#ff79c6">::&lt;/span>endl;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">78&lt;/span>&lt;span> std&lt;span style="color:#ff79c6">::&lt;/span>cout &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;------------------------&amp;#34;&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> std&lt;span style="color:#ff79c6">::&lt;/span>endl;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">79&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">80&lt;/span>&lt;span> &lt;span style="color:#ff79c6">co_return&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">81&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">82&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">83&lt;/span>&lt;span>&lt;span style="color:#8be9fd">int&lt;/span> &lt;span style="color:#50fa7b">main&lt;/span>()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">84&lt;/span>&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">85&lt;/span>&lt;span> &lt;span style="color:#ff79c6">auto&lt;/span> t &lt;span style="color:#ff79c6">=&lt;/span> AsyncFunction(&lt;span style="color:#bd93f9">5&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">86&lt;/span>&lt;span> t.handle_.resume();&lt;span style="color:#6272a4">//æ‰‹åŠ¨å”¤é†’åç¨‹
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">87&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">while&lt;/span> (&lt;span style="color:#ff79c6">!&lt;/span>t.handle_.done())
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">88&lt;/span>&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">89&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">90&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">91&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä¸Šé¢å°±æ˜¯å»æ‰ &lt;code>co_yield&lt;/code> åç®€åŒ–çš„ä»£ç ã€‚&lt;/p>
&lt;p>ç¨‹åºæ‰§è¡Œçš„è¾“å‡ºå¦‚ä¸‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-fallback" data-lang="fallback">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>Awaiter suspend 1
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span>Awaiter resume 1
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span>Awaiter returned 10
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span>------------------------
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span>Awaiter suspend 2
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span>Awaiter resume 2
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span>Awaiter returned 20
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span>------------------------
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span>Awaiter suspend 3
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span>Awaiter resume 3
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span>Awaiter returned 30
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span>------------------------
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span>Awaiter suspend 4
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span>Awaiter resume 4
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15&lt;/span>&lt;span>Awaiter returned 40
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16&lt;/span>&lt;span>------------------------
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17&lt;/span>&lt;span>Awaiter suspend 5
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18&lt;/span>&lt;span>Awaiter resume 5
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19&lt;/span>&lt;span>Awaiter returned 50
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20&lt;/span>&lt;span>------------------------
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>åœ¨ &lt;code>main&lt;/code> å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬æ‰‹åŠ¨å”¤é†’åç¨‹ï¼Œå¹¶é€šè¿‡å¾ªç¯ç­‰å¾…åç¨‹å®Œæˆã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">while&lt;/span> (&lt;span style="color:#ff79c6">!&lt;/span>t.handle_.done())
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™é‡Œé€šè¿‡ &lt;code>while&lt;/code> å¾ªç¯ä¸æ–­åœ°æ£€æŸ¥åç¨‹æ˜¯å¦å®Œæˆã€‚ä¸ºä»€ä¹ˆéœ€è¦è¿™æ ·åšï¼Œæ˜¯å› ä¸ºå¦‚æœæ²¡æœ‰æ£€æŸ¥ï¼Œè€Œæ˜¯åœ¨åç¨‹æŒ‚èµ·æ—¶ç›´æ¥è¿”å›ï¼Œä¼šå¯¼è‡´ç¨‹åºç›´æ¥é€€å‡ºã€‚&lt;/p>
&lt;p>è¿™ä¹Ÿæ˜¯åç¨‹ &lt;strong>å¼‚æ­¥&lt;/strong> çš„ä½“ç°ã€‚æ™®é€šå‡½æ•°åªè¦è°ƒç”¨äº†ï¼Œå°±ä¼šä¸€ç›´æ‰§è¡Œï¼Œç›´åˆ°æ•´ä¸ªå‡½æ•°éƒ½æ‰§è¡Œå®Œæˆæ‰ä¼šé€€å‡ºï¼Œç„¶åç”±å‡½æ•°è°ƒç”¨è€…ç»§ç»­æ‰§è¡Œã€‚
åç¨‹å‡½æ•°ä¼šåœ¨è°ƒç”¨ &lt;code>co_await&lt;/code> æ—¶æŒ‚èµ·ï¼Œè®©å‡ºCPUèµ„æºï¼Œç”±åç¨‹å‡½æ•°çš„è°ƒç”¨è€…ï¼ˆè¿™é‡Œå°±æ˜¯mainå‡½æ•°ï¼‰ç»§ç»­æ‰§è¡Œã€‚ç­‰åˆ°å¼‚æ­¥æ“ä½œå®Œæˆï¼ˆä¹Ÿå°±æ˜¯æ‰§è¡Œäº† resumeï¼‰åå†æ¢å¤æ‰§è¡Œã€‚&lt;/p>
&lt;p>æˆ‘ä»¬åœ¨ &lt;code>await_suspend&lt;/code> ä¸­åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„çº¿ç¨‹æ¥æ¨¡æ‹Ÿå¼‚æ­¥æ“ä½œã€‚åœ¨è¿™ä¸ªçº¿ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ &lt;code>std::this_thread::sleep_for&lt;/code> æ¥è®©å½“å‰çº¿ç¨‹æš‚å®š1ç§’ï¼Œæ¨¡æ‹Ÿå¼‚æ­¥æ“ä½œçš„å»¶è¿Ÿã€‚&lt;/p>
&lt;p>é€šè¿‡è¿™ç§æ–¹å¼ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨åç¨‹ä¸­ä½¿ç”¨ &lt;code>co_await&lt;/code> æ¥ç­‰å¾…å¼‚æ­¥æ“ä½œçš„å®Œæˆï¼Œè€Œä¸éœ€è¦ä½¿ç”¨ &lt;code>co_yield&lt;/code> æ¥è¿”å›å€¼ã€‚è¿™ä½¿å¾—ä»£ç æ›´åŠ ç®€æ´ï¼Œä¹Ÿæ›´ç¬¦åˆåç¨‹çš„ä½¿ç”¨åœºæ™¯ã€‚&lt;/p>
&lt;p>å·®ä¸å¤šèƒ½æƒ³åˆ°çš„å°±æ˜¯è¿™äº›äº†ï¼Œå½“ç„¶è¿™åªæ˜¯C++åç¨‹ä¸­çš„ä¹ç‰›ä¸€æ¯›ï¼Œæƒ³è¦æ›´æ·±å…¥äº†è§£åç¨‹çš„ä½¿ç”¨ï¼Œè¿˜è¦é€šè¿‡æ›´å¤šçš„ä¾‹å­æ¥å®è·µã€‚&lt;/p>
&lt;p>ä¸‹æœŸå°†ä½¿ç”¨ &lt;code>io_uring&lt;/code> + åç¨‹æ¥å®ç°çœŸæ­£çš„å¼‚æ­¥IOæ“ä½œã€‚å‘æŒ¥å‡ºåç¨‹çš„ä¼˜åŠ¿ã€‚&lt;/p>
&lt;p>åç¨‹+io_uringçš„æ–‡ç« æ¥äº† &lt;a class="link" href="https://lqxhub.github.io/posts/d26369fd" >ä¼ é€é—¨&lt;/a>&lt;/p></description></item><item><title>C++ä¸­çš„ç§»åŠ¨è¯­ä¹‰ä¸å®Œç¾è½¬å‘ï¼ŒC++ä¸­çš„å³å€¼å¼•ç”¨ã€std::moveå’Œstd::forwardçš„ä½¿ç”¨æ–¹æ³•åŠå…¶å®ç°åŸç†ï¼Œç»“åˆå®ä¾‹è®²è§£RVO</title><link>https://lqxhub.github.io/posts/14155cf4/</link><pubDate>Sun, 16 Mar 2025 19:50:55 +0800</pubDate><guid>https://lqxhub.github.io/posts/14155cf4/</guid><description>&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/7320b79a5cd9f9ac9e07752081db9612e98ca223.jpg" alt="Featured image of post C++ä¸­çš„ç§»åŠ¨è¯­ä¹‰ä¸å®Œç¾è½¬å‘ï¼ŒC++ä¸­çš„å³å€¼å¼•ç”¨ã€std::moveå’Œstd::forwardçš„ä½¿ç”¨æ–¹æ³•åŠå…¶å®ç°åŸç†ï¼Œç»“åˆå®ä¾‹è®²è§£RVO" />&lt;p>ä¸Šä¸€ç¯‡æ–‡ç« &lt;a class="link" href="https://lqxhub.github.io/posts/567e834f" >ã€ŠC++å˜é‡ç”Ÿå‘½å‘¨æœŸã€‹&lt;/a>ä¸­æåˆ°äº†C++ä¸­å˜é‡çš„ç”Ÿå‘½å‘¨æœŸä¸ä½œç”¨åŸŸæ˜¯æœ‰å·®åˆ«çš„ï¼Œå…¶ä¸­æåˆ°äº† &lt;strong>å·¦å€¼&lt;/strong> å’Œ &lt;strong>å³å€¼&lt;/strong> è¿™ä¸¤ä¸ªæ¦‚å¿µï¼Œå¼•ç”³å‡ºæ¥äº† &lt;strong>å·¦å€¼å¼•ç”¨&lt;/strong> å’Œ &lt;strong>å³å€¼å¼•ç”¨&lt;/strong> è¿™ä¸¤ä¸ªä¸œè¥¿ï¼Œä¸Šæ¬¡å› ä¸ºç¯‡å¹…é—®é¢˜ï¼Œåªæ˜¯ç®€å•è¯´äº†ä¸€ä¸‹å·¦å€¼å’Œå³å€¼çš„ä¸€äº›åŒºåˆ«ï¼Œç”Ÿå‘½å‘¨æœŸå’Œç®€å•ç”¨æ³•ï¼Œæ²¡æœ‰è¯¦ç»†å±•å¼€ã€‚è¿™æ¬¡è®¨è®ºä¸€ä¸‹å³å€¼å¼•ç”¨çš„ä¸€äº›å¸¸è§é—®é¢˜å’Œä½¿ç”¨ã€‚&lt;/p>
&lt;h2 id="move">&lt;a href="#move" class="header-anchor">&lt;/a>move
&lt;/h2>&lt;p>åœ¨C++11ä¸­ï¼ŒåŠ å…¥äº† &lt;code>std::move&lt;/code> å‡½æ•°ï¼Œå®ç°äº†ç§»åŠ¨è¯­ä¹‰ï¼Œæœ‰äº† moveå‡½æ•°åï¼Œå¯ä»¥å®ç°é«˜æ•ˆçš„èµ„æºè½¬ç§»ï¼Œä¸å¿…åƒä¼ ç»Ÿçš„å¤åˆ¶é‚£æ · â€˜ç¬¨é‡â€™ã€‚&lt;/p>
&lt;h3 id="moveä¾‹å­">&lt;a href="#move%e4%be%8b%e5%ad%90" class="header-anchor">&lt;/a>moveä¾‹å­
&lt;/h3>&lt;p>å…ˆæ¥ä¸€ä¸ªç®€å•çš„ä¾‹å­æ¥çœ‹ä¸€ä¸‹ &lt;code>move&lt;/code> å‡½æ•°çš„é­…åŠ›&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">#include&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;iostream&amp;gt;&lt;/span>&lt;span style="color:#ff79c6">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span>&lt;span style="color:#ff79c6">#include&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;utility&amp;gt;&lt;/span>&lt;span style="color:#ff79c6">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span>&lt;span style="color:#ff79c6">#include&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;vector&amp;gt;&lt;/span>&lt;span style="color:#ff79c6">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span>&lt;span style="color:#ff79c6">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span>&lt;span style="color:#ff79c6">class&lt;/span> &lt;span style="color:#50fa7b">MyClass&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span>&lt;span style="color:#ff79c6">public&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span> MyClass(&lt;span style="color:#8be9fd">int&lt;/span> value) &lt;span style="color:#ff79c6">:&lt;/span> value_(value) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span> std&lt;span style="color:#ff79c6">::&lt;/span>cout &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;Constructing MyClass with value &amp;#34;&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> value_ &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> std&lt;span style="color:#ff79c6">::&lt;/span>endl;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span> MyClass(&lt;span style="color:#ff79c6">const&lt;/span> MyClass&lt;span style="color:#ff79c6">&amp;amp;&lt;/span> other) &lt;span style="color:#ff79c6">:&lt;/span> value_(other.value_) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span> std&lt;span style="color:#ff79c6">::&lt;/span>cout &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;Copy constructing MyClass with value &amp;#34;&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> value_ &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> std&lt;span style="color:#ff79c6">::&lt;/span>endl;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15&lt;/span>&lt;span> MyClass(MyClass&lt;span style="color:#ff79c6">&amp;amp;&amp;amp;&lt;/span> other) &lt;span style="color:#ff79c6">noexcept&lt;/span> &lt;span style="color:#ff79c6">:&lt;/span> value_(other.value_) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16&lt;/span>&lt;span> other.value_ &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17&lt;/span>&lt;span> std&lt;span style="color:#ff79c6">::&lt;/span>cout &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;Move constructing MyClass with value &amp;#34;&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> value_ &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> std&lt;span style="color:#ff79c6">::&lt;/span>endl;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20&lt;/span>&lt;span> MyClass&lt;span style="color:#ff79c6">&amp;amp;&lt;/span> &lt;span style="color:#ff79c6">operator&lt;/span>&lt;span style="color:#ff79c6">=&lt;/span>(&lt;span style="color:#ff79c6">const&lt;/span> MyClass&lt;span style="color:#ff79c6">&amp;amp;&lt;/span> other) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (&lt;span style="color:#ff79c6">this&lt;/span> &lt;span style="color:#ff79c6">!=&lt;/span> &lt;span style="color:#ff79c6">&amp;amp;&lt;/span>other) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22&lt;/span>&lt;span> value_ &lt;span style="color:#ff79c6">=&lt;/span> other.value_;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23&lt;/span>&lt;span> std&lt;span style="color:#ff79c6">::&lt;/span>cout &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;Copy assigning MyClass with value &amp;#34;&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> value_ &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> std&lt;span style="color:#ff79c6">::&lt;/span>endl;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> &lt;span style="color:#ff79c6">*&lt;/span>&lt;span style="color:#ff79c6">this&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28&lt;/span>&lt;span> MyClass&lt;span style="color:#ff79c6">&amp;amp;&lt;/span> &lt;span style="color:#ff79c6">operator&lt;/span>&lt;span style="color:#ff79c6">=&lt;/span>(MyClass&lt;span style="color:#ff79c6">&amp;amp;&amp;amp;&lt;/span> other) &lt;span style="color:#ff79c6">noexcept&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (&lt;span style="color:#ff79c6">this&lt;/span> &lt;span style="color:#ff79c6">!=&lt;/span> &lt;span style="color:#ff79c6">&amp;amp;&lt;/span>other) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30&lt;/span>&lt;span> value_ &lt;span style="color:#ff79c6">=&lt;/span> other.value_;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31&lt;/span>&lt;span> other.value_ &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32&lt;/span>&lt;span> std&lt;span style="color:#ff79c6">::&lt;/span>cout &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;Move assigning MyClass with value &amp;#34;&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> value_ &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> std&lt;span style="color:#ff79c6">::&lt;/span>endl;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> &lt;span style="color:#ff79c6">*&lt;/span>&lt;span style="color:#ff79c6">this&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37&lt;/span>&lt;span> &lt;span style="color:#8be9fd">int&lt;/span> &lt;span style="color:#50fa7b">getValue&lt;/span>() &lt;span style="color:#ff79c6">const&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> value_;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41&lt;/span>&lt;span>&lt;span style="color:#ff79c6">private&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42&lt;/span>&lt;span> &lt;span style="color:#8be9fd">int&lt;/span> value_;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43&lt;/span>&lt;span>};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45&lt;/span>&lt;span>&lt;span style="color:#8be9fd">int&lt;/span> &lt;span style="color:#50fa7b">main&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46&lt;/span>&lt;span> MyClass a(&lt;span style="color:#bd93f9">10&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47&lt;/span>&lt;span> MyClass b &lt;span style="color:#ff79c6">=&lt;/span> std&lt;span style="color:#ff79c6">::&lt;/span>move(a);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48&lt;/span>&lt;span> MyClass c &lt;span style="color:#ff79c6">=&lt;/span> b;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50&lt;/span>&lt;span> std&lt;span style="color:#ff79c6">::&lt;/span>cout&lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;----------------------------&amp;#34;&lt;/span>&lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span>std&lt;span style="color:#ff79c6">::&lt;/span>endl;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">51&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">52&lt;/span>&lt;span> std&lt;span style="color:#ff79c6">::&lt;/span>cout &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;Value of a after move: &amp;#34;&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> a.getValue() &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> std&lt;span style="color:#ff79c6">::&lt;/span>endl;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">53&lt;/span>&lt;span> std&lt;span style="color:#ff79c6">::&lt;/span>cout &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;Value of b after move: &amp;#34;&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> b.getValue() &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> std&lt;span style="color:#ff79c6">::&lt;/span>endl;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">54&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">55&lt;/span>&lt;span> std&lt;span style="color:#ff79c6">::&lt;/span>cout&lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;----------------------------&amp;#34;&lt;/span>&lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span>std&lt;span style="color:#ff79c6">::&lt;/span>endl;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">56&lt;/span>&lt;span> std&lt;span style="color:#ff79c6">::&lt;/span>vector&lt;span style="color:#ff79c6">&amp;lt;&lt;/span>MyClass&lt;span style="color:#ff79c6">&amp;gt;&lt;/span> vec;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">57&lt;/span>&lt;span> vec.push_back(MyClass(&lt;span style="color:#bd93f9">20&lt;/span>));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">58&lt;/span>&lt;span> std&lt;span style="color:#ff79c6">::&lt;/span>cout&lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;----------------------------&amp;#34;&lt;/span>&lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span>std&lt;span style="color:#ff79c6">::&lt;/span>endl;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">59&lt;/span>&lt;span> vec.push_back(std&lt;span style="color:#ff79c6">::&lt;/span>move(b));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">60&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">61&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">62&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™æ®µä»£ç æ‰§è¡Œçš„ç»“æœ&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>Constructing MyClass with value &lt;span style="color:#bd93f9">10&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span>Move constructing MyClass with value &lt;span style="color:#bd93f9">10&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span>Copy constructing MyClass with value &lt;span style="color:#bd93f9">10&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span>----------------------------
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span>Value of a after move: &lt;span style="color:#bd93f9">0&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span>Value of b after move: &lt;span style="color:#bd93f9">10&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span>----------------------------
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span>Constructing MyClass with value &lt;span style="color:#bd93f9">20&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span>Move constructing MyClass with value &lt;span style="color:#bd93f9">20&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span>----------------------------
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span>Move constructing MyClass with value &lt;span style="color:#bd93f9">10&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span>Move constructing MyClass with value &lt;span style="color:#bd93f9">20&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>é€šè¿‡ä»£ç æ‰§è¡Œçš„ç»“æœå¯ä»¥çœ‹åˆ°ï¼Œ&lt;/p>
&lt;p>åœ¨ä»£ç  &lt;code>MyClass a(10);&lt;/code> ä¸­ï¼Œåˆå§‹åŒ–å˜é‡ &lt;code>a&lt;/code> è°ƒç”¨äº†æ„é€ å‡½æ•°ã€‚&lt;/p>
&lt;p>åœ¨ä»£ç  &lt;code>MyClass b = std::move(a);&lt;/code> ä¸­ï¼Œåˆå§‹åŒ–å˜é‡ &lt;code>b&lt;/code> è°ƒç”¨äº†ç§»åŠ¨æ„é€ å‡½æ•°ã€‚&lt;/p>
&lt;p>åœ¨ä»£ç  &lt;code>MyClass c = b;&lt;/code> ä¸­ï¼Œåˆå§‹åŒ–å˜é‡ &lt;code>c&lt;/code> è°ƒç”¨äº†æ‹·è´æ„é€ å‡½æ•°ã€‚&lt;/p>
&lt;p>åœ¨ä»£ç  &lt;code>vec.push_back(MyClass(20));&lt;/code> ä¸­ï¼Œå¯¹åº”çš„ä¸¤è¡Œè¾“å‡º&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>Constructing MyClass with value &lt;span style="color:#bd93f9">20&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span>Move constructing MyClass with value &lt;span style="color:#bd93f9">20&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ol>
&lt;li>&lt;code>MyClass(20)&lt;/code> æ„é€ ä¸€ä¸ªä¸´æ—¶å¯¹è±¡&lt;/li>
&lt;li>è°ƒç”¨ç§»åŠ¨æ„é€ å‡½æ•°ï¼Œè¿™ä¸ªä¸´æ—¶å¯¹è±¡ä¼ å…¥åˆ° &lt;code>vec&lt;/code> ä¸­&lt;/li>
&lt;/ol>
&lt;p>åœ¨ä»£ç  &lt;code>vec.push_back(std::move(b));&lt;/code>ä¸­ï¼Œå¯¹åº”çš„ä¸€è¡Œè¾“å‡º&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>Move constructing MyClass with value &lt;span style="color:#bd93f9">10&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å› ä¸ºæ˜¯ä½¿ç”¨çš„ &lt;code>std::move&lt;/code> å‡½æ•°ï¼Œæ‰€ä»¥ç›´æ¥é€šè¿‡ç§»åŠ¨æ„é€ å‡½æ•°æŠŠå€¼æ”¾åˆ° &lt;code>vec&lt;/code> ä¸­&lt;/p>
&lt;p>æœ€åä¸€è¡Œ &lt;code>Move constructing MyClass with value 20&lt;/code> è¾“å‡ºæ˜¯å› ä¸ºåœ¨ &lt;code>vec.push_back(std::move(b));&lt;/code>æ—¶ï¼Œ&lt;code>vec&lt;/code> å‘ç”Ÿäº†æ‰©å®¹ï¼Œ&lt;code>MyClass(20)&lt;/code> è¿™ä¸ªå¯¹è±¡å‘ç”Ÿäº†ä¸€æ¬¡ç§»åŠ¨ã€‚&lt;/p>
&lt;p>çœ‹åˆ°è¿™é‡Œï¼Œå¤§æ¦‚èƒ½å¯¹ &lt;code>move&lt;/code> å‡½æ•°æœ‰å¤§æ¦‚çš„äº†è§£äº†ã€‚å¯èƒ½ä¹Ÿä¼šäº§ç”Ÿä¸€ä¸ªç–‘é—®ï¼Œä¸ºä»€ä¹ˆè¦ä½¿ç”¨&lt;code>move&lt;/code> å‡½æ•°å‘¢ï¼Ÿ&lt;/p>
&lt;p>é¦–å…ˆæˆ‘ä»¬è¦æ˜ç¡®ä¸€ä¸ªç‚¹ï¼Œåœ¨C++ä¸­ï¼Œå˜é‡çš„èµ‹å€¼é»˜è®¤éƒ½æ˜¯æ‹·è´è¡Œä¸ºã€‚æ‰€è°“çš„å¼•ç”¨ä¼ é€’å‚æ•°ï¼Œä¸è¿‡æ˜¯ç¼–è¯‘å™¨å®ç°çš„ä¸€ç§æŒ‡é’ˆï¼Œæœ¬è´¨æ˜¯å¯¹å†…å­˜åœ°å€çš„ä¸€æ¬¡æ‹·è´ã€‚&lt;/p>
&lt;p>æ‹·è´ä¼šå¸¦æ¥ä»€ä¹ˆé—®é¢˜å‘¢ï¼Ÿå…¶ä¸­ä¸€ä¸ªé—®é¢˜å°±æ˜¯ï¼Œåœ¨ä¼ é€’å¤§çš„å¯¹è±¡æ—¶ï¼Œéœ€è¦æŠŠå¯¹è±¡çš„æˆå‘˜å˜é‡éƒ½å¤åˆ¶ä¸€æ¬¡ã€‚ä¸Šé¢ä¾‹å­ä¸­çš„ &lt;code>MyClass&lt;/code> ä¸­åªæœ‰ä¸€ä¸ª &lt;code>int value_&lt;/code> ç±»å‹çš„æˆå‘˜å˜é‡å¼€é”€æ¯”è¾ƒå°ï¼Œå¦‚æœæˆå‘˜å˜é‡å¾ˆå¤šï¼Œè€Œä¸”ç±»å‹å¤æ‚ï¼Œé‚£æ¯æ¬¡ä¼ é€’å˜é‡éƒ½å¤åˆ¶ä¸€æ¬¡ï¼Œè¿™ä¸ªå¼€é”€å°±ä¸èƒ½å¿½è§†äº†ã€‚&lt;/p>
&lt;h3 id="moveåˆ†æ">&lt;a href="#move%e5%88%86%e6%9e%90" class="header-anchor">&lt;/a>moveåˆ†æ
&lt;/h3>&lt;p>å›åˆ° &lt;code>move&lt;/code> å‡½æ•°ï¼Œç§»åŠ¨è¯­ä¹‰å…è®¸å°†èµ„æºçš„ &lt;strong>æ‰€æœ‰æƒ&lt;/strong> ä»ä¸€ä¸ªå¯¹è±¡è½¬ç§»åˆ°å¦ä¸€ä¸ªå¯¹è±¡ï¼Œè€Œæ— éœ€æ·±æ‹·è´ã€‚&lt;/p>
&lt;p>çœ‹åˆ°è¿™é‡Œï¼Œæ˜¯å¦å¥½å¥‡ &lt;code>move&lt;/code> å‡½æ•°ä¸ºä»€ä¹ˆæœ‰å¦‚æ­¤é­”åŠ›ï¼Œæ˜¯æ€æ ·å®ç°çš„å‘¢&lt;/p>
&lt;p>ä¸‹é¢å°±æ˜¯ &lt;code>move&lt;/code> å‡½æ•°çš„å¸¸è§å®ç°æ–¹å¼&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">template&lt;/span>&lt;span style="color:#ff79c6">&amp;lt;&lt;/span>&lt;span style="color:#ff79c6">typename&lt;/span> T&lt;span style="color:#ff79c6">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span>&lt;span style="color:#ff79c6">typename&lt;/span> std&lt;span style="color:#ff79c6">::&lt;/span>remove_reference&lt;span style="color:#ff79c6">&amp;lt;&lt;/span>T&lt;span style="color:#ff79c6">&amp;gt;::&lt;/span>type&lt;span style="color:#ff79c6">&amp;amp;&amp;amp;&lt;/span> move(T&lt;span style="color:#ff79c6">&amp;amp;&amp;amp;&lt;/span> t) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> &lt;span style="color:#ff79c6">static_cast&lt;/span>&lt;span style="color:#ff79c6">&amp;lt;&lt;/span>&lt;span style="color:#ff79c6">typename&lt;/span> std&lt;span style="color:#ff79c6">::&lt;/span>remove_reference&lt;span style="color:#ff79c6">&amp;lt;&lt;/span>T&lt;span style="color:#ff79c6">&amp;gt;::&lt;/span>type&lt;span style="color:#ff79c6">&amp;amp;&amp;amp;&amp;gt;&lt;/span>(t);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>çœ‹ç€æŒºå¤æ‚çš„ï¼Œå¯ä»¥å°†è¿™æ®µä»£ç ç®€åŒ–ä¸€ä¸‹ï¼Œç®€åŒ–åå¤§æ¦‚å°±æ˜¯è¿™ä¸ªæ ·å­&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">template&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;&lt;/span>&lt;span style="color:#ff79c6">typename&lt;/span> T&lt;span style="color:#ff79c6">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span>T &lt;span style="color:#ff79c6">&amp;amp;&amp;amp;&lt;/span>move(T &lt;span style="color:#ff79c6">&amp;amp;&lt;/span>t) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> &lt;span style="color:#ff79c6">static_cast&lt;/span>&lt;span style="color:#ff79c6">&amp;lt;&lt;/span>T &lt;span style="color:#ff79c6">&amp;amp;&amp;amp;&amp;gt;&lt;/span>(t);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™æ ·çœ‹ä¸‹æ¥ï¼Œ&lt;code>move&lt;/code> å‡½æ•°å…¶å®å°±åšäº†ä¸€ä»¶äº‹ &lt;strong>æ¥å—ä¸€ä¸ªé€šç”¨å¼•ç”¨(T&amp;amp;&amp;amp;)ï¼Œç„¶åé€šè¿‡ static_cast å°†å…¶è½¬æ¢ä¸ºå³å€¼å¼•ç”¨&lt;/strong>&lt;/p>
&lt;p>&lt;code>move&lt;/code> çš„æœ¬æ„æ˜¯æå‰è®©ä¸€ä¸ªå¯¹è±¡â€œå°†äº¡â€ï¼Œç„¶åæŠŠæ§åˆ¶æƒâ€œç§»äº¤â€ç»™å³å€¼å¼•ç”¨ï¼Œæ‰€ä»¥æ‰å«&lt;code>move&lt;/code>ï¼Œä¹Ÿå°±æ˜¯â€œç§»åŠ¨è¯­ä¹‰â€ã€‚ä½†æ˜¯ï¼ŒC++å¹¶ä¸èƒ½çœŸæ­£è®©ä¸€ä¸ªå¯¹è±¡æå‰â€œäº¡â€ï¼Œæ‰€ä»¥è¿™é‡Œçš„â€œç§»åŠ¨â€ä»…ä»…æ˜¯â€œè¯­ä¹‰â€ä¸Šçš„ï¼Œå¹¶ä¸æ˜¯å®é™…çš„ã€‚åªæ˜¯å‘Šè¯‰ç¼–è¯‘å™¨ï¼Œè¿™ä¸ªå¯¹è±¡æˆ‘ä¸éœ€è¦äº†ï¼Œå¯ä»¥ç»‘å®šåˆ°å³å€¼å¼•ç”¨ä¸Šäº†ã€‚&lt;/p>
&lt;p>æœ‰ä¸ªç‚¹éœ€è¦æ³¨æ„ä¸€ä¸‹ï¼Œç§»åŠ¨æ„é€ å‡½æ•°éœ€è¦åŠ ä¸Š &lt;code>noexcept&lt;/code> è™½ç„¶ä¸åŠ ä¹Ÿèƒ½æ­£å¸¸æ‰§è¡Œï¼Œä½†æ˜¯åœ¨ä½¿ç”¨å®¹å™¨ç­‰ STL åº“æ—¶ï¼Œå¦‚æœå¯¹è±¡çš„ ç§»åŠ¨æ„é€ å‡½æ•°æ²¡æœ‰ å£°æ˜ä¸º &lt;code>noexcept&lt;/code> å¯èƒ½ä¼šå¯¼è‡´ä¸ä¼šä½¿ç”¨ç§»åŠ¨æ„é€ ï¼Œè€Œæ˜¯ä½¿ç”¨æ‹·è´æ„é€ ã€‚&lt;/p>
&lt;p>å†è®¨è®ºä¸€ä¸‹ä¸Šæ–‡ä¸­æåˆ°çš„ &lt;strong>æ‰€æœ‰æƒ&lt;/strong>ï¼Œè¿™ä¸ªæ¦‚å¿µæˆ‘æœ€æ—©æ˜¯ä» &lt;strong>rust&lt;/strong> ä¸­äº†è§£åˆ°çš„ï¼Œåæ¥åœ¨C++ä¸­ï¼Œä½¿ç”¨ &lt;code>std::unique_ptr&lt;/code> æ™ºèƒ½æŒ‡é’ˆçš„æ—¶å€™ï¼Œé€æ¸å¯¹æ‰€æœ‰æƒè¿™ä¸ªæ¦‚å¿µæœ‰äº†ä¸€äº›ç†è§£ã€‚&lt;/p>
&lt;p>ä¹¦æ¥ä¸Šé¢çš„ä¾‹å­&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#8be9fd">void&lt;/span> &lt;span style="color:#50fa7b">func1&lt;/span>(std&lt;span style="color:#ff79c6">::&lt;/span>unique_ptr&lt;span style="color:#ff79c6">&amp;lt;&lt;/span>MyClass&lt;span style="color:#ff79c6">&amp;gt;&lt;/span> ptr)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span>&lt;span style="color:#8be9fd">void&lt;/span> &lt;span style="color:#50fa7b">func2&lt;/span>(std&lt;span style="color:#ff79c6">::&lt;/span>unique_ptr&lt;span style="color:#ff79c6">&amp;lt;&lt;/span>MyClass&lt;span style="color:#ff79c6">&amp;gt;&amp;amp;&lt;/span> ptr)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span>&lt;span style="color:#8be9fd">int&lt;/span> &lt;span style="color:#50fa7b">main&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span> std&lt;span style="color:#ff79c6">::&lt;/span>unique_ptr&lt;span style="color:#ff79c6">&amp;lt;&lt;/span>MyClass&lt;span style="color:#ff79c6">&amp;gt;&lt;/span> ptr1 &lt;span style="color:#ff79c6">=&lt;/span> std&lt;span style="color:#ff79c6">::&lt;/span>make_unique&lt;span style="color:#ff79c6">&amp;lt;&lt;/span>MyClass&lt;span style="color:#ff79c6">&amp;gt;&lt;/span>(&lt;span style="color:#bd93f9">30&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span> &lt;span style="color:#ff79c6">auto&lt;/span> ptr2 &lt;span style="color:#ff79c6">=&lt;/span> ptr1; &lt;span style="color:#6272a4">//ç¼–è¯‘æŠ¥é”™
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> func1(ptr1); &lt;span style="color:#6272a4">//ç¼–è¯‘æŠ¥é”™
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span> &lt;span style="color:#ff79c6">auto&lt;/span> ptr3 &lt;span style="color:#ff79c6">=&lt;/span> std&lt;span style="color:#ff79c6">::&lt;/span>move(ptr1);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15&lt;/span>&lt;span> func2(ptr3);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16&lt;/span>&lt;span> func1(std&lt;span style="color:#ff79c6">::&lt;/span>move(ptr2));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>ptr1&lt;/code> è¿™ä¸ªæ™ºèƒ½æŒ‡é’ˆæ‹¥æœ‰è¯¥å¯¹è±¡çš„æ‰€æœ‰æƒï¼Œå¦‚æœå°è¯•å°†è¿™ä¸ªæŒ‡é’ˆå¤åˆ¶ç»™ &lt;code>ptr2&lt;/code> è¿™ä¸ªæŒ‡é’ˆé‚£ä¹ˆç¼–è¯‘å™¨ä¼šæŠ¥é”™ï¼Œå› ä¸º &lt;code>std::unique_ptr&lt;/code> ç±»å‹çš„æŒ‡é’ˆåªå…è®¸ä¸€ä¸ªæŒ‡é’ˆå¯¹è±¡æŒæœ‰ &lt;code>MyClass&lt;/code> è¿™ä¸ªå¯¹è±¡çš„æ‰€æœ‰æƒã€‚å¤åˆ¶è¡Œä¸ºæ˜¯å°†æ‰€æœ‰æƒå…±äº«ï¼Œæ‰€ä»¥ä¼šæç¤ºé”™è¯¯ã€‚&lt;/p>
&lt;p>èƒ½åšåˆ°åªèƒ½æ˜¯å°†æ‰€æœ‰æƒè½¬ç§»ï¼Œä¹Ÿå°±æ˜¯ &lt;code>ptr1&lt;/code> æŒ‡é’ˆæ”¾å¼ƒæ‰€æœ‰æƒï¼Œå°†æ‰€æœ‰æƒäº¤ç»™ &lt;code>ptr3&lt;/code> è¿™ä¸ªæŒ‡é’ˆã€‚åŒæ ·çš„ï¼Œåœ¨ä½œä¸ºå‡½æ•°çš„å‚æ•°ä¼ é€’æ—¶ï¼Œä¹Ÿæ˜¯åŒæ ·çš„é“ç†ï¼Œä½œä¸º &lt;code>func1&lt;/code> å‡½æ•°çš„å‚æ•°æ—¶ï¼Œåªèƒ½ä½¿ç”¨ &lt;code>move&lt;/code>ï¼Œå°†æ‰€æœ‰æƒè½¬ç§»ã€‚&lt;/p>
&lt;p>è¿˜æœ‰ä¸€ç§æ–¹å¼ï¼Œ&lt;strong>å€Ÿ&lt;/strong>ï¼Œåœ¨å‡½æ•° &lt;code>func2&lt;/code> ä¸­ï¼Œå¯ä»¥ä½¿ç”¨å¼•ç”¨çš„æ–¹å¼ï¼Œå°†æ‰€æœ‰æƒæš‚æ—¶ &lt;strong>â€˜å€Ÿâ€™&lt;/strong> ç»™ &lt;code>func2&lt;/code> ä¸­çš„å˜é‡ä½¿ç”¨ï¼Œä½†æ˜¯æ‰€æœ‰æƒè¿˜åœ¨åŸæ¥çš„æ‰€æœ‰è€…é‚£é‡Œã€‚&lt;/p>
&lt;h3 id="moveå‡½æ•°çš„ä¼˜å…ˆçº§">&lt;a href="#move%e5%87%bd%e6%95%b0%e7%9a%84%e4%bc%98%e5%85%88%e7%ba%a7" class="header-anchor">&lt;/a>moveå‡½æ•°çš„ä¼˜å…ˆçº§
&lt;/h3>&lt;p>å¦‚æœä¸€ä¸ª class å®ç°äº† ç§»åŠ¨æ„é€ å‡½æ•°ï¼Œåœ¨èµ‹å€¼æ—¶ï¼Œæ˜¯å¦ä¸€å®šä¼šä½¿ç”¨ &lt;code>move&lt;/code> å‘¢ï¼Ÿç­”æ¡ˆæ˜¯ä¸ä¸€å®šï¼Œæ˜¯å¦ä¼˜å…ˆä½¿ç”¨ç§»åŠ¨æ„é€ å‡½æ•°å–å†³äºå…·ä½“çš„æƒ…å¢ƒã€‚&lt;/p>
&lt;p>å…ˆæ¥çœ‹ä¸€ä¸‹ &lt;strong>æ‹·è´æ„é€ å‡½æ•°&lt;/strong> å’Œ &lt;strong>ç§»åŠ¨æ„é€ å‡½æ•°&lt;/strong> çš„ç­¾å&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>MyClass(&lt;span style="color:#ff79c6">const&lt;/span> MyClass&lt;span style="color:#ff79c6">&amp;amp;&lt;/span> other);&lt;span style="color:#6272a4">//æ‹·è´æ„é€ 
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span>MyClass(MyClass&lt;span style="color:#ff79c6">&amp;amp;&amp;amp;&lt;/span> other) &lt;span style="color:#ff79c6">noexcept&lt;/span>;&lt;span style="color:#6272a4">//ç§»åŠ¨æ„é€ 
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å¯ä»¥çœ‹åˆ°ï¼Œç§»åŠ¨æ„é€ å‡½æ•°çš„å‚æ•°ç±»å‹æ˜¯ &lt;strong>å³å€¼å¼•ç”¨&lt;/strong>ã€‚&lt;/p>
&lt;p>ä¹Ÿå°±æ˜¯è¯´ï¼Œä¼˜å…ˆçº§è§„åˆ™æ˜¯è¿™æ ·çš„&lt;/p>
&lt;ul>
&lt;li>å¦‚æœå®å‚æ˜¯ &lt;strong>å·¦å€¼&lt;/strong>ï¼Œç¼–è¯‘å™¨ä¼šè°ƒç”¨æ‹·è´æ„é€ å‡½æ•°&lt;/li>
&lt;li>å¦‚æœå®å‚æ˜¯ &lt;strong>å³å€¼&lt;/strong>ï¼Œå¹¶ä¸”å­˜åœ¨ç§»åŠ¨æ„é€ å‡½æ•°ï¼Œç¼–è¯‘å™¨ä¼šä¼˜å…ˆè°ƒç”¨ç§»åŠ¨æ„é€ å‡½æ•°&lt;/li>
&lt;/ul>
&lt;p>ä½†è¿™é‡Œçš„å…³é”®æ˜¯ï¼š&lt;strong>å¤åˆ¶&lt;/strong> è¿™ä¸ªè¡Œä¸ºæ˜¯å¦æ¶‰åŠå³å€¼ã€‚å¦‚æœä»£ç æ²¡æœ‰æ˜¾å¼åœ°å°†å¯¹è±¡æ ‡è®°ä¸ºå³å€¼ï¼ˆæ¯”å¦‚ä½¿ç”¨ std::moveï¼‰ï¼Œå³ä½¿æœ‰ç§»åŠ¨æ„é€ å‡½æ•°ï¼Œä¹Ÿä¸ä¼šè¢«è°ƒç”¨ã€‚&lt;/p>
&lt;h3 id="ä½¿ç”¨moveæ³¨æ„äº‹é¡¹">&lt;a href="#%e4%bd%bf%e7%94%a8move%e6%b3%a8%e6%84%8f%e4%ba%8b%e9%a1%b9" class="header-anchor">&lt;/a>ä½¿ç”¨moveæ³¨æ„äº‹é¡¹
&lt;/h3>&lt;ul>
&lt;li>
&lt;p>ç§»åŠ¨åå¯¹è±¡çš„çŠ¶æ€ï¼šè°ƒç”¨ &lt;code>std::move&lt;/code> åï¼Œæºå¯¹è±¡å¹¶æ²¡æœ‰è¢«é”€æ¯ï¼Œä½†å®ƒå¤„äºä¸€ä¸ªâ€œæœ‰æ•ˆä½†æœªæŒ‡å®šâ€çš„çŠ¶æ€ï¼ˆvalid but unspecified stateï¼‰ã€‚æ¯”å¦‚å¯¹äº &lt;code>std::string&lt;/code>ï¼Œå®ƒå¯èƒ½å˜ä¸ºç©ºå­—ç¬¦ä¸²ï¼Œä½†å…·ä½“å–å†³äºç±»çš„å®ç°ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ä¸ä¿è¯ç§»åŠ¨ï¼š&lt;code>std::move&lt;/code> åªæ˜¯è¯·æ±‚ç§»åŠ¨ï¼Œèƒ½å¦çœŸæ­£ç§»åŠ¨å–å†³äºç›®æ ‡ç±»å‹æ˜¯å¦å®ç°äº†ç§»åŠ¨æ„é€ å‡½æ•°æˆ–ç§»åŠ¨èµ‹å€¼è¿ç®—ç¬¦ã€‚å¦‚æœæ²¡æœ‰ï¼Œç¼–è¯‘å™¨ä¼šå›é€€åˆ°æ‹·è´ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ä¸è¦æ»¥ç”¨ï¼šåªæœ‰å½“ä½ ç¡®å®šæŸä¸ªå¯¹è±¡ä¸å†éœ€è¦æ—¶ï¼Œæ‰åº”è¯¥ä½¿ç”¨ &lt;code>std::move&lt;/code>ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h2 id="forward">&lt;a href="#forward" class="header-anchor">&lt;/a>forward
&lt;/h2>&lt;p>è¯´å®Œäº† &lt;code>std::move&lt;/code> é‚£å°±ä¸å¾—ä¸æ &lt;code>std::forward&lt;/code> äº†ã€‚&lt;code>forward&lt;/code>ä¹Ÿå« &lt;strong>å®Œç¾è½¬å‘&lt;/strong>&lt;/p>
&lt;p>å’Œ &lt;code>move&lt;/code> ä¸åŒçš„åœ°æ–¹ï¼Œ&lt;code>forward&lt;/code> å¸¸ç”¨åœ¨æ¨¡æ¿ç¼–ç¨‹ä¸­ï¼Œä»¥ç¡®ä¿å‚æ•°èƒ½å¤ŸæŒ‰ç…§åŸå§‹å€¼ç±»åˆ«ï¼ˆå·¦å€¼æˆ–å³å€¼ï¼‰ä¼ é€’ç»™ä¸‹ä¸€ä¸ªå‡½æ•°ï¼Œè€Œä¸ä¼šä¸¢å¤±å…¶å±æ€§ã€‚åœ¨æ¨¡æ¿ç¼–ç¨‹ä¸­ï¼Œä¸€èˆ¬éƒ½æ˜¯å¸Œæœ›å°†å‚æ•°ä¼ é€’ç»™å¦ä¸€ä¸ªå‡½æ•°æ—¶ï¼Œä¿ç•™å‚æ•°çš„åŸå§‹å€¼ç±»å‹ã€‚
ä½†æ˜¯ &lt;code>std::move&lt;/code> æ€»æ˜¯å°†å¯¹è±¡æ— æ¡ä»¶è½¬æ¢ä¸ºå³å€¼ï¼Œè€Œ &lt;code>std::forward&lt;/code> åˆ™æ ¹æ®å‚æ•°çš„åŸå§‹ç±»å‹æœ‰æ¡ä»¶åœ°è¿›è¡Œè½¬å‘ã€‚&lt;/p>
&lt;ul>
&lt;li>å¦‚æœä¼ å…¥çš„æ˜¯ &lt;strong>å·¦å€¼&lt;/strong>ï¼Œåˆ™ä»¥å·¦å€¼çš„å½¢å¼è½¬å‘ã€‚&lt;/li>
&lt;li>å¦‚æœä¼ å…¥çš„æ˜¯ &lt;strong>å³å€¼&lt;/strong>ï¼Œåˆ™ä»¥å³å€¼çš„å½¢å¼è½¬å‘ã€‚&lt;/li>
&lt;/ul>
&lt;h3 id="forwardä¾‹å­">&lt;a href="#forward%e4%be%8b%e5%ad%90" class="header-anchor">&lt;/a>forwardä¾‹å­
&lt;/h3>&lt;p>é€šè¿‡ä¸€ä¸ªç®€å•çš„ä¾‹å­çœ‹ä¸€ä¸‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">#include&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;iostream&amp;gt;&lt;/span>&lt;span style="color:#ff79c6">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span>&lt;span style="color:#ff79c6">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span>&lt;span style="color:#8be9fd">void&lt;/span> &lt;span style="color:#50fa7b">process&lt;/span>(&lt;span style="color:#8be9fd">int&lt;/span>&lt;span style="color:#ff79c6">&amp;amp;&lt;/span> x) { std&lt;span style="color:#ff79c6">::&lt;/span>cout &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;Lvalue: &amp;#34;&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> x &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;&lt;/span>&lt;span style="color:#f1fa8c">\n&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;&lt;/span>; }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span>&lt;span style="color:#8be9fd">void&lt;/span> &lt;span style="color:#50fa7b">process&lt;/span>(&lt;span style="color:#8be9fd">int&lt;/span>&lt;span style="color:#ff79c6">&amp;amp;&amp;amp;&lt;/span> x) { std&lt;span style="color:#ff79c6">::&lt;/span>cout &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;Rvalue: &amp;#34;&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> x &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;&lt;/span>&lt;span style="color:#f1fa8c">\n&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;&lt;/span>; }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span>&lt;span style="color:#ff79c6">template&lt;/span>&lt;span style="color:#ff79c6">&amp;lt;&lt;/span>&lt;span style="color:#ff79c6">typename&lt;/span> T&lt;span style="color:#ff79c6">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span>&lt;span style="color:#8be9fd">void&lt;/span> forwarder(T&lt;span style="color:#ff79c6">&amp;amp;&amp;amp;&lt;/span> arg) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span> process(arg); &lt;span style="color:#6272a4">// ç›´æ¥ä¼ é€’ arg
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span>&lt;span style="color:#8be9fd">int&lt;/span> &lt;span style="color:#50fa7b">main&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span> &lt;span style="color:#8be9fd">int&lt;/span> a &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#bd93f9">42&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span> forwarder(a); &lt;span style="color:#6272a4">// ä¼ å…¥å·¦å€¼
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> forwarder(&lt;span style="color:#bd93f9">100&lt;/span>); &lt;span style="color:#6272a4">// ä¼ å…¥å³å€¼
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">return&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æ‰§è¡Œç»“æœ:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>Lvalue: &lt;span style="color:#bd93f9">42&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span>Lvalue: &lt;span style="color:#bd93f9">100&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>&lt;code>a&lt;/code> æ˜¯å·¦å€¼ï¼Œè½¬å‘ä¸ºå·¦å€¼ï¼Œè°ƒç”¨ &lt;code>process(int&amp;amp;)&lt;/code>&lt;/li>
&lt;li>&lt;code>100&lt;/code> æ˜¯å³å€¼ï¼Œè½¬å‘ä¸ºå³å€¼ï¼Œè°ƒç”¨ &lt;code>process(int&amp;amp;&amp;amp;)&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>&lt;code>process&lt;/code> å‡½æ•°æœ‰ä¸¤ä¸ªé‡è½½ï¼Œåˆ†åˆ«æ˜¯ &lt;strong>å·¦å€¼å¼•ç”¨&lt;/strong> å’Œ &lt;strong>å³å€¼å¼•ç”¨&lt;/strong>ï¼Œ&lt;code>forwarder&lt;/code> å‡½æ•°å¯ä»¥æ ¹æ®ä¸åŒçš„ç±»å‹è°ƒç”¨ä¸åŒçš„ &lt;code>process&lt;/code>ï¼Œä¹Ÿå°±å®ç°äº† &lt;strong>è½¬å‘&lt;/strong>&lt;/p>
&lt;h3 id="å®ç°åŸç†">&lt;a href="#%e5%ae%9e%e7%8e%b0%e5%8e%9f%e7%90%86" class="header-anchor">&lt;/a>å®ç°åŸç†
&lt;/h3>&lt;p>&lt;code>std::forward&lt;/code> çš„å®ç°ä¾èµ–äº &lt;a class="link" href="https://lqxhub.github.io/posts/567e834f/#%e5%bc%95%e7%94%a8%e6%8a%98%e5%8f%a0" >å¼•ç”¨æŠ˜å &lt;/a>å’Œç±»å‹æ¨å¯¼ï¼Œä¸‹é¢æ˜¯ &lt;code>forward&lt;/code> å‡½æ•°å®ç°&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">template&lt;/span>&lt;span style="color:#ff79c6">&amp;lt;&lt;/span>&lt;span style="color:#ff79c6">typename&lt;/span> T&lt;span style="color:#ff79c6">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span>T&lt;span style="color:#ff79c6">&amp;amp;&amp;amp;&lt;/span> forward(&lt;span style="color:#ff79c6">typename&lt;/span> std&lt;span style="color:#ff79c6">::&lt;/span>remove_reference&lt;span style="color:#ff79c6">&amp;lt;&lt;/span>T&lt;span style="color:#ff79c6">&amp;gt;::&lt;/span>type&lt;span style="color:#ff79c6">&amp;amp;&lt;/span> arg) &lt;span style="color:#ff79c6">noexcept&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> &lt;span style="color:#ff79c6">static_cast&lt;/span>&lt;span style="color:#ff79c6">&amp;lt;&lt;/span>T&lt;span style="color:#ff79c6">&amp;amp;&amp;amp;&amp;gt;&lt;/span>(arg);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6&lt;/span>&lt;span>&lt;span style="color:#ff79c6">template&lt;/span>&lt;span style="color:#ff79c6">&amp;lt;&lt;/span>&lt;span style="color:#ff79c6">typename&lt;/span> T&lt;span style="color:#ff79c6">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7&lt;/span>&lt;span>T&lt;span style="color:#ff79c6">&amp;amp;&amp;amp;&lt;/span> forward(&lt;span style="color:#ff79c6">typename&lt;/span> std&lt;span style="color:#ff79c6">::&lt;/span>remove_reference&lt;span style="color:#ff79c6">&amp;lt;&lt;/span>T&lt;span style="color:#ff79c6">&amp;gt;::&lt;/span>type&lt;span style="color:#ff79c6">&amp;amp;&amp;amp;&lt;/span> arg) &lt;span style="color:#ff79c6">noexcept&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> &lt;span style="color:#ff79c6">static_cast&lt;/span>&lt;span style="color:#ff79c6">&amp;lt;&lt;/span>T&lt;span style="color:#ff79c6">&amp;amp;&amp;amp;&amp;gt;&lt;/span>(arg);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">9&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>ä¼ å…¥å·¦å€¼æ—¶ï¼Œ&lt;code>T&lt;/code> æ¨å¯¼ä¸º &lt;code>Type&amp;amp;&lt;/code>ï¼Œ&lt;code>T&amp;amp;&amp;amp;&lt;/code> æŠ˜å ä¸ºå·¦å€¼å¼•ç”¨&lt;/li>
&lt;li>ä¼ å…¥å³å€¼æ—¶ï¼Œ&lt;code>T&lt;/code> æ¨å¯¼ä¸º &lt;code>Type&lt;/code>ï¼Œ&lt;code>T&amp;amp;&amp;amp;&lt;/code> ä¿æŒä¸ºå³å€¼å¼•ç”¨&lt;/li>
&lt;/ul>
&lt;p>&lt;code>std::forward&lt;/code> ä¸ &lt;code>std::move&lt;/code> ç›¸æ¯”ï¼Œå®ƒæ›´ &lt;strong>æ™ºèƒ½&lt;/strong>ï¼Œé€‚ç”¨äºéœ€è¦åŠ¨æ€é€‚é…å‚æ•°ç±»å‹çš„åœºæ™¯ã€‚ä¸€èˆ¬ç”¨åœ¨æ¨¡æ¿ç¼–ç¨‹ä¸­ï¼Œç¡®ä¿å‚æ•°åœ¨ä¼ é€’è¿‡ç¨‹ä¸­ä¿ç•™åŸå§‹çš„ &lt;strong>å·¦å€¼&lt;/strong> / &lt;strong>å³å€¼å±æ€§&lt;/strong>ï¼Œé¿å…ä¸å¿…è¦çš„æ‹·è´ã€‚&lt;/p>
&lt;h2 id="rvo">&lt;a href="#rvo" class="header-anchor">&lt;/a>RVO
&lt;/h2>&lt;p>&lt;strong>RVO&lt;/strong>ï¼ˆReturn Value Optimizationï¼Œè¿”å›å€¼ä¼˜åŒ–ï¼Œæ˜¯C++ç¼–è¯‘å™¨çš„ä¸€ç§ä¼˜åŒ–æŠ€æœ¯ï¼Œç”¨äºå‡å°‘å‡½æ•°è¿”å›å¤§å¯¹è±¡æ—¶çš„æ‹·è´å¼€é”€ã€‚åœ¨æ²¡æœ‰ &lt;strong>RVO&lt;/strong> çš„æƒ…å†µä¸‹ï¼Œå‡½æ•°è¿”å›ä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œä¼šè°ƒç”¨æ‹·è´æ„é€ å‡½æ•°æˆ–ç§»åŠ¨æ„é€ å‡½æ•°æ¥æ„é€ è¿”å›å€¼å¯¹è±¡ã€‚&lt;strong>RVO&lt;/strong> çš„ç›®æ ‡æ˜¯ç›´æ¥åœ¨è°ƒç”¨è€…çš„å†…å­˜ç©ºé—´ä¸­æ„é€ è¿”å›å¯¹è±¡ï¼Œä»è€Œé¿å…é¢å¤–çš„æ‹·è´æˆ–ç§»åŠ¨ã€‚&lt;/p>
&lt;p>RVO æœ‰ä¸¤ç§å½¢å¼&lt;/p>
&lt;ul>
&lt;li>&lt;strong>NRVO&lt;/strong>ï¼ˆNamed Return Value Optimizationï¼‰ï¼šé’ˆå¯¹å‘½åçš„å±€éƒ¨å˜é‡&lt;/li>
&lt;li>&lt;strong>URVO&lt;/strong>ï¼ˆUnnamed Return Value Optimizationï¼‰ï¼šé’ˆå¯¹ä¸´æ—¶å¯¹è±¡ï¼ˆæœªå‘½åçš„å¯¹è±¡ï¼‰&lt;/li>
&lt;/ul>
&lt;h3 id="rvoä¾‹å­">&lt;a href="#rvo%e4%be%8b%e5%ad%90" class="header-anchor">&lt;/a>RVOä¾‹å­
&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">#include&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;iostream&amp;gt;&lt;/span>&lt;span style="color:#ff79c6">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span>&lt;span style="color:#ff79c6">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span>&lt;span style="color:#ff79c6">struct&lt;/span> &lt;span style="color:#50fa7b">MyClass&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span> MyClass() { std&lt;span style="color:#ff79c6">::&lt;/span>cout &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;Constructor&lt;/span>&lt;span style="color:#f1fa8c">\n&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;&lt;/span>; }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span> MyClass(&lt;span style="color:#ff79c6">const&lt;/span> MyClass&lt;span style="color:#ff79c6">&amp;amp;&lt;/span>) { std&lt;span style="color:#ff79c6">::&lt;/span>cout &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;Copy constructor&lt;/span>&lt;span style="color:#f1fa8c">\n&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;&lt;/span>; }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span> MyClass(MyClass&lt;span style="color:#ff79c6">&amp;amp;&amp;amp;&lt;/span>) &lt;span style="color:#ff79c6">noexcept&lt;/span> { std&lt;span style="color:#ff79c6">::&lt;/span>cout &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;Move constructor&lt;/span>&lt;span style="color:#f1fa8c">\n&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;&lt;/span>; }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span> &lt;span style="color:#ff79c6">~&lt;/span>MyClass() { std&lt;span style="color:#ff79c6">::&lt;/span>cout &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;Destructor&lt;/span>&lt;span style="color:#f1fa8c">\n&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;&lt;/span>; }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span>};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span>MyClass &lt;span style="color:#50fa7b">create&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span> MyClass obj;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> obj; &lt;span style="color:#6272a4">// è¿”å›å±€éƒ¨å¯¹è±¡
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15&lt;/span>&lt;span>&lt;span style="color:#8be9fd">int&lt;/span> &lt;span style="color:#50fa7b">main&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16&lt;/span>&lt;span> MyClass a &lt;span style="color:#ff79c6">=&lt;/span> create();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ç°åœ¨çš„ç¼–è¯‘å™¨é»˜è®¤éƒ½ä¼šå¼€å¯ &lt;strong>RVO&lt;/strong> ä¼˜åŒ–ï¼Œæ‰€ä»¥éœ€è¦æ‰‹åŠ¨ç¦ç”¨ï¼Œåœ¨clangä¸­ï¼Œå¯ä»¥åœ¨å‘½ä»¤è¡Œä¸­æ·»åŠ  &lt;code>-fno-elide-constructors&lt;/code> æ¥ç¦ç”¨ã€‚&lt;/p>
&lt;p>ä½¿ç”¨ &lt;code>clang++ -fno-elide-constructors -o main main.cpp&lt;/code> å‘½ä»¤æ¥ç¼–è¯‘ï¼Œç„¶åæ‰§è¡Œ &lt;code>main&lt;/code>ï¼Œè¾“å‡ºå¦‚ä¸‹&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>Constructor
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span>Move constructor
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3&lt;/span>&lt;span>Destructor
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4&lt;/span>&lt;span>Destructor
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å¯ä»¥çœ‹åˆ°åœ¨ &lt;code>return obj&lt;/code> æ—¶ï¼Œå› ä¸ºæ²¡æœ‰ä½¿ç”¨ &lt;strong>RVO&lt;/strong> ä¼˜åŒ–ï¼Œæ‰€ä»¥å¤åˆ¶äº†ä¸€æ¬¡å¯¹è±¡ï¼Œä½†æ˜¯å› ä¸ºæœ‰ç§»åŠ¨æ„é€ å‡½æ•°ï¼Œæ‰€ä»¥ä½¿ç”¨äº† &lt;code>move&lt;/code> ä¼˜åŒ–ã€‚&lt;/p>
&lt;p>ä¸‹é¢å¼€å¯ &lt;strong>RVO&lt;/strong> ä¼˜åŒ–çœ‹ä¸€ä¸‹&lt;/p>
&lt;p>ä½¿ç”¨ &lt;code>clang++ -o main main.cpp&lt;/code> å‘½ä»¤ç¼–è¯‘ï¼Œç„¶åæ‰§è¡Œ &lt;code>main&lt;/code> è¾“å‡ºå¦‚ä¸‹&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>Constructor
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span>Destructor
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å¯ä»¥çœ‹åˆ°åªè°ƒç”¨äº†æ„é€ å‡½æ•°ã€‚&lt;/p>
&lt;h3 id="å·¥ä½œåŸç†">&lt;a href="#%e5%b7%a5%e4%bd%9c%e5%8e%9f%e7%90%86" class="header-anchor">&lt;/a>å·¥ä½œåŸç†
&lt;/h3>&lt;p>&lt;a class="link" href="https://godbolt.org/" target="_blank" rel="noopener"
>åœ¨çº¿æ±‡ç¼–&lt;/a> ä½¿ç”¨è¿™ä¸ªå·¥å…·ï¼Œå¯ä»¥çœ‹åˆ°å…·ä½“çš„æ±‡ç¼–ä»£ç &lt;/p>
&lt;p>ä¸‹é¢æ˜¯æ˜¯è®©GPTåŠ äº†æ³¨é‡Šçš„æ±‡ç¼–ä»£ç &lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-asm" data-lang="asm">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#50fa7b">create&lt;/span>(): &lt;span style="color:#6272a4">; create() å‡½æ•°å®šä¹‰å¼€å§‹
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#50fa7b">push&lt;/span> rbp &lt;span style="color:#6272a4">; ä¿å­˜å½“å‰æ ˆå¸§åŸºå€æŒ‡é’ˆ
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#50fa7b">mov&lt;/span> rbp, rsp &lt;span style="color:#6272a4">; å»ºç«‹æ–°çš„æ ˆå¸§ï¼Œå°†æ ˆæŒ‡é’ˆå€¼èµ‹ç»™åŸºå€æŒ‡é’ˆ
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#50fa7b">sub&lt;/span> rsp, &lt;span style="color:#bd93f9">16&lt;/span> &lt;span style="color:#6272a4">; åˆ†é…16å­—èŠ‚çš„æ ˆç©ºé—´ç”¨äºå±€éƒ¨å˜é‡
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#50fa7b">mov&lt;/span> QWORD PTR [rbp-8], rdi &lt;span style="color:#6272a4">; ä¿å­˜ç¬¬ä¸€ä¸ªå‚æ•°(rdi)åˆ°æ ˆä¸Š[rbp-8]ä½ç½®ï¼Œè¿™æ˜¯å¯¹è±¡æŒ‡é’ˆ
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#50fa7b">mov&lt;/span> rax, QWORD PTR [rbp-8] &lt;span style="color:#6272a4">; å°†å¯¹è±¡æŒ‡é’ˆåŠ è½½åˆ°raxå¯„å­˜å™¨
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#50fa7b">mov&lt;/span> rdi, rax &lt;span style="color:#6272a4">; å°†å¯¹è±¡æŒ‡é’ˆä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°(rdi)ä¼ é€’ç»™æ„é€ å‡½æ•°
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#50fa7b">call&lt;/span> MyClass::MyClass() [complete object constructor] &lt;span style="color:#6272a4">; è°ƒç”¨MyClassçš„æ„é€ å‡½æ•°åˆå§‹åŒ–å¯¹è±¡
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#50fa7b">mov&lt;/span> rax, QWORD PTR [rbp-8] &lt;span style="color:#6272a4">; å°†å¯¹è±¡æŒ‡é’ˆé‡æ–°åŠ è½½åˆ°raxä½œä¸ºå‡½æ•°è¿”å›å€¼
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#50fa7b">leave&lt;/span> &lt;span style="color:#6272a4">; æ¢å¤æ ˆå¸§ï¼ˆç›¸å½“äºmov rsp, rbp; pop rbpï¼‰
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#50fa7b">ret&lt;/span> &lt;span style="color:#6272a4">; ä»å‡½æ•°è¿”å›ï¼Œè¿”å›å€¼åœ¨raxä¸­
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">main:&lt;/span> &lt;span style="color:#6272a4">; mainå‡½æ•°å®šä¹‰å¼€å§‹
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#50fa7b">push&lt;/span> rbp &lt;span style="color:#6272a4">; ä¿å­˜å½“å‰æ ˆå¸§åŸºå€æŒ‡é’ˆ
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#50fa7b">mov&lt;/span> rbp, rsp &lt;span style="color:#6272a4">; å»ºç«‹æ–°çš„æ ˆå¸§
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#50fa7b">push&lt;/span> rbx &lt;span style="color:#6272a4">; ä¿å­˜rbxå¯„å­˜å™¨çš„å€¼(è°ƒç”¨è€…ä¿å­˜çš„å¯„å­˜å™¨)
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#50fa7b">sub&lt;/span> rsp, &lt;span style="color:#bd93f9">24&lt;/span> &lt;span style="color:#6272a4">; åˆ†é…24å­—èŠ‚çš„æ ˆç©ºé—´
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#50fa7b">lea&lt;/span> rax, [rbp-17] &lt;span style="color:#6272a4">; å°†æ ˆä¸Šåœ°å€[rbp-17]åŠ è½½åˆ°raxï¼Œè¿™æ˜¯ä¸ºMyClasså¯¹è±¡åˆ†é…çš„ç©ºé—´
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#50fa7b">mov&lt;/span> rdi, rax &lt;span style="color:#6272a4">; å°†å¯¹è±¡åœ°å€ä½œä¸ºå‚æ•°ä¼ é€’ç»™createå‡½æ•°
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#50fa7b">call&lt;/span> create() &lt;span style="color:#6272a4">; è°ƒç”¨createå‡½æ•°ï¼Œåˆå§‹åŒ–å¯¹è±¡
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#50fa7b">mov&lt;/span> ebx, &lt;span style="color:#bd93f9">0&lt;/span> &lt;span style="color:#6272a4">; å°†è¿”å›å€¼0å­˜å‚¨åˆ°ebxå¯„å­˜å™¨
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#50fa7b">lea&lt;/span> rax, [rbp-17] &lt;span style="color:#6272a4">; é‡æ–°åŠ è½½å¯¹è±¡åœ°å€åˆ°rax
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#50fa7b">mov&lt;/span> rdi, rax &lt;span style="color:#6272a4">; å°†å¯¹è±¡åœ°å€ä½œä¸ºå‚æ•°ä¼ é€’ç»™ææ„å‡½æ•°
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#50fa7b">call&lt;/span> MyClass::~MyClass() [complete object destructor] &lt;span style="color:#6272a4">; è°ƒç”¨MyClassçš„ææ„å‡½æ•°æ¸…ç†å¯¹è±¡
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#50fa7b">mov&lt;/span> eax, ebx &lt;span style="color:#6272a4">; å°†è¿”å›å€¼(0)ä»ebxç§»åŠ¨åˆ°eaxä½œä¸ºmainå‡½æ•°çš„è¿”å›å€¼
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#50fa7b">mov&lt;/span> rbx, QWORD PTR [rbp-8] &lt;span style="color:#6272a4">; æ¢å¤ä¹‹å‰ä¿å­˜çš„rbxå€¼
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#50fa7b">leave&lt;/span> &lt;span style="color:#6272a4">; æ¢å¤æ ˆå¸§
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#50fa7b">ret&lt;/span> &lt;span style="color:#6272a4">; ä»mainå‡½æ•°è¿”å›ï¼Œè¿”å›å€¼åœ¨eaxä¸­
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å¯ä»¥çœ‹åˆ°å¼€å¯ &lt;strong>ROV&lt;/strong> ä¼˜åŒ–åï¼Œç¡®å®æ˜¯å…ˆåœ¨ &lt;code>main&lt;/code> å‡½æ•°çš„æ ˆç©ºé—´ å…ˆåˆå§‹åŒ– &lt;code>MyClass&lt;/code> çš„å¯¹è±¡ï¼Œæ‰€ä»¥å¯ä»¥é¿å…åœ¨ return æ—¶æ‹·è´ã€‚&lt;/p>
&lt;p>&lt;strong>RVO&lt;/strong> çš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼šç¼–è¯‘å™¨åœ¨ç”Ÿæˆä»£ç æ—¶ï¼Œè¯†åˆ«å‡ºå‡½æ•°è¿”å›çš„å¯¹è±¡å¯ä»¥ç›´æ¥åœ¨è°ƒç”¨è€…çš„ç›®æ ‡ä½ç½®æ„é€ ï¼Œè€Œä¸æ˜¯å…ˆåœ¨å‡½æ•°æ ˆä¸Šæ„é€ ç„¶åæ‹·è´æˆ–ç§»åŠ¨åˆ°è°ƒç”¨è€…ã€‚&lt;/p>
&lt;p>åœ¨ C++17 ä¹‹å‰ï¼Œ&lt;strong>RVO&lt;/strong> æ˜¯ä¸€ç§ç¼–è¯‘å™¨å¯é€‰çš„ä¼˜åŒ–ï¼Œç¨‹åºå‘˜ä¸èƒ½å®Œå…¨ä¾èµ–å®ƒã€‚ä» C++17 å¼€å§‹ï¼Œæ ‡å‡†å¯¹æŸäº›æƒ…å†µä¸‹çš„è¿”å›å€¼ä¼˜åŒ–åšäº†å¼ºåˆ¶è¦æ±‚ï¼Œç§°ä¸º Mandatory Copy Elisionï¼ˆå¼ºåˆ¶æ‹·è´æ¶ˆé™¤ï¼‰ã€‚è¿™æ„å‘³ç€åœ¨ç‰¹å®šåœºæ™¯ä¸‹ï¼Œå³ä½¿ç¦ç”¨ä¼˜åŒ–ï¼Œç¼–è¯‘å™¨ä¹Ÿå¿…é¡»æ¶ˆé™¤æ‹·è´æˆ–ç§»åŠ¨ã€‚&lt;/p>
&lt;h3 id="rvo-å’Œ-stdmove-çš„å…³ç³»">&lt;a href="#rvo-%e5%92%8c-stdmove-%e7%9a%84%e5%85%b3%e7%b3%bb" class="header-anchor">&lt;/a>RVO å’Œ std::move çš„å…³ç³»
&lt;/h3>&lt;p>ä¸€èˆ¬æ¥è¯´ï¼Œä½¿ç”¨äº† &lt;strong>move&lt;/strong> åå°±ä¸ä¼šå†ä½¿ç”¨ &lt;strong>RVO&lt;/strong> äº†&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>MyClass &lt;span style="color:#50fa7b">create&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span> MyClass obj;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> std&lt;span style="color:#ff79c6">::&lt;/span>move(obj); &lt;span style="color:#6272a4">// æ˜¾å¼ç§»åŠ¨
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æ”¹ä¸€ä¸‹ä¸Šé¢çš„ä¾‹å­ï¼Œå¼€å¯ ROVä¼˜åŒ–çœ‹ä¸€ä¸‹&lt;/p>
&lt;p>&lt;code>clang++ -O3 -o main main.cpp&lt;/code> ç¼–è¯‘ æ‰§è¡Œ &lt;code>main&lt;/code>&lt;/p>
&lt;p>è¾“å‡ºï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>Constructor
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span>Move constructor
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3&lt;/span>&lt;span>Destructor
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4&lt;/span>&lt;span>Destructor
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æ‰€ä»¥ï¼Œåœ¨ç¼–å†™ç°ä»£C++ä»£ç æ—¶ï¼Œåœ¨ &lt;strong>return&lt;/strong> å±€éƒ¨å˜é‡æ—¶æ²¡æœ‰å¿…è¦ä½¿ç”¨ &lt;code>std::move&lt;/code>,ä½¿ç”¨äº†å¤§æ¦‚ç‡ä¼šå½±å“ç¼–è¯‘å™¨ä¼˜åŒ–ï¼Œåè€Œä¼šé€‚å¾—å…¶åï¼Œæ€§èƒ½æ›´å·®äº†ã€‚&lt;/p>
&lt;p>æ‰€ä»¥ç›¸ä¿¡ç¼–è¯‘å™¨ï¼Œå¾ˆå¤šæƒ…å†µä¸‹ï¼Œç¼–è¯‘å™¨ä¼šæ¯”äººæ›´ â€˜èªæ˜â€™ã€‚&lt;/p>
&lt;h2 id="æ€»ç»“">&lt;a href="#%e6%80%bb%e7%bb%93" class="header-anchor">&lt;/a>æ€»ç»“
&lt;/h2>&lt;ol>
&lt;li>&lt;code>std::move&lt;/code> ä¸ä¼šæ”¹å˜å¯¹è±¡çš„å†…å®¹(ä¸ä¼šç§»åŠ¨)ï¼Œåªæ˜¯æ¬ºéª—äº†ç¼–è¯‘å™¨&lt;/li>
&lt;li>&lt;code>std::move&lt;/code> åªæ˜¯è¯·æ±‚ç§»åŠ¨ï¼Œèƒ½å¦çœŸæ­£ç§»åŠ¨å–å†³äºç›®æ ‡ç±»å‹æ˜¯å¦å®ç°äº†ç§»åŠ¨æ„é€ å‡½æ•°æˆ–ç§»åŠ¨èµ‹å€¼è¿ç®—ç¬¦ã€‚å¦‚æœæ²¡æœ‰ï¼Œç¼–è¯‘å™¨ä¼šå›é€€åˆ°æ‹·è´&lt;/li>
&lt;li>&lt;strong>å·¦å€¼&lt;/strong>ï¼šè°ƒç”¨æ‹·è´æ„é€ å‡½æ•°ï¼Œ&lt;strong>å³å€¼&lt;/strong>: å¦‚æœæœ‰ç§»åŠ¨æ„é€ å‡½æ•°ï¼Œä¼˜å…ˆè°ƒç”¨ç§»åŠ¨æ„é€ å‡½æ•°ï¼›å¦åˆ™å›é€€åˆ°æ‹·è´æ„é€ å‡½æ•°&lt;/li>
&lt;li>&lt;code>std::forward&lt;/code> æœ‰æ¡ä»¶åœ°è½¬å‘å‚æ•°ï¼Œä¿ç•™å…¶åŸå§‹å€¼ç±»åˆ«ï¼ˆ&lt;strong>å·¦å€¼&lt;/strong>æˆ–&lt;strong>å³å€¼&lt;/strong>ï¼‰&lt;/li>
&lt;li>å‡½æ•°è¿”å›ä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œé™¤ééœ€è¦æ˜¾ç¤ºè°ƒç”¨ç§»åŠ¨æˆ–è€…æ‹·è´æ„é€ ï¼Œå¦åˆ™ä¸è¦ä½¿ç”¨ &lt;code>std::move&lt;/code>ï¼Œè€Œæ˜¯ä½¿ç”¨ç¼–è¯‘å™¨çš„ &lt;strong>RVO&lt;/strong> ä¼˜åŒ–&lt;/li>
&lt;/ol></description></item><item><title>C++å˜é‡ç”Ÿå‘½å‘¨æœŸï¼Œç»“å·¦å€¼å¼•ç”¨å’Œå³å€¼å¼•ç”¨ï¼Œå¼•ç”¨æŠ˜å ï¼Œè¿™æ¬¡å°±æ¥æµ…è°ˆä¸€ä¸‹C++ä¸­å˜é‡çš„ç”Ÿå‘½å‘¨æœŸ - QX's blog</title><link>https://lqxhub.github.io/posts/567e834f/</link><pubDate>Sun, 09 Mar 2025 18:01:29 +0800</pubDate><guid>https://lqxhub.github.io/posts/567e834f/</guid><description>&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/0677f36b25f64ef20bd9b0ff4317dee12d1c8c4e.jpg" alt="Featured image of post C++å˜é‡ç”Ÿå‘½å‘¨æœŸï¼Œç»“å·¦å€¼å¼•ç”¨å’Œå³å€¼å¼•ç”¨ï¼Œå¼•ç”¨æŠ˜å ï¼Œè¿™æ¬¡å°±æ¥æµ…è°ˆä¸€ä¸‹C++ä¸­å˜é‡çš„ç”Ÿå‘½å‘¨æœŸ - QX's blog" />&lt;p>åœ¨C++11åŠä»¥åçš„ç‰ˆæœ¬ä¸­ï¼Œå¯ä»¥å°†å˜é‡ç®€å•çš„åˆ†ä¸ºå·¦å€¼ï¼Œå³å€¼ã€‚å…¶ä¸­å³å€¼åˆå¯ä»¥åˆ†ä¸ºçº¯å³å€¼å’Œå°†äº¡å€¼ã€‚
ä¸åŒç±»å‹çš„å˜é‡çš„ç”Ÿå‘½å‘¨æœŸä¸ä½œç”¨åŸŸä¹Ÿæ˜¯æœ‰å·®åˆ«çš„ï¼Œè¿™æ¬¡å°±æ¥æµ…è°ˆä¸€ä¸‹C++ä¸­å˜é‡çš„ç”Ÿå‘½å‘¨æœŸã€‚&lt;/p>
&lt;p>äº‹æƒ…çš„èµ·å› æ˜¯æœ€è¿‘åœ¨ä¿®ä¸€ä¸ªC++çš„bugæ—¶ï¼Œå‘ç°æ˜¯å› ä¸ºå˜é‡çš„ç”Ÿå‘½å‘¨æœŸé—®é¢˜å¯¼è‡´çš„ï¼Œæ‰€ä»¥å°±æ¥æ€»ç»“ä¸€ä¸‹ã€‚&lt;/p>
&lt;p>&lt;a class="link" href="https://github.com/arana-db/kiwi-cpp/pull/204" target="_blank" rel="noopener"
>æäº¤çš„PR&lt;/a>&lt;/p>
&lt;p>&lt;a class="link" href="https://github.com/arana-db/kiwi-cpp/pull/204/files#diff-e56b7c4d89acbd94e631feed9aaf7a2621967b3cb920a96e1c87e2a57779cc3bL65" target="_blank" rel="noopener"
>ä»£ç ä½ç½®&lt;/a>&lt;/p>
&lt;h2 id="bugåˆ†æ">&lt;a href="#bug%e5%88%86%e6%9e%90" class="header-anchor">&lt;/a>bugåˆ†æ
&lt;/h2>&lt;p>æœ‰bugçš„ä»£ç å¦‚ä¸‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>HashesMetaValue &lt;span style="color:#50fa7b">tmf_meta_value2&lt;/span>(DataType&lt;span style="color:#ff79c6">::&lt;/span>kHashes, std&lt;span style="color:#ff79c6">::&lt;/span>string(str, &lt;span style="color:#ff79c6">sizeof&lt;/span>(&lt;span style="color:#8be9fd">int32_t&lt;/span>)));
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">using&lt;/span> HashesMetaValue &lt;span style="color:#ff79c6">=&lt;/span> BaseMetaValue;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3&lt;/span>&lt;span>&lt;span style="color:#ff79c6">class&lt;/span> &lt;span style="color:#50fa7b">BaseMetaValue&lt;/span> &lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#ff79c6">public&lt;/span> InternalValue {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4&lt;/span>&lt;span> &lt;span style="color:#ff79c6">public&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5&lt;/span>&lt;span> &lt;span style="color:#ff79c6">explicit&lt;/span> BaseMetaValue(DataType type, &lt;span style="color:#ff79c6">const&lt;/span> Slice&lt;span style="color:#ff79c6">&amp;amp;&lt;/span> user_value) &lt;span style="color:#ff79c6">:&lt;/span> InternalValue(type, user_value) {}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6&lt;/span>&lt;span> ...................
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7&lt;/span>&lt;span>};
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å¯ä»¥çœ‹åˆ°ï¼Œ&lt;code>BaseMetaValue&lt;/code>çš„æ„é€ å‡½æ•°æ¥å—çš„æ˜¯&lt;code>const Slice&amp;amp;&lt;/code>ç±»å‹çš„å‚æ•°ï¼Œ
è€Œ&lt;code>std::string(str, sizeof(int32_t))&lt;/code>æ˜¯ä¸€ä¸ªä¸´æ—¶å˜é‡ï¼Œæ˜¯ä¸€ä¸ªå³å€¼(å°†äº¡å€¼)ï¼Œ
æ‰€ä»¥è¿™ä¸ªä¸´æ—¶å˜é‡çš„ç”Ÿå‘½å‘¨æœŸåªåœ¨è¿™ä¸€è¡Œä»£ç ä¸­ï¼Œå½“è¿™ä¸€è¡Œä»£ç æ‰§è¡Œå®Œåï¼Œè¿™ä¸ªä¸´æ—¶å˜é‡å°±ä¼šè¢«é”€æ¯ï¼Œ
æ‰€ä»¥&lt;code>tmf_meta_value2&lt;/code>çš„&lt;code>user_value&lt;/code>å°±æ˜¯ä¸€ä¸ªæ‚¬ç©ºæŒ‡é’ˆï¼Œæ‰€ä»¥åœ¨åé¢çš„ä»£ç ä¸­å°±ä¼šå‡ºç°é—®é¢˜ã€‚&lt;/p>
&lt;p>&lt;code>Slice&lt;/code> æ˜¯ä¸€ä¸ªç±»ä¼¼äº&lt;code>std::string_view&lt;/code>çš„ç±»ï¼Œ&lt;code>Slice&lt;/code>ä¸æ‹¥æœ‰æ•°æ®ï¼Œåªæ˜¯ä¸€ä¸ªæŒ‡å‘æ•°æ®çš„æŒ‡é’ˆã€‚æ‰€ä»¥å¿…é¡»ç”±è°ƒç”¨è€…ä¿è¯æ•°æ®çš„ç”Ÿå‘½å‘¨æœŸã€‚&lt;/p>
&lt;p>è§£å†³æ–¹æ³•ä¹Ÿå¾ˆç®€å•ï¼Œå°†&lt;code>BaseMetaValue&lt;/code>çš„æ„é€ å‡½æ•°æ”¹ä¸ºæ¥å—&lt;code>std::string&lt;/code>ç±»å‹çš„å‚æ•°å³å¯ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">auto&lt;/span> key &lt;span style="color:#ff79c6">=&lt;/span> std&lt;span style="color:#ff79c6">::&lt;/span>string(str, &lt;span style="color:#ff79c6">sizeof&lt;/span>(&lt;span style="color:#8be9fd">int32_t&lt;/span>));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span>HashesMetaValue &lt;span style="color:#50fa7b">tmf_meta_value1&lt;/span>(DataType&lt;span style="color:#ff79c6">::&lt;/span>kHashes, key);
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™æ ·&lt;code>key&lt;/code>å°±æ˜¯ä¸€ä¸ªå·¦å€¼ï¼Œç”Ÿå‘½å‘¨æœŸä¼šæŒç»­åˆ°&lt;code>tmf_meta_value1&lt;/code>çš„ç”Ÿå‘½å‘¨æœŸç»“æŸã€‚æ‰€ä»¥å°±ä¸ä¼šå‡ºç°æ‚¬ç©ºæŒ‡é’ˆçš„é—®é¢˜äº†ã€‚&lt;/p>
&lt;p>C++ä¸­æ²¡æœ‰ä¸¥æ ¼é™åˆ¶å˜é‡çš„ç”Ÿå‘½å‘¨æœŸï¼Œæˆ‘æ²¡æœ‰ç³»ç»Ÿçš„å­¦ä¹ è¿‡rustï¼Œä½†æ˜¯äº†è§£è¿‡rustçš„ä¸€äº›æ¦‚å¿µï¼Œrustä¸­æœ‰ä¸¥æ ¼çš„ç”Ÿå‘½å‘¨æœŸæ£€æŸ¥ï¼Œè¿™æ ·å°±å¯ä»¥é¿å…å¾ˆå¤šæ‚¬ç©ºæŒ‡é’ˆçš„é—®é¢˜ï¼Œ
ä¸Šè¿°çš„bugåœ¨rustä¸­æ˜¯ä¸ä¼šå‡ºç°çš„ã€‚å› ä¸ºrustä¸­æœ‰ä¸¥æ ¼çš„å˜é‡æ‰€æœ‰æƒçš„ï¼Œç”Ÿå‘½å‘¨æœŸæ£€æŸ¥ã€‚ &lt;strong>æ‰€æœ‰æƒ&lt;/strong> è¿™ä¸ªæ¦‚å¿µåœ¨rustä¸­æ˜¯éå¸¸é‡è¦ï¼Œæˆ‘è§‰å¾—è¿™ä¸ªæ¦‚å¿µåœ¨C++ä¸­ä¹Ÿæ˜¯å¾ˆé‡è¦çš„ï¼Œ
æƒ³è¦å†™å‡ºé«˜è´¨é‡çš„ä»£ç ï¼Œå°±éœ€è¦äº†è§£è¿™æ‰€æœ‰æƒè¿™ä¸ªæ¦‚å¿µã€‚&lt;/p>
&lt;h2 id="å·¦å€¼å³å€¼">&lt;a href="#%e5%b7%a6%e5%80%bc%e5%8f%b3%e5%80%bc" class="header-anchor">&lt;/a>å·¦å€¼ã€å³å€¼
&lt;/h2>&lt;h3 id="å·¦å€¼">&lt;a href="#%e5%b7%a6%e5%80%bc" class="header-anchor">&lt;/a>å·¦å€¼
&lt;/h3>&lt;p>æœ€ç®€å•çš„ä¸€ä¸ªä¾‹å­å°±æ˜¯å˜é‡ï¼Œå˜é‡æ˜¯ä¸€ä¸ªå·¦å€¼ï¼Œå®ƒæœ‰ä¸€ä¸ªå†…å­˜åœ°å€ï¼Œå¯ä»¥å–åœ°å€ï¼Œå¯ä»¥ä¿®æ”¹ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>&lt;span style="color:#8be9fd">int&lt;/span> a &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#bd93f9">10&lt;/span>; &lt;span style="color:#6272a4">// a æ˜¯å·¦å€¼
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span>&lt;span style="color:#8be9fd">int&lt;/span>&lt;span style="color:#ff79c6">*&lt;/span> p &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#ff79c6">&amp;amp;&lt;/span>a; &lt;span style="color:#6272a4">// å¯ä»¥å– a çš„åœ°å€
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span>a &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#bd93f9">20&lt;/span>; &lt;span style="color:#6272a4">// a å¯ä»¥è¢«èµ‹å€¼
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="å³å€¼">&lt;a href="#%e5%8f%b3%e5%80%bc" class="header-anchor">&lt;/a>å³å€¼
&lt;/h3>&lt;p>å³å€¼æ˜¯æŒ‡ä¸èƒ½å–åœ°å€çš„ä¸´æ—¶å¯¹è±¡æˆ–å€¼ï¼Œé€šå¸¸æ˜¯çŸ­æš‚å­˜åœ¨çš„ï¼ˆephemeralï¼‰ï¼Œæ— æ³•å‡ºç°åœ¨èµ‹å€¼è¯­å¥çš„å·¦ä¾§ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>&lt;span style="color:#8be9fd">int&lt;/span> b &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#bd93f9">5&lt;/span> &lt;span style="color:#ff79c6">+&lt;/span> &lt;span style="color:#bd93f9">3&lt;/span>; &lt;span style="color:#6272a4">// 5 + 3 æ˜¯å³å€¼ï¼ˆçº¯å³å€¼ï¼‰
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å…¶ä¸­å³å€¼åˆå¯ä»¥åˆ†ä¸ºçº¯å³å€¼å’Œå°†äº¡å€¼ã€‚&lt;/p>
&lt;h4 id="çº¯å³å€¼">&lt;a href="#%e7%ba%af%e5%8f%b3%e5%80%bc" class="header-anchor">&lt;/a>çº¯å³å€¼
&lt;/h4>&lt;p>ç‰¹æ€§ï¼šæ²¡æœ‰èº«ä»½ï¼Œæ— æ³•å–åœ°å€ï¼Œæ— æ³•è¢«èµ‹å€¼&lt;/p>
&lt;p>å¸¸è§çš„ &lt;strong>å­—é¢é‡&lt;/strong>ã€&lt;strong>ä¸´æ—¶å¯¹è±¡&lt;/strong>ã€&lt;strong>å‡½æ•°è¿”å›å€¼&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>&lt;span style="color:#bd93f9">42&lt;/span>; &lt;span style="color:#6272a4">// å­—é¢é‡æ˜¯çº¯å³å€¼
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span>&lt;span style="color:#bd93f9">5&lt;/span> &lt;span style="color:#ff79c6">+&lt;/span> &lt;span style="color:#bd93f9">3&lt;/span>; &lt;span style="color:#6272a4">// è®¡ç®—ç»“æœæ˜¯çº¯å³å€¼
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span>std&lt;span style="color:#ff79c6">::&lt;/span>string(&lt;span style="color:#f1fa8c">&amp;#34;hello&amp;#34;&lt;/span>); &lt;span style="color:#6272a4">// æ„é€ å‡½æ•°è¿”å›çš„ä¸´æ—¶å¯¹è±¡æ˜¯çº¯å³å€¼
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="å°†äº¡å€¼">&lt;a href="#%e5%b0%86%e4%ba%a1%e5%80%bc" class="header-anchor">&lt;/a>å°†äº¡å€¼
&lt;/h4>&lt;p>å°†äº¡å€¼æ˜¯â€œå³å°†æ¶ˆäº¡çš„å€¼â€ï¼Œé€šå¸¸æ˜¯é€šè¿‡å³å€¼å¼•ç”¨ç»‘å®šåˆ°çš„ä¸´æ—¶å¯¹è±¡ï¼Œæˆ–è€…è¢«æ˜¾å¼ç§»åŠ¨ï¼ˆmoveï¼‰çš„å¯¹è±¡ã€‚&lt;/p>
&lt;p>ç‰¹æ€§ï¼šæœ‰èº«ä»½ï¼ˆå¯ä»¥å–åœ°å€ï¼‰ï¼Œä½†ç”Ÿå‘½å‘¨æœŸå³å°†ç»“æŸ&lt;/p>
&lt;p>é€šå¸¸å‡ºç°åœ¨ä½¿ç”¨ &lt;code>std::move&lt;/code> æˆ–å‡½æ•°è¿”å›å³å€¼å¼•ç”¨çš„åœºæ™¯&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">#include&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;utility&amp;gt;&lt;/span>&lt;span style="color:#ff79c6">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span>&lt;span style="color:#ff79c6">&lt;/span>&lt;span style="color:#8be9fd">int&lt;/span>&lt;span style="color:#ff79c6">&amp;amp;&amp;amp;&lt;/span> getRvalue() { &lt;span style="color:#ff79c6">return&lt;/span> &lt;span style="color:#bd93f9">42&lt;/span>; }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3&lt;/span>&lt;span>&lt;span style="color:#8be9fd">int&lt;/span> &lt;span style="color:#50fa7b">main&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4&lt;/span>&lt;span> &lt;span style="color:#8be9fd">int&lt;/span> a &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#bd93f9">10&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5&lt;/span>&lt;span> &lt;span style="color:#8be9fd">int&lt;/span>&lt;span style="color:#ff79c6">&amp;amp;&amp;amp;&lt;/span> r1 &lt;span style="color:#ff79c6">=&lt;/span> std&lt;span style="color:#ff79c6">::&lt;/span>move(a); &lt;span style="color:#6272a4">// std::move(a) æ˜¯å°†äº¡å€¼
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#8be9fd">int&lt;/span>&lt;span style="color:#ff79c6">&amp;amp;&amp;amp;&lt;/span> r2 &lt;span style="color:#ff79c6">=&lt;/span> getRvalue(); &lt;span style="color:#6272a4">// getRvalue() è¿”å›çš„ä¸´æ—¶å¯¹è±¡æ˜¯å°†äº¡å€¼
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="å˜é‡çš„ç”Ÿå‘½å‘¨æœŸ">&lt;a href="#%e5%8f%98%e9%87%8f%e7%9a%84%e7%94%9f%e5%91%bd%e5%91%a8%e6%9c%9f" class="header-anchor">&lt;/a>å˜é‡çš„ç”Ÿå‘½å‘¨æœŸ
&lt;/h2>&lt;h3 id="å·¦å€¼-1">&lt;a href="#%e5%b7%a6%e5%80%bc-1" class="header-anchor">&lt;/a>å·¦å€¼
&lt;/h3>&lt;p>å·¦å€¼çš„ç”Ÿå‘½å‘¨æœŸç”±å­˜å‚¨æœŸå†³å®šï¼Œé€šå¸¸æ˜¯æŒä¹…çš„ï¼Œå¯ä»¥æ§åˆ¶ã€‚æ¯”å¦‚å±€éƒ¨å˜é‡ï¼Œç¦»å¼€ä½œç”¨åŸŸåä¼šè¢«é”€æ¯ã€‚
åŠ¨æ€åˆ†é…çš„å†…å­˜ä¹Ÿæ˜¯å·¦å€¼ï¼Œéœ€è¦æ‰‹åŠ¨é‡Šæ”¾ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>&lt;span style="color:#8be9fd">void&lt;/span> &lt;span style="color:#50fa7b">example&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span> &lt;span style="color:#8be9fd">int&lt;/span> a &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#bd93f9">10&lt;/span>; &lt;span style="color:#6272a4">// å·¦å€¼ aï¼Œè‡ªåŠ¨å­˜å‚¨æœŸï¼Œç¦»å¼€ä½œç”¨åŸŸé”€æ¯
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">static&lt;/span> &lt;span style="color:#8be9fd">int&lt;/span> b &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#bd93f9">20&lt;/span>; &lt;span style="color:#6272a4">// å·¦å€¼ bï¼Œé™æ€å­˜å‚¨æœŸï¼Œç¨‹åºç»“æŸé”€æ¯
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#8be9fd">int&lt;/span>&lt;span style="color:#ff79c6">*&lt;/span> p &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#ff79c6">new&lt;/span> &lt;span style="color:#8be9fd">int&lt;/span>(&lt;span style="color:#bd93f9">30&lt;/span>); &lt;span style="color:#6272a4">// å·¦å€¼ *pï¼ŒåŠ¨æ€å­˜å‚¨æœŸï¼Œç›´åˆ° delete
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">delete&lt;/span> p;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>&lt;code>a&lt;/code> çš„ç”Ÿå‘½å‘¨æœŸä»å®šä¹‰åˆ°å‡½æ•°ç»“æŸã€‚&lt;/li>
&lt;li>&lt;code>b&lt;/code> çš„ç”Ÿå‘½å‘¨æœŸè´¯ç©¿æ•´ä¸ªç¨‹åºã€‚&lt;/li>
&lt;li>&lt;code>p&lt;/code> çš„ç”Ÿå‘½å‘¨æœŸä» &lt;code>new&lt;/code> åˆ° &lt;code>delete&lt;/code>ã€‚&lt;/li>
&lt;/ul>
&lt;h3 id="å³å€¼-1">&lt;a href="#%e5%8f%b3%e5%80%bc-1" class="header-anchor">&lt;/a>å³å€¼
&lt;/h3>&lt;ul>
&lt;li>çº¯å³å€¼ï¼šç”Ÿå‘½å‘¨æœŸçŸ­æš‚ï¼Œè¡¨è¾¾å¼ç»“æŸåé”€æ¯ï¼Œä¸€æ—¦è¡¨è¾¾å¼æ±‚å€¼å®Œæˆï¼Œçº¯å³å€¼è¦ä¹ˆè¢«é”€æ¯ï¼Œè¦ä¹ˆè¢«ç”¨äºåˆå§‹åŒ–å…¶ä»–å¯¹è±¡&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>&lt;span style="color:#8be9fd">int&lt;/span> &lt;span style="color:#50fa7b">main&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span> &lt;span style="color:#bd93f9">5&lt;/span> &lt;span style="color:#ff79c6">+&lt;/span> &lt;span style="color:#bd93f9">3&lt;/span>; &lt;span style="color:#6272a4">// çº¯å³å€¼ï¼Œè¡¨è¾¾å¼ç»“æŸåé”€æ¯
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> std&lt;span style="color:#ff79c6">::&lt;/span>string s &lt;span style="color:#ff79c6">=&lt;/span> std&lt;span style="color:#ff79c6">::&lt;/span>string(&lt;span style="color:#f1fa8c">&amp;#34;hello&amp;#34;&lt;/span>); &lt;span style="color:#6272a4">// ä¸´æ—¶å¯¹è±¡æ˜¯çº¯å³å€¼ï¼Œæ„é€  s åé”€æ¯
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">const&lt;/span> &lt;span style="color:#8be9fd">int&lt;/span>&lt;span style="color:#ff79c6">&amp;amp;&lt;/span> ref &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#bd93f9">42&lt;/span>; &lt;span style="color:#6272a4">// çº¯å³å€¼ 42 çš„ç”Ÿå‘½å‘¨æœŸå»¶é•¿åˆ° ref çš„ä½œç”¨åŸŸç»“æŸ
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>å°†äº¡å€¼ï¼šç”Ÿå‘½å‘¨æœŸå–å†³äºåº•å±‚å¯¹è±¡ï¼Œé€šå¸¸æ˜¯çŸ­æš‚çš„ï¼Œæˆ–è€…å¯ä»¥è¢«è½¬ç§»ï¼Œå¯ä»¥é€šè¿‡å³å€¼å¼•ç”¨ç»‘å®šå»¶é•¿ç”Ÿå‘½å‘¨æœŸ&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>std&lt;span style="color:#ff79c6">::&lt;/span>string&lt;span style="color:#ff79c6">&amp;amp;&amp;amp;&lt;/span> rvalue &lt;span style="color:#ff79c6">=&lt;/span> std&lt;span style="color:#ff79c6">::&lt;/span>move(str); &lt;span style="color:#6272a4">// str æ˜¯å°†äº¡å€¼ï¼Œé€šè¿‡ std::move è½¬ä¸ºå³å€¼å¼•ç”¨ï¼Œå»¶é•¿ç”Ÿå‘½å‘¨æœŸ
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="å£°æ˜å‘¨æœŸçš„å»¶é•¿">&lt;a href="#%e5%a3%b0%e6%98%8e%e5%91%a8%e6%9c%9f%e7%9a%84%e5%bb%b6%e9%95%bf" class="header-anchor">&lt;/a>å£°æ˜å‘¨æœŸçš„å»¶é•¿
&lt;/h3>&lt;ul>
&lt;li>ç»‘å®šåˆ°å¸¸é‡å·¦å€¼å¼•ç”¨ &lt;code>const &amp;amp;&lt;/code>
å½“çº¯å³å€¼ç»‘å®šåˆ° &lt;code>const T&amp;amp;&lt;/code> æ—¶ï¼Œä¸´æ—¶å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸå»¶é•¿åˆ°å¼•ç”¨çš„ä½œç”¨åŸŸç»“æŸã€‚
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">const&lt;/span> std&lt;span style="color:#ff79c6">::&lt;/span>string&lt;span style="color:#ff79c6">&amp;amp;&lt;/span> str &lt;span style="color:#ff79c6">=&lt;/span> std&lt;span style="color:#ff79c6">::&lt;/span>string(&lt;span style="color:#f1fa8c">&amp;#34;temp&amp;#34;&lt;/span>); &lt;span style="color:#6272a4">// str æœ‰æ•ˆç›´åˆ°ä½œç”¨åŸŸç»“æŸ
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>ç»‘å®šåˆ°å³å€¼å¼•ç”¨&lt;code>&amp;amp;&amp;amp;&lt;/code>
å½“å³å€¼ï¼ˆçº¯å³å€¼æˆ–å°†äº¡å€¼ï¼‰ç»‘å®šåˆ° &lt;code>T&amp;amp;&amp;amp;&lt;/code> æ—¶ï¼Œä¸´æ—¶å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸå»¶é•¿åˆ°å³å€¼å¼•ç”¨çš„ä½œç”¨åŸŸç»“æŸã€‚
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>std&lt;span style="color:#ff79c6">::&lt;/span>string&lt;span style="color:#ff79c6">&amp;amp;&amp;amp;&lt;/span> str &lt;span style="color:#ff79c6">=&lt;/span> std&lt;span style="color:#ff79c6">::&lt;/span>string(&lt;span style="color:#f1fa8c">&amp;#34;temp&amp;#34;&lt;/span>); &lt;span style="color:#6272a4">// str æœ‰æ•ˆç›´åˆ°ä½œç”¨åŸŸç»“æŸ
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;/ul>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>å€¼ç±»åˆ«&lt;/th>
&lt;th>ç”Ÿå‘½å‘¨æœŸç‰¹ç‚¹&lt;/th>
&lt;th>æ˜¯å¦å¯å»¶é•¿ç”Ÿå‘½å‘¨æœŸ&lt;/th>
&lt;th>ç¤ºä¾‹åœºæ™¯&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>å·¦å€¼ (lvalue)&lt;/td>
&lt;td>ç”±å­˜å‚¨æœŸå†³å®šï¼ŒæŒä¹…ä¸”å¯æ§&lt;/td>
&lt;td>ä¸éœ€è¦å»¶é•¿ï¼Œæœ¬èº«æŒä¹…&lt;/td>
&lt;td>å±€éƒ¨å˜é‡ã€å…¨å±€å˜é‡&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>çº¯å³å€¼ (prvalue)&lt;/td>
&lt;td>ä¸´æ—¶ï¼Œè¡¨è¾¾å¼ç»“æŸåé”€æ¯&lt;/td>
&lt;td>å¯é€šè¿‡ const &amp;amp; å»¶é•¿&lt;/td>
&lt;td>å­—é¢é‡ã€ä¸´æ—¶å¯¹è±¡&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>å°†äº¡å€¼ (xvalue)&lt;/td>
&lt;td>å–å†³äºåº•å±‚å¯¹è±¡ï¼Œé€šå¸¸çŸ­æš‚æˆ–å¯è½¬ç§»&lt;/td>
&lt;td>å¯é€šè¿‡ &amp;amp;&amp;amp; ç»‘å®šå»¶é•¿&lt;/td>
&lt;td>std::moveã€å‡½æ•°è¿”å›å³å€¼å¼•ç”¨&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h2 id="å·¦å€¼å¼•ç”¨å³å€¼å¼•ç”¨">&lt;a href="#%e5%b7%a6%e5%80%bc%e5%bc%95%e7%94%a8%e5%8f%b3%e5%80%bc%e5%bc%95%e7%94%a8" class="header-anchor">&lt;/a>å·¦å€¼å¼•ç”¨ã€å³å€¼å¼•ç”¨
&lt;/h2>&lt;p>å•çº¯çš„å·¦å€¼å’Œå³å€¼å…¶å®è¿˜æ˜¯å¥½ç†è§£çš„ï¼Œä½†æ˜¯ç»“åˆC++ä¸­çš„å¼•ç”¨ï¼Œå°±ä¼šæœ‰ä¸€äº›ç‰¹æ®Šçš„æƒ…å†µï¼Œæ¯”å¦‚å³å€¼å¼•ç”¨ç»‘å®šåˆ°å·¦å€¼ï¼Œ
å³å€¼å¼•ç”¨ç»‘å®šåˆ°å³å€¼ç­‰ç­‰ï¼Œè¿™äº›æƒ…å†µå°±éœ€è¦æˆ‘ä»¬å»äº†è§£C++ä¸­çš„å¼•ç”¨çš„ç‰¹æ€§ã€‚&lt;/p>
&lt;h3 id="å·¦å€¼å¼•ç”¨">&lt;a href="#%e5%b7%a6%e5%80%bc%e5%bc%95%e7%94%a8" class="header-anchor">&lt;/a>å·¦å€¼å¼•ç”¨
&lt;/h3>&lt;p>å…ˆæ¥çœ‹ä¸€ä¸‹æœ€ç®€å•çš„å·¦å€¼å¼•ç”¨ï¼Œæˆ‘çš„ç†è§£ï¼Œå·¦å€¼å¼•ç”¨å¯ä»¥ç†è§£ä¸ºä¸€ä¸ªåˆ«åï¼Œå®ƒæ˜¯ä¸€ä¸ªå·¦å€¼ï¼Œå¯ä»¥å–åœ°å€ï¼Œå¯ä»¥ä¿®æ”¹ï¼Œå¯ä»¥çœ‹åšæ˜¯ä¸€ç§ç®€åŒ–çš„æŒ‡é’ˆã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>&lt;span style="color:#8be9fd">int&lt;/span> a &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#bd93f9">42&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span>&lt;span style="color:#8be9fd">int&lt;/span>&lt;span style="color:#ff79c6">&amp;amp;&lt;/span> ref &lt;span style="color:#ff79c6">=&lt;/span> a; &lt;span style="color:#6272a4">// å·¦å€¼å¼•ç”¨ï¼Œç»‘å®šåˆ°å·¦å€¼
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span>ref &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#bd93f9">100&lt;/span>; &lt;span style="color:#6272a4">// ä¿®æ”¹refå®é™…ä¸Šå°±æ˜¯ä¿®æ”¹a
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å·¦å€¼å¼•ç”¨ä¸­ï¼Œè¿˜æœ‰ä¸€ä¸ªç‰¹æ®Šçš„æƒ…å†µï¼Œå°±æ˜¯ const å·¦å€¼å¼•ç”¨ï¼Œå®ƒå¯ä»¥ç»‘å®šåˆ°å³å€¼ï¼Œä½†æ˜¯ä¸èƒ½ä¿®æ”¹ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">const&lt;/span> &lt;span style="color:#8be9fd">int&lt;/span>&lt;span style="color:#ff79c6">&amp;amp;&lt;/span> ref &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#bd93f9">42&lt;/span>; &lt;span style="color:#6272a4">// const å·¦å€¼å¼•ç”¨ï¼Œç»‘å®šåˆ°å³å€¼
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>const&lt;/strong> ç±»å‹çš„å·¦å€¼å¼•ç”¨ï¼Œå¸¸ç”¨åœ¨å‡½æ•°çš„å‚æ•°ä¸­ï¼Œå¯ä»¥æ¥å—å·¦å€¼å’Œå³å€¼ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>&lt;span style="color:#8be9fd">void&lt;/span> &lt;span style="color:#50fa7b">func&lt;/span>(&lt;span style="color:#ff79c6">const&lt;/span> &lt;span style="color:#8be9fd">int&lt;/span>&lt;span style="color:#ff79c6">&amp;amp;&lt;/span> ref) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span> &lt;span style="color:#6272a4">// ref å¯ä»¥ç»‘å®šåˆ°å·¦å€¼æˆ–å³å€¼
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5&lt;/span>&lt;span>&lt;span style="color:#8be9fd">int&lt;/span> &lt;span style="color:#50fa7b">main&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6&lt;/span>&lt;span> &lt;span style="color:#8be9fd">int&lt;/span> a &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#bd93f9">42&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7&lt;/span>&lt;span> func(a); &lt;span style="color:#6272a4">// a æ˜¯å·¦å€¼
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> func(&lt;span style="color:#bd93f9">42&lt;/span>); &lt;span style="color:#6272a4">// 42 æ˜¯å³å€¼
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">9&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä¸ºä»€ä¹ˆ &lt;strong>const&lt;/strong> å·¦å€¼å¼•ç”¨å¯ä»¥ç»‘å®šåˆ°å³å€¼å‘¢ï¼Ÿå› ä¸ºå³å€¼æ˜¯ä¸´æ—¶çš„ï¼Œä¸ä¼šè¢«ä¿®æ”¹ï¼Œconstä¿®é¥°çš„å˜é‡æ˜¯ä¸å¯ä»¥ä¿®æ”¹çš„ï¼Œ
æ‰€ä»¥å¯ä»¥ç»‘å®šåˆ°constå·¦å€¼å¼•ç”¨ã€‚&lt;/p>
&lt;h3 id="å³å€¼å¼•ç”¨">&lt;a href="#%e5%8f%b3%e5%80%bc%e5%bc%95%e7%94%a8" class="header-anchor">&lt;/a>å³å€¼å¼•ç”¨
&lt;/h3>&lt;p>å³å€¼å¼•ç”¨æ˜¯C++11å¼•å…¥çš„æ–°ç‰¹æ€§ï¼Œå®ƒæ˜¯ä¸€ä¸ªæ–°çš„å¼•ç”¨ç±»å‹ï¼Œç”¨äºç»‘å®šåˆ°å³å€¼ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>&lt;span style="color:#8be9fd">int&lt;/span>&lt;span style="color:#ff79c6">&amp;amp;&amp;amp;&lt;/span> rref &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#bd93f9">100&lt;/span>; &lt;span style="color:#6272a4">// å³å€¼å¼•ç”¨ï¼Œç»‘å®šåˆ°å³å€¼
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span>&lt;span style="color:#8be9fd">int&lt;/span> x &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#bd93f9">101&lt;/span>ï¼›
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3&lt;/span>&lt;span>rref &lt;span style="color:#ff79c6">=&lt;/span> x; &lt;span style="color:#6272a4">// é”™è¯¯ï¼Œå³å€¼å¼•ç”¨ä¸èƒ½ç»‘å®šåˆ°å·¦å€¼
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å³å€¼å¼•ç”¨æœ‰å®¹æ˜“è¿·æƒ‘çš„åœ°æ–¹ï¼Œæ¯”å¦‚ä¸€ä¸ªå‡½æ•°çš„å‚æ•°æ˜¯å³å€¼å¼•ç”¨ï¼Œä½†æ˜¯è¿™ä¸ªå³å€¼åœ¨å‡½æ•°è°ƒç”¨æ—¶æ˜¯å·¦å€¼ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>&lt;span style="color:#8be9fd">void&lt;/span> &lt;span style="color:#50fa7b">func&lt;/span>(&lt;span style="color:#8be9fd">int&lt;/span>&lt;span style="color:#ff79c6">&amp;amp;&amp;amp;&lt;/span> ref) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span> &lt;span style="color:#6272a4">// ref æ˜¯å³å€¼å¼•ç”¨, ä½†æ˜¯åœ¨å‡½æ•°è°ƒç”¨æ—¶æ˜¯å·¦å€¼
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> ref &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#bd93f9">100&lt;/span>; &lt;span style="color:#6272a4">// å¯ä»¥ä¿®æ”¹
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä¸¤ç§å¼•ç”¨åœ¨å‡½æ•°è°ƒç”¨æ—¶çš„åŒºåˆ«ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#8be9fd">void&lt;/span> &lt;span style="color:#50fa7b">func1&lt;/span>(&lt;span style="color:#8be9fd">int&lt;/span>&lt;span style="color:#ff79c6">&amp;amp;&lt;/span> ref) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span> &lt;span style="color:#6272a4">// ref æ˜¯å·¦å€¼å¼•ç”¨
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span>&lt;span style="color:#8be9fd">void&lt;/span> &lt;span style="color:#50fa7b">func2&lt;/span>(&lt;span style="color:#8be9fd">int&lt;/span>&lt;span style="color:#ff79c6">&amp;amp;&amp;amp;&lt;/span> ref) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span> &lt;span style="color:#6272a4">// ref æ˜¯å³å€¼å¼•ç”¨
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span>&lt;span style="color:#8be9fd">void&lt;/span> &lt;span style="color:#50fa7b">func3&lt;/span>(&lt;span style="color:#ff79c6">const&lt;/span> &lt;span style="color:#8be9fd">int&lt;/span>&lt;span style="color:#ff79c6">&amp;amp;&lt;/span> ref) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span> &lt;span style="color:#6272a4">// ref æ˜¯ const å·¦å€¼å¼•ç”¨
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span>&lt;span style="color:#8be9fd">int&lt;/span> &lt;span style="color:#50fa7b">main&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span> &lt;span style="color:#8be9fd">int&lt;/span> a &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#bd93f9">100&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15&lt;/span>&lt;span> func1(a); &lt;span style="color:#6272a4">// æ­£ç¡® a æ˜¯å·¦å€¼
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> func1(&lt;span style="color:#bd93f9">101&lt;/span>); &lt;span style="color:#6272a4">// é”™è¯¯ 101 æ˜¯å³å€¼
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> func2(&lt;span style="color:#bd93f9">102&lt;/span>); &lt;span style="color:#6272a4">// æ­£ç¡® 102 æ˜¯å³å€¼
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> func2(a); &lt;span style="color:#6272a4">// é”™è¯¯ a æ˜¯å·¦å€¼
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> func3(a); &lt;span style="color:#6272a4">// æ­£ç¡® a æ˜¯å·¦å€¼
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> func3(&lt;span style="color:#bd93f9">103&lt;/span>); &lt;span style="color:#6272a4">// æ­£ç¡® 103 æ˜¯å³å€¼
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="å¼•ç”¨æŠ˜å ">&lt;a href="#%e5%bc%95%e7%94%a8%e6%8a%98%e5%8f%a0" class="header-anchor">&lt;/a>å¼•ç”¨æŠ˜å 
&lt;/h3>&lt;p>å¼•ç”¨æŠ˜å æ˜¯C++11å¼•å…¥çš„æ–°ç‰¹æ€§ï¼Œä¹Ÿå¯ä»¥å«ä¸‡èƒ½å¼•ç”¨ï¼Œç”¨äºç®€åŒ–å¼•ç”¨çš„ä½¿ç”¨ï¼Œä¸»è¦ç”¨äºæ¨¡æ¿çš„å‚æ•°æ¨å¯¼ã€‚
ä¸»è¦ç”¨åœ¨æ¨¡æ¿çš„å‚æ•°æ¨å¯¼ä¸­ï¼Œå½“ä¸€ä¸ªæ¨¡æ¿å‚æ•°æ˜¯å¼•ç”¨æ—¶ï¼Œå¼•ç”¨æŠ˜å è§„åˆ™ä¼šå†³å®šæœ€ç»ˆçš„å¼•ç”¨ç±»å‹ã€‚&lt;/p>
&lt;p>C++11å¼•å…¥å³å€¼å¼•ç”¨ &lt;code>T&amp;amp;&amp;amp;&lt;/code> åï¼Œå…è®¸ç»‘å®šåˆ°å³å€¼ï¼ŒåŒæ—¶åœ¨æ¨¡æ¿ä¸­å¯èƒ½å‡ºç°å¤æ‚çš„ç±»å‹æ¨å¯¼æƒ…å†µï¼Œä¾‹å¦‚ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;code>T&amp;amp; &amp;amp;&lt;/code>&lt;/li>
&lt;li>&lt;code>T&amp;amp; &amp;amp;&amp;amp;&lt;/code>&lt;/li>
&lt;li>&lt;code>T&amp;amp;&amp;amp; &amp;amp;&lt;/code>&lt;/li>
&lt;li>&lt;code>T&amp;amp;&amp;amp; &amp;amp;&amp;amp;&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>ä¸ºäº†ç®€åŒ–æ¨¡æ¿å‚æ•°æ¨å¯¼ï¼Œå¼•å…¥äº†å¼•ç”¨æŠ˜å è§„åˆ™ï¼š&lt;/p>
&lt;p>å¼•ç”¨æŠ˜å è§„åˆ™ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;code>T&amp;amp; &amp;amp; -&amp;gt; T&amp;amp;&lt;/code>&lt;/li>
&lt;li>&lt;code>T&amp;amp; &amp;amp;&amp;amp; -&amp;gt; T&amp;amp;&lt;/code>&lt;/li>
&lt;li>&lt;code>T&amp;amp;&amp;amp; &amp;amp; -&amp;gt; T&amp;amp;&lt;/code>&lt;/li>
&lt;li>&lt;code>T&amp;amp;&amp;amp; &amp;amp;&amp;amp; -&amp;gt; T&amp;amp;&amp;amp;&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>ç®€å•æ¥è¯´,å·¦å€¼å¼•ç”¨ &lt;code>&amp;amp;&lt;/code> å…·æœ‰ä¼˜å…ˆçº§ï¼Œåªè¦ç»„åˆä¸­å‡ºç°å·¦å€¼å¼•ç”¨ï¼Œæœ€ç»ˆç»“æœå°±æ˜¯å·¦å€¼å¼•ç”¨ã€‚
å³å€¼å¼•ç”¨ &lt;code>&amp;amp;&amp;amp;&lt;/code> åªæœ‰åœ¨æ²¡æœ‰å·¦å€¼å¼•ç”¨çš„æƒ…å†µä¸‹æ‰ä¼šä¿ç•™ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">template&lt;/span>&lt;span style="color:#ff79c6">&amp;lt;&lt;/span>&lt;span style="color:#ff79c6">typename&lt;/span> T&lt;span style="color:#ff79c6">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span>&lt;span style="color:#8be9fd">void&lt;/span> func(T&lt;span style="color:#ff79c6">&amp;amp;&amp;amp;&lt;/span> param) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span> &lt;span style="color:#6272a4">// param çš„ç±»å‹å–å†³äºä¼ å…¥çš„å€¼ç±»åˆ«
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span>&lt;span style="color:#8be9fd">int&lt;/span> &lt;span style="color:#50fa7b">main&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span> &lt;span style="color:#8be9fd">int&lt;/span> x &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#bd93f9">100&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span> func(x); &lt;span style="color:#6272a4">// T æ¨å¯¼ä¸º int&amp;amp;ï¼ŒT&amp;amp;&amp;amp; æŠ˜å ä¸º int&amp;amp;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> func(&lt;span style="color:#bd93f9">101&lt;/span>); &lt;span style="color:#6272a4">// T æ¨å¯¼ä¸º intï¼ŒT&amp;amp;&amp;amp; ä¿æŒä¸º int&amp;amp;&amp;amp;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>å½“ä¼ å…¥å·¦å€¼&lt;code>x&lt;/code>æ—¶ï¼Œ&lt;code>T&lt;/code>æ¨å¯¼ä¸º&lt;code>int&amp;amp;&lt;/code>ï¼Œ&lt;code>T&amp;amp;&amp;amp;&lt;/code>å˜æˆ&lt;code>int&amp;amp; &amp;amp;&amp;amp;&lt;/code>ï¼ŒæŠ˜å ä¸º&lt;code>int&amp;amp;&lt;/code>ã€‚&lt;/li>
&lt;li>å½“ä¼ å…¥å³å€¼&lt;code>101&lt;/code>æ—¶ï¼Œ&lt;code>T&lt;/code>æ¨å¯¼ä¸º&lt;code>int&lt;/code>ï¼Œ&lt;code>T&amp;amp;&amp;amp;&lt;/code>ä¿æŒä¸º&lt;code>int&amp;amp;&amp;amp;&lt;/code>ã€‚&lt;/li>
&lt;/ul>
&lt;p>å¼•ç”¨æŠ˜å ç”Ÿæ•ˆçš„ä¸€ä¸ªå‰ææ˜¯æ¨¡æ¿å‚æ•°è¦å‘ç”Ÿç±»å‹æ¨å¯¼ï¼Œå¦‚æœæ¨¡æ¿å‚æ•°æ˜¯æ˜ç¡®çš„ç±»å‹ï¼Œå¼•ç”¨æŠ˜å è§„åˆ™ä¸ä¼šç”Ÿæ•ˆã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">template&lt;/span>&lt;span style="color:#ff79c6">&amp;lt;&lt;/span>&lt;span style="color:#ff79c6">typename&lt;/span> T&lt;span style="color:#ff79c6">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span>&lt;span style="color:#8be9fd">void&lt;/span> func(std&lt;span style="color:#ff79c6">::&lt;/span>vector&lt;span style="color:#ff79c6">&amp;lt;&lt;/span>T&lt;span style="color:#ff79c6">&amp;gt;&amp;amp;&amp;amp;&lt;/span> param); &lt;span style="color:#6272a4">// æ™®é€šå³å€¼å¼•ç”¨ï¼Œåªèƒ½ç»‘å®šå³å€¼
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">template&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;&lt;/span>&lt;span style="color:#ff79c6">typename&lt;/span> T&lt;span style="color:#ff79c6">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span>&lt;span style="color:#ff79c6">class&lt;/span> &lt;span style="color:#50fa7b">A&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span>&lt;span style="color:#ff79c6">public&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span> &lt;span style="color:#8be9fd">void&lt;/span> push(T&lt;span style="color:#ff79c6">&amp;amp;&amp;amp;&lt;/span> t)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span> data_.push_back(std&lt;span style="color:#ff79c6">::&lt;/span>forward&lt;span style="color:#ff79c6">&amp;lt;&lt;/span>T&lt;span style="color:#ff79c6">&amp;gt;&lt;/span>(t));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span>&lt;span style="color:#ff79c6">private&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span> std&lt;span style="color:#ff79c6">::&lt;/span>vector&lt;span style="color:#ff79c6">&amp;lt;&lt;/span>T&lt;span style="color:#ff79c6">&amp;gt;&lt;/span> data_;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span>};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span>&lt;span style="color:#8be9fd">int&lt;/span> &lt;span style="color:#50fa7b">main&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15&lt;/span>&lt;span> A&lt;span style="color:#ff79c6">&amp;lt;&lt;/span>&lt;span style="color:#8be9fd">int&lt;/span>&lt;span style="color:#ff79c6">&amp;gt;&lt;/span> a;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16&lt;/span>&lt;span> &lt;span style="color:#6272a4">// int x = 100;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#6272a4">// a.push(x); // ç¼–è¯‘é”™è¯¯ï¼šå·¦å€¼ä¸èƒ½ç»‘å®šåˆ°å³å€¼å¼•ç”¨
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> a.push(&lt;span style="color:#bd93f9">101&lt;/span>); &lt;span style="color:#6272a4">// æ­£ç¡®ï¼šå³å€¼
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">return&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™é‡Œçš„ &lt;code>T&amp;amp;&amp;amp;&lt;/code> æ˜¯ä¸€ä¸ªå³å€¼å¼•ç”¨ï¼Œä½†æ˜¯åœ¨æ¨¡æ¿å‚æ•°æ¨å¯¼æ—¶ï¼Œä¼šæ ¹æ®ä¼ å…¥çš„å‚æ•°ç±»å‹æ¥å†³å®šæœ€ç»ˆçš„å¼•ç”¨ç±»å‹ã€‚
å› ä¸ºåœ¨åˆå§‹åŒ– &lt;code>A&lt;/code> ç±»æ—¶ï¼Œ&lt;code>T&lt;/code> çš„ç±»å‹å·²ç»ç¡®å®šäº†ï¼Œæ‰€ä»¥ &lt;code>T&amp;amp;&amp;amp;&lt;/code> ä¸ä¼šå‘ç”Ÿå¼•ç”¨æŠ˜å ã€‚&lt;/p>
&lt;p>æ”¹è¿›&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">template&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;&lt;/span>&lt;span style="color:#ff79c6">typename&lt;/span> T&lt;span style="color:#ff79c6">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span>&lt;span style="color:#ff79c6">class&lt;/span> &lt;span style="color:#50fa7b">A&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span>&lt;span style="color:#ff79c6">public&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span> &lt;span style="color:#ff79c6">template&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;&lt;/span>&lt;span style="color:#ff79c6">typename&lt;/span> U&lt;span style="color:#ff79c6">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span> &lt;span style="color:#8be9fd">void&lt;/span> push(U&lt;span style="color:#ff79c6">&amp;amp;&amp;amp;&lt;/span> u)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span> data_.push_back(std&lt;span style="color:#ff79c6">::&lt;/span>forward&lt;span style="color:#ff79c6">&amp;lt;&lt;/span>U&lt;span style="color:#ff79c6">&amp;gt;&lt;/span>(u));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span>&lt;span style="color:#ff79c6">private&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span> std&lt;span style="color:#ff79c6">::&lt;/span>vector&lt;span style="color:#ff79c6">&amp;lt;&lt;/span>T&lt;span style="color:#ff79c6">&amp;gt;&lt;/span> data_;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span>};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span>&lt;span style="color:#8be9fd">int&lt;/span> &lt;span style="color:#50fa7b">main&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15&lt;/span>&lt;span> A&lt;span style="color:#ff79c6">&amp;lt;&lt;/span>&lt;span style="color:#8be9fd">int&lt;/span>&lt;span style="color:#ff79c6">&amp;gt;&lt;/span> a;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16&lt;/span>&lt;span> &lt;span style="color:#8be9fd">int&lt;/span> x &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#bd93f9">100&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17&lt;/span>&lt;span> a.push(x);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18&lt;/span>&lt;span> a.push(&lt;span style="color:#bd93f9">101&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™é‡Œçš„ &lt;code>U&amp;amp;&amp;amp;&lt;/code> æ˜¯ä¸€ä¸ªä¸‡èƒ½å¼•ç”¨ï¼Œå®ƒä¼šæ ¹æ®ä¼ å…¥çš„å‚æ•°ç±»å‹æ¥å†³å®šæœ€ç»ˆçš„å¼•ç”¨ç±»å‹ï¼Œæ‰€ä»¥å¯ä»¥æ­£ç¡®çš„æ¨å¯¼å‡ºå·¦å€¼å’Œå³å€¼ã€‚&lt;/p>
&lt;h2 id="æ€»ç»“">&lt;a href="#%e6%80%bb%e7%bb%93" class="header-anchor">&lt;/a>æ€»ç»“
&lt;/h2>&lt;p>C++ä¸­çš„å˜é‡å¯ä»¥åˆ†ä¸ºå·¦å€¼å’Œå³å€¼ï¼Œå³å€¼åˆå¯ä»¥åˆ†ä¸ºçº¯å³å€¼å’Œå°†äº¡å€¼ã€‚ä¸åŒç±»å‹çš„å˜é‡çš„ç”Ÿå‘½å‘¨æœŸä¸ä½œç”¨åŸŸä¹Ÿæ˜¯æœ‰å·®åˆ«çš„ã€‚&lt;/p>
&lt;p>ç®€å•è¯´æœ‰æ˜ç¡®å˜é‡åï¼Œå¯ä»¥å–åœ°å€ï¼Œå¯ä»¥ä¿®æ”¹çš„æ˜¯å·¦å€¼ï¼Œæ²¡æœ‰æ˜ç¡®å˜é‡åï¼Œä¸èƒ½å–åœ°å€ï¼Œä¸èƒ½ä¿®æ”¹çš„æ˜¯å³å€¼ã€‚&lt;/p>
&lt;p>å·¦å€¼å’Œå³å€¼é…åˆå¼•ç”¨ï¼Œå¯ä»¥æ›´å¥½çš„æ§åˆ¶å˜é‡çš„ç”Ÿå‘½å‘¨æœŸï¼ŒåŒæ—¶ä¹Ÿä¼šå¸¦æ¥ä¸€äº›ç‰¹æ®Šçš„æƒ…å†µï¼Œæ¯”å¦‚å¼•ç”¨æŠ˜å ã€‚&lt;/p>
&lt;ul>
&lt;li>å·¦å€¼å¼•ç”¨ï¼šå·¦å€¼å¼•ç”¨æ˜¯ä¸€ä¸ªåˆ«åï¼Œå®ƒæ˜¯ä¸€ä¸ªå·¦å€¼ï¼Œå¯ä»¥å–åœ°å€ï¼Œå¯ä»¥ä¿®æ”¹ã€‚ä½œä¸ºå‡½æ•°å‚æ•°æ—¶ï¼Œåªèƒ½ç»‘å®šå·¦å€¼ã€‚&lt;/li>
&lt;li>const å·¦å€¼å¼•ç”¨ï¼šå¯ä»¥ç»‘å®šåˆ°å³å€¼ï¼Œä½†æ˜¯ä¸èƒ½ä¿®æ”¹ã€‚&lt;/li>
&lt;li>å³å€¼å¼•ç”¨ï¼šå³å€¼å¼•ç”¨æ˜¯ä¸€ä¸ªæ–°çš„å¼•ç”¨ç±»å‹ï¼Œç”¨äºç»‘å®šåˆ°å³å€¼ã€‚ä½œä¸ºå‡½æ•°å‚æ•°æ—¶ï¼Œåªèƒ½ç»‘å®šå³å€¼ã€‚&lt;/li>
&lt;li>å¼•ç”¨æŠ˜å ï¼šå¼•ç”¨æŠ˜å æ˜¯C++11å¼•å…¥çš„æ–°ç‰¹æ€§ï¼Œç”¨äºç®€åŒ–å¼•ç”¨çš„ä½¿ç”¨ï¼Œä¸»è¦ç”¨äºæ¨¡æ¿çš„å‚æ•°æ¨å¯¼ã€‚åªæœ‰åœ¨å‘ç”Ÿç±»å‹æ¨å¯¼æ—¶æ‰ä¼šç”Ÿæ•ˆã€‚&lt;/li>
&lt;/ul>
&lt;p>å·¦å€¼å¼•ç”¨å’Œå³å€¼å¼•ç”¨ï¼Œåº”è¯¥è¦é…åˆ &lt;code>std::move&lt;/code> å’Œ &lt;code>std::forward&lt;/code> ä½¿ç”¨ï¼Œè¿™æ ·å¯ä»¥æ›´å¥½çš„æ§åˆ¶å˜é‡çš„ç”Ÿå‘½å‘¨æœŸã€‚
è¿™é‡Œå…ˆæŒ–ä¸€ä¸ªå‘ï¼Œåé¢æœ‰ç©ºå†æ¥èŠè¿™éƒ¨åˆ†å†…å®¹ã€‚&lt;/p></description></item><item><title>Goæ”¯æŒæ³›å‹å’Œæ’åºçš„listï¼Œå®ç°ä¸€ä¸ªæ”¯æŒæ³›å‹å’Œæ’åºåŠŸèƒ½çš„é“¾è¡¨ã€‚é€šè¿‡å½’å¹¶æ’åºç®—æ³•ä¸ºé“¾è¡¨æ·»åŠ æ’åºåŠŸèƒ½çš„å®ç°è¿‡ç¨‹ï¼Œå¯¹æ¯”æ’å…¥æ’åºçš„å®ç°æ–¹å¼</title><link>https://lqxhub.github.io/posts/db59b241/</link><pubDate>Sun, 12 Jan 2025 12:26:34 +0800</pubDate><guid>https://lqxhub.github.io/posts/db59b241/</guid><description>&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/def9654de08c79035495f70fa24c7a388b4cc883.jpg" alt="Featured image of post Goæ”¯æŒæ³›å‹å’Œæ’åºçš„listï¼Œå®ç°ä¸€ä¸ªæ”¯æŒæ³›å‹å’Œæ’åºåŠŸèƒ½çš„é“¾è¡¨ã€‚é€šè¿‡å½’å¹¶æ’åºç®—æ³•ä¸ºé“¾è¡¨æ·»åŠ æ’åºåŠŸèƒ½çš„å®ç°è¿‡ç¨‹ï¼Œå¯¹æ¯”æ’å…¥æ’åºçš„å®ç°æ–¹å¼" />&lt;p>goè‡ªå¸¦çš„é“¾è¡¨æ˜¯æ²¡æœ‰æ’åºåŠŸèƒ½çš„ï¼Œè€Œä¸”ä¹Ÿä¸æ”¯æŒæ³›å‹ã€‚ä¸æ”¯æŒæ³›å‹è¿˜å¥½è¯´ï¼Œä½¿ç”¨ &lt;code>interface{}&lt;/code> å°±èƒ½è§£å†³ã€‚ä½†æ˜¯å¾ˆå¤šæ—¶å€™è¿˜æ˜¯æœ‰å¯¹ &lt;code>list&lt;/code>
æ’åºçš„éœ€æ±‚ã€‚
ä¹‹å‰åœ¨å…¬å¸å†…éƒ¨ï¼Œæˆ‘å†™è¿‡ä¸€ä¸ª &lt;code>list&lt;/code> çš„æ’åºï¼Œå› ä¸ºlistå†…éƒ¨çš„å¾ˆå¤šæ•°æ®éƒ½æ˜¯ &lt;code>private&lt;/code> çš„ï¼Œæ‰€ä»¥æ²¡æ³•ä½¿ç”¨å½’å¹¶æ’åºï¼Œåªèƒ½ä½¿ç”¨ç±»æ’å…¥æ’åºã€‚
åœ¨æ•°æ®é‡ä¸å¤§çš„æƒ…å†µä¸‹ï¼Œè¿™ç§æ’åºæ˜¯å¯ä»¥æ¥å—çš„ã€‚ä½†æ˜¯å¦‚æœæ•°æ®é‡å¾ˆå¤§ï¼Œè¿™ç§æ’åºå°±ä¼šå¾ˆæ…¢ï¼Œæ‰€ä»¥è¿™æ¬¡æˆ‘ä½¿ç”¨å½’å¹¶æ’åºæ¥å®ç°æ’åºï¼Œå¹¶ä¸”ä½¿ç”¨æ³›å‹æ¥å®ç°ã€‚&lt;/p>
&lt;p>é“¾è¡¨çš„å½’å¹¶æ’åºï¼Œä¹‹å‰å†™è¿‡ä¸€æ¬¡ï¼Œè¿™æ¬¡å°±ä¸å†èµ˜è¿°äº†&lt;a class="link" href="https://lqxhub.github.io/posts/f8e89faa/" target="_blank" rel="noopener"
>å½’å¹¶æ’åº&lt;/a>&lt;/p>
&lt;p>å…³äº go çš„æ³›å‹ï¼Œä¹‹å‰ä¹Ÿå†™è¿‡ä¸€ç¯‡æ–‡ç« &lt;a class="link" href="https://lqxhub.github.io/posts/c86abacd/" target="_blank" rel="noopener"
>goæ³›å‹&lt;/a>&lt;/p>
&lt;p>è¿™æ¬¡å†™çš„ æ”¯æŒ &lt;strong>æ³›å‹&lt;/strong> å’Œ &lt;strong>æ’åº&lt;/strong> çš„ GitHub åœ°å€ï¼š&lt;a class="link" href="https://github.com/lqxhub/listplus" target="_blank" rel="noopener"
>listplus&lt;/a>&lt;/p>
&lt;p>è¿™æ¬¡ç®€å•è®²è§£ä¸€ä¸‹ go è‡ªå¸¦çš„ &lt;code>list&lt;/code> çš„ä¸€äº›æºç ã€‚&lt;/p>
&lt;h2 id="listæºç ">&lt;a href="#list%e6%ba%90%e7%a0%81" class="header-anchor">&lt;/a>listæºç 
&lt;/h2>&lt;p>&lt;code>list&lt;/code> æºç è¿˜æ˜¯å¾ˆç®€å•çš„ï¼Œå°±æ˜¯ä¸€ä¸ªåŒå‘é“¾è¡¨ï¼Œå°±æŒ‘å‡ ä¸ªå‡½æ•°å­¦ä¸€ä¸‹å§&lt;/p>
&lt;h3 id="element">&lt;a href="#element" class="header-anchor">&lt;/a>element
&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">type&lt;/span> Element &lt;span style="color:#8be9fd;font-style:italic">struct&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span> next, prev &lt;span style="color:#ff79c6">*&lt;/span>Element
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3&lt;/span>&lt;span> list &lt;span style="color:#ff79c6">*&lt;/span>List
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4&lt;/span>&lt;span> Value any
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä¸ºä»€ä¹ˆè¦å†™ &lt;code>Element&lt;/code> è¿™ä¸ªç»“æ„ä½“å‘¢ï¼Œæ˜¯å› ä¸ºè¿™é‡Œé¢å­˜äº† &lt;code>list&lt;/code> çš„æŒ‡é’ˆã€‚è¿™ä¸ªæŒ‡é’ˆä¸»è¦ç”¨æ¥åˆ¤æ–­è¦æ“ä½œçš„ &lt;code>element&lt;/code> æ˜¯å¦å±äºè¿™ä¸ª
&lt;code>list&lt;/code>ã€‚
ä¸€èˆ¬è‡ªå·±åœ¨å†™é“¾è¡¨çš„æ—¶å€™,å¾ˆå°‘è¿™æ ·å†™ã€‚å¤šäº†è¿™ä¸ªæŒ‡é’ˆï¼Œå¯ä»¥é¿å…å¾ˆå¤šé”™è¯¯ã€‚æ¯”å¦‚æŠŠ A é“¾è¡¨ä¸­çš„å…ƒç´ æ’å…¥åˆ° B é“¾è¡¨ä¸­ï¼Œè¿™æ ·å°±ä¼šå‡ºç°é—®é¢˜ã€‚&lt;/p>
&lt;p>å‰©ä¸‹çš„ &lt;code>next&lt;/code> å’Œ &lt;code>prev&lt;/code> å°±æ˜¯é“¾è¡¨çš„å‰åæŒ‡é’ˆäº†ï¼Œ&lt;code>Value&lt;/code> å°±æ˜¯å­˜æ”¾æ•°æ®çš„åœ°æ–¹ã€‚ &lt;code>any&lt;/code> åœ¨ go 1.18 ä¹‹åæ‰æœ‰çš„ï¼Œä¹‹å‰éƒ½æ˜¯ç”¨
&lt;code>interface{}&lt;/code> æ¥ä»£æ›¿ã€‚&lt;/p>
&lt;h3 id="list">&lt;a href="#list" class="header-anchor">&lt;/a>list
&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">type&lt;/span> List &lt;span style="color:#8be9fd;font-style:italic">struct&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span> root Element
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3&lt;/span>&lt;span> len &lt;span style="color:#8be9fd">int&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™ä¸ªç»“æ„å°±æ˜¯é“¾è¡¨çš„ç»“æ„äº†ï¼Œ&lt;code>root&lt;/code> æ˜¯ä¸€ä¸ª &lt;code>Element&lt;/code> ç»“æ„ä½“ï¼Œè¿™ä¸ª &lt;code>Element&lt;/code> ç»“æ„ä½“æ˜¯ä¸€ä¸ªå“¨å…µï¼Œä¸å­˜æ”¾æ•°æ®ï¼Œåªæ˜¯ç”¨æ¥æ ‡è®°é“¾è¡¨çš„å¤´å’Œå°¾ã€‚&lt;/p>
&lt;p>&lt;code>root&lt;/code> çš„ &lt;code>next&lt;/code> æŒ‡å‘é“¾è¡¨çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œ&lt;code>prev&lt;/code> æŒ‡å‘é“¾è¡¨çš„æœ€åä¸€ä¸ªå…ƒç´ ã€‚&lt;/p>
&lt;p>&lt;code>len&lt;/code> æ˜¯é“¾è¡¨çš„é•¿åº¦ã€‚&lt;/p>
&lt;h3 id="insert">&lt;a href="#insert" class="header-anchor">&lt;/a>insert
&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> (l &lt;span style="color:#ff79c6">*&lt;/span>List) &lt;span style="color:#50fa7b">insert&lt;/span>(e, at &lt;span style="color:#ff79c6">*&lt;/span>Element) &lt;span style="color:#ff79c6">*&lt;/span>Element {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span> e.prev = at
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3&lt;/span>&lt;span> e.next = at.next
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4&lt;/span>&lt;span> e.prev.next = e
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5&lt;/span>&lt;span> e.next.prev = e
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6&lt;/span>&lt;span> e.list = l
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7&lt;/span>&lt;span> l.len&lt;span style="color:#ff79c6">++&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> e
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">9&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>PushBack&lt;/code> å’Œ &lt;code>PushFront&lt;/code> éƒ½æ˜¯è°ƒç”¨è¿™ä¸ªå‡½æ•°æ¥æ’å…¥å…ƒç´ çš„ã€‚&lt;/p>
&lt;p>è¿™ä¸ªå‡½æ•°ä¹ŸæŒºç®€å•çš„ï¼Œå°±æ˜¯æŠŠ &lt;code>e&lt;/code> æ’å…¥åˆ° &lt;code>at&lt;/code> åé¢ã€‚é€»è¾‘ä¹Ÿå¾ˆç®€å•ï¼Œå°±æ˜¯è®¾ç½®ä¸€ä¸‹ &lt;code>e&lt;/code> å’Œ &lt;code>at&lt;/code> çš„æŒ‡é’ˆã€‚ç„¶åæŠŠæ–°æ’å…¥çš„å…ƒç´ çš„ &lt;code>list&lt;/code> æŒ‡é’ˆæŒ‡å‘è¿™ä¸ªé“¾è¡¨ï¼Œæœ€åé“¾è¡¨çš„é•¿åº¦åŠ ä¸€ã€‚
æœ€å return &lt;code>e&lt;/code>ï¼Œè¿™ä¸ª &lt;code>e&lt;/code> å°±æ˜¯æ–°æ’å…¥çš„å…ƒç´ ã€‚&lt;/p>
&lt;p>åœ¨ &lt;code>PushBack&lt;/code> ä¸­ï¼Œ&lt;code>at&lt;/code> å°±æ˜¯ &lt;code>root.prev&lt;/code>ï¼Œåœ¨ &lt;code>PushFront&lt;/code> ä¸­ï¼Œ&lt;code>at&lt;/code> å°±æ˜¯ &lt;code>root&lt;/code>ã€‚&lt;/p>
&lt;h3 id="remove">&lt;a href="#remove" class="header-anchor">&lt;/a>remove
&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> (l &lt;span style="color:#ff79c6">*&lt;/span>List) &lt;span style="color:#50fa7b">remove&lt;/span>(e &lt;span style="color:#ff79c6">*&lt;/span>Element) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span> e.prev.next = e.next
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3&lt;/span>&lt;span> e.next.prev = e.prev
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4&lt;/span>&lt;span> e.next = &lt;span style="color:#ff79c6">nil&lt;/span> &lt;span style="color:#6272a4">// avoid memory leaks
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> e.prev = &lt;span style="color:#ff79c6">nil&lt;/span> &lt;span style="color:#6272a4">// avoid memory leaks
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> e.list = &lt;span style="color:#ff79c6">nil&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7&lt;/span>&lt;span> l.len&lt;span style="color:#ff79c6">--&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>remove&lt;/code> å‡½æ•°å°±æ˜¯è°ƒç”¨è¿™ä¸ªå‡½æ•°æ¥åˆ é™¤å…ƒç´ çš„ã€‚é€»è¾‘ä¹Ÿå¾ˆç®€å•ï¼Œå°±æ˜¯æŠŠ &lt;code>e&lt;/code> ä»é“¾è¡¨ä¸­åˆ é™¤ã€‚åŒå‘é“¾è¡¨çš„åˆ é™¤ï¼Œå°±æ˜¯æŠŠ &lt;code>e&lt;/code> çš„å‰åæŒ‡é’ˆæŒ‡å‘å¯¹æ–¹ï¼Œç„¶åæŠŠ &lt;code>e&lt;/code> çš„ &lt;code>list&lt;/code> æŒ‡é’ˆç½®ç©ºï¼Œæœ€åé“¾è¡¨çš„é•¿åº¦å‡ä¸€ã€‚&lt;/p>
&lt;p>é“¾è¡¨ä¸­åˆ é™¤ä¸€ä¸ªå…ƒç´ ï¼Œé¦–å…ˆè¦æ‰¾åˆ°è¿™ä¸ªå…ƒç´ ï¼Œç„¶åè°ƒç”¨è¿™ä¸ªå‡½æ•°æ¥åˆ é™¤ã€‚è™½ç„¶é“¾è¡¨åˆ é™¤çš„æ—¶é—´å¤æ‚åº¦æ˜¯ O(1)ï¼Œä½†æ˜¯æ‰¾åˆ°è¿™ä¸ªå…ƒç´ çš„æ—¶é—´å¤æ‚åº¦æ˜¯ O(n)ã€‚&lt;/p>
&lt;h3 id="move">&lt;a href="#move" class="header-anchor">&lt;/a>move
&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> (l &lt;span style="color:#ff79c6">*&lt;/span>List) &lt;span style="color:#50fa7b">move&lt;/span>(e, at &lt;span style="color:#ff79c6">*&lt;/span>Element) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> e &lt;span style="color:#ff79c6">==&lt;/span> at {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span> e.prev.next = e.next
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span> e.next.prev = e.prev
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span> e.prev = at
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span> e.next = at.next
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span> e.prev.next = e
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span> e.next.prev = e
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>move&lt;/code> å‡½æ•°å°±æ˜¯è°ƒç”¨è¿™ä¸ªå‡½æ•°æ¥ç§»åŠ¨å…ƒç´ çš„ã€‚é€»è¾‘ä¹Ÿå¾ˆç®€å•ï¼Œå°±æ˜¯æŠŠ &lt;code>e&lt;/code> ç§»åŠ¨åˆ° &lt;code>at&lt;/code> åé¢ã€‚å…ˆæŠŠ &lt;code>e&lt;/code> ä»é“¾è¡¨ä¸­ â€˜åˆ é™¤â€™ï¼Œç„¶åæŠŠ &lt;code>e&lt;/code> æ’å…¥åˆ° &lt;code>at&lt;/code> åé¢ã€‚
æ‰€è°“çš„åˆ é™¤å°±æ˜¯ &lt;code>e&lt;/code> çš„å‰åæŒ‡é’ˆæŒ‡å‘å¯¹æ–¹ã€‚&lt;/p>
&lt;p>go çš„ &lt;code>list&lt;/code> ä¸­è¿˜æœ‰å¾ˆå¤šå‡½æ•°ï¼Œè¿™é‡Œå°±ä¸ä¸€ä¸€åˆ—ä¸¾äº†ï¼Œä½†æ˜¯å¯¹é“¾è¡¨çš„æ ¸å¿ƒæ“ä½œå°±æ˜¯è¿™å‡ ä¸ªå‡½æ•°ã€‚&lt;/p>
&lt;h2 id="listplus">&lt;a href="#listplus" class="header-anchor">&lt;/a>listplus
&lt;/h2>&lt;p>ä¸‹é¢æ˜¯æˆ‘ä¿®æ”¹åçš„ &lt;code>list&lt;/code> çš„éƒ¨åˆ†ä»£ç ï¼Œæ•´ä½“é€»è¾‘æ²¡æ”¹ï¼Œå°±æ˜¯åŠ äº†æ³›å‹æ”¯æŒï¼Œç„¶åå†åŠ äº†æ’åºåŠŸèƒ½ã€‚
å°±åªåˆ—ä¸¾ä¸€ä¸‹ &lt;code>sort&lt;/code> å‡½æ•°å§&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> (l &lt;span style="color:#ff79c6">*&lt;/span>List[T]) &lt;span style="color:#50fa7b">Sort&lt;/span>(compare &lt;span style="color:#8be9fd;font-style:italic">func&lt;/span>(front, back T) &lt;span style="color:#8be9fd">bool&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> l.len &amp;lt; &lt;span style="color:#bd93f9">2&lt;/span> {&lt;span style="color:#6272a4">//å¦‚æœé“¾è¡¨é•¿åº¦æ˜¯0æˆ–è€…1ï¼Œç›´æ¥è¿”å›
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">return&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span> head &lt;span style="color:#ff79c6">:=&lt;/span> l.&lt;span style="color:#50fa7b">Front&lt;/span>()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span> tail &lt;span style="color:#ff79c6">:=&lt;/span> l.&lt;span style="color:#50fa7b">Back&lt;/span>()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span> tail.next = &lt;span style="color:#ff79c6">nil&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span> &lt;span style="color:#6272a4">//å–å‡ºé“¾è¡¨çš„å¤´å’Œå°¾ï¼Œç„¶åè°ƒç”¨å½’å¹¶æ’åº
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> head, tail = l.&lt;span style="color:#50fa7b">mergeSort&lt;/span>(head, compare)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span> &lt;span style="color:#6272a4">//è¿™é‡Œæ˜¯æŠŠæ’åºåçš„é“¾è¡¨é‡æ–°è¿æ¥èµ·æ¥
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> l.root.next = head
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span> l.root.prev = tail
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span> head.prev = &lt;span style="color:#ff79c6">&amp;amp;&lt;/span>l.root
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span> tail.next = &lt;span style="color:#ff79c6">&amp;amp;&lt;/span>l.root
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> (l &lt;span style="color:#ff79c6">*&lt;/span>List[T]) &lt;span style="color:#50fa7b">mergeSort&lt;/span>(head &lt;span style="color:#ff79c6">*&lt;/span>Element[T], compare &lt;span style="color:#8be9fd;font-style:italic">func&lt;/span>(front, back T) &lt;span style="color:#8be9fd">bool&lt;/span>) (&lt;span style="color:#ff79c6">*&lt;/span>Element[T], &lt;span style="color:#ff79c6">*&lt;/span>Element[T]) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> head &lt;span style="color:#ff79c6">==&lt;/span> &lt;span style="color:#ff79c6">nil&lt;/span> &lt;span style="color:#ff79c6">||&lt;/span> head.next &lt;span style="color:#ff79c6">==&lt;/span> &lt;span style="color:#ff79c6">nil&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> head, head
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21&lt;/span>&lt;span> slow, fast &lt;span style="color:#ff79c6">:=&lt;/span> head, head
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22&lt;/span>&lt;span> &lt;span style="color:#6272a4">//ä½¿ç”¨å¿«æ…¢æŒ‡é’ˆæ‰¾åˆ°é“¾è¡¨çš„ä¸­é—´èŠ‚ç‚¹
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">for&lt;/span> fast.next &lt;span style="color:#ff79c6">!=&lt;/span> &lt;span style="color:#ff79c6">nil&lt;/span> &lt;span style="color:#ff79c6">&amp;amp;&amp;amp;&lt;/span> fast.next.next &lt;span style="color:#ff79c6">!=&lt;/span> &lt;span style="color:#ff79c6">nil&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24&lt;/span>&lt;span> slow = slow.next
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25&lt;/span>&lt;span> fast = fast.next.next
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27&lt;/span>&lt;span> mid &lt;span style="color:#ff79c6">:=&lt;/span> slow.next
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28&lt;/span>&lt;span> slow.next = &lt;span style="color:#ff79c6">nil&lt;/span>&lt;span style="color:#6272a4">//æˆªæ–­é“¾è¡¨,å› ä¸ºä¸‹é¢çš„æ“ä½œåªä¼šç”¨ nextæŒ‡é’ˆ,æ‰€ä»¥ä¸ç”¨æˆªæ–­ prevæŒ‡é’ˆ
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30&lt;/span>&lt;span> h1, t1 &lt;span style="color:#ff79c6">:=&lt;/span> l.&lt;span style="color:#50fa7b">mergeSort&lt;/span>(head, compare)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31&lt;/span>&lt;span> h2, t2 &lt;span style="color:#ff79c6">:=&lt;/span> l.&lt;span style="color:#50fa7b">mergeSort&lt;/span>(mid, compare)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> l.&lt;span style="color:#50fa7b">merge&lt;/span>(h1, t1, h2, t2, compare)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> (l &lt;span style="color:#ff79c6">*&lt;/span>List[T]) &lt;span style="color:#50fa7b">merge&lt;/span>(h1, t1, h2, t2 &lt;span style="color:#ff79c6">*&lt;/span>Element[T], compare &lt;span style="color:#8be9fd;font-style:italic">func&lt;/span>(front, back T) &lt;span style="color:#8be9fd">bool&lt;/span>) (&lt;span style="color:#ff79c6">*&lt;/span>Element[T], &lt;span style="color:#ff79c6">*&lt;/span>Element[T]) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36&lt;/span>&lt;span> &lt;span style="color:#6272a4">//åˆå¹¶ä¸¤ä¸ªé“¾è¡¨,ç„¶åè¿”å›åˆå¹¶åçš„å¤´å’Œå°¾
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#6272a4">//å’Œå•å‘é“¾è¡¨çš„åˆå¹¶ä¸åŒçš„æ˜¯,è¿™é‡Œéœ€è¦ç»´æŠ¤ prevæŒ‡é’ˆ
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> cur &lt;span style="color:#ff79c6">:=&lt;/span> &lt;span style="color:#ff79c6">&amp;amp;&lt;/span>l.root
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39&lt;/span>&lt;span> &lt;span style="color:#ff79c6">for&lt;/span> h1 &lt;span style="color:#ff79c6">!=&lt;/span> &lt;span style="color:#ff79c6">nil&lt;/span> &lt;span style="color:#ff79c6">&amp;amp;&amp;amp;&lt;/span> h2 &lt;span style="color:#ff79c6">!=&lt;/span> &lt;span style="color:#ff79c6">nil&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> &lt;span style="color:#50fa7b">compare&lt;/span>(h1.Value, h2.Value) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41&lt;/span>&lt;span> cur.next = h1
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42&lt;/span>&lt;span> h1.prev = cur
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43&lt;/span>&lt;span> h1 = h1.next
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44&lt;/span>&lt;span> } &lt;span style="color:#ff79c6">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45&lt;/span>&lt;span> cur.next = h2
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46&lt;/span>&lt;span> h2.prev = cur
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47&lt;/span>&lt;span> h2 = h2.next
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49&lt;/span>&lt;span> cur = cur.next
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">51&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> h1 &lt;span style="color:#ff79c6">!=&lt;/span> &lt;span style="color:#ff79c6">nil&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">52&lt;/span>&lt;span> cur.next = h1
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">53&lt;/span>&lt;span> h1.prev = cur
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">54&lt;/span>&lt;span> cur = t1
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">55&lt;/span>&lt;span> } &lt;span style="color:#ff79c6">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">56&lt;/span>&lt;span> cur.next = h2
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">57&lt;/span>&lt;span> h2.prev = cur
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">58&lt;/span>&lt;span> cur = t2
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">59&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">60&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> l.root.next, cur
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">61&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æ•´ä½“å’Œä»¥å‰å†™çš„é“¾è¡¨æ’åºå·®ä¸å¤šï¼Œä¸åŒçš„åœ°æ–¹æ˜¯è¿™æ¬¡æ˜¯åŒå‘é“¾è¡¨ï¼Œæ‰€ä»¥éœ€è¦ç»´æŠ¤ &lt;code>prev&lt;/code> æŒ‡é’ˆã€‚&lt;/p>
&lt;p>ä¸€å¼€å§‹æˆ‘æ˜¯æ²¡æœ‰ç»´æŠ¤ &lt;code>prev&lt;/code> æŒ‡é’ˆçš„ï¼Œå®Œå…¨æŒ‰ç…§å•å‘é“¾è¡¨çš„æ€è·¯æ¥ &lt;code>merge&lt;/code>ï¼Œåªæ˜¯åœ¨ &lt;code>merge&lt;/code> å®Œä¸€ä¸ªé“¾è¡¨åï¼Œéœ€è¦ç»§ç»­merge å¦ä¸€ä¸ªé“¾è¡¨ï¼Œé‡æ–°ç»„ç»‡é“¾è¡¨çš„ç»“æ„ã€‚&lt;/p>
&lt;p>mergeå‡½æ•°ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> (l &lt;span style="color:#ff79c6">*&lt;/span>List) &lt;span style="color:#50fa7b">merge&lt;/span>(l1, l2 &lt;span style="color:#ff79c6">*&lt;/span>Element, compare &lt;span style="color:#8be9fd;font-style:italic">func&lt;/span>(v1, v2 any) &lt;span style="color:#8be9fd">bool&lt;/span>) &lt;span style="color:#ff79c6">*&lt;/span>Element {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span> cur &lt;span style="color:#ff79c6">:=&lt;/span> &lt;span style="color:#ff79c6">&amp;amp;&lt;/span>l.root
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span> &lt;span style="color:#ff79c6">for&lt;/span> l1 &lt;span style="color:#ff79c6">!=&lt;/span> &lt;span style="color:#ff79c6">nil&lt;/span> &lt;span style="color:#ff79c6">&amp;amp;&amp;amp;&lt;/span> l2 &lt;span style="color:#ff79c6">!=&lt;/span> &lt;span style="color:#ff79c6">nil&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> &lt;span style="color:#50fa7b">compare&lt;/span>(l1.Value, l2.Value) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span> cur.next = l1
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span> l1.prev = cur
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span> l1 = l1.next
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span> } &lt;span style="color:#ff79c6">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span> cur.next = l2
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span> l2.prev = cur
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span> l2 = l2.next
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span> cur = cur.next
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> l1 &lt;span style="color:#ff79c6">!=&lt;/span> &lt;span style="color:#ff79c6">nil&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16&lt;/span>&lt;span> cur.next = l1
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17&lt;/span>&lt;span> l1.prev = cur
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18&lt;/span>&lt;span> } &lt;span style="color:#ff79c6">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19&lt;/span>&lt;span> cur.next = l2
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20&lt;/span>&lt;span> l2.prev = cur
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22&lt;/span>&lt;span> &lt;span style="color:#ff79c6">for&lt;/span> cur.next &lt;span style="color:#ff79c6">!=&lt;/span> &lt;span style="color:#ff79c6">nil&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23&lt;/span>&lt;span> cur.next.prev = cur
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24&lt;/span>&lt;span> cur = cur.next
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26&lt;/span>&lt;span> l.root.prev = cur
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> l.root.next
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å‰åŠéƒ¨åˆ†å’Œè¿™æ¬¡çš„ &lt;code>merge&lt;/code> å‡½æ•°å·®ä¸å¤šï¼Œåé¢å¤šäº†ä¸€ä¸ªå¾ªç¯ï¼Œæ˜¯ä¸ºäº†ç»´æŠ¤ &lt;code>prev&lt;/code> æŒ‡é’ˆã€‚&lt;/p>
&lt;p>åæ¥è€ƒè™‘åˆ°è¿™éƒ¨åˆ†æ˜¯å¯ä»¥ä¼˜åŒ–çš„ï¼Œæ¯æ¬¡mergeçš„æ—¶å€™ï¼Œä¼ é€’æ¯ä¸ªé“¾è¡¨çš„ &lt;code>head&lt;/code> å’Œ &lt;code>tail&lt;/code>ï¼Œè¿™æ ·å°±ä¸ç”¨åœ¨mergeå®Œä¸€ä¸ªé“¾è¡¨åï¼Œç»§ç»­merge å¦ä¸€ä¸ªé“¾è¡¨äº†ã€‚&lt;/p>
&lt;p>è¿™æ ·å°±å¯ä»¥ç›´æ¥è¿”å› &lt;code>head&lt;/code> å’Œ &lt;code>tail&lt;/code>ï¼Œç„¶ååœ¨ &lt;code>Sort&lt;/code> å‡½æ•°ä¸­é‡æ–°è¿æ¥é“¾è¡¨ã€‚&lt;/p>
&lt;p>æ•´ä½“è¿˜æ˜¯æ¯”è¾ƒç®€å•çš„ï¼Œå°±æ˜¯ä¸çŸ¥çš„ä¸ºä»€ä¹ˆ go çš„ &lt;code>list&lt;/code> æ²¡æœ‰æ’åºåŠŸèƒ½ï¼Œè¿™ä¸ªåŠŸèƒ½è¿˜æ˜¯å¾ˆå¸¸ç”¨çš„ã€‚æ³›å‹éƒ½å‡ºäº†è¿™ä¹ˆå¤šå¹´äº†ï¼Œgo çš„ &lt;code>list&lt;/code> è¿˜æ˜¯æ²¡æœ‰æ³›å‹ã€‚&lt;/p>
&lt;h2 id="æ€§èƒ½">&lt;a href="#%e6%80%a7%e8%83%bd" class="header-anchor">&lt;/a>æ€§èƒ½
&lt;/h2>&lt;p>å½’å¹¶æ’åºçš„æ—¶é—´å¤æ‚åº¦æ˜¯ O(nlogn)ï¼Œæ¯”ä¹‹å‰å†™çš„æ’å…¥æ’åºè¦å¿«å¾ˆå¤šã€‚ä½†æ˜¯ å½’å¹¶æ’åºæ˜¯åŸºäºé€’å½’çš„ï¼Œéœ€è¦é¢å¤–çš„ç©ºé—´çš„ï¼Œç©ºé—´å¤æ‚åº¦æ˜¯ O(n)ã€‚&lt;/p>
&lt;p>åœ¨æ•°æ®é‡å¾ˆå¤§çš„æ—¶å€™ï¼Œè¿™ä¸ªç©ºé—´å¤æ‚åº¦æ˜¯å¾ˆå¤§çš„ï¼Œæ‰€ä»¥åœ¨æ•°æ®é‡å¾ˆå¤§çš„æ—¶å€™ï¼Œè¿˜æ˜¯è¦è€ƒè™‘ä¸€ä¸‹ã€‚&lt;/p>
&lt;p>åŸæ¥æƒ³å€Ÿé‰´ä¸€ä¸‹ go çš„ &lt;code>sort&lt;/code> åŒ…ï¼Œä½†æ˜¯å‘ç° go çš„ &lt;code>sort&lt;/code> ä¸­çš„ä¸€äº›æ€æƒ³ï¼Œæ¯”å¦‚ å½“æ•°æ®é‡å°äº 12 çš„æ—¶å€™ï¼Œä½¿ç”¨æ’å…¥æ’åºï¼Œä½†æ˜¯é“¾è¡¨çš„é•¿åº¦ç»Ÿè®¡ä¸åƒåˆ‡ç‰‡é‚£ä¹ˆæ–¹ä¾¿ï¼Œæ‰€ä»¥å°±æ²¡æœ‰å®ç°ã€‚&lt;/p>
&lt;p>è¿˜æœ‰å°±æ˜¯åœ¨é€’å½’å±‚æ•°è¾¾åˆ°ä¸€å®šå€¼çš„æ—¶å€™ï¼Œä½¿ç”¨åˆ«çš„æ’åºç®—æ³•ï¼Œé˜²æ­¢æ ˆæº¢å‡ºã€‚ä½†æ˜¯è®¡ç®—äº†ä¸€ä¸‹&lt;/p>
&lt;p>$ {log}_{2}1000000 = 19.931568569324174 $&lt;/p>
&lt;p>é“¾è¡¨çš„é•¿åº¦è¾¾åˆ° 1000000 çš„æ—¶å€™ï¼Œé€’å½’å±‚æ•°ä¹Ÿå°± 20 å±‚ï¼Œè¿™ä¸ªå±‚æ•°æ˜¯å¯ä»¥æ¥å—çš„ã€‚&lt;/p>
&lt;h2 id="æ€»ç»“">&lt;a href="#%e6%80%bb%e7%bb%93" class="header-anchor">&lt;/a>æ€»ç»“
&lt;/h2>&lt;p>è¿™æ¬¡å®ç°äº†ä¸€ä¸ªæ”¯æŒæ³›å‹å’Œæ’åºçš„é“¾è¡¨ï¼Œä¸»è¦æ˜¯ä¸ºäº†å­¦ä¹  go çš„æ³›å‹å’Œé“¾è¡¨çš„ä¸€äº›æ“ä½œã€‚é“¾è¡¨çš„æ’åºè¿˜æ˜¯æ¯”è¾ƒç®€å•çš„ï¼Œä½†æ˜¯é“¾è¡¨çš„æ’åºè¿˜æ˜¯æ¯”è¾ƒå°‘è§çš„ï¼Œä¸€èˆ¬éƒ½æ˜¯ä½¿ç”¨åˆ‡ç‰‡æ¥æ’åºã€‚
æ–‡ä¸­å¦‚æœæœ‰é”™è¯¯çš„åœ°æ–¹ï¼Œè¿˜è¯·æŒ‡æ­£ã€‚å¦‚æœå¯¹ go çš„æ³›å‹å’Œé“¾è¡¨æœ‰æ›´å¥½çš„æƒ³æ³•ï¼Œæ¬¢è¿åœ¨ &lt;a class="link" href="https://github.com/lqxhub/listplus" target="_blank" rel="noopener"
>GitHub&lt;/a> ä¸Šæå‡ºã€‚&lt;/p></description></item><item><title>æˆ‘çš„2024</title><link>https://lqxhub.github.io/posts/0893a8b9/</link><pubDate>Tue, 31 Dec 2024 18:25:29 +0800</pubDate><guid>https://lqxhub.github.io/posts/0893a8b9/</guid><description>&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/83e38256ec22b91652d36e1d8b6f5397a55d5dbc.jpg" alt="Featured image of post æˆ‘çš„2024" />&lt;p>æ—¶é—´çœŸçš„æ˜¯å¦‚ç™½é©¹è¿‡éš™ï¼Œä¸Šæ¬¡å†™2023å¹´çš„æ€»ç»“å·²ç»æ˜¯ä¸€å¹´å‰çš„äº‹æƒ…äº†ï¼Œä½†æ˜¯æ€»æ„Ÿè§‰å¥½åƒå°±æ˜¯å‰å‡ å¤©çš„äº‹æƒ…ï¼Œä¹Ÿåœ¨åœ¨è¿™ä¸ªæˆ¿é—´é‡Œï¼Œä¹Ÿæ˜¯è¿™å°ç”µè„‘ã€‚ä¸€åˆ‡éƒ½å¥½åƒæ²¡æœ‰å˜è¿‡ï¼Œä½†æ˜¯æ—¶é—´å´åœ¨ä¸åœçš„æµé€ã€‚
2024è¿™ä¸€å¹´ï¼Œå’‹è¯´å‘¢ï¼Œæƒ³ä¸åˆ°ä¸€ä¸ªè¯æ¥å½¢å®¹ã€‚åŸæ¥ä¸æƒ³å†™äº†ï¼Œå¯æ˜¯ä»¥å‰ç«‹äº†ä¸ªflagï¼Œæ¯å¹´éƒ½å†™ï¼Œå°±è¿˜æ˜¯å†™ä¸€ä¸‹å§ã€‚&lt;/p>
&lt;p>è€ä¼ ç»Ÿ è¿˜æ˜¯ä» &lt;strong>ç”Ÿæ´»&lt;/strong> ä¸ &lt;strong>å·¥ä½œ&lt;/strong> ä¸¤æ–¹é¢æ¥å†™å§&lt;/p>
&lt;h2 id="ç”Ÿæ´»">&lt;a href="#%e7%94%9f%e6%b4%bb" class="header-anchor">&lt;/a>ç”Ÿæ´»
&lt;/h2>&lt;p>è¿™ä¸€å¹´æœ€å¤§çš„å˜åŒ–å°±æ˜¯å¼€å§‹éª‘è½¦äº†ï¼Œè™½ç„¶ä¸æ˜¯æ¯å¤©éª‘ï¼Œä½†æ˜¯ä¹Ÿç®—æ˜¯å…»æˆäº†ä¸€ä¸ªä¹ æƒ¯ã€‚é€šè¿‡éª‘è½¦ï¼Œä¸€å¹´ç˜¦äº†å·®ä¸å¤š10å…¬æ–¤ï¼Œè¿˜çœ‹åˆ°äº†ä¸€äº›ä»¥å‰æ²¡æœ‰çœ‹è¿‡çš„é£æ™¯ã€‚ä¹Ÿè®¤è¯†äº†å¾ˆå¤šæ–°çš„æœ‹å‹ï¼Œä¹Ÿæœ‰äº†ä¸€äº›æ–°çš„ç»å†ã€‚
ç°åœ¨å·²ç»å–œæ¬¢ä¸Šéª‘è½¦äº†ï¼Œæ¯å‘¨ä¸éª‘è½¦éƒ½ä¼šè§‰å¾—å°‘äº†ç‚¹ä»€ä¹ˆï¼Œéª‘è½¦åæ¸¸æˆä¹Ÿæˆ’äº†ï¼ŒåŸºæœ¬ä¸ç©äº†ï¼Œä»¥å‰å‘¨æœ«æ²¡äº‹å–œæ¬¢æ‡’åœ¨å®¶é‡Œï¼Œç°åœ¨å‘¨æœ«éƒ½ä¼šå‡ºå»éª‘è½¦ï¼Œæ„Ÿè§‰ç”Ÿæ´»å˜å¾—å……å®äº†å¾ˆå¤šã€‚&lt;/p>
&lt;p>éª‘è½¦åè®¤è¯†äº†å¾ˆå¤šæ–°çš„æœ‹å‹
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/794f8455190c2dd452a479bb70600a8f7e5a40c5.jpg">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/794f8455190c2dd452a479bb70600a8f7e5a40c5.jpg" alt="" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>ä»Šå¹´è¿˜å»å¤ªæ¹–ä¸œè¥¿å±±éª‘äº†ä¸€æ¬¡ï¼Œä¹Ÿæ˜¯ç¬¬ä¸€æ¬¡å»ï¼Œæ„Ÿè§‰è¿˜æ˜¯ä¸é”™çš„ï¼Œé£æ™¯ä¹Ÿå¾ˆç¾ï¼Œä¹Ÿæ˜¯ä¸€æ¬¡å¾ˆå¥½çš„ç»å†ã€‚åŸæ¥è®¡åˆ’ä¸­ç§‹æ”¾å‡å»ç¯å¤ªæ¹–ï¼Œå› ä¸ºæ¥å°é£äº†ï¼Œå°±å–æ¶ˆäº†ï¼Œæ˜å¹´ä¸€å®šè¦å»ã€‚
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/6fb1f90c0bf671d310f3df0b37ecc19055e67ed3.jpg">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/6fb1f90c0bf671d310f3df0b37ecc19055e67ed3.jpg" alt="" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>ä»Šå¹´çš„éª‘è¡Œæ•°æ®ï¼Œæ˜å¹´ç»§ç»­åŠªåŠ›
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3d32ba09465ffd3af887b327cdc4ab1e9764a458.jpg">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3d32ba09465ffd3af887b327cdc4ab1e9764a458.jpg" alt="" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>å»å¹´å†™æ€»ç»“æ—¶è®¡åˆ’å»ç©çš„åœ°æ–¹ï¼Œä»Šå¹´ä¸€ä¸ªæ²¡å»ï¼ŒåŸºæœ¬éƒ½æ˜¯æ—¶é—´ä¸å¤Ÿã€‚ä»Šå¹´åŸºæœ¬éƒ½æ˜¯åœ¨é™„è¿‘çš„åœ°æ–¹ï¼Œå—äº¬å»äº†å¥½å‡ æ¬¡ï¼Œæ˜¥å¤©å’ŒåŒå­¦å»çœ‹äº†ä¸€æ¬¡æ¨±èŠ±ã€‚ç¡®å®å¾ˆç¾ï¼Œä½†æ˜¯äººä¹Ÿå¾ˆå¤šã€‚
å’ŒåŒå­¦è¾¹èµ°è¾¹èŠï¼Œæ„Ÿè§‰å¾ˆå¥½ã€‚
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/8d47a191d602dc756219234cf275843470ce3d29.jpg">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/8d47a191d602dc756219234cf275843470ce3d29.jpg" alt="" />
&lt;/a>
&lt;/div>
æœ€ç¥å¥‡çš„æ˜¯ï¼Œè¿™æ¬¡å»å—äº¬ï¼Œæ‰¾åƒçš„æ—¶å€™ï¼Œåˆå»äº†å¤§å­¦æ—¶å’Œå¦ä¸€ä¸ªåŒå­¦å»è¿‡çš„ä¸€å®¶é¤å…ã€‚ç¬¬ä¸€æ¬¡å»åº”è¯¥æ˜¯2016å¹´ï¼Œé‚£æ—¶å€™æ˜¯å»å—äº¬å‚åŠ æ¯”èµ›ï¼Œå’Œä¸€ä¸ªå¤§å­¦å®¤å‹ï¼Œä¿©äººéƒ½æ˜¯ç¬¬ä¸€å»å—äº¬ã€‚
é‚£æ—¶å€™è¿˜æœ‰æ²¡æœ‰å°çº¢ä¹¦è¿™æ ·çš„è½¯ä»¶ï¼Œä¿©äººå°±ç½‘ä¸Šéšä¾¿æœï¼Œçé€›ï¼Œæ‰¾åˆ°äº†ç‹®å­æ¡¥é‚£é‡Œï¼Œçœ‹åˆ°é‚£å®¶é¤å…ï¼Œå°±è¿›å»åƒäº†ã€‚é‚£æ—¶å€™æ²¡è§‰å¾—æœ‰å¤šç¾å¥½åƒã€‚æ²¡æƒ³åˆ°è¿™ä¸¤å¹´é‚£é‡Œæˆç«‹ç½‘çº¢æ‰“å¡åœ°äº†ï¼Œäººä¹Ÿè¶…çº§å¤šã€‚
ä¹°ä¸ªé¥­éƒ½è¦æ’å¥½ä¹…ã€‚è¿™æ¬¡æˆ‘å»è·¯è¿‡é‚£å®¶é¤å…ï¼Œçœ‹ç€æ‹›ç‰Œå¾ˆçœ¼ç†Ÿï¼Œå°±æ‹ä¸‹æ¥å‘ç»™é‚£ä¸ªåŒå­¦ï¼Œé—®ä»–è¿™æ˜¯ä¸æ˜¯å’±ä¿©ä¹‹å‰å»åƒè¿‡çš„é‚£å®¶é¤å…ï¼Œä»–è¯´æ˜¯ã€‚æ„Ÿè§‰å¾ˆç¥å¥‡ï¼Œè¿™ä¹ˆå¤šå¹´äº†ï¼Œåˆæ¥åˆ°äº†è¿™é‡Œã€‚&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/285034633ffb11a40677d2c0275ad8d4d77be949.jpg">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/285034633ffb11a40677d2c0275ad8d4d77be949.jpg" alt="" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>è¿™æ¬¡å»å—äº¬è¿˜ä¸€ä»¶æœ‰æ„æ€çš„äº‹ã€‚ä¸¤ä¸ªäººåƒå®Œé¥­å»ä¸­å±±é™µçš„è·¯ä¸Šï¼Œæˆ‘åŒå­¦æƒ³å»å•æ‰€äº†ï¼Œæˆ‘ä¸€çœ‹å¿«åˆ°æ–°è¡—å£äº†ï¼Œäºæ˜¯å°±å»å¾·åŸºå¹¿åœºé‚£å§ï¼Œåˆ«çš„åœ°æ–¹ä¹Ÿä¸å¥½æ‰¾ã€‚å¥½å®¶ä¼™ï¼Œç¬¬ä¸€æ¬¡è§è¯†åˆ°äº†å•æ‰€ä¹Ÿæˆäº†ç½‘çº¢æ‰“å¡åœ°ã€‚&lt;/p>
&lt;p>è¿˜ä¸€æ¬¡å»å—äº¬æ˜¯ä¸­ç§‹æ”¾å‡ï¼ŒåŸæ¥è®¡åˆ’å»ç¯å¤ªæ¹–ï¼Œå› ä¸ºæ¥å°é£äº†ï¼Œå°±å–æ¶ˆäº†ã€‚æ­£å¥½æœ‰ä¸ªé«˜ä¸­åŒå­¦åœ¨å—äº¬å‡ºå·®ï¼Œè¿˜ä¸€ä¸ªåŒå­¦åœ¨æ­å·ï¼Œä¹Ÿæ˜¯é—²ç€æ²¡äº‹ï¼Œäºæ˜¯ä¸‰äººç›¸çº¦åœ¨å—äº¬è§é¢ã€‚æ²¡æƒ³åˆ°å»å—äº¬ç©çš„äººå¾ˆå¤šï¼Œæƒ³å»ç©çš„åœ°æ–¹éƒ½æ²¡é¢„çº¦åˆ°ã€‚
è™½ç„¶ç©æ²¡ç©æˆï¼Œä½†æ˜¯åƒçš„è¿˜æ˜¯åƒäº†ä¸å°‘ï¼Œå—äº¬çš„ç¾é£Ÿè¿˜æ˜¯å¾ˆå¤šçš„ã€‚&lt;/p>
&lt;p>6æœˆä»½è¿˜å»äº†ä¸€æ¬¡æµå—ï¼Œè§åˆ°äº†å¦ä¸€ä¸ªå¤§å­¦åŒå­¦ï¼Œä¹Ÿæ˜¯å¾ˆä¹…æ²¡è§äº†ã€‚è¿™æ¬¡å»æµå—ä¸€å¼€å§‹æ˜¯æ‰¾ä¸€ä¸ªå°å­¦åˆä¸­çš„åŒå­¦ï¼Œè™½ç„¶è€å®¶è·ç¦»ä¸è¿œï¼Œä½†æ˜¯ä¸€å¹´åŸºæœ¬ä¹Ÿå°±è¿‡å¹´çš„æ—¶å€™èƒ½è§ä¸€æ¬¡ã€‚
è™½ç„¶æˆ‘æ˜¯å±±ä¸œäººï¼Œä½†æ˜¯æµå—æ²¡æ€ä¹ˆå»ç©è¿‡ï¼Œä»¥å‰å»åŸºæœ¬éƒ½æ˜¯æœ‰äº‹ï¼Œè¿™æ¬¡å»æµå—ï¼Œæ„Ÿè§‰è¿˜æ˜¯ä¸é”™çš„ï¼Œæµå—çš„æ³‰æ°´è¿˜æ˜¯å¾ˆæœ‰åçš„ï¼Œè¿˜æœ‰å¾ˆå¤šå¥½åƒçš„ã€‚
åæ¥åˆæƒ³èµ·äº†ï¼Œå¦ä¸€ä¸ªå¤§å­¦åŒå­¦ä¹Ÿåœ¨æµå—ï¼Œäºæ˜¯å°±åˆçº¦äº†ä¸€æ¬¡ã€‚&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/2c56968b35faabaee8ee4f7884c70978d07646fc.jpg">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/2c56968b35faabaee8ee4f7884c70978d07646fc.jpg" alt="" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>è¿™æ¬¡å»æµå—ï¼Œé¡ºè·¯åˆå»çˆ¬äº†ä¸€æ¬¡æ³°å±±ã€‚å¤œçˆ¬æ³°å±±çš„æ„Ÿè§‰è¿˜æ˜¯å¾ˆä¸é”™çš„ï¼Œè™½ç„¶å¾ˆç´¯ï¼Œä½†æ˜¯çœ‹åˆ°æ—¥å‡ºçš„é‚£ä¸€åˆ»ï¼Œæ„Ÿè§‰æ‰€æœ‰çš„è¾›è‹¦éƒ½æ˜¯å€¼å¾—çš„ã€‚&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3d5b6e5c6590cf3da6c3f0972f86cc201fa81c37.jpg">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3d5b6e5c6590cf3da6c3f0972f86cc201fa81c37.jpg" alt="" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>è¿™æ¬¡çˆ¬æ³°å±±ï¼Œä¹‹å‰éª‘è½¦çš„å¥½å¤„å°±ä½“ç°å‡ºæ¥äº†ï¼Œçˆ¬å±±çš„æ—¶å€™ä¸€è·¯åŸºæœ¬éƒ½æ˜¯è¶…è¶Šåˆ«äººï¼Œä¹Ÿæ²¡æœ‰æ„Ÿè§‰å¾ˆç´¯ï¼Œä¹Ÿæ²¡æœ‰æ„Ÿè§‰å¾ˆéš¾ã€‚ä»çº¢é—¨å¼€å§‹ï¼Œä¸€å£æ°”çˆ¬åˆ°ä¸­å¤©é—¨ï¼Œå–äº†ç‚¹æ°´ï¼Œä¼‘æ¯äº†ä¸€ä¸‹ï¼Œç„¶åå°±ä¸€å£æ°”çˆ¬åˆ°äº†å—å¤©é—¨ã€‚&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/c75908d1be1d2108b6ccf7fcf0b18b867da48a73.jpg">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/c75908d1be1d2108b6ccf7fcf0b18b867da48a73.jpg" alt="" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>è¿™é€Ÿåº¦æˆ‘è‡ªå·±è¿˜æ˜¯æŒºæ»¡æ„çš„ã€‚&lt;/p>
&lt;p>è¿™ä¸€å¹´ï¼Œç”Ÿæ´»å¥½åƒä¹Ÿæ²¡æœ‰ä»€ä¹ˆå¤§çš„å˜åŒ–ï¼Œä½†æ˜¯ä¹Ÿæœ‰å¾ˆå¤šå°çš„å˜åŒ–ã€‚ä»¥å‰å‘¨æœ«åŸºæœ¬éƒ½æ˜¯åœ¨å®¶é‡Œï¼Œç°åœ¨å‘¨æœ«éƒ½ä¼šå‡ºå»éª‘è½¦ï¼Œæ„Ÿè§‰ç”Ÿæ´»å˜å¾—å……å®äº†å¾ˆå¤šã€‚åˆ«çš„å¥½åƒä¹Ÿæ²¡ä»€ä¹ˆå˜åŒ–ï¼Œè¿˜æ˜¯ä¸€ä¸ªäººåœ¨è¿™åŸå¸‚ä¸­ã€‚&lt;/p>
&lt;h2 id="å·¥ä½œ">&lt;a href="#%e5%b7%a5%e4%bd%9c" class="header-anchor">&lt;/a>å·¥ä½œ
&lt;/h2>&lt;p>è¿™ä¸€å¹´å·¥ä½œä¹Ÿç®—æ˜¯æ¯”è¾ƒå¿™ï¼Œäº‹æƒ…æŒºå¤šçš„ã€‚æ•´ä½“çœ‹ä¸‹æ¥ï¼Œä¹Ÿç®—æ˜¯åœ¨å·¥ä½œå’Œç”Ÿæ´»ä¸­æ‰¾åˆ°äº†ä¸€ä¸ªå¹³è¡¡ç‚¹ã€‚å·¥ä½œè¿™ä¹ˆå¤šå¹´äº†ï¼Œå¾ˆå¤šäº‹æƒ…å¤„ç†èµ·æ¥ä¹Ÿç®—æ˜¯æ¯”è¾ƒå¾—å¿ƒåº”æ‰‹ï¼Œ&lt;/p>
&lt;p>ä»Šå¹´åœ¨å·¥ä½œä¸Šç®—æ˜¯æ²¡æœ‰é‡åˆ°å¤§çš„å›°éš¾ã€‚
ä»Šå¹´æœ‰å‡ æ¬¡çº¿ä¸Šæµ‹è¯•ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘è´Ÿè´£åï¼Œç¬¬ä¸€æ¬¡ç»å†çº¿ä¸Šæµ‹è¯•ã€‚æµ‹è¯•ä¸­ä¸å‡ºæ„å¤–çš„å‡ºæ„å¤–äº†ã€‚å¥½åœ¨ä¹Ÿæ²¡å‡ºå¤§çš„é—®é¢˜ï¼Œä¹Ÿç®—æ˜¯é¡ºåˆ©é€šè¿‡äº†ã€‚&lt;/p>
&lt;p>ç»å†äº†åŠå¤œè¢«å«èµ·æ¥æŸ¥bugï¼Œå¥½åœ¨æœ€åå‘ç°ä¸æ˜¯é‡è¦çš„é—®é¢˜ï¼ŒæœåŠ¡æ²¡æœ‰æŒ‚æ‰ï¼Œåªéœ€è¦åé¢ä¿®å¤å°±è¡Œäº†ã€‚æ¯æ¬¡æµ‹è¯•éƒ½èƒ½å‘ç°ä¸€äº›é—®é¢˜ï¼Œä¹Ÿç®—æ˜¯ä¸€æ¬¡å¾ˆå¥½çš„ç»å†ã€‚æ—©å‘ç°é—®é¢˜æ¯”æ™šå‘ç°é—®é¢˜è¦å¥½å¾ˆå¤šã€‚&lt;/p>
&lt;p>ä»Šå¹´å·¥ä½œä¸Šä¹Ÿæ²¡æœ‰ä»€ä¹ˆå¤§çš„å˜åŒ–ï¼Œè¿˜æ˜¯åœ¨åŸæ¥çš„å…¬å¸ï¼Œè¿˜æ˜¯åœ¨åŸæ¥çš„å²—ä½ã€‚å¯èƒ½æ˜¯æ—¶é—´ä¹…äº†ï¼Œå¾ˆå¤šäº‹æƒ…å¤„ç†èµ·æ¥ä¹Ÿç®—æ˜¯æ¯”è¾ƒå¾—å¿ƒåº”æ‰‹ï¼Œä¹Ÿæ²¡æœ‰ä»€ä¹ˆå¤§çš„å›°éš¾ã€‚å°±ä¸€ç¬”å¸¦è¿‡å§ã€‚&lt;/p>
&lt;h2 id="å¼€æºç¤¾åŒº">&lt;a href="#%e5%bc%80%e6%ba%90%e7%a4%be%e5%8c%ba" class="header-anchor">&lt;/a>å¼€æºç¤¾åŒº
&lt;/h2>&lt;p>è‡ªä»æ¥è§¦äº†å¼€æºç¤¾åŒºï¼ŒåŸºæœ¬å¹³æ—¶æœ‰ç©ºå°±ä¼šå‚ä¸ä¸€ä¸‹ã€‚ä»Šå¹´ä¹Ÿæ˜¯å‚ä¸äº†ä¸€äº›å¼€æºé¡¹ç›®ï¼Œä¹Ÿæ˜¯æœ‰ä¸€äº›æ”¶è·ã€‚åœ¨ç¤¾åŒºé‡Œè®¤è¯†äº†å¾ˆå¤šæœ‹å‹ï¼Œä¹Ÿå­¦åˆ°äº†å¾ˆå¤šä¸œè¥¿ã€‚&lt;/p>
&lt;p>ä»Šå¹´çš„commitæ¬¡æ•°å’Œå»å¹´ç›¸æ¯”ï¼Œä¹Ÿå·®ä¸å¤šå§&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/205fdd4f275aa2877789309590b3253bdacdb080.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/205fdd4f275aa2877789309590b3253bdacdb080.webp" alt="" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>å¥½åƒä¹Ÿæ²¡ä»€ä¹ˆå¥½è¯´çš„äº†ï¼Œå°±è¿™æ ·å§ã€‚2025ç»§ç»­å‚ä¸ã€‚&lt;/p>
&lt;h2 id="other">&lt;a href="#other" class="header-anchor">&lt;/a>other
&lt;/h2>&lt;p>è¿™é‡Œå°±æƒ³åˆ°ä»€ä¹ˆå°±å†™ä»€ä¹ˆå§ã€‚&lt;/p>
&lt;p>åŸæ¥è®¡åˆ’ä»Šå¹´è¦è¯»ä¸€äº›ä¹¦ï¼Œä½†æ˜¯æœ€åä¹Ÿæ²¡è¯»å‡ æœ¬ï¼Œå¹´åˆçš„æ—¶å€™ä¸€å£æ°”çœ‹äº†å¥½å¤šï¼Œåé¢å¼€å§‹éª‘è½¦äº†ï¼Œçœ‹ä¹¦çš„æ—¶é—´å°±å°‘äº†ã€‚æ˜å¹´ç»§ç»­åŠªåŠ›å§ã€‚&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/b637ad035796001ae5696521849982ad27f0a062.jpg">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/b637ad035796001ae5696521849982ad27f0a062.jpg" alt="" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>åªæœ‰ã€Šé•¿å®‰çš„è”æã€‹å’Œã€Šå¤ªç™½é‡‘æ˜Ÿæœ‰ç‚¹çƒ¦ã€‹è¿™ä¸¤æœ¬ä¹¦çœ‹å®Œäº†ï¼Œå…¶ä»–çš„éƒ½æ²¡çœ‹å®Œï¼Œæ˜å¹´ç»§ç»­è¯»ã€‚
è¯»äº†è¿™ä¸¤æœ¬ä¹¦åï¼Œè¶Šæ¥è¶Šå–œæ¬¢é©¬ä¼¯åº¸äº†ï¼Œå†™çš„ä¸œè¥¿å¾ˆæœ‰æ„æ€ã€‚å¬è¯´ã€Šé•¿å®‰çš„è”æã€‹è¦æ‹ç”µè§†å‰§äº†ï¼ŒæœŸå¾…ä¸€ä¸‹ã€‚&lt;/p>
&lt;p>ä»Šå¹´æŠ€æœ¯æ–‡ç« å†™çš„æ›´å°‘äº†ï¼Œæœ‰æ—¶å€™æ²¡æ‰¾åˆ°å¥½çš„æŠ€æœ¯ç‚¹ï¼Œä¸çŸ¥é“å†™ä»€ä¹ˆã€‚æœ‰å‡ æ¬¡æƒ³å†™ &lt;code>redis&lt;/code> æºç çš„è§£è¯»ï¼Œä½†æ˜¯è¿™æ–¹é¢çš„æ–‡ç« å¤ªå¤šäº†ï¼Œä¹Ÿæ²¡ä»€ä¹ˆæ–°æ„ï¼Œå°±ä¸€ç›´æ²¡å†™ã€‚&lt;/p>
&lt;p>æœ€è¿‘å¤©å†·äº†ï¼ŒåŸºæœ¬ä¸æ€ä¹ˆéª‘è½¦äº†ã€‚ç©äº†ä¸€ä¸‹ &lt;code>èµ›åšæœ‹å…‹2077&lt;/code>ï¼Œå¼€å§‹æ€è€ƒä¸€ä¸ªé—®é¢˜ï¼Œæœªæ¥ç§‘æŠ€æ˜¯å¦çœŸçš„èƒ½å‘å±•åˆ°æ¸¸æˆé‡Œé‚£æ ·ï¼Œäººç±»æ˜¯å¦çœŸçš„èƒ½å®ç°æ„è¯†çš„æ°¸ç”Ÿã€‚
ä¸çŸ¥é“é©¬æ–¯å…‹çš„ &lt;code>neuralink&lt;/code> ä¼šä¸ä¼šå®ç°ï¼Œå¦‚æœå®ç°äº†ï¼Œäººç±»çš„æœªæ¥ä¼šæ˜¯ä»€ä¹ˆæ ·å­ã€‚èƒ½ä¸èƒ½åƒæ¸¸æˆé‡Œé‚£æ ·ï¼Œäººç±»çš„æ„è¯†å¯ä»¥æ°¸ç”Ÿï¼Œå¯ä»¥åœ¨ä¸åŒçš„æœºå™¨äººèº«ä¸Šè½¬ç§»ã€‚
å¦‚æœçœŸçš„å®ç°äº†ï¼Œä¼šä¸ä¼šç»™è¿™ä¸ªä¸–ç•Œå¸¦æ¥æ›´å¤šçš„é—®é¢˜ï¼Œäººç±»çš„æ„è¯†æ°¸ç”Ÿï¼Œä¼šä¸ä¼šå¯¼è‡´äººç±»çš„ç­äº¡ã€‚&lt;/p>
&lt;p>è€ç”Ÿå¸¸è°ˆçš„äº‹æƒ…ï¼Œä»Šå¹´è¿˜æ˜¯ä¸€ä¸ªäººï¼Œæ˜å¹´ç»§ç»­åŠªåŠ›å§ã€‚&lt;/p>
&lt;h2 id="2025">&lt;a href="#2025" class="header-anchor">&lt;/a>2025
&lt;/h2>&lt;p>2025å¹´ï¼Œç»§ç»­åœ¨ä¸€äº›æ–¹é¢å°è¯•çªç ´è‡ªå·±ï¼Œåƒæ˜¯ä»Šå¹´çš„éª‘è½¦ï¼Œç®—æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„å°è¯•ï¼Œè®¤è¯†äº†å¾ˆå¤šæ–°çš„æœ‹å‹ï¼Œä¹Ÿæœ‰äº†ä¸€äº›æ–°çš„ç»å†ï¼Œä¹Ÿçœ‹åˆ°äº†ä¸€äº›ä»¥å‰æ²¡æœ‰çœ‹è¿‡çš„é£æ™¯ã€‚&lt;/p>
&lt;p>è‡³äºç›®æ ‡å•¥çš„ä¹Ÿåˆ«å®šäº†ï¼Œè‡ªå·±å•¥æ‰§è¡ŒåŠ›è‡ªå·±ä¹Ÿæ¸…æ¥šï¼ŒåŠªåŠ›è¿‡å¥½æ¯ä¸€å¤©ã€‚&lt;/p>
&lt;p>&lt;strong>Good luck next year&lt;/strong>&lt;/p></description></item><item><title>Hexoè¿ç§»åˆ°hugoæŒ‡åŒ—|Hugoé…ç½®|è‡ªå®šä¹‰|ç¾åŒ–</title><link>https://lqxhub.github.io/posts/a660c9b1/</link><pubDate>Thu, 24 Oct 2024 19:54:58 +0800</pubDate><guid>https://lqxhub.github.io/posts/a660c9b1/</guid><description>&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/c93977adeb47543e974d7abfcb000757e682158f.jpg" alt="Featured image of post Hexoè¿ç§»åˆ°hugoæŒ‡åŒ—|Hugoé…ç½®|è‡ªå®šä¹‰|ç¾åŒ–" />&lt;p>æœ€è¿‘ï¼Œæˆ‘å°†æˆ‘çš„åšå®¢ä»Hexoè¿ç§»åˆ°äº†Hugoã€‚èµ·å› æ˜¯æœ€è¿‘åœ¨æŸ¥èµ„æ–™çš„æ—¶å€™ï¼Œå‘ç°äº†ä¸€ä¸ªå¾ˆå¥½çœ‹çš„åšå®¢ï¼Œçœ‹åˆ°æ˜¯ç”¨Hugoç”Ÿæˆçš„ï¼Œäºæ˜¯å°±èŒç”Ÿäº†ä»Hexoè¿ç§»åˆ°æŠ¤å›½çš„æƒ³æ³•ã€‚
Hexoå…¶å®ä¹ŸæŒºå¥½ç”¨çš„ï¼Œå½“æ—¶æˆ‘è‡ªå»ºblogçš„æ—¶å€™ï¼Œå°±å·²ç»æœ‰Hugoäº†ï¼Œä½†æ˜¯å½“æ—¶Hugoçš„èµ„æ–™ä¸å¤šï¼Œäºæ˜¯å°±é€‰äº†äº†Hexoã€‚è¿™æ˜¯æƒ³è¦æ¢åˆ°Hugoï¼Œä¸»è¦æ˜¯çœ‹ä¸­äº† Hugoä¸­ &lt;strong>Stack&lt;/strong> è¿™ä¸ªä¸»é¢˜ã€‚
è¿˜ä¸€ä¸ªåŸå› æ˜¯æˆ‘ä¸å–œæ¬¢Hexoä½¿ç”¨ Node.jsã€‚æˆ‘ä¸€ä¸ªå†™åç«¯çš„ï¼Œå¹³æ—¶ä¹Ÿç”¨ä¸åˆ°Nodeï¼Œè€Œä¸”å¯¹ &lt;strong>npm&lt;/strong> çš„å‘½ä»¤ä¹Ÿä¸ç†Ÿæ‚‰ï¼Œæ€»ä¹‹ç”¨èµ·æ¥å°±å¾ˆåˆ«æ‰­ã€‚
Hugoè¿˜ä¸€ä¸ªä¼˜ç‚¹æ˜¯æ„å»ºçš„é€Ÿåº¦æ¯”Hexoå¿«å¾—å¤šï¼Œå½“ç„¶æˆ‘ç›®å‰ä½¿ç”¨Hexoè¿˜æ²¡æœ‰åœ¨æ„å»ºä¸ŠèŠ±è´¹å¤ªå¤šæ—¶é—´ã€‚å¥½äº†é—²è¯å°±è¯´åˆ°è¿™é‡ŒæŠŠï¼Œä¸‹é¢æˆ‘å°†åˆ†äº«ä¸€äº›å…³äºå¦‚ä½•å°†Hexoè¿ç§»åˆ°Hugoçš„ç»éªŒã€‚&lt;/p>
&lt;p>åœ¨å¼€å§‹ä¹‹å‰ï¼Œéœ€è¦å…ˆä¸‹è½½Hugoï¼Œå¯ä»¥å»&lt;a class="link" href="https://github.com/gohugoio/hugo/releases" target="_blank" rel="noopener"
>GitHub&lt;/a>ä¸‹è½½ã€‚ä¸‹è½½çš„æ—¶å€™ï¼Œéœ€è¦æ ¹æ®è‡ªå·±çš„ç³»ç»Ÿé€‰æ‹©å¯¹åº”çš„ç‰ˆæœ¬ï¼Œä¸‹è½½çš„æ—¶å€™è®°å¾—ä¸‹è½½ &lt;strong>extended&lt;/strong> çš„ç‰ˆæœ¬ã€‚
è¿™æ˜¯æ”¯æŒ &lt;strong>SCSS&lt;/strong> å’Œ &lt;strong>PostCSS&lt;/strong> çš„ç‰ˆæœ¬ã€‚
ä¸‹è½½å®Œæˆåï¼Œè§£å‹åˆ°ä¸€ä¸ªç›®å½•ï¼Œç„¶åå°†è§£å‹åçš„ç›®å½•æ·»åŠ åˆ°ç¯å¢ƒå˜é‡ä¸­ã€‚ å®‰è£…å®Œæˆåï¼Œå¯ä»¥é€šè¿‡ &lt;code>hugo version&lt;/code> å‘½ä»¤æŸ¥çœ‹æ˜¯å¦å®‰è£…æˆåŠŸã€‚&lt;/p>
&lt;p>æˆ‘å°†åˆ† &lt;strong>Hugoé…ç½®&lt;/strong> å’Œ &lt;strong>è‡ªå®šä¹‰&lt;/strong> è¿™ä¸¤ä¸ªéƒ¨åˆ†æ¥è®²ã€‚&lt;/p>
&lt;h2 id="hugoé…ç½®">&lt;a href="#hugo%e9%85%8d%e7%bd%ae" class="header-anchor">&lt;/a>Hugoé…ç½®
&lt;/h2>&lt;p>å› ä¸º &lt;strong>Hugo&lt;/strong> ä¸­ï¼Œå¾ˆå¤šç›®å½•åœ¨ &lt;strong>é¡¹ç›®ç›®å½•&lt;/strong> å’Œ &lt;strong>themesï¼ˆä¸»é¢˜ï¼‰&lt;/strong> ç›®å½•ä¸‹éƒ½æœ‰ï¼Œæ‰€ä»¥åœ¨ä»‹ç»çš„æ—¶å€™ï¼Œæ²¡æœ‰ç‰¹æ®Šè¯´æ˜éƒ½æ˜¯åœ¨ &lt;strong>é¡¹ç›®ç›®å½•&lt;/strong> ä¸‹ã€‚&lt;/p>
&lt;h3 id="hugoé…ç½®æ–‡ä»¶">&lt;a href="#hugo%e9%85%8d%e7%bd%ae%e6%96%87%e4%bb%b6" class="header-anchor">&lt;/a>Hugoé…ç½®æ–‡ä»¶
&lt;/h3>&lt;p>Hugoé…ç½®æ–‡ä»¶æ”¯æŒå¤šç§æ ¼å¼ï¼Œæ¯”å¦‚ &lt;strong>toml&lt;/strong>ã€&lt;strong>yaml&lt;/strong>ã€&lt;strong>json&lt;/strong>ã€‚æˆ‘é€‰æ‹©çš„æ˜¯ &lt;strong>yaml&lt;/strong> æ ¼å¼ã€‚Hugoçš„é…ç½®æ–‡ä»¶æ˜¯ æ ¹ç›®å½•çš„&lt;strong>config.yaml&lt;/strong>&lt;/p>
&lt;p>ä¸‹é¢æ ¹æ®å±‚çº§æ¥ä»‹ç»ä¸€ä¸‹Hugoçš„é…ç½®æ–‡ä»¶&lt;/p>
&lt;p>è¿™æ˜¯æ ¹å±‚çš„é…ç½®ï¼Œä¸»è¦æ˜¯ä¸€äº›åŸºæœ¬çš„é…ç½®ï¼Œæ¯”å¦‚ç½‘ç«™çš„åŸºç¡€URLã€ç½‘ç«™çš„è¯­è¨€ã€é»˜è®¤çš„å†…å®¹è¯­è¨€ã€ä½¿ç”¨çš„ä¸»é¢˜ã€æ¯é¡µæ˜¾ç¤ºå¤šå°‘æ–‡ç« ã€ç½‘ç«™çš„æ ‡é¢˜ç­‰ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">baseurl&lt;/span>: https://lqxhub.github.io &lt;span style="color:#6272a4"># ç½‘ç«™çš„åŸºç¡€URL&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span>&lt;span style="color:#ff79c6">languageCode&lt;/span>: zh-cn &lt;span style="color:#6272a4"># ç½‘ç«™çš„è¯­è¨€&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span>&lt;span style="color:#ff79c6">defaultContentLanguage&lt;/span>: &lt;span style="color:#f1fa8c">&amp;#34;zh-cn&amp;#34;&lt;/span> &lt;span style="color:#6272a4"># é»˜è®¤çš„å†…å®¹è¯­è¨€&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span>&lt;span style="color:#ff79c6">theme&lt;/span>: hugo-theme-stack &lt;span style="color:#6272a4"># ä½¿ç”¨çš„ä¸»é¢˜&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span>&lt;span style="color:#ff79c6">paginate&lt;/span>: &lt;span style="color:#bd93f9">10&lt;/span> &lt;span style="color:#6272a4"># æ¯é¡µæ˜¾ç¤ºå¤šå°‘æ–‡ç« &lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span>&lt;span style="color:#ff79c6">title&lt;/span>: &lt;span style="color:#f1fa8c">&amp;#34;QX çš„ç¬”è®°&amp;#34;&lt;/span> &lt;span style="color:#6272a4"># ç½‘ç«™çš„æ ‡é¢˜&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span>&lt;span style="color:#ff79c6">hasCJKLanguage&lt;/span>: &lt;span style="color:#ff79c6">true&lt;/span> &lt;span style="color:#6272a4"># æ˜¯å¦ä½¿ç”¨CJKè¯­è¨€,ç”¨åˆ°ä¸­æ–‡çš„æ—¶å€™éœ€è¦è®¾ç½®ä¸ºtrue&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span>&lt;span style="color:#ff79c6">summaryLength&lt;/span>: &lt;span style="color:#bd93f9">200&lt;/span> &lt;span style="color:#6272a4"># æ‘˜è¦çš„é•¿åº¦&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span>&lt;span style="color:#ff79c6">enablePermalinks&lt;/span>: &lt;span style="color:#ff79c6">true&lt;/span> &lt;span style="color:#6272a4"># å¯ç”¨æ°¸ä¹…é“¾æ¥&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span>&lt;span style="color:#ff79c6">enableEmoji&lt;/span>: &lt;span style="color:#ff79c6">true&lt;/span> &lt;span style="color:#6272a4"># å¼€å¯ Emoji æ”¯æŒ&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span>&lt;span style="color:#ff79c6">enableInlineShortcodes&lt;/span>: &lt;span style="color:#ff79c6">true&lt;/span> &lt;span style="color:#6272a4"># å¼€å¯å†…è” Shortcodes æ”¯æŒ&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span>&lt;span style="color:#ff79c6">noTimes&lt;/span>: &lt;span style="color:#ff79c6">false&lt;/span> &lt;span style="color:#6272a4"># åŒæ­¥æ–‡ä»¶çš„ä¿®æ”¹æ—¶é—´ã€‚&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™äº›é…ç½®æ²¡æœ‰ä»€ä¹ˆå¥½è¯´çš„ï¼Œå°±æ˜¯ä¸€äº›åŸºæœ¬çš„é…ç½®ï¼Œæ ¹æ®è‡ªå·±çš„éœ€æ±‚æ¥é…ç½®å°±å¥½ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">permalinks&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span> &lt;span style="color:#ff79c6">post&lt;/span>: /posts/:slug/ &lt;span style="color:#6272a4"># æ–‡ç« çš„æ°¸ä¹…é“¾æ¥&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3&lt;/span>&lt;span> &lt;span style="color:#ff79c6">page&lt;/span>: /:slug/ &lt;span style="color:#6272a4"># é¡µé¢çš„æ°¸ä¹…é“¾æ¥&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™ä¸ªé…ç½®æ˜¯æ–‡ç« å’Œé¡µé¢çš„æ°¸ä¹…é“¾æ¥ï¼Œæ–‡ç« çš„æ°¸ä¹…é“¾æ¥æ˜¯ &lt;strong>/posts/:slug/&lt;/strong>ï¼Œé¡µé¢çš„æ°¸ä¹…é“¾æ¥æ˜¯ &lt;strong>/:slug/&lt;/strong>ã€‚
è¿™é‡Œçš„ &lt;strong>:slug&lt;/strong> æ˜¯æ–‡ç« ç”Ÿæˆçš„ &lt;strong>hash&lt;/strong> å€¼ï¼Œå› ä¸ºæˆ‘å†Hexoä¸­çš„æ–‡ç« çš„ &lt;strong>hashå€¼&lt;/strong>ï¼Œæ‰€ä»¥è¿™é‡Œä¹Ÿä½¿ç”¨ &lt;strong>hashå€¼&lt;/strong>ã€‚
åé¢åœ¨æ„å»ºçš„æ—¶å€™ï¼Œé¡µé¢çš„ &lt;strong>URL&lt;/strong> æ ¼å¼æ˜¯ &lt;code>baseurl/posts/slug&lt;/code>ã€‚æ¯”å¦‚è¿™ç¯‡æ–‡ç« çš„ &lt;strong>URL&lt;/strong> æ˜¯ &lt;code>https://lqxhub.github.io/posts/a660c9b1/&lt;/code>ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">params&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span> &lt;span style="color:#ff79c6">mainSections&lt;/span>: &lt;span style="color:#6272a4"># é¦–é¡µä»å“ªäº›éƒ¨åˆ†è·å–æ–‡ç« &lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span> - post
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span> &lt;span style="color:#ff79c6">dateFormat&lt;/span>: &lt;span style="color:#6272a4"># æ—¥æœŸæ ¼å¼,å¿…é¡»æ˜¯ç¬¦åˆ Go è¯­è¨€çš„æ—¥æœŸæ ¼å¼&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span> &lt;span style="color:#ff79c6">published&lt;/span>: Jan 02, 2006 &lt;span style="color:#6272a4"># å‘å¸ƒæ—¥æœŸ&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span> &lt;span style="color:#ff79c6">lastUpdated&lt;/span>: Jan 02, 2006 15:04 MST &lt;span style="color:#6272a4"># æœ€åæ›´æ–°æ—¥æœŸ&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span> &lt;span style="color:#ff79c6">footer&lt;/span>: &lt;span style="color:#6272a4"># é¡µè„šçš„é…ç½®&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span> &lt;span style="color:#ff79c6">enable&lt;/span>: &lt;span style="color:#ff79c6">true&lt;/span> &lt;span style="color:#6272a4"># æ˜¯å¦å¯ç”¨é¡µè„š&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span> &lt;span style="color:#ff79c6">since&lt;/span>: &lt;span style="color:#bd93f9">2021&lt;/span> &lt;span style="color:#6272a4"># ç½‘ç«™åˆ›å»ºå¹´ä»½&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span> &lt;span style="color:#ff79c6">customText&lt;/span>: &lt;span style="color:#f1fa8c">&amp;#34;Â© QX&amp;#34;&lt;/span> &lt;span style="color:#6272a4"># é¡µè„šçš„è‡ªå®šä¹‰æ–‡æœ¬&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span> &lt;span style="color:#ff79c6">copyright&lt;/span>: &lt;span style="color:#ff79c6">true&lt;/span> &lt;span style="color:#6272a4"># æ˜¯å¦æ˜¾ç¤ºç‰ˆæƒä¿¡æ¯&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span> &lt;span style="color:#ff79c6">author&lt;/span>: &lt;span style="color:#ff79c6">true&lt;/span> &lt;span style="color:#6272a4"># æ˜¯å¦æ˜¾ç¤ºä½œè€…ä¿¡æ¯&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15&lt;/span>&lt;span> &lt;span style="color:#ff79c6">favicon&lt;/span>: icons/favicon.ico &lt;span style="color:#6272a4"># æµè§ˆå™¨ Tab é¡µçš„ç½‘ç«™å›¾æ ‡&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16&lt;/span>&lt;span> &lt;span style="color:#ff79c6">sidebar&lt;/span>: &lt;span style="color:#6272a4"># ä¾§è¾¹æ çš„é…ç½®&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17&lt;/span>&lt;span> &lt;span style="color:#ff79c6">emoji&lt;/span>: ğŸ˜‰
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18&lt;/span>&lt;span> &lt;span style="color:#ff79c6">subtitle&lt;/span>: &lt;span style="color:#f1fa8c">&amp;#34;é›„å…³æ¼«é“çœŸå¦‚é“ï¼Œè€Œä»Šè¿ˆæ­¥ä»å¤´è¶Š&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19&lt;/span>&lt;span> &lt;span style="color:#ff79c6">avatar&lt;/span>: &lt;span style="color:#6272a4"># ä½œè€…å¤´åƒ&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20&lt;/span>&lt;span> &lt;span style="color:#ff79c6">enabled&lt;/span>: &lt;span style="color:#ff79c6">true&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21&lt;/span>&lt;span> &lt;span style="color:#ff79c6">local&lt;/span>: &lt;span style="color:#ff79c6">true&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22&lt;/span>&lt;span> &lt;span style="color:#ff79c6">src&lt;/span>: img/avatar.gif
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24&lt;/span>&lt;span> &lt;span style="color:#ff79c6">featuredImageField&lt;/span>: image &lt;span style="color:#6272a4"># æ–‡ç« çš„å°é¢å›¾ç‰‡ä»å“ªä¸ªå­—æ®µè·å–,è¿™é‡Œæ˜¯ä»imageå­—æ®µè·å–&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25&lt;/span>&lt;span> &lt;span style="color:#ff79c6">rssFullContent&lt;/span>: &lt;span style="color:#ff79c6">false&lt;/span> &lt;span style="color:#6272a4"># RSS æ˜¯å¦å¼€å¯å…¨å†…å®¹ / false åˆ™ä¸ºåªæœ‰æ‘˜è¦&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27&lt;/span>&lt;span> &lt;span style="color:#ff79c6">article&lt;/span>: &lt;span style="color:#6272a4"># æ–‡ç« çš„é…ç½®&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28&lt;/span>&lt;span> &lt;span style="color:#ff79c6">headingAnchor&lt;/span>: &lt;span style="color:#ff79c6">true&lt;/span> &lt;span style="color:#6272a4"># æ˜¯å¦å¼€å¯æ ‡é¢˜é”šç‚¹&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29&lt;/span>&lt;span> &lt;span style="color:#ff79c6">math&lt;/span>: &lt;span style="color:#ff79c6">true&lt;/span> &lt;span style="color:#6272a4"># è¿™é‡Œå…³é—­æ˜¯å› ä¸ºæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ MathJax&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30&lt;/span>&lt;span> &lt;span style="color:#ff79c6">toc&lt;/span>: &lt;span style="color:#ff79c6">false&lt;/span> &lt;span style="color:#6272a4"># TOC æ–‡ç« ä¹Ÿå³è¾¹çš„å¯¼èˆª&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31&lt;/span>&lt;span> &lt;span style="color:#ff79c6">readingTime&lt;/span>: &lt;span style="color:#ff79c6">true&lt;/span> &lt;span style="color:#6272a4"># é˜…è¯»æ—¶é—´&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32&lt;/span>&lt;span> &lt;span style="color:#ff79c6">license&lt;/span>: &lt;span style="color:#6272a4"># æ–‡ç« çš„ç‰ˆæƒä¿¡æ¯&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33&lt;/span>&lt;span> &lt;span style="color:#ff79c6">enabled&lt;/span>: &lt;span style="color:#ff79c6">true&lt;/span> &lt;span style="color:#6272a4"># æ˜¯å¦å¯ç”¨ç‰ˆæƒä¿¡æ¯&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34&lt;/span>&lt;span> &lt;span style="color:#ff79c6">default&lt;/span>: &lt;span style="color:#f1fa8c">&amp;#39;Licensed under CC BY-NC-SA 4.0&amp;#39;&lt;/span> &lt;span style="color:#6272a4"># é»˜è®¤çš„ç‰ˆæƒä¿¡æ¯&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36&lt;/span>&lt;span> &lt;span style="color:#ff79c6">widgets&lt;/span>: &lt;span style="color:#6272a4"># ç½‘é¡µä¸­å³è¾¹çš„å°éƒ¨ä»¶&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37&lt;/span>&lt;span> &lt;span style="color:#ff79c6">homepage&lt;/span>: &lt;span style="color:#6272a4"># é¦–é¡µçš„å°éƒ¨ä»¶&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38&lt;/span>&lt;span> - &lt;span style="color:#ff79c6">type&lt;/span>: search &lt;span style="color:#6272a4"># æœç´¢æ¡†&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39&lt;/span>&lt;span> - &lt;span style="color:#ff79c6">type&lt;/span>: archives &lt;span style="color:#6272a4"># å½’æ¡£&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40&lt;/span>&lt;span> &lt;span style="color:#ff79c6">params&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41&lt;/span>&lt;span> &lt;span style="color:#ff79c6">limit&lt;/span>: &lt;span style="color:#bd93f9">5&lt;/span> &lt;span style="color:#6272a4"># å½’æ¡£æ˜¾ç¤ºçš„æ•°é‡&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42&lt;/span>&lt;span> - &lt;span style="color:#ff79c6">type&lt;/span>: categories &lt;span style="color:#6272a4"># åˆ†ç±»&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43&lt;/span>&lt;span> &lt;span style="color:#ff79c6">params&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44&lt;/span>&lt;span> &lt;span style="color:#ff79c6">limit&lt;/span>: &lt;span style="color:#bd93f9">10&lt;/span> &lt;span style="color:#6272a4"># åˆ†ç±»æ˜¾ç¤ºçš„æ•°é‡&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45&lt;/span>&lt;span> - &lt;span style="color:#ff79c6">type&lt;/span>: tag-cloud &lt;span style="color:#6272a4"># æ ‡ç­¾äº‘&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46&lt;/span>&lt;span> &lt;span style="color:#ff79c6">params&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47&lt;/span>&lt;span> &lt;span style="color:#ff79c6">limit&lt;/span>: &lt;span style="color:#bd93f9">10&lt;/span> &lt;span style="color:#6272a4"># æ ‡ç­¾äº‘æ˜¾ç¤ºçš„æ•°é‡&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48&lt;/span>&lt;span> &lt;span style="color:#ff79c6">page&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49&lt;/span>&lt;span> - &lt;span style="color:#ff79c6">type&lt;/span>: &lt;span style="color:#f1fa8c">&amp;#34;toc&amp;#34;&lt;/span> &lt;span style="color:#6272a4"># TOC æ–‡ç« ä¹Ÿå³è¾¹çš„å¯¼èˆª&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">51&lt;/span>&lt;span> &lt;span style="color:#ff79c6">colorScheme&lt;/span>: &lt;span style="color:#6272a4"># é¢œè‰²ä¸»é¢˜&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">52&lt;/span>&lt;span> &lt;span style="color:#ff79c6">toggle&lt;/span>: &lt;span style="color:#ff79c6">true&lt;/span> &lt;span style="color:#6272a4"># æ˜¯å¦æ˜¾ç¤ºåˆ‡æ¢æŒ‰é’®&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">53&lt;/span>&lt;span> &lt;span style="color:#6272a4"># Available values: auto, light, dark&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">54&lt;/span>&lt;span> &lt;span style="color:#ff79c6">default&lt;/span>: auto &lt;span style="color:#6272a4"># é»˜è®¤çš„é¢œè‰²ä¸»é¢˜&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™é‡Œé…ç½®é¡¹æ¯”è¾ƒå¤šï¼ŒæŒ‘å‡ ä¸ªä¸å¥½ç†è§£çš„æ¥è¯´ä¸€ä¸‹ã€‚&lt;/p>
&lt;p>è¿™éƒ¨åˆ†å°±æ˜¯ &lt;strong>footer&lt;/strong> é…ç½®å¯¹åº”å›¾ç‰‡åº”è¯¥èƒ½çœ‹æ‡‚ï¼Œè¿™é‡Œå°±ä¸å¤šè¯´äº†ã€‚&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/47aee5674265d8c69a998e544b16e65e71b2a4a5.jpg">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/47aee5674265d8c69a998e544b16e65e71b2a4a5.jpg" alt="" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/8ca9f0934279cbf2cf9621b2a3d98ebe570c75a1.jpg">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/8ca9f0934279cbf2cf9621b2a3d98ebe570c75a1.jpg" alt="" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>ç›¸å…³çš„é…ç½®éƒ½åœ¨å›¾ç‰‡é‡Œæ ‡æ³¨äº†&lt;/p>
&lt;p>&lt;code>sidebar&lt;/code> é…ç½®æ˜¯ä¾§è¾¹æ çš„é…ç½®ï¼Œè¿™é‡Œé…ç½®äº†ä½œè€…çš„å¤´åƒã€ä½œè€…çš„åå­—ã€ä½œè€…çš„åº§å³é“­ã€ä½œè€…çš„å¤´åƒç­‰ã€‚&lt;/p>
&lt;p>&lt;code>widgets&lt;/code> é…ç½®æ˜¯ç½‘é¡µä¸­å³è¾¹çš„å°éƒ¨ä»¶ï¼Œè¿™é‡Œé…ç½®äº†é¦–é¡µçš„å°éƒ¨ä»¶ï¼ŒåŒ…æ‹¬æœç´¢æ¡†ã€å½’æ¡£ã€åˆ†ç±»ã€æ ‡ç­¾ç­‰ã€‚æœ‰ä¸æƒ³æ˜¾ç¤ºçš„ï¼Œåœ¨é…ç½®ä¸­åˆ é™¤å°±è¡Œã€‚&lt;/p>
&lt;p>ä¸‹é¢æ˜¯ &lt;strong>mene&lt;/strong> ç›¸å…³çš„é…ç½®&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">menu&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span> &lt;span style="color:#ff79c6">main&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span> - &lt;span style="color:#ff79c6">identifier&lt;/span>: home
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span> &lt;span style="color:#ff79c6">name&lt;/span>: é¦–é¡µ
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span> &lt;span style="color:#ff79c6">url&lt;/span>: /
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span> &lt;span style="color:#ff79c6">weight&lt;/span>: -&lt;span style="color:#bd93f9">100&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span> &lt;span style="color:#ff79c6">params&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span> &lt;span style="color:#ff79c6">newTab&lt;/span>: &lt;span style="color:#ff79c6">false&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span> &lt;span style="color:#ff79c6">icon&lt;/span>: home
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span> - &lt;span style="color:#ff79c6">identifier&lt;/span>: categories
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span> &lt;span style="color:#ff79c6">name&lt;/span>: åˆ†ç±»
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span> &lt;span style="color:#ff79c6">url&lt;/span>: /categories
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span> &lt;span style="color:#ff79c6">weight&lt;/span>: &lt;span style="color:#bd93f9">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span> &lt;span style="color:#ff79c6">params&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15&lt;/span>&lt;span> &lt;span style="color:#ff79c6">newTab&lt;/span>: &lt;span style="color:#ff79c6">false&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16&lt;/span>&lt;span> &lt;span style="color:#ff79c6">icon&lt;/span>: categories
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17&lt;/span>&lt;span> &lt;span style="color:#ff79c6">social&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18&lt;/span>&lt;span> - &lt;span style="color:#ff79c6">identifier&lt;/span>: email
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19&lt;/span>&lt;span> &lt;span style="color:#ff79c6">name&lt;/span>: Email
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20&lt;/span>&lt;span> &lt;span style="color:#ff79c6">url&lt;/span>: mailto:lqxlucky@qq.com
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21&lt;/span>&lt;span> &lt;span style="color:#ff79c6">params&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22&lt;/span>&lt;span> &lt;span style="color:#ff79c6">newTab&lt;/span>: &lt;span style="color:#ff79c6">true&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23&lt;/span>&lt;span> &lt;span style="color:#ff79c6">icon&lt;/span>: email
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24&lt;/span>&lt;span> - &lt;span style="color:#ff79c6">identifier&lt;/span>: github
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25&lt;/span>&lt;span> &lt;span style="color:#ff79c6">name&lt;/span>: GitHub
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26&lt;/span>&lt;span> &lt;span style="color:#ff79c6">url&lt;/span>: https://github.com/lqxhub
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27&lt;/span>&lt;span> &lt;span style="color:#ff79c6">params&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28&lt;/span>&lt;span> &lt;span style="color:#ff79c6">newTab&lt;/span>: &lt;span style="color:#ff79c6">true&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29&lt;/span>&lt;span> &lt;span style="color:#ff79c6">icon&lt;/span>: brand-github
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™æ˜¯ç²¾ç®€åçš„ï¼Œåœ¨å›¾ç‰‡ä¸­ï¼Œ&lt;strong>sidebar&lt;/strong> ä¸‹é¢çš„æ˜¯ &lt;strong>social&lt;/strong> çš„é…ç½®ï¼Œå†å¾€ä¸‹æ˜¯ &lt;strong>main&lt;/strong> çš„é…ç½®ã€‚&lt;/p>
&lt;p>è¿™é‡Œè¯´ä¸€ä¸‹ &lt;strong>main&lt;/strong> ä¸­çš„ä¸€äº›é—®é¢˜&lt;/p>
&lt;ul>
&lt;li>&lt;strong>identifier&lt;/strong>ï¼šæ ‡è¯†ç¬¦&lt;/li>
&lt;li>&lt;strong>name&lt;/strong> èœå•çš„åå­—&lt;/li>
&lt;li>&lt;strong>url&lt;/strong> èœå•çš„é“¾æ¥&lt;/li>
&lt;li>&lt;strong>weight&lt;/strong> æ˜¯æƒé‡ï¼Œæƒé‡è¶Šå°ï¼Œèœå•è¶Šé å‰ã€‚&lt;/li>
&lt;li>&lt;strong>newTab&lt;/strong> æ˜¯å¦åœ¨æ–°æ ‡ç­¾é¡µæ‰“å¼€&lt;/li>
&lt;li>&lt;strong>icon&lt;/strong> èœå•çš„å›¾æ ‡&lt;/li>
&lt;/ul>
&lt;p>å¦‚æœä¸éœ€è¦è‡ªå®šä¹‰çš„è¯ï¼Œç›´æ¥é…ç½®å°±è¡Œäº†ï¼Œåœ¨æ„å»ºçš„æ—¶å€™ï¼Œä¼šè‡ªåŠ¨ç”Ÿæˆèœå•ã€‚ä¸€äº› icon å¯èƒ½ä¸»é¢˜ä¸­æ²¡æœ‰ï¼Œéœ€è¦è‡ªå·±æ·»åŠ ï¼Œæˆ‘å†é…ç½®æ—¶æœ‰å¥½å‡ ä¸ªæ²¡æœ‰æ‰¾åˆ°ï¼Œ
æˆ‘ä½¿ç”¨ &lt;strong>chatGPT&lt;/strong> ç”Ÿæˆäº†ä¸€äº›å›¾æ ‡&lt;/p>
&lt;p>å¦‚æœè¦è‡ªå®šä¹‰ï¼Œé‚£ä¹ˆéœ€è¦åœ¨ &lt;strong>content&lt;/strong> ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªå’Œ è®¿é—®è¿™ä¸ªé¡µé¢çš„ &lt;strong>URL&lt;/strong> åŒåçš„ç›®å½•ï¼Œç„¶ååœ¨æ–°å»ºçš„ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª &lt;strong>_index.md&lt;/strong> æ–‡ä»¶ï¼Œ
ç„¶ååœ¨ &lt;strong>_index.md&lt;/strong> æ–‡ä»¶ä¸­é…ç½®&lt;/p>
&lt;p>ä»¥ &lt;strong>åˆ†ç±»&lt;/strong> ä¸ºä¾‹ï¼Œ&lt;strong>content/categories/_index.md&lt;/strong> çš„é…ç½®å¦‚ä¸‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>---
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span>&lt;span style="color:#ff79c6">title&lt;/span>: &lt;span style="color:#f1fa8c">&amp;#34;åˆ†ç±»&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3&lt;/span>&lt;span>&lt;span style="color:#ff79c6">license&lt;/span>: &lt;span style="color:#ff79c6">false&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4&lt;/span>&lt;span>---
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™é‡Œä¸»è¦æ˜¯æ”¹ä¸€ä¸‹ &lt;strong>title&lt;/strong>ï¼Œåªæœ‰ ç½‘é¡µçš„æ ‡é¢˜å’Œ é…ç½®ä¸­çš„ &lt;strong>name&lt;/strong> ç›¸åŒæ—¶ï¼Œåœ¨ç‚¹å‡»å¯¹åº”çš„èœå•åï¼Œå¯¹åº”çš„èœå•åæ‰ä¼šé«˜äº®ã€‚&lt;/p>
&lt;p>&lt;strong>social&lt;/strong> éƒ½æ˜¯å¸¸è§çš„å†…å®¹ï¼Œè¿™é‡Œå°±ä¸å¤šè¯´äº†ã€‚&lt;/p>
&lt;p>é¡µé¢æ¸²æŸ“ç›¸å…³çš„é…ç½®ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">markup&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span> &lt;span style="color:#ff79c6">defaultMarkdownHandler&lt;/span>: goldmark
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span> &lt;span style="color:#ff79c6">tableOfContents&lt;/span>: &lt;span style="color:#6272a4"># TOC æ–‡ç« ä¹Ÿå³è¾¹çš„å¯¼èˆª&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span> &lt;span style="color:#ff79c6">ordered&lt;/span>: &lt;span style="color:#ff79c6">true&lt;/span> &lt;span style="color:#6272a4"># æ˜¯å¦æœ‰åº&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span> &lt;span style="color:#ff79c6">startLevel&lt;/span>: &lt;span style="color:#bd93f9">2&lt;/span> &lt;span style="color:#6272a4"># ä» 2çº§æ ‡é¢˜å¼€å§‹&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span> &lt;span style="color:#ff79c6">endLevel&lt;/span>: &lt;span style="color:#bd93f9">5&lt;/span> &lt;span style="color:#6272a4"># åˆ° 5çº§æ ‡é¢˜ç»“æŸ&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span> &lt;span style="color:#ff79c6">highlight&lt;/span>: &lt;span style="color:#6272a4"># ä»£ç é«˜äº®é…ç½®&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span> &lt;span style="color:#ff79c6">codeFences&lt;/span>: &lt;span style="color:#ff79c6">true&lt;/span> &lt;span style="color:#6272a4"># æ˜¯å¦å¯ç”¨ä»£ç å—&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span> &lt;span style="color:#ff79c6">guessSyntax&lt;/span>: &lt;span style="color:#ff79c6">true&lt;/span> &lt;span style="color:#6272a4"># æ˜¯å¦çŒœæµ‹è¯­æ³•&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span> &lt;span style="color:#ff79c6">lineNoStart&lt;/span>: &lt;span style="color:#bd93f9">1&lt;/span> &lt;span style="color:#6272a4"># ä»£ç å—çš„èµ·å§‹è¡Œå·&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span> &lt;span style="color:#ff79c6">lineNos&lt;/span>: &lt;span style="color:#ff79c6">true&lt;/span> &lt;span style="color:#6272a4"># æ˜¯å¦æ˜¾ç¤ºè¡Œå·&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span> &lt;span style="color:#ff79c6">lineNumbersInTable&lt;/span>: &lt;span style="color:#ff79c6">false&lt;/span> &lt;span style="color:#6272a4"># æ˜¯å¦åœ¨è¡¨æ ¼ä¸­æ˜¾ç¤ºè¡Œå·&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span> &lt;span style="color:#ff79c6">noClasses&lt;/span>: &lt;span style="color:#ff79c6">true&lt;/span> &lt;span style="color:#6272a4"># æ˜¯å¦ä¸ä½¿ç”¨ç±»&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span> &lt;span style="color:#ff79c6">style&lt;/span>: &lt;span style="color:#f1fa8c">&amp;#34;dracula&amp;#34;&lt;/span> &lt;span style="color:#6272a4"># ä»£ç å—çš„æ ·å¼&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15&lt;/span>&lt;span> &lt;span style="color:#ff79c6">tabWidth&lt;/span>: &lt;span style="color:#bd93f9">4&lt;/span> &lt;span style="color:#6272a4"># tab çš„å®½åº¦&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™éƒ¨åˆ†ä¹Ÿæ˜¯æ¯”è¾ƒå¥½ç†è§£çš„ï¼Œä¸»è¦æ˜¯ä»£ç é«˜äº®çš„é…ç½®ï¼Œè¿™é‡Œä½¿ç”¨çš„æ˜¯ &lt;strong>dracula&lt;/strong> ä¸»é¢˜ã€‚
ä¸åŒä¸»é¢˜çš„æ•ˆæœï¼Œå¯ä»¥å»&lt;a class="link" href="https://pygments.org/styles/" target="_blank" rel="noopener"
>è¿™é‡Œ&lt;/a>æŸ¥çœ‹ã€‚&lt;/p>
&lt;h3 id="é¡µé¢ä¸­çš„é…ç½®">&lt;a href="#%e9%a1%b5%e9%9d%a2%e4%b8%ad%e7%9a%84%e9%85%8d%e7%bd%ae" class="header-anchor">&lt;/a>é¡µé¢ä¸­çš„é…ç½®
&lt;/h3>&lt;p>åœ¨æ¯ç¯‡æ–‡ç« çš„ &lt;strong>front matter&lt;/strong> ä¸­ï¼Œå¯ä»¥é…ç½®ä¸€äº›æ–‡ç« çš„ä¿¡æ¯ï¼Œæ¯”å¦‚æ–‡ç« çš„æ ‡é¢˜ã€ä½œè€…ã€æ—¥æœŸã€æ ‡ç­¾ã€åˆ†ç±»ç­‰ã€‚
å¯ä»¥ä½¿ç”¨ &lt;strong>yaml&lt;/strong>ã€&lt;strong>toml&lt;/strong> ç­‰ï¼Œæˆ‘ä½¿ç”¨çš„æ˜¯ &lt;strong>YAML&lt;/strong> æ ¼å¼ã€‚
ä½¿ç”¨ &lt;code>---&lt;/code> æ¥åˆ†éš” æ˜¯ &lt;strong>yaml&lt;/strong> æ ¼å¼çš„é…ç½®ï¼Œä½¿ç”¨ &lt;code>+++&lt;/code> æ¥åˆ†éš”æ˜¯ &lt;strong>toml&lt;/strong> æ ¼å¼çš„é…ç½®ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-toml" data-lang="toml">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>+++
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span>date = 2024-10-20T17:31:37+08:00
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3&lt;/span>&lt;span>title = &lt;span style="color:#f1fa8c">&amp;#34;Linuxä¸‹ä½¿ç”¨iouringå®ç°ä¸€ä¸ªtcpæœåŠ¡&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4&lt;/span>&lt;span>slug = &lt;span style="color:#f1fa8c">&amp;#34;f0e9829c&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5&lt;/span>&lt;span>categories = [&lt;span style="color:#f1fa8c">&amp;#34;linux&amp;#34;&lt;/span>, &lt;span style="color:#f1fa8c">&amp;#34;C++&amp;#34;&lt;/span>]
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6&lt;/span>&lt;span>tags = [&lt;span style="color:#f1fa8c">&amp;#34;linux&amp;#34;&lt;/span>, &lt;span style="color:#f1fa8c">&amp;#34;iouring&amp;#34;&lt;/span>, &lt;span style="color:#f1fa8c">&amp;#34;tcp&amp;#34;&lt;/span>, &lt;span style="color:#f1fa8c">&amp;#34;C++&amp;#34;&lt;/span>]
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7&lt;/span>&lt;span>description = &lt;span style="color:#f1fa8c">&amp;#34;æ¢ç´¢ Linux io_uring å¼‚æ­¥ I/O æ¥å£ï¼Œé€šè¿‡ liburing åº“å®ç°é«˜æ•ˆ TCP æœåŠ¡ã€‚æœ¬æ–‡æ·±å…¥ io_uring çš„åŸºç¡€æ¦‚å¿µï¼ŒåŒ…æ‹¬ Submission Queue å’Œ Completion Queueï¼Œå¹¶é€šè¿‡ç¤ºä¾‹ä»£ç æ¼”ç¤ºå¦‚ä½•åˆå§‹åŒ–ã€æäº¤ I/O è¯·æ±‚å’Œå¤„ç†å®Œæˆäº‹ä»¶ã€‚äº†è§£ io_uring å¦‚ä½•æå‡ I/O å¯†é›†å‹åº”ç”¨çš„æ€§èƒ½ï¼Œä»¥åŠåœ¨å®é™…éƒ¨ç½²ä¸­éœ€è¦æ³¨æ„çš„é”™è¯¯å¤„ç†å’Œè¿æ¥ç®¡ç†ã€‚&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8&lt;/span>&lt;span>image = &lt;span style="color:#f1fa8c">&amp;#34;https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/6a84474a44a97bccecbbc9c5a3b9f7aea2571c97.jpg&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">9&lt;/span>&lt;span>+++
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™é‡Œç®€å•è¯´ä¸€ä¸‹&lt;/p>
&lt;ul>
&lt;li>&lt;strong>date&lt;/strong> æ–‡ç« çš„æ—¥æœŸï¼Œå¿…é¡»æ˜¯ GO è¯­è¨€çš„æ—¥æœŸæ ¼å¼&lt;/li>
&lt;li>&lt;strong>title&lt;/strong> æ–‡ç« çš„æ ‡é¢˜&lt;/li>
&lt;li>&lt;strong>slug&lt;/strong> æ–‡ç« çš„æ°¸ä¹…é“¾æ¥&lt;/li>
&lt;li>&lt;strong>categories&lt;/strong> æ–‡ç« çš„åˆ†ç±»ï¼Œå¯ä»¥æœ‰å¤šä¸ªï¼ŒHugoåœ¨æ„å»ºçš„æ—¶å€™ï¼Œä¼šè‡ªåŠ¨ç”Ÿæˆåˆ†ç±»çš„é¡µé¢&lt;/li>
&lt;li>&lt;strong>tags&lt;/strong> æ–‡ç« çš„æ ‡ç­¾ï¼Œå¯ä»¥æœ‰å¤šä¸ªï¼ŒHugoåœ¨æ„å»ºçš„æ—¶å€™ï¼Œä¼šè‡ªåŠ¨ç”Ÿæˆæ ‡ç­¾çš„é¡µé¢&lt;/li>
&lt;li>&lt;strong>description&lt;/strong> æ–‡ç« çš„æè¿°ï¼Œä¼šåœ¨é¦–é¡µçš„æ–‡ç« åˆ—è¡¨ä¸­æ˜¾ç¤ºï¼Œä¹Ÿæ˜¯ &lt;strong>SEO&lt;/strong> çš„ä¸€éƒ¨åˆ†&lt;/li>
&lt;li>&lt;strong>image&lt;/strong> æ–‡ç« çš„å°é¢å›¾ç‰‡ï¼Œä¼šåœ¨é¦–é¡µçš„æ–‡ç« åˆ—è¡¨ä¸­æ˜¾ç¤º&lt;/li>
&lt;/ul>
&lt;p>åœ¨è¯´ä¸€ä¸‹ &lt;strong>åˆ†ç±»&lt;/strong> ä¸­çš„å°é¢&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/bf0215af233c3a1ae218145911e1fe2f4135913a.jpg">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/bf0215af233c3a1ae218145911e1fe2f4135913a.jpg" alt="" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>ä¹Ÿå°±æ˜¯å›¾ç‰‡ä¸­æ ‡æ³¨çš„éƒ¨åˆ†ï¼Œè¿™ä¸ªæ˜¯åˆ†ç±»çš„å°é¢ï¼Œå¦‚æœä¸é…ç½®çš„è¯ï¼Œä¼šä½¿ç”¨é»˜è®¤çš„å°é¢ï¼Œå¦‚æœæƒ³è¦è‡ªå®šä¹‰çš„è¯ï¼Œå¯ä»¥åœ¨ &lt;strong>content/categories&lt;/strong> ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªå’Œ &lt;strong>åˆ†ç±»&lt;/strong> åŒåçš„ç›®å½•ï¼Œ
æ¯”å¦‚ &lt;strong>content/categories/linux&lt;/strong>ï¼Œç„¶ååœ¨ &lt;strong>linux&lt;/strong> ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª &lt;strong>_index.md&lt;/strong> æ–‡ä»¶ï¼Œç„¶ååœ¨ &lt;strong>_index.md&lt;/strong> æ–‡ä»¶ä¸­é…ç½®&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>---
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span>&lt;span style="color:#ff79c6">title&lt;/span>: &lt;span style="color:#f1fa8c">&amp;#34;linux&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3&lt;/span>&lt;span>&lt;span style="color:#ff79c6">slug&lt;/span>: &lt;span style="color:#f1fa8c">&amp;#34;linux&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4&lt;/span>&lt;span>&lt;span style="color:#ff79c6">image&lt;/span>: &lt;span style="color:#f1fa8c">&amp;#34;https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/Linux.jpg&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5&lt;/span>&lt;span>&lt;span style="color:#ff79c6">weight&lt;/span>: &lt;span style="color:#bd93f9">10&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6&lt;/span>&lt;span>---
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å…¶ä¸­ &lt;strong>image&lt;/strong> å°±æ˜¯åˆ†ç±»çš„å°é¢ï¼Œ&lt;strong>weight&lt;/strong> æ˜¯æƒé‡ï¼Œæƒé‡è¶Šå°ï¼Œåˆ†ç±»è¶Šé å‰ã€‚&lt;/p>
&lt;p>&lt;strong>æœç´¢&lt;/strong> é¡µé¢çš„é…ç½®ï¼Œåœ¨æ·»åŠ äº†æœç´¢é¡µé¢çš„æ—¶å€™ï¼Œéœ€è¦åœ¨ &lt;strong>content/search&lt;/strong> ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª &lt;strong>index.md&lt;/strong> æ–‡ä»¶ï¼Œç„¶ååœ¨ &lt;strong>index.md&lt;/strong> æ–‡ä»¶ä¸­é…ç½®&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>---
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span>&lt;span style="color:#ff79c6">title&lt;/span>: &lt;span style="color:#f1fa8c">&amp;#34;æœç´¢&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3&lt;/span>&lt;span>&lt;span style="color:#ff79c6">layout&lt;/span>: &lt;span style="color:#f1fa8c">&amp;#34;search&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4&lt;/span>&lt;span>&lt;span style="color:#ff79c6">outputs&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5&lt;/span>&lt;span> - &lt;span style="color:#f1fa8c">&amp;#34;html&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6&lt;/span>&lt;span> - &lt;span style="color:#f1fa8c">&amp;#34;json&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7&lt;/span>&lt;span>&lt;span style="color:#ff79c6">sitemap&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8&lt;/span>&lt;span> &lt;span style="color:#ff79c6">priority&lt;/span>: &lt;span style="color:#bd93f9">0.1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">9&lt;/span>&lt;span>---
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å¦‚æœæ²¡æœ‰é…ç½® &lt;strong>outputs&lt;/strong> çš„è¯ï¼Œæœç´¢é¡µä¸­çš„æœç´¢åŠŸèƒ½æ˜¯æ— æ•ˆçš„ï¼Œè¿™é‡Œé…ç½®äº† &lt;strong>html&lt;/strong> å’Œ &lt;strong>json&lt;/strong>ï¼Œè¿™æ ·å°±å¯ä»¥åœ¨æœç´¢é¡µä¸­æœç´¢æ–‡ç« äº†ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span>&lt;span style="color:#6272a4">## è¿ç§»åˆ°Hugo&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4&lt;/span>&lt;span>&lt;span style="color:#6272a4">### åˆ›å»ºHugoé¡¹ç›®&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5&lt;/span>&lt;span>åœ¨è¿ç§»ä¹‹å‰ï¼Œéœ€è¦å…ˆåˆ›å»ºä¸€ä¸ªHugoé¡¹ç›®ã€‚åœ¨Hexoä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ `hexo init` å‘½ä»¤æ¥åˆ›å»ºä¸€ä¸ªHexoé¡¹ç›®ã€‚è€Œåœ¨Hugoä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ `hugo new site` å‘½ä»¤æ¥åˆ›å»ºä¸€ä¸ªHugoé¡¹ç›®ã€‚
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7&lt;/span>&lt;span>```shell
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8&lt;/span>&lt;span>hugo new site blog
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>public&lt;/strong> æ˜¯æ„å»ºåç”Ÿæˆçš„ç›®å½•ï¼Œä¹Ÿå°±æ˜¯ç”Ÿæˆç½‘ç«™çš„æ ¹ç›®å½• &lt;strong>content&lt;/strong> ç›®å½•æ˜¯å­˜æ”¾æ–‡ç« çš„ç›®å½•ï¼Œ
&lt;strong>layouts&lt;/strong> ç›®å½•æ˜¯å­˜æ”¾æ¨¡æ¿çš„ç›®å½•ï¼Œ&lt;strong>static&lt;/strong> ç›®å½•æ˜¯å­˜æ”¾é™æ€æ–‡ä»¶çš„ç›®å½•ï¼Œ
è¿™ä¸ªç›®å½•çš„å†…å®¹åœ¨æ„å»ºæ—¶ä¼šç›´æ¥å¤åˆ¶åˆ°ç½‘ç«™çš„æ ¹ç›®å½•ä¸‹ã€‚&lt;strong>themes&lt;/strong> ç›®å½•æ˜¯å­˜æ”¾ä¸»é¢˜çš„ç›®å½•ã€‚è¿™äº›ç›®å½•éƒ½æ˜¯Hugoåˆ›å»ºé¡¹ç›®æ—¶è‡ªåŠ¨ç”Ÿæˆçš„ã€‚
åˆ«çš„ç›®å½•åœ¨åé¢ç”¨åˆ°çš„æ—¶å€™å†ä»‹ç»ã€‚&lt;/p>
&lt;h3 id="è¿ç§»æ–‡ç« ">&lt;a href="#%e8%bf%81%e7%a7%bb%e6%96%87%e7%ab%a0" class="header-anchor">&lt;/a>è¿ç§»æ–‡ç« 
&lt;/h3>&lt;p>åœ¨Hexoä¸­ï¼Œæ–‡ç« æ˜¯å­˜æ”¾åœ¨ &lt;strong>source/_posts&lt;/strong> ç›®å½•ä¸‹çš„ï¼Œè€Œåœ¨Hugoä¸­ï¼Œæ–‡ç« æ˜¯å­˜æ”¾åœ¨ &lt;strong>content&lt;/strong> ç›®å½•ä¸‹çš„ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦å°†Hexoä¸­çš„æ–‡ç« è¿ç§»åˆ°Hugoä¸­ã€‚&lt;/p>
&lt;p>æˆ‘çš„ä¹ æƒ¯è¿˜æ˜¯åœ¨ &lt;strong>content&lt;/strong> ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª &lt;strong>post&lt;/strong> ç›®å½•ï¼Œç„¶åå°†Hexoä¸­çš„æ–‡ç« è¿ç§»åˆ° &lt;strong>post&lt;/strong> ç›®å½•ä¸‹ã€‚è¿ç§»å®Œæˆåï¼Œç›®å½•ç»“æ„å¦‚ä¸‹ï¼š&lt;/p>
&lt;p>ç„¶åæŠŠHexoä¸­çš„æ–‡ç« è¿ç§»åˆ° &lt;strong>post&lt;/strong> ç›®å½•ä¸‹ã€‚è¿™æ ·å°±å®Œæˆäº†æ–‡ç« çš„è¿ç§»ã€‚è¿™æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ &lt;code>hugo&lt;/code> å‘½ä»¤æ¥æ„å»ºé¡¹ç›®ï¼Œ
è¿™æ—¶å€™å¤§æ¦‚ç‡æ˜¯æ„å»ºå¤±è´¥çš„ï¼Œå› ä¸ºæˆ‘ä»¬è¿˜æ²¡æœ‰é…ç½®Hugoçš„é…ç½®æ–‡ä»¶ã€‚&lt;/p>
&lt;p>é¦–å…ˆè¦è§£å†³çš„æ˜¯ &lt;strong>front matter&lt;/strong> çš„é—®é¢˜ï¼ŒHugoä¸­çš„ &lt;strong>date&lt;/strong> å¿…é¡»æ˜¯ &lt;strong>Go&lt;/strong> è¯­è¨€çš„æ—¥æœŸæ ¼å¼ï¼Œè¿™é‡Œéœ€è¦æ”¹æˆ &lt;strong>Go&lt;/strong> è¯­è¨€çš„æ—¥æœŸæ ¼å¼ã€‚
åœ¨Hugoä¸­ï¼Œæ°¸ä¹…è¿æ¥çš„æ˜¯ &lt;strong>slug&lt;/strong>ï¼Œå¦‚æœåŸæ¥æ–‡ç« ä½¿ç”¨äº†æ°¸ä¹…è¿æ¥ï¼Œéœ€è¦æ”¹ä¸€ä¸‹ã€‚&lt;/p>
&lt;h3 id="è¿ç§»å›¾ç‰‡">&lt;a href="#%e8%bf%81%e7%a7%bb%e5%9b%be%e7%89%87" class="header-anchor">&lt;/a>è¿ç§»å›¾ç‰‡
&lt;/h3>&lt;p>æˆ‘çš„å›¾ç‰‡æ˜¯ä½¿ç”¨çš„ &lt;strong>GitHub&lt;/strong> ä½œä¸ºå›¾åºŠï¼Œæ‰€ä»¥å›¾ç‰‡çš„é“¾æ¥æ˜¯ &lt;strong>GitHub&lt;/strong> çš„é“¾æ¥ã€‚ä¸éœ€è¦æ”¹åŠ¨ï¼Œç›´æ¥ä½¿ç”¨å°±è¡Œã€‚&lt;/p>
&lt;p>åˆ°è¿™é‡Œï¼Œåº”è¯¥èƒ½æˆåŠŸæ„å»ºå‡ºç½‘ç«™äº†ï¼Œä¸‹é¢æ˜¯ä¸€äº›è‡ªå®šä¹‰çš„å†…å®¹ã€‚&lt;/p>
&lt;h2 id="è‡ªå®šä¹‰hugo">&lt;a href="#%e8%87%aa%e5%ae%9a%e4%b9%89hugo" class="header-anchor">&lt;/a>è‡ªå®šä¹‰Hugo
&lt;/h2>&lt;p>æˆ‘ä½¿ç”¨çš„æ˜¯ &lt;strong>Stack&lt;/strong> ä¸»é¢˜ï¼Œè¿™ä¸ªä¸»é¢˜æ˜¯æˆ‘åœ¨æŸ¥èµ„æ–™çš„æ—¶å€™å‘ç°çš„ï¼Œè§‰å¾—æŒºå¥½çœ‹çš„ï¼Œæ‰€ä»¥å°±é€‰æ‹©äº†è¿™ä¸ªä¸»é¢˜ã€‚ä½†æ˜¯ä¸»é¢˜å†…ä¸€äº›ä¸œè¥¿æ²¡æœ‰ï¼Œéœ€è¦è‡ªå·±æ·»åŠ ã€‚&lt;/p>
&lt;p>è¿™é‡Œå…ˆä»‹ç»ä¸€ä¸‹HugoåŠ è½½æ–‡ä»¶çš„é¡ºåºï¼ŒHugoåŠ è½½æ–‡ä»¶çš„é¡ºåºæ˜¯ &lt;strong>themes&lt;/strong> ç›®å½•ä¸‹çš„æ–‡ä»¶ä¼˜å…ˆçº§æœ€é«˜ï¼Œç„¶åæ˜¯é¡¹ç›®ä¸­ &lt;strong>layouts&lt;/strong> ç›®å½•ä¸‹çš„æ–‡ä»¶ï¼Œæœ€åæ˜¯ &lt;strong>archetypes&lt;/strong> ç›®å½•ä¸‹çš„æ–‡ä»¶ã€‚&lt;/p>
&lt;p>å¦‚æœé¡¹ç›®ä¸­çš„ &lt;strong>layouts&lt;/strong> ç›®å½•ä¸­æœ‰å’Œ &lt;strong>themes&lt;/strong> ç›®å½•ä¸­çš„æ–‡ä»¶åŒåçš„æ–‡ä»¶ï¼Œé‚£ä¹ˆé¡¹ç›®ä¸­çš„æ–‡ä»¶ä¼šè¦†ç›– &lt;strong>themes&lt;/strong> ç›®å½•ä¸­çš„æ–‡ä»¶ã€‚è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥è‡ªå®šä¹‰ä¸»é¢˜äº†ã€‚&lt;/p>
&lt;h3 id="è‡ªå®šä¹‰å‹é“¾é¡µ">&lt;a href="#%e8%87%aa%e5%ae%9a%e4%b9%89%e5%8f%8b%e9%93%be%e9%a1%b5" class="header-anchor">&lt;/a>è‡ªå®šä¹‰å‹é“¾é¡µ
&lt;/h3>&lt;p>åœ¨ &lt;strong>layouts/shortcodes&lt;/strong> ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª &lt;strong>friends.html&lt;/strong> æ–‡ä»¶ï¼Œç„¶ååœ¨ &lt;strong>friends.html&lt;/strong> æ–‡ä»¶ä¸­é…ç½®&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-html" data-lang="html">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span>{{- $css := resources.Get &amp;#34;extended/blank.css&amp;#34; }}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span>{{- if $css }}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span>{{- $css := $css | resources.ToCSS | resources.Minify }}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span>&amp;lt;&lt;span style="color:#ff79c6">link&lt;/span> &lt;span style="color:#50fa7b">rel&lt;/span>&lt;span style="color:#ff79c6">=&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;stylesheet&amp;#34;&lt;/span> &lt;span style="color:#50fa7b">href&lt;/span>&lt;span style="color:#ff79c6">=&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;{{ $css.RelPermalink }}&amp;#34;&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span>{{- end }}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span>{{- if .IsNamedParams -}}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span>&amp;lt;&lt;span style="color:#ff79c6">a&lt;/span> &lt;span style="color:#50fa7b">target&lt;/span>&lt;span style="color:#ff79c6">=&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;_blank&amp;#34;&lt;/span> &lt;span style="color:#50fa7b">href&lt;/span>&lt;span style="color:#ff79c6">=&lt;/span>&lt;span style="color:#f1fa8c">{{&lt;/span> .&lt;span style="color:#50fa7b">Get&lt;/span> &amp;#34;&lt;span style="color:#50fa7b">url&lt;/span>&amp;#34; }} &lt;span style="color:#50fa7b">title&lt;/span>&lt;span style="color:#ff79c6">=&lt;/span>&lt;span style="color:#f1fa8c">{{&lt;/span> .&lt;span style="color:#50fa7b">Get&lt;/span> &amp;#34;&lt;span style="color:#50fa7b">name&lt;/span>&amp;#34; }} &lt;span style="color:#50fa7b">class&lt;/span>&lt;span style="color:#ff79c6">=&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;friendurl&amp;#34;&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span>&amp;lt;&lt;span style="color:#ff79c6">div&lt;/span> &lt;span style="color:#50fa7b">class&lt;/span>&lt;span style="color:#ff79c6">=&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;frienddiv&amp;#34;&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span> &amp;lt;&lt;span style="color:#ff79c6">div&lt;/span> &lt;span style="color:#50fa7b">class&lt;/span>&lt;span style="color:#ff79c6">=&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;frienddivleft&amp;#34;&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span> &amp;lt;&lt;span style="color:#ff79c6">img&lt;/span> &lt;span style="color:#50fa7b">class&lt;/span>&lt;span style="color:#ff79c6">=&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;myfriend&amp;#34;&lt;/span> &lt;span style="color:#50fa7b">src&lt;/span>&lt;span style="color:#ff79c6">=&lt;/span>&lt;span style="color:#f1fa8c">{{&lt;/span> .&lt;span style="color:#50fa7b">Get&lt;/span> &amp;#34;&lt;span style="color:#50fa7b">logo&lt;/span>&amp;#34; }} /&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span> &amp;lt;/&lt;span style="color:#ff79c6">div&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span> &amp;lt;&lt;span style="color:#ff79c6">div&lt;/span> &lt;span style="color:#50fa7b">class&lt;/span>&lt;span style="color:#ff79c6">=&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;frienddivright&amp;#34;&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15&lt;/span>&lt;span> &amp;lt;&lt;span style="color:#ff79c6">div&lt;/span> &lt;span style="color:#50fa7b">class&lt;/span>&lt;span style="color:#ff79c6">=&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;friendname&amp;#34;&lt;/span>&amp;gt;{{- .Get &amp;#34;name&amp;#34; -}}&amp;lt;/&lt;span style="color:#ff79c6">div&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16&lt;/span>&lt;span> &amp;lt;&lt;span style="color:#ff79c6">div&lt;/span> &lt;span style="color:#50fa7b">class&lt;/span>&lt;span style="color:#ff79c6">=&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;friendinfo&amp;#34;&lt;/span>&amp;gt;{{- .Get &amp;#34;word&amp;#34; -}}&amp;lt;/&lt;span style="color:#ff79c6">div&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17&lt;/span>&lt;span> &amp;lt;/&lt;span style="color:#ff79c6">div&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18&lt;/span>&lt;span>&amp;lt;/&lt;span style="color:#ff79c6">div&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19&lt;/span>&lt;span>&amp;lt;/&lt;span style="color:#ff79c6">a&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20&lt;/span>&lt;span>{{- end }}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿˜éœ€è¦åœ¨ &lt;strong>assets/extented&lt;/strong> ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª &lt;strong>blank.css&lt;/strong> æ–‡ä»¶ï¼Œç„¶ååœ¨ &lt;strong>blank.css&lt;/strong> æ–‡ä»¶ä¸­è‡ªå®šä¹‰å‹é“¾é¡µé¢çš„æ ·å¼ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-css" data-lang="css">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>.&lt;span style="color:#50fa7b">friendurl&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span> &lt;span style="color:#ff79c6">text-decoration&lt;/span>: &lt;span style="color:#ff79c6">none&lt;/span> &lt;span style="color:#ff79c6">!important&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span> &lt;span style="color:#ff79c6">color&lt;/span>: &lt;span style="color:#ff79c6">black&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span> &lt;span style="color:#ff79c6">box-shadow&lt;/span>: &lt;span style="color:#ff79c6">none&lt;/span> &lt;span style="color:#ff79c6">!important&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span>.&lt;span style="color:#50fa7b">myfriend&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span> &lt;span style="color:#ff79c6">width&lt;/span>: &lt;span style="color:#bd93f9">56&lt;/span>&lt;span style="color:#8be9fd">px&lt;/span> &lt;span style="color:#ff79c6">!important&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span> &lt;span style="color:#ff79c6">height&lt;/span>: &lt;span style="color:#bd93f9">56&lt;/span>&lt;span style="color:#8be9fd">px&lt;/span> &lt;span style="color:#ff79c6">!important&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 10&lt;/span>&lt;span> &lt;span style="color:#ff79c6">border-radius&lt;/span>: &lt;span style="color:#bd93f9">50&lt;/span>&lt;span style="color:#8be9fd">%&lt;/span>&lt;span style="color:#ff79c6">!important&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 11&lt;/span>&lt;span> &lt;span style="color:#ff79c6">padding&lt;/span>: &lt;span style="color:#bd93f9">2&lt;/span>&lt;span style="color:#8be9fd">px&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 12&lt;/span>&lt;span> &lt;span style="color:#ff79c6">margin-top&lt;/span>: &lt;span style="color:#bd93f9">20&lt;/span>&lt;span style="color:#8be9fd">px&lt;/span> &lt;span style="color:#ff79c6">!important&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 13&lt;/span>&lt;span> &lt;span style="color:#ff79c6">margin-left&lt;/span>: &lt;span style="color:#bd93f9">14&lt;/span>&lt;span style="color:#8be9fd">px&lt;/span> &lt;span style="color:#ff79c6">!important&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 14&lt;/span>&lt;span> &lt;span style="color:#ff79c6">background-color&lt;/span>: &lt;span style="color:#bd93f9">#fff&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 15&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 16&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 17&lt;/span>&lt;span>.&lt;span style="color:#50fa7b">frienddiv&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 18&lt;/span>&lt;span> &lt;span style="color:#ff79c6">overflow&lt;/span>: &lt;span style="color:#ff79c6">auto&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 19&lt;/span>&lt;span> &lt;span style="color:#ff79c6">height&lt;/span>: &lt;span style="color:#bd93f9">100&lt;/span>&lt;span style="color:#8be9fd">px&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 20&lt;/span>&lt;span> &lt;span style="color:#ff79c6">width&lt;/span>: &lt;span style="color:#bd93f9">49&lt;/span>&lt;span style="color:#8be9fd">%&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 21&lt;/span>&lt;span> &lt;span style="color:#ff79c6">display&lt;/span>: &lt;span style="color:#ff79c6">inline-block&lt;/span> &lt;span style="color:#ff79c6">!important&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 22&lt;/span>&lt;span> &lt;span style="color:#ff79c6">border-radius&lt;/span>: &lt;span style="color:#bd93f9">5&lt;/span>&lt;span style="color:#8be9fd">px&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 23&lt;/span>&lt;span> &lt;span style="color:#ff79c6">background&lt;/span>: &lt;span style="color:#ff79c6">none&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 24&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 25&lt;/span>&lt;span> &lt;span style="color:#ff79c6">-webkit-&lt;/span>&lt;span style="color:#ff79c6">transition&lt;/span>: &lt;span style="color:#ff79c6">all&lt;/span> &lt;span style="color:#ff79c6">ease-out&lt;/span> &lt;span style="color:#bd93f9">0.3&lt;/span>&lt;span style="color:#8be9fd">s&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 26&lt;/span>&lt;span> &lt;span style="color:#ff79c6">-moz-&lt;/span>&lt;span style="color:#ff79c6">transition&lt;/span>: &lt;span style="color:#ff79c6">all&lt;/span> &lt;span style="color:#ff79c6">ease-out&lt;/span> &lt;span style="color:#bd93f9">0.3&lt;/span>&lt;span style="color:#8be9fd">s&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 27&lt;/span>&lt;span> &lt;span style="color:#ff79c6">-o-&lt;/span>&lt;span style="color:#ff79c6">transition&lt;/span>: &lt;span style="color:#ff79c6">all&lt;/span> &lt;span style="color:#ff79c6">ease-out&lt;/span> &lt;span style="color:#bd93f9">0.3&lt;/span>&lt;span style="color:#8be9fd">s&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 28&lt;/span>&lt;span> &lt;span style="color:#ff79c6">transition&lt;/span>: &lt;span style="color:#ff79c6">all&lt;/span> &lt;span style="color:#ff79c6">ease-out&lt;/span> &lt;span style="color:#bd93f9">0.3&lt;/span>&lt;span style="color:#8be9fd">s&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 29&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 30&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 31&lt;/span>&lt;span>.&lt;span style="color:#50fa7b">dark&lt;/span> .&lt;span style="color:#50fa7b">frienddiv&lt;/span>:hover {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 32&lt;/span>&lt;span> &lt;span style="color:#ff79c6">background&lt;/span>: &lt;span style="color:#50fa7b">var&lt;/span>(&lt;span style="color:#ff79c6">--&lt;/span>code&lt;span style="color:#ff79c6">-&lt;/span>bg);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 33&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 34&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 35&lt;/span>&lt;span>.&lt;span style="color:#50fa7b">frienddiv&lt;/span>:hover {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 36&lt;/span>&lt;span> &lt;span style="color:#ff79c6">background&lt;/span>: &lt;span style="color:#50fa7b">var&lt;/span>(&lt;span style="color:#ff79c6">--&lt;/span>theme);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 37&lt;/span>&lt;span> &lt;span style="color:#ff79c6">transition&lt;/span>: &lt;span style="color:#ff79c6">transform&lt;/span> &lt;span style="color:#bd93f9">1&lt;/span>&lt;span style="color:#8be9fd">s&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 38&lt;/span>&lt;span> webkit-transform: &lt;span style="color:#8be9fd;font-style:italic">scale&lt;/span>(&lt;span style="color:#bd93f9">1.1&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 39&lt;/span>&lt;span> &lt;span style="color:#ff79c6">-moz-&lt;/span>&lt;span style="color:#ff79c6">transform&lt;/span>: &lt;span style="color:#8be9fd;font-style:italic">scale&lt;/span>(&lt;span style="color:#bd93f9">1.2&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 40&lt;/span>&lt;span> &lt;span style="color:#ff79c6">-ms-&lt;/span>&lt;span style="color:#ff79c6">transform&lt;/span>: &lt;span style="color:#8be9fd;font-style:italic">scale&lt;/span>(&lt;span style="color:#bd93f9">1.2&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 41&lt;/span>&lt;span> &lt;span style="color:#ff79c6">-o-&lt;/span>&lt;span style="color:#ff79c6">transform&lt;/span>: &lt;span style="color:#8be9fd;font-style:italic">scale&lt;/span>(&lt;span style="color:#bd93f9">1.2&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 42&lt;/span>&lt;span> &lt;span style="color:#ff79c6">transform&lt;/span>: &lt;span style="color:#8be9fd;font-style:italic">scale&lt;/span>(&lt;span style="color:#bd93f9">1.1&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 43&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 44&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 45&lt;/span>&lt;span>.&lt;span style="color:#50fa7b">frienddiv&lt;/span>:hover .&lt;span style="color:#50fa7b">frienddivleft&lt;/span> &lt;span style="color:#ff79c6">img&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 46&lt;/span>&lt;span> &lt;span style="color:#ff79c6">transition&lt;/span>: &lt;span style="color:#bd93f9">0.9&lt;/span>&lt;span style="color:#8be9fd">s&lt;/span> &lt;span style="color:#ff79c6">!important&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 47&lt;/span>&lt;span> &lt;span style="color:#ff79c6">-webkit-&lt;/span>&lt;span style="color:#ff79c6">transition&lt;/span>: &lt;span style="color:#bd93f9">0.9&lt;/span>&lt;span style="color:#8be9fd">s&lt;/span> &lt;span style="color:#ff79c6">!important&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 48&lt;/span>&lt;span> &lt;span style="color:#ff79c6">-moz-&lt;/span>&lt;span style="color:#ff79c6">transition&lt;/span>: &lt;span style="color:#bd93f9">0.9&lt;/span>&lt;span style="color:#8be9fd">s&lt;/span> &lt;span style="color:#ff79c6">!important&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 49&lt;/span>&lt;span> &lt;span style="color:#ff79c6">-o-&lt;/span>&lt;span style="color:#ff79c6">transition&lt;/span>: &lt;span style="color:#bd93f9">0.9&lt;/span>&lt;span style="color:#8be9fd">s&lt;/span> &lt;span style="color:#ff79c6">!important&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 50&lt;/span>&lt;span> &lt;span style="color:#ff79c6">-ms-&lt;/span>&lt;span style="color:#ff79c6">transition&lt;/span>: &lt;span style="color:#bd93f9">0.9&lt;/span>&lt;span style="color:#8be9fd">s&lt;/span> &lt;span style="color:#ff79c6">!important&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 51&lt;/span>&lt;span> &lt;span style="color:#ff79c6">transform&lt;/span>: &lt;span style="color:#8be9fd;font-style:italic">rotate&lt;/span>(&lt;span style="color:#bd93f9">360&lt;/span>&lt;span style="color:#8be9fd">deg&lt;/span>) &lt;span style="color:#ff79c6">!important&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 52&lt;/span>&lt;span> &lt;span style="color:#ff79c6">-webkit-&lt;/span>&lt;span style="color:#ff79c6">transform&lt;/span>: &lt;span style="color:#8be9fd;font-style:italic">rotate&lt;/span>(&lt;span style="color:#bd93f9">360&lt;/span>&lt;span style="color:#8be9fd">deg&lt;/span>) &lt;span style="color:#ff79c6">!important&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 53&lt;/span>&lt;span> &lt;span style="color:#ff79c6">-moz-&lt;/span>&lt;span style="color:#ff79c6">transform&lt;/span>: &lt;span style="color:#8be9fd;font-style:italic">rotate&lt;/span>(&lt;span style="color:#bd93f9">360&lt;/span>&lt;span style="color:#8be9fd">deg&lt;/span>) &lt;span style="color:#ff79c6">!important&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 54&lt;/span>&lt;span> &lt;span style="color:#ff79c6">-o-&lt;/span>&lt;span style="color:#ff79c6">transform&lt;/span>: &lt;span style="color:#8be9fd;font-style:italic">rotate&lt;/span>(&lt;span style="color:#bd93f9">360&lt;/span>&lt;span style="color:#8be9fd">deg&lt;/span>) &lt;span style="color:#ff79c6">!important&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 55&lt;/span>&lt;span> &lt;span style="color:#ff79c6">-ms-&lt;/span>&lt;span style="color:#ff79c6">transform&lt;/span>: &lt;span style="color:#8be9fd;font-style:italic">rotate&lt;/span>(&lt;span style="color:#bd93f9">360&lt;/span>&lt;span style="color:#8be9fd">deg&lt;/span>) &lt;span style="color:#ff79c6">!important&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 56&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 57&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 58&lt;/span>&lt;span>.&lt;span style="color:#50fa7b">frienddivleft&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 59&lt;/span>&lt;span> &lt;span style="color:#ff79c6">width&lt;/span>: &lt;span style="color:#bd93f9">92&lt;/span>&lt;span style="color:#8be9fd">px&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 60&lt;/span>&lt;span> &lt;span style="color:#ff79c6">float&lt;/span>: &lt;span style="color:#ff79c6">left&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 61&lt;/span>&lt;span> &lt;span style="color:#ff79c6">margin-right&lt;/span>: &lt;span style="color:#bd93f9">-5&lt;/span>&lt;span style="color:#8be9fd">px&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 62&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 63&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 64&lt;/span>&lt;span>.&lt;span style="color:#50fa7b">frienddivright&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 65&lt;/span>&lt;span> &lt;span style="color:#ff79c6">margin-top&lt;/span>: &lt;span style="color:#bd93f9">18&lt;/span>&lt;span style="color:#8be9fd">px&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 66&lt;/span>&lt;span> &lt;span style="color:#ff79c6">margin-right&lt;/span>: &lt;span style="color:#bd93f9">18&lt;/span>&lt;span style="color:#8be9fd">px&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 67&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 68&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 69&lt;/span>&lt;span>.&lt;span style="color:#50fa7b">friendname&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 70&lt;/span>&lt;span> &lt;span style="color:#ff79c6">text-overflow&lt;/span>: &lt;span style="color:#ff79c6">ellipsis&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 71&lt;/span>&lt;span> &lt;span style="color:#ff79c6">font-size&lt;/span>: &lt;span style="color:#bd93f9">100&lt;/span>&lt;span style="color:#8be9fd">%&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 72&lt;/span>&lt;span> &lt;span style="color:#ff79c6">margin-bottom&lt;/span>: &lt;span style="color:#bd93f9">5&lt;/span>&lt;span style="color:#8be9fd">px&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 73&lt;/span>&lt;span> &lt;span style="color:#ff79c6">color&lt;/span>: &lt;span style="color:#50fa7b">var&lt;/span>(&lt;span style="color:#ff79c6">--&lt;/span>primary);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 74&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 75&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 76&lt;/span>&lt;span>.&lt;span style="color:#50fa7b">friendinfo&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 77&lt;/span>&lt;span> &lt;span style="color:#ff79c6">text-overflow&lt;/span>: &lt;span style="color:#ff79c6">ellipsis&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 78&lt;/span>&lt;span> &lt;span style="color:#ff79c6">font-size&lt;/span>: &lt;span style="color:#bd93f9">70&lt;/span>&lt;span style="color:#8be9fd">%&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 79&lt;/span>&lt;span> &lt;span style="color:#ff79c6">color&lt;/span>: &lt;span style="color:#50fa7b">var&lt;/span>(&lt;span style="color:#ff79c6">--&lt;/span>primary);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 80&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 81&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 82&lt;/span>&lt;span>@&lt;span style="color:#ff79c6">media&lt;/span> &lt;span style="color:#ff79c6">screen&lt;/span> &lt;span style="color:#ff79c6">and&lt;/span> &lt;span style="color:#ff79c6">(&lt;/span>&lt;span style="color:#ff79c6">max-width&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#ff79c6">600px&lt;/span>&lt;span style="color:#ff79c6">)&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 83&lt;/span>&lt;span> .&lt;span style="color:#50fa7b">friendinfo&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 84&lt;/span>&lt;span> &lt;span style="color:#ff79c6">display&lt;/span>: &lt;span style="color:#ff79c6">none&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 85&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 86&lt;/span>&lt;span> .&lt;span style="color:#50fa7b">frienddivleft&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 87&lt;/span>&lt;span> &lt;span style="color:#ff79c6">width&lt;/span>: &lt;span style="color:#bd93f9">84&lt;/span>&lt;span style="color:#8be9fd">px&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 88&lt;/span>&lt;span> &lt;span style="color:#ff79c6">margin&lt;/span>: &lt;span style="color:#ff79c6">auto&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 89&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 90&lt;/span>&lt;span> .&lt;span style="color:#50fa7b">frienddivright&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 91&lt;/span>&lt;span> &lt;span style="color:#ff79c6">height&lt;/span>: &lt;span style="color:#bd93f9">100&lt;/span>&lt;span style="color:#8be9fd">%&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 92&lt;/span>&lt;span> &lt;span style="color:#ff79c6">margin&lt;/span>: &lt;span style="color:#ff79c6">auto&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 93&lt;/span>&lt;span> &lt;span style="color:#ff79c6">display&lt;/span>: &lt;span style="color:#ff79c6">flex&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 94&lt;/span>&lt;span> &lt;span style="color:#ff79c6">align-items&lt;/span>: &lt;span style="color:#ff79c6">center&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 95&lt;/span>&lt;span> &lt;span style="color:#ff79c6">justify-content&lt;/span>: &lt;span style="color:#ff79c6">center&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 96&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 97&lt;/span>&lt;span> .&lt;span style="color:#50fa7b">friendname&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 98&lt;/span>&lt;span> &lt;span style="color:#ff79c6">font-size&lt;/span>: &lt;span style="color:#bd93f9">18&lt;/span>&lt;span style="color:#8be9fd">px&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 99&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">100&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>åˆ°è¿™ï¼Œå‹é“¾é¡µé¢çš„æ¨¡æ¿å°±å®Œæˆäº†ï¼Œç„¶ååœ¨ &lt;strong>content&lt;/strong> ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª &lt;strong>friends/index.md&lt;/strong> æ–‡ä»¶ï¼Œç„¶ååœ¨ &lt;strong>index.md&lt;/strong> æ–‡ä»¶ä¸­é…ç½®&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-md" data-lang="md">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>---
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span>type: friend
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span>hiddenFromSearch: true
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span>readingTime: false
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span>license: false
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span>title: å‹é“¾
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span>contentEnd: false
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span>toc: false
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span>image: &amp;#34;https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/54de3f8d81a4f97fb1ac4dc06eaf3fda335a5937.webp&amp;#34;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span>---
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>friend.md çš„å†…å®¹å¦‚ä¸‹ï¼Œå› ä¸ºç›´æ¥å†™å…¥è¿™æ®µæ–‡å­—ï¼Œä¼šè¢«è§£æï¼Œæ‰€ä»¥è¿™é‡Œå°±ä¸å†™äº†ï¼Œä½¿ç”¨å›¾ç‰‡äº†&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/5424d70d34009aa07d1e4db170580cbc3040835a.jpg">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/5424d70d34009aa07d1e4db170580cbc3040835a.jpg" alt="" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>è¿™æ ·å‹é“¾é¡µé¢å°±å®Œæˆäº†ï¼Œåœ¨æ„å»ºçš„æ—¶å€™ï¼Œå‹é“¾é¡µé¢ä¼šè‡ªåŠ¨ç”Ÿæˆã€‚&lt;/p>
&lt;h3 id="æ·»åŠ é˜…è¯»è¿›åº¦æ¡">&lt;a href="#%e6%b7%bb%e5%8a%a0%e9%98%85%e8%af%bb%e8%bf%9b%e5%ba%a6%e6%9d%a1" class="header-anchor">&lt;/a>æ·»åŠ é˜…è¯»è¿›åº¦æ¡
&lt;/h3>&lt;p>åœ¨é¡µé¢é¡¶éƒ¨åŠ ä¸€ä¸ªé˜…è¯»è¿›åº¦æ¡ï¼Œå³å®ç”¨åˆç¾è§‚ã€‚åœ¨ &lt;strong>layouts/partials&lt;/strong> ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª &lt;strong>readingbar.html&lt;/strong> æ–‡ä»¶ï¼Œç„¶ååœ¨ &lt;strong>readingbar.html&lt;/strong> æ–‡ä»¶ä¸­é…ç½®&lt;/p>
&lt;p>åœ¨ &lt;strong>layouts/partials/head/&lt;/strong> ç›®å½•ä¸‹çš„ &lt;strong>custom.html&lt;/strong> ä¸­ æ·»åŠ  è¿™æ®µä»£ç &lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-html" data-lang="html">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>{{ if strings.HasPrefix .RelPermalink &amp;#34;/posts/&amp;#34; }}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span>&amp;lt;&lt;span style="color:#ff79c6">div&lt;/span> &lt;span style="color:#50fa7b">class&lt;/span>&lt;span style="color:#ff79c6">=&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;top-scroll-bar&amp;#34;&lt;/span>&amp;gt;&amp;lt;/&lt;span style="color:#ff79c6">div&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span>&amp;lt;&lt;span style="color:#ff79c6">style&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span> .&lt;span style="color:#50fa7b">top-scroll-bar&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span> &lt;span style="color:#ff79c6">position&lt;/span>: &lt;span style="color:#ff79c6">fixed&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span> &lt;span style="color:#ff79c6">top&lt;/span>: &lt;span style="color:#bd93f9">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span> &lt;span style="color:#ff79c6">left&lt;/span>: &lt;span style="color:#bd93f9">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span> &lt;span style="color:#ff79c6">z-index&lt;/span>: &lt;span style="color:#bd93f9">9999&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span> &lt;span style="color:#ff79c6">display&lt;/span>: &lt;span style="color:#ff79c6">none&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span> &lt;span style="color:#ff79c6">width&lt;/span>: &lt;span style="color:#bd93f9">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span> &lt;span style="color:#ff79c6">height&lt;/span>: &lt;span style="color:#bd93f9">3&lt;/span>&lt;span style="color:#8be9fd">px&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span> &lt;span style="color:#ff79c6">background&lt;/span>: &lt;span style="color:#bd93f9">#ef3982&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span>&amp;lt;/&lt;span style="color:#ff79c6">style&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16&lt;/span>&lt;span>&amp;lt;&lt;span style="color:#ff79c6">script&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17&lt;/span>&lt;span> $(&lt;span style="color:#8be9fd;font-style:italic">document&lt;/span>).ready(&lt;span style="color:#8be9fd;font-style:italic">function&lt;/span> () {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18&lt;/span>&lt;span> $(&lt;span style="color:#8be9fd;font-style:italic">window&lt;/span>).scroll(&lt;span style="color:#8be9fd;font-style:italic">function&lt;/span>(){
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19&lt;/span>&lt;span> $(&lt;span style="color:#f1fa8c">&amp;#34;.top-scroll-bar&amp;#34;&lt;/span>).attr(&lt;span style="color:#f1fa8c">&amp;#34;style&amp;#34;&lt;/span>, &lt;span style="color:#f1fa8c">&amp;#34;width: &amp;#34;&lt;/span> &lt;span style="color:#ff79c6">+&lt;/span> ($(&lt;span style="color:#ff79c6">this&lt;/span>).scrollTop() &lt;span style="color:#ff79c6">/&lt;/span> ($(&lt;span style="color:#8be9fd;font-style:italic">document&lt;/span>).height() &lt;span style="color:#ff79c6">-&lt;/span> $(&lt;span style="color:#ff79c6">this&lt;/span>).height()) &lt;span style="color:#ff79c6">*&lt;/span> &lt;span style="color:#bd93f9">100&lt;/span>) &lt;span style="color:#ff79c6">+&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;%; display: block;&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20&lt;/span>&lt;span> });
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21&lt;/span>&lt;span> });
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22&lt;/span>&lt;span>&amp;lt;/&lt;span style="color:#ff79c6">script&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23&lt;/span>&lt;span>{{ end }}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¯´ä¸€ä¸‹è¿™ä¸ª &lt;strong>readingbar.html&lt;/strong> æ–‡ä»¶ï¼Œçœ‹åå­—å°±çŸ¥é“ï¼Œè¿™ä¸ªæ–‡ä»¶æ˜¯ &lt;strong>Hugo&lt;/strong> å…è®¸æˆ‘ä»¬è‡ªå®šä¹‰ ç”Ÿæˆ &lt;strong>HTML&lt;/strong> ä¸­ &lt;strong>head&lt;/strong> éƒ¨åˆ†çš„å†…å®¹ã€‚
Hugo åœ¨æ„å»ºçš„æ—¶å€™ï¼Œä¼šè‡ªåŠ¨åŠ è½½è¿™ä¸ªæ–‡ä»¶ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥åœ¨è¿™ä¸ªæ–‡ä»¶ä¸­æ·»åŠ ä¸€äº› &lt;strong>HTML&lt;/strong> ä»£ç ï¼Œæ¯”å¦‚ &lt;strong>CSS&lt;/strong>ã€&lt;strong>JS&lt;/strong> ç­‰ã€‚&lt;/p>
&lt;h3 id="æ·»åŠ è¿”å›é¡¶éƒ¨æŒ‰é’®">&lt;a href="#%e6%b7%bb%e5%8a%a0%e8%bf%94%e5%9b%9e%e9%a1%b6%e9%83%a8%e6%8c%89%e9%92%ae" class="header-anchor">&lt;/a>æ·»åŠ è¿”å›é¡¶éƒ¨æŒ‰é’®
&lt;/h3>&lt;p>åœ¨ &lt;strong>custom.html&lt;/strong> æ–‡ä»¶ä¸­æ·»åŠ è¿™æ®µä»£ç &lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-html" data-lang="html">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&amp;lt;&lt;span style="color:#ff79c6">div&lt;/span> &lt;span style="color:#50fa7b">id&lt;/span>&lt;span style="color:#ff79c6">=&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;back-top&amp;#34;&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span> &amp;lt;&lt;span style="color:#ff79c6">a&lt;/span> &lt;span style="color:#50fa7b">href&lt;/span>&lt;span style="color:#ff79c6">=&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;#top&amp;#34;&lt;/span> &lt;span style="color:#50fa7b">title&lt;/span>&lt;span style="color:#ff79c6">=&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;å›åˆ°é¡¶éƒ¨&amp;#34;&lt;/span>&amp;gt;&amp;lt;/&lt;span style="color:#ff79c6">a&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span>&amp;lt;/&lt;span style="color:#ff79c6">div&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span>&amp;lt;&lt;span style="color:#ff79c6">style&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span> #back-top {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span> &lt;span style="color:#ff79c6">position&lt;/span>: &lt;span style="color:#ff79c6">fixed&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span> &lt;span style="color:#ff79c6">bottom&lt;/span>: &lt;span style="color:#bd93f9">30&lt;/span>&lt;span style="color:#8be9fd">px&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span> &lt;span style="color:#ff79c6">right&lt;/span>: &lt;span style="color:#bd93f9">80&lt;/span>&lt;span style="color:#8be9fd">px&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span> #back-top &lt;span style="color:#ff79c6">a&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span> &lt;span style="color:#ff79c6">width&lt;/span>: &lt;span style="color:#bd93f9">54&lt;/span>&lt;span style="color:#8be9fd">px&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span> &lt;span style="color:#ff79c6">height&lt;/span>: &lt;span style="color:#bd93f9">54&lt;/span>&lt;span style="color:#8be9fd">px&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span> &lt;span style="color:#ff79c6">display&lt;/span>: &lt;span style="color:#ff79c6">block&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span> &lt;span style="color:#ff79c6">background&lt;/span>: &lt;span style="color:#bd93f9">#ddd&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">url&lt;/span>(&lt;span style="color:#f1fa8c">/images/back_top.svg&lt;/span>) &lt;span style="color:#ff79c6">no-repeat&lt;/span> &lt;span style="color:#ff79c6">center&lt;/span> &lt;span style="color:#ff79c6">center&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15&lt;/span>&lt;span> &lt;span style="color:#ff79c6">background-color&lt;/span>: &lt;span style="color:#8be9fd;font-style:italic">rgba&lt;/span>(&lt;span style="color:#bd93f9">218&lt;/span>, &lt;span style="color:#bd93f9">214&lt;/span>, &lt;span style="color:#bd93f9">214&lt;/span>, &lt;span style="color:#bd93f9">0.87&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16&lt;/span>&lt;span> &lt;span style="color:#ff79c6">-webkit-&lt;/span>&lt;span style="color:#ff79c6">border-radius&lt;/span>: &lt;span style="color:#bd93f9">7&lt;/span>&lt;span style="color:#8be9fd">px&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17&lt;/span>&lt;span> &lt;span style="color:#ff79c6">-moz-&lt;/span>&lt;span style="color:#ff79c6">border-radius&lt;/span>: &lt;span style="color:#bd93f9">7&lt;/span>&lt;span style="color:#8be9fd">px&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18&lt;/span>&lt;span> &lt;span style="color:#ff79c6">border-radius&lt;/span>: &lt;span style="color:#bd93f9">7&lt;/span>&lt;span style="color:#8be9fd">px&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19&lt;/span>&lt;span> &lt;span style="color:#ff79c6">-webkit-&lt;/span>&lt;span style="color:#ff79c6">transition&lt;/span>: &lt;span style="color:#bd93f9">1&lt;/span>&lt;span style="color:#8be9fd">s&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20&lt;/span>&lt;span> &lt;span style="color:#ff79c6">-moz-&lt;/span>&lt;span style="color:#ff79c6">transition&lt;/span>: &lt;span style="color:#bd93f9">1&lt;/span>&lt;span style="color:#8be9fd">s&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21&lt;/span>&lt;span> &lt;span style="color:#ff79c6">transition&lt;/span>: &lt;span style="color:#bd93f9">1&lt;/span>&lt;span style="color:#8be9fd">s&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23&lt;/span>&lt;span> #back-top &lt;span style="color:#ff79c6">a&lt;/span>:hover {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24&lt;/span>&lt;span> &lt;span style="color:#ff79c6">background-color&lt;/span>: &lt;span style="color:#bd93f9">#e88282&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26&lt;/span>&lt;span>&amp;lt;/&lt;span style="color:#ff79c6">style&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28&lt;/span>&lt;span>&amp;lt;&lt;span style="color:#ff79c6">script&lt;/span> &lt;span style="color:#50fa7b">type&lt;/span>&lt;span style="color:#ff79c6">=&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;text/javascript&amp;#34;&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29&lt;/span>&lt;span> $(&lt;span style="color:#f1fa8c">&amp;#34;#back-top&amp;#34;&lt;/span>).hide();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30&lt;/span>&lt;span> $(&lt;span style="color:#8be9fd;font-style:italic">document&lt;/span>).ready(&lt;span style="color:#8be9fd;font-style:italic">function&lt;/span> () {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31&lt;/span>&lt;span> $(&lt;span style="color:#8be9fd;font-style:italic">window&lt;/span>).scroll(&lt;span style="color:#8be9fd;font-style:italic">function&lt;/span> () {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> ($(&lt;span style="color:#ff79c6">this&lt;/span>).scrollTop() &lt;span style="color:#ff79c6">&amp;gt;&lt;/span> &lt;span style="color:#bd93f9">100&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33&lt;/span>&lt;span> $(&lt;span style="color:#f1fa8c">&amp;#39;#back-top&amp;#39;&lt;/span>).fadeIn();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34&lt;/span>&lt;span> } &lt;span style="color:#ff79c6">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35&lt;/span>&lt;span> $(&lt;span style="color:#f1fa8c">&amp;#39;#back-top&amp;#39;&lt;/span>).fadeOut();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37&lt;/span>&lt;span> });
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38&lt;/span>&lt;span> $(&lt;span style="color:#f1fa8c">&amp;#39;#back-top a&amp;#39;&lt;/span>).click(&lt;span style="color:#8be9fd;font-style:italic">function&lt;/span> () {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39&lt;/span>&lt;span> $(&lt;span style="color:#f1fa8c">&amp;#39;body,html&amp;#39;&lt;/span>).animate({
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40&lt;/span>&lt;span> scrollTop&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41&lt;/span>&lt;span> }, &lt;span style="color:#bd93f9">800&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> &lt;span style="color:#ff79c6">false&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43&lt;/span>&lt;span> });
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44&lt;/span>&lt;span> });
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45&lt;/span>&lt;span>&amp;lt;/&lt;span style="color:#ff79c6">script&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="å›¾ç‰‡ç¯ç®±æ•ˆæœ">&lt;a href="#%e5%9b%be%e7%89%87%e7%81%af%e7%ae%b1%e6%95%88%e6%9e%9c" class="header-anchor">&lt;/a>å›¾ç‰‡ç¯ç®±æ•ˆæœ
&lt;/h3>&lt;p>Hugo è‡ªå¸¦çš„å›¾ç‰‡æ¸²æŸ“æ˜¯æ²¡æœ‰ç¯ç®±æ•ˆæœçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦è‡ªå·±æ·»åŠ ã€‚ç¯ç®±æ•ˆæœå°±æ˜¯ç‚¹å‡»å›¾ç‰‡åï¼Œå›¾ç‰‡ä¼šæ”¾å¤§æ˜¾ç¤ºã€‚&lt;/p>
&lt;p>è¿˜æ˜¯åœ¨ &lt;strong>custom.html&lt;/strong> æ–‡ä»¶ä¸­æ·»åŠ è¿™æ®µä»£ç &lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-html" data-lang="html">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>{{if .Page.Site.Params.fancybox }}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span>&amp;lt;&lt;span style="color:#ff79c6">script&lt;/span> &lt;span style="color:#50fa7b">src&lt;/span>&lt;span style="color:#ff79c6">=&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js&amp;#34;&lt;/span>&amp;gt;&amp;lt;/&lt;span style="color:#ff79c6">script&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3&lt;/span>&lt;span>&amp;lt;&lt;span style="color:#ff79c6">link&lt;/span> &lt;span style="color:#50fa7b">rel&lt;/span>&lt;span style="color:#ff79c6">=&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;stylesheet&amp;#34;&lt;/span> &lt;span style="color:#50fa7b">href&lt;/span>&lt;span style="color:#ff79c6">=&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css&amp;#34;&lt;/span> /&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4&lt;/span>&lt;span>&amp;lt;&lt;span style="color:#ff79c6">script&lt;/span> &lt;span style="color:#50fa7b">src&lt;/span>&lt;span style="color:#ff79c6">=&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js&amp;#34;&lt;/span>&amp;gt;&amp;lt;/&lt;span style="color:#ff79c6">script&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5&lt;/span>&lt;span>{{ end }}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ç„¶ååœ¨ &lt;strong>layouts/_default&lt;/strong> ç›®å½•ä¸‹ æ–°å»º &lt;strong>render-image.html&lt;/strong>æ–‡ä»¶ï¼Œç„¶ååœ¨ &lt;strong>render-image.html&lt;/strong> æ–‡ä»¶ä¸­é…ç½®&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-html" data-lang="html">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>&amp;lt;&lt;span style="color:#ff79c6">div&lt;/span> &lt;span style="color:#50fa7b">class&lt;/span>&lt;span style="color:#ff79c6">=&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;post-img-view&amp;#34;&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span> &amp;lt;&lt;span style="color:#ff79c6">a&lt;/span> &lt;span style="color:#50fa7b">data-fancybox&lt;/span>&lt;span style="color:#ff79c6">=&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;gallery&amp;#34;&lt;/span> &lt;span style="color:#50fa7b">href&lt;/span>&lt;span style="color:#ff79c6">=&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;{{ .Destination | safeURL }}&amp;#34;&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3&lt;/span>&lt;span> &amp;lt;&lt;span style="color:#ff79c6">img&lt;/span> &lt;span style="color:#50fa7b">src&lt;/span>&lt;span style="color:#ff79c6">=&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;{{ .Destination | safeURL }}&amp;#34;&lt;/span> &lt;span style="color:#50fa7b">alt&lt;/span>&lt;span style="color:#ff79c6">=&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;{{ .Text }}&amp;#34;&lt;/span> {{ &lt;span style="color:#50fa7b">with&lt;/span> .&lt;span style="color:#50fa7b">Title&lt;/span>}} &lt;span style="color:#50fa7b">title&lt;/span>&lt;span style="color:#ff79c6">=&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;{{ . }}&amp;#34;&lt;/span>{{ &lt;span style="color:#50fa7b">end&lt;/span> }} /&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4&lt;/span>&lt;span> &amp;lt;/&lt;span style="color:#ff79c6">a&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5&lt;/span>&lt;span>&amp;lt;/&lt;span style="color:#ff79c6">div&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™æ®µä»£ç çš„ä½œç”¨æ˜¯æ›¿æ¢ &lt;strong>Hugo&lt;/strong> é»˜è®¤çš„å›¾ç‰‡æ¸²æŸ“ï¼Œè¿™æ ·å°±å¯ä»¥å®ç°ç‚¹å‡»å›¾ç‰‡æ”¾å¤§æ˜¾ç¤ºçš„æ•ˆæœäº†ã€‚&lt;/p>
&lt;h3 id="ä¿®æ”¹åˆ—è¡¨æ¸²æŸ“æ ·å¼">&lt;a href="#%e4%bf%ae%e6%94%b9%e5%88%97%e8%a1%a8%e6%b8%b2%e6%9f%93%e6%a0%b7%e5%bc%8f" class="header-anchor">&lt;/a>ä¿®æ”¹åˆ—è¡¨æ¸²æŸ“æ ·å¼
&lt;/h3>&lt;p>æˆ‘ä½¿ç”¨çš„ &lt;strong>Stack&lt;/strong> ä¸»é¢˜ï¼Œåœ¨ç»™ &lt;strong>homepage&lt;/strong> æ·»åŠ äº† &lt;strong>Widget&lt;/strong> åï¼Œé™¤äº†ä¸»é¡µçš„æ–‡ç« åˆ—è¡¨æ˜¾ç¤ºäº†ï¼Œ &lt;strong>æ ‡ç­¾&lt;/strong>ã€&lt;strong>åˆ†ç±»&lt;/strong> ä¹Ÿæ˜¾ç¤ºäº†ã€‚&lt;/p>
&lt;p>è¿™ä¸æ˜¯æˆ‘æƒ³è¦çš„ï¼Œæˆ‘åªæƒ³åœ¨ä¸»é¡µæ˜¾ç¤ºæ–‡ç« åˆ—è¡¨ï¼Œæ‰€ä»¥éœ€è¦ä¿®æ”¹ä¸€ä¸‹ &lt;strong>layouts/_default&lt;/strong> ç›®å½•ä¸‹çš„ &lt;strong>my_list.html&lt;/strong> æ–‡ä»¶ã€‚
ç„¶åæŠŠ &lt;strong>Stack&lt;/strong> ä¸»é¢˜ä¸­çš„ &lt;strong>layouts/_default/list.html&lt;/strong> æ–‡ä»¶å¤åˆ¶åˆ° é¡¹ç›®çš„&lt;strong>layouts/_default&lt;/strong> ç›®å½•ä¸‹ï¼Œç„¶åä¿®æ”¹ &lt;strong>my_list.html&lt;/strong> æ–‡ä»¶ä¸­çš„å†…å®¹ã€‚&lt;/p>
&lt;p>æŠŠæœ€åé¢é‚£æ®µä»£ç åˆ é™¤å°±è¡Œäº†ã€‚ä¹Ÿå°±æ˜¯ä¸‹é¢è¿™æ®µä»£ç &lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-html" data-lang="html">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>{{ define &amp;#34;right-sidebar&amp;#34; }}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span>{{ partial &amp;#34;sidebar/right.html&amp;#34; (dict &amp;#34;Context&amp;#34; . &amp;#34;Scope&amp;#34; &amp;#34;homepage&amp;#34;) }}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3&lt;/span>&lt;span>{{ end }}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ç„¶ååœ¨æƒ³ä½¿ç”¨è¿™ä¸ªæ¨¡æ¿çš„é¡µé¢ä¸­ï¼ŒæŠŠ &lt;code>layout&lt;/code> æ”¹æˆ &lt;code>my_list&lt;/code> å°±è¡Œäº†ã€‚&lt;/p>
&lt;p>æ¯”å¦‚ &lt;strong>content/categories/_index.md&lt;/strong> æ–‡ä»¶ä¸­çš„é…ç½®&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>---
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span>&lt;span style="color:#ff79c6">title&lt;/span>: &lt;span style="color:#f1fa8c">&amp;#34;åˆ†ç±»&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3&lt;/span>&lt;span>&lt;span style="color:#ff79c6">contentEnd&lt;/span>: &lt;span style="color:#ff79c6">false&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4&lt;/span>&lt;span>&lt;span style="color:#ff79c6">license&lt;/span>: &lt;span style="color:#ff79c6">false&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5&lt;/span>&lt;span>&lt;span style="color:#ff79c6">layout&lt;/span>: my_list
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6&lt;/span>&lt;span>---
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å…¶å®è¿™ç»™æˆ‘ä»¬æä¾›äº†ä¸€ä¸ªæ€è·¯ï¼Œå°±æ˜¯ &lt;strong>Hugo&lt;/strong> çš„æ¨¡æ¿æ˜¯å¯ä»¥è‡ªå®šä¹‰çš„ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€æ±‚æ¥ä¿®æ”¹æ¨¡æ¿ï¼Œè¿™æ ·å°±å¯ä»¥å®ç°è‡ªå·±æƒ³è¦çš„æ•ˆæœäº†ã€‚&lt;/p>
&lt;h3 id="æœç´¢å¼•æ“éªŒè¯ä¿¡æ¯">&lt;a href="#%e6%90%9c%e7%b4%a2%e5%bc%95%e6%93%8e%e9%aa%8c%e8%af%81%e4%bf%a1%e6%81%af" class="header-anchor">&lt;/a>æœç´¢å¼•æ“éªŒè¯ä¿¡æ¯
&lt;/h3>&lt;p>æˆ‘ä»¬è‡ªå»ºçš„åšå®¢ï¼Œéœ€è¦æäº¤åˆ°æœç´¢å¼•æ“ä¸­ï¼Œè¿™æ ·æœç´¢å¼•æ“æ‰èƒ½æ”¶å½•æˆ‘ä»¬çš„åšå®¢ã€‚è¿™æ—¶å€™å°±éœ€è¦åœ¨åšå®¢ä¸­æ·»åŠ æœç´¢å¼•æ“éªŒè¯ä¿¡æ¯ã€‚å¯ä»¥ä½¿ç”¨åœ¨ç½‘ç«™çš„ç›®å½•ä¸­æ”¾ä¸€ä¸ª &lt;strong>html&lt;/strong> æ–‡ä»¶ï¼Œç„¶ååœ¨ &lt;strong>html&lt;/strong> æ–‡ä»¶ä¸­æ·»åŠ éªŒè¯ä¿¡æ¯ã€‚&lt;/p>
&lt;p>ä¹Ÿå¯ä»¥åœ¨æ¯ä¸ªç½‘é¡µä¸­æ·»åŠ éªŒè¯ä¿¡æ¯ï¼Œè¿™æ ·å°±ä¸éœ€è¦åœ¨ç½‘ç«™çš„ç›®å½•ä¸­æ”¾ä¸€ä¸ª &lt;strong>html&lt;/strong> æ–‡ä»¶äº†ã€‚è¿™æ¡éªŒè¯ä¿¡æ¯æ˜¯åœ¨ &lt;strong>head&lt;/strong> ä¸­æ·»åŠ çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥åœ¨ &lt;strong>custom.html&lt;/strong> æ–‡ä»¶ä¸­æ·»åŠ è¿™æ¡éªŒè¯ä¿¡æ¯ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-html" data-lang="html">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>{{ if .Site.Params.google_site_verification }}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span>&amp;lt;&lt;span style="color:#ff79c6">meta&lt;/span> &lt;span style="color:#50fa7b">name&lt;/span>&lt;span style="color:#ff79c6">=&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;google-site-verification&amp;#34;&lt;/span> &lt;span style="color:#50fa7b">content&lt;/span>&lt;span style="color:#ff79c6">=&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;{{ .Site.Params.google_site_verification }}&amp;#34;&lt;/span> /&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3&lt;/span>&lt;span>{{ end }}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5&lt;/span>&lt;span>{{ if .Site.Params.bing_site_verification }}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6&lt;/span>&lt;span>&amp;lt;&lt;span style="color:#ff79c6">meta&lt;/span> &lt;span style="color:#50fa7b">name&lt;/span>&lt;span style="color:#ff79c6">=&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;msvalidate.01&amp;#34;&lt;/span> &lt;span style="color:#50fa7b">content&lt;/span>&lt;span style="color:#ff79c6">=&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;{{ .Site.Params.bing_site_verification }}&amp;#34;&lt;/span> /&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7&lt;/span>&lt;span>{{ end }}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æ·»åŠ å®Œè¿™æ®µä»£ç åï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨ &lt;strong>config.yaml&lt;/strong> æ–‡ä»¶ä¸­æ·»åŠ  &lt;strong>google_site_verification&lt;/strong> å’Œ &lt;strong>bing_site_verification&lt;/strong> äº†ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span> &lt;span style="color:#ff79c6">google_site_verification&lt;/span>: &lt;span style="color:#f1fa8c">&amp;#34;XXX&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span> &lt;span style="color:#ff79c6">bing_site_verification&lt;/span>: &lt;span style="color:#f1fa8c">&amp;#34;XXX&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æŠŠ &lt;strong>XXX&lt;/strong> æ›¿æ¢æˆå¯¹åº”çš„éªŒè¯ä¿¡æ¯å°±è¡Œäº†ã€‚&lt;/p>
&lt;p>è¿™æ®µé…ç½®éœ€è¦åœ¨ &lt;strong>params&lt;/strong> å±‚çº§ä¸‹é…ç½®ï¼Œè¿™æ ·å°±å¯ä»¥åœ¨ &lt;strong>head&lt;/strong> ä¸­æ·»åŠ æœç´¢å¼•æ“éªŒè¯ä¿¡æ¯äº†ã€‚&lt;/p>
&lt;h3 id="æ¿å¨˜">&lt;a href="#%e6%9d%bf%e5%a8%98" class="header-anchor">&lt;/a>æ¿å¨˜
&lt;/h3>&lt;p>å°±æ˜¯å·¦ä¸‹è§’çš„é‚£ä¸ªå°å¥³å­©ï¼Œè¿™ä¸ªæ˜¯æˆ‘åœ¨ç½‘ä¸Šæ‰¾çš„ï¼Œ &lt;a class="link" href="https://github.com/stevenjoezhang/live2d-widget" target="_blank" rel="noopener"
>GitHub&lt;/a>&lt;/p>
&lt;p>æ·»åŠ æ–¹æ³•ä¹Ÿå¾ˆç®€å•ï¼Œåªéœ€è¦åœ¨ &lt;strong>layouts/partials/head&lt;/strong> ç›®å½•ä¸‹çš„ &lt;strong>custom.html&lt;/strong> æ–‡ä»¶ä¸­æ·»åŠ è¿™æ®µä»£ç å°±è¡Œäº†ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-html" data-lang="html">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>&amp;lt;&lt;span style="color:#ff79c6">script&lt;/span> &lt;span style="color:#50fa7b">src&lt;/span>&lt;span style="color:#ff79c6">=&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;https://fastly.jsdelivr.net/gh/stevenjoezhang/live2d-widget@latest/autoload.js&amp;#34;&lt;/span>&amp;gt;&amp;lt;/&lt;span style="color:#ff79c6">script&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="è‡ªåŠ¨éƒ¨ç½²">&lt;a href="#%e8%87%aa%e5%8a%a8%e9%83%a8%e7%bd%b2" class="header-anchor">&lt;/a>è‡ªåŠ¨éƒ¨ç½²
&lt;/h2>&lt;p>ä¸€èˆ¬éƒ½ä¼šä½¿ç”¨ &lt;strong>git&lt;/strong> æ¥ç®¡ç†åšå®¢çš„æºç ï¼Œç„¶åä½¿ç”¨ &lt;strong>GitHub Actions&lt;/strong> æ¥è‡ªåŠ¨éƒ¨ç½²åšå®¢ã€‚è¿™æ ·æˆ‘ä»¬åªéœ€è¦åœ¨ &lt;strong>git&lt;/strong> ä»“åº“ä¸­æäº¤ä»£ç ï¼Œç„¶å &lt;strong>GitHub Actions&lt;/strong> å°±ä¼šè‡ªåŠ¨æ„å»ºå¹¶éƒ¨ç½²åšå®¢ã€‚
åƒæˆ‘çš„åšå®¢å°±æ˜¯è¿™æ ·çš„ï¼Œæˆ‘ä½¿ç”¨ &lt;strong>GitHub Actions&lt;/strong> æ¥è‡ªåŠ¨æ„å»ºå¹¶éƒ¨ç½²åšå®¢ã€‚å¹¶ä¸”ä½¿ç”¨ GitHubçš„ &lt;strong>Pages&lt;/strong> åŠŸèƒ½æ¥æ‰˜ç®¡åšå®¢ã€‚&lt;/p>
&lt;p>è¿™æ—¶å€™æˆ‘ä¼šä½¿ç”¨ä¸¤ä¸ª &lt;strong>GitHub&lt;/strong> ä»“åº“ï¼Œä¸€ä¸ªç”¨æ¥å­˜æ”¾ &lt;strong>Hugo&lt;/strong> é¡¹ç›®çš„æºç ï¼Œä¸€ä¸ªç”¨æ¥å­˜æ”¾ &lt;strong>Hugo&lt;/strong> é¡¹ç›®æ„å»ºåçš„é™æ€æ–‡ä»¶ã€‚&lt;/p>
&lt;p>å¹¶ä¸”æŠŠ å­˜æ”¾æºç çš„ä»“åº“è®¾ç½®ä¸º &lt;strong>private&lt;/strong>ï¼Œå› ä¸ºGitHubçš„é™åˆ¶ï¼Œ&lt;strong>GitHub Pages&lt;/strong> åªæ”¯æŒ &lt;strong>public&lt;/strong> ä»“åº“ã€‚&lt;/p>
&lt;p>è¿™æ ·å°±å¯ä»¥å®ç°è‡ªåŠ¨éƒ¨ç½²äº†ï¼Œåªéœ€è¦åœ¨ &lt;strong>git&lt;/strong> ä»“åº“ä¸­æäº¤ä»£ç ï¼Œç„¶å &lt;strong>GitHub Actions&lt;/strong> å°±ä¼šè‡ªåŠ¨æ„å»ºå¹¶éƒ¨ç½²åšå®¢ã€‚&lt;/p>
&lt;p>åœ¨æºç çš„ä»“åº“ä¸­ï¼Œéœ€è¦æ·»åŠ ä¸€ä¸ª &lt;strong>.github/workflows&lt;/strong> ç›®å½•ï¼Œç„¶ååœ¨ &lt;strong>.github/workflows&lt;/strong> ç›®å½•ä¸­åˆ›å»ºä¸€ä¸ª &lt;strong>deploy.yml&lt;/strong> æ–‡ä»¶ï¼Œç„¶ååœ¨ &lt;strong>deploy.yml&lt;/strong> æ–‡ä»¶ä¸­é…ç½®&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">name&lt;/span>: Deploy
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span>&lt;span style="color:#ff79c6">env&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span> &lt;span style="color:#ff79c6">GIT_USER&lt;/span>: lqx &lt;span style="color:#6272a4"># GitHub ç”¨æˆ·å&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span> &lt;span style="color:#ff79c6">GIT_EMAIL&lt;/span>: lqxlucky@qq.com &lt;span style="color:#6272a4"># GitHub é‚®ç®±&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span> &lt;span style="color:#ff79c6">PAGE_REPO&lt;/span>: git@github.com:lqxhub/lqxhub.github.io.git &lt;span style="color:#6272a4"># å­˜æ”¾é™æ€æ–‡ä»¶çš„ä»“åº“ï¼ˆGitHub pageçš„ä»“åº“ï¼‰&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span>&lt;span style="color:#ff79c6">on&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span> &lt;span style="color:#ff79c6">push&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span> &lt;span style="color:#ff79c6">branches&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span> - master &lt;span style="color:#6272a4"># æºç ä»“åº“çš„åˆ†æ”¯&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span> &lt;span style="color:#ff79c6">workflow_dispatch&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15&lt;/span>&lt;span>&lt;span style="color:#ff79c6">jobs&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16&lt;/span>&lt;span> &lt;span style="color:#ff79c6">build&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17&lt;/span>&lt;span> &lt;span style="color:#ff79c6">runs-on&lt;/span>: ubuntu-latest
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19&lt;/span>&lt;span> &lt;span style="color:#ff79c6">steps&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20&lt;/span>&lt;span> - &lt;span style="color:#ff79c6">name&lt;/span>: checkOut &lt;span style="color:#6272a4"># æ‹‰å–æºç &lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21&lt;/span>&lt;span> &lt;span style="color:#ff79c6">uses&lt;/span>: actions/checkout@v4
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22&lt;/span>&lt;span> - &lt;span style="color:#ff79c6">name&lt;/span>: Setup Hugo &lt;span style="color:#6272a4"># å®‰è£… Hugo&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23&lt;/span>&lt;span> &lt;span style="color:#ff79c6">uses&lt;/span>: peaceiris/actions-hugo@v3
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24&lt;/span>&lt;span> &lt;span style="color:#ff79c6">with&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25&lt;/span>&lt;span> &lt;span style="color:#ff79c6">hugo-version&lt;/span>: &lt;span style="color:#f1fa8c">&amp;#39;0.136.2&amp;#39;&lt;/span> &lt;span style="color:#6272a4"># Hugo ç‰ˆæœ¬&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26&lt;/span>&lt;span> &lt;span style="color:#ff79c6">extended&lt;/span>: &lt;span style="color:#ff79c6">true&lt;/span> &lt;span style="color:#6272a4"># æ˜¯å¦ä½¿ç”¨æ‰©å±•ç‰ˆæœ¬&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27&lt;/span>&lt;span> - &lt;span style="color:#ff79c6">name&lt;/span>: Build the website &lt;span style="color:#6272a4"># æ„å»ºhugoé¡µé¢&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28&lt;/span>&lt;span> &lt;span style="color:#ff79c6">run&lt;/span>: |&lt;span style="color:#f1fa8c">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29&lt;/span>&lt;span>&lt;span style="color:#f1fa8c"> sudo timedatectl set-timezone &amp;#34;Asia/Shanghai&amp;#34; # è®¾ç½®æ—¶åŒº
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30&lt;/span>&lt;span>&lt;span style="color:#f1fa8c"> hugo --minify # æ„å»ºé¡µé¢ è¿™é‡Œä½¿ç”¨äº† --minify å‚æ•°ï¼Œè¿™æ ·æ„å»ºçš„é¡µé¢ä¼šæ›´å°&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32&lt;/span>&lt;span> - &lt;span style="color:#ff79c6">name&lt;/span>: Deploy &lt;span style="color:#6272a4"># éƒ¨ç½²&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33&lt;/span>&lt;span> &lt;span style="color:#ff79c6">env&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34&lt;/span>&lt;span> &lt;span style="color:#ff79c6">DEPLOY_SECRET&lt;/span>: ${{ secrets.DEPLOY_SECRET }} &lt;span style="color:#6272a4"># GitHubçš„å¯†é’¥&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35&lt;/span>&lt;span> &lt;span style="color:#ff79c6">run&lt;/span>: |&lt;span style="color:#f1fa8c">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36&lt;/span>&lt;span>&lt;span style="color:#f1fa8c"> mkdir -p ~/.ssh
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37&lt;/span>&lt;span>&lt;span style="color:#f1fa8c"> echo &amp;#34;$DEPLOY_SECRET&amp;#34; &amp;gt; ~/.ssh/id_rsa
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38&lt;/span>&lt;span>&lt;span style="color:#f1fa8c"> chmod 600 ~/.ssh/id_rsa
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39&lt;/span>&lt;span>&lt;span style="color:#f1fa8c"> ssh-keyscan github.com &amp;gt;&amp;gt; ~/.ssh/known_hosts
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40&lt;/span>&lt;span>&lt;span style="color:#f1fa8c"> git config --global user.name &amp;#34;${{ env.GIT_USER }}&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41&lt;/span>&lt;span>&lt;span style="color:#f1fa8c"> git config --global user.email &amp;#34;${{ env.GIT_EMAIL }}&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42&lt;/span>&lt;span>&lt;span style="color:#f1fa8c">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43&lt;/span>&lt;span>&lt;span style="color:#f1fa8c"> cd public # Hugo generates the site in &amp;#39;public&amp;#39; folder by default
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44&lt;/span>&lt;span>&lt;span style="color:#f1fa8c"> git init
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45&lt;/span>&lt;span>&lt;span style="color:#f1fa8c"> git remote add origin &amp;#34;${{ env.PAGE_REPO }}&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46&lt;/span>&lt;span>&lt;span style="color:#f1fa8c"> git add .
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47&lt;/span>&lt;span>&lt;span style="color:#f1fa8c"> git commit -m &amp;#34;Deploy from Hugo site&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48&lt;/span>&lt;span>&lt;span style="color:#f1fa8c"> git push --force origin master&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™é‡Œè¯´ä¸€ä¸‹ &lt;strong>DEPLOY_SECRET&lt;/strong>ï¼Œè¿™ä¸ªæ˜¯ &lt;strong>GitHub&lt;/strong> çš„å¯†é’¥ï¼Œéœ€è¦åœ¨ æ‰˜ç®¡æºç çš„ä»“åº“(ä¹Ÿå°±æ˜¯ç§æœ‰ä»“åº“é‡Œ)ä¸­æ·»åŠ  &lt;strong>DEPLOY_SECRET&lt;/strong>ã€‚&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/489beefcf8610f240880b7136265432df695d3bc.jpg">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/489beefcf8610f240880b7136265432df695d3bc.jpg" alt="" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>å¦‚å›¾ä¸­æ‰€ç¤ºï¼Œåˆ›å»ºå³å¯ã€‚&lt;/p>
&lt;h2 id="æˆ‘ä½¿ç”¨çš„è‡ªå®šä¹‰é…ç½®">&lt;a href="#%e6%88%91%e4%bd%bf%e7%94%a8%e7%9a%84%e8%87%aa%e5%ae%9a%e4%b9%89%e9%85%8d%e7%bd%ae" class="header-anchor">&lt;/a>æˆ‘ä½¿ç”¨çš„è‡ªå®šä¹‰é…ç½®
&lt;/h2>&lt;p>æˆ‘å¯¹ &lt;strong>Stack&lt;/strong> ä¸»é¢˜è¿›è¡Œäº†ä¸€äº›ä¿®æ”¹ï¼Œéƒ½åœ¨ &lt;strong>assets/scss&lt;/strong> ç›®å½•ä¸‹çš„ &lt;strong>custom.scss&lt;/strong> æ–‡ä»¶ä¸­é…ç½®ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-scss" data-lang="scss">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#6272a4">// assets\scss\custom.scss
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span>&lt;span style="color:#6272a4">// é¡µé¢åŸºæœ¬é…è‰²
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span>:root {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span> &lt;span style="color:#6272a4">// å…¨å±€é¡¶éƒ¨è¾¹è·
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#50fa7b">--main-top-padding&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#bd93f9">30&lt;/span>&lt;span style="color:#8be9fd">px&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span> &lt;span style="color:#6272a4">// å…¨å±€å¡ç‰‡åœ†è§’
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#50fa7b">--card-border-radius&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#bd93f9">25&lt;/span>&lt;span style="color:#8be9fd">px&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span> &lt;span style="color:#6272a4">// æ ‡ç­¾äº‘å¡ç‰‡åœ†è§’
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 10&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#50fa7b">--tag-border-radius&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#bd93f9">8&lt;/span>&lt;span style="color:#8be9fd">px&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 11&lt;/span>&lt;span> &lt;span style="color:#6272a4">// å¡ç‰‡é—´è·
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 12&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#50fa7b">--section-separation&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#bd93f9">40&lt;/span>&lt;span style="color:#8be9fd">px&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 13&lt;/span>&lt;span> &lt;span style="color:#6272a4">// å…¨å±€å­—ä½“å¤§å°
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 14&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#50fa7b">--article-font-size&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#bd93f9">1&lt;/span>&lt;span style="color:#bd93f9">.8&lt;/span>&lt;span style="color:#8be9fd">rem&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 15&lt;/span>&lt;span> &lt;span style="color:#6272a4">// è¡Œå†…ä»£ç èƒŒæ™¯è‰²
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 16&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#50fa7b">--code-background-color&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#bd93f9">#f8f8f8&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 17&lt;/span>&lt;span> &lt;span style="color:#6272a4">// è¡Œå†…ä»£ç å‰æ™¯è‰²
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 18&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#50fa7b">--code-text-color&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#bd93f9">#e96900&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 19&lt;/span>&lt;span> &lt;span style="color:#6272a4">// æš—è‰²æ¨¡å¼ä¸‹æ ·å¼
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 20&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">&amp;amp;&lt;/span>&lt;span style="color:#ff79c6">[&lt;/span>&lt;span style="color:#ff79c6">data-scheme&lt;/span>&lt;span style="color:#ff79c6">=&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;dark&amp;#34;&lt;/span>&lt;span style="color:#ff79c6">]&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 21&lt;/span>&lt;span> &lt;span style="color:#6272a4">// è¡Œå†…ä»£ç èƒŒæ™¯è‰²
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 22&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#50fa7b">--code-background-color&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#bd93f9">#ff6d1b&lt;/span>&lt;span style="color:#bd93f9">17&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 23&lt;/span>&lt;span> &lt;span style="color:#6272a4">// è¡Œå†…ä»£ç å‰æ™¯è‰²
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 24&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#50fa7b">--code-text-color&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#bd93f9">#e96900&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 25&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 26&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 27&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 28&lt;/span>&lt;span> &lt;span style="color:#6272a4">//------------------------------------------------------
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 29&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#6272a4">// ä¿®å¤å¼•ç”¨å—å†…å®¹çª„é¡µé¢æ˜¾ç¤ºé—®é¢˜
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 30&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">a&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 31&lt;/span>&lt;span> &lt;span style="color:#50fa7b">word-break&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> break-all;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 32&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 33&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 34&lt;/span>&lt;span> &lt;span style="color:#6272a4">//--------------------------------------------------
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 35&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#6272a4">// æ–‡ç« å°é¢é«˜åº¦
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 36&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#50fa7b">.article-list&lt;/span> &lt;span style="color:#ff79c6">article&lt;/span> &lt;span style="color:#50fa7b">.article-image&lt;/span> &lt;span style="color:#ff79c6">img&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 37&lt;/span>&lt;span> &lt;span style="color:#50fa7b">width&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#bd93f9">100&lt;/span>&lt;span style="color:#8be9fd">%&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 38&lt;/span>&lt;span> &lt;span style="color:#50fa7b">height&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#bd93f9">200&lt;/span>&lt;span style="color:#8be9fd">px&lt;/span> &lt;span style="color:#ff79c6">!important&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 39&lt;/span>&lt;span> &lt;span style="color:#50fa7b">object-fit&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> cover;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 40&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 41&lt;/span>&lt;span> &lt;span style="color:#ff79c6">@include&lt;/span> respond(md) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 42&lt;/span>&lt;span> &lt;span style="color:#50fa7b">height&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#bd93f9">250&lt;/span>&lt;span style="color:#8be9fd">px&lt;/span> &lt;span style="color:#ff79c6">!important&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 43&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 44&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 45&lt;/span>&lt;span> &lt;span style="color:#ff79c6">@include&lt;/span> respond(xl) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 46&lt;/span>&lt;span> &lt;span style="color:#50fa7b">height&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#bd93f9">285&lt;/span>&lt;span style="color:#8be9fd">px&lt;/span> &lt;span style="color:#ff79c6">!important&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 47&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 48&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 49&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 50&lt;/span>&lt;span> &lt;span style="color:#6272a4">//---------------------------------------------------
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 51&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#6272a4">// æ–‡ç« å†…å®¹å›¾ç‰‡åœ†è§’é˜´å½±
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 52&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#50fa7b">.article-page&lt;/span> &lt;span style="color:#50fa7b">.main-article&lt;/span> &lt;span style="color:#50fa7b">.article-content&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 53&lt;/span>&lt;span> &lt;span style="color:#ff79c6">img&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 54&lt;/span>&lt;span> &lt;span style="color:#50fa7b">max-width&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#bd93f9">96&lt;/span>&lt;span style="color:#8be9fd">%&lt;/span> &lt;span style="color:#ff79c6">!important&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 55&lt;/span>&lt;span> &lt;span style="color:#50fa7b">height&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> auto &lt;span style="color:#ff79c6">!important&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 56&lt;/span>&lt;span> &lt;span style="color:#50fa7b">border-radius&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#bd93f9">8&lt;/span>&lt;span style="color:#8be9fd">px&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 57&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 58&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 59&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 60&lt;/span>&lt;span> &lt;span style="color:#6272a4">//------------------------------------------------
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 61&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#6272a4">// æ–‡ç« å†…å®¹å¼•ç”¨å—æ ·å¼
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 62&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#50fa7b">.article-content&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 63&lt;/span>&lt;span> &lt;span style="color:#ff79c6">blockquote&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 64&lt;/span>&lt;span> &lt;span style="color:#50fa7b">border-left&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#bd93f9">6&lt;/span>&lt;span style="color:#8be9fd">px&lt;/span> solid &lt;span style="color:#bd93f9">#358b9a&lt;/span>&lt;span style="color:#bd93f9">1&lt;/span>&lt;span style="color:#8be9fd">f&lt;/span> &lt;span style="color:#ff79c6">!important&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 65&lt;/span>&lt;span> &lt;span style="color:#50fa7b">background&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#bd93f9">#3a9743&lt;/span>&lt;span style="color:#bd93f9">1&lt;/span>&lt;span style="color:#8be9fd">f&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 66&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 67&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 68&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 69&lt;/span>&lt;span> &lt;span style="color:#ff79c6">code&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 70&lt;/span>&lt;span> &lt;span style="color:#50fa7b">word-break&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> break-all;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 71&lt;/span>&lt;span> &lt;span style="color:#50fa7b">border-radius&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#50fa7b">var&lt;/span>(&lt;span style="color:#ff79c6">--&lt;/span>tag-border-radius);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 72&lt;/span>&lt;span> &lt;span style="color:#50fa7b">font-family&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#50fa7b">var&lt;/span>(&lt;span style="color:#ff79c6">--&lt;/span>code-font-family);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 73&lt;/span>&lt;span> &lt;span style="color:#50fa7b">border-radius&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#50fa7b">var&lt;/span>(&lt;span style="color:#ff79c6">--&lt;/span>category-border-radius);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 74&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 75&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 76&lt;/span>&lt;span> &lt;span style="color:#6272a4">// ä»£ç å—åŸºç¡€æ ·å¼ä¿®æ”¹
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 77&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#50fa7b">.highlight&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 78&lt;/span>&lt;span> &lt;span style="color:#50fa7b">border-radius&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#bd93f9">20&lt;/span>&lt;span style="color:#8be9fd">px&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 79&lt;/span>&lt;span> &lt;span style="color:#ff79c6">&amp;amp;&lt;/span>:hover {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 80&lt;/span>&lt;span> &lt;span style="color:#50fa7b">.copyCodeButton&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 81&lt;/span>&lt;span> &lt;span style="color:#50fa7b">opacity&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#bd93f9">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 82&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 83&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 84&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 85&lt;/span>&lt;span> &lt;span style="color:#ff79c6">pre&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 86&lt;/span>&lt;span> &lt;span style="color:#50fa7b">margin&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> initial;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 87&lt;/span>&lt;span> &lt;span style="color:#50fa7b">padding&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 88&lt;/span>&lt;span> &lt;span style="color:#50fa7b">margin&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 89&lt;/span>&lt;span> &lt;span style="color:#50fa7b">width&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> auto;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 90&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 91&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 92&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 93&lt;/span>&lt;span> &lt;span style="color:#6272a4">//-------------------------------------------
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 94&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#6272a4">// è®¾ç½®é€‰ä¸­å­—ä½“çš„åŒºåŸŸèƒŒæ™¯é¢œè‰²
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 95&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#6272a4">//ä¿®æ”¹é€‰ä¸­é¢œè‰²
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 96&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> ::selection {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 97&lt;/span>&lt;span> &lt;span style="color:#50fa7b">color&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#bd93f9">#fff&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 98&lt;/span>&lt;span> &lt;span style="color:#50fa7b">background&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#bd93f9">#34495e&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 99&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">100&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">101&lt;/span>&lt;span> &lt;span style="color:#ff79c6">a&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">102&lt;/span>&lt;span> &lt;span style="color:#50fa7b">text-decoration&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> none;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">103&lt;/span>&lt;span> &lt;span style="color:#50fa7b">color&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#50fa7b">var&lt;/span>(&lt;span style="color:#ff79c6">--&lt;/span>accent-color);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">104&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">105&lt;/span>&lt;span> &lt;span style="color:#ff79c6">&amp;amp;&lt;/span>:hover {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">106&lt;/span>&lt;span> &lt;span style="color:#50fa7b">color&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#50fa7b">var&lt;/span>(&lt;span style="color:#ff79c6">--&lt;/span>accent-color-darker);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">107&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">108&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">109&lt;/span>&lt;span> &lt;span style="color:#ff79c6">&amp;amp;&lt;/span>&lt;span style="color:#50fa7b">.link&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">110&lt;/span>&lt;span> &lt;span style="color:#50fa7b">color&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#bd93f9">#4288b9&lt;/span>ad;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">111&lt;/span>&lt;span> &lt;span style="color:#50fa7b">font-weight&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#bd93f9">600&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">112&lt;/span>&lt;span> &lt;span style="color:#50fa7b">padding&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span> &lt;span style="color:#bd93f9">2&lt;/span>&lt;span style="color:#8be9fd">px&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">113&lt;/span>&lt;span> &lt;span style="color:#50fa7b">text-decoration&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> none;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">114&lt;/span>&lt;span> &lt;span style="color:#50fa7b">cursor&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> pointer;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">115&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">116&lt;/span>&lt;span> &lt;span style="color:#ff79c6">&amp;amp;&lt;/span>:hover {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">117&lt;/span>&lt;span> &lt;span style="color:#50fa7b">text-decoration&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> underline;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">118&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">119&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">120&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">121&lt;/span>&lt;span>&lt;span style="color:#6272a4">//å›ºå®šä»£ç å—çš„é«˜åº¦
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">122&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#50fa7b">.article-content&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">123&lt;/span>&lt;span> &lt;span style="color:#50fa7b">.highlight&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">124&lt;/span>&lt;span> &lt;span style="color:#50fa7b">padding&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#50fa7b">var&lt;/span>(&lt;span style="color:#ff79c6">--&lt;/span>card-padding);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">125&lt;/span>&lt;span> &lt;span style="color:#ff79c6">pre&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">126&lt;/span>&lt;span> &lt;span style="color:#50fa7b">width&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> auto;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">127&lt;/span>&lt;span> &lt;span style="color:#50fa7b">max-height&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#bd93f9">50&lt;/span>&lt;span style="color:#8be9fd">em&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">128&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">129&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">130&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">131&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">132&lt;/span>&lt;span> &lt;span style="color:#6272a4">//-------------------------------------------------
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">133&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#6272a4">//æ–‡ç« å°é¢é«˜åº¦æ›´æ”¹
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">134&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#50fa7b">.article-list&lt;/span> &lt;span style="color:#ff79c6">article&lt;/span> &lt;span style="color:#50fa7b">.article-image&lt;/span> &lt;span style="color:#ff79c6">img&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">135&lt;/span>&lt;span> &lt;span style="color:#50fa7b">width&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#bd93f9">100&lt;/span>&lt;span style="color:#8be9fd">%&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">136&lt;/span>&lt;span> &lt;span style="color:#50fa7b">height&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#bd93f9">150&lt;/span>&lt;span style="color:#8be9fd">px&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">137&lt;/span>&lt;span> &lt;span style="color:#50fa7b">object-fit&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> cover;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">138&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">139&lt;/span>&lt;span> &lt;span style="color:#ff79c6">@include&lt;/span> respond(md) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">140&lt;/span>&lt;span> &lt;span style="color:#50fa7b">height&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#bd93f9">200&lt;/span>&lt;span style="color:#8be9fd">px&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">141&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">142&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">143&lt;/span>&lt;span> &lt;span style="color:#ff79c6">@include&lt;/span> respond(xl) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">144&lt;/span>&lt;span> &lt;span style="color:#50fa7b">height&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#bd93f9">305&lt;/span>&lt;span style="color:#8be9fd">px&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">145&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">146&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">147&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">148&lt;/span>&lt;span> &lt;span style="color:#6272a4">//---------------------------------------------------
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">149&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#6272a4">// å…¨å±€é¡µé¢å¸ƒå±€é—´è·è°ƒæ•´
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">150&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#50fa7b">.main-container&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">151&lt;/span>&lt;span> &lt;span style="color:#50fa7b">min-height&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#bd93f9">100&lt;/span>&lt;span style="color:#8be9fd">vh&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">152&lt;/span>&lt;span> &lt;span style="color:#50fa7b">align-items&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> flex-start;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">153&lt;/span>&lt;span> &lt;span style="color:#50fa7b">padding&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span> &lt;span style="color:#bd93f9">15&lt;/span>&lt;span style="color:#8be9fd">px&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">154&lt;/span>&lt;span> &lt;span style="color:#50fa7b">gap&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#50fa7b">var&lt;/span>(&lt;span style="color:#ff79c6">--&lt;/span>section-separation);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">155&lt;/span>&lt;span> &lt;span style="color:#50fa7b">padding-top&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#50fa7b">var&lt;/span>(&lt;span style="color:#ff79c6">--&lt;/span>main-top-padding);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">156&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">157&lt;/span>&lt;span> &lt;span style="color:#ff79c6">@include&lt;/span> respond(md) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">158&lt;/span>&lt;span> &lt;span style="color:#50fa7b">padding&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span> &lt;span style="color:#bd93f9">37&lt;/span>&lt;span style="color:#8be9fd">px&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">159&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">160&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">161&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">162&lt;/span>&lt;span> &lt;span style="color:#6272a4">//--------------------------------------------------
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">163&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#6272a4">//é¡µé¢ä¸‰æ å®½åº¦è°ƒæ•´
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">164&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#50fa7b">.container&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">165&lt;/span>&lt;span> &lt;span style="color:#50fa7b">margin-left&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> auto;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">166&lt;/span>&lt;span> &lt;span style="color:#50fa7b">margin-right&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> auto;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">167&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">168&lt;/span>&lt;span> &lt;span style="color:#50fa7b">.left-sidebar&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">169&lt;/span>&lt;span> &lt;span style="color:#50fa7b">order&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#ff79c6">-&lt;/span>&lt;span style="color:#bd93f9">3&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">170&lt;/span>&lt;span> &lt;span style="color:#50fa7b">max-width&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#50fa7b">var&lt;/span>(&lt;span style="color:#ff79c6">--&lt;/span>left&lt;span style="color:#ff79c6">-&lt;/span>sidebar-max-width);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">171&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">172&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">173&lt;/span>&lt;span> &lt;span style="color:#50fa7b">.right-sidebar&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">174&lt;/span>&lt;span> &lt;span style="color:#50fa7b">order&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#ff79c6">-&lt;/span>&lt;span style="color:#bd93f9">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">175&lt;/span>&lt;span> &lt;span style="color:#50fa7b">max-width&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#50fa7b">var&lt;/span>(&lt;span style="color:#ff79c6">--&lt;/span>right&lt;span style="color:#ff79c6">-&lt;/span>sidebar-max-width);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">176&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">177&lt;/span>&lt;span> &lt;span style="color:#6272a4">/// Display right sidebar when min-width: lg
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">178&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">@include&lt;/span> respond(lg) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">179&lt;/span>&lt;span> &lt;span style="color:#50fa7b">display&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> flex;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">180&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">181&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">182&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">183&lt;/span>&lt;span> &lt;span style="color:#ff79c6">&amp;amp;&lt;/span>&lt;span style="color:#50fa7b">.extended&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">184&lt;/span>&lt;span> &lt;span style="color:#ff79c6">@include&lt;/span> respond(md) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">185&lt;/span>&lt;span> &lt;span style="color:#50fa7b">max-width&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#bd93f9">1024&lt;/span>&lt;span style="color:#8be9fd">px&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">186&lt;/span>&lt;span> &lt;span style="color:#50fa7b">--left-sidebar-max-width&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#bd93f9">25&lt;/span>&lt;span style="color:#8be9fd">%&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">187&lt;/span>&lt;span> &lt;span style="color:#50fa7b">--right-sidebar-max-width&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#bd93f9">22&lt;/span>&lt;span style="color:#8be9fd">%&lt;/span> &lt;span style="color:#ff79c6">!important&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">188&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">189&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">190&lt;/span>&lt;span> &lt;span style="color:#ff79c6">@include&lt;/span> respond(lg) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">191&lt;/span>&lt;span> &lt;span style="color:#50fa7b">max-width&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#bd93f9">1280&lt;/span>&lt;span style="color:#8be9fd">px&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">192&lt;/span>&lt;span> &lt;span style="color:#50fa7b">--left-sidebar-max-width&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#bd93f9">20&lt;/span>&lt;span style="color:#8be9fd">%&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">193&lt;/span>&lt;span> &lt;span style="color:#50fa7b">--right-sidebar-max-width&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#bd93f9">30&lt;/span>&lt;span style="color:#8be9fd">%&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">194&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">195&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">196&lt;/span>&lt;span> &lt;span style="color:#ff79c6">@include&lt;/span> respond(xl) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">197&lt;/span>&lt;span> &lt;span style="color:#50fa7b">max-width&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#bd93f9">1453&lt;/span>&lt;span style="color:#8be9fd">px&lt;/span>; &lt;span style="color:#6272a4">//1536px;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">198&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#50fa7b">--left-sidebar-max-width&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#bd93f9">15&lt;/span>&lt;span style="color:#8be9fd">%&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">199&lt;/span>&lt;span> &lt;span style="color:#50fa7b">--right-sidebar-max-width&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#bd93f9">25&lt;/span>&lt;span style="color:#8be9fd">%&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">200&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">201&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">202&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">203&lt;/span>&lt;span> &lt;span style="color:#ff79c6">&amp;amp;&lt;/span>&lt;span style="color:#50fa7b">.compact&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">204&lt;/span>&lt;span> &lt;span style="color:#ff79c6">@include&lt;/span> respond(md) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">205&lt;/span>&lt;span> &lt;span style="color:#50fa7b">--left-sidebar-max-width&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#bd93f9">25&lt;/span>&lt;span style="color:#8be9fd">%&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">206&lt;/span>&lt;span> &lt;span style="color:#50fa7b">max-width&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#bd93f9">768&lt;/span>&lt;span style="color:#8be9fd">px&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">207&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">208&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">209&lt;/span>&lt;span> &lt;span style="color:#ff79c6">@include&lt;/span> respond(lg) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">210&lt;/span>&lt;span> &lt;span style="color:#50fa7b">max-width&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#bd93f9">1024&lt;/span>&lt;span style="color:#8be9fd">px&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">211&lt;/span>&lt;span> &lt;span style="color:#50fa7b">--left-sidebar-max-width&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#bd93f9">20&lt;/span>&lt;span style="color:#8be9fd">%&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">212&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">213&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">214&lt;/span>&lt;span> &lt;span style="color:#ff79c6">@include&lt;/span> respond(xl) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">215&lt;/span>&lt;span> &lt;span style="color:#50fa7b">max-width&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#bd93f9">1280&lt;/span>&lt;span style="color:#8be9fd">px&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">216&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">217&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">218&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">219&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">220&lt;/span>&lt;span> &lt;span style="color:#6272a4">//-------------------------------------------------------
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">221&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#6272a4">//å…¨å±€é¡µé¢å°å›¾ç‰‡æ ·å¼å¾®è°ƒ
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">222&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#50fa7b">.article-list--compact&lt;/span> &lt;span style="color:#ff79c6">article&lt;/span> &lt;span style="color:#50fa7b">.article-image&lt;/span> &lt;span style="color:#ff79c6">img&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">223&lt;/span>&lt;span> &lt;span style="color:#50fa7b">width&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#50fa7b">var&lt;/span>(&lt;span style="color:#ff79c6">--&lt;/span>image&lt;span style="color:#ff79c6">-&lt;/span>size);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">224&lt;/span>&lt;span> &lt;span style="color:#50fa7b">height&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#50fa7b">var&lt;/span>(&lt;span style="color:#ff79c6">--&lt;/span>image&lt;span style="color:#ff79c6">-&lt;/span>size);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">225&lt;/span>&lt;span> &lt;span style="color:#50fa7b">object-fit&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> cover;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">226&lt;/span>&lt;span> &lt;span style="color:#50fa7b">border-radius&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#bd93f9">17&lt;/span>&lt;span style="color:#8be9fd">%&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">227&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">228&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">229&lt;/span>&lt;span>&lt;span style="color:#6272a4">//----------------------------------------------------
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">230&lt;/span>&lt;span>&lt;span style="color:#6272a4">// èœå•æ æ ·å¼
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">231&lt;/span>&lt;span>&lt;span style="color:#6272a4">// ä¸‹æ‹‰èœå•æ”¹åœ†è§’æ ·å¼
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">232&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span>&lt;span style="color:#50fa7b">.menu&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">233&lt;/span>&lt;span> &lt;span style="color:#50fa7b">padding-left&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">234&lt;/span>&lt;span> &lt;span style="color:#50fa7b">list-style&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> none;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">235&lt;/span>&lt;span> &lt;span style="color:#50fa7b">flex-direction&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> column;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">236&lt;/span>&lt;span> &lt;span style="color:#50fa7b">overflow-x&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> hidden;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">237&lt;/span>&lt;span> &lt;span style="color:#50fa7b">overflow-y&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> scroll;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">238&lt;/span>&lt;span> &lt;span style="color:#50fa7b">flex-grow&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#bd93f9">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">239&lt;/span>&lt;span> &lt;span style="color:#50fa7b">font-size&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#bd93f9">1&lt;/span>&lt;span style="color:#bd93f9">.6&lt;/span>&lt;span style="color:#8be9fd">rem&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">240&lt;/span>&lt;span> &lt;span style="color:#50fa7b">background-color&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#50fa7b">var&lt;/span>(&lt;span style="color:#ff79c6">--&lt;/span>card-background);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">241&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">242&lt;/span>&lt;span> &lt;span style="color:#50fa7b">box-shadow&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#50fa7b">var&lt;/span>(&lt;span style="color:#ff79c6">--&lt;/span>shadow-l2); &lt;span style="color:#6272a4">//æ”¹ä¸ªé˜´å½±
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">243&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#50fa7b">display&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> none;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">244&lt;/span>&lt;span> &lt;span style="color:#50fa7b">margin&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>; &lt;span style="color:#6272a4">//æ”¹ä¸º0
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">245&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#50fa7b">border-radius&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#bd93f9">10&lt;/span>&lt;span style="color:#8be9fd">px&lt;/span>; &lt;span style="color:#6272a4">//åŠ ä¸ªåœ†è§’
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">246&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#50fa7b">padding&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#bd93f9">30&lt;/span>&lt;span style="color:#8be9fd">px&lt;/span> &lt;span style="color:#bd93f9">30&lt;/span>&lt;span style="color:#8be9fd">px&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">247&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">248&lt;/span>&lt;span> &lt;span style="color:#ff79c6">@include&lt;/span> respond(xl) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">249&lt;/span>&lt;span> &lt;span style="color:#50fa7b">padding&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#bd93f9">15&lt;/span>&lt;span style="color:#8be9fd">px&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">250&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">251&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">252&lt;/span>&lt;span> &lt;span style="color:#ff79c6">&amp;amp;&lt;/span>&lt;span style="color:#ff79c6">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">253&lt;/span>&lt;span> &lt;span style="color:#50fa7b">.menu-bottom-section&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">254&lt;/span>&lt;span> &lt;span style="color:#50fa7b">gap&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#bd93f9">30&lt;/span>&lt;span style="color:#8be9fd">px&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">255&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">256&lt;/span>&lt;span> &lt;span style="color:#ff79c6">@include&lt;/span> respond(xl) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">257&lt;/span>&lt;span> &lt;span style="color:#50fa7b">gap&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#bd93f9">25&lt;/span>&lt;span style="color:#8be9fd">px&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">258&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">259&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">260&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">261&lt;/span>&lt;span> &lt;span style="color:#ff79c6">&amp;amp;&lt;/span>&lt;span style="color:#50fa7b">.show&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">262&lt;/span>&lt;span> &lt;span style="color:#50fa7b">display&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> flex;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">263&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">264&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">265&lt;/span>&lt;span> &lt;span style="color:#ff79c6">@include&lt;/span> respond(md) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">266&lt;/span>&lt;span> &lt;span style="color:#50fa7b">align-items&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> flex-end;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">267&lt;/span>&lt;span> &lt;span style="color:#50fa7b">display&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> flex;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">268&lt;/span>&lt;span> &lt;span style="color:#50fa7b">background-color&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> transparent;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">269&lt;/span>&lt;span> &lt;span style="color:#50fa7b">padding&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">270&lt;/span>&lt;span> &lt;span style="color:#50fa7b">box-shadow&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> none;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">271&lt;/span>&lt;span> &lt;span style="color:#50fa7b">margin&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">272&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">273&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">274&lt;/span>&lt;span> &lt;span style="color:#ff79c6">li&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">275&lt;/span>&lt;span> &lt;span style="color:#50fa7b">position&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> relative;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">276&lt;/span>&lt;span> &lt;span style="color:#50fa7b">vertical-align&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> middle;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">277&lt;/span>&lt;span> &lt;span style="color:#50fa7b">padding&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">278&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">279&lt;/span>&lt;span> &lt;span style="color:#ff79c6">@include&lt;/span> respond(md) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">280&lt;/span>&lt;span> &lt;span style="color:#50fa7b">width&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#bd93f9">100&lt;/span>&lt;span style="color:#8be9fd">%&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">281&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">282&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">283&lt;/span>&lt;span> &lt;span style="color:#ff79c6">svg&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">284&lt;/span>&lt;span> &lt;span style="color:#50fa7b">stroke-width&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#bd93f9">1&lt;/span>&lt;span style="color:#bd93f9">.33&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">285&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">286&lt;/span>&lt;span> &lt;span style="color:#50fa7b">width&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#bd93f9">20&lt;/span>&lt;span style="color:#8be9fd">px&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">287&lt;/span>&lt;span> &lt;span style="color:#50fa7b">height&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#bd93f9">20&lt;/span>&lt;span style="color:#8be9fd">px&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">288&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">289&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">290&lt;/span>&lt;span> &lt;span style="color:#ff79c6">a&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">291&lt;/span>&lt;span> &lt;span style="color:#50fa7b">height&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#bd93f9">100&lt;/span>&lt;span style="color:#8be9fd">%&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">292&lt;/span>&lt;span> &lt;span style="color:#50fa7b">display&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> inline-flex;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">293&lt;/span>&lt;span> &lt;span style="color:#50fa7b">align-items&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> center;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">294&lt;/span>&lt;span> &lt;span style="color:#50fa7b">color&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#50fa7b">var&lt;/span>(&lt;span style="color:#ff79c6">--&lt;/span>body-text-color);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">295&lt;/span>&lt;span> &lt;span style="color:#50fa7b">gap&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#50fa7b">var&lt;/span>(&lt;span style="color:#ff79c6">--&lt;/span>menu&lt;span style="color:#ff79c6">-&lt;/span>icon&lt;span style="color:#ff79c6">-&lt;/span>separation);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">296&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">297&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">298&lt;/span>&lt;span> &lt;span style="color:#ff79c6">span&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">299&lt;/span>&lt;span> &lt;span style="color:#50fa7b">flex&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#bd93f9">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">300&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">301&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">302&lt;/span>&lt;span> &lt;span style="color:#ff79c6">&amp;amp;&lt;/span>&lt;span style="color:#50fa7b">.current&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">303&lt;/span>&lt;span> &lt;span style="color:#ff79c6">a&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">304&lt;/span>&lt;span> &lt;span style="color:#50fa7b">color&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#50fa7b">var&lt;/span>(&lt;span style="color:#ff79c6">--&lt;/span>accent-color);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">305&lt;/span>&lt;span> &lt;span style="color:#50fa7b">font-weight&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> bold;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">306&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">307&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">308&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">309&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">310&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">311&lt;/span>&lt;span> &lt;span style="color:#6272a4">// ~\blog\assets\scss\custom.scss
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">312&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">313&lt;/span>&lt;span>&lt;span style="color:#6272a4">//------------------------------------------------
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">314&lt;/span>&lt;span>&lt;span style="color:#6272a4">//å°†æ»šåŠ¨æ¡ä¿®æ”¹ä¸ºåœ†è§’æ ·å¼
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">315&lt;/span>&lt;span>&lt;span style="color:#6272a4">//èœå•æ»šåŠ¨æ¡ç¾åŒ–
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">316&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span>&lt;span style="color:#50fa7b">.menu&lt;/span>::-webkit-scrollbar {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">317&lt;/span>&lt;span> &lt;span style="color:#50fa7b">display&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> none;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">318&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">319&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">320&lt;/span>&lt;span> &lt;span style="color:#6272a4">// å…¨å±€æ»šåŠ¨æ¡ç¾åŒ–
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">321&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">html&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">322&lt;/span>&lt;span> ::-webkit-scrollbar {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">323&lt;/span>&lt;span> &lt;span style="color:#50fa7b">width&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#bd93f9">20&lt;/span>&lt;span style="color:#8be9fd">px&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">324&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">325&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">326&lt;/span>&lt;span> ::-webkit-scrollbar-track {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">327&lt;/span>&lt;span> &lt;span style="color:#50fa7b">background-color&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> transparent;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">328&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">329&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">330&lt;/span>&lt;span> ::-webkit-scrollbar-thumb {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">331&lt;/span>&lt;span> &lt;span style="color:#50fa7b">background-color&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#bd93f9">#d6dee1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">332&lt;/span>&lt;span> &lt;span style="color:#50fa7b">border-radius&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#bd93f9">20&lt;/span>&lt;span style="color:#8be9fd">px&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">333&lt;/span>&lt;span> &lt;span style="color:#50fa7b">border&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#bd93f9">6&lt;/span>&lt;span style="color:#8be9fd">px&lt;/span> solid transparent;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">334&lt;/span>&lt;span> &lt;span style="color:#50fa7b">background-clip&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> content-box;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">335&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">336&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">337&lt;/span>&lt;span> ::-webkit-scrollbar-thumb:hover {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">338&lt;/span>&lt;span> &lt;span style="color:#50fa7b">background-color&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#bd93f9">#a8bbbf&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">339&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">340&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">341&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">342&lt;/span>&lt;span>&lt;span style="color:#6272a4">//--------------------------------------------------
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">343&lt;/span>&lt;span>&lt;span style="color:#6272a4">//å½’æ¡£é¡µé¢åŒæ 
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">344&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span>&lt;span style="color:#6272a4">/* å½’æ¡£é¡µé¢ä¸¤æ  */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">345&lt;/span>&lt;span>&lt;span style="color:#ff79c6">@media&lt;/span> (&lt;span style="color:#50fa7b">min-width&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#bd93f9">1024&lt;/span>&lt;span style="color:#8be9fd">px&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">346&lt;/span>&lt;span> &lt;span style="color:#50fa7b">.article-list--compact&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">347&lt;/span>&lt;span> &lt;span style="color:#50fa7b">display&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> grid;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">348&lt;/span>&lt;span> &lt;span style="color:#50fa7b">grid-template-columns&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#bd93f9">1&lt;/span>&lt;span style="color:#8be9fd">fr&lt;/span> &lt;span style="color:#bd93f9">1&lt;/span>&lt;span style="color:#8be9fd">fr&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">349&lt;/span>&lt;span> &lt;span style="color:#50fa7b">background&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> none;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">350&lt;/span>&lt;span> &lt;span style="color:#50fa7b">box-shadow&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> none;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">351&lt;/span>&lt;span> &lt;span style="color:#50fa7b">gap&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#bd93f9">1&lt;/span>&lt;span style="color:#8be9fd">rem&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">352&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">353&lt;/span>&lt;span> &lt;span style="color:#ff79c6">article&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">354&lt;/span>&lt;span> &lt;span style="color:#50fa7b">background&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#50fa7b">var&lt;/span>(&lt;span style="color:#ff79c6">--&lt;/span>card-background);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">355&lt;/span>&lt;span> &lt;span style="color:#50fa7b">border&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> none;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">356&lt;/span>&lt;span> &lt;span style="color:#50fa7b">box-shadow&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#50fa7b">var&lt;/span>(&lt;span style="color:#ff79c6">--&lt;/span>shadow-l2);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">357&lt;/span>&lt;span> &lt;span style="color:#50fa7b">margin-bottom&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#bd93f9">8&lt;/span>&lt;span style="color:#8be9fd">px&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">358&lt;/span>&lt;span> &lt;span style="color:#50fa7b">border-radius&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#bd93f9">16&lt;/span>&lt;span style="color:#8be9fd">px&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">359&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">360&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">361&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">362&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">363&lt;/span>&lt;span>&lt;span style="color:#6272a4">//--------------------------------------------------
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">364&lt;/span>&lt;span>&lt;span style="color:#6272a4">//é“¾æ¥ä¸‰æ 
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">365&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span>&lt;span style="color:#ff79c6">@media&lt;/span> (&lt;span style="color:#50fa7b">min-width&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#bd93f9">1024&lt;/span>&lt;span style="color:#8be9fd">px&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">366&lt;/span>&lt;span> &lt;span style="color:#50fa7b">.article-list--compact.links&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">367&lt;/span>&lt;span> &lt;span style="color:#50fa7b">display&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> grid;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">368&lt;/span>&lt;span> &lt;span style="color:#50fa7b">grid-template-columns&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#bd93f9">1&lt;/span>&lt;span style="color:#8be9fd">fr&lt;/span> &lt;span style="color:#bd93f9">1&lt;/span>&lt;span style="color:#8be9fd">fr&lt;/span> &lt;span style="color:#bd93f9">1&lt;/span>&lt;span style="color:#8be9fd">fr&lt;/span>; &lt;span style="color:#6272a4">//ä¸‰ä¸ª1frå³ä¸ºä¸‰æ ,ä¸¤ä¸ª1fråˆ™ä¸ºåŒæ ,ä»¥æ­¤ç±»æ¨å³å¯.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">369&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#50fa7b">background&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> none;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">370&lt;/span>&lt;span> &lt;span style="color:#50fa7b">box-shadow&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> none;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">371&lt;/span>&lt;span> &lt;span style="color:#50fa7b">gap&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#bd93f9">1&lt;/span>&lt;span style="color:#8be9fd">rem&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">372&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">373&lt;/span>&lt;span> &lt;span style="color:#ff79c6">article&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">374&lt;/span>&lt;span> &lt;span style="color:#50fa7b">background&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#50fa7b">var&lt;/span>(&lt;span style="color:#ff79c6">--&lt;/span>card-background);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">375&lt;/span>&lt;span> &lt;span style="color:#50fa7b">border&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> none;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">376&lt;/span>&lt;span> &lt;span style="color:#50fa7b">box-shadow&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#50fa7b">var&lt;/span>(&lt;span style="color:#ff79c6">--&lt;/span>shadow-l2);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">377&lt;/span>&lt;span> &lt;span style="color:#50fa7b">margin-bottom&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#bd93f9">8&lt;/span>&lt;span style="color:#8be9fd">px&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">378&lt;/span>&lt;span> &lt;span style="color:#50fa7b">border-radius&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#50fa7b">var&lt;/span>(&lt;span style="color:#ff79c6">--&lt;/span>card-border-radius);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">379&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">380&lt;/span>&lt;span> &lt;span style="color:#ff79c6">&amp;amp;&lt;/span>:nth-child&lt;span style="color:#ff79c6">(&lt;/span>&lt;span style="color:#ff79c6">odd&lt;/span>&lt;span style="color:#ff79c6">)&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">381&lt;/span>&lt;span> &lt;span style="color:#50fa7b">margin-right&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#bd93f9">8&lt;/span>&lt;span style="color:#8be9fd">px&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">382&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">383&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">384&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">385&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">386&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">387&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">388&lt;/span>&lt;span>&lt;span style="color:#6272a4">//---------------------------------------------------------
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">389&lt;/span>&lt;span>&lt;span style="color:#6272a4">//é¦–é¡µæ¬¢è¿æ¿å—æ ·å¼
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">390&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span>&lt;span style="color:#50fa7b">.welcome&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">391&lt;/span>&lt;span> &lt;span style="color:#50fa7b">color&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#50fa7b">var&lt;/span>(&lt;span style="color:#ff79c6">--&lt;/span>card-text-color-main);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">392&lt;/span>&lt;span> &lt;span style="color:#50fa7b">background&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#50fa7b">var&lt;/span>(&lt;span style="color:#ff79c6">--&lt;/span>card-background);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">393&lt;/span>&lt;span> &lt;span style="color:#50fa7b">box-shadow&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#50fa7b">var&lt;/span>(&lt;span style="color:#ff79c6">--&lt;/span>shadow-l2);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">394&lt;/span>&lt;span> &lt;span style="color:#50fa7b">border-radius&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#bd93f9">30&lt;/span>&lt;span style="color:#8be9fd">px&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">395&lt;/span>&lt;span> &lt;span style="color:#50fa7b">display&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> inline-block;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">396&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">397&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">398&lt;/span>&lt;span> &lt;span style="color:#6272a4">// ğŸ‘‹emojiå®ç°æ‘†åŠ¨æ•ˆæœ
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">399&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#50fa7b">.shake&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">400&lt;/span>&lt;span> &lt;span style="color:#50fa7b">display&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> inline-block;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">401&lt;/span>&lt;span> &lt;span style="color:#50fa7b">animation&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> shake &lt;span style="color:#bd93f9">1&lt;/span>&lt;span style="color:#8be9fd">s&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">402&lt;/span>&lt;span> &lt;span style="color:#50fa7b">animation-duration&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#bd93f9">1&lt;/span>&lt;span style="color:#8be9fd">s&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">403&lt;/span>&lt;span> &lt;span style="color:#50fa7b">animation-timing-function&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> ease;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">404&lt;/span>&lt;span> &lt;span style="color:#50fa7b">animation-delay&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>&lt;span style="color:#8be9fd">s&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">405&lt;/span>&lt;span> &lt;span style="color:#50fa7b">animation-iteration-count&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#bd93f9">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">406&lt;/span>&lt;span> &lt;span style="color:#50fa7b">animation-direction&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> normal;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">407&lt;/span>&lt;span> &lt;span style="color:#50fa7b">animation-fill-mode&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> none;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">408&lt;/span>&lt;span> &lt;span style="color:#50fa7b">animation-play-state&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> running;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">409&lt;/span>&lt;span> &lt;span style="color:#50fa7b">animation-name&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> shake;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">410&lt;/span>&lt;span> &lt;span style="color:#50fa7b">animation-timeline&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> auto;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">411&lt;/span>&lt;span> &lt;span style="color:#50fa7b">animation-range-start&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> normal;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">412&lt;/span>&lt;span> &lt;span style="color:#50fa7b">animation-range-end&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> normal;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">413&lt;/span>&lt;span> &lt;span style="color:#50fa7b">animation-delay&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#bd93f9">2&lt;/span>&lt;span style="color:#8be9fd">s&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">414&lt;/span>&lt;span> &lt;span style="color:#ff79c6">@keyframes&lt;/span> &lt;span style="color:#ff79c6">shake&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">415&lt;/span>&lt;span> &lt;span style="color:#ff79c6">0&lt;/span>% {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">416&lt;/span>&lt;span> &lt;span style="color:#50fa7b">transform&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#50fa7b">rotate&lt;/span>(&lt;span style="color:#bd93f9">0&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">417&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">418&lt;/span>&lt;span> &lt;span style="color:#ff79c6">25&lt;/span>% {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">419&lt;/span>&lt;span> &lt;span style="color:#50fa7b">transform&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#50fa7b">rotate&lt;/span>(&lt;span style="color:#bd93f9">45&lt;/span>&lt;span style="color:#8be9fd">deg&lt;/span>) &lt;span style="color:#50fa7b">scale&lt;/span>(&lt;span style="color:#bd93f9">1&lt;/span>&lt;span style="color:#bd93f9">.2&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">420&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">421&lt;/span>&lt;span> &lt;span style="color:#ff79c6">50&lt;/span>% {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">422&lt;/span>&lt;span> &lt;span style="color:#50fa7b">transform&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#50fa7b">rotate&lt;/span>(&lt;span style="color:#bd93f9">0&lt;/span>) &lt;span style="color:#50fa7b">scale&lt;/span>(&lt;span style="color:#bd93f9">1&lt;/span>&lt;span style="color:#bd93f9">.2&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">423&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">424&lt;/span>&lt;span> &lt;span style="color:#ff79c6">75&lt;/span>% {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">425&lt;/span>&lt;span> &lt;span style="color:#50fa7b">transform&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#50fa7b">rotate&lt;/span>(&lt;span style="color:#bd93f9">45&lt;/span>&lt;span style="color:#8be9fd">deg&lt;/span>) &lt;span style="color:#50fa7b">scale&lt;/span>(&lt;span style="color:#bd93f9">1&lt;/span>&lt;span style="color:#bd93f9">.2&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">426&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">427&lt;/span>&lt;span> &lt;span style="color:#ff79c6">100&lt;/span>% {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">428&lt;/span>&lt;span> &lt;span style="color:#50fa7b">transform&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#50fa7b">rotate&lt;/span>(&lt;span style="color:#bd93f9">0&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">429&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">430&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">431&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">432&lt;/span>&lt;span> &lt;span style="color:#6272a4">// å®ç°å­—ç¬¦è·³åŠ¨åŠ¨ç”»
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">433&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#50fa7b">.jump-text1&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">434&lt;/span>&lt;span> &lt;span style="color:#50fa7b">display&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> inline-block;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">435&lt;/span>&lt;span> &lt;span style="color:#50fa7b">animation&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> jump &lt;span style="color:#bd93f9">0&lt;/span>&lt;span style="color:#bd93f9">.5&lt;/span>&lt;span style="color:#8be9fd">s&lt;/span> &lt;span style="color:#bd93f9">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">436&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">437&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">438&lt;/span>&lt;span> &lt;span style="color:#50fa7b">.jump-text2&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">439&lt;/span>&lt;span> &lt;span style="color:#50fa7b">display&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> inline-block;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">440&lt;/span>&lt;span> &lt;span style="color:#50fa7b">animation&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> jump &lt;span style="color:#bd93f9">0&lt;/span>&lt;span style="color:#bd93f9">.5&lt;/span>&lt;span style="color:#8be9fd">s&lt;/span> &lt;span style="color:#bd93f9">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">441&lt;/span>&lt;span> &lt;span style="color:#50fa7b">animation-delay&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>&lt;span style="color:#bd93f9">.1&lt;/span>&lt;span style="color:#8be9fd">s&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">442&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">443&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">444&lt;/span>&lt;span> &lt;span style="color:#50fa7b">.jump-text3&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">445&lt;/span>&lt;span> &lt;span style="color:#50fa7b">display&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> inline-block;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">446&lt;/span>&lt;span> &lt;span style="color:#50fa7b">animation&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> jump &lt;span style="color:#bd93f9">0&lt;/span>&lt;span style="color:#bd93f9">.5&lt;/span>&lt;span style="color:#8be9fd">s&lt;/span> &lt;span style="color:#bd93f9">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">447&lt;/span>&lt;span> &lt;span style="color:#50fa7b">animation-delay&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>&lt;span style="color:#bd93f9">.2&lt;/span>&lt;span style="color:#8be9fd">s&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">448&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">449&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">450&lt;/span>&lt;span> &lt;span style="color:#50fa7b">.jump-text4&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">451&lt;/span>&lt;span> &lt;span style="color:#50fa7b">display&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> inline-block;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">452&lt;/span>&lt;span> &lt;span style="color:#50fa7b">animation&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> jump &lt;span style="color:#bd93f9">0&lt;/span>&lt;span style="color:#bd93f9">.5&lt;/span>&lt;span style="color:#8be9fd">s&lt;/span> &lt;span style="color:#bd93f9">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">453&lt;/span>&lt;span> &lt;span style="color:#50fa7b">animation-delay&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>&lt;span style="color:#bd93f9">.3&lt;/span>&lt;span style="color:#8be9fd">s&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">454&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">455&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">456&lt;/span>&lt;span> &lt;span style="color:#50fa7b">.jump-text5&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">457&lt;/span>&lt;span> &lt;span style="color:#50fa7b">display&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> inline-block;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">458&lt;/span>&lt;span> &lt;span style="color:#50fa7b">animation&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> jump &lt;span style="color:#bd93f9">0&lt;/span>&lt;span style="color:#bd93f9">.5&lt;/span>&lt;span style="color:#8be9fd">s&lt;/span> &lt;span style="color:#bd93f9">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">459&lt;/span>&lt;span> &lt;span style="color:#50fa7b">animation-delay&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>&lt;span style="color:#bd93f9">.4&lt;/span>&lt;span style="color:#8be9fd">s&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">460&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">461&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">462&lt;/span>&lt;span> &lt;span style="color:#50fa7b">.jump-text6&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">463&lt;/span>&lt;span> &lt;span style="color:#50fa7b">display&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> inline-block;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">464&lt;/span>&lt;span> &lt;span style="color:#50fa7b">animation&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> jump &lt;span style="color:#bd93f9">0&lt;/span>&lt;span style="color:#bd93f9">.5&lt;/span>&lt;span style="color:#8be9fd">s&lt;/span> &lt;span style="color:#bd93f9">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">465&lt;/span>&lt;span> &lt;span style="color:#50fa7b">animation-delay&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>&lt;span style="color:#bd93f9">.5&lt;/span>&lt;span style="color:#8be9fd">s&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">466&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">467&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">468&lt;/span>&lt;span> &lt;span style="color:#50fa7b">.jump-text7&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">469&lt;/span>&lt;span> &lt;span style="color:#50fa7b">display&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> inline-block;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">470&lt;/span>&lt;span> &lt;span style="color:#50fa7b">animation&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> jump &lt;span style="color:#bd93f9">0&lt;/span>&lt;span style="color:#bd93f9">.5&lt;/span>&lt;span style="color:#8be9fd">s&lt;/span> &lt;span style="color:#bd93f9">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">471&lt;/span>&lt;span> &lt;span style="color:#50fa7b">animation-delay&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>&lt;span style="color:#bd93f9">.6&lt;/span>&lt;span style="color:#8be9fd">s&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">472&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">473&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">474&lt;/span>&lt;span> &lt;span style="color:#50fa7b">.jump-text8&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">475&lt;/span>&lt;span> &lt;span style="color:#50fa7b">display&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> inline-block;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">476&lt;/span>&lt;span> &lt;span style="color:#50fa7b">animation&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> jump &lt;span style="color:#bd93f9">0&lt;/span>&lt;span style="color:#bd93f9">.5&lt;/span>&lt;span style="color:#8be9fd">s&lt;/span> &lt;span style="color:#bd93f9">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">477&lt;/span>&lt;span> &lt;span style="color:#50fa7b">animation-delay&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>&lt;span style="color:#bd93f9">.7&lt;/span>&lt;span style="color:#8be9fd">s&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">478&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">479&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">480&lt;/span>&lt;span> &lt;span style="color:#50fa7b">.jump-text9&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">481&lt;/span>&lt;span> &lt;span style="color:#50fa7b">display&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> inline-block;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">482&lt;/span>&lt;span> &lt;span style="color:#50fa7b">animation&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> jump &lt;span style="color:#bd93f9">0&lt;/span>&lt;span style="color:#bd93f9">.5&lt;/span>&lt;span style="color:#8be9fd">s&lt;/span> &lt;span style="color:#bd93f9">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">483&lt;/span>&lt;span> &lt;span style="color:#50fa7b">animation-delay&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>&lt;span style="color:#bd93f9">.9&lt;/span>&lt;span style="color:#8be9fd">s&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">484&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">485&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">486&lt;/span>&lt;span> &lt;span style="color:#ff79c6">@keyframes&lt;/span> &lt;span style="color:#ff79c6">jump&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">487&lt;/span>&lt;span> &lt;span style="color:#ff79c6">0&lt;/span>% {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">488&lt;/span>&lt;span> &lt;span style="color:#50fa7b">transform&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#50fa7b">translateY&lt;/span>(&lt;span style="color:#bd93f9">0&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">489&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">490&lt;/span>&lt;span> &lt;span style="color:#ff79c6">50&lt;/span>% {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">491&lt;/span>&lt;span> &lt;span style="color:#50fa7b">transform&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#50fa7b">translateY&lt;/span>(&lt;span style="color:#ff79c6">-&lt;/span>&lt;span style="color:#bd93f9">20&lt;/span>&lt;span style="color:#8be9fd">px&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">492&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">493&lt;/span>&lt;span> &lt;span style="color:#ff79c6">100&lt;/span>% {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">494&lt;/span>&lt;span> &lt;span style="color:#50fa7b">transform&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#50fa7b">translateY&lt;/span>(&lt;span style="color:#bd93f9">0&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">495&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">496&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">497&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">498&lt;/span>&lt;span> &lt;span style="color:#50fa7b">.main-container&lt;/span> &lt;span style="color:#50fa7b">.right-sidebar&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">499&lt;/span>&lt;span> &lt;span style="color:#50fa7b">order&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#bd93f9">2&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">500&lt;/span>&lt;span> &lt;span style="color:#50fa7b">max-width&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#50fa7b">var&lt;/span>(&lt;span style="color:#ff79c6">--&lt;/span>right&lt;span style="color:#ff79c6">-&lt;/span>sidebar-max-width);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">501&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">502&lt;/span>&lt;span> &lt;span style="color:#6272a4">/// Display right sidebar when min-width: lg
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">503&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">@include&lt;/span> respond(lg) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">504&lt;/span>&lt;span> &lt;span style="color:#50fa7b">display&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> flex;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">505&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">506&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">507&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">508&lt;/span>&lt;span> &lt;span style="color:#ff79c6">main&lt;/span>&lt;span style="color:#50fa7b">.main&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">509&lt;/span>&lt;span> &lt;span style="color:#50fa7b">order&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#bd93f9">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">510&lt;/span>&lt;span> &lt;span style="color:#50fa7b">min-width&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">511&lt;/span>&lt;span> &lt;span style="color:#50fa7b">max-width&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#bd93f9">100&lt;/span>&lt;span style="color:#8be9fd">%&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">512&lt;/span>&lt;span> &lt;span style="color:#50fa7b">flex-grow&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#bd93f9">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">513&lt;/span>&lt;span> &lt;span style="color:#50fa7b">display&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> flex;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">514&lt;/span>&lt;span> &lt;span style="color:#50fa7b">flex-direction&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> column;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">515&lt;/span>&lt;span> &lt;span style="color:#50fa7b">gap&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#50fa7b">var&lt;/span>(&lt;span style="color:#ff79c6">--&lt;/span>section-separation);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">516&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">517&lt;/span>&lt;span> &lt;span style="color:#ff79c6">@include&lt;/span> respond(md) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">518&lt;/span>&lt;span> &lt;span style="color:#50fa7b">padding-top&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#50fa7b">var&lt;/span>(&lt;span style="color:#ff79c6">--&lt;/span>main-top-padding);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">519&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">520&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">521&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">522&lt;/span>&lt;span>&lt;span style="color:#6272a4">//----------------------------------------------------------
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">523&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">524&lt;/span>&lt;span>&lt;span style="color:#50fa7b">.article-category&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">525&lt;/span>&lt;span> &lt;span style="color:#50fa7b">display&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> flex;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">526&lt;/span>&lt;span> &lt;span style="color:#50fa7b">flex-wrap&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> wrap;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">527&lt;/span>&lt;span> &lt;span style="color:#50fa7b">gap&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#bd93f9">10&lt;/span>&lt;span style="color:#8be9fd">px&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">528&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">529&lt;/span>&lt;span> &lt;span style="color:#ff79c6">a&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">530&lt;/span>&lt;span> &lt;span style="color:#50fa7b">background&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#50fa7b">var&lt;/span>(&lt;span style="color:#ff79c6">--&lt;/span>card-background);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">531&lt;/span>&lt;span> &lt;span style="color:#50fa7b">box-shadow&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#50fa7b">var&lt;/span>(&lt;span style="color:#ff79c6">--&lt;/span>shadow-l1);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">532&lt;/span>&lt;span> &lt;span style="color:#50fa7b">border-radius&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#50fa7b">var&lt;/span>(&lt;span style="color:#ff79c6">--&lt;/span>category-border-radius);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">533&lt;/span>&lt;span> &lt;span style="color:#50fa7b">padding&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#bd93f9">8&lt;/span>&lt;span style="color:#8be9fd">px&lt;/span> &lt;span style="color:#bd93f9">20&lt;/span>&lt;span style="color:#8be9fd">px&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">534&lt;/span>&lt;span> &lt;span style="color:#50fa7b">color&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#50fa7b">var&lt;/span>(&lt;span style="color:#ff79c6">--&lt;/span>card-text-color-main);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">535&lt;/span>&lt;span> &lt;span style="color:#50fa7b">font-size&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#bd93f9">1&lt;/span>&lt;span style="color:#bd93f9">.4&lt;/span>&lt;span style="color:#8be9fd">rem&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">536&lt;/span>&lt;span> &lt;span style="color:#50fa7b">transition&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> box-shadow &lt;span style="color:#bd93f9">0&lt;/span>&lt;span style="color:#bd93f9">.3&lt;/span>&lt;span style="color:#8be9fd">s&lt;/span> ease;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">537&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">538&lt;/span>&lt;span> &lt;span style="color:#ff79c6">&amp;amp;&lt;/span>:hover {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">539&lt;/span>&lt;span> &lt;span style="color:#50fa7b">box-shadow&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#50fa7b">var&lt;/span>(&lt;span style="color:#ff79c6">--&lt;/span>shadow-l2);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">540&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">541&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">542&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">543&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">544&lt;/span>&lt;span>&lt;span style="color:#6272a4">/* Category widget */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">545&lt;/span>&lt;span>&lt;span style="color:#50fa7b">.category&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">546&lt;/span>&lt;span> &lt;span style="color:#50fa7b">.category-label&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">547&lt;/span>&lt;span> &lt;span style="color:#50fa7b">display&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> flex;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">548&lt;/span>&lt;span> &lt;span style="color:#50fa7b">flex-wrap&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> wrap;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">549&lt;/span>&lt;span> &lt;span style="color:#50fa7b">gap&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#bd93f9">10&lt;/span>&lt;span style="color:#8be9fd">px&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">550&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">551&lt;/span>&lt;span> &lt;span style="color:#ff79c6">a&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">552&lt;/span>&lt;span> &lt;span style="color:#50fa7b">border-left&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#bd93f9">6&lt;/span>&lt;span style="color:#8be9fd">px&lt;/span> solid;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">553&lt;/span>&lt;span> &lt;span style="color:#50fa7b">background&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#50fa7b">var&lt;/span>(&lt;span style="color:#ff79c6">--&lt;/span>card-background);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">554&lt;/span>&lt;span> &lt;span style="color:#50fa7b">box-shadow&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#50fa7b">var&lt;/span>(&lt;span style="color:#ff79c6">--&lt;/span>shadow-l1);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">555&lt;/span>&lt;span> &lt;span style="color:#50fa7b">border-radius&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#50fa7b">var&lt;/span>(&lt;span style="color:#ff79c6">--&lt;/span>category-border-radius);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">556&lt;/span>&lt;span> &lt;span style="color:#50fa7b">padding&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#bd93f9">12&lt;/span>&lt;span style="color:#8be9fd">px&lt;/span> &lt;span style="color:#bd93f9">20&lt;/span>&lt;span style="color:#8be9fd">px&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">557&lt;/span>&lt;span> &lt;span style="color:#50fa7b">color&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#50fa7b">var&lt;/span>(&lt;span style="color:#ff79c6">--&lt;/span>card-text-color-main);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">558&lt;/span>&lt;span> &lt;span style="color:#50fa7b">font-size&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#bd93f9">1&lt;/span>&lt;span style="color:#bd93f9">.5&lt;/span>&lt;span style="color:#8be9fd">rem&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">559&lt;/span>&lt;span> &lt;span style="color:#50fa7b">transition&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> box-shadow &lt;span style="color:#bd93f9">0&lt;/span>&lt;span style="color:#bd93f9">.3&lt;/span>&lt;span style="color:#8be9fd">s&lt;/span> ease;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">560&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">561&lt;/span>&lt;span> &lt;span style="color:#ff79c6">&amp;amp;&lt;/span>:hover {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">562&lt;/span>&lt;span> &lt;span style="color:#50fa7b">box-shadow&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#50fa7b">var&lt;/span>(&lt;span style="color:#ff79c6">--&lt;/span>shadow-l2);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">563&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">564&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">565&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">566&lt;/span>&lt;span> &lt;span style="color:#50fa7b">.category-count&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">567&lt;/span>&lt;span> &lt;span style="color:#50fa7b">color&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#50fa7b">var&lt;/span>(&lt;span style="color:#ff79c6">--&lt;/span>body-text-color);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">568&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">569&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">570&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">571&lt;/span>&lt;span>&lt;span style="color:#50fa7b">.article-subtitle&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">572&lt;/span>&lt;span> &lt;span style="color:#50fa7b">margin-top&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#ff79c6">-&lt;/span>&lt;span style="color:#bd93f9">5&lt;/span>&lt;span style="color:#8be9fd">px&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">573&lt;/span>&lt;span> &lt;span style="color:#50fa7b">font-size&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#bd93f9">1&lt;/span>&lt;span style="color:#bd93f9">.5&lt;/span>&lt;span style="color:#8be9fd">rem&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">574&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">575&lt;/span>&lt;span> &lt;span style="color:#ff79c6">@include&lt;/span> respond(md) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">576&lt;/span>&lt;span> &lt;span style="color:#50fa7b">font-size&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#bd93f9">1&lt;/span>&lt;span style="color:#bd93f9">.6&lt;/span>&lt;span style="color:#8be9fd">rem&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">577&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">578&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">579&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">580&lt;/span>&lt;span>&lt;span style="color:#6272a4">/*å¤´åƒæ—‹è½¬åŠ¨ç”»*/&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">581&lt;/span>&lt;span>&lt;span style="color:#50fa7b">.sidebar&lt;/span> &lt;span style="color:#ff79c6">header&lt;/span> &lt;span style="color:#50fa7b">.site-avatar&lt;/span> &lt;span style="color:#50fa7b">.site-logo&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">582&lt;/span>&lt;span> &lt;span style="color:#50fa7b">transition&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> transform &lt;span style="color:#bd93f9">1&lt;/span>&lt;span style="color:#bd93f9">.65&lt;/span>&lt;span style="color:#8be9fd">s&lt;/span> ease-in-out; &lt;span style="color:#6272a4">//æ—‹è½¬æ—¶é—´
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">583&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">584&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">585&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">586&lt;/span>&lt;span>&lt;span style="color:#50fa7b">.sidebar&lt;/span> &lt;span style="color:#ff79c6">header&lt;/span> &lt;span style="color:#50fa7b">.site-avatar&lt;/span> &lt;span style="color:#50fa7b">.site-logo&lt;/span>:hover {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">587&lt;/span>&lt;span> &lt;span style="color:#50fa7b">transform&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#50fa7b">rotate&lt;/span>(&lt;span style="color:#bd93f9">360&lt;/span>&lt;span style="color:#8be9fd">deg&lt;/span>); &lt;span style="color:#6272a4">//æ—‹è½¬è§’åº¦ä¸º360åº¦
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">588&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">589&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">590&lt;/span>&lt;span>&lt;span style="color:#6272a4">/*ç¤¾äº¤èœå•å±…ä¸­*/&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">591&lt;/span>&lt;span>&lt;span style="color:#50fa7b">.social-menu&lt;/span> &lt;span style="color:#ff79c6">svg&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">592&lt;/span>&lt;span> &lt;span style="color:#50fa7b">gap&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#bd93f9">15&lt;/span>&lt;span style="color:#8be9fd">px&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">593&lt;/span>&lt;span> &lt;span style="color:#50fa7b">justify-content&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> center;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">594&lt;/span>&lt;span> &lt;span style="color:#50fa7b">width&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#bd93f9">30&lt;/span>&lt;span style="color:#8be9fd">px&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">595&lt;/span>&lt;span> &lt;span style="color:#50fa7b">height&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#bd93f9">25&lt;/span>&lt;span style="color:#8be9fd">px&lt;/span>; &lt;span style="color:#6272a4">//ç¤¾äº¤èœå•å¤§å°
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">596&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#50fa7b">stroke&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#50fa7b">var&lt;/span>(&lt;span style="color:#ff79c6">--&lt;/span>body-text-color);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">597&lt;/span>&lt;span> &lt;span style="color:#50fa7b">stroke-width&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#bd93f9">1&lt;/span>&lt;span style="color:#bd93f9">.33&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">598&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">599&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">600&lt;/span>&lt;span>&lt;span style="color:#6272a4">/*é¡µé¢åŠ è½½åŠ¨ç”»éƒ¨åˆ†*/&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">601&lt;/span>&lt;span>#loading-box &lt;span style="color:#50fa7b">.loading-left-bg&lt;/span>&lt;span style="color:#ff79c6">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">602&lt;/span>&lt;span>#loading-box &lt;span style="color:#50fa7b">.loading-right-bg&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">603&lt;/span>&lt;span> &lt;span style="color:#50fa7b">position&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> fixed;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">604&lt;/span>&lt;span> &lt;span style="color:#50fa7b">z-index&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#bd93f9">1000&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">605&lt;/span>&lt;span> &lt;span style="color:#50fa7b">width&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#bd93f9">50&lt;/span>&lt;span style="color:#8be9fd">%&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">606&lt;/span>&lt;span> &lt;span style="color:#50fa7b">height&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#bd93f9">100&lt;/span>&lt;span style="color:#8be9fd">%&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">607&lt;/span>&lt;span> &lt;span style="color:#6272a4">// æˆ‘åœ¨è¿™é‡Œå°æ”¹äº†ä¸€ä¸‹é¢œè‰²ï¼Œ
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">608&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#50fa7b">background-color&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#bd93f9">#b1c0c7&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">609&lt;/span>&lt;span> &lt;span style="color:#50fa7b">transition&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> all &lt;span style="color:#bd93f9">0&lt;/span>&lt;span style="color:#bd93f9">.5&lt;/span>&lt;span style="color:#8be9fd">s&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">610&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">611&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">612&lt;/span>&lt;span>#loading-box &lt;span style="color:#50fa7b">.loading-right-bg&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">613&lt;/span>&lt;span> &lt;span style="color:#50fa7b">right&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">614&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">615&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">616&lt;/span>&lt;span>#loading-box&lt;span style="color:#ff79c6">&amp;gt;&lt;/span>&lt;span style="color:#50fa7b">.spinner-box&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">617&lt;/span>&lt;span> &lt;span style="color:#50fa7b">position&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> fixed;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">618&lt;/span>&lt;span> &lt;span style="color:#50fa7b">z-index&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#bd93f9">1001&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">619&lt;/span>&lt;span> &lt;span style="color:#50fa7b">display&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> flex;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">620&lt;/span>&lt;span> &lt;span style="color:#50fa7b">justify-content&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> center;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">621&lt;/span>&lt;span> &lt;span style="color:#50fa7b">align-items&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> center;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">622&lt;/span>&lt;span> &lt;span style="color:#50fa7b">width&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#bd93f9">100&lt;/span>&lt;span style="color:#8be9fd">%&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">623&lt;/span>&lt;span> &lt;span style="color:#50fa7b">height&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#bd93f9">100&lt;/span>&lt;span style="color:#8be9fd">vh&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">624&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">625&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">626&lt;/span>&lt;span>#loading-box &lt;span style="color:#50fa7b">.spinner-box&lt;/span> &lt;span style="color:#50fa7b">.configure-border-1&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">627&lt;/span>&lt;span> &lt;span style="color:#50fa7b">position&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> absolute;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">628&lt;/span>&lt;span> &lt;span style="color:#50fa7b">padding&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#bd93f9">3&lt;/span>&lt;span style="color:#8be9fd">px&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">629&lt;/span>&lt;span> &lt;span style="color:#50fa7b">width&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#bd93f9">115&lt;/span>&lt;span style="color:#8be9fd">px&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">630&lt;/span>&lt;span> &lt;span style="color:#50fa7b">height&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#bd93f9">115&lt;/span>&lt;span style="color:#8be9fd">px&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">631&lt;/span>&lt;span> &lt;span style="color:#50fa7b">background&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#bd93f9">#ffab91&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">632&lt;/span>&lt;span> &lt;span style="color:#50fa7b">animation&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> configure-clockwise &lt;span style="color:#bd93f9">3&lt;/span>&lt;span style="color:#8be9fd">s&lt;/span> ease-in-out &lt;span style="color:#bd93f9">0&lt;/span>&lt;span style="color:#8be9fd">s&lt;/span> infinite alternate;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">633&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">634&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">635&lt;/span>&lt;span>#loading-box &lt;span style="color:#50fa7b">.spinner-box&lt;/span> &lt;span style="color:#50fa7b">.configure-border-2&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">636&lt;/span>&lt;span> &lt;span style="color:#50fa7b">left&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#ff79c6">-&lt;/span>&lt;span style="color:#bd93f9">115&lt;/span>&lt;span style="color:#8be9fd">px&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">637&lt;/span>&lt;span> &lt;span style="color:#50fa7b">padding&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#bd93f9">3&lt;/span>&lt;span style="color:#8be9fd">px&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">638&lt;/span>&lt;span> &lt;span style="color:#50fa7b">width&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#bd93f9">115&lt;/span>&lt;span style="color:#8be9fd">px&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">639&lt;/span>&lt;span> &lt;span style="color:#50fa7b">height&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#bd93f9">115&lt;/span>&lt;span style="color:#8be9fd">px&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">640&lt;/span>&lt;span> &lt;span style="color:#50fa7b">background&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#50fa7b">rgb&lt;/span>(&lt;span style="color:#bd93f9">63&lt;/span>&lt;span style="color:#ff79c6">,&lt;/span> &lt;span style="color:#bd93f9">249&lt;/span>&lt;span style="color:#ff79c6">,&lt;/span> &lt;span style="color:#bd93f9">220&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">641&lt;/span>&lt;span> &lt;span style="color:#50fa7b">transform&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#50fa7b">rotate&lt;/span>(&lt;span style="color:#bd93f9">45&lt;/span>&lt;span style="color:#8be9fd">deg&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">642&lt;/span>&lt;span> &lt;span style="color:#50fa7b">animation&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> configure-xclockwise &lt;span style="color:#bd93f9">3&lt;/span>&lt;span style="color:#8be9fd">s&lt;/span> ease-in-out &lt;span style="color:#bd93f9">0&lt;/span>&lt;span style="color:#8be9fd">s&lt;/span> infinite alternate;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">643&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">644&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">645&lt;/span>&lt;span>#loading-box &lt;span style="color:#50fa7b">.spinner-box&lt;/span> &lt;span style="color:#50fa7b">.loading-word&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">646&lt;/span>&lt;span> &lt;span style="color:#50fa7b">position&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> absolute;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">647&lt;/span>&lt;span> &lt;span style="color:#50fa7b">color&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#bd93f9">#ffffff&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">648&lt;/span>&lt;span> &lt;span style="color:#6272a4">// æˆ‘åœ¨è¿™é‡Œå°æ”¹äº†ä¸€ä¸‹æ–‡å­—å¤§å°å’Œå­—ä½“ï¼Œæ³¨æ„ï¼
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">649&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#50fa7b">font-size&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#bd93f9">1&lt;/span>&lt;span style="color:#bd93f9">.8&lt;/span>&lt;span style="color:#8be9fd">rem&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">650&lt;/span>&lt;span> &lt;span style="color:#50fa7b">font-family&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#f1fa8c">&amp;#39;Zhi Mang Xing&amp;#39;&lt;/span>&lt;span style="color:#ff79c6">,&lt;/span> cursive;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">651&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">652&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">653&lt;/span>&lt;span>#loading-box &lt;span style="color:#50fa7b">.spinner-box&lt;/span> &lt;span style="color:#50fa7b">.configure-core&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">654&lt;/span>&lt;span> &lt;span style="color:#50fa7b">width&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#bd93f9">100&lt;/span>&lt;span style="color:#8be9fd">%&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">655&lt;/span>&lt;span> &lt;span style="color:#50fa7b">height&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#bd93f9">100&lt;/span>&lt;span style="color:#8be9fd">%&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">656&lt;/span>&lt;span> &lt;span style="color:#50fa7b">background-color&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#bd93f9">#37474f&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">657&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">658&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">659&lt;/span>&lt;span>&lt;span style="color:#ff79c6">div&lt;/span>&lt;span style="color:#50fa7b">.loaded&lt;/span> &lt;span style="color:#ff79c6">div&lt;/span>&lt;span style="color:#50fa7b">.loading-left-bg&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">660&lt;/span>&lt;span> &lt;span style="color:#50fa7b">transform&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#50fa7b">translate&lt;/span>(&lt;span style="color:#ff79c6">-&lt;/span>&lt;span style="color:#bd93f9">100&lt;/span>&lt;span style="color:#8be9fd">%&lt;/span>&lt;span style="color:#ff79c6">,&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">661&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">662&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">663&lt;/span>&lt;span>&lt;span style="color:#ff79c6">div&lt;/span>&lt;span style="color:#50fa7b">.loaded&lt;/span> &lt;span style="color:#ff79c6">div&lt;/span>&lt;span style="color:#50fa7b">.loading-right-bg&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">664&lt;/span>&lt;span> &lt;span style="color:#50fa7b">transform&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#50fa7b">translate&lt;/span>(&lt;span style="color:#bd93f9">100&lt;/span>&lt;span style="color:#8be9fd">%&lt;/span>&lt;span style="color:#ff79c6">,&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">665&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">666&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">667&lt;/span>&lt;span>&lt;span style="color:#ff79c6">div&lt;/span>&lt;span style="color:#50fa7b">.loaded&lt;/span> &lt;span style="color:#ff79c6">div&lt;/span>&lt;span style="color:#50fa7b">.spinner-box&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">668&lt;/span>&lt;span> &lt;span style="color:#6272a4">// ä½ å¯ä»¥æŠŠè¿™ä¸ªæ³¨é‡Šæ‰ï¼Œè¿™æ ·å°±èƒ½ä¸€ç›´çœ‹é‚£ä¸ªåŠ¨ç”»çš„æ•ˆæœäº†ï¼
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">669&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#50fa7b">display&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> none &lt;span style="color:#ff79c6">!important&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">670&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">671&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">672&lt;/span>&lt;span>&lt;span style="color:#ff79c6">@keyframes&lt;/span> &lt;span style="color:#ff79c6">configure-clockwise&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">673&lt;/span>&lt;span> &lt;span style="color:#ff79c6">0&lt;/span>% {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">674&lt;/span>&lt;span> &lt;span style="color:#50fa7b">transform&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#50fa7b">rotate&lt;/span>(&lt;span style="color:#bd93f9">0&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">675&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">676&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">677&lt;/span>&lt;span> &lt;span style="color:#ff79c6">25&lt;/span>% {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">678&lt;/span>&lt;span> &lt;span style="color:#50fa7b">transform&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#50fa7b">rotate&lt;/span>(&lt;span style="color:#bd93f9">90&lt;/span>&lt;span style="color:#8be9fd">deg&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">679&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">680&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">681&lt;/span>&lt;span> &lt;span style="color:#ff79c6">50&lt;/span>% {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">682&lt;/span>&lt;span> &lt;span style="color:#50fa7b">transform&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#50fa7b">rotate&lt;/span>(&lt;span style="color:#bd93f9">180&lt;/span>&lt;span style="color:#8be9fd">deg&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">683&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">684&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">685&lt;/span>&lt;span> &lt;span style="color:#ff79c6">75&lt;/span>% {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">686&lt;/span>&lt;span> &lt;span style="color:#50fa7b">transform&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#50fa7b">rotate&lt;/span>(&lt;span style="color:#bd93f9">270&lt;/span>&lt;span style="color:#8be9fd">deg&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">687&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">688&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">689&lt;/span>&lt;span> &lt;span style="color:#ff79c6">100&lt;/span>% {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">690&lt;/span>&lt;span> &lt;span style="color:#50fa7b">transform&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#50fa7b">rotate&lt;/span>(&lt;span style="color:#bd93f9">360&lt;/span>&lt;span style="color:#8be9fd">deg&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">691&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">692&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">693&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">694&lt;/span>&lt;span>&lt;span style="color:#ff79c6">@keyframes&lt;/span> &lt;span style="color:#ff79c6">configure-xclockwise&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">695&lt;/span>&lt;span> &lt;span style="color:#ff79c6">0&lt;/span>% {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">696&lt;/span>&lt;span> &lt;span style="color:#50fa7b">transform&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#50fa7b">rotate&lt;/span>(&lt;span style="color:#bd93f9">45&lt;/span>&lt;span style="color:#8be9fd">deg&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">697&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">698&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">699&lt;/span>&lt;span> &lt;span style="color:#ff79c6">25&lt;/span>% {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">700&lt;/span>&lt;span> &lt;span style="color:#50fa7b">transform&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#50fa7b">rotate&lt;/span>(&lt;span style="color:#ff79c6">-&lt;/span>&lt;span style="color:#bd93f9">45&lt;/span>&lt;span style="color:#8be9fd">deg&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">701&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">702&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">703&lt;/span>&lt;span> &lt;span style="color:#ff79c6">50&lt;/span>% {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">704&lt;/span>&lt;span> &lt;span style="color:#50fa7b">transform&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#50fa7b">rotate&lt;/span>(&lt;span style="color:#ff79c6">-&lt;/span>&lt;span style="color:#bd93f9">135&lt;/span>&lt;span style="color:#8be9fd">deg&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">705&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">706&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">707&lt;/span>&lt;span> &lt;span style="color:#ff79c6">75&lt;/span>% {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">708&lt;/span>&lt;span> &lt;span style="color:#50fa7b">transform&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#50fa7b">rotate&lt;/span>(&lt;span style="color:#ff79c6">-&lt;/span>&lt;span style="color:#bd93f9">225&lt;/span>&lt;span style="color:#8be9fd">deg&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">709&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">710&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">711&lt;/span>&lt;span> &lt;span style="color:#ff79c6">100&lt;/span>% {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">712&lt;/span>&lt;span> &lt;span style="color:#50fa7b">transform&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#50fa7b">rotate&lt;/span>(&lt;span style="color:#ff79c6">-&lt;/span>&lt;span style="color:#bd93f9">315&lt;/span>&lt;span style="color:#8be9fd">deg&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">713&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">714&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">715&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">716&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">717&lt;/span>&lt;span>&lt;span style="color:#6272a4">/* å¤´åƒæ—‹è½¬ */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">718&lt;/span>&lt;span>&lt;span style="color:#50fa7b">.home&lt;/span> &lt;span style="color:#50fa7b">.home-profile&lt;/span> &lt;span style="color:#50fa7b">.home-avatar&lt;/span> &lt;span style="color:#ff79c6">img&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">719&lt;/span>&lt;span> &lt;span style="color:#50fa7b">width&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#bd93f9">5&lt;/span>&lt;span style="color:#8be9fd">rem&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">720&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">721&lt;/span>&lt;span> &lt;span style="color:#6272a4">/* è®¾ç½®å¾ªç¯åŠ¨ç”»
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">722&lt;/span>&lt;span>&lt;span style="color:#6272a4"> [animation:
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">723&lt;/span>&lt;span>&lt;span style="color:#6272a4"> (play)åŠ¨ç”»åç§°
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">724&lt;/span>&lt;span>&lt;span style="color:#6272a4"> (2s)åŠ¨ç”»æ’­æ”¾æ—¶é•¿å•ä½ç§’æˆ–å¾®ç§’
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">725&lt;/span>&lt;span>&lt;span style="color:#6272a4"> (ease-out)åŠ¨ç”»æ’­æ”¾çš„é€Ÿåº¦æ›²çº¿ä¸ºä»¥ä½é€Ÿç»“æŸ
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">726&lt;/span>&lt;span>&lt;span style="color:#6272a4"> (1s)ç­‰å¾…1ç§’ç„¶åå¼€å§‹åŠ¨ç”»
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">727&lt;/span>&lt;span>&lt;span style="color:#6272a4"> (1)åŠ¨ç”»æ’­æ”¾æ¬¡æ•°(infiniteä¸ºå¾ªç¯æ’­æ”¾) ]*/&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">728&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">729&lt;/span>&lt;span> &lt;span style="color:#6272a4">/* é¼ æ ‡ç»è¿‡å¤´åƒæ—‹è½¬360åº¦ */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">730&lt;/span>&lt;span> &lt;span style="color:#50fa7b">-webkit-transition&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#ff79c6">-&lt;/span>webkit-transform &lt;span style="color:#bd93f9">1&lt;/span>&lt;span style="color:#bd93f9">.0&lt;/span>&lt;span style="color:#8be9fd">s&lt;/span> ease-out;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">731&lt;/span>&lt;span> &lt;span style="color:#50fa7b">-moz-transition&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#ff79c6">-&lt;/span>moz-transform &lt;span style="color:#bd93f9">1&lt;/span>&lt;span style="color:#bd93f9">.0&lt;/span>&lt;span style="color:#8be9fd">s&lt;/span> ease-out;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">732&lt;/span>&lt;span> &lt;span style="color:#50fa7b">transition&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> transform &lt;span style="color:#bd93f9">1&lt;/span>&lt;span style="color:#bd93f9">.0&lt;/span>&lt;span style="color:#8be9fd">s&lt;/span> ease-out;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">733&lt;/span>&lt;span> &lt;span style="color:#ff79c6">&amp;amp;&lt;/span>:hover {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">734&lt;/span>&lt;span> &lt;span style="color:#6272a4">/* é¼ æ ‡ç»è¿‡åœæ­¢å¤´åƒæ—‹è½¬
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">735&lt;/span>&lt;span>&lt;span style="color:#6272a4"> -webkit-animation-play-state:paused;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">736&lt;/span>&lt;span>&lt;span style="color:#6272a4"> animation-play-state:paused;*/&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">737&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">738&lt;/span>&lt;span> &lt;span style="color:#6272a4">/* é¼ æ ‡ç»è¿‡å¤´åƒæ—‹è½¬360åº¦ */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">739&lt;/span>&lt;span> &lt;span style="color:#50fa7b">-webkit-transform&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#50fa7b">rotateZ&lt;/span>(&lt;span style="color:#bd93f9">360&lt;/span>&lt;span style="color:#8be9fd">deg&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">740&lt;/span>&lt;span> &lt;span style="color:#50fa7b">-moz-transform&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#50fa7b">rotateZ&lt;/span>(&lt;span style="color:#bd93f9">360&lt;/span>&lt;span style="color:#8be9fd">deg&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">741&lt;/span>&lt;span> &lt;span style="color:#50fa7b">transform&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#50fa7b">rotateZ&lt;/span>(&lt;span style="color:#bd93f9">360&lt;/span>&lt;span style="color:#8be9fd">deg&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">742&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">743&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å¤§å¤šæ•°éƒ½æœ‰æ³¨é‡Šï¼Œå¯ä»¥æŒ‰éœ€å–ç”¨ã€‚&lt;/p>
&lt;h2 id="æ€»ç»“">&lt;a href="#%e6%80%bb%e7%bb%93" class="header-anchor">&lt;/a>æ€»ç»“
&lt;/h2>&lt;p>ä»¥ä¸Šå°±æ˜¯æˆ‘åœ¨è¿ç§»åšå®¢æ—¶é‡åˆ°çš„é—®é¢˜ï¼Œå’Œä¸€äº›å¯¹åº”çš„è§£å†³åŠæ³•ï¼Œè¿˜æœ‰ä¸€äº›è‡ªå®šä¹‰é…ç½®ï¼Œå¸Œæœ›å¯¹ä½ æœ‰æ‰€å¸®åŠ©ã€‚
è§£å†³é—®é¢˜å¤§å¤šæ•°éƒ½æ˜¯åœ¨ &lt;strong>Google&lt;/strong> ä¸Šæœç´¢ï¼Œæˆ–è€…é—® &lt;strong>ChatGPT&lt;/strong>ã€‚&lt;/p>
&lt;p>å› ä¸ºè¿™ç¯‡æ–‡ç« æ˜¯åœ¨è¿ç§»åå†™çš„ï¼Œæ‰€ä»¥æœ‰äº›é—®é¢˜å¯èƒ½ä¼šå¿˜è®°ï¼Œå¦‚æœæ–‡ä¸­æœ‰é”™è¯¯ï¼Œæ¬¢è¿ä½¿ç”¨ &lt;strong>é‚®ç®±&lt;/strong> å’Œæˆ‘äº¤æµã€‚&lt;/p></description></item><item><title>Linuxä¸‹ä½¿ç”¨iouringå®ç°ä¸€ä¸ªtcpæœåŠ¡</title><link>https://lqxhub.github.io/posts/f0e9829c/</link><pubDate>Sun, 20 Oct 2024 17:31:37 +0800</pubDate><guid>https://lqxhub.github.io/posts/f0e9829c/</guid><description>&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/6a84474a44a97bccecbbc9c5a3b9f7aea2571c97.jpg" alt="Featured image of post Linuxä¸‹ä½¿ç”¨iouringå®ç°ä¸€ä¸ªtcpæœåŠ¡" />&lt;p>ä»Šå¹´ä¸€ç›´æ²¡æ€ä¹ˆå†™ä¸œè¥¿ï¼Œçœ‹äº†ä¸€ä¸‹ä¸Šä¸€ç¯‡æ–‡ç« ï¼Œéƒ½è¿‡å»åŠå¹´äº†ã€‚å‰æ®µæ—¶é—´ä¸€ç›´æƒ³å†™ä¸€ç‚¹redisçš„ä¸œè¥¿ï¼Œä½†æ˜¯ä¸€ç›´æ²¡æœ‰æ—¶é—´å»ç ”è¯»æºç ï¼Œæ‰€ä»¥å°±ä¸€ç›´æ²¡æœ‰å†™ã€‚
æœ€è¿‘æœ‰æ—¶é—´ï¼Œçœ‹äº†ä¸€ç‚¹ &lt;strong>iouring&lt;/strong> çš„ä¸œè¥¿ï¼Œå°±å†™äº†ä¸€ç¯‡æ–‡ç« ï¼Œä»‹ç»äº†ä¸€ä¸‹ &lt;strong>iouring&lt;/strong> çš„åŸºæœ¬ä½¿ç”¨ï¼Œå®ç°äº†ä¸€ä¸ªç®€å•çš„TCP server&lt;/p>
&lt;p>å¾ˆæ—©å°±å¬è¯´è¿‡ &lt;strong>iouring&lt;/strong> ï¼Œä½†æ˜¯ä¸€ç›´æ²¡æœ‰æ—¶é—´å­¦ä¹ ã€‚æœ€è¿‘æœ‰æ—¶é—´å°±æ‰¾äº†ä¸€äº›èµ„æ–™ï¼Œå­¦ä¹ äº†ä¸€ä¸‹ï¼Œå†™äº†ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼Œå®ç°äº†ä¸€ä¸ªç®€å•çš„tcpæœåŠ¡ã€‚&lt;/p>
&lt;p>è¿™ç¯‡æ–‡ç« ä¸»è¦ä»‹ç»äº†å¦‚ä½•ä½¿ç”¨ &lt;strong>iouring&lt;/strong> å®ç°ä¸€ä¸ªç®€å•çš„ &lt;strong>tcp&lt;/strong> æœåŠ¡ï¼Œåªæ˜¯ä»‹ç»äº†iouringçš„åŸºæœ¬ä½¿ç”¨ï¼Œæ²¡æœ‰æ¶‰åŠåº•å±‚å®ç°ã€‚
åé¢æœ‰æ—¶é—´å†å»å­¦ä¸€ä¸‹ &lt;strong>liburing&lt;/strong> çš„æºç ï¼Œçœ‹çœ‹åº•å±‚æ˜¯å¦‚ä½•å®ç°çš„ã€‚&lt;/p>
&lt;p>å…ˆè§£é‡Šä¸€ä¸‹ä¸¤ä¸ªåè¯ï¼š&lt;strong>iouring&lt;/strong> å’Œ &lt;strong>liburing&lt;/strong>ã€‚
&lt;strong>iouring&lt;/strong> æ˜¯ &lt;strong>Linux&lt;/strong> å†…æ ¸åœ¨ &lt;strong>5.1&lt;/strong> ç‰ˆæœ¬å¼•å…¥çš„ä¸€ä¸ªæ–°çš„å¼‚æ­¥I/Oæ¥å£ã€‚
&lt;strong>liburing&lt;/strong> æ˜¯ &lt;strong>iouring&lt;/strong> çš„ä¸€ä¸ªç”¨æˆ·æ€åº“ï¼Œå°è£…äº† &lt;strong>iouring&lt;/strong> çš„æ¥å£ï¼Œä½¿å¾—ç”¨æˆ·å¯ä»¥æ›´æ–¹ä¾¿çš„ä½¿ç”¨ &lt;strong>iouring&lt;/strong>ã€‚&lt;/p>
&lt;p>ç®€å•è¯´å°±æ˜¯ &lt;strong>io_uring&lt;/strong> æ˜¯linuxå†…æ ¸çš„åŠŸèƒ½ï¼Œå¯¹å¤–æä¾›äº†ä¸€å¥—å¼‚æ­¥I/Oçš„æ¥å£ã€‚å› ä¸ºç›´æ¥ä½¿ç”¨ linuxå†…æ ¸çš„ &lt;strong>io_uring&lt;/strong> æ¥å£å¤ªéº»çƒ¦äº†ï¼Œ
æ‰€ä»¥åœ¨å°±å†™äº† &lt;strong>liburing&lt;/strong> è¿™ä¸ªåº“ï¼Œå¯¹å†…æ ¸çš„ &lt;strong>io_uring&lt;/strong> å°è£…ï¼Œæä¾›äº†ä¸€å¥—æ›´åŠ å‹å¥½çš„æ¥å£ï¼Œä½¿å¾—ç”¨æˆ·å¯ä»¥æ›´æ–¹ä¾¿çš„ä½¿ç”¨ &lt;strong>io_uring&lt;/strong>ã€‚&lt;/p>
&lt;h2 id="ä»€ä¹ˆæ˜¯iouring">&lt;a href="#%e4%bb%80%e4%b9%88%e6%98%afiouring" class="header-anchor">&lt;/a>ä»€ä¹ˆæ˜¯iouring
&lt;/h2>&lt;p>io_uringæ˜¯Linuxå†…æ ¸åœ¨ &lt;strong>5.1&lt;/strong> ç‰ˆæœ¬å¼•å…¥çš„ä¸€ä¸ªæ–°çš„å¼‚æ­¥I/Oæ¥å£ã€‚
io_uringçš„ç›®æ ‡æ˜¯æä¾›ä¸€ä¸ªé«˜æ•ˆçš„ã€ç»Ÿä¸€çš„å¼‚æ­¥I/Oæ¥å£ï¼Œä»¥æ›¿ä»£ç°æœ‰çš„å¼‚æ­¥I/Oæ¥å£ï¼ˆå¦‚aioã€epollã€eventfdç­‰ï¼‰ã€‚
io_uringçš„è®¾è®¡ç›®æ ‡æ˜¯æä¾›ä¸€ä¸ªç®€å•çš„ã€é«˜æ•ˆçš„ã€ç»Ÿä¸€çš„å¼‚æ­¥I/Oæ¥å£ï¼Œä»¥ä¾¿åº”ç”¨ç¨‹åºå¯ä»¥æ›´å®¹æ˜“åœ°åˆ©ç”¨å¼‚æ­¥I/Oçš„ä¼˜åŠ¿ã€‚&lt;/p>
&lt;p>è™½ç„¶linuxå†…æ ¸æä¾›äº†å¾ˆå¤šå¼‚æ­¥I/Oçš„æ¥å£ï¼Œæ¯”å¦‚aioã€‚
åœ¨linuxä¸Šå¯ä»¥ä½¿ç”¨&lt;/p>
&lt;p>&lt;code>fcntl(sockfd, F_SETFL, fcntl(sockfd, F_GETFL, 0) | O_NONBLOCK);&lt;/code>&lt;/p>
&lt;p>æ¥è®¾ç½® &lt;strong>socket&lt;/strong> ä¸ºéé˜»å¡æ¨¡å¼ï¼Œåç»­åœ¨è¯»å†™ &lt;strong>socket&lt;/strong> çš„ &lt;strong>fd&lt;/strong> æ—¶ï¼Œä½¿ç”¨ &lt;code>read&lt;/code> å’Œ &lt;code>write&lt;/code> å‡½æ•° å°±æ˜¯éé˜»å¡çš„äº†ã€‚&lt;/p>
&lt;p>åœ¨è°ƒç”¨ &lt;code>read&lt;/code> å’Œ &lt;code>write&lt;/code> å‡½æ•°æ—¶ï¼Œå¦‚æœ &lt;strong>fd&lt;/strong> æ²¡æœ‰æ•°æ®ï¼Œæˆ–è€… &lt;strong>fd&lt;/strong> çš„ç¼“å†²åŒºæ»¡äº†ï¼Œé‚£ä¹ˆ &lt;code>read&lt;/code> å’Œ &lt;code>write&lt;/code> å‡½æ•°ä¼šç«‹å³è¿”å›ï¼Œ
ä¸ä¼šé˜»å¡&lt;/p>
&lt;p>ä½†æ˜¯è¿™ç§æ–¹å¼æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯ &lt;strong>read&lt;/strong> å’Œ &lt;strong>write&lt;/strong> å‡½æ•°çš„è°ƒç”¨æ˜¯é˜»å¡çš„ï¼Œè™½ç„¶ &lt;strong>read&lt;/strong> å’Œ &lt;strong>write&lt;/strong> å‡½æ•°ä¼šç«‹å³è¿”å›ï¼Œä½†æ˜¯ &lt;strong>read&lt;/strong> å’Œ &lt;strong>write&lt;/strong> å‡½æ•°çš„è°ƒç”¨æ˜¯é˜»å¡çš„ï¼Œä¼šå ç”¨ &lt;strong>CPU&lt;/strong> çš„èµ„æºã€‚&lt;/p>
&lt;p>å› ä¸ºä¹‹å‰çš„å¼‚æ­¥I/Oæ¥å£ä¸å¤Ÿå¥½ç”¨ï¼Œæ‰€ä»¥ &lt;strong>io_uring&lt;/strong> å°±è¯ç”Ÿäº†ã€‚&lt;/p>
&lt;p>&lt;strong>io_uring&lt;/strong> çš„è®¾è®¡ç›®æ ‡æ˜¯æä¾›ä¸€ä¸ªç®€å•çš„ã€é«˜æ•ˆçš„ã€ç»Ÿä¸€çš„å¼‚æ­¥I/Oæ¥å£ï¼Œä»¥ä¾¿åº”ç”¨ç¨‹åºå¯ä»¥æ›´å®¹æ˜“åœ°åˆ©ç”¨å¼‚æ­¥I/Oçš„ä¼˜åŠ¿ã€‚
ç°åœ¨çš„ &lt;strong>io_uring&lt;/strong> æ”¯æŒ &lt;strong>æ–‡ä»¶ I/O&lt;/strong>ã€&lt;strong>ç½‘ç»œ I/O&lt;/strong>ã€&lt;strong>å®šæ—¶å™¨&lt;/strong>ã€&lt;strong>ä¿¡å·&lt;/strong> ç­‰ã€‚çœŸæ­£çš„ç»Ÿä¸€äº† &lt;strong>I/O&lt;/strong> å¼‚æ­¥æ“ä½œã€‚&lt;/p>
&lt;p>è¯´åˆ°å¼‚æ­¥I/Oï¼Œå°±ä¸å¾—ä¸æä¸€ä¸‹ &lt;strong>epoll&lt;/strong>ã€‚ &lt;strong>epoll&lt;/strong> æ˜¯ &lt;strong>Linux&lt;/strong> å†…æ ¸æä¾›çš„ä¸€ç§ &lt;strong>I/O&lt;/strong> å¤šè·¯å¤ç”¨æœºåˆ¶ï¼Œå¯ä»¥åŒæ—¶ç›‘æ§å¤šä¸ª &lt;strong>fd&lt;/strong> çš„ &lt;strong>I/O&lt;/strong> äº‹ä»¶ã€‚
&lt;strong>epoll&lt;/strong> åªæ˜¯è¿™ä¸ª å¤šè·¯å¤ç”¨æœºåˆ¶ï¼Œåªæ˜¯ç”¨æ¥ç›‘æ§ &lt;strong>fd&lt;/strong> çš„ &lt;strong>I/O&lt;/strong> äº‹ä»¶ï¼Œå½“ &lt;strong>fd&lt;/strong> æœ‰ &lt;strong>I/O&lt;/strong> äº‹ä»¶æ—¶ï¼ˆfd å¯ä»¥è¢«è¯»å†™æ—¶ï¼‰ï¼Œ &lt;strong>epoll&lt;/strong> ä¼šé€šçŸ¥åº”ç”¨ç¨‹åºã€‚
çœŸæ­£çš„ &lt;strong>I/O&lt;/strong> æ“ä½œè¿˜æ˜¯ç”± &lt;strong>read&lt;/strong> å’Œ &lt;strong>write&lt;/strong> å‡½æ•°æ¥å®Œæˆçš„ã€‚
æ‰€ä»¥è¯´ &lt;strong>epoll&lt;/strong> å¹¶ä¸æ˜¯å¼‚æ­¥ &lt;strong>I/O&lt;/strong>ï¼Œåªæ˜¯ &lt;strong>I/O&lt;/strong> å¤šè·¯å¤ç”¨æœºåˆ¶ã€‚&lt;/p>
&lt;h2 id="io_uringçš„åŸºç¡€æ¦‚å¿µ">&lt;a href="#io_uring%e7%9a%84%e5%9f%ba%e7%a1%80%e6%a6%82%e5%bf%b5" class="header-anchor">&lt;/a>io_uringçš„åŸºç¡€æ¦‚å¿µ
&lt;/h2>&lt;p>&lt;strong>io_uring&lt;/strong> æœ‰ä¸¤ä¸ªé‡è¦çš„æ¦‚å¿µï¼š&lt;strong>Submission Queue&lt;/strong> å’Œ &lt;strong>Completion Queue&lt;/strong>ã€‚ ç®€ç§° &lt;strong>sq&lt;/strong> å’Œ &lt;strong>cq&lt;/strong>ã€‚&lt;/p>
&lt;p>&lt;strong>Submission Queue&lt;/strong> æ˜¯ &lt;strong>io_uring&lt;/strong> çš„æäº¤é˜Ÿåˆ—ï¼Œç”¨æ¥æäº¤ &lt;strong>I/O&lt;/strong> è¯·æ±‚ã€‚&lt;/p>
&lt;p>&lt;strong>Completion Queue&lt;/strong> æ˜¯ &lt;strong>io_uring&lt;/strong> çš„å®Œæˆé˜Ÿåˆ—ï¼Œç”¨æ¥å­˜æ”¾ &lt;strong>I/O&lt;/strong> è¯·æ±‚çš„å®ŒæˆçŠ¶æ€ã€‚&lt;/p>
&lt;p>å’Œ &lt;strong>sq&lt;/strong> å’Œ &lt;strong>cq&lt;/strong> ç›¸å¯¹åº”çš„æ˜¯ &lt;strong>sqe&lt;/strong> å’Œ &lt;strong>cqe&lt;/strong>ã€‚&lt;/p>
&lt;p>&lt;strong>sqe&lt;/strong> æ˜¯ &lt;strong>Submission Queue&lt;/strong> çš„å…ƒç´ ï¼Œç”¨æ¥æè¿°ä¸€ä¸ª &lt;strong>I/O&lt;/strong> è¯·æ±‚ã€‚&lt;/p>
&lt;p>&lt;strong>cqe&lt;/strong> æ˜¯ &lt;strong>Completion Queue&lt;/strong> çš„å…ƒç´ ï¼Œç”¨æ¥æè¿°ä¸€ä¸ª &lt;strong>I/O&lt;/strong> è¯·æ±‚çš„å®ŒæˆçŠ¶æ€ã€‚&lt;/p>
&lt;p>æ”¾ä¸€å¼ iouringçš„å·¥ä½œæµç¨‹å›¾ï¼š&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/359587e330204f8a868cf77c92197a417877ae15.png">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/359587e330204f8a868cf77c92197a417877ae15.png" alt="" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>io_uringä¸­éå¸¸é‡è¦çš„ä¸¤ä¸ªæ•°æ®ç»“æ„ &lt;strong>sq&lt;/strong> å’Œ &lt;strong>cq&lt;/strong>ã€‚æ˜¯ç”¨æˆ·ç©ºé—´å’Œå†…æ ¸ç©ºé—´ä¹‹é—´çš„é€šä¿¡æ¡¥æ¢ã€‚&lt;/p>
&lt;p>&lt;strong>io_uring&lt;/strong> çš„å·¥ä½œæµç¨‹å¦‚ä¸‹ï¼š&lt;/p>
&lt;ol>
&lt;li>åº”ç”¨ç¨‹åºå‘ &lt;strong>Submission Queue&lt;/strong> ä¸­æäº¤ &lt;strong>I/O&lt;/strong> è¯·æ±‚ã€‚&lt;/li>
&lt;li>&lt;strong>io_uring&lt;/strong> å†…æ ¸æ¨¡å—ä» &lt;strong>Submission Queue&lt;/strong> ä¸­å–å‡º &lt;strong>I/O&lt;/strong> è¯·æ±‚ï¼Œæ‰§è¡Œ &lt;strong>I/O&lt;/strong> æ“ä½œã€‚&lt;/li>
&lt;li>&lt;strong>io_uring&lt;/strong> å†…æ ¸æ¨¡å—å°† &lt;strong>I/O&lt;/strong> è¯·æ±‚çš„å®ŒæˆçŠ¶æ€å†™å…¥ &lt;strong>Completion Queue&lt;/strong>ã€‚&lt;/li>
&lt;li>åº”ç”¨ç¨‹åºä» &lt;strong>Completion Queue&lt;/strong> ä¸­è¯»å– &lt;strong>I/O&lt;/strong> è¯·æ±‚çš„å®ŒæˆçŠ¶æ€ã€‚&lt;/li>
&lt;li>åº”ç”¨ç¨‹åºå¤„ç† &lt;strong>I/O&lt;/strong> è¯·æ±‚çš„å®ŒæˆçŠ¶æ€ã€‚&lt;/li>
&lt;/ol>
&lt;p>å› ä¸ºè¿™æ¬¡åªæ˜¯ç®€å•çš„ä»‹ç» &lt;strong>iouring&lt;/strong> çš„åŸºæœ¬ä½¿ç”¨ï¼Œæ‰€ä»¥å°±ä¸æ·±å…¥è®² &lt;strong>iouring&lt;/strong> çš„åŸç†äº†ã€‚&lt;/p>
&lt;h2 id="liburingçš„ä½¿ç”¨">&lt;a href="#liburing%e7%9a%84%e4%bd%bf%e7%94%a8" class="header-anchor">&lt;/a>liburingçš„ä½¿ç”¨
&lt;/h2>&lt;p>&lt;strong>liburing&lt;/strong> æ˜¯ &lt;strong>iouring&lt;/strong> çš„ä¸€ä¸ªç”¨æˆ·æ€åº“ï¼Œå°è£…äº† &lt;strong>iouring&lt;/strong> çš„æ¥å£ï¼Œä½¿å¾—ç”¨æˆ·å¯ä»¥æ›´æ–¹ä¾¿çš„ä½¿ç”¨ &lt;strong>iouring&lt;/strong>ã€‚&lt;/p>
&lt;p>liburingä¸­å°è£…äº†å¾ˆå¤šæ“ä½œå‡½æ•°ï¼Œè¿™æ¬¡ä¹Ÿä¸ä¼šå…¨éƒ¨ä»‹ç»ï¼Œåªä»‹ç»ä¸€äº›å¸¸ç”¨çš„å‡½æ•°ã€‚&lt;/p>
&lt;h3 id="liburingå¸¸ç”¨çš„å‡½æ•°">&lt;a href="#liburing%e5%b8%b8%e7%94%a8%e7%9a%84%e5%87%bd%e6%95%b0" class="header-anchor">&lt;/a>liburingå¸¸ç”¨çš„å‡½æ•°
&lt;/h3>&lt;h4 id="io_uring_queue_init">&lt;a href="#io_uring_queue_init" class="header-anchor">&lt;/a>io_uring_queue_init
&lt;/h4>&lt;p>åˆå§‹åŒ– &lt;strong>io_uring&lt;/strong> å¯¹è±¡ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>&lt;span style="color:#8be9fd">int&lt;/span> &lt;span style="color:#50fa7b">io_uring_queue_init&lt;/span>(&lt;span style="color:#8be9fd">unsigned&lt;/span> entries, &lt;span style="color:#ff79c6">struct&lt;/span> &lt;span style="color:#50fa7b">io_uring&lt;/span> &lt;span style="color:#ff79c6">*&lt;/span>ring,&lt;span style="color:#8be9fd">unsigned&lt;/span> flags);
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æœ‰ä¸‰ä¸ªå‚æ•°ï¼š&lt;/p>
&lt;ol>
&lt;li>&lt;strong>entries&lt;/strong>ï¼š &lt;strong>Submission Queue&lt;/strong> å’Œ &lt;strong>Completion Queue&lt;/strong> çš„å¤§å°ã€‚&lt;/li>
&lt;li>&lt;strong>ring&lt;/strong>ï¼š &lt;strong>io_uring&lt;/strong> å¯¹è±¡ã€‚&lt;/li>
&lt;li>&lt;strong>flags&lt;/strong>ï¼š ä¿ç•™å‚æ•°ï¼Œä¼  &lt;strong>0&lt;/strong> å³å¯ã€‚&lt;/li>
&lt;/ol>
&lt;h4 id="io_uring_queue_exit">&lt;a href="#io_uring_queue_exit" class="header-anchor">&lt;/a>io_uring_queue_exit
&lt;/h4>&lt;p>é”€æ¯ &lt;strong>io_uring&lt;/strong> å¯¹è±¡ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>&lt;span style="color:#8be9fd">void&lt;/span> &lt;span style="color:#50fa7b">io_uring_queue_exit&lt;/span>(&lt;span style="color:#ff79c6">struct&lt;/span> &lt;span style="color:#50fa7b">io_uring&lt;/span> &lt;span style="color:#ff79c6">*&lt;/span>ring);
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä¼ å…¥ &lt;strong>io_uring&lt;/strong> å¯¹è±¡å³å¯ã€‚&lt;/p>
&lt;h4 id="io_uring_get_sqe">&lt;a href="#io_uring_get_sqe" class="header-anchor">&lt;/a>io_uring_get_sqe
&lt;/h4>&lt;p>è·å– &lt;strong>Submission Queue&lt;/strong> çš„å…ƒç´ ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">struct&lt;/span> &lt;span style="color:#50fa7b">io_uring_sqe&lt;/span> &lt;span style="color:#ff79c6">*&lt;/span>&lt;span style="color:#50fa7b">io_uring_get_sqe&lt;/span>(&lt;span style="color:#ff79c6">struct&lt;/span> &lt;span style="color:#50fa7b">io_uring&lt;/span> &lt;span style="color:#ff79c6">*&lt;/span>ring);
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä¼ å…¥ &lt;strong>io_uring&lt;/strong> å¯¹è±¡ï¼Œè¿”å›ä¸€ä¸ª &lt;strong>sqe&lt;/strong> å¯¹è±¡ï¼Œç”¨æ¥æè¿°ä¸€ä¸ª &lt;strong>I/O&lt;/strong> è¯·æ±‚ã€‚&lt;/p>
&lt;h4 id="io_uring_submit">&lt;a href="#io_uring_submit" class="header-anchor">&lt;/a>io_uring_submit
&lt;/h4>&lt;p>æäº¤ &lt;strong>I/O&lt;/strong> è¯·æ±‚ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>&lt;span style="color:#8be9fd">int&lt;/span> &lt;span style="color:#50fa7b">io_uring_submit&lt;/span>(&lt;span style="color:#ff79c6">struct&lt;/span> &lt;span style="color:#50fa7b">io_uring&lt;/span> &lt;span style="color:#ff79c6">*&lt;/span>ring);
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä¼ å…¥ &lt;strong>io_uring&lt;/strong> å¯¹è±¡ï¼Œæäº¤ &lt;strong>I/O&lt;/strong> è¯·æ±‚ã€‚&lt;/p>
&lt;h4 id="io_uring_wait_cqe">&lt;a href="#io_uring_wait_cqe" class="header-anchor">&lt;/a>io_uring_wait_cqe
&lt;/h4>&lt;p>ç­‰å¾… &lt;strong>I/O&lt;/strong> è¯·æ±‚çš„å®ŒæˆçŠ¶æ€ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>&lt;span style="color:#8be9fd">int&lt;/span> &lt;span style="color:#50fa7b">io_uring_wait_cqe&lt;/span>(&lt;span style="color:#ff79c6">struct&lt;/span> &lt;span style="color:#50fa7b">io_uring&lt;/span> &lt;span style="color:#ff79c6">*&lt;/span>ring, &lt;span style="color:#ff79c6">struct&lt;/span> &lt;span style="color:#50fa7b">io_uring_cqe&lt;/span> &lt;span style="color:#ff79c6">**&lt;/span>cqe_ptr);
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä¼ å…¥ &lt;strong>io_uring&lt;/strong> å¯¹è±¡ï¼Œè¿”å› &lt;strong>cqe&lt;/strong> å¯¹è±¡ï¼Œç”¨æ¥æè¿°ä¸€ä¸ª &lt;strong>I/O&lt;/strong> è¯·æ±‚çš„å®ŒæˆçŠ¶æ€ã€‚&lt;/p>
&lt;h4 id="io_uring_submit_and_wait">&lt;a href="#io_uring_submit_and_wait" class="header-anchor">&lt;/a>io_uring_submit_and_wait
&lt;/h4>&lt;p>æäº¤ &lt;strong>I/O&lt;/strong> è¯·æ±‚ï¼Œå¹¶ç­‰å¾… &lt;strong>I/O&lt;/strong> è¯·æ±‚çš„å®ŒæˆçŠ¶æ€ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>&lt;span style="color:#8be9fd">int&lt;/span> &lt;span style="color:#50fa7b">io_uring_submit_and_wait&lt;/span>(&lt;span style="color:#ff79c6">struct&lt;/span> &lt;span style="color:#50fa7b">io_uring&lt;/span> &lt;span style="color:#ff79c6">*&lt;/span>ring, &lt;span style="color:#8be9fd">unsigned&lt;/span> wait_nr);
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä¼ å…¥ &lt;strong>io_uring&lt;/strong> å¯¹è±¡ï¼Œæäº¤ &lt;strong>I/O&lt;/strong> è¯·æ±‚ï¼Œå¹¶ç­‰å¾… &lt;strong>I/O&lt;/strong> è¯·æ±‚çš„å®ŒæˆçŠ¶æ€ã€‚&lt;/p>
&lt;p>å¯ä»¥çœ‹åšæ˜¯ &lt;strong>io_uring_submit&lt;/strong> å’Œ &lt;strong>io_uring_wait_cqe&lt;/strong> çš„ç»„åˆã€‚&lt;/p>
&lt;h4 id="io_uring_prep_accept">&lt;a href="#io_uring_prep_accept" class="header-anchor">&lt;/a>io_uring_prep_accept
&lt;/h4>&lt;p>å‘ &lt;strong>Submission Queue&lt;/strong> ä¸­æ·»åŠ ä¸€ä¸ª &lt;strong>accept&lt;/strong> è¯·æ±‚ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>&lt;span style="color:#8be9fd">void&lt;/span> &lt;span style="color:#50fa7b">io_uring_prep_accept&lt;/span>(&lt;span style="color:#ff79c6">struct&lt;/span> &lt;span style="color:#50fa7b">io_uring_sqe&lt;/span> &lt;span style="color:#ff79c6">*&lt;/span>sqe, &lt;span style="color:#8be9fd">int&lt;/span> fd, &lt;span style="color:#ff79c6">struct&lt;/span> &lt;span style="color:#50fa7b">sockaddr&lt;/span> &lt;span style="color:#ff79c6">*&lt;/span>addr, socklen_t &lt;span style="color:#ff79c6">*&lt;/span>addrlen, &lt;span style="color:#8be9fd">int&lt;/span> flags);
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æœ‰äº”ä¸ªå‚æ•°ï¼š&lt;/p>
&lt;ol>
&lt;li>&lt;strong>sqe&lt;/strong>ï¼š &lt;strong>Submission Queue&lt;/strong> çš„å…ƒç´ ã€‚&lt;/li>
&lt;li>&lt;strong>fd&lt;/strong>ï¼š &lt;strong>socket&lt;/strong> çš„ &lt;strong>fd&lt;/strong>ã€‚&lt;/li>
&lt;li>&lt;strong>addr&lt;/strong>ï¼š &lt;strong>sockaddr&lt;/strong> ç»“æ„ä½“ã€‚&lt;/li>
&lt;li>&lt;strong>addrlen&lt;/strong>ï¼š &lt;strong>sockaddr&lt;/strong> ç»“æ„ä½“çš„é•¿åº¦ã€‚&lt;/li>
&lt;li>&lt;strong>flags&lt;/strong>ï¼š ä¿ç•™å‚æ•°ï¼Œä¼  &lt;strong>0&lt;/strong> å³å¯ã€‚&lt;/li>
&lt;/ol>
&lt;h4 id="io_uring_prep_recv">&lt;a href="#io_uring_prep_recv" class="header-anchor">&lt;/a>io_uring_prep_recv
&lt;/h4>&lt;p>å‘ &lt;strong>Submission Queue&lt;/strong> ä¸­æ·»åŠ ä¸€ä¸ª &lt;strong>recv&lt;/strong> è¯·æ±‚ï¼Œä¹Ÿå°±æ˜¯ä»fdä¸­å¼‚æ­¥è¯»å–æ•°æ®ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>&lt;span style="color:#8be9fd">void&lt;/span> &lt;span style="color:#50fa7b">io_uring_prep_recv&lt;/span>(&lt;span style="color:#ff79c6">struct&lt;/span> &lt;span style="color:#50fa7b">io_uring_sqe&lt;/span> &lt;span style="color:#ff79c6">*&lt;/span>sqe, &lt;span style="color:#8be9fd">int&lt;/span> fd, &lt;span style="color:#8be9fd">void&lt;/span> &lt;span style="color:#ff79c6">*&lt;/span>buf, &lt;span style="color:#8be9fd">unsigned&lt;/span> nbytes, &lt;span style="color:#8be9fd">unsigned&lt;/span> flags);
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æœ‰äº”ä¸ªå‚æ•°ï¼š&lt;/p>
&lt;ol>
&lt;li>&lt;strong>sqe&lt;/strong>ï¼š &lt;strong>Submission Queue&lt;/strong> çš„å…ƒç´ ã€‚&lt;/li>
&lt;li>&lt;strong>fd&lt;/strong>ï¼š &lt;strong>socket&lt;/strong> çš„ &lt;strong>fd&lt;/strong>ã€‚&lt;/li>
&lt;li>&lt;strong>buf&lt;/strong>ï¼š æ¥æ”¶æ•°æ®çš„ç¼“å†²åŒº,ä¸€èˆ¬æ˜¯ &lt;code>char&lt;/code> æ•°ç»„çš„åœ°å€ã€‚&lt;/li>
&lt;li>&lt;strong>nbytes&lt;/strong>ï¼š ç¼“å†²åŒºçš„å¤§å°ã€‚&lt;/li>
&lt;li>&lt;strong>flags&lt;/strong>ï¼š ä¿ç•™å‚æ•°ï¼Œä¼  &lt;strong>0&lt;/strong> å³å¯ã€‚&lt;/li>
&lt;/ol>
&lt;h4 id="io_uring_prep_send">&lt;a href="#io_uring_prep_send" class="header-anchor">&lt;/a>io_uring_prep_send
&lt;/h4>&lt;p>å‘ &lt;strong>Submission Queue&lt;/strong> ä¸­æ·»åŠ ä¸€ä¸ª &lt;strong>send&lt;/strong> è¯·æ±‚ï¼Œä¹Ÿå°±æ˜¯å‘fdä¸­å¼‚æ­¥å†™å…¥æ•°æ®ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>&lt;span style="color:#8be9fd">void&lt;/span> &lt;span style="color:#50fa7b">io_uring_prep_send&lt;/span>(&lt;span style="color:#ff79c6">struct&lt;/span> &lt;span style="color:#50fa7b">io_uring_sqe&lt;/span> &lt;span style="color:#ff79c6">*&lt;/span>sqe, &lt;span style="color:#8be9fd">int&lt;/span> fd, &lt;span style="color:#ff79c6">const&lt;/span> &lt;span style="color:#8be9fd">void&lt;/span> &lt;span style="color:#ff79c6">*&lt;/span>buf, &lt;span style="color:#8be9fd">unsigned&lt;/span> nbytes, &lt;span style="color:#8be9fd">unsigned&lt;/span> flags);
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æœ‰äº”ä¸ªå‚æ•°ï¼š&lt;/p>
&lt;ol>
&lt;li>&lt;strong>sqe&lt;/strong>ï¼š &lt;strong>Submission Queue&lt;/strong> çš„å…ƒç´ ã€‚&lt;/li>
&lt;li>&lt;strong>fd&lt;/strong>ï¼š &lt;strong>socket&lt;/strong> çš„ &lt;strong>fd&lt;/strong>ã€‚&lt;/li>
&lt;li>&lt;strong>buf&lt;/strong>ï¼š å‘é€æ•°æ®çš„ç¼“å†²åŒºï¼Œä¸€èˆ¬æ˜¯ &lt;code>char&lt;/code> æŒ‡é’ˆçš„åœ°å€ã€‚&lt;/li>
&lt;li>&lt;strong>nbytes&lt;/strong>ï¼š ç¼“å†²åŒºçš„å¤§å°ã€‚&lt;/li>
&lt;li>&lt;strong>flags&lt;/strong>ï¼š ä¿ç•™å‚æ•°ï¼Œä¼  &lt;strong>0&lt;/strong> å³å¯ã€‚&lt;/li>
&lt;/ol>
&lt;h4 id="io_uring_sqe_set_data">&lt;a href="#io_uring_sqe_set_data" class="header-anchor">&lt;/a>io_uring_sqe_set_data
&lt;/h4>&lt;p>è®¾ç½® &lt;strong>sqe&lt;/strong> çš„æ•°æ®ï¼ŒæŠŠç”¨æˆ·æ€çš„æ•°æ®å’Œå†…æ ¸ç»‘å®šã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>&lt;span style="color:#8be9fd">void&lt;/span> &lt;span style="color:#50fa7b">io_uring_sqe_set_data&lt;/span>(&lt;span style="color:#ff79c6">struct&lt;/span> &lt;span style="color:#50fa7b">io_uring_sqe&lt;/span> &lt;span style="color:#ff79c6">*&lt;/span>sqe, &lt;span style="color:#8be9fd">void&lt;/span> &lt;span style="color:#ff79c6">*&lt;/span>data);
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä¼ å…¥ &lt;strong>sqe&lt;/strong> å¯¹è±¡å’Œç”¨æˆ·æ€çš„æ•°æ®ï¼ŒæŠŠç”¨æˆ·æ€çš„æ•°æ®å’Œå†…æ ¸ç»‘å®šã€‚&lt;/p>
&lt;h4 id="io_uring_cqe_seen">&lt;a href="#io_uring_cqe_seen" class="header-anchor">&lt;/a>io_uring_cqe_seen
&lt;/h4>&lt;p>æ ‡è®° &lt;strong>cqe&lt;/strong> ä¸ºå·²å¤„ç†ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>&lt;span style="color:#8be9fd">void&lt;/span> &lt;span style="color:#50fa7b">io_uring_cqe_seen&lt;/span>(&lt;span style="color:#ff79c6">struct&lt;/span> &lt;span style="color:#50fa7b">io_uring&lt;/span> &lt;span style="color:#ff79c6">*&lt;/span>ring, &lt;span style="color:#ff79c6">struct&lt;/span> &lt;span style="color:#50fa7b">io_uring_cqe&lt;/span> &lt;span style="color:#ff79c6">*&lt;/span>cqe);
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä¼ å…¥ &lt;strong>io_uring&lt;/strong> å¯¹è±¡å’Œ &lt;strong>cqe&lt;/strong> å¯¹è±¡ï¼Œæ ‡è®° &lt;strong>cqe&lt;/strong> ä¸ºå·²å¤„ç†ã€‚&lt;/p>
&lt;h3 id="å®ç°ä¸€ä¸ªç®€å•çš„tcpæœåŠ¡">&lt;a href="#%e5%ae%9e%e7%8e%b0%e4%b8%80%e4%b8%aa%e7%ae%80%e5%8d%95%e7%9a%84tcp%e6%9c%8d%e5%8a%a1" class="header-anchor">&lt;/a>å®ç°ä¸€ä¸ªç®€å•çš„tcpæœåŠ¡
&lt;/h3>&lt;p>&lt;strong>io_uring&lt;/strong> åªèƒ½åœ¨ &lt;strong>linux&lt;/strong> å†…æ ¸ &lt;strong>5.1&lt;/strong> ä»¥ä¸Šç‰ˆæœ¬ä½¿ç”¨ï¼Œæ‰€ä»¥åœ¨ä½¿ç”¨io_uringä¹‹å‰ï¼Œéœ€è¦å…ˆæ£€æŸ¥ä¸€ä¸‹å†…æ ¸ç‰ˆæœ¬ã€‚
ä¸€èˆ¬æœ€æ–°çš„ &lt;strong>ubuntu&lt;/strong> å’Œ &lt;strong>Debian&lt;/strong> éƒ½æ˜¯æ”¯æŒ &lt;strong>io_uring&lt;/strong> çš„ã€‚&lt;/p>
&lt;p>ä½¿ç”¨ &lt;strong>liburing&lt;/strong> éœ€è¦å®‰è£… &lt;strong>liburing&lt;/strong> åº“ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>sudo apt-get install liburing-dev
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ &lt;strong>tcp&lt;/strong> æœåŠ¡ï¼ŒåŠŸèƒ½æ˜¯æ¥æ”¶å®¢æˆ·ç«¯çš„è¿æ¥ï¼Œç„¶åå‘å®¢æˆ·ç«¯å‘é€ä¸€æ¡æ¶ˆæ¯ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">#include&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;iostream&amp;gt;&lt;/span>&lt;span style="color:#ff79c6">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span>&lt;span style="color:#ff79c6">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span>&lt;span style="color:#ff79c6">#include&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;liburing.h&amp;gt;&lt;/span>&lt;span style="color:#ff79c6">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span>&lt;span style="color:#ff79c6">#include&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;netinet/in.h&amp;gt;&lt;/span>&lt;span style="color:#ff79c6">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span>&lt;span style="color:#ff79c6">#include&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;map&amp;gt;&lt;/span>&lt;span style="color:#ff79c6">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span>&lt;span style="color:#ff79c6">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span>&lt;span style="color:#ff79c6">const&lt;/span> &lt;span style="color:#8be9fd">int&lt;/span> QUEUE_DEPTH &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#bd93f9">128&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span>&lt;span style="color:#ff79c6">const&lt;/span> &lt;span style="color:#8be9fd">int&lt;/span> BUFFER_SIZE &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#bd93f9">4096&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 10&lt;/span>&lt;span>&lt;span style="color:#ff79c6">enum&lt;/span> &lt;span style="color:#50fa7b">ConnectionType&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 11&lt;/span>&lt;span> ACCEPT,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 12&lt;/span>&lt;span> READ,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 13&lt;/span>&lt;span> WRITE,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 14&lt;/span>&lt;span>};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 15&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 16&lt;/span>&lt;span>&lt;span style="color:#ff79c6">struct&lt;/span> &lt;span style="color:#50fa7b">Connection&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 17&lt;/span>&lt;span> &lt;span style="color:#8be9fd">int&lt;/span> fd;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 18&lt;/span>&lt;span> &lt;span style="color:#8be9fd">int&lt;/span> type{};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 19&lt;/span>&lt;span> &lt;span style="color:#8be9fd">char&lt;/span> readBuf[BUFFER_SIZE]{};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 20&lt;/span>&lt;span> std&lt;span style="color:#ff79c6">::&lt;/span>string writeBuf;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 21&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 22&lt;/span>&lt;span> &lt;span style="color:#ff79c6">explicit&lt;/span> &lt;span style="color:#50fa7b">Connection&lt;/span>(&lt;span style="color:#8be9fd">int&lt;/span> _fd) { fd &lt;span style="color:#ff79c6">=&lt;/span> _fd; }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 23&lt;/span>&lt;span>};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 24&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 25&lt;/span>&lt;span>std&lt;span style="color:#ff79c6">::&lt;/span>map&lt;span style="color:#ff79c6">&amp;lt;&lt;/span>&lt;span style="color:#8be9fd">int&lt;/span>, Connection &lt;span style="color:#ff79c6">*&amp;gt;&lt;/span> connections;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 26&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 27&lt;/span>&lt;span>&lt;span style="color:#8be9fd">int&lt;/span> &lt;span style="color:#50fa7b">createListener&lt;/span>(sockaddr_in &lt;span style="color:#ff79c6">*&lt;/span>addr) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 28&lt;/span>&lt;span> &lt;span style="color:#8be9fd">int&lt;/span> listener &lt;span style="color:#ff79c6">=&lt;/span> socket(AF_INET, SOCK_STREAM, &lt;span style="color:#bd93f9">0&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 29&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (listener &lt;span style="color:#ff79c6">&amp;lt;&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 30&lt;/span>&lt;span> std&lt;span style="color:#ff79c6">::&lt;/span>cerr &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;socket failed errno:&amp;#34;&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> errno &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> std&lt;span style="color:#ff79c6">::&lt;/span>endl;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 31&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> &lt;span style="color:#ff79c6">-&lt;/span>&lt;span style="color:#bd93f9">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 32&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 33&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 34&lt;/span>&lt;span> &lt;span style="color:#8be9fd">int&lt;/span> opt &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#bd93f9">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 35&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (setsockopt(listener, SOL_SOCKET, SO_REUSEADDR, &lt;span style="color:#ff79c6">&amp;amp;&lt;/span>opt, &lt;span style="color:#ff79c6">sizeof&lt;/span>(opt)) &lt;span style="color:#ff79c6">&amp;lt;&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 36&lt;/span>&lt;span> std&lt;span style="color:#ff79c6">::&lt;/span>cerr &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;setsockopt failed errno:&amp;#34;&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> errno &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> std&lt;span style="color:#ff79c6">::&lt;/span>endl;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 37&lt;/span>&lt;span> close(listener);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 38&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> &lt;span style="color:#ff79c6">-&lt;/span>&lt;span style="color:#bd93f9">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 39&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 40&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 41&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (bind(listener, &lt;span style="color:#ff79c6">reinterpret_cast&lt;/span>&lt;span style="color:#ff79c6">&amp;lt;&lt;/span>sockaddr &lt;span style="color:#ff79c6">*&amp;gt;&lt;/span>(addr), &lt;span style="color:#ff79c6">sizeof&lt;/span>(&lt;span style="color:#ff79c6">*&lt;/span>addr)) &lt;span style="color:#ff79c6">&amp;lt;&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 42&lt;/span>&lt;span> std&lt;span style="color:#ff79c6">::&lt;/span>cerr &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;bind failed errno:&amp;#34;&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> errno &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> std&lt;span style="color:#ff79c6">::&lt;/span>endl;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 43&lt;/span>&lt;span> close(listener);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 44&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> &lt;span style="color:#ff79c6">-&lt;/span>&lt;span style="color:#bd93f9">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 45&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 46&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 47&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (listen(listener, &lt;span style="color:#bd93f9">10&lt;/span>) &lt;span style="color:#ff79c6">&amp;lt;&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 48&lt;/span>&lt;span> std&lt;span style="color:#ff79c6">::&lt;/span>cerr &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;listen failed errno:&amp;#34;&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> errno &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> std&lt;span style="color:#ff79c6">::&lt;/span>endl;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 49&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> &lt;span style="color:#ff79c6">-&lt;/span>&lt;span style="color:#bd93f9">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 50&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 51&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 52&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> listener;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 53&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 54&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 55&lt;/span>&lt;span>&lt;span style="color:#8be9fd">void&lt;/span> &lt;span style="color:#50fa7b">acceptConnection&lt;/span>(io_uring &lt;span style="color:#ff79c6">*&lt;/span>ring, Connection &lt;span style="color:#ff79c6">*&lt;/span>conn, sockaddr &lt;span style="color:#ff79c6">*&lt;/span>addr, socklen_t &lt;span style="color:#ff79c6">*&lt;/span>clientLen) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 56&lt;/span>&lt;span> conn&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>type &lt;span style="color:#ff79c6">=&lt;/span> ACCEPT;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 57&lt;/span>&lt;span> &lt;span style="color:#ff79c6">auto&lt;/span> sqe &lt;span style="color:#ff79c6">=&lt;/span> io_uring_get_sqe(ring);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 58&lt;/span>&lt;span> io_uring_prep_accept(sqe, conn&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>fd, addr, clientLen, &lt;span style="color:#bd93f9">0&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 59&lt;/span>&lt;span> io_uring_sqe_set_data(sqe, conn);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 60&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 61&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 62&lt;/span>&lt;span>&lt;span style="color:#8be9fd">void&lt;/span> &lt;span style="color:#50fa7b">addSocketRead&lt;/span>(io_uring &lt;span style="color:#ff79c6">*&lt;/span>ring, Connection &lt;span style="color:#ff79c6">*&lt;/span>conn) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 63&lt;/span>&lt;span> conn&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>type &lt;span style="color:#ff79c6">=&lt;/span> READ;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 64&lt;/span>&lt;span> &lt;span style="color:#ff79c6">auto&lt;/span> sqe &lt;span style="color:#ff79c6">=&lt;/span> io_uring_get_sqe(ring);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 65&lt;/span>&lt;span> io_uring_prep_recv(sqe, conn&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>fd, &lt;span style="color:#ff79c6">&amp;amp;&lt;/span>conn&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>readBuf, BUFFER_SIZE, &lt;span style="color:#bd93f9">0&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 66&lt;/span>&lt;span> io_uring_sqe_set_data(sqe, conn);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 67&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 68&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 69&lt;/span>&lt;span>&lt;span style="color:#8be9fd">void&lt;/span> &lt;span style="color:#50fa7b">addSocketWrite&lt;/span>(io_uring &lt;span style="color:#ff79c6">*&lt;/span>ring, Connection &lt;span style="color:#ff79c6">*&lt;/span>conn) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 70&lt;/span>&lt;span> conn&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>type &lt;span style="color:#ff79c6">=&lt;/span> WRITE;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 71&lt;/span>&lt;span> &lt;span style="color:#ff79c6">auto&lt;/span> sqe &lt;span style="color:#ff79c6">=&lt;/span> io_uring_get_sqe(ring);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 72&lt;/span>&lt;span> io_uring_prep_send(sqe, conn&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>fd, conn&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>writeBuf.data(), conn&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>writeBuf.size(), &lt;span style="color:#bd93f9">0&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 73&lt;/span>&lt;span> io_uring_sqe_set_data(sqe, conn);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 74&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 75&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 76&lt;/span>&lt;span>Connection &lt;span style="color:#ff79c6">*&lt;/span>&lt;span style="color:#50fa7b">newConn&lt;/span>(io_uring &lt;span style="color:#ff79c6">*&lt;/span>ring, &lt;span style="color:#8be9fd">int&lt;/span> fd) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 77&lt;/span>&lt;span> &lt;span style="color:#ff79c6">auto&lt;/span> conn &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#ff79c6">new&lt;/span> Connection(fd);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 78&lt;/span>&lt;span> connections[fd] &lt;span style="color:#ff79c6">=&lt;/span> conn;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 79&lt;/span>&lt;span> addSocketRead(ring, conn);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 80&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> conn;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 81&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 82&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 83&lt;/span>&lt;span>&lt;span style="color:#8be9fd">int&lt;/span> &lt;span style="color:#50fa7b">uringRun&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 84&lt;/span>&lt;span> sockaddr_in addr{};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 85&lt;/span>&lt;span> addr.sin_family &lt;span style="color:#ff79c6">=&lt;/span> AF_INET;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 86&lt;/span>&lt;span> addr.sin_port &lt;span style="color:#ff79c6">=&lt;/span> htons(&lt;span style="color:#bd93f9">8088&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 87&lt;/span>&lt;span> addr.sin_addr.s_addr &lt;span style="color:#ff79c6">=&lt;/span> INADDR_ANY;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 88&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 89&lt;/span>&lt;span> &lt;span style="color:#8be9fd">int&lt;/span> listenFd &lt;span style="color:#ff79c6">=&lt;/span> createListener(&lt;span style="color:#ff79c6">&amp;amp;&lt;/span>addr);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 90&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (listenFd &lt;span style="color:#ff79c6">&amp;lt;&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 91&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> &lt;span style="color:#bd93f9">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 92&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 93&lt;/span>&lt;span> socklen_t clientLen &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#ff79c6">sizeof&lt;/span>(addr);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 94&lt;/span>&lt;span> io_uring ring{};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 95&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (io_uring_queue_init(QUEUE_DEPTH, &lt;span style="color:#ff79c6">&amp;amp;&lt;/span>ring, &lt;span style="color:#bd93f9">0&lt;/span>) &lt;span style="color:#ff79c6">&amp;lt;&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 96&lt;/span>&lt;span> std&lt;span style="color:#ff79c6">::&lt;/span>cerr &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;io_uring_queue_init failed errno:&amp;#34;&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> errno &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> std&lt;span style="color:#ff79c6">::&lt;/span>endl;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 97&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> &lt;span style="color:#bd93f9">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 98&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 99&lt;/span>&lt;span> &lt;span style="color:#ff79c6">auto&lt;/span> lConn &lt;span style="color:#ff79c6">=&lt;/span> newConn(&lt;span style="color:#ff79c6">&amp;amp;&lt;/span>ring, listenFd);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">100&lt;/span>&lt;span> acceptConnection(&lt;span style="color:#ff79c6">&amp;amp;&lt;/span>ring, lConn, &lt;span style="color:#ff79c6">reinterpret_cast&lt;/span>&lt;span style="color:#ff79c6">&amp;lt;&lt;/span>sockaddr &lt;span style="color:#ff79c6">*&amp;gt;&lt;/span> (&lt;span style="color:#ff79c6">&amp;amp;&lt;/span>addr), &lt;span style="color:#ff79c6">&amp;amp;&lt;/span>clientLen);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">101&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (io_uring_submit(&lt;span style="color:#ff79c6">&amp;amp;&lt;/span>ring) &lt;span style="color:#ff79c6">&amp;lt;&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">102&lt;/span>&lt;span> std&lt;span style="color:#ff79c6">::&lt;/span>cerr &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;io_uring_submit failed errno:&amp;#34;&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> errno &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> std&lt;span style="color:#ff79c6">::&lt;/span>endl;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">103&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> &lt;span style="color:#bd93f9">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">104&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">105&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">106&lt;/span>&lt;span> io_uring_cqe &lt;span style="color:#ff79c6">*&lt;/span>cqes[QUEUE_DEPTH];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">107&lt;/span>&lt;span> &lt;span style="color:#ff79c6">while&lt;/span> (&lt;span style="color:#8be9fd;font-style:italic">true&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">108&lt;/span>&lt;span> &lt;span style="color:#6272a4">//ç­‰å¾…äº‹ä»¶å®Œæˆ
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">109&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#8be9fd">int&lt;/span> ret &lt;span style="color:#ff79c6">=&lt;/span> io_uring_submit_and_wait(&lt;span style="color:#ff79c6">&amp;amp;&lt;/span>ring, &lt;span style="color:#bd93f9">1&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">110&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (ret &lt;span style="color:#ff79c6">&amp;lt;&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">111&lt;/span>&lt;span> std&lt;span style="color:#ff79c6">::&lt;/span>cerr &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;io_uring_wait_cqe failed errno:&amp;#34;&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> errno &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> std&lt;span style="color:#ff79c6">::&lt;/span>endl;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">112&lt;/span>&lt;span> &lt;span style="color:#ff79c6">break&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">113&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">114&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">115&lt;/span>&lt;span> &lt;span style="color:#6272a4">//è·å–å®Œæˆçš„äº‹ä»¶
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">116&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">auto&lt;/span> num &lt;span style="color:#ff79c6">=&lt;/span> io_uring_peek_batch_cqe(&lt;span style="color:#ff79c6">&amp;amp;&lt;/span>ring, cqes, QUEUE_DEPTH);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">117&lt;/span>&lt;span> &lt;span style="color:#ff79c6">for&lt;/span> (&lt;span style="color:#8be9fd">int&lt;/span> i &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>; i &lt;span style="color:#ff79c6">&amp;lt;&lt;/span> num; &lt;span style="color:#ff79c6">++&lt;/span>i) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">118&lt;/span>&lt;span> &lt;span style="color:#ff79c6">auto&lt;/span> conn &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#ff79c6">reinterpret_cast&lt;/span>&lt;span style="color:#ff79c6">&amp;lt;&lt;/span>Connection &lt;span style="color:#ff79c6">*&amp;gt;&lt;/span> (cqes[i]&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>user_data);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">119&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (conn&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>type &lt;span style="color:#ff79c6">==&lt;/span> ACCEPT) {&lt;span style="color:#6272a4">//æ–°è¿æ¥
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">120&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#8be9fd">int&lt;/span> clientFd &lt;span style="color:#ff79c6">=&lt;/span> cqes[i]&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>res;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">121&lt;/span>&lt;span> &lt;span style="color:#ff79c6">auto&lt;/span> newCLi &lt;span style="color:#ff79c6">=&lt;/span> newConn(&lt;span style="color:#ff79c6">&amp;amp;&lt;/span>ring, clientFd);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">122&lt;/span>&lt;span> addSocketRead(&lt;span style="color:#ff79c6">&amp;amp;&lt;/span>ring, newCLi);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">123&lt;/span>&lt;span> acceptConnection(&lt;span style="color:#ff79c6">&amp;amp;&lt;/span>ring, lConn, &lt;span style="color:#ff79c6">reinterpret_cast&lt;/span>&lt;span style="color:#ff79c6">&amp;lt;&lt;/span>sockaddr &lt;span style="color:#ff79c6">*&amp;gt;&lt;/span> (&lt;span style="color:#ff79c6">&amp;amp;&lt;/span>addr), &lt;span style="color:#ff79c6">&amp;amp;&lt;/span>clientLen);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">124&lt;/span>&lt;span> } &lt;span style="color:#ff79c6">else&lt;/span> &lt;span style="color:#ff79c6">if&lt;/span> (conn&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>type &lt;span style="color:#ff79c6">==&lt;/span> READ) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">125&lt;/span>&lt;span> &lt;span style="color:#8be9fd">int&lt;/span> readSize &lt;span style="color:#ff79c6">=&lt;/span> cqes[i]&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>res;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">126&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (readSize &lt;span style="color:#ff79c6">&amp;lt;&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>) {&lt;span style="color:#6272a4">//è¯»å–å¤±è´¥(æ¯”å¦‚å®¢æˆ·ç«¯æ–­å¼€è¿æ¥)
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">127&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> shutdown(conn&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>fd, SHUT_RDWR);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">128&lt;/span>&lt;span> connections.erase(conn&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>fd);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">129&lt;/span>&lt;span> &lt;span style="color:#ff79c6">delete&lt;/span> conn;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">130&lt;/span>&lt;span> } &lt;span style="color:#ff79c6">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">131&lt;/span>&lt;span> std&lt;span style="color:#ff79c6">::&lt;/span>cout &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;read:&amp;#34;&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> conn&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>readBuf &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> std&lt;span style="color:#ff79c6">::&lt;/span>endl;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">132&lt;/span>&lt;span> conn&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>writeBuf &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;hello client&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">133&lt;/span>&lt;span> addSocketWrite(&lt;span style="color:#ff79c6">&amp;amp;&lt;/span>ring, conn);&lt;span style="color:#6272a4">//å‘å®¢æˆ·ç«¯å†™æ•°æ®
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">134&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">135&lt;/span>&lt;span> } &lt;span style="color:#ff79c6">else&lt;/span> &lt;span style="color:#ff79c6">if&lt;/span> (conn&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>type &lt;span style="color:#ff79c6">==&lt;/span> WRITE) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">136&lt;/span>&lt;span> addSocketRead(&lt;span style="color:#ff79c6">&amp;amp;&lt;/span>ring, conn);&lt;span style="color:#6272a4">// æŠŠè¿™ä¸ªè¿æ¥åŠ å…¥è¯»äº‹ä»¶
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">137&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">138&lt;/span>&lt;span> io_uring_cqe_seen(&lt;span style="color:#ff79c6">&amp;amp;&lt;/span>ring, cqes[i]);&lt;span style="color:#6272a4">// mark the cqe as processed
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">139&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">140&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">141&lt;/span>&lt;span> io_uring_queue_exit(&lt;span style="color:#ff79c6">&amp;amp;&lt;/span>ring);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">142&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">143&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">144&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">145&lt;/span>&lt;span>&lt;span style="color:#8be9fd">int&lt;/span> &lt;span style="color:#50fa7b">main&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">146&lt;/span>&lt;span> uringRun();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">147&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">148&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ç¼–è¯‘è¿™æ®µä»£ç çš„æ—¶å€™ï¼Œéœ€è¦é“¾æ¥ &lt;strong>liburing&lt;/strong> åº“ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>g++ -o server server.cpp -luring
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>createListener&lt;/code> å‡½æ•°ç”¨æ¥åˆ›å»ºä¸€ä¸ª &lt;strong>socket&lt;/strong> ç›‘å¬ &lt;strong>8088&lt;/strong> ç«¯å£ã€‚è¿™ä¸ªå‡½æ•°æ²¡ä»€ä¹ˆç‰¹åˆ«çš„ï¼Œå°±æ˜¯åˆ›å»ºä¸€ä¸ª &lt;strong>socket&lt;/strong>ï¼Œç„¶åç»‘å®š &lt;strong>8088&lt;/strong> ç«¯å£ï¼Œç„¶åç›‘å¬ã€‚&lt;/p>
&lt;p>&lt;code>acceptConnection&lt;/code> å‡½æ•°ç”¨æ¥æ¥æ”¶å®¢æˆ·ç«¯çš„è¿æ¥ã€‚è¿™ä¸ªå‡½æ•°è°ƒç”¨ &lt;strong>io_uring_prep_accept&lt;/strong> å‡½æ•°ï¼Œå‘ &lt;strong>Submission Queue&lt;/strong> ä¸­æ·»åŠ ä¸€ä¸ª &lt;strong>accept&lt;/strong> è¯·æ±‚ã€‚&lt;/p>
&lt;p>&lt;code>addSocketRead&lt;/code> å‡½æ•°ç”¨æ¥å‘ &lt;strong>Submission Queue&lt;/strong> ä¸­æ·»åŠ ä¸€ä¸ª &lt;strong>recv&lt;/strong> è¯·æ±‚ï¼Œä¹Ÿå°±æ˜¯ä» &lt;strong>fd&lt;/strong> ä¸­å¼‚æ­¥è¯»å–æ•°æ®ã€‚&lt;/p>
&lt;p>&lt;code>addSocketWrite&lt;/code> å‡½æ•°ç”¨æ¥å‘ &lt;strong>Submission Queue&lt;/strong> ä¸­æ·»åŠ ä¸€ä¸ª &lt;strong>send&lt;/strong> è¯·æ±‚ï¼Œä¹Ÿå°±æ˜¯å‘ &lt;strong>fd&lt;/strong> ä¸­å¼‚æ­¥å†™å…¥æ•°æ®ã€‚&lt;/p>
&lt;p>&lt;code>newConn&lt;/code> å‡½æ•°ç”¨æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„è¿æ¥ã€‚è¿™ä¸ªå‡½æ•°ä¼šè°ƒç”¨ &lt;code>addSocketRead&lt;/code> å‡½æ•°ï¼Œå‘ &lt;strong>Submission Queue&lt;/strong> ä¸­æ·»åŠ ä¸€ä¸ª &lt;strong>recv&lt;/strong> è¯·æ±‚ã€‚&lt;/p>
&lt;p>&lt;code>uringRun&lt;/code> å‡½æ•°æ˜¯ä¸»å‡½æ•°ã€‚è¿™ä¸ªå‡½æ•°ä¼šåˆ›å»ºä¸€ä¸ª &lt;strong>io_uring&lt;/strong> å¯¹è±¡ï¼Œç„¶åè°ƒç”¨ &lt;code>createListener&lt;/code> å‡½æ•°åˆ›å»ºä¸€ä¸ªç›‘å¬ &lt;strong>socket&lt;/strong>ï¼Œç„¶åè°ƒç”¨ &lt;code>newConn&lt;/code> å‡½æ•°åˆ›å»ºä¸€ä¸ªæ–°çš„è¿æ¥ã€‚&lt;/p>
&lt;p>æœ‰ä¸€ä¸ªçŸ¥è¯†ç‚¹éœ€è¦æ³¨æ„ä¸€ä¸‹ï¼Œåœ¨ io_uringä¸­ï¼Œæ¯æ¬¡è·å–çš„ &lt;strong>cqe&lt;/strong> åœ¨ä½¿ç”¨å®Œä¹‹åï¼Œéœ€è¦è°ƒç”¨ &lt;code>io_uring_cqe_seen&lt;/code> å‡½æ•°ï¼Œæ ‡è®° &lt;strong>cqe&lt;/strong> ä¸ºå·²å¤„ç†ã€‚
åŒæ—¶å¤„ç†çš„æ—¶å€™ï¼Œä¹Ÿä¼šæŠŠ è¿™ä¸ª &lt;strong>cqe&lt;/strong> ä» &lt;strong>Completion Queue&lt;/strong> ä¸­ç§»é™¤ï¼Œå¯¹åº”çš„ &lt;code>fd&lt;/code> ä¹Ÿä¼šä» &lt;strong>io_uring&lt;/strong> ä¸­ç§»é™¤ã€‚
æ‰€ä»¥ï¼Œä¸ºäº†ä¿è¯åç»­èƒ½ç»§ç»­æ¥æ”¶åˆ° &lt;strong>fd&lt;/strong> çš„ &lt;strong>I/O&lt;/strong> äº‹ä»¶ï¼Œéœ€è¦åœ¨å¤„ç†å®Œ &lt;strong>cqe&lt;/strong> ä¹‹åï¼Œå†æ¬¡è°ƒç”¨ &lt;code>addSocketRead&lt;/code> å‡½æ•°ï¼Œå‘ &lt;strong>Submission Queue&lt;/strong> ä¸­æ·»åŠ ä¸€ä¸ª &lt;strong>recv&lt;/strong> è¯·æ±‚ã€‚&lt;/p>
&lt;p>è¿™äº›å‡½æ•°çš„å†…å®¹éƒ½æ¯”è¾ƒç®€å•ï¼Œå°±ä¸å†è¯¦ç»†ä»‹ç»äº†ã€‚ä¸»è¦çœ‹ä¸€ä¸‹ &lt;strong>while&lt;/strong> å¾ªç¯çš„å†…å®¹ã€‚&lt;/p>
&lt;p>&lt;code>int ret = io_uring_submit_and_wait(&amp;amp;ring, 1);&lt;/code> è¿™ä¸ªå‡½æ•°ä¼šæäº¤ &lt;strong>I/O&lt;/strong> è¯·æ±‚ï¼Œå¹¶ç­‰å¾… &lt;strong>I/O&lt;/strong> è¯·æ±‚çš„å®ŒæˆçŠ¶æ€ã€‚è¿™ä¸ªå‡½æ•°ä¼šé˜»å¡ï¼Œç›´åˆ°æœ‰ 1ä¸ª &lt;strong>I/O&lt;/strong> è¯·æ±‚å®Œæˆã€‚&lt;/p>
&lt;p>è¿™é‡Œå¯ä»¥ä½¿ç”¨ &lt;code>io_uring_submit&lt;/code> è¿™ä¸ªå‡½æ•°åªæäº¤ &lt;strong>I/O&lt;/strong> è¯·æ±‚ï¼Œä¸ç­‰å¾… &lt;strong>I/O&lt;/strong> è¯·æ±‚çš„å®ŒæˆçŠ¶æ€ã€‚ä½†æ˜¯è¿™æ ·çš„è¯ï¼Œwhileå¾ªç¯ä¼šä¸€ç›´å¾ªç¯ï¼Œä¸ä¼šé˜»å¡ï¼Œå¯¹åº”çš„è¡¨ç°å°±æ˜¯ &lt;strong>CPU&lt;/strong> å ç”¨ç‡ä¼šå¾ˆé«˜ã€‚
è¿™ç§æƒ…å†µé€‚ç”¨äº &lt;strong>I/O&lt;/strong> è¯·æ±‚æ¯”è¾ƒå¤šçš„æƒ…å†µï¼Œæ¯”å¦‚ &lt;strong>nginx&lt;/strong> è¿™ç§ &lt;strong>web&lt;/strong> æœåŠ¡å™¨ã€‚&lt;/p>
&lt;p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä½¿ç”¨ &lt;code>io_uring_submit_and_wait&lt;/code> è¿™ä¸ªå‡½æ•°å°±å¯ä»¥äº†ã€‚&lt;/p>
&lt;p>å¦‚æœ è¿”å›çš„ &lt;strong>ret&lt;/strong> å°äº &lt;strong>0&lt;/strong>ï¼Œè¯´æ˜å‡ºé”™äº†ï¼Œè¿™é‡Œç®€å•çš„æ‰“å°ä¸€ä¸‹é”™è¯¯ä¿¡æ¯ï¼Œç„¶åé€€å‡ºã€‚&lt;/p>
&lt;p>&lt;code>auto num = io_uring_peek_batch_cqe(&amp;amp;ring, cqes, QUEUE_DEPTH);&lt;/code> è¿™ä¸ªå‡½æ•°ä¼šè·å– &lt;strong>Completion Queue&lt;/strong> ä¸­çš„ &lt;strong>cqe&lt;/strong>ï¼Œä¸€æ¬¡æœ€å¤šè·å– &lt;strong>QUEUE_DEPTH&lt;/strong> ä¸ª &lt;strong>cqe&lt;/strong>ã€‚&lt;/p>
&lt;p>è¿™ä¸ªå‡½æ•°æœ‰ç‚¹ç±»ä¼¼äº &lt;strong>epoll&lt;/strong> çš„ &lt;strong>epoll_wait&lt;/strong> å‡½æ•°ï¼Œä¼šä¸€æ¬¡æ€§è·å–å¤šä¸ª &lt;strong>cqe&lt;/strong>ã€‚&lt;/p>
&lt;p>ç„¶åéå† &lt;strong>cqe&lt;/strong>ï¼Œæ ¹æ® &lt;strong>cqe&lt;/strong> çš„ &lt;strong>type&lt;/strong> æ¥å¤„ç† &lt;strong>I/O&lt;/strong> äº‹ä»¶ã€‚åœ¨ä¹‹å‰çš„submitçš„æ—¶å€™ï¼ŒæŒ‡å®šäº†æœ‰ &lt;strong>ACCEPT&lt;/strong>ã€&lt;strong>READ&lt;/strong>ã€&lt;strong>WRITE&lt;/strong> ä¸‰ç§ &lt;strong>I/O&lt;/strong> äº‹ä»¶ã€‚&lt;/p>
&lt;p>å› ä¸ºä¹‹å‰çš„ &lt;strong>cqe&lt;/strong> ä¸­çš„ &lt;strong>user_data&lt;/strong> æ˜¯ &lt;strong>Connection&lt;/strong> å¯¹è±¡çš„æŒ‡é’ˆï¼Œæ‰€ä»¥å¯ä»¥æ ¹æ® &lt;strong>cqe&lt;/strong> çš„ &lt;strong>user_data&lt;/strong> æ¥è·å– &lt;strong>Connection&lt;/strong> å¯¹è±¡ï¼Œç„¶åæ ¹æ® &lt;strong>Connection&lt;/strong> å¯¹è±¡çš„ &lt;strong>type&lt;/strong> æ¥å¤„ç† &lt;strong>I/O&lt;/strong> äº‹ä»¶ã€‚
æ‰€ä»¥å¯ä»¥ &lt;code>reinterpret_cast&amp;lt;Connection *&amp;gt; (cqes[i]-&amp;gt;user_data);&lt;/code>å¼ºè½¬æ¥è·å– &lt;strong>Connection&lt;/strong> å¯¹è±¡ã€‚&lt;/p>
&lt;p>å¦‚æœ &lt;strong>type&lt;/strong> æ˜¯ &lt;strong>ACCEPT&lt;/strong>ï¼Œè¯´æ˜æ˜¯æ–°çš„è¿æ¥ï¼Œå°±è°ƒç”¨ &lt;code>newConn&lt;/code> å‡½æ•°åˆ›å»ºä¸€ä¸ªæ–°çš„è¿æ¥ï¼Œç„¶åè°ƒç”¨ &lt;code>acceptConnection&lt;/code> å‡½æ•°æ¥æ”¶æ–°çš„è¿æ¥ã€‚
åœ¨æ¥æ”¶æ–°çš„è¿æ¥ä¹‹åï¼Œéœ€è¦å†æ¬¡è°ƒç”¨ &lt;code>acceptConnection&lt;/code> å‡½æ•°ï¼ŒæŠŠlistenerçš„socketæ”¾å›io_uringä¸­ï¼Œåé¢æ‰èƒ½ç»§ç»­å·¥ä½œã€‚&lt;/p>
&lt;p>å¦‚æœ &lt;strong>type&lt;/strong> æ˜¯ &lt;strong>READ&lt;/strong>ï¼Œè¯´æ˜æ˜¯è¯»äº‹ä»¶ï¼Œå°±è¯»å– &lt;strong>cqe&lt;/strong> çš„ &lt;strong>res&lt;/strong> å­—æ®µï¼Œå¦‚æœå°äº &lt;strong>0&lt;/strong>ï¼Œè¯´æ˜è¯»å–å¤±è´¥ï¼Œæ¯”å¦‚å®¢æˆ·ç«¯æ–­å¼€è¿æ¥ï¼Œå°±å…³é—­ &lt;strong>fd&lt;/strong>ï¼Œç„¶åä» &lt;strong>connections&lt;/strong> ä¸­ç§»é™¤è¿™ä¸ª &lt;strong>fd&lt;/strong>ï¼Œç„¶åé‡Šæ”¾ &lt;strong>Connection&lt;/strong> å¯¹è±¡ã€‚
å¦‚æœè¯»å–æˆåŠŸï¼Œå°±æ‰“å°è¯»å–çš„æ•°æ®ï¼Œç„¶åå‘å®¢æˆ·ç«¯å‘é€ä¸€æ¡æ¶ˆæ¯ã€‚&lt;/p>
&lt;p>å¦‚æœ &lt;strong>type&lt;/strong> æ˜¯ &lt;strong>WRITE&lt;/strong>ï¼Œè¯´æ˜æ˜¯å†™äº‹ä»¶ï¼Œåœ¨è¿™é‡Œå°±æ˜¯å‘å®¢æˆ·ç«¯å†™æ•°æ®å®Œæˆäº†ã€‚
è°ƒç”¨ &lt;code>addSocketRead&lt;/code> å‡½æ•°ï¼Œå‘ &lt;strong>Submission Queue&lt;/strong> ä¸­æ·»åŠ ä¸€ä¸ª è¯»çš„è¯·æ±‚ï¼Œç„¶åè¿™ä¸ª &lt;strong>fd&lt;/strong> å°±ä¼šç»§ç»­æ¥æ”¶ &lt;strong>I/O&lt;/strong> äº‹ä»¶ã€‚&lt;/p>
&lt;p>æœ€åè°ƒç”¨ &lt;code>io_uring_cqe_seen&lt;/code> å‡½æ•°ï¼Œæ ‡è®° &lt;strong>cqe&lt;/strong> ä¸ºå·²å¤„ç†ã€‚&lt;/p>
&lt;p>è¿™æ ·ä¸€ä¸ªç®€å•çš„ &lt;strong>tcp&lt;/strong> æœåŠ¡å°±å®ç°äº†ã€‚è¿™ä¸ªæœåŠ¡åªæ˜¯ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼Œæ²¡æ³•ç”¨åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œåªæ˜¯ç”¨æ¥å­¦ä¹  &lt;strong>iouring&lt;/strong> çš„åŸºæœ¬ä½¿ç”¨ã€‚&lt;/p>
&lt;p>åƒæ˜¯ä¸­é—´çš„é”™è¯¯å¤„ç†ï¼Œè¿æ¥çš„è¶…æ—¶ç­‰é—®é¢˜éƒ½æ²¡æœ‰å¤„ç†ï¼Œè¿™äº›é—®é¢˜éœ€è¦æ ¹æ®å®é™…æƒ…å†µæ¥å¤„ç†ã€‚&lt;/p>
&lt;p>è¿™ä¸ªä¾‹å­ä¸­ï¼Œä¸€ä¸ª &lt;strong>socket&lt;/strong> åŒæ—¶åªèƒ½è¯»æˆ–è€…å†™ï¼Œä¸èƒ½åŒæ—¶è¯»å†™ï¼Œè¿™ä¸ªé—®é¢˜ä¹Ÿéœ€è¦æ ¹æ®å®é™…æƒ…å†µæ¥å¤„ç†ã€‚&lt;/p>
&lt;h2 id="æ€»ç»“">&lt;a href="#%e6%80%bb%e7%bb%93" class="header-anchor">&lt;/a>æ€»ç»“
&lt;/h2>&lt;p>è¿™ç¯‡æ–‡ç« ä¸»è¦ä»‹ç»äº† &lt;strong>iouring&lt;/strong> çš„åŸºæœ¬ä½¿ç”¨ï¼Œå®ç°äº†ä¸€ä¸ªç®€å•çš„ &lt;strong>tcp&lt;/strong> æœåŠ¡ã€‚åªæ˜¯ä»‹ç»äº† &lt;strong>iouring&lt;/strong> çš„åŸºæœ¬ä½¿ç”¨ï¼Œæ²¡æœ‰æ¶‰åŠåº•å±‚å®ç°ã€‚
åé¢æœ‰æ—¶é—´å†å»å­¦ä¸€ä¸‹ &lt;strong>liburing&lt;/strong> çš„æºç ï¼Œçœ‹çœ‹åº•å±‚æ˜¯å¦‚ä½•å®ç°çš„ã€‚&lt;/p>
&lt;p>å…¶å® &lt;strong>iouring&lt;/strong> æœ€ä¸»è¦çš„ä¸¤ä¸ªæ“ä½œæ˜¯æäº¤ &lt;strong>I/O&lt;/strong> è¯·æ±‚åˆ° &lt;strong>sq&lt;/strong> ï¼Œç„¶åç­‰å¾… &lt;strong>I/O&lt;/strong> è¯·æ±‚çš„å®Œæˆå,ä» &lt;strong>cq&lt;/strong> è·å–ç„¶åå¤„ç†ã€‚&lt;/p>
&lt;p>çœ‹å¾ˆå¤šäººéƒ½è¯´ &lt;strong>iouring&lt;/strong> æ€§èƒ½å¾ˆé«˜ï¼Œå°¤å…¶æ˜¯åœ¨ &lt;strong>I/O&lt;/strong> å¯†é›†å‹çš„åœºæ™¯ä¸‹ï¼Œæ€§èƒ½æå‡å¾ˆæ˜æ˜¾ã€‚è¿™éƒ¨åˆ†å†…å®¹è¿˜æ²¡æœ‰éªŒè¯ï¼Œåé¢æœ‰æ—¶é—´å†å»éªŒè¯ä¸€ä¸‹ã€‚&lt;/p>
&lt;p>å› ä¸ºä¹Ÿæ˜¯åˆå­¦ &lt;strong>iouring&lt;/strong>ï¼Œæ‰€ä»¥æ–‡ç« ä¸­å¯èƒ½æœ‰é”™è¯¯ï¼Œæ¬¢è¿æ‰¹è¯„æŒ‡æ­£ã€‚&lt;/p>
&lt;hr>
&lt;h2 id="è¿½æ›´">&lt;a href="#%e8%bf%bd%e6%9b%b4" class="header-anchor">&lt;/a>è¿½æ›´
&lt;/h2>&lt;p>&lt;strong>2024-10-23&lt;/strong>&lt;/p>
&lt;p>åœ¨æœåŠ¡ç«¯åŠ äº†ä¸€ç‚¹ä»£ç ï¼Œå†™äº†ä¸€ä¸ªç®€å•çš„ &lt;strong>HTTP&lt;/strong> æœåŠ¡å™¨ï¼Œå¯ä»¥é€šè¿‡æµè§ˆå™¨è®¿é—®ï¼Œç„¶åæ‰¾äº†ä¸€ä¸ª HTTP å‹æµ‹å·¥å…·ï¼Œæµ‹è¯•äº†ä¸€ä¸‹æ€§èƒ½ã€‚&lt;/p>
&lt;p>HTTP æœåŠ¡å™¨è¿”å›çš„å†…å®¹ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>conn&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>writeBuf &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;HTTP/1.1 200 OK&lt;/span>&lt;span style="color:#f1fa8c">\r\n&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span> &lt;span style="color:#f1fa8c">&amp;#34;Content-Length: 55&lt;/span>&lt;span style="color:#f1fa8c">\r\n&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3&lt;/span>&lt;span> &lt;span style="color:#f1fa8c">&amp;#34;Content-Type: text/html&lt;/span>&lt;span style="color:#f1fa8c">\r\n&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4&lt;/span>&lt;span> &lt;span style="color:#f1fa8c">&amp;#34;Connection: keep-alive&lt;/span>&lt;span style="color:#f1fa8c">\r\n&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5&lt;/span>&lt;span> &lt;span style="color:#f1fa8c">&amp;#34;Date: Mon, 23 Oct 2024 13:24:24 GMT&lt;/span>&lt;span style="color:#f1fa8c">\r\n\r\n&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6&lt;/span>&lt;span> &lt;span style="color:#f1fa8c">&amp;#34;&amp;lt;!DOCTYPE html&amp;gt;&amp;lt;html&amp;gt;&amp;lt;body&amp;gt;&amp;lt;h1&amp;gt;hello&amp;lt;/h1&amp;gt;&amp;lt;/body&amp;gt;&amp;lt;/html&amp;gt;&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>åŒæ ·çš„ï¼Œä½¿ç”¨ &lt;strong>epoll&lt;/strong> ä¹Ÿå®ç°äº†ä¸€ä¸ª &lt;strong>HTTP&lt;/strong> æœåŠ¡å™¨ï¼Œè¿”å›äº†åŒæ ·çš„å†…å®¹ã€‚&lt;/p>
&lt;p>å‡ è½®æµ‹è¯•ä¸‹æ¥ï¼Œå‘ç° &lt;strong>epoll&lt;/strong> çš„æ€§èƒ½è¦æ¯” &lt;strong>iouring&lt;/strong> é«˜ä¸€ç‚¹ã€‚è‡³äºåŸå› è¿˜åœ¨ç ”ç©¶ä¸­ã€‚&lt;/p>
&lt;p>çŒœæµ‹çš„åŸå› å¯èƒ½æ˜¯ åœ¨æ•°æ®é‡å¾ˆå°çš„æ—¶å€™ï¼Œ &lt;strong>iouring&lt;/strong> çš„æ€§èƒ½å‘æŒ¥ä¸å‡ºæ¥ï¼Œç”šè‡³æ•ˆæœæ›´å·®äº†ã€‚
è¿˜æœ‰ä¸€ä¸ªåŸå› å¯èƒ½æ˜¯æˆ‘ä½¿ç”¨çš„æ–¹æ³•æœ‰é—®é¢˜ï¼Œè¿™ä¸ªç­‰åé¢ç»§ç»­ç ”ç©¶ã€‚&lt;/p></description></item><item><title>redis ACLä½¿ç”¨æ‰‹å†Œï¼Œredis6.0 redis ä¸­ä½¿ç”¨ACLæ‰‹å†Œ - QX's blog</title><link>https://lqxhub.github.io/posts/1cb4847b/</link><pubDate>Sun, 10 Mar 2024 18:32:52 +0000</pubDate><guid>https://lqxhub.github.io/posts/1cb4847b/</guid><description>&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/20210321231957647.png" alt="Featured image of post redis ACLä½¿ç”¨æ‰‹å†Œï¼Œredis6.0 redis ä¸­ä½¿ç”¨ACLæ‰‹å†Œ - QX's blog" />&lt;p>redisåœ¨ 6.0 ç‰ˆæœ¬åŠ å…¥äº†ACLæ”¯æŒï¼Œè™½ç„¶å·²ç»å‘å¸ƒå¾ˆä¹…äº†ï¼Œä½†æ˜¯è¿™ä¸ªå‘½ä»¤å±äºä¸å¤ªå¸¸ç”¨çš„å‘½ä»¤ï¼Œå¯¼è‡´å¾ˆå¤šäººå¯¹ACLè¿˜ä¸å¤ªäº†è§£ã€‚æ¯”è¾ƒå¥½çš„æ–‡æ¡£å°±æ˜¯redis &lt;a class="link" href="https://redis.io/docs/management/security/acl/" target="_blank" rel="noopener"
>ACLçš„å®˜æ–¹æ–‡æ¡£&lt;/a> ï¼Œå…¶ä»–ç½‘ä¸Šæœç´¢åˆ°çš„ç›¸å…³çŸ¥è¯†å¤§å¤šæ•°ä¸å…¨é¢ï¼Œå°¤å…¶ä¸­æ–‡æ–‡æ¡£ç¼ºå¤±æ¯”è¾ƒå¤šã€‚&lt;/p>
&lt;p>æˆ‘ä¹‹å‰å†™è¿‡ä¸€ç¯‡ &lt;a class="link" href="https://lqxhub.github.io/posts/eeb1e692/" target="_blank" rel="noopener"
>redis ACLæºç åˆ†æçš„æ–‡ç« &lt;/a>ã€‚ä½†æ˜¯è¿™ç¯‡æ–‡ç« åå‘æºç å­¦ä¹ ï¼Œå¯¹ACLçš„ä½¿ç”¨åŸºæœ¬æ²¡æœ‰ä»‹ç»ã€‚æ‰€ä»¥è¿™æ¬¡å°±æ¥å†™ä¸€ä¸‹ ACL çš„ä½¿ç”¨ã€‚æˆ‘ä½œä¸º pika ACL åŠŸèƒ½çš„è´¡çŒ®è€…ï¼Œ&lt;a class="link" href="https://github.com/OpenAtomFoundation/pika/pull/2013" target="_blank" rel="noopener"
>pika ACL PR&lt;/a>ï¼Œè‡ªè®¤ä¸ºå¯¹ACLæœ‰ä¸€äº›äº†è§£ï¼Œå¦‚æœæ–‡ä¸­æœ‰é”™è¯¯ï¼Œè¿˜è¯·ä¸åèµæ•™ã€‚&lt;/p>
&lt;p>æˆ‘ä¼šä» &lt;strong>ACLåŠŸèƒ½çš„ä»‹ç»&lt;/strong> å’Œ &lt;strong>ACLå‘½ä»¤çš„ä½¿ç”¨&lt;/strong> ä¸¤æ–¹é¢æ¥å†™&lt;/p>
&lt;h2 id="aclåŠŸèƒ½">&lt;a href="#acl%e5%8a%9f%e8%83%bd" class="header-anchor">&lt;/a>ACLåŠŸèƒ½
&lt;/h2>&lt;p>ACLç®€å•æ¥è¯´ï¼Œå°±æ˜¯ç»™redisåŠ äº†ç”¨æˆ·çš„æ¦‚å¿µã€‚ä»¥å‰çš„redisä¸­ï¼Œæ²¡æœ‰ç”¨æˆ·è¿™ä¸ªæ¦‚å¿µï¼Œåªæœ‰ä¸€ä¸ªå¯†ç ã€‚å½“ä¸€ä¸ªè¿æ¥å®Œæˆè®¤è¯åï¼Œå¯ä»¥æ‰§è¡Œæ‰€æœ‰å‘½ä»¤ã€‚è¿™æ ·æ˜¯æœ‰é£é™©çš„ï¼Œå¦‚æœä¸€ä¸ªæ™®é€šçš„ç”¨æˆ·ï¼Œæ‰§è¡Œäº† &lt;code>flushall&lt;/code> è¿™æ ·çš„å‘½ä»¤ï¼Œæ•´ä¸ªredisçš„æ•°æ®éƒ½ä¼šè¢«åˆ é™¤ã€‚å½“åŠ å…¥äº†ç”¨æˆ·è¿™ä¸ªæ¦‚å¿µä»¥åï¼Œrediså¯ä»¥é€šè¿‡ç»™ä¸åŒçš„ç”¨æˆ·åˆ’åˆ†ä¸åŒçš„æƒé™ï¼Œæ¯”å¦‚æ™®é€šç”¨æˆ·åªç»™æ•°æ®çš„è¯»å†™æƒé™ï¼Œä¸èƒ½å¯¹redisæœåŠ¡åšä»»ä½•ç®¡ç†ã€‚è¿™æ ·å°±èƒ½ä¿è¯redisæœåŠ¡çš„å®‰å…¨å’Œç¨³å®šã€‚&lt;/p>
&lt;p>å°±åƒMySQLä¸€æ ·ï¼Œæœ‰ä¸€ä¸ªé»˜è®¤çš„ &lt;strong>root&lt;/strong> ç”¨æˆ·ï¼Œè¿™ä¸ªç”¨æˆ·æ‹¥æœ‰æœ€é«˜çš„æƒé™ã€‚ä½†æ˜¯åœ¨å®é™…ä½¿ç”¨ä¸­ï¼Œä¸ä¼šåœ¨ä¸šåŠ¡å¤„ç†çš„è¿æ¥ä¸­ä½¿ç”¨rootç”¨æˆ·ï¼Œè€Œæ˜¯åˆ›å»ºä¸€ä¸ªæ™®é€šçš„ç”¨æˆ·ã€‚é™åˆ¶è¿™ä¸ªç”¨æˆ·çš„æƒé™ï¼Œåªèƒ½æ“ä½œè‡ªå·±ä¸šåŠ¡çš„åº“ã€‚å½“redisæœ‰äº†ACLåŠŸèƒ½åï¼Œä¹Ÿå¯ä»¥å®ç°ç±»ä¼¼çš„åŠŸèƒ½äº†&lt;/p>
&lt;h3 id="ä½¿ç”¨acl">&lt;a href="#%e4%bd%bf%e7%94%a8acl" class="header-anchor">&lt;/a>ä½¿ç”¨ACL
&lt;/h3>&lt;p>åœ¨redisä½¿ç”¨ACLä¸éœ€è¦ç‰¹æ®Šçš„é…ç½®ï¼Œåªè¦redisç‰ˆæœ¬æ”¯æŒè¿™ä¸ªåŠŸèƒ½å³å¯ã€‚redisåœ¨å¯åŠ¨çš„æ—¶å€™ï¼Œä¼šåˆå§‹åŒ–ä¸€ä¸ªé»˜è®¤ç”¨æˆ· &lt;strong>default&lt;/strong> è¿™ä¸ªç”¨æˆ·å°±ç›¸å½“äºMySQLä¸­çš„ &lt;strong>root&lt;/strong> ç”¨æˆ·ã€‚é»˜è®¤æ‹¥æœ‰æ‰€æœ‰æƒé™ã€‚&lt;/p>
&lt;p>æ“ä½œå’Œä¿®æ”¹redisçš„ACLï¼Œå¯ä»¥ä½¿ç”¨redisä¸­ACLçš„ç›¸å…³å‘½ä»¤ï¼ˆåé¢ä¼šé€ä¸ªä»‹ç»ï¼‰ï¼Œå¯ä»¥åœ¨é…ç½®æ–‡ä»¶ä¸­é¢„å…ˆè®¾å®šï¼Œå¯åŠ¨redisçš„æ—¶å€™ä¼šè‡ªåŠ¨åŠ è½½é¢„è®¾çš„ACLè§„åˆ™ã€‚&lt;/p>
&lt;p>å¯ä»¥åœ¨redisçš„é…ç½®æ–‡ä»¶ï¼ˆé»˜è®¤æ˜¯&lt;strong>redis.conf&lt;/strong>ï¼‰ä¸­è¿›è¡Œé…ç½®ã€‚&lt;/p>
&lt;p>ä¾‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-fallback" data-lang="fallback">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>user default on nopass ~* &amp;amp;* +@ALL
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™å°±æ˜¯ä¸€æ¡ACLçš„é…ç½®ã€‚&lt;/p>
&lt;p>é™¤äº†åœ¨ redis.confè¿™é…ç½®ä»¥å¤–ï¼Œè¿˜å¯ä»¥åœ¨ redis.conf ä¸­æŒ‡å®šä¸€ä¸ªæ–‡ä»¶ï¼Œç„¶ååœ¨æŒ‡å®šçš„æ–‡ä»¶ä¸­é…ç½®ACLè§„åˆ™ã€‚
ACLæ–‡ä»¶åœ¨redis.confé…ç½®å¦‚ä¸‹&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-fallback" data-lang="fallback">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>aclfile /etc/redis/users.acl
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>é™¤äº†è¿™ä¸¤ä¸ªå¤–ï¼ŒACLå‡ ä¸ªä¸ªé…ç½®&lt;/p>
&lt;p>ACL logè®°å½•çš„æ¡æ•°ï¼Œlogçš„ä½œç”¨å°±æ˜¯è®°å½•ç”¨æˆ·è¶Šæƒè¡Œä¸ºã€‚&lt;/p>
&lt;p>é…ç½®ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-fallback" data-lang="fallback">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>acllog-max-len 128
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ACL ä¸­channel çš„é»˜è®¤çŠ¶æ€ã€‚å¯ä»¥é…ç½® &lt;code>allchannels&lt;/code> æˆ– &lt;code>resetchannels&lt;/code>ã€‚&lt;/p>
&lt;ul>
&lt;li>&lt;code>allchannels&lt;/code>ï¼š å¯ä»¥è®¿é—®æ‰€æœ‰Pub/Subé¢‘é“çš„æƒé™&lt;/li>
&lt;li>&lt;code>resetchannels&lt;/code>ï¼š æ’¤é”€å¯¹æ‰€æœ‰Pub/Subé¢‘é“çš„è®¿é—®&lt;/li>
&lt;/ul>
&lt;p>é…ç½®ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-fallback" data-lang="fallback">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>acl-pubsub-default resetchannels
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="aclé…ç½®è¯­æ³•">&lt;a href="#acl%e9%85%8d%e7%bd%ae%e8%af%ad%e6%b3%95" class="header-anchor">&lt;/a>ACLé…ç½®è¯­æ³•
&lt;/h3>&lt;p>é¦–å…ˆï¼ŒACLå¯ä»¥å¯¹ &lt;strong>å‘½ä»¤&lt;/strong>ï¼Œ&lt;strong>keyçš„åå­—&lt;/strong>ï¼Œ&lt;strong>channel&lt;/strong> åšé™åˆ¶ï¼Œå¤šä¸ªè§„åˆ™ä¹‹é—´ç”¨ç©ºæ ¼åˆ†å‰²ã€‚&lt;/p>
&lt;p>&lt;code>user1 on &amp;gt;123 ~* &amp;amp;* +@ALL&lt;/code> è¿™æ¡é…ç½®ä¸­ã€‚&lt;/p>
&lt;ul>
&lt;li>&lt;code>user1&lt;/code>ï¼šç”¨æˆ·å&lt;/li>
&lt;li>&lt;code>on&lt;/code>ï¼šç”¨æˆ·å¯ç”¨ï¼Œå¦‚æœè®¾ç½®ä¸º &lt;code>off&lt;/code> é‚£ä¹ˆç”¨æˆ·ä¸èƒ½ä½¿ç”¨&lt;/li>
&lt;li>&lt;code>&amp;gt;123&lt;/code>ï¼š ç”¨æˆ·å¯†ç &lt;/li>
&lt;li>&lt;code>~*&lt;/code>ï¼šä¸åšä»»ä½• keyåå­—çš„é™åˆ¶&lt;/li>
&lt;li>&lt;code>&amp;amp;*&lt;/code>ï¼šä¸åš pub/sub çš„é™åˆ¶&lt;/li>
&lt;li>&lt;code>+@ALL&lt;/code>ï¼šå…è®¸æ‰§è¡Œæ‰€æœ‰å‘½ä»¤&lt;/li>
&lt;/ul>
&lt;h4 id="å¯†ç ">&lt;a href="#%e5%af%86%e7%a0%81" class="header-anchor">&lt;/a>å¯†ç 
&lt;/h4>&lt;p>redis ACLä¸­ï¼Œä¸€ä¸ªç”¨æˆ·å¯ä»¥æœ‰å¤šä¸ªå¯†ç ï¼Œåªè¦æœ‰ä¸€ä¸ªå¯†ç è®¤è¯æˆåŠŸå°±å¯ä»¥ã€‚ä¹Ÿå¯ä»¥ä½¿ç”¨ &lt;code>nopass&lt;/code> è¿™ä¸ªå…³é”®è¯æ¥è¡¨ç¤ºè¯¥ç”¨æˆ·æ²¡æœ‰å¯†ç ã€‚&lt;/p>
&lt;p>åœ¨è®¾ç½®å¯†ç çš„æ—¶å€™ï¼Œä½¿ç”¨ &lt;code>&amp;gt;password&lt;/code> æ¥è®¾ç½®å¯†ç ï¼Œä½¿ç”¨&lt;code>&amp;lt;password&lt;/code> æ¥åˆ é™¤å¯¹åº”çš„å¯†ç ã€‚&lt;/p>
&lt;p>è¿˜å¯ä»¥ä½¿ç”¨ &lt;code>#5baa61e4c9b93f3f0682250b6cf8331b7ee68fd8&lt;/code> æ¥è®¾ç½®å¯†ç ï¼Œ&lt;strong>5baa61e4c9b93f3f0682250b6cf8331b7ee68fd8&lt;/strong> æ˜¯ &lt;strong>password&lt;/strong> çš„ &lt;strong>sha1&lt;/strong> å€¼ã€‚ä¸ºäº†å¯†ç å®‰å…¨ï¼Œrediså†…éƒ¨å­˜å‚¨å¯†ç ä½¿ç”¨çš„æ˜¯å¯†ç çš„ sha1ï¼Œè¿™æ ·åœ¨é…ç½®æ–‡ä»¶å’Œè½¬å‚¨ACLè§„åˆ™çš„æ—¶å€™ï¼Œå¯ä»¥ä¿è¯å¯†ç çš„å®‰å…¨ã€‚&lt;/p>
&lt;p>åŒæ ·çš„ï¼Œå¯ä»¥ä½¿ç”¨ &lt;code>!5baa61e4c9b93f3f0682250b6cf8331b7ee68fd8&lt;/code> æ¥åˆ é™¤å¯¹åº”çš„å¯†ç ã€‚&lt;/p>
&lt;h4 id="keyåé™åˆ¶">&lt;a href="#key%e5%90%8d%e9%99%90%e5%88%b6" class="header-anchor">&lt;/a>keyåé™åˆ¶
&lt;/h4>&lt;p>redisä¸­æ¯ä¸ªkeyéƒ½æœ‰ä¸€ä¸ªåå­—ï¼Œä½¿ç”¨ &lt;code>~&lt;/code> æ¥åškeyåå­—é™åˆ¶ï¼Œæ”¯æŒ &lt;code>*&lt;/code> é€šé…ç¬¦ï¼Œè€Œä¸”æ”¯æŒkeyçš„åªè¯» &lt;code>R&lt;/code> å’Œ å†™ &lt;code>W&lt;/code> åŒºåˆ†ã€‚&lt;/p>
&lt;p>æ¯”å¦‚ å¯¹ &lt;code>app1&lt;/code> è¿™ä¸ªkeyåªè¯» &lt;code>%R~app1&lt;/code>ã€‚å¯¹æ‰€æœ‰ &lt;strong>app2&lt;/strong> å¼€å¤´çš„keyéƒ½æœ‰æƒé™ &lt;code>~app2*&lt;/code>&lt;/p>
&lt;h4 id="pubsubé™åˆ¶">&lt;a href="#pubsub%e9%99%90%e5%88%b6" class="header-anchor">&lt;/a>pub/subé™åˆ¶
&lt;/h4>&lt;p>pub/subé™åˆ¶å’Œkeyåé™åˆ¶ç±»ä¼¼ï¼Œè¦ä½¿ç”¨pub/subçš„å‰ææ˜¯å¯ä»¥ä½¿ç”¨ pub/subç›¸å…³çš„å‘½ä»¤ï¼Œè¿™éƒ¨åˆ†åœ¨å‘½ä»¤é™åˆ¶ä¸­é…ç½®ï¼Œè¿™é‡Œæ˜¯é™åˆ¶ channel çš„åå­—ã€‚&lt;/p>
&lt;p>å’Œkeyé™åˆ¶ä¸åŒçš„æ˜¯ï¼Œchannel ä½¿ç”¨ &lt;code>&amp;amp;&lt;/code> ç¬¦å·&lt;/p>
&lt;p>è¿™é‡Œæœ‰ä¸¤ä¸ªå…³é”®è¯&lt;/p>
&lt;ul>
&lt;li>&lt;code>allchannels&lt;/code>ï¼š å¯ä»¥è®¿é—®æ‰€æœ‰Pub/Subé¢‘é“çš„æƒé™&lt;/li>
&lt;li>&lt;code>resetchannels&lt;/code>ï¼š æ’¤é”€å¯¹æ‰€æœ‰Pub/Subé¢‘é“çš„è®¿é—®&lt;/li>
&lt;/ul>
&lt;h4 id="å‘½ä»¤é™åˆ¶">&lt;a href="#%e5%91%bd%e4%bb%a4%e9%99%90%e5%88%b6" class="header-anchor">&lt;/a>å‘½ä»¤é™åˆ¶
&lt;/h4>&lt;p>å‘½ä»¤æœ€å¥½ç†è§£äº†ï¼Œå°±æ˜¯é™åˆ¶å½“å‰ç”¨æˆ·å¯ä»¥æ‰§è¡Œå“ªäº›å‘½ä»¤ï¼Œä¸èƒ½æ‰§è¡Œå“ªäº›å‘½ä»¤ã€‚
åœ¨ACLä¸­ä½¿ç”¨ &lt;code>+&lt;/code> æ¥èµ‹äºˆå‘½ä»¤çš„æƒé™ï¼Œç”¨ &lt;code>-&lt;/code> æ¥æ’¤é”€å‘½ä»¤çš„æƒé™ã€‚æ¯”å¦‚ &lt;code>+get -set&lt;/code> è¿™å°±è¡¨ç¤ºèµ‹äºˆ &lt;code>get&lt;/code> å‘½ä»¤ï¼Œæ’¤é”€ &lt;code>set&lt;/code>å‘½ä»¤ã€‚&lt;/p>
&lt;p>é™¤äº†ç›´æ¥æŒ‡å®šå…·ä½“çš„å‘½ä»¤å¤–ï¼Œè¿˜å¯ä»¥å¯¹ä¸€ç±»å‘½ä»¤åšé™åˆ¶ã€‚æ¯”å¦‚ &lt;code>+@hash -@zset&lt;/code>ï¼Œè¿™è¡¨ç¤ºå¯ä»¥æ‰§è¡Œæ‰€æœ‰çš„ &lt;strong>hash&lt;/strong> ç±»çš„å‘½ä»¤ï¼Œä¸èƒ½æ‰§è¡Œæ‰€æœ‰çš„ &lt;strong>zset&lt;/strong> ç±»çš„å‘½ä»¤ã€‚&lt;/p>
&lt;p>redis ACL è¿˜å¯ä»¥é™åˆ¶å­å‘½ä»¤ã€‚æ¯”å¦‚ &lt;code>CONFIG SET acllog-max-len 128&lt;/code> ä¸­ï¼Œ&lt;code>SET&lt;/code> å°±æ˜¯ &lt;code>CONFIG&lt;/code> å‘½ä»¤çš„å­å‘½ä»¤ã€‚å¦‚æœæƒ³è¦é™åˆ¶ç”¨æˆ·ä¸èƒ½ä¿®æ”¹é…ç½®ï¼Œé‚£ACLå¯ä»¥è¿™æ ·é…ç½® &lt;code>+config -config|set&lt;/code>ã€‚æ­¤æ—¶ç”¨æˆ·å¯ä»¥æ‰§è¡Œ &lt;code>config set&lt;/code> ä»¥å¤–çš„æ‰€æœ‰ &lt;code>config&lt;/code> å‘½ä»¤ã€‚&lt;/p>
&lt;p>è¿˜æœ‰ä¸€ç§ç”¨æ³•ï¼Œ&lt;strong>å…è®¸é˜»å¡å‘½ä»¤çš„ç¬¬ä¸€ä¸ªå‚æ•°&lt;/strong>ï¼Œä¸è¿‡è¿™ä¸ªåŠŸèƒ½è‡ªRedis 7.0èµ·å·²å¼ƒç”¨ï¼Œå°†æ¥å¯èƒ½ä¼šè¢«åˆ é™¤ã€‚æ‰€ä»¥ä¸å»ºè®®ä½¿ç”¨äº†ã€‚&lt;/p>
&lt;p>ç”¨rediså®˜æ–¹æ–‡æ¡£çš„ä¾‹å­æ¥è¯´&lt;/p>
&lt;p>æœ‰æ—¶ï¼Œæ’é™¤æˆ–åŒ…å«å‘½ä»¤æˆ–å­å‘½ä»¤ä½œä¸ºä¸€ä¸ªæ•´ä½“çš„èƒ½åŠ›æ˜¯ä¸å¤Ÿçš„ã€‚è®¸å¤šéƒ¨ç½²å¯èƒ½ä¸æ„¿æ„ä¸ºä»»ä½•DBæä¾›æ‰§è¡ŒSELECTçš„èƒ½åŠ›ï¼Œä½†å¯èƒ½ä»ç„¶å¸Œæœ›èƒ½å¤Ÿè¿è¡ŒSELECT 0ã€‚&lt;/p>
&lt;p>æ­¤æ—¶çš„é…ç½® &lt;code>ACL SETUSER myuser -select +select|0&lt;/code>ã€‚è¿™æ ·ï¼Œè¯¥ç”¨æˆ·åªèƒ½æ‰§è¡Œ &lt;code>select 0&lt;/code> è¿™ä¸€ä¸ª &lt;code>select&lt;/code> å‘½ä»¤ã€‚å¦‚æœæƒ³ &lt;code>select 2&lt;/code> ç­‰ç­‰è¿›å…¥åˆ«çš„åº“æ˜¯ä¸å…è®¸çš„ã€‚&lt;/p>
&lt;p>æˆ‘ä¸ªäººæ„Ÿè§‰ï¼Œè¦æ·˜æ±°è¿™ä¸ªåŠŸèƒ½çš„åŸå› ï¼Œæ˜¯åº”ç”¨é¢å¤ªå°‘äº†ï¼Œè€Œä¸”åƒä¸Šé¢çš„è¿™ä¸ªä¾‹å­ä¸­ï¼Œå¹¶æ²¡æœ‰å®Œå…¨é™åˆ¶äº†å¯¹åº“çš„ä½¿ç”¨æƒé™ã€‚å¦‚æœå…ˆåœ¨åˆ«çš„ç”¨æˆ·ä¸‹ï¼Œé€‰æ‹©äº† &lt;strong>1&lt;/strong> è¿™ä¸ªåº“ï¼Œç„¶åå† &lt;code>auth myuser&lt;/code> è¿™ä¸ªç”¨æˆ·ï¼Œè™½ç„¶è¿™ä¸ªç”¨æˆ·é™åˆ¶äº†ï¼Œåªèƒ½ &lt;strong>select 0&lt;/strong>ï¼Œä½†æ˜¯æ­¤æ—¶ä¾ç„¶å¯ä»¥è®¿é—® &lt;strong>1&lt;/strong> è¿™ä¸ªåº“ã€‚&lt;/p>
&lt;p>rediså‘½ä»¤çš„åˆ†ç±»ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;strong>admin&lt;/strong>Â ç®¡ç†redisæœåŠ¡ç›¸å…³çš„å‘½ä»¤ åŒ…å« &lt;code>REPLICAOF&lt;/code> &lt;code>CONFIG&lt;/code> &lt;code>SAVE&lt;/code> &lt;code>MONITOR&lt;/code>Â &lt;code>ACL&lt;/code> &lt;code>SHUTDOWN&lt;/code>ç­‰ç­‰&lt;/li>
&lt;li>&lt;strong>bitmap&lt;/strong>Â bitmapè¿™ä¸ªæ•°æ®ç±»å‹ç›¸å…³çš„å‘½ä»¤&lt;/li>
&lt;li>&lt;strong>blocking&lt;/strong> å¯èƒ½ä¼šé˜»å¡è¿æ¥ï¼Œç›´åˆ°è¢«å¦ä¸€ä¸ªå‘½ä»¤é‡Šæ”¾&lt;/li>
&lt;li>&lt;strong>connection&lt;/strong>Â å½±å“è¿æ¥æˆ–å…¶ä»–è¿æ¥çš„å‘½ä»¤ã€‚åŒ…å« &lt;code>AUTH&lt;/code> &lt;code>SELECT&lt;/code> &lt;code>COMMAND&lt;/code> &lt;code>CLIENT&lt;/code> &lt;code>ECHO&lt;/code> &lt;code>PING&lt;/code>ç­‰ç­‰&lt;/li>
&lt;li>&lt;strong>dangerous&lt;/strong>Â æœ‰æ½œåœ¨å±é™©çš„å‘½ä»¤(ç”±äºå„ç§åŸå› ï¼Œåº”è¯¥ä»”ç»†è€ƒè™‘æ¯ä¸ªå‘½ä»¤)ã€‚åŒ…å«Â &lt;code>FLUSHALL&lt;/code> &lt;code>MIGRATE&lt;/code> &lt;code>RESTORE&lt;/code> &lt;code>SORT&lt;/code> &lt;code>KEYS&lt;/code> &lt;code>CLIENT&lt;/code> &lt;code>INFO&lt;/code> &lt;code>CONFIG&lt;/code> &lt;code>SAVE&lt;/code> &lt;code>REPLICAOF&lt;/code>ç­‰ç­‰&lt;/li>
&lt;li>&lt;strong>geo&lt;/strong>Â geoè¿™ä¸ªæ•°æ®ç±»å‹ç›¸å…³çš„å‘½ä»¤&lt;/li>
&lt;li>&lt;strong>hash&lt;/strong> hashè¿™ä¸ªæ•°æ®ç±»å‹ç›¸å…³çš„å‘½ä»¤&lt;/li>
&lt;li>&lt;strong>hyperloglog&lt;/strong> hyperloglog è¿™ä¸ªæ•°æ®ç±»å‹ç›¸å…³çš„å‘½ä»¤&lt;/li>
&lt;li>&lt;strong>fast&lt;/strong>Â å¿« O(1) çš„å‘½ä»¤ï¼Œå¯ä»¥å¾ªç¯å‚æ•°çš„ä¸ªæ•°ï¼Œä½†ä¸èƒ½å¾ªç¯é”®ä¸­çš„å…ƒç´ ä¸ªæ•°ã€‚&lt;/li>
&lt;li>&lt;strong>keyspace&lt;/strong> ä»¥ä¸ç±»å‹æ— å…³çš„æ–¹å¼ä»é”®ã€æ•°æ®åº“æˆ–å®ƒä»¬çš„å…ƒæ•°æ®å†™å…¥æˆ–è¯»å–ã€‚åŒ…å« &lt;code>DEL&lt;/code> &lt;code>RESTORE&lt;/code> &lt;code>DUMP&lt;/code> &lt;code>RENAME&lt;/code> &lt;code>EXISTS&lt;/code> &lt;code>DBSIZE&lt;/code> &lt;code>KEYS&lt;/code> &lt;code>EXPIRE&lt;/code> &lt;code>TTL&lt;/code> &lt;code>FLUSHALL&lt;/code> å¯èƒ½ä¿®æ”¹é”®ç©ºé—´ã€é”®æˆ–å…ƒæ•°æ®çš„å‘½ä»¤ä¹Ÿå°†å…·æœ‰ &lt;code>write&lt;/code> ç±»åˆ«ã€‚ä»…è¯»å–é”®ç©ºé—´ã€é”®æˆ–å…ƒæ•°æ®çš„å‘½ä»¤å°†å…·æœ‰ &lt;code>read&lt;/code> ç±»åˆ«ã€‚&lt;/li>
&lt;li>&lt;strong>list&lt;/strong>Â listè¿™ä¸ªæ•°æ®ç±»å‹ç›¸å…³çš„å‘½ä»¤&lt;/li>
&lt;li>&lt;strong>pubsub&lt;/strong> PubSub è®¢é˜…å‘å¸ƒç›¸å…³çš„å‘½ä»¤&lt;/li>
&lt;li>&lt;strong>read&lt;/strong>Â ä»é”®(å€¼æˆ–å…ƒæ•°æ®)è¯»å–ã€‚ä¸ä¸é”®äº¤äº’çš„å‘½ä»¤æ—¢æ²¡æœ‰ &lt;code>read&lt;/code> ä¹Ÿæ²¡æœ‰ &lt;code>write&lt;/code>&lt;/li>
&lt;li>&lt;strong>scripting&lt;/strong>Â luaè„šæœ¬æ‰§è¡Œç›¸å…³çš„å‘½ä»¤&lt;/li>
&lt;li>&lt;strong>set&lt;/strong>Â set è¿™ä¸ªæ•°æ®ç»“æ„ç›¸å…³çš„å‘½ä»¤&lt;/li>
&lt;li>&lt;strong>sortedset&lt;/strong> zsetæ•°æ®ç»“æ„ç›¸å…³çš„å‘½ä»¤&lt;/li>
&lt;li>&lt;strong>slow&lt;/strong>Â æ…¢å‘½ä»¤ï¼Œé &lt;code>fast&lt;/code>çš„å‘½ä»¤&lt;/li>
&lt;li>&lt;strong>stream&lt;/strong> stream è¿™ä¸ªæ•°æ®ç±»å‹ç›¸å…³çš„å‘½ä»¤&lt;/li>
&lt;li>&lt;strong>string&lt;/strong> string è¿™ä¸ªæ•°æ®ç±»å‹ç›¸å…³çš„å‘½ä»¤&lt;/li>
&lt;li>&lt;strong>transaction&lt;/strong>Â &lt;code>WATCH&lt;/code> &lt;code>MULTI&lt;/code> &lt;code>EXEC&lt;/code> è¿™å‡ ä¸ªå’Œäº‹åŠ¡ç›¸å…³çš„å‘½ä»¤&lt;/li>
&lt;li>&lt;strong>write&lt;/strong>Â å†™å…¥é”®(å€¼æˆ–å…ƒæ•°æ®)çš„å‘½ä»¤&lt;/li>
&lt;/ul>
&lt;h2 id="aclç›¸å…³å‘½ä»¤">&lt;a href="#acl%e7%9b%b8%e5%85%b3%e5%91%bd%e4%bb%a4" class="header-anchor">&lt;/a>ACLç›¸å…³å‘½ä»¤
&lt;/h2>&lt;p>ä½¿ç”¨ &lt;code>ACL HELP&lt;/code> å‘½ä»¤å¯ä»¥çœ‹åˆ°ACLæ‰€æœ‰çš„å‘½ä»¤&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span> 1&lt;span style="color:#ff79c6">)&lt;/span> ACL &amp;lt;subcommand&amp;gt; &lt;span style="color:#ff79c6">[&lt;/span>&amp;lt;arg&amp;gt; &lt;span style="color:#ff79c6">[&lt;/span>value&lt;span style="color:#ff79c6">]&lt;/span> &lt;span style="color:#ff79c6">[&lt;/span>opt&lt;span style="color:#ff79c6">]&lt;/span> ...&lt;span style="color:#ff79c6">]&lt;/span>. Subcommands are:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span> 2&lt;span style="color:#ff79c6">)&lt;/span> CAT &lt;span style="color:#ff79c6">[&lt;/span>&amp;lt;category&amp;gt;&lt;span style="color:#ff79c6">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span> 3&lt;span style="color:#ff79c6">)&lt;/span> List all commands that belong to &amp;lt;category&amp;gt;, or all &lt;span style="color:#8be9fd;font-style:italic">command&lt;/span> categories
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span> 4&lt;span style="color:#ff79c6">)&lt;/span> when no category is specified.
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span> 5&lt;span style="color:#ff79c6">)&lt;/span> DELUSER &amp;lt;username&amp;gt; &lt;span style="color:#ff79c6">[&lt;/span>&amp;lt;username&amp;gt; ...&lt;span style="color:#ff79c6">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span> 6&lt;span style="color:#ff79c6">)&lt;/span> Delete a list of users.
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span> 7&lt;span style="color:#ff79c6">)&lt;/span> DRYRUN &amp;lt;username&amp;gt; &amp;lt;command&amp;gt; &lt;span style="color:#ff79c6">[&lt;/span>&amp;lt;arg&amp;gt; ...&lt;span style="color:#ff79c6">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span> 8&lt;span style="color:#ff79c6">)&lt;/span> Returns whether the user can execute the given &lt;span style="color:#8be9fd;font-style:italic">command&lt;/span> without executing the command.
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span> 9&lt;span style="color:#ff79c6">)&lt;/span> GETUSER &amp;lt;username&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span>10&lt;span style="color:#ff79c6">)&lt;/span> Get the user&amp;#39;s details.
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span>11&lt;span style="color:#ff79c6">)&lt;/span> GENPASS &lt;span style="color:#ff79c6">[&lt;/span>&amp;lt;bits&amp;gt;&lt;span style="color:#ff79c6">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span>12&lt;span style="color:#ff79c6">)&lt;/span> Generate a secure 256-bit user password. The optional &lt;span style="color:#f1fa8c">`&lt;/span>bits&lt;span style="color:#f1fa8c">`&lt;/span> argument can
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span>13&lt;span style="color:#ff79c6">)&lt;/span> be used to specify a different size.
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span>14&lt;span style="color:#ff79c6">)&lt;/span> LIST
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15&lt;/span>&lt;span>15&lt;span style="color:#ff79c6">)&lt;/span> Show users details in config file format.
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16&lt;/span>&lt;span>16&lt;span style="color:#ff79c6">)&lt;/span> LOAD
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17&lt;/span>&lt;span>17&lt;span style="color:#ff79c6">)&lt;/span> Reload users from the ACL file.
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18&lt;/span>&lt;span>18&lt;span style="color:#ff79c6">)&lt;/span> LOG &lt;span style="color:#ff79c6">[&lt;/span>&amp;lt;count&amp;gt; | RESET&lt;span style="color:#ff79c6">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19&lt;/span>&lt;span>19&lt;span style="color:#ff79c6">)&lt;/span> Show the ACL log entries.
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20&lt;/span>&lt;span>20&lt;span style="color:#ff79c6">)&lt;/span> SAVE
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21&lt;/span>&lt;span>21&lt;span style="color:#ff79c6">)&lt;/span> Save the current config to the ACL file.
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22&lt;/span>&lt;span>22&lt;span style="color:#ff79c6">)&lt;/span> SETUSER &amp;lt;username&amp;gt; &amp;lt;attribute&amp;gt; &lt;span style="color:#ff79c6">[&lt;/span>&amp;lt;attribute&amp;gt; ...&lt;span style="color:#ff79c6">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23&lt;/span>&lt;span>23&lt;span style="color:#ff79c6">)&lt;/span> Create or modify a user with the specified attributes.
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24&lt;/span>&lt;span>24&lt;span style="color:#ff79c6">)&lt;/span> USERS
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25&lt;/span>&lt;span>25&lt;span style="color:#ff79c6">)&lt;/span> List all the registered usernames.
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26&lt;/span>&lt;span>26&lt;span style="color:#ff79c6">)&lt;/span> WHOAMI
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27&lt;/span>&lt;span>27&lt;span style="color:#ff79c6">)&lt;/span> Return the current connection username.
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28&lt;/span>&lt;span>28&lt;span style="color:#ff79c6">)&lt;/span> HELP
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29&lt;/span>&lt;span>29&lt;span style="color:#ff79c6">)&lt;/span> Prints this help.
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>é‚£å°±ä¸€ä¸ªä¸ªæ¥å§&lt;/p>
&lt;h3 id="acl-cat">&lt;a href="#acl-cat" class="header-anchor">&lt;/a>ACL CAT
&lt;/h3>&lt;p>åˆ—å‡ºæ‰€æœ‰çš„å‘½ä»¤åˆ†ç±»ï¼Œå¦‚æœåˆ¶å®šäº†åˆ†ç±»åï¼Œå°±åˆ—å‡ºå½“å‰åˆ†ç±»ä¸­æ‰€æœ‰çš„å‘½ä»¤&lt;/p>
&lt;p>ä½¿ç”¨ï¼š&lt;code>ACL CAT&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span> 1&lt;span style="color:#ff79c6">)&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;keyspace&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span> 2&lt;span style="color:#ff79c6">)&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;read&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span> 3&lt;span style="color:#ff79c6">)&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;write&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span> 4&lt;span style="color:#ff79c6">)&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;set&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span> 5&lt;span style="color:#ff79c6">)&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;sortedset&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span> 6&lt;span style="color:#ff79c6">)&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;list&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span> 7&lt;span style="color:#ff79c6">)&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;hash&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span> 8&lt;span style="color:#ff79c6">)&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;string&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span> 9&lt;span style="color:#ff79c6">)&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;bitmap&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span>10&lt;span style="color:#ff79c6">)&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;hyperloglog&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span>11&lt;span style="color:#ff79c6">)&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;geo&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span>12&lt;span style="color:#ff79c6">)&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;stream&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span>13&lt;span style="color:#ff79c6">)&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;pubsub&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span>14&lt;span style="color:#ff79c6">)&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;admin&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15&lt;/span>&lt;span>15&lt;span style="color:#ff79c6">)&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;fast&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16&lt;/span>&lt;span>16&lt;span style="color:#ff79c6">)&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;slow&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17&lt;/span>&lt;span>17&lt;span style="color:#ff79c6">)&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;blocking&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18&lt;/span>&lt;span>18&lt;span style="color:#ff79c6">)&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;dangerous&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19&lt;/span>&lt;span>19&lt;span style="color:#ff79c6">)&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;connection&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20&lt;/span>&lt;span>20&lt;span style="color:#ff79c6">)&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;transaction&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21&lt;/span>&lt;span>21&lt;span style="color:#ff79c6">)&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;scripting&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä½¿ç”¨ï¼š&lt;code>ACL CAT HASH&lt;/code>ï¼Œåˆ—å‡º &lt;strong>hash&lt;/strong> è¿™ä¸ªåˆ†ç±»ä¸‹æ‰€æœ‰çš„å‘½ä»¤ã€‚&lt;/p>
&lt;h3 id="acl-deluser">&lt;a href="#acl-deluser" class="header-anchor">&lt;/a>ACL DELUSER
&lt;/h3>&lt;p>è¿™ä¸ªæ²¡ä»€ä¹ˆå¥½è¯´çš„ï¼Œå°±æ˜¯åˆ é™¤æŒ‡å®šçš„ç”¨æˆ·ã€‚ä¾‹å¦‚ï¼š&lt;code>ACL DELUSER user1 user2&lt;/code>&lt;/p>
&lt;h3 id="acl-dryrun">&lt;a href="#acl-dryrun" class="header-anchor">&lt;/a>ACL DRYRUN
&lt;/h3>&lt;p>ç”¨æ¥æµ‹è¯•æŒ‡å®šç”¨æˆ·æ˜¯å¦å¯ä»¥æ‰§è¡Œç‰¹å®šçš„å‘½ä»¤ã€‚&lt;/p>
&lt;p>æ¯”å¦‚æµ‹è¯• &lt;strong>user1&lt;/strong> æ˜¯å¦å¯ä»¥æ‰§è¡Œ &lt;code>hset hkey field1 1111&lt;/code> å‘½ä»¤å¦‚ä¸‹&lt;/p>
&lt;p>&lt;code>ACL DRYRUN user1 hset hkey field1 1111&lt;/code> å¦‚æœæœ‰æƒé™æ‰§è¡Œï¼Œä¼šè¿”å› &lt;code>OK&lt;/code>ï¼Œå¦åˆ™ä¼šæç¤ºå…·ä½“çš„é”™è¯¯ã€‚&lt;/p>
&lt;h3 id="acl-getuser">&lt;a href="#acl-getuser" class="header-anchor">&lt;/a>ACL GETUSER
&lt;/h3>&lt;p>å°±å¦‚å­—é¢æ„æ€ï¼Œè·å–æŒ‡å®šç”¨æˆ·çš„è¯¦ç»†ä¿¡æ¯ï¼Œä¾‹ï¼š&lt;code>ACL GETUSER user1&lt;/code>&lt;/p>
&lt;h3 id="acl-genpass">&lt;a href="#acl-genpass" class="header-anchor">&lt;/a>ACL GENPASS
&lt;/h3>&lt;p>ç”Ÿæˆä¸€ä¸ªéšæœºå¯†ç ï¼Œé»˜è®¤é•¿åº¦æ˜¯ 256 ä½çš„å¯†ç ï¼Œä¹Ÿå¯ä»¥æŒ‡å®šé•¿åº¦ã€‚&lt;/p>
&lt;h3 id="acl-list">&lt;a href="#acl-list" class="header-anchor">&lt;/a>ACL LIST
&lt;/h3>&lt;p>ä½¿ç”¨ ACL é…ç½®æ–‡ä»¶ä¸­çš„æ ¼å¼ï¼Œåˆ—å‡ºå½“å‰ç³»ç»Ÿä¸­æ‰€æœ‰çš„ç”¨æˆ·çš„è¯¦ç»†ä¿¡æ¯&lt;/p>
&lt;h3 id="acl-load">&lt;a href="#acl-load" class="header-anchor">&lt;/a>ACL LOAD
&lt;/h3>&lt;p>ä»é…ç½®ä¸­é‡æ–°åŠ è½½ACLçš„é…ç½®ï¼Œå¦‚æœredisçš„é…ç½®æ–‡ä»¶ä¸­ï¼Œæ²¡æœ‰é…ç½® &lt;code>aclfile&lt;/code> çš„æ–‡ä»¶è·¯å¾„ï¼Œé‚£ä¹ˆè¿™ä¸ªå‘½ä»¤ä¼šæŠ¥é”™ã€‚&lt;/p>
&lt;h3 id="acl-log">&lt;a href="#acl-log" class="header-anchor">&lt;/a>ACL LOG
&lt;/h3>&lt;p>æŸ¥è¯¢æ‰€æœ‰æ²¡æœ‰é€šè¿‡æ ¡éªŒçš„è¡Œä¸ºï¼Œæ¯”å¦‚ &lt;strong>user1&lt;/strong> æ²¡æœ‰ &lt;strong>hash&lt;/strong> ç±»å‹æ•°æ®æ“ä½œçš„æƒé™ï¼Œåœ¨ä½¿ç”¨ &lt;strong>hash&lt;/strong> ç±»å‹çš„å‘½ä»¤åï¼Œä¼šè®°å½•ä¸€æ¡log&lt;/p>
&lt;p>logè®°å½•çš„æœ€å¤§å€¼ï¼Œä» é…ç½®æ–‡ä»¶ä¸­çš„ &lt;code>acllog-max-len&lt;/code> ä¸­è¯»å–ã€‚&lt;/p>
&lt;p>è¿™ä¸ªå‘½ä»¤å¯ä»¥é€šè¿‡å‚æ•°ï¼Œæ¥æŒ‡å®šä¸€æ¬¡è·å–çš„logæ•°é‡ï¼Œä¾‹ï¼š&lt;code>ACL LOG 10&lt;/code> åªè·å–10æ¡&lt;/p>
&lt;p>è¿˜å¯ä»¥é‡ç½®æ‰€æœ‰logï¼Œä¾‹ï¼š&lt;code>ACL LOG reset&lt;/code>&lt;/p>
&lt;h3 id="acl-save">&lt;a href="#acl-save" class="header-anchor">&lt;/a>ACL SAVE
&lt;/h3>&lt;p>å’Œ &lt;code>ACL LOAD&lt;/code> å‘½ä»¤ç›¸åï¼Œè¿™ä¸ªæ˜¯æŠŠå½“å‰çš„ACLè§„åˆ™ä¿å­˜åˆ°æ–‡ä»¶ä¸­ã€‚è¿™ä¸ªå‘½ä»¤ä¹Ÿéœ€è¦åœ¨é…ç½®äº† &lt;strong>aclfile&lt;/strong> åæ‰èƒ½æ‰§è¡Œï¼Œå¦åˆ™ä¹Ÿä¼šæŠ¥é”™ã€‚&lt;/p>
&lt;h3 id="acl-setuser">&lt;a href="#acl-setuser" class="header-anchor">&lt;/a>ACL SETUSER
&lt;/h3>&lt;p>è¿™ä¸ªæ˜¯ACLä¸­æœ€å¸¸ç”¨çš„å‘½ä»¤äº†ï¼Œç”¨æ¥åˆ›å»ºå’Œè®¾ç½®ACLç”¨æˆ·å±æ€§ã€‚åˆ›å»ºå’Œä¿®æ”¹ç”¨æˆ·ï¼Œä½¿ç”¨ ACL è¯­æ³•ï¼ŒåŒé…ç½®ä¸­çš„è¯­æ³•æ˜¯ä¸€è‡´çš„ã€‚&lt;/p>
&lt;p>ä¾‹ï¼š&lt;code>ACL SETUSER user1 on &amp;gt;123 ~app1* +@all&lt;/code> ä¼šä¿®æ”¹ &lt;strong>user1&lt;/strong> è¿™ä¸ªç”¨æˆ·çš„å±æ€§ï¼Œå¦‚æœä¹‹å‰æ²¡æœ‰è¿™ä¸ªç”¨æˆ·ï¼Œé‚£ä¹ˆä¼šåˆ›å»ºè¿™ä¸ªç”¨æˆ·ï¼Œå¹¶è®¾ç½®å±æ€§ã€‚&lt;/p>
&lt;p>ACLè¿˜æ”¯æŒå­å±æ€§ï¼Œä¾‹ï¼š&lt;code>ACL SETUSER user1 on &amp;gt;123 ~app1* +@all (+@read ~app2)&lt;/code> åœ¨è¿™ä¸ªè§„åˆ™ä¸‹ï¼Œ&lt;strong>user1&lt;/strong> ç”¨æˆ·å¯¹ &lt;strong>app1&lt;/strong> å‰ç¼€çš„keyæ‹¥æœ‰è¯»å†™æƒé™ï¼Œå¯¹ &lt;strong>app2&lt;/strong> å‰ç¼€çš„keyåªæœ‰è¯»çš„æƒé™ã€‚&lt;/p>
&lt;h3 id="acl-users">&lt;a href="#acl-users" class="header-anchor">&lt;/a>ACL USERS
&lt;/h3>&lt;p>åªåˆ—å‡ºå½“å‰ç³»ç»Ÿæ‰€æœ‰çš„ç”¨æˆ·åï¼Œç›¸å½“äºæ˜¯ &lt;code>ACL LIST&lt;/code> å‘½ä»¤çš„ç®€åŒ–ç‰ˆ&lt;/p>
&lt;h3 id="acl-whoami">&lt;a href="#acl-whoami" class="header-anchor">&lt;/a>ACL WHOAMI
&lt;/h3>&lt;p>è·å–å½“å‰ç”¨æˆ·çš„åå­—ï¼Œç±»ä¼¼Linuxç³»ç»Ÿä¸­çš„ &lt;strong>whoami&lt;/strong> å‘½ä»¤ã€‚&lt;/p>
&lt;p>åˆ°è¿™æ•´ä¸ªACLå‘½ä»¤ä½¿ç”¨å·®ä¸å¤šå°±ä»‹ç»å®Œäº†ã€‚æ•´ä¸ªACLå°±æ˜¯å‘½ä»¤å¤šç‚¹ï¼Œä½¿ç”¨èµ·æ¥ä¹Ÿæ²¡æœ‰é‚£ä¹ˆå¤æ‚å—ã€‚&lt;/p></description></item><item><title>redisæºç å­¦ä¹ |ç½‘ç»œ redis ç½‘ç»œéƒ¨åˆ†æºç åˆ†æï¼Œå­¦ä¹ ã€‚redisç½‘ç»œå¤šè·¯å¤ç”¨ - QX's blog</title><link>https://lqxhub.github.io/posts/bce71a0/</link><pubDate>Sun, 28 Jan 2024 20:10:27 +0000</pubDate><guid>https://lqxhub.github.io/posts/bce71a0/</guid><description>&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/OIP-C.R8n6zHAP4N2M01vSoRwkSQHaDW" alt="Featured image of post redisæºç å­¦ä¹ |ç½‘ç»œ redis ç½‘ç»œéƒ¨åˆ†æºç åˆ†æï¼Œå­¦ä¹ ã€‚redisç½‘ç»œå¤šè·¯å¤ç”¨ - QX's blog" />&lt;p>å»å¹´å†™è¿‡ä¸¤ç¯‡redisçš„æºç åˆ†ææ–‡ç« ï¼ˆredisçš„watchå’ŒACLï¼‰ï¼Œç°åœ¨å›å¤´çœ‹ï¼Œå·²ç»è¿‡å»å¥½ä¹…äº†ã€‚è¯´èµ·é‚£ä¸¤ç¯‡æ–‡ç« ï¼Œæ”¶ç›Šè¿˜æ˜¯æŒºå¤§çš„ã€‚è¿™å‘¨æœ‰æ—¶é—´äº†ï¼Œç»§ç»­å­¦ä¹ redisçš„æºç ã€‚å…ˆæ¥çœ‹ä¸€ä¸‹redisçš„ç½‘ç»œå¤„ç†ã€‚&lt;/p>
&lt;p>æœ¬æ¬¡çš„æºç åŸºäºredisçš„ &lt;strong>7.2&lt;/strong> åˆ†æ”¯ï¼Œä¸åŒç‰ˆæœ¬ä¸‹ï¼Œä¸€äº›ç»†èŠ‚å¯èƒ½ä¼šæœ‰å·®å¼‚ã€‚&lt;/p>
&lt;p>è¿™ç¯‡æ–‡ç« å› ä¸ºç¯‡å¹…æ‰€é™ï¼Œæ²¡æ³•æŠŠredisç½‘ç»œè¯»å†™çš„æ‰€æœ‰ç»†èŠ‚éƒ½åˆ†æåˆ°ï¼Œåªèƒ½æŠŠè¿™ä¸ªç½‘ç»œå¤„ç†çš„å¤§æ¦‚æµç¨‹èµ°ä¸€éã€‚&lt;/p>
&lt;p>çœ‹å®Œè¿™ç¯‡æ–‡ç« ï¼Œèƒ½å¯¹redisç½‘ç»œå¤„ç†æµç¨‹æœ‰ä¸ªåŸºæœ¬äº†è§£ï¼Œèƒ½çŸ¥é“redisåŠ å…¥äº†å¤šçº¿ç¨‹åï¼Œä¸ºä»€ä¹ˆè¿˜æ˜¯å•çº¿ç¨‹å¤„ç†æ•°æ®ã€‚èƒ½çŸ¥é“redisæ˜¯å¦‚ä½•å®ç°é€‚é…ä¸åŒç³»ç»Ÿä¸‹ç½‘ç»œæ¥å£ã€‚&lt;/p>
&lt;p>å…ˆæ¥å†™ä¸€ä¸‹redisç½‘ç»œéœ€è¦çš„ä¸€äº›æ•°æ®ç»“æ„ã€‚&lt;/p>
&lt;h2 id="æ•°æ®ç»“æ„">&lt;a href="#%e6%95%b0%e6%8d%ae%e7%bb%93%e6%9e%84" class="header-anchor">&lt;/a>æ•°æ®ç»“æ„ï¼š
&lt;/h2>&lt;ul>
&lt;li>rediså¯ä»¥æ”¯æŒå¤šä¸ªå¹³å°ï¼ˆLinuxï¼ŒUnixï¼‰ï¼Œè¿™ä¸¤ä¸ªå¹³å°çš„ç½‘ç»œè°ƒç”¨æ˜¯ä¸ä¸€æ ·çš„ï¼ŒLinuxä¸­é«˜æ€§èƒ½çš„ç½‘ç»œæ¥å£æ˜¯&lt;strong>epoll&lt;/strong>ï¼ŒUnixä¸Šæ˜¯&lt;strong>kqueue&lt;/strong>ã€‚å› ä¸ºç‰ˆæœ¬çš„åŸå› ï¼Œåœ¨ä½ç‰ˆæœ¬çš„Linuxå†…æ ¸ä¸­ï¼Œepoolä¹Ÿæ˜¯ä¸æ”¯æŒçš„ï¼Œè¿™æ—¶å€™å°±éœ€è¦ç”¨åˆ°&lt;strong>select&lt;/strong>ã€‚redisä½¿ç”¨äº† &lt;strong>aeEvent&lt;/strong> è¿™ä¸ªç»“æ„æ¥å°è£…äº†ç½‘ç»œï¼Œå®ç°äº†å¯¹ä¸åŒç½‘ç»œæ¥å£çš„å…¼å®¹ã€‚&lt;/li>
&lt;/ul>
&lt;p>ç»“æ„çš„å®šä¹‰åœ¨ &lt;code>ae.h&lt;/code> æ–‡ä»¶ä¸­ &lt;a class="link" href="https://github.com/redis/redis/blob/d2c8a4b91e8c0e6aefd1f5bc0bf582cddbe046b7/src/ae.h#L99-L111" target="_blank" rel="noopener"
>aeEventLoop&lt;/a>&lt;/p>
&lt;p>&lt;strong>aeEventLoop&lt;/strong> æ˜¯redisç½‘ç»œä¸­ï¼Œæ‰€æœ‰ç½‘ç»œäº‹ä»¶çš„ç®¡ç†å™¨ã€‚æˆ‘ä»¬çŸ¥é“ï¼Œç°åœ¨çš„ç½‘ç»œä¸€èˆ¬éƒ½æ˜¯é€šè¿‡å¤šè·¯å¤ç”¨æ¥å¤„ç†å¤šä¸ªé“¾æ¥ï¼Œå¤šè·¯å¤ç”¨çš„å®ç°åœ¨ä¸åŒçš„ç³»ç»Ÿä¸­æœ‰ä¸åŒçš„å®ç°ï¼Œæ‰€æœ‰redisä½¿ç”¨ &lt;code>aeEventLoop&lt;/code> çš„å°è£…æ¥å®ç°ä¸åŒå¹³å°çš„å…¼å®¹ã€‚è¿™ä¸ªç»“æ„æ˜¯å…¨å±€å”¯ä¸€çš„ï¼Œrediså¯åŠ¨åå®Œæˆåˆå§‹åŒ–ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">typedef&lt;/span> &lt;span style="color:#ff79c6">struct&lt;/span> aeEventLoop {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span> &lt;span style="color:#8be9fd">int&lt;/span> maxfd; &lt;span style="color:#6272a4">/* highest file descriptor currently registered */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span> &lt;span style="color:#8be9fd">int&lt;/span> setsize; &lt;span style="color:#6272a4">/* max number of file descriptors tracked */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span> &lt;span style="color:#8be9fd">long&lt;/span> &lt;span style="color:#8be9fd">long&lt;/span> timeEventNextId;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span> aeFileEvent &lt;span style="color:#ff79c6">*&lt;/span>events; &lt;span style="color:#6272a4">/* Registered events */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span> aeFiredEvent &lt;span style="color:#ff79c6">*&lt;/span>fired; &lt;span style="color:#6272a4">/* Fired events */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span> aeTimeEvent &lt;span style="color:#ff79c6">*&lt;/span>timeEventHead;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span> &lt;span style="color:#8be9fd">int&lt;/span> stop;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span> &lt;span style="color:#8be9fd">void&lt;/span> &lt;span style="color:#ff79c6">*&lt;/span>apidata; &lt;span style="color:#6272a4">/* This is used for polling API specific data */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span> aeBeforeSleepProc &lt;span style="color:#ff79c6">*&lt;/span>beforesleep;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span> aeBeforeSleepProc &lt;span style="color:#ff79c6">*&lt;/span>aftersleep;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span> &lt;span style="color:#8be9fd">int&lt;/span> flags;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span>} aeEventLoop;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>aeFileEvent&lt;/code> å’Œ &lt;code>aeFiredEvent&lt;/code> æ˜¯å¤„ç†ç½‘ç»œäº‹ä»¶çš„æ•°ç»„ç»“æ„ï¼Œ&lt;code>aeTimeEvent&lt;/code> æ˜¯å¤„ç†rediså®šæ—¶å›è°ƒçš„ç»“æ„æ•°ç»„ã€‚&lt;/p>
&lt;ul>
&lt;li>&lt;code>aeFileEvent&lt;/code> æ˜¯æ³¨å†Œåˆ°ç³»ç»Ÿä¸­çš„äº‹ä»¶ï¼Œåœ¨ epoll ä¸­å°±æ˜¯ &lt;code>struct epoll_event&lt;/code> ç»“æ„ã€‚&lt;/li>
&lt;li>&lt;code>aeFiredEvent&lt;/code> æ˜¯è¿™æ¬¡è¦å¤„ç†çš„äº‹ä»¶ã€‚åœ¨ epoll ä¸­å°±æ˜¯ é€šè¿‡ &lt;code>epoll_wait&lt;/code> è¿”å›çš„äº‹ä»¶ã€‚&lt;/li>
&lt;li>&lt;code>timeEventHead&lt;/code> æ˜¯å®šæ—¶å™¨è¦å¤„ç†çš„äº‹ä»¶ã€‚&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>aeFileEvent&lt;/strong> æ˜¯redisä¸­ï¼Œå¤šè·¯å¤ç”¨çš„äº‹ä»¶å°è£…ã€‚æ¯ä¸€ä¸ªç½‘ç»œé“¾æ¥éƒ½ä¼šè¢«åŒ…è£…æˆä¸€ä¸ª &lt;code>aeFileEvent&lt;/code> å¯¹è±¡ï¼Œï¼ˆå› ä¸ºåœ¨ Unixç³»åˆ—çš„ç³»ç»Ÿä¸­ï¼Œä¸‡ç‰©çš†æ˜¯æ–‡ä»¶å˜›ï¼Œæ‰€æœ‰è¿™é‡Œä¹Ÿå°±å« &lt;code>aeFileEvent&lt;/code>äº†ï¼‰ï¼Œç„¶ååŠ å…¥åˆ° &lt;code>aeEventLoop&lt;/code> ä¸­ï¼Œæœ€åäº¤ç»™æ“ä½œç³»ç»Ÿä¸­çš„å¤šè·¯å¤ç”¨ç®¡ç†ã€‚å½“è¢«ç®¡ç†çš„äº‹ä»¶è¢«è§¦å‘åï¼Œä¼šå›è°ƒå¯¹åº”çš„å‡½æ•°ï¼Œä¹Ÿå°±æ˜¯ &lt;code>rfileProc&lt;/code> æˆ–è€… &lt;code>wfileProc&lt;/code> å‡½æ•°æŒ‡é’ˆï¼Œæ¥å®Œæˆæ“ä½œã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">typedef&lt;/span> &lt;span style="color:#ff79c6">struct&lt;/span> aeFileEvent {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span> &lt;span style="color:#8be9fd">int&lt;/span> mask; &lt;span style="color:#6272a4">/* one of AE_(READABLE|WRITABLE|BARRIER) */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3&lt;/span>&lt;span> aeFileProc &lt;span style="color:#ff79c6">*&lt;/span>rfileProc;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4&lt;/span>&lt;span> aeFileProc &lt;span style="color:#ff79c6">*&lt;/span>wfileProc;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5&lt;/span>&lt;span> &lt;span style="color:#8be9fd">void&lt;/span> &lt;span style="color:#ff79c6">*&lt;/span>clientData;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6&lt;/span>&lt;span>} aeFileEvent;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ç½‘ç»œå¤„ç†çš„å®ç°åœ¨ &lt;code>ae.c&lt;/code> ä¸­&lt;/p>
&lt;p>åœ¨&lt;code>ae.c&lt;/code>ä¸­ï¼Œé€šè¿‡å®å®šä¹‰ï¼Œæ¥å®ç°å¯¹ä¸åŒå¹³å°çš„å…¼å®¹&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">#ifdef HAVE_EVPORT
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span>&lt;span style="color:#ff79c6">#include&lt;/span> &lt;span style="color:#ff79c6">&amp;#34;ae_evport.c&amp;#34;&lt;/span>&lt;span style="color:#ff79c6">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span>&lt;span style="color:#ff79c6">#else
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span>&lt;span style="color:#ff79c6">&lt;/span> &lt;span style="color:#ff79c6">#ifdef HAVE_EPOLL
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span>&lt;span style="color:#ff79c6">&lt;/span> &lt;span style="color:#ff79c6">#include&lt;/span> &lt;span style="color:#ff79c6">&amp;#34;ae_epoll.c&amp;#34;&lt;/span>&lt;span style="color:#ff79c6">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span>&lt;span style="color:#ff79c6">&lt;/span> &lt;span style="color:#ff79c6">#else
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span>&lt;span style="color:#ff79c6">&lt;/span> &lt;span style="color:#ff79c6">#ifdef HAVE_KQUEUE
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span>&lt;span style="color:#ff79c6">&lt;/span> &lt;span style="color:#ff79c6">#include&lt;/span> &lt;span style="color:#ff79c6">&amp;#34;ae_kqueue.c&amp;#34;&lt;/span>&lt;span style="color:#ff79c6">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span>&lt;span style="color:#ff79c6">&lt;/span> &lt;span style="color:#ff79c6">#else
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span>&lt;span style="color:#ff79c6">&lt;/span> &lt;span style="color:#ff79c6">#include&lt;/span> &lt;span style="color:#ff79c6">&amp;#34;ae_select.c&amp;#34;&lt;/span>&lt;span style="color:#ff79c6">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span>&lt;span style="color:#ff79c6">&lt;/span> &lt;span style="color:#ff79c6">#endif
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span>&lt;span style="color:#ff79c6">&lt;/span> &lt;span style="color:#ff79c6">#endif
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span>&lt;span style="color:#ff79c6">#endif
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;a class="link" href="https://github.com/redis/redis/blob/d2c8a4b91e8c0e6aefd1f5bc0bf582cddbe046b7/src/ae.c#L52-L64" target="_blank" rel="noopener"
>ae.c#L52-L65&lt;/a>
é€šè¿‡åˆ¤æ–­å®å®šä¹‰ï¼Œç„¶åincludeä¸åŒçš„ .cæ–‡ä»¶ã€‚&lt;/p>
&lt;p>è¿™é‡Œå¯èƒ½æœ‰å¯¹Cè¯­è¨€äº†è§£ä¸æ·±çš„åŒå­¦å¯èƒ½ä¼šç–‘é—®ï¼Œ&lt;code>include&lt;/code> å…³é”®å­—ä¸æ˜¯ç”¨æ¥åŒ…å«å¤´æ–‡ä»¶çš„å—ï¼Œè¿˜èƒ½ç”¨æ¥å¼•å…¥ .cæ–‡ä»¶å—ï¼Ÿå…¶å®includeæ˜¯ç¼–è¯‘å™¨çš„ä¸€ä¸ªé¢„å¤„ç†æŒ‡ä»¤ï¼Œå°±æ˜¯ç®€å•çš„æŠŠå¯¹åº”çš„æ–‡ä»¶é‡Œçš„æ‰€æœ‰å†…å®¹ï¼Œæ”¾åˆ°includeçš„åœ°æ–¹è€Œå·²ã€‚&lt;/p>
&lt;p>æ‰“å¼€ &lt;code>ae_evport.c&lt;/code> &lt;code>ae_epoll.c&lt;/code> &lt;code>ae_kqueue.c&lt;/code> &lt;code>ae_select.c&lt;/code> è¿™å››ä¸ªæ–‡ä»¶æ¥çœ‹ï¼Œå¯¹å¤–æš´éœ²çš„å‡½æ•°æ¥å£éƒ½æ˜¯ä¸€æ ·çš„ã€‚åªæ˜¯åœ¨ä¸åŒçš„å¹³å°ä¸Šå†…éƒ¨çš„å¤„ç†ä¸åŒã€‚&lt;/p>
&lt;p>å¯¹å¤–æš´éœ²äº†è¿™äº›å‡½æ•°ï¼Œæ¥å®Œæˆç½‘ç»œçš„å¤„ç†&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#6272a4">//åˆ›å»ºä¸€ä¸ªloop
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span>&lt;span style="color:#ff79c6">static&lt;/span> &lt;span style="color:#8be9fd">int&lt;/span> &lt;span style="color:#50fa7b">aeApiCreate&lt;/span>(aeEventLoop &lt;span style="color:#ff79c6">*&lt;/span>eventLoop)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span>&lt;span style="color:#6272a4">//è®¾ç½®loopçš„å¤§å°
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span>&lt;span style="color:#ff79c6">static&lt;/span> &lt;span style="color:#8be9fd">int&lt;/span> &lt;span style="color:#50fa7b">aeApiResize&lt;/span>(aeEventLoop &lt;span style="color:#ff79c6">*&lt;/span>eventLoop, &lt;span style="color:#8be9fd">int&lt;/span> setsize)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span>&lt;span style="color:#6272a4">//é‡Šæ”¾ä¸€ä¸ª loop
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span>&lt;span style="color:#ff79c6">static&lt;/span> &lt;span style="color:#8be9fd">void&lt;/span> &lt;span style="color:#50fa7b">aeApiFree&lt;/span>(aeEventLoop &lt;span style="color:#ff79c6">*&lt;/span>eventLoop)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span>&lt;span style="color:#6272a4">//æ·»åŠ ä¸€ä¸ª eventLoop
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span>&lt;span style="color:#ff79c6">static&lt;/span> &lt;span style="color:#8be9fd">int&lt;/span> &lt;span style="color:#50fa7b">aeApiAddEvent&lt;/span>(aeEventLoop &lt;span style="color:#ff79c6">*&lt;/span>eventLoop, &lt;span style="color:#8be9fd">int&lt;/span> fd, &lt;span style="color:#8be9fd">int&lt;/span> mask)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span>&lt;span style="color:#6272a4">//åˆ é™¤ä¸€ä¸ª eventLoop
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span>&lt;span style="color:#ff79c6">static&lt;/span> &lt;span style="color:#8be9fd">void&lt;/span> &lt;span style="color:#50fa7b">aeApiDelEvent&lt;/span>(aeEventLoop &lt;span style="color:#ff79c6">*&lt;/span>eventLoop, &lt;span style="color:#8be9fd">int&lt;/span> fd, &lt;span style="color:#8be9fd">int&lt;/span> delmask)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span>&lt;span style="color:#6272a4">//ä¸åŒçš„ç½‘ç»œå¤„ç†ä¸­,è¿”å›éœ€è¦å¤„ç†çš„äº‹ä»¶
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span>&lt;span style="color:#ff79c6">static&lt;/span> &lt;span style="color:#8be9fd">int&lt;/span> &lt;span style="color:#50fa7b">aeApiPoll&lt;/span>(aeEventLoop &lt;span style="color:#ff79c6">*&lt;/span>eventLoop, &lt;span style="color:#ff79c6">struct&lt;/span> timeval &lt;span style="color:#ff79c6">*&lt;/span>tvp)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span>&lt;span style="color:#6272a4">//è¿”å›è¿™ä¸ªaeçš„åå­—,åœ¨epollä¸­å°±æ˜¯è¿”å› &amp;#34;epoll&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span>&lt;span style="color:#ff79c6">static&lt;/span> &lt;span style="color:#8be9fd">char&lt;/span> &lt;span style="color:#ff79c6">*&lt;/span>&lt;span style="color:#50fa7b">aeApiName&lt;/span>(&lt;span style="color:#8be9fd">void&lt;/span>)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™é‡Œæˆ‘ä»¬ä»¥Linuxå¹³å°ä¸ºä¸»ï¼Œæ‰€ä»¥ä½¿ç”¨çš„æ˜¯ &lt;code>ae_epoll.c&lt;/code>æ–‡ä»¶ä¸­çš„å†…å®¹ã€‚è¿™é‡Œå…ˆä¸å±•å¼€åˆ†ææ¯ä¸€ä¸ªå‡½æ•°ï¼Œå› ä¸ºè¿™ä¸æ˜¯æœ¬æ¬¡çš„é‡ç‚¹ã€‚&lt;/p>
&lt;h2 id="å¯åŠ¨ç½‘ç»œæœåŠ¡">&lt;a href="#%e5%90%af%e5%8a%a8%e7%bd%91%e7%bb%9c%e6%9c%8d%e5%8a%a1" class="header-anchor">&lt;/a>å¯åŠ¨ç½‘ç»œæœåŠ¡
&lt;/h2>&lt;p>åŸºæœ¬çš„æ•°æ®ç»“æ„ä»‹ç»å®Œï¼Œä¸‹é¢å¼€å§‹å¯åŠ¨ç½‘ç»œæœåŠ¡&lt;/p>
&lt;h3 id="ç›‘å¬client">&lt;a href="#%e7%9b%91%e5%90%acclient" class="header-anchor">&lt;/a>ç›‘å¬client
&lt;/h3>&lt;p>ç¬¬ä¸€æ­¥æ˜¯è°ƒç”¨ &lt;code>aeEventLoop *aeCreateEventLoop(int setsize)&lt;/code> å‡½æ•°ï¼Œåˆ›å»º &lt;code>aeEventLoop&lt;/code> è¿™ä¸ªå¯¹è±¡ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>aeEventLoop &lt;span style="color:#ff79c6">*&lt;/span>&lt;span style="color:#50fa7b">aeCreateEventLoop&lt;/span>(&lt;span style="color:#8be9fd">int&lt;/span> setsize) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span> aeEventLoop &lt;span style="color:#ff79c6">*&lt;/span>eventLoop;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span> &lt;span style="color:#8be9fd">int&lt;/span> i;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span> &lt;span style="color:#50fa7b">monotonicInit&lt;/span>(); &lt;span style="color:#6272a4">/* just in case the calling app didn&amp;#39;t initialize */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> ((eventLoop &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#50fa7b">zmalloc&lt;/span>(&lt;span style="color:#ff79c6">sizeof&lt;/span>(&lt;span style="color:#ff79c6">*&lt;/span>eventLoop))) &lt;span style="color:#ff79c6">==&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">NULL&lt;/span>) &lt;span style="color:#ff79c6">goto&lt;/span> err;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span> eventLoop&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>events &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#50fa7b">zmalloc&lt;/span>(&lt;span style="color:#ff79c6">sizeof&lt;/span>(aeFileEvent)&lt;span style="color:#ff79c6">*&lt;/span>setsize);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span> eventLoop&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>fired &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#50fa7b">zmalloc&lt;/span>(&lt;span style="color:#ff79c6">sizeof&lt;/span>(aeFiredEvent)&lt;span style="color:#ff79c6">*&lt;/span>setsize);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (eventLoop&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>events &lt;span style="color:#ff79c6">==&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">NULL&lt;/span> &lt;span style="color:#ff79c6">||&lt;/span> eventLoop&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>fired &lt;span style="color:#ff79c6">==&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">NULL&lt;/span>) &lt;span style="color:#ff79c6">goto&lt;/span> err;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span> eventLoop&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>setsize &lt;span style="color:#ff79c6">=&lt;/span> setsize;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span> eventLoop&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>timeEventHead &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">NULL&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span> eventLoop&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>timeEventNextId &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span> eventLoop&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>stop &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15&lt;/span>&lt;span> eventLoop&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>maxfd &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#ff79c6">-&lt;/span>&lt;span style="color:#bd93f9">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16&lt;/span>&lt;span> eventLoop&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>beforesleep &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">NULL&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17&lt;/span>&lt;span> eventLoop&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>aftersleep &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">NULL&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18&lt;/span>&lt;span> eventLoop&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>flags &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (&lt;span style="color:#50fa7b">aeApiCreate&lt;/span>(eventLoop) &lt;span style="color:#ff79c6">==&lt;/span> &lt;span style="color:#ff79c6">-&lt;/span>&lt;span style="color:#bd93f9">1&lt;/span>) &lt;span style="color:#ff79c6">goto&lt;/span> err;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20&lt;/span>&lt;span> &lt;span style="color:#6272a4">/* Events with mask == AE_NONE are not set. So let&amp;#39;s initialize the
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21&lt;/span>&lt;span>&lt;span style="color:#6272a4"> * vector with it. */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22&lt;/span>&lt;span> &lt;span style="color:#ff79c6">for&lt;/span> (i &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>; i &lt;span style="color:#ff79c6">&amp;lt;&lt;/span> setsize; i&lt;span style="color:#ff79c6">++&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23&lt;/span>&lt;span> eventLoop&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>events[i].mask &lt;span style="color:#ff79c6">=&lt;/span> AE_NONE;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> eventLoop;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">err&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (eventLoop) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28&lt;/span>&lt;span> &lt;span style="color:#50fa7b">zfree&lt;/span>(eventLoop&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>events);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29&lt;/span>&lt;span> &lt;span style="color:#50fa7b">zfree&lt;/span>(eventLoop&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>fired);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30&lt;/span>&lt;span> &lt;span style="color:#50fa7b">zfree&lt;/span>(eventLoop);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">NULL&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™é‡Œçš„å¤„ç†é€»è¾‘æ¯”è¾ƒç®€å•ï¼Œå°±æ˜¯åˆå§‹åŒ– &lt;code>aeEventLoop&lt;/code> ä¸­çš„æ•°æ®ç»“æ„ã€‚å¦‚æœä¸­é—´å‡ºé”™äº†ï¼Œå°±è¿”å› &lt;code>NULL&lt;/code>&lt;/p>
&lt;p>è¿™ä¸ªåœ¨ &lt;code>void initServer(void)&lt;/code> å‡½æ•°ä¸­è¢«è°ƒç”¨ã€‚
&lt;a class="link" href="https://github.com/redis/redis/blob/d2c8a4b91e8c0e6aefd1f5bc0bf582cddbe046b7/src/server.c#L2622" target="_blank" rel="noopener"
>aeCreateEventLoop&lt;/a>&lt;/p>
&lt;p>åˆ›å»ºä¸€ä¸ª&lt;code>aeEventLoop&lt;/code> å¹¶èµ‹å€¼ç»™ &lt;code>server&lt;/code>ã€‚å†å¾€ä¸Šç¿»ï¼Œæœ€ç»ˆçš„è°ƒç”¨ä½ç½®æ˜¯ &lt;code>main&lt;/code> å‡½æ•°ä¸­çš„&lt;a class="link" href="https://github.com/redis/redis/blob/d2c8a4b91e8c0e6aefd1f5bc0bf582cddbe046b7/src/server.c#L7298" target="_blank" rel="noopener"
>initServer();&lt;/a>&lt;/p>
&lt;p>åœ¨å¾€ä¸‹ï¼Œè¿˜æœ‰ä¸€ä¸ªæ¯”è¾ƒé‡è¦çš„å‡½æ•°ï¼Œé€šè¿‡è°ƒç”¨ &lt;a class="link" href="https://github.com/redis/redis/blob/d2c8a4b91e8c0e6aefd1f5bc0bf582cddbe046b7/src/server.c#L2711" target="_blank" rel="noopener"
>aeCreateTimeEvent&lt;/a> å‡½æ•°ï¼Œå®Œæˆå®šæ—¶å™¨ å¯¹åº”çš„ &lt;code>eventLoop&lt;/code> çš„åˆ›å»ºã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#8be9fd">long&lt;/span> &lt;span style="color:#8be9fd">long&lt;/span> &lt;span style="color:#50fa7b">aeCreateTimeEvent&lt;/span>(aeEventLoop &lt;span style="color:#ff79c6">*&lt;/span>eventLoop, &lt;span style="color:#8be9fd">long&lt;/span> &lt;span style="color:#8be9fd">long&lt;/span> milliseconds,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span> aeTimeProc &lt;span style="color:#ff79c6">*&lt;/span>proc, &lt;span style="color:#8be9fd">void&lt;/span> &lt;span style="color:#ff79c6">*&lt;/span>clientData,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span> aeEventFinalizerProc &lt;span style="color:#ff79c6">*&lt;/span>finalizerProc)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span> &lt;span style="color:#8be9fd">long&lt;/span> &lt;span style="color:#8be9fd">long&lt;/span> id &lt;span style="color:#ff79c6">=&lt;/span> eventLoop&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>timeEventNextId&lt;span style="color:#ff79c6">++&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span> aeTimeEvent &lt;span style="color:#ff79c6">*&lt;/span>te;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span> te &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#50fa7b">zmalloc&lt;/span>(&lt;span style="color:#ff79c6">sizeof&lt;/span>(&lt;span style="color:#ff79c6">*&lt;/span>te));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (te &lt;span style="color:#ff79c6">==&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">NULL&lt;/span>) &lt;span style="color:#ff79c6">return&lt;/span> AE_ERR;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span> te&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>id &lt;span style="color:#ff79c6">=&lt;/span> id;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span> te&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>when &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#50fa7b">getMonotonicUs&lt;/span>() &lt;span style="color:#ff79c6">+&lt;/span> milliseconds &lt;span style="color:#ff79c6">*&lt;/span> &lt;span style="color:#bd93f9">1000&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span> te&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>timeProc &lt;span style="color:#ff79c6">=&lt;/span> proc;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span> te&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>finalizerProc &lt;span style="color:#ff79c6">=&lt;/span> finalizerProc;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span> te&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>clientData &lt;span style="color:#ff79c6">=&lt;/span> clientData;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15&lt;/span>&lt;span> te&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>prev &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">NULL&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16&lt;/span>&lt;span> te&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>next &lt;span style="color:#ff79c6">=&lt;/span> eventLoop&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>timeEventHead;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17&lt;/span>&lt;span> te&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>refcount &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (te&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>next)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19&lt;/span>&lt;span> te&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>next&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>prev &lt;span style="color:#ff79c6">=&lt;/span> te;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20&lt;/span>&lt;span> eventLoop&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>timeEventHead &lt;span style="color:#ff79c6">=&lt;/span> te;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> id;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>éƒ½æ˜¯å¸¸è§„çš„å¤„ç†ï¼Œæ³¨æ„ä¸€ä¸‹ä¼ é€’è¿›æ¥çš„å‡ ä¸ªå‚æ•°&lt;/p>
&lt;ul>
&lt;li>&lt;code>eventLoop&lt;/code> æ˜¯ä¹‹å‰åˆ›å»ºçš„ eventLoopå¯¹è±¡&lt;/li>
&lt;li>&lt;code>proc&lt;/code> æ˜¯å®šæ—¶å™¨è§¦å‘æ—¶çš„å›è°ƒå‡½æ•°&lt;/li>
&lt;li>&lt;code>milliseconds&lt;/code> å®šæ—¶å™¨è§¦å‘çš„æ—¶é—´é—´éš”&lt;/li>
&lt;/ul>
&lt;p>&lt;a class="link" href="https://github.com/redis/redis/blob/d2c8a4b91e8c0e6aefd1f5bc0bf582cddbe046b7/src/server.c#L1260" target="_blank" rel="noopener"
>proc&lt;/a> å‡½æ•°çš„å®šä¹‰&lt;/p>
&lt;p>è¿™é‡Œä¸è¯¦ç»†å±•å¼€äº†ï¼Œå°±æ˜¯redisä¸­çš„ä¸€äº›å®šæ—¶æ“ä½œã€‚&lt;/p>
&lt;p>åœ¨ &lt;code>main&lt;/code> å‡½æ•°ä¸­ç»§ç»­å¾€ä¸‹ï¼Œä¼šçœ‹åˆ° &lt;code>initListeners();&lt;/code> è¿™ä¸ªå‡½æ•°ï¼Œä¸­è¿™é‡Œä¹Ÿèƒ½çŸ¥é“ï¼Œè¿™é‡Œåˆ›å»º ç½‘ç»œçš„ç›‘å¬&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#8be9fd">void&lt;/span> &lt;span style="color:#50fa7b">initListeners&lt;/span>(&lt;span style="color:#8be9fd">void&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span> &lt;span style="color:#6272a4">/* Setup listeners from server config for TCP/TLS/Unix */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span> &lt;span style="color:#8be9fd">int&lt;/span> conn_index;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span> connListener &lt;span style="color:#ff79c6">*&lt;/span>listener;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span> &lt;span style="color:#6272a4">//åˆ¤æ–­æ˜¯å¦éœ€è¦ç›‘å¬æ™®é€šçš„TCP
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">if&lt;/span> (server.port &lt;span style="color:#ff79c6">!=&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span> conn_index &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#50fa7b">connectionIndexByType&lt;/span>(CONN_TYPE_SOCKET);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (conn_index &lt;span style="color:#ff79c6">&amp;lt;&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span> &lt;span style="color:#50fa7b">serverPanic&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;Failed finding connection listener of %s&amp;#34;&lt;/span>, CONN_TYPE_SOCKET);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span> listener &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#ff79c6">&amp;amp;&lt;/span>server.listeners[conn_index];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span> listener&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>bindaddr &lt;span style="color:#ff79c6">=&lt;/span> server.bindaddr;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span> listener&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>bindaddr_count &lt;span style="color:#ff79c6">=&lt;/span> server.bindaddr_count;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span> listener&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>port &lt;span style="color:#ff79c6">=&lt;/span> server.port;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span> listener&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>ct &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#50fa7b">connectionByType&lt;/span>(CONN_TYPE_SOCKET);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16&lt;/span>&lt;span> &lt;span style="color:#6272a4">//åˆ¤æ–­æ˜¯å¦éœ€è¦ç›‘å¬,å¦‚æœéœ€è¦,æ£€æŸ¥tlséœ€è¦çš„é…ç½®æ˜¯å¦æ­£ç¡®
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">if&lt;/span> (server.tls_port &lt;span style="color:#ff79c6">||&lt;/span> server.tls_replication &lt;span style="color:#ff79c6">||&lt;/span> server.tls_cluster) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18&lt;/span>&lt;span> ConnectionType &lt;span style="color:#ff79c6">*&lt;/span>ct_tls &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#50fa7b">connectionTypeTls&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (&lt;span style="color:#ff79c6">!&lt;/span>ct_tls) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20&lt;/span>&lt;span> &lt;span style="color:#50fa7b">serverLog&lt;/span>(LL_WARNING, &lt;span style="color:#f1fa8c">&amp;#34;Failed finding TLS support.&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21&lt;/span>&lt;span> &lt;span style="color:#50fa7b">exit&lt;/span>(&lt;span style="color:#bd93f9">1&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (&lt;span style="color:#50fa7b">connTypeConfigure&lt;/span>(ct_tls, &lt;span style="color:#ff79c6">&amp;amp;&lt;/span>server.tls_ctx_config, &lt;span style="color:#bd93f9">1&lt;/span>) &lt;span style="color:#ff79c6">==&lt;/span> C_ERR) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24&lt;/span>&lt;span> &lt;span style="color:#50fa7b">serverLog&lt;/span>(LL_WARNING, &lt;span style="color:#f1fa8c">&amp;#34;Failed to configure TLS. Check logs for more info.&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25&lt;/span>&lt;span> &lt;span style="color:#50fa7b">exit&lt;/span>(&lt;span style="color:#bd93f9">1&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28&lt;/span>&lt;span> &lt;span style="color:#6272a4">//åˆ¤æ–­æ˜¯å¦éœ€è¦ç›‘å¬ TLSçš„TCP
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">if&lt;/span> (server.tls_port &lt;span style="color:#ff79c6">!=&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30&lt;/span>&lt;span> conn_index &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#50fa7b">connectionIndexByType&lt;/span>(CONN_TYPE_TLS);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (conn_index &lt;span style="color:#ff79c6">&amp;lt;&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32&lt;/span>&lt;span> &lt;span style="color:#50fa7b">serverPanic&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;Failed finding connection listener of %s&amp;#34;&lt;/span>, CONN_TYPE_TLS);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33&lt;/span>&lt;span> listener &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#ff79c6">&amp;amp;&lt;/span>server.listeners[conn_index];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34&lt;/span>&lt;span> listener&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>bindaddr &lt;span style="color:#ff79c6">=&lt;/span> server.bindaddr;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35&lt;/span>&lt;span> listener&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>bindaddr_count &lt;span style="color:#ff79c6">=&lt;/span> server.bindaddr_count;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36&lt;/span>&lt;span> listener&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>port &lt;span style="color:#ff79c6">=&lt;/span> server.tls_port;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37&lt;/span>&lt;span> listener&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>ct &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#50fa7b">connectionByType&lt;/span>(CONN_TYPE_TLS);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39&lt;/span>&lt;span> &lt;span style="color:#6272a4">//åˆ¤æ–­æ˜¯å¦éœ€è¦unixsocket
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">if&lt;/span> (server.unixsocket &lt;span style="color:#ff79c6">!=&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">NULL&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41&lt;/span>&lt;span> conn_index &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#50fa7b">connectionIndexByType&lt;/span>(CONN_TYPE_UNIX);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (conn_index &lt;span style="color:#ff79c6">&amp;lt;&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43&lt;/span>&lt;span> &lt;span style="color:#50fa7b">serverPanic&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;Failed finding connection listener of %s&amp;#34;&lt;/span>, CONN_TYPE_UNIX);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44&lt;/span>&lt;span> listener &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#ff79c6">&amp;amp;&lt;/span>server.listeners[conn_index];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45&lt;/span>&lt;span> listener&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>bindaddr &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#ff79c6">&amp;amp;&lt;/span>server.unixsocket;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46&lt;/span>&lt;span> listener&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>bindaddr_count &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#bd93f9">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47&lt;/span>&lt;span> listener&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>ct &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#50fa7b">connectionByType&lt;/span>(CONN_TYPE_UNIX);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48&lt;/span>&lt;span> listener&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>priv &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#ff79c6">&amp;amp;&lt;/span>server.unixsocketperm; &lt;span style="color:#6272a4">/* Unix socket specified */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">51&lt;/span>&lt;span> &lt;span style="color:#6272a4">/* create all the configured listener, and add handler to start to accept */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">52&lt;/span>&lt;span> &lt;span style="color:#8be9fd">int&lt;/span> listen_fds &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">53&lt;/span>&lt;span> &lt;span style="color:#ff79c6">for&lt;/span> (&lt;span style="color:#8be9fd">int&lt;/span> j &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>; j &lt;span style="color:#ff79c6">&amp;lt;&lt;/span> CONN_TYPE_MAX; j&lt;span style="color:#ff79c6">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">54&lt;/span>&lt;span> listener &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#ff79c6">&amp;amp;&lt;/span>server.listeners[j];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">55&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (listener&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>ct &lt;span style="color:#ff79c6">==&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">NULL&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">56&lt;/span>&lt;span> &lt;span style="color:#ff79c6">continue&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">57&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">58&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (&lt;span style="color:#50fa7b">connListen&lt;/span>(listener) &lt;span style="color:#ff79c6">==&lt;/span> C_ERR) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">59&lt;/span>&lt;span> &lt;span style="color:#50fa7b">serverLog&lt;/span>(LL_WARNING, &lt;span style="color:#f1fa8c">&amp;#34;Failed listening on port %u (%s), aborting.&amp;#34;&lt;/span>, listener&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>port, listener&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>ct&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>&lt;span style="color:#50fa7b">get_type&lt;/span>(&lt;span style="color:#8be9fd;font-style:italic">NULL&lt;/span>));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">60&lt;/span>&lt;span> &lt;span style="color:#50fa7b">exit&lt;/span>(&lt;span style="color:#bd93f9">1&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">61&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">62&lt;/span>&lt;span> &lt;span style="color:#6272a4">//åˆ›å»ºæ–°çš„è¿æ¥å¤„ç†äº‹ä»¶
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">63&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">if&lt;/span> (&lt;span style="color:#50fa7b">createSocketAcceptHandler&lt;/span>(listener, &lt;span style="color:#50fa7b">connAcceptHandler&lt;/span>(listener&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>ct)) &lt;span style="color:#ff79c6">!=&lt;/span> C_OK)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">64&lt;/span>&lt;span> &lt;span style="color:#50fa7b">serverPanic&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;Unrecoverable error creating %s listener accept handler.&amp;#34;&lt;/span>, listener&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>ct&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>&lt;span style="color:#50fa7b">get_type&lt;/span>(&lt;span style="color:#8be9fd;font-style:italic">NULL&lt;/span>));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">65&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">66&lt;/span>&lt;span> listen_fds &lt;span style="color:#ff79c6">+=&lt;/span> listener&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>count;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">67&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">68&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">69&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (listen_fds &lt;span style="color:#ff79c6">==&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">70&lt;/span>&lt;span> &lt;span style="color:#50fa7b">serverLog&lt;/span>(LL_WARNING, &lt;span style="color:#f1fa8c">&amp;#34;Configured to not listen anywhere, exiting.&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">71&lt;/span>&lt;span> &lt;span style="color:#50fa7b">exit&lt;/span>(&lt;span style="color:#bd93f9">1&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">72&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">73&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>åœ¨è¿™ä¸ªå‡½æ•°é‡Œï¼Œæ ¹æ®é…ç½®æ–‡ä»¶ï¼Œå¼€å§‹ç›‘å¬å¯¹åº”çš„ç«¯å£æˆ–è€… unixsocktã€‚&lt;/p>
&lt;p>è¿™é‡Œå¼•å…¥äº† &lt;code>connListener&lt;/code> &lt;code>connection&lt;/code> &lt;code>ConnectionType&lt;/code> è¿™ä¸‰ä¸ªç»“æ„&lt;/p>
&lt;ul>
&lt;li>&lt;code>connListener&lt;/code> æ˜¯å¯¹ç½‘ç»œç›‘å¬çš„å°è£…&lt;/li>
&lt;li>&lt;code>connection&lt;/code> æ˜¯å¯¹ç½‘ç»œè¿æ¥çš„å°è£…&lt;/li>
&lt;li>&lt;code>ConnectionType&lt;/code> å°è£…äº†æ“ä½œç½‘ç»œéœ€è¦çš„å‡½æ•°&lt;/li>
&lt;/ul>
&lt;p>&lt;code>ConnectionType&lt;/code> æœ‰ä¸‰ä¸ªä¸åŒçš„å®ç°ï¼Œåˆ†åˆ«æ˜¯:&lt;/p>
&lt;ul>
&lt;li>&lt;code>CT_Socket&lt;/code> å¯¹åº”çš„TCP &lt;a class="link" href="https://github.com/redis/redis/blob/d2c8a4b91e8c0e6aefd1f5bc0bf582cddbe046b7/src/socket.c#L52" target="_blank" rel="noopener"
>CT_Socket&lt;/a>&lt;/li>
&lt;li>&lt;code>CT_Unix&lt;/code> å¯¹åº”çš„æ˜¯ unix socket &lt;a class="link" href="https://github.com/redis/redis/blob/d2c8a4b91e8c0e6aefd1f5bc0bf582cddbe046b7/src/unix.c#L30" target="_blank" rel="noopener"
>CT_Unix&lt;/a>&lt;/li>
&lt;li>&lt;code>CT_TLS&lt;/code> å¯¹åº”çš„ ä½¿ç”¨äº† TLSçš„TCP &lt;a class="link" href="https://github.com/redis/redis/blob/d2c8a4b91e8c0e6aefd1f5bc0bf582cddbe046b7/src/tls.c#L424" target="_blank" rel="noopener"
>CT_TLS&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>&lt;a class="link" href="https://github.com/redis/redis/blob/d2c8a4b91e8c0e6aefd1f5bc0bf582cddbe046b7/src/connection.h#L68-L140" target="_blank" rel="noopener"
>ConnectionType å®šä¹‰&lt;/a>&lt;/p>
&lt;p>ConnectionTypeå†…éƒ¨çš„å‡½æ•°è¿™é‡Œå°±ä¸å±•å¼€è¯¦ç»†ä»‹ç»äº†ã€‚&lt;/p>
&lt;p>åœ¨ &lt;code>initListeners&lt;/code> ä¸­è°ƒç”¨äº† &lt;code>connListen&lt;/code> å‡½æ•°ï¼Œæ¥å®Œæˆå¯¹ä¸åŒç½‘ç»œçš„ç›‘å¬ï¼Œè¿™é‡Œå®ç°ä¹ŸæŒºç®€å•çš„ï¼Œå°±æ˜¯è°ƒç”¨äº†&lt;code>ConnectionType&lt;/code> ä¸­çš„ &lt;code>listen&lt;/code> å‡½æ•°ï¼Œå®Œæˆäº†å¯¹ç«¯å£æˆ–è€…unixsocketçš„ç›‘å¬ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">static&lt;/span> &lt;span style="color:#ff79c6">inline&lt;/span> &lt;span style="color:#8be9fd">int&lt;/span> &lt;span style="color:#50fa7b">connListen&lt;/span>(connListener &lt;span style="color:#ff79c6">*&lt;/span>listener) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> listener&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>ct&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>&lt;span style="color:#50fa7b">listen&lt;/span>(listener);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä»¥ &lt;code>socket&lt;/code> ä¸ºä¾‹ï¼Œå¯¹åº”çš„listenå‡½æ•°å°±æ˜¯ &lt;code>connSocketListen&lt;/code> å¯¹åº”çš„åˆå§‹åŒ–åœ¨è¿™é‡Œ&lt;a class="link" href="https://github.com/redis/redis/blob/d2c8a4b91e8c0e6aefd1f5bc0bf582cddbe046b7/src/socket.c#L406" target="_blank" rel="noopener"
>.listen = connSocketListen&lt;/a>&lt;/p>
&lt;p>æœ€ç»ˆå®ç°å¯¹ç«¯å£ç›‘å¬çš„å‡½æ•°æ˜¯ &lt;a class="link" href="https://github.com/redis/redis/blob/d2c8a4b91e8c0e6aefd1f5bc0bf582cddbe046b7/src/server.c#L2446" target="_blank" rel="noopener"
>listenToPort(connListener *sfd)&lt;/a>&lt;/p>
&lt;p>è¯é¢˜æ”¶å›æ¥ï¼Œå›åˆ° &lt;code>initListeners&lt;/code> å‡½æ•°ä¸­ è°ƒç”¨ &lt;code>connListen&lt;/code> å‡½æ•°å®Œæˆç›‘å¬åï¼Œä¼šå†è°ƒç”¨&lt;code>createSocketAcceptHandler&lt;/code> å‡½æ•° å®Œæˆç½‘ç»œçš„ &lt;code>Accept&lt;/code> å¤„ç†é€»è¾‘ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#8be9fd">int&lt;/span> &lt;span style="color:#50fa7b">createSocketAcceptHandler&lt;/span>(connListener &lt;span style="color:#ff79c6">*&lt;/span>sfd, aeFileProc &lt;span style="color:#ff79c6">*&lt;/span>accept_handler) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span> &lt;span style="color:#8be9fd">int&lt;/span> j;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span> &lt;span style="color:#ff79c6">for&lt;/span> (j &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>; j &lt;span style="color:#ff79c6">&amp;lt;&lt;/span> sfd&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>count; j&lt;span style="color:#ff79c6">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (&lt;span style="color:#50fa7b">aeCreateFileEvent&lt;/span>(server.el, sfd&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>fd[j], AE_READABLE, accept_handler,sfd) &lt;span style="color:#ff79c6">==&lt;/span> AE_ERR) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span> &lt;span style="color:#6272a4">/* Rollback */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span> &lt;span style="color:#ff79c6">for&lt;/span> (j &lt;span style="color:#ff79c6">=&lt;/span> j&lt;span style="color:#ff79c6">-&lt;/span>&lt;span style="color:#bd93f9">1&lt;/span>; j &lt;span style="color:#ff79c6">&amp;gt;=&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>; j&lt;span style="color:#ff79c6">--&lt;/span>) &lt;span style="color:#50fa7b">aeDeleteFileEvent&lt;/span>(server.el, sfd&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>fd[j], AE_READABLE);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> C_ERR;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> C_OK;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™é‡Œé€»è¾‘ä¹ŸæŒºç®€å•ï¼Œéå†ä¹‹å‰acceptçš„ &lt;code>fd&lt;/code>ï¼Œå°†fdåŠ å…¥åˆ° &lt;code>aeEventLoop&lt;/code> ä¸­ï¼Œå¦‚æœå¤±è´¥äº†ï¼Œå°±å›æ»šæ‰€æœ‰æ•°æ®ï¼Œä¹Ÿå°±æ˜¯ä¸­ &lt;code>aeEventLoop&lt;/code> ä¸­åˆ é™¤å¯¹åº”çš„äº‹ä»¶ã€‚&lt;/p>
&lt;p>&lt;code>aeCreateFileEvent&lt;/code>çš„å®ç°&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#8be9fd">int&lt;/span> &lt;span style="color:#50fa7b">aeCreateFileEvent&lt;/span>(aeEventLoop &lt;span style="color:#ff79c6">*&lt;/span>eventLoop, &lt;span style="color:#8be9fd">int&lt;/span> fd, &lt;span style="color:#8be9fd">int&lt;/span> mask,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span> aeFileProc &lt;span style="color:#ff79c6">*&lt;/span>proc, &lt;span style="color:#8be9fd">void&lt;/span> &lt;span style="color:#ff79c6">*&lt;/span>clientData)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (fd &lt;span style="color:#ff79c6">&amp;gt;=&lt;/span> eventLoop&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>setsize) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span> errno &lt;span style="color:#ff79c6">=&lt;/span> ERANGE;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> AE_ERR;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span> aeFileEvent &lt;span style="color:#ff79c6">*&lt;/span>fe &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#ff79c6">&amp;amp;&lt;/span>eventLoop&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>events[fd];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span> &lt;span style="color:#6272a4">//è°ƒç”¨å¯¹åº”å¹³å°çš„ç³»ç»Ÿå‡½æ•°,æŠŠå¯¹åº”çš„äº‹ä»¶åŠ å…¥åˆ°æ“ä½œç³»ç»Ÿä¸­
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#6272a4">//æ¯”å¦‚åœ¨epollä¸­å°±æ˜¯è°ƒç”¨ epoll_ctl å‡½æ•°æŠŠ äº‹ä»¶åŠ å…¥ epollä¸­
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">if&lt;/span> (&lt;span style="color:#50fa7b">aeApiAddEvent&lt;/span>(eventLoop, fd, mask) &lt;span style="color:#ff79c6">==&lt;/span> &lt;span style="color:#ff79c6">-&lt;/span>&lt;span style="color:#bd93f9">1&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> AE_ERR;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span> fe&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>mask &lt;span style="color:#ff79c6">|=&lt;/span> mask;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (mask &lt;span style="color:#ff79c6">&amp;amp;&lt;/span> AE_READABLE) fe&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>rfileProc &lt;span style="color:#ff79c6">=&lt;/span> proc;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (mask &lt;span style="color:#ff79c6">&amp;amp;&lt;/span> AE_WRITABLE) fe&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>wfileProc &lt;span style="color:#ff79c6">=&lt;/span> proc;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16&lt;/span>&lt;span> fe&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>clientData &lt;span style="color:#ff79c6">=&lt;/span> clientData;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (fd &lt;span style="color:#ff79c6">&amp;gt;&lt;/span> eventLoop&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>maxfd)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18&lt;/span>&lt;span> eventLoop&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>maxfd &lt;span style="color:#ff79c6">=&lt;/span> fd;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> AE_OK;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä¹Ÿæ˜¯å¸¸è§„çš„å¤„ç†é€»è¾‘ï¼Œè¿™é‡Œéœ€è¦æ³¨æ„ä¸€ä¸‹ï¼Œä¼ é€’çš„å‡ ä¸ªå‚æ•°ã€‚&lt;/p>
&lt;ul>
&lt;li>&lt;code>aeEventLoop&lt;/code> å°±æ˜¯ä¹‹å‰é€šè¿‡ &lt;code>aeCreateEventLoop&lt;/code> å‡½æ•°åˆ›å»ºçš„å¯¹è±¡ã€‚&lt;/li>
&lt;li>&lt;code>fd&lt;/code> æ˜¯å¯¹åº”çš„æ–‡ä»¶æè¿°ç¬¦&lt;/li>
&lt;li>&lt;code>mask&lt;/code> å¯¹åº”çš„è¿™ä¸ªevent éœ€è¦å¤„ç†çš„äº‹ä»¶ç±»å‹ï¼Œæ¯”å¦‚ è¯»ï¼Œå†™ç­‰ç­‰&lt;/li>
&lt;li>&lt;code>proc&lt;/code> è¿™ä¸ªæ˜¯ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œå½“å¯¹åº”çš„äº‹ä»¶è§¦å‘æ—¶ï¼Œä½¿ç”¨è¿™ä¸ªå‡½æ•°æ¥å¤„ç†ã€‚æ¯”å¦‚è¿™é‡Œå°±æ˜¯å½“&lt;code>fd&lt;/code>æœ‰è¯»å†™äº‹ä»¶è§¦å‘æ—¶ï¼Œå°±ä¼šè°ƒç”¨è¿™ä¸ªå‡½æ•°ï¼Œä¹Ÿå°±æ˜¯å½“æœ‰æ–°çš„å®¢æˆ·ç«¯è¿æ¥æ—¶ï¼Œå°±é€šè¿‡è¿™ä¸ªå‡½æ•°æ¥å¤„ç†&lt;/li>
&lt;li>&lt;code>clientData&lt;/code> æ˜¯è¿™ä¸ªeventçš„æ•°æ®&lt;/li>
&lt;/ul>
&lt;p>è¿™é‡Œçš„ &lt;code>proc&lt;/code> æ˜¯&lt;code>socket.c&lt;/code>æ–‡ä»¶ä¸­çš„ &lt;a class="link" href="https://github.com/redis/redis/blob/d2c8a4b91e8c0e6aefd1f5bc0bf582cddbe046b7/src/socket.c#L311" target="_blank" rel="noopener"
>connSocketAcceptHandler&lt;/a> å‡½æ•°ã€‚è¿™ä¸ªå‡½æ•°åé¢ç½‘ç»œè¯»å†™åœ¨åˆ†æã€‚åˆ°è¿™é‡Œï¼Œrediså¯¹clientçš„ç½‘ç»œç›‘å¬åŸºæœ¬å®Œæˆäº†ã€‚&lt;/p>
&lt;h3 id="ç›‘å¬cluster">&lt;a href="#%e7%9b%91%e5%90%accluster" class="header-anchor">&lt;/a>ç›‘å¬cluster
&lt;/h3>&lt;p>å¦‚æœrediså¼€å¯äº†é›†ç¾¤ï¼Œéœ€è¦å¯¹é›†ç¾¤ä¸­å…¶ä»–çš„redisåšç½‘ç»œç›‘å¬ï¼Œä¸å…¶ä»–çš„redisäº’è”&lt;/p>
&lt;p>&lt;a class="link" href="https://github.com/redis/redis/blob/d2c8a4b91e8c0e6aefd1f5bc0bf582cddbe046b7/src/server.c#L7312-L7315" target="_blank" rel="noopener"
>å¼€å¯cluster&lt;/a>&lt;/p>
&lt;p>åœ¨è¿™é‡Œè°ƒç”¨ &lt;a class="link" href="https://github.com/redis/redis/blob/d2c8a4b91e8c0e6aefd1f5bc0bf582cddbe046b7/src/cluster.c#L1072" target="_blank" rel="noopener"
>clusterInitListeners&lt;/a> å¼€å¯å¯¹ &lt;code>cluster&lt;/code> çš„ç›‘å¬ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#8be9fd">void&lt;/span> &lt;span style="color:#50fa7b">clusterInitListeners&lt;/span>(&lt;span style="color:#8be9fd">void&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (&lt;span style="color:#50fa7b">connectionIndexByType&lt;/span>(&lt;span style="color:#50fa7b">connTypeOfCluster&lt;/span>()&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>&lt;span style="color:#50fa7b">get_type&lt;/span>(&lt;span style="color:#8be9fd;font-style:italic">NULL&lt;/span>)) &lt;span style="color:#ff79c6">&amp;lt;&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span> &lt;span style="color:#50fa7b">serverLog&lt;/span>(LL_WARNING, &lt;span style="color:#f1fa8c">&amp;#34;Missing connection type %s, but it is required for the Cluster bus.&amp;#34;&lt;/span>, &lt;span style="color:#50fa7b">connTypeOfCluster&lt;/span>()&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>&lt;span style="color:#50fa7b">get_type&lt;/span>(&lt;span style="color:#8be9fd;font-style:italic">NULL&lt;/span>));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span> &lt;span style="color:#50fa7b">exit&lt;/span>(&lt;span style="color:#bd93f9">1&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span> &lt;span style="color:#8be9fd">int&lt;/span> port &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#50fa7b">defaultClientPort&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span> connListener &lt;span style="color:#ff79c6">*&lt;/span>listener &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#ff79c6">&amp;amp;&lt;/span>server.clistener;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span> listener&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>count &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span> listener&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>bindaddr &lt;span style="color:#ff79c6">=&lt;/span> server.bindaddr;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span> listener&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>bindaddr_count &lt;span style="color:#ff79c6">=&lt;/span> server.bindaddr_count;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span> listener&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>port &lt;span style="color:#ff79c6">=&lt;/span> server.cluster_port &lt;span style="color:#ff79c6">?&lt;/span> server.&lt;span style="color:#8be9fd;font-style:italic">cluster_port&lt;/span> : port &lt;span style="color:#ff79c6">+&lt;/span> CLUSTER_PORT_INCR;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span> listener&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>ct &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#50fa7b">connTypeOfCluster&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (&lt;span style="color:#50fa7b">connListen&lt;/span>(listener) &lt;span style="color:#ff79c6">==&lt;/span> C_ERR ) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15&lt;/span>&lt;span> &lt;span style="color:#6272a4">/* Note: the following log text is matched by the test suite. */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16&lt;/span>&lt;span> &lt;span style="color:#50fa7b">serverLog&lt;/span>(LL_WARNING, &lt;span style="color:#f1fa8c">&amp;#34;Failed listening on port %u (cluster), aborting.&amp;#34;&lt;/span>, listener&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>port);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17&lt;/span>&lt;span> &lt;span style="color:#50fa7b">exit&lt;/span>(&lt;span style="color:#bd93f9">1&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (&lt;span style="color:#50fa7b">createSocketAcceptHandler&lt;/span>(&lt;span style="color:#ff79c6">&amp;amp;&lt;/span>server.clistener, clusterAcceptHandler) &lt;span style="color:#ff79c6">!=&lt;/span> C_OK) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21&lt;/span>&lt;span> &lt;span style="color:#50fa7b">serverPanic&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;Unrecoverable error creating Redis Cluster socket accept handler.&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™é‡Œçš„é€»è¾‘å’Œclienté‚£éƒ¨åˆ†ç±»ä¼¼ï¼Œä¸åŒçš„åœ°æ–¹æ˜¯ &lt;code>aeFileEvent&lt;/code> ä¸­çš„å›è°ƒå‡½æ•°å˜æˆäº† &lt;a class="link" href="https://github.com/redis/redis/blob/d2c8a4b91e8c0e6aefd1f5bc0bf582cddbe046b7/src/cluster.c#L1280" target="_blank" rel="noopener"
>clusterAcceptHandler&lt;/a> è¿™é‡Œä¸å±•å¼€äº†ã€‚&lt;/p>
&lt;p>ç„¶åä¼šè°ƒç”¨ &lt;a class="link" href="https://github.com/redis/redis/blob/d2c8a4b91e8c0e6aefd1f5bc0bf582cddbe046b7/src/server.c#L2830" target="_blank" rel="noopener"
>InitServerLast&lt;/a> å‡½æ•°&lt;/p>
&lt;p>è¿™é‡Œæ³¨æ„å…³æ³¨ &lt;a class="link" href="https://github.com/redis/redis/blob/d2c8a4b91e8c0e6aefd1f5bc0bf582cddbe046b7/src/networking.c#L4220" target="_blank" rel="noopener"
>initThreadedIO&lt;/a> è¿™ä¸ªå‡½æ•°&lt;/p>
&lt;p>redis åœ¨6.0 ç‰ˆæœ¬åŠ å…¥äº†å¤šçº¿ç¨‹æ”¯æŒï¼Œå…¶å®redisçš„å¤šçº¿ç¨‹åªæ˜¯åœ¨ ç½‘ç»œ I/O åŠ å…¥äº†å¤šçº¿ç¨‹å¤„ç†ï¼Œåœ¨å¤„ç†å‘½ä»¤æ—¶è¿˜æ˜¯å•çº¿ç¨‹ï¼Œè¿™é‡Œå°±æ˜¯åšäº†å¤šçº¿ç¨‹çš„å¤„ç†ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#8be9fd">void&lt;/span> &lt;span style="color:#50fa7b">initThreadedIO&lt;/span>(&lt;span style="color:#8be9fd">void&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span> server.io_threads_active &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>; &lt;span style="color:#6272a4">/* We start with threads not active. */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span> &lt;span style="color:#6272a4">/* Indicate that io-threads are currently idle */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span> io_threads_op &lt;span style="color:#ff79c6">=&lt;/span> IO_THREADS_OP_IDLE;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span> &lt;span style="color:#6272a4">//å¦‚æœå°±ä¸€ä¸ªçº¿ç¨‹ï¼Œä¹Ÿæ²¡å¿…è¦å¼€æ–°çš„çº¿ç¨‹äº†
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">if&lt;/span> (server.io_threads_num &lt;span style="color:#ff79c6">==&lt;/span> &lt;span style="color:#bd93f9">1&lt;/span>) &lt;span style="color:#ff79c6">return&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span> &lt;span style="color:#6272a4">//åˆ¤æ–­ä¸€ä¸‹ï¼Œå¦‚æœçº¿ç¨‹å¤ªå¤šäº†ï¼Œå°±æç¤ºé”™è¯¯ï¼Œä¸èƒ½å¼€å¯å¤ªå¤šçº¿ç¨‹
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">if&lt;/span> (server.io_threads_num &lt;span style="color:#ff79c6">&amp;gt;&lt;/span> IO_THREADS_MAX_NUM) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span> &lt;span style="color:#50fa7b">serverLog&lt;/span>(LL_WARNING,&lt;span style="color:#f1fa8c">&amp;#34;Fatal: too many I/O threads configured. &amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span> &lt;span style="color:#f1fa8c">&amp;#34;The maximum number is %d.&amp;#34;&lt;/span>, IO_THREADS_MAX_NUM);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span> &lt;span style="color:#50fa7b">exit&lt;/span>(&lt;span style="color:#bd93f9">1&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17&lt;/span>&lt;span> &lt;span style="color:#6272a4">/* Spawn and initialize the I/O threads. */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18&lt;/span>&lt;span> &lt;span style="color:#ff79c6">for&lt;/span> (&lt;span style="color:#8be9fd">int&lt;/span> i &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>; i &lt;span style="color:#ff79c6">&amp;lt;&lt;/span> server.io_threads_num; i&lt;span style="color:#ff79c6">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19&lt;/span>&lt;span> &lt;span style="color:#6272a4">/* Things we do for all the threads including the main thread. */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20&lt;/span>&lt;span> io_threads_list[i] &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#50fa7b">listCreate&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (i &lt;span style="color:#ff79c6">==&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>) &lt;span style="color:#ff79c6">continue&lt;/span>; &lt;span style="color:#6272a4">/* Thread 0 is the main thread. */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23&lt;/span>&lt;span> &lt;span style="color:#6272a4">/* Things we do only for the additional threads. */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24&lt;/span>&lt;span> &lt;span style="color:#8be9fd">pthread_t&lt;/span> tid;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25&lt;/span>&lt;span> &lt;span style="color:#50fa7b">pthread_mutex_init&lt;/span>(&lt;span style="color:#ff79c6">&amp;amp;&lt;/span>io_threads_mutex[i],&lt;span style="color:#8be9fd;font-style:italic">NULL&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26&lt;/span>&lt;span> &lt;span style="color:#50fa7b">setIOPendingCount&lt;/span>(i, &lt;span style="color:#bd93f9">0&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27&lt;/span>&lt;span> &lt;span style="color:#50fa7b">pthread_mutex_lock&lt;/span>(&lt;span style="color:#ff79c6">&amp;amp;&lt;/span>io_threads_mutex[i]); &lt;span style="color:#6272a4">/* Thread will be stopped. */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (&lt;span style="color:#50fa7b">pthread_create&lt;/span>(&lt;span style="color:#ff79c6">&amp;amp;&lt;/span>tid,&lt;span style="color:#8be9fd;font-style:italic">NULL&lt;/span>,IOThreadMain,(&lt;span style="color:#8be9fd">void&lt;/span>&lt;span style="color:#ff79c6">*&lt;/span>)(&lt;span style="color:#8be9fd">long&lt;/span>)i) &lt;span style="color:#ff79c6">!=&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29&lt;/span>&lt;span> &lt;span style="color:#50fa7b">serverLog&lt;/span>(LL_WARNING,&lt;span style="color:#f1fa8c">&amp;#34;Fatal: Can&amp;#39;t initialize IO thread.&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30&lt;/span>&lt;span> &lt;span style="color:#50fa7b">exit&lt;/span>(&lt;span style="color:#bd93f9">1&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32&lt;/span>&lt;span> io_threads[i] &lt;span style="color:#ff79c6">=&lt;/span> tid;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä½¿ç”¨ &lt;code>pthread_create&lt;/code> åˆ›å»ºçº¿ç¨‹çº¿ç¨‹ï¼Œ&lt;a class="link" href="https://github.com/redis/redis/blob/d2c8a4b91e8c0e6aefd1f5bc0bf582cddbe046b7/src/networking.c#L4173" target="_blank" rel="noopener"
>IOThreadMain&lt;/a> æ˜¯å¯¹åº”çº¿ç¨‹çš„å¤„ç†å‡½æ•°ã€‚&lt;/p>
&lt;p>è¿™ä¸ªå‡½æ•°å…ˆä¸å±•å¼€ï¼Œç­‰åé¢å¤„ç†ç½‘ç»œè¯»å†™çš„æ—¶å€™ï¼Œä¼šæåˆ°ã€‚&lt;/p>
&lt;p>å›åˆ° &lt;code>main&lt;/code> å‡½æ•°é‡Œï¼Œç»§ç»­å¾€ä¸‹èµ°ï¼Œæœ€åä¼šè°ƒç”¨ &lt;a class="link" href="https://github.com/redis/redis/blob/d2c8a4b91e8c0e6aefd1f5bc0bf582cddbe046b7/src/ae.c#L493" target="_blank" rel="noopener"
>aeMain&lt;/a> æ¥é˜»å¡å½“å‰çº¿ç¨‹ï¼Œç„¶åå¤„ç†ç½‘ç»œã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>&lt;span style="color:#8be9fd">void&lt;/span> &lt;span style="color:#50fa7b">aeMain&lt;/span>(aeEventLoop &lt;span style="color:#ff79c6">*&lt;/span>eventLoop) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span> eventLoop&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>stop &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3&lt;/span>&lt;span> &lt;span style="color:#ff79c6">while&lt;/span> (&lt;span style="color:#ff79c6">!&lt;/span>eventLoop&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>stop) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4&lt;/span>&lt;span> &lt;span style="color:#50fa7b">aeProcessEvents&lt;/span>(eventLoop, AE_ALL_EVENTS&lt;span style="color:#ff79c6">|&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5&lt;/span>&lt;span> AE_CALL_BEFORE_SLEEP&lt;span style="color:#ff79c6">|&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6&lt;/span>&lt;span> AE_CALL_AFTER_SLEEP);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;a class="link" href="https://github.com/redis/redis/blob/d2c8a4b91e8c0e6aefd1f5bc0bf582cddbe046b7/src/ae.c#L361" target="_blank" rel="noopener"
>aeProcessEvents&lt;/a> ä¸­å¤„ç†ä¹‹å‰ æ·»åŠ çš„ &lt;code>aeEvent&lt;/code> äº‹ä»¶å›è°ƒ&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#8be9fd">int&lt;/span> &lt;span style="color:#50fa7b">aeProcessEvents&lt;/span>(aeEventLoop &lt;span style="color:#ff79c6">*&lt;/span>eventLoop, &lt;span style="color:#8be9fd">int&lt;/span> flags)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span> &lt;span style="color:#8be9fd">int&lt;/span> processed &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>, numevents;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span> &lt;span style="color:#6272a4">/* Nothing to do? return ASAP */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (&lt;span style="color:#ff79c6">!&lt;/span>(flags &lt;span style="color:#ff79c6">&amp;amp;&lt;/span> AE_TIME_EVENTS) &lt;span style="color:#ff79c6">&amp;amp;&amp;amp;&lt;/span> &lt;span style="color:#ff79c6">!&lt;/span>(flags &lt;span style="color:#ff79c6">&amp;amp;&lt;/span> AE_FILE_EVENTS)) &lt;span style="color:#ff79c6">return&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (eventLoop&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>maxfd &lt;span style="color:#ff79c6">!=&lt;/span> &lt;span style="color:#ff79c6">-&lt;/span>&lt;span style="color:#bd93f9">1&lt;/span> &lt;span style="color:#ff79c6">||&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span> ((flags &lt;span style="color:#ff79c6">&amp;amp;&lt;/span> AE_TIME_EVENTS) &lt;span style="color:#ff79c6">&amp;amp;&amp;amp;&lt;/span> &lt;span style="color:#ff79c6">!&lt;/span>(flags &lt;span style="color:#ff79c6">&amp;amp;&lt;/span> AE_DONT_WAIT))) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span> &lt;span style="color:#8be9fd">int&lt;/span> j;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span> &lt;span style="color:#ff79c6">struct&lt;/span> timeval tv, &lt;span style="color:#ff79c6">*&lt;/span>tvp &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">NULL&lt;/span>; &lt;span style="color:#6272a4">/* NULL means infinite wait. */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span> &lt;span style="color:#8be9fd">int64_t&lt;/span> usUntilTimer;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span> &lt;span style="color:#6272a4">//æ£€æŸ¥beforesleepå‡½æ•°æŒ‡é’ˆ,å¦‚æœæœ‰å¯¹åº”çš„å‡½æ•°,è°ƒç”¨è¿™ä¸ªå‡½æ•°
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">if&lt;/span> (eventLoop&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>beforesleep &lt;span style="color:#ff79c6">!=&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">NULL&lt;/span> &lt;span style="color:#ff79c6">&amp;amp;&amp;amp;&lt;/span> (flags &lt;span style="color:#ff79c6">&amp;amp;&lt;/span> AE_CALL_BEFORE_SLEEP))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15&lt;/span>&lt;span> eventLoop&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>&lt;span style="color:#50fa7b">beforesleep&lt;/span>(eventLoop);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> ((flags &lt;span style="color:#ff79c6">&amp;amp;&lt;/span> AE_DONT_WAIT) &lt;span style="color:#ff79c6">||&lt;/span> (eventLoop&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>flags &lt;span style="color:#ff79c6">&amp;amp;&lt;/span> AE_DONT_WAIT)) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18&lt;/span>&lt;span> tv.tv_sec &lt;span style="color:#ff79c6">=&lt;/span> tv.tv_usec &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19&lt;/span>&lt;span> tvp &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#ff79c6">&amp;amp;&lt;/span>tv;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20&lt;/span>&lt;span> } &lt;span style="color:#ff79c6">else&lt;/span> &lt;span style="color:#ff79c6">if&lt;/span> (flags &lt;span style="color:#ff79c6">&amp;amp;&lt;/span> AE_TIME_EVENTS) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21&lt;/span>&lt;span> usUntilTimer &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#50fa7b">usUntilEarliestTimer&lt;/span>(eventLoop);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (usUntilTimer &lt;span style="color:#ff79c6">&amp;gt;=&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23&lt;/span>&lt;span> tv.tv_sec &lt;span style="color:#ff79c6">=&lt;/span> usUntilTimer &lt;span style="color:#ff79c6">/&lt;/span> &lt;span style="color:#bd93f9">1000000&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24&lt;/span>&lt;span> tv.tv_usec &lt;span style="color:#ff79c6">=&lt;/span> usUntilTimer &lt;span style="color:#ff79c6">%&lt;/span> &lt;span style="color:#bd93f9">1000000&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25&lt;/span>&lt;span> tvp &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#ff79c6">&amp;amp;&lt;/span>tv;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29&lt;/span>&lt;span> numevents &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#50fa7b">aeApiPoll&lt;/span>(eventLoop, tvp);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31&lt;/span>&lt;span> &lt;span style="color:#6272a4">/* Don&amp;#39;t process file events if not requested. */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (&lt;span style="color:#ff79c6">!&lt;/span>(flags &lt;span style="color:#ff79c6">&amp;amp;&lt;/span> AE_FILE_EVENTS)) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33&lt;/span>&lt;span> numevents &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36&lt;/span>&lt;span> &lt;span style="color:#6272a4">//æ£€æŸ¥aftersleepå‡½æ•°æŒ‡é’ˆ,å¦‚æœæœ‰å¯¹åº”çš„å‡½æ•°,è°ƒç”¨è¿™ä¸ªå‡½æ•°
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">if&lt;/span> (eventLoop&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>aftersleep &lt;span style="color:#ff79c6">!=&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">NULL&lt;/span> &lt;span style="color:#ff79c6">&amp;amp;&amp;amp;&lt;/span> flags &lt;span style="color:#ff79c6">&amp;amp;&lt;/span> AE_CALL_AFTER_SLEEP)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38&lt;/span>&lt;span> eventLoop&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>&lt;span style="color:#50fa7b">aftersleep&lt;/span>(eventLoop);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39&lt;/span>&lt;span> &lt;span style="color:#6272a4">//æ£€æŸ¥å°±ç»ªçš„äº‹ä»¶,ç„¶ååšå¯¹åº”çš„å¤„ç†
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">for&lt;/span> (j &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>; j &lt;span style="color:#ff79c6">&amp;lt;&lt;/span> numevents; j&lt;span style="color:#ff79c6">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41&lt;/span>&lt;span> &lt;span style="color:#8be9fd">int&lt;/span> fd &lt;span style="color:#ff79c6">=&lt;/span> eventLoop&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>fired[j].fd;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42&lt;/span>&lt;span> aeFileEvent &lt;span style="color:#ff79c6">*&lt;/span>fe &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#ff79c6">&amp;amp;&lt;/span>eventLoop&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>events[fd];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43&lt;/span>&lt;span> &lt;span style="color:#8be9fd">int&lt;/span> mask &lt;span style="color:#ff79c6">=&lt;/span> eventLoop&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>fired[j].mask;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44&lt;/span>&lt;span> &lt;span style="color:#8be9fd">int&lt;/span> fired &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>; &lt;span style="color:#6272a4">/* Number of events fired for current fd. */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46&lt;/span>&lt;span> &lt;span style="color:#8be9fd">int&lt;/span> invert &lt;span style="color:#ff79c6">=&lt;/span> fe&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>mask &lt;span style="color:#ff79c6">&amp;amp;&lt;/span> AE_BARRIER;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47&lt;/span>&lt;span> &lt;span style="color:#6272a4">//éœ€è¦ç¿»è½¬çš„è¯,å…ˆå¤„ç†è¯»çš„å›è°ƒå‡½æ•°
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">if&lt;/span> (&lt;span style="color:#ff79c6">!&lt;/span>invert &lt;span style="color:#ff79c6">&amp;amp;&amp;amp;&lt;/span> fe&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>mask &lt;span style="color:#ff79c6">&amp;amp;&lt;/span> mask &lt;span style="color:#ff79c6">&amp;amp;&lt;/span> AE_READABLE) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49&lt;/span>&lt;span> fe&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>&lt;span style="color:#50fa7b">rfileProc&lt;/span>(eventLoop,fd,fe&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>clientData,mask);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50&lt;/span>&lt;span> fired&lt;span style="color:#ff79c6">++&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">51&lt;/span>&lt;span> fe &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#ff79c6">&amp;amp;&lt;/span>eventLoop&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>events[fd]; &lt;span style="color:#6272a4">/* Refresh in case of resize. */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">52&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">53&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">54&lt;/span>&lt;span> &lt;span style="color:#6272a4">//å¦‚æœæœ‰å†™äº‹ä»¶,åšå›è°ƒ
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">55&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">if&lt;/span> (fe&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>mask &lt;span style="color:#ff79c6">&amp;amp;&lt;/span> mask &lt;span style="color:#ff79c6">&amp;amp;&lt;/span> AE_WRITABLE) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">56&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (&lt;span style="color:#ff79c6">!&lt;/span>fired &lt;span style="color:#ff79c6">||&lt;/span> fe&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>wfileProc &lt;span style="color:#ff79c6">!=&lt;/span> fe&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>rfileProc) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">57&lt;/span>&lt;span> fe&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>&lt;span style="color:#50fa7b">wfileProc&lt;/span>(eventLoop,fd,fe&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>clientData,mask);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">58&lt;/span>&lt;span> fired&lt;span style="color:#ff79c6">++&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">59&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">60&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">61&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">62&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (invert) {&lt;span style="color:#6272a4">//å¦‚æœä¹‹å‰æ²¡æœ‰å¤„ç†è¯»äº‹ä»¶
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">63&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> fe &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#ff79c6">&amp;amp;&lt;/span>eventLoop&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>events[fd]; &lt;span style="color:#6272a4">/* Refresh in case of resize. */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">64&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> ((fe&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>mask &lt;span style="color:#ff79c6">&amp;amp;&lt;/span> mask &lt;span style="color:#ff79c6">&amp;amp;&lt;/span> AE_READABLE) &lt;span style="color:#ff79c6">&amp;amp;&amp;amp;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">65&lt;/span>&lt;span> (&lt;span style="color:#ff79c6">!&lt;/span>fired &lt;span style="color:#ff79c6">||&lt;/span> fe&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>wfileProc &lt;span style="color:#ff79c6">!=&lt;/span> fe&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>rfileProc))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">66&lt;/span>&lt;span> {&lt;span style="color:#6272a4">//è¯»å›è°ƒå‡½æ•°æŒ‡é’ˆå’Œå†™å›è°ƒå‡½æ•°æŒ‡é’ˆä¸æ˜¯åŒä¸€ä¸ª, å¹¶ä¸”æœ‰è¯»äº‹ä»¶,å›è°ƒè¯»å‡½æ•°
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">67&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> fe&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>&lt;span style="color:#50fa7b">rfileProc&lt;/span>(eventLoop,fd,fe&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>clientData,mask);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">68&lt;/span>&lt;span> fired&lt;span style="color:#ff79c6">++&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">69&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">70&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">71&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">72&lt;/span>&lt;span> processed&lt;span style="color:#ff79c6">++&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">73&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">74&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">75&lt;/span>&lt;span> &lt;span style="color:#6272a4">//å¦‚æœæœ‰æ—¶é—´å›è°ƒäº‹ä»¶,å›è°ƒæ—¶é—´çš„å›è°ƒå‡½æ•°
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">76&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">if&lt;/span> (flags &lt;span style="color:#ff79c6">&amp;amp;&lt;/span> AE_TIME_EVENTS)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">77&lt;/span>&lt;span> processed &lt;span style="color:#ff79c6">+=&lt;/span> &lt;span style="color:#50fa7b">processTimeEvents&lt;/span>(eventLoop);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">78&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">79&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> processed; &lt;span style="color:#6272a4">/* return the number of processed file/time events */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">80&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;a class="link" href="https://github.com/redis/redis/blob/d2c8a4b91e8c0e6aefd1f5bc0bf582cddbe046b7/src/server.c#L1625" target="_blank" rel="noopener"
>beforeSleep&lt;/a> å‡½æ•°&lt;/p>
&lt;p>&lt;a class="link" href="https://github.com/redis/redis/blob/d2c8a4b91e8c0e6aefd1f5bc0bf582cddbe046b7/src/server.c#L1785" target="_blank" rel="noopener"
>afterSleep&lt;/a> å‡½æ•°&lt;/p>
&lt;p>è¿™ä¸¤ä¸ªå‡½æ•°å†…å®¹éå¸¸å¤šï¼Œå¾ˆå¤šå’Œç½‘ç»œæ˜¯æ— å…³çš„ï¼Œä¸å±•å¼€åˆ†æï¼Œåé¢æœ‰ç”¨çš„å†å›æ¥ä»‹ç»ã€‚&lt;/p>
&lt;p>&lt;code>aeApiPoll&lt;/code> å‡½æ•°åœ¨ä¸åŒçš„å¹³å°ä¸Šæœ‰ä¸åŒçš„å®ç°ï¼Œæœ€ç»ˆçš„ç›®çš„æ˜¯ç­‰å¾…ç³»ç»Ÿçš„å›è°ƒäº‹ä»¶ã€‚åœ¨ &lt;code>epoll&lt;/code> ä¸­æ˜¯ç­‰å¾… &lt;code>epoll_wait&lt;/code> çš„å›è°ƒã€‚&lt;/p>
&lt;p>&lt;strong>ç®€å•ç”»å›¾ç†è§£ä¸€ä¸‹&lt;/strong>&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/60eec42ff66692c81aa7419d8c60c3755d5e5aac.png">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/60eec42ff66692c81aa7419d8c60c3755d5e5aac.png" alt="" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>å¦‚å›¾æ‰€ç¤ºï¼Œredisè™½ç„¶å¼€å¯äº†å¤šçº¿ç¨‹ï¼Œä½†æ˜¯æ¯ä¸ªè¿æ¥è¿˜æ˜¯åœ¨ä¸»çº¿ç¨‹ä¸­ï¼Œè€Œä¸”å¤„ç†å‘½ä»¤ä¹Ÿæ˜¯åœ¨ä¸»çº¿ç¨‹ä¸­ã€‚&lt;/p>
&lt;p>é‚£ä¹ˆåœ¨ä»€ä¹ˆæ—¶å€™ç”¨åˆ°å¤šçº¿ç¨‹ï¼Œä»¥åŠæ€æ ·ä½¿ç”¨å‘¢ã€‚&lt;/p>
&lt;p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­ä¹Ÿæåˆ°äº†ï¼Œå°±æ˜¯åœ¨ç½‘ç»œIOä¸­ä¼šç”¨åˆ°å¤šçº¿ç¨‹ã€‚&lt;/p>
&lt;p>å¦‚å›¾ï¼š&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/ad28de7d73bbe7148e4bb0f70908e49d1ed38c1f.png">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/ad28de7d73bbe7148e4bb0f70908e49d1ed38c1f.png" alt="" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>æ‹¿ä»ç½‘ç»œä¸­è¯»å–æ•°æ®æ¥ä¸¾ä¾‹ï¼Œå½“å›¾ä¸­çš„ &lt;strong>client1&lt;/strong> &lt;strong>client2&lt;/strong> &lt;strong>client3&lt;/strong> åŒæ—¶æœ‰æ•°æ®éœ€è¦è¯»å–çš„æ—¶å€™ï¼Œè¿™æ—¶å€™ä¼šæŠŠè¿™ä¸‰ä¸ª clientçš„ &lt;strong>fd&lt;/strong> åˆ†é…åˆ°ç©ºé—²çš„çº¿ç¨‹ä¸­ï¼Œç”±ä¸åŒçš„çº¿ç¨‹æ¥è¯»å–æ•°æ®ï¼ŒæŠŠè¯»åˆ°çš„æ•°æ®å†™å…¥ client çš„ buffä¸­ã€‚å½“æ‰€æœ‰çš„ &lt;strong>fd&lt;/strong> è¯»å–å®Œæˆåï¼Œ ç„¶ååœ¨çº¿ç¨‹ä¸­ï¼Œä¾æ¬¡å¤„ç†æ¯ä¸ªclientã€‚å…·ä½“ä»£ç åœ¨ä¸‹æ–‡ä¸­ã€‚&lt;/p>
&lt;h2 id="ç½‘ç»œè¯»å†™å¤„ç†">&lt;a href="#%e7%bd%91%e7%bb%9c%e8%af%bb%e5%86%99%e5%a4%84%e7%90%86" class="header-anchor">&lt;/a>ç½‘ç»œè¯»å†™å¤„ç†
&lt;/h2>&lt;h3 id="listener-å›è°ƒ">&lt;a href="#listener-%e5%9b%9e%e8%b0%83" class="header-anchor">&lt;/a>Listener å›è°ƒ
&lt;/h3>&lt;p>ä¹‹å‰åœ¨æ·»åŠ  &lt;code>listener&lt;/code> çš„æ—¶å€™ï¼Œæ·»åŠ çš„æ˜¯ &lt;code>AE_READABLE&lt;/code> äº‹ä»¶ï¼Œ &lt;code>aeCreateFileEvent(server.el, sfd-&amp;gt;fd[j], AE_READABLE, accept_handler,sfd)&lt;/code>&lt;/p>
&lt;p>æ‰€ä»¥ï¼Œaccept çš„å›è°ƒä¼šåœ¨ å¯è¯»çš„å›è°ƒå‡½æ•°ä¸­ã€‚&lt;/p>
&lt;p>&lt;code>accept_handler&lt;/code>æŒ‡é’ˆæ˜¯ &lt;a class="link" href="https://github.com/redis/redis/blob/d2c8a4b91e8c0e6aefd1f5bc0bf582cddbe046b7/src/socket.c#L311-L312" target="_blank" rel="noopener"
>connSocketAcceptHandler&lt;/a> å‡½æ•°&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">static&lt;/span> &lt;span style="color:#8be9fd">void&lt;/span> &lt;span style="color:#50fa7b">connSocketAcceptHandler&lt;/span>(aeEventLoop &lt;span style="color:#ff79c6">*&lt;/span>el, &lt;span style="color:#8be9fd">int&lt;/span> fd, &lt;span style="color:#8be9fd">void&lt;/span> &lt;span style="color:#ff79c6">*&lt;/span>privdata, &lt;span style="color:#8be9fd">int&lt;/span> mask) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span> &lt;span style="color:#8be9fd">int&lt;/span> cport, cfd, max &lt;span style="color:#ff79c6">=&lt;/span> MAX_ACCEPTS_PER_CALL;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span> &lt;span style="color:#8be9fd">char&lt;/span> cip[NET_IP_STR_LEN];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span> &lt;span style="color:#50fa7b">UNUSED&lt;/span>(el);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span> &lt;span style="color:#50fa7b">UNUSED&lt;/span>(mask);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span> &lt;span style="color:#50fa7b">UNUSED&lt;/span>(privdata);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span> &lt;span style="color:#ff79c6">while&lt;/span>(max&lt;span style="color:#ff79c6">--&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span> &lt;span style="color:#6272a4">//æŠŠå½“å‰çš„ accept çš„ fd è½¬æ¢æˆä¸€ä¸ªTCPè¿æ¥
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> cfd &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#50fa7b">anetTcpAccept&lt;/span>(server.neterr, fd, cip, &lt;span style="color:#ff79c6">sizeof&lt;/span>(cip), &lt;span style="color:#ff79c6">&amp;amp;&lt;/span>cport);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (cfd &lt;span style="color:#ff79c6">==&lt;/span> ANET_ERR) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (errno &lt;span style="color:#ff79c6">!=&lt;/span> EWOULDBLOCK)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span> &lt;span style="color:#50fa7b">serverLog&lt;/span>(LL_WARNING,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span> &lt;span style="color:#f1fa8c">&amp;#34;Accepting client connection: %s&amp;#34;&lt;/span>, server.neterr);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17&lt;/span>&lt;span> &lt;span style="color:#50fa7b">serverLog&lt;/span>(LL_VERBOSE,&lt;span style="color:#f1fa8c">&amp;#34;Accepted %s:%d&amp;#34;&lt;/span>, cip, cport);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18&lt;/span>&lt;span> &lt;span style="color:#50fa7b">acceptCommonHandler&lt;/span>(&lt;span style="color:#50fa7b">connCreateAcceptedSocket&lt;/span>(cfd, &lt;span style="color:#8be9fd;font-style:italic">NULL&lt;/span>),&lt;span style="color:#bd93f9">0&lt;/span>,cip);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>åœ¨ &lt;code>anetTcpAccept&lt;/code> ä¸­ è°ƒç”¨ &lt;a class="link" href="https://github.com/redis/redis/blob/d2c8a4b91e8c0e6aefd1f5bc0bf582cddbe046b7/src/anet.c#L521" target="_blank" rel="noopener"
>anetGenericAccept&lt;/a> å‡½æ•°ï¼Œ åœ¨å‡½æ•°ä¸­&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">#ifdef HAVE_ACCEPT4
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span>&lt;span style="color:#ff79c6">&lt;/span> fd &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#50fa7b">accept4&lt;/span>(s, sa, len, SOCK_NONBLOCK &lt;span style="color:#ff79c6">|&lt;/span> SOCK_CLOEXEC);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3&lt;/span>&lt;span>&lt;span style="color:#ff79c6">#else
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4&lt;/span>&lt;span>&lt;span style="color:#ff79c6">&lt;/span> fd &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#50fa7b">accept&lt;/span>(s,sa,len);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5&lt;/span>&lt;span>&lt;span style="color:#ff79c6">#endif
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æœ€ç»ˆé€šè¿‡ &lt;code>accept4&lt;/code> æˆ–è€… &lt;code>accept&lt;/code> ç³»ç»Ÿè°ƒç”¨ï¼Œæ¥å—ä¸€ä¸ªæ–°çš„TCPé“¾æ¥ã€‚&lt;/p>
&lt;p>æœ€åè°ƒç”¨ &lt;code>acceptCommonHandler&lt;/code> å‡½æ•°, è¿™ä¸ªå‡½æ•°é‡Œä¼šè°ƒç”¨ &lt;a class="link" href="https://github.com/redis/redis/blob/d2c8a4b91e8c0e6aefd1f5bc0bf582cddbe046b7/src/networking.c#L1342" target="_blank" rel="noopener"
>createClient(conn)&lt;/a> æ¥åˆ›å»ºä¸€ä¸ª &lt;strong>client&lt;/strong>&lt;/p>
&lt;p>åœ¨ &lt;code>createClient&lt;/code> ä¸­ï¼Œå…³æ³¨è¿™æ®µå‡½æ•°&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span> client &lt;span style="color:#ff79c6">*&lt;/span>c &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#50fa7b">zmalloc&lt;/span>(&lt;span style="color:#ff79c6">sizeof&lt;/span>(client));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (conn) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span> &lt;span style="color:#50fa7b">connEnableTcpNoDelay&lt;/span>(conn);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (server.tcpkeepalive)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span> &lt;span style="color:#50fa7b">connKeepAlive&lt;/span>(conn,server.tcpkeepalive);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span> &lt;span style="color:#6272a4">//æŠŠå½“å‰çš„connåŠ å…¥åˆ° eventPoolä¸­,å¹¶ä¸”æŠŠ readQueryFromClient è®¾ç½®ä¸ºå›è°ƒå‡½æ•°
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#50fa7b">connSetReadHandler&lt;/span>(conn, readQueryFromClient);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span> &lt;span style="color:#50fa7b">connSetPrivateData&lt;/span>(conn, c);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span> &lt;span style="color:#6272a4">//åˆå§‹åŒ–clientçš„buffer
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> c&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>buf &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#50fa7b">zmalloc_usable&lt;/span>(PROTO_REPLY_CHUNK_BYTES, &lt;span style="color:#ff79c6">&amp;amp;&lt;/span>c&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>buf_usable_size);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span> &lt;span style="color:#50fa7b">selectDb&lt;/span>(c,&lt;span style="color:#bd93f9">0&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span> &lt;span style="color:#8be9fd">uint64_t&lt;/span> client_id;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>connEnableTcpNoDelay&lt;/code> æœ€ç»ˆä¼šè°ƒç”¨ &lt;code>anet.cä¸­çš„&lt;/code> &lt;a class="link" href="https://github.com/redis/redis/blob/d2c8a4b91e8c0e6aefd1f5bc0bf582cddbe046b7/src/anet.c#L191" target="_blank" rel="noopener"
>anetSetTcpNoDelay&lt;/a> å‡½æ•°ï¼Œæ¥å®Œæˆå¯¹TCPè¿æ¥çš„è®¾ç½®ã€‚&lt;/p>
&lt;p>&lt;code>connKeepAlive&lt;/code> æœ€ç»ˆè°ƒç”¨åˆ° &lt;code>anet.cä¸­çš„&lt;/code> &lt;a class="link" href="https://github.com/redis/redis/blob/d2c8a4b91e8c0e6aefd1f5bc0bf582cddbe046b7/src/anet.c#L136" target="_blank" rel="noopener"
>anetKeepAlive&lt;/a> å¯¹ &lt;strong>KeepAlive&lt;/strong> çš„è®¾ç½®&lt;/p>
&lt;p>&lt;code>connSetReadHandler&lt;/code> é€šè¿‡è¿™ä¸ªå‡½æ•°ï¼Œå®ŒæˆæŠŠ è¯¥TCPè¿æ¥çš„ &lt;strong>fd&lt;/strong> åŠ å…¥çš„ &lt;code>eventLoop&lt;/code> ä¸­è¿›è¡Œç®¡ç†ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">static&lt;/span> &lt;span style="color:#ff79c6">inline&lt;/span> &lt;span style="color:#8be9fd">int&lt;/span> &lt;span style="color:#50fa7b">connSetReadHandler&lt;/span>(connection &lt;span style="color:#ff79c6">*&lt;/span>conn, ConnectionCallbackFunc func) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> conn&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>type&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>&lt;span style="color:#50fa7b">set_read_handler&lt;/span>(conn, func);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>é€šè¿‡ &lt;code>set_read_handler&lt;/code> è¿™ä¸ªå‡½æ•°æŒ‡é’ˆè°ƒç”¨åˆ° &lt;code>socket.c&lt;/code> ä¸­çš„ &lt;a class="link" href="https://github.com/redis/redis/blob/d2c8a4b91e8c0e6aefd1f5bc0bf582cddbe046b7/src/socket.c#L241" target="_blank" rel="noopener"
>connSocketSetReadHandler&lt;/a> å‡½æ•°&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">static&lt;/span> &lt;span style="color:#8be9fd">int&lt;/span> &lt;span style="color:#50fa7b">connSocketSetReadHandler&lt;/span>(connection &lt;span style="color:#ff79c6">*&lt;/span>conn, ConnectionCallbackFunc func) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (func &lt;span style="color:#ff79c6">==&lt;/span> conn&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>read_handler) &lt;span style="color:#ff79c6">return&lt;/span> C_OK;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span> conn&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>read_handler &lt;span style="color:#ff79c6">=&lt;/span> func;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (&lt;span style="color:#ff79c6">!&lt;/span>conn&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>read_handler)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span> &lt;span style="color:#50fa7b">aeDeleteFileEvent&lt;/span>(server.el,conn&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>fd,AE_READABLE);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span> &lt;span style="color:#ff79c6">else&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (&lt;span style="color:#50fa7b">aeCreateFileEvent&lt;/span>(server.el,conn&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>fd,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span> AE_READABLE,conn&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>type&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>ae_handler,conn) &lt;span style="color:#ff79c6">==&lt;/span> AE_ERR) &lt;span style="color:#ff79c6">return&lt;/span> C_ERR;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> C_OK;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è°ƒç”¨ &lt;code>aeCreateFileEvent&lt;/code> æŠŠå½“å‰çš„ &lt;code>conn&lt;/code> åŠ å…¥åˆ° &lt;code>server.el&lt;/code> ä¹Ÿå°±æ˜¯å¯åŠ¨redisæ—¶ï¼Œåˆ›å»ºçš„ &lt;code>aeEventPool&lt;/code> ä¸­ã€‚&lt;/p>
&lt;p>å›åˆ° &lt;code>createClient&lt;/code> å‡½æ•°ä¸­ï¼Œ&lt;code>connSetReadHandler(conn, readQueryFromClient);&lt;/code> ç¬¬äºŒå‚æ•°ä¼ é€’çš„æ˜¯ &lt;a class="link" href="https://github.com/redis/redis/blob/d2c8a4b91e8c0e6aefd1f5bc0bf582cddbe046b7/src/networking.c#L2616" target="_blank" rel="noopener"
>readQueryFromClient&lt;/a> è¿™ä¸ªå‡½æ•°çš„æŒ‡é’ˆã€‚è¿™ä¸ªå‡½æ•° ä¼šèµ‹å€¼ç»™ &lt;code>aeFileEvent&lt;/code> çš„ &lt;code>rfileProc&lt;/code> å‡½æ•°æŒ‡é’ˆä¸­ã€‚åç»­ï¼Œå¦‚æœè¿™ä¸ª &lt;code>conn&lt;/code> æœ‰å¯è¯»äº‹ä»¶å›è°ƒæ—¶ï¼Œä¼šä½¿ç”¨ &lt;code>readQueryFromClient&lt;/code> è¿™ä¸ªå‡½æ•°æ¥å¤„ç†ã€‚&lt;/p>
&lt;p>åˆ°è¿™é‡Œï¼Œä¸€ä¸ªæ–°TCPè¿æ¥çš„å¤„ç†åŸºæœ¬å°±å®Œæˆäº†ã€‚&lt;/p>
&lt;h2 id="å¤„ç†clientè¯»å†™">&lt;a href="#%e5%a4%84%e7%90%86client%e8%af%bb%e5%86%99" class="header-anchor">&lt;/a>å¤„ç†clientè¯»å†™
&lt;/h2>&lt;h3 id="è¯»å¤„ç†">&lt;a href="#%e8%af%bb%e5%a4%84%e7%90%86" class="header-anchor">&lt;/a>è¯»å¤„ç†
&lt;/h3>&lt;p>å½“redis-server æ”¶åˆ°clientå‘æ¥çš„æ•°æ®åï¼Œä¹Ÿæ˜¯é€šè¿‡ &lt;code>aeEventPool&lt;/code> æ¥å›è°ƒé€šçŸ¥å¯¹åº”çš„ clientæ¥å¤„ç†ã€‚&lt;/p>
&lt;p>ä¸Šé¢æˆ‘ä»¬è¯´è¿‡äº†ï¼Œclientæ”¶åˆ°è¯»äº‹ä»¶çš„å›è°ƒå‡½æ•°æ˜¯ &lt;code>readQueryFromClient&lt;/code>ï¼Œå½“clientå¯¹åº”çš„ç½‘ç»œæœ‰å¯è¯»äº‹ä»¶è§¦å‘æ—¶ï¼Œä¼šå›è°ƒè¿™ä¸ªå‡½æ•°ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#8be9fd">void&lt;/span> &lt;span style="color:#50fa7b">readQueryFromClient&lt;/span>(connection &lt;span style="color:#ff79c6">*&lt;/span>conn) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span> client &lt;span style="color:#ff79c6">*&lt;/span>c &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#50fa7b">connGetPrivateData&lt;/span>(conn);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span> &lt;span style="color:#8be9fd">int&lt;/span> nread, big_arg &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span> &lt;span style="color:#8be9fd">size_t&lt;/span> qblen, readlen;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span> &lt;span style="color:#6272a4">//åˆ¤æ–­ä¸€ä¸‹,æ˜¯å¦å¼€å¯äº†IOçº¿ç¨‹,å¦‚æœå¼€å¯äº†é‚£ä¹ˆä¼šä»IOçº¿ç¨‹è¯»å–æ•°æ®
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">if&lt;/span> (&lt;span style="color:#50fa7b">postponeClientRead&lt;/span>(c)) &lt;span style="color:#ff79c6">return&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span> &lt;span style="color:#6272a4">//è¯»å–æ¬¡æ•° åŸå­æ€§çš„ +1
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#50fa7b">atomicIncr&lt;/span>(server.stat_total_reads_processed, &lt;span style="color:#bd93f9">1&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span> readlen &lt;span style="color:#ff79c6">=&lt;/span> PROTO_IOBUF_LEN;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span> &lt;span style="color:#6272a4">//å¦‚æœæ˜¯ä¸€ä¸ªmultiè¯·æ±‚,é‚£ä¹ˆè°ƒæ•´ä¸€ä¸‹ç¼“å†²åŒºçš„å¤§å°
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">if&lt;/span> (c&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>reqtype &lt;span style="color:#ff79c6">==&lt;/span> PROTO_REQ_MULTIBULK &lt;span style="color:#ff79c6">&amp;amp;&amp;amp;&lt;/span> c&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>multibulklen &lt;span style="color:#ff79c6">&amp;amp;&amp;amp;&lt;/span> c&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>bulklen &lt;span style="color:#ff79c6">!=&lt;/span> &lt;span style="color:#ff79c6">-&lt;/span>&lt;span style="color:#bd93f9">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span> &lt;span style="color:#ff79c6">&amp;amp;&amp;amp;&lt;/span> c&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>bulklen &lt;span style="color:#ff79c6">&amp;gt;=&lt;/span> PROTO_MBULK_BIG_ARG)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15&lt;/span>&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16&lt;/span>&lt;span> &lt;span style="color:#8be9fd">ssize_t&lt;/span> remaining &lt;span style="color:#ff79c6">=&lt;/span> (&lt;span style="color:#8be9fd">size_t&lt;/span>)(c&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>bulklen&lt;span style="color:#ff79c6">+&lt;/span>&lt;span style="color:#bd93f9">2&lt;/span>)&lt;span style="color:#ff79c6">-&lt;/span>(&lt;span style="color:#50fa7b">sdslen&lt;/span>(c&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>querybuf)&lt;span style="color:#ff79c6">-&lt;/span>c&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>qb_pos);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17&lt;/span>&lt;span> big_arg &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#bd93f9">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (remaining &lt;span style="color:#ff79c6">&amp;gt;&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>) readlen &lt;span style="color:#ff79c6">=&lt;/span> remaining;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (c&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>flags &lt;span style="color:#ff79c6">&amp;amp;&lt;/span> CLIENT_MASTER &lt;span style="color:#ff79c6">&amp;amp;&amp;amp;&lt;/span> readlen &lt;span style="color:#ff79c6">&amp;lt;&lt;/span> PROTO_IOBUF_LEN)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22&lt;/span>&lt;span> readlen &lt;span style="color:#ff79c6">=&lt;/span> PROTO_IOBUF_LEN;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25&lt;/span>&lt;span> qblen &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#50fa7b">sdslen&lt;/span>(c&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>querybuf);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (&lt;span style="color:#ff79c6">!&lt;/span>(c&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>flags &lt;span style="color:#ff79c6">&amp;amp;&lt;/span> CLIENT_MASTER) &lt;span style="color:#ff79c6">&amp;amp;&amp;amp;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27&lt;/span>&lt;span> (big_arg &lt;span style="color:#ff79c6">||&lt;/span> &lt;span style="color:#50fa7b">sdsalloc&lt;/span>(c&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>querybuf) &lt;span style="color:#ff79c6">&amp;lt;&lt;/span> PROTO_IOBUF_LEN)) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28&lt;/span>&lt;span> c&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>querybuf &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#50fa7b">sdsMakeRoomForNonGreedy&lt;/span>(c&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>querybuf, readlen);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (c&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>querybuf_peak &lt;span style="color:#ff79c6">&amp;lt;&lt;/span> qblen &lt;span style="color:#ff79c6">+&lt;/span> readlen) c&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>querybuf_peak &lt;span style="color:#ff79c6">=&lt;/span> qblen &lt;span style="color:#ff79c6">+&lt;/span> readlen;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30&lt;/span>&lt;span> } &lt;span style="color:#ff79c6">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31&lt;/span>&lt;span> c&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>querybuf &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#50fa7b">sdsMakeRoomFor&lt;/span>(c&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>querybuf, readlen);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33&lt;/span>&lt;span> readlen &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#50fa7b">sdsavail&lt;/span>(c&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>querybuf);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36&lt;/span>&lt;span> &lt;span style="color:#6272a4">//ä»ç½‘ç»œä¸­è¯»å–æ•°æ®,å¦‚æœæ˜¯ socket,ä½¿ç”¨ connSocketRead å‡½æ•°
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> nread &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#50fa7b">connRead&lt;/span>(c&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>conn, c&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>querybuf&lt;span style="color:#ff79c6">+&lt;/span>qblen, readlen);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (nread &lt;span style="color:#ff79c6">==&lt;/span> &lt;span style="color:#ff79c6">-&lt;/span>&lt;span style="color:#bd93f9">1&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (&lt;span style="color:#50fa7b">connGetState&lt;/span>(conn) &lt;span style="color:#ff79c6">==&lt;/span> CONN_STATE_CONNECTED) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41&lt;/span>&lt;span> } &lt;span style="color:#ff79c6">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42&lt;/span>&lt;span> &lt;span style="color:#50fa7b">serverLog&lt;/span>(LL_VERBOSE, &lt;span style="color:#f1fa8c">&amp;#34;Reading from client: %s&amp;#34;&lt;/span>,&lt;span style="color:#50fa7b">connGetLastError&lt;/span>(c&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>conn));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43&lt;/span>&lt;span> &lt;span style="color:#50fa7b">freeClientAsync&lt;/span>(c);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44&lt;/span>&lt;span> &lt;span style="color:#ff79c6">goto&lt;/span> done;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46&lt;/span>&lt;span> } &lt;span style="color:#ff79c6">else&lt;/span> &lt;span style="color:#ff79c6">if&lt;/span> (nread &lt;span style="color:#ff79c6">==&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (server.verbosity &lt;span style="color:#ff79c6">&amp;lt;=&lt;/span> LL_VERBOSE) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48&lt;/span>&lt;span> sds info &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#50fa7b">catClientInfoString&lt;/span>(&lt;span style="color:#50fa7b">sdsempty&lt;/span>(), c);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49&lt;/span>&lt;span> &lt;span style="color:#50fa7b">serverLog&lt;/span>(LL_VERBOSE, &lt;span style="color:#f1fa8c">&amp;#34;Client closed connection %s&amp;#34;&lt;/span>, info);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50&lt;/span>&lt;span> &lt;span style="color:#50fa7b">sdsfree&lt;/span>(info);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">51&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">52&lt;/span>&lt;span> &lt;span style="color:#50fa7b">freeClientAsync&lt;/span>(c);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">53&lt;/span>&lt;span> &lt;span style="color:#ff79c6">goto&lt;/span> done;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">54&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">55&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">56&lt;/span>&lt;span> &lt;span style="color:#50fa7b">sdsIncrLen&lt;/span>(c&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>querybuf,nread);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">57&lt;/span>&lt;span> qblen &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#50fa7b">sdslen&lt;/span>(c&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>querybuf);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">58&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (c&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>querybuf_peak &lt;span style="color:#ff79c6">&amp;lt;&lt;/span> qblen) c&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>querybuf_peak &lt;span style="color:#ff79c6">=&lt;/span> qblen;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">59&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">60&lt;/span>&lt;span> c&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>lastinteraction &lt;span style="color:#ff79c6">=&lt;/span> server.unixtime;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">61&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (c&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>flags &lt;span style="color:#ff79c6">&amp;amp;&lt;/span> CLIENT_MASTER) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">62&lt;/span>&lt;span> c&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>read_reploff &lt;span style="color:#ff79c6">+=&lt;/span> nread;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">63&lt;/span>&lt;span> &lt;span style="color:#50fa7b">atomicIncr&lt;/span>(server.stat_net_repl_input_bytes, nread);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">64&lt;/span>&lt;span> } &lt;span style="color:#ff79c6">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">65&lt;/span>&lt;span> &lt;span style="color:#50fa7b">atomicIncr&lt;/span>(server.stat_net_input_bytes, nread);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">66&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">67&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">68&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (&lt;span style="color:#ff79c6">!&lt;/span>(c&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>flags &lt;span style="color:#ff79c6">&amp;amp;&lt;/span> CLIENT_MASTER) &lt;span style="color:#ff79c6">&amp;amp;&amp;amp;&lt;/span> &lt;span style="color:#50fa7b">sdslen&lt;/span>(c&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>querybuf) &lt;span style="color:#ff79c6">&amp;gt;&lt;/span> server.client_max_querybuf_len) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">69&lt;/span>&lt;span> sds ci &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#50fa7b">catClientInfoString&lt;/span>(&lt;span style="color:#50fa7b">sdsempty&lt;/span>(),c), bytes &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#50fa7b">sdsempty&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">70&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">71&lt;/span>&lt;span> bytes &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#50fa7b">sdscatrepr&lt;/span>(bytes,c&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>querybuf,&lt;span style="color:#bd93f9">64&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">72&lt;/span>&lt;span> &lt;span style="color:#50fa7b">serverLog&lt;/span>(LL_WARNING,&lt;span style="color:#f1fa8c">&amp;#34;Closing client that reached max query buffer length: %s (qbuf initial bytes: %s)&amp;#34;&lt;/span>, ci, bytes);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">73&lt;/span>&lt;span> &lt;span style="color:#50fa7b">sdsfree&lt;/span>(ci);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">74&lt;/span>&lt;span> &lt;span style="color:#50fa7b">sdsfree&lt;/span>(bytes);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">75&lt;/span>&lt;span> &lt;span style="color:#50fa7b">freeClientAsync&lt;/span>(c);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">76&lt;/span>&lt;span> &lt;span style="color:#ff79c6">goto&lt;/span> done;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">77&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">78&lt;/span>&lt;span> &lt;span style="color:#6272a4">//å¤„ç†è¯»åˆ°çš„æ•°æ®,å°è¯•è§£æRESPåè®®
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">79&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">if&lt;/span> (&lt;span style="color:#50fa7b">processInputBuffer&lt;/span>(c) &lt;span style="color:#ff79c6">==&lt;/span> C_ERR)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">80&lt;/span>&lt;span> c &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">NULL&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">81&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">82&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">done&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">83&lt;/span>&lt;span> &lt;span style="color:#50fa7b">beforeNextClient&lt;/span>(c);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">84&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>åœ¨è¿™ä¸ªå‡½æ•°ä¸­åˆ¤æ–­æ˜¯å¦éœ€è¦ä½¿ç”¨å¤šçº¿ç¨‹ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#8be9fd">int&lt;/span> &lt;span style="color:#50fa7b">postponeClientRead&lt;/span>(client &lt;span style="color:#ff79c6">*&lt;/span>c) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span> &lt;span style="color:#6272a4">//åœ¨è¿™é‡Œåˆ¤æ–­æ˜¯å¦éœ€è¦ä½¿ç”¨å¤šçº¿ç¨‹ä»ç½‘ç»œè¯»å–æ•°æ®
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">if&lt;/span> (server.io_threads_active &lt;span style="color:#ff79c6">&amp;amp;&amp;amp;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span> server.io_threads_do_reads &lt;span style="color:#ff79c6">&amp;amp;&amp;amp;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span> &lt;span style="color:#ff79c6">!&lt;/span>ProcessingEventsWhileBlocked &lt;span style="color:#ff79c6">&amp;amp;&amp;amp;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span> &lt;span style="color:#ff79c6">!&lt;/span>(c&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>flags &lt;span style="color:#ff79c6">&amp;amp;&lt;/span> (CLIENT_MASTER&lt;span style="color:#ff79c6">|&lt;/span>CLIENT_SLAVE&lt;span style="color:#ff79c6">|&lt;/span>CLIENT_BLOCKED)) &lt;span style="color:#ff79c6">&amp;amp;&amp;amp;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span> io_threads_op &lt;span style="color:#ff79c6">==&lt;/span> IO_THREADS_OP_IDLE)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span> &lt;span style="color:#6272a4">//å¦‚æœéœ€è¦å¤šçº¿ç¨‹è¯»å–,æŠŠå½“å‰clientåŠ å…¥åˆ°`clients_pending_read`ä¸­,ç­‰å¾…åç»­è°ƒç”¨
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#50fa7b">listAddNodeHead&lt;/span>(server.clients_pending_read,c);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span> c&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>pending_read_list_node &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#50fa7b">listFirst&lt;/span>(server.clients_pending_read);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> &lt;span style="color:#bd93f9">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span> } &lt;span style="color:#ff79c6">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>åœ¨é…ç½®æ–‡ä»¶ä¸­&lt;/p>
&lt;ul>
&lt;li>&lt;code>io-threads&lt;/code> IOçº¿ç¨‹æ•°é‡,é»˜è®¤åªæœ‰ä¸€ä¸ªï¼Œä¹Ÿå°±æ˜¯ä¸ç”¨å¤šçº¿ç¨‹è¯»å†™ç½‘ç»œ&lt;/li>
&lt;li>&lt;code>io-threads-do-reads&lt;/code> æ˜¯å¦å¼€å¯å¤šçº¿ç¨‹è¯»å’Œè§£æRESPåŠŸèƒ½ï¼Œå¦‚æœä¸å¼€å¯ï¼Œé‚£ä¹ˆå¤šçº¿ç¨‹åªä¼šå¤„ç†å†™&lt;/li>
&lt;/ul>
&lt;p>å¦‚æœåªæœ‰ä¸€ä¸ªclientå°±ç»ªï¼ˆä¹Ÿå°±æ˜¯æ²¡æœ‰å¹¶å‘è¯·æ±‚ï¼‰æ—¶ï¼Œå³ä½¿å¼€äº†å¤šçº¿ç¨‹å’ŒIOçº¿ç¨‹è¯»ï¼Œä¹Ÿä¸ä¼šä½¿ç”¨å¤šçº¿ç¨‹å»è¯»ç½‘ç»œï¼Œåªæœ‰å½“å¤šä¸ªclientåŒæ—¶è¯»å†™æ•°æ®ï¼Œè¿™æ—¶å€™ä¼šåœ¨ &lt;code>handleClientsWithPendingReadsUsingThreads&lt;/code> ä¸­å¼€å¯ å¤šçº¿ç¨‹å¤„ç†ã€‚&lt;/p>
&lt;p>&lt;a class="link" href="https://github.com/redis/redis/blob/d2c8a4b91e8c0e6aefd1f5bc0bf582cddbe046b7/src/networking.c#L4329" target="_blank" rel="noopener"
>å¼€å¯å¤šçº¿ç¨‹è¯»å†™&lt;/a>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">if&lt;/span> (&lt;span style="color:#ff79c6">!&lt;/span>server.io_threads_active) &lt;span style="color:#50fa7b">startThreadedIO&lt;/span>();
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æ­¤æ—¶ï¼Œå½“clientè¯»äº‹ä»¶å°±ç»ªåï¼Œå†æ¬¡å›è°ƒ &lt;code>readQueryFromClient&lt;/code> å‡½æ•°åï¼Œä¼šè¿›å…¥ &lt;code>listAddNodeHead(server.clients_pending_read,c);&lt;/code> åŠ å…¥é“¾è¡¨ï¼Œç­‰å¾…IOçº¿ç¨‹å¤„ç†&lt;/p>
&lt;p>&lt;strong>å¦‚æœéœ€è¦å¤šçº¿ç¨‹&lt;/strong>&lt;/p>
&lt;p>åœ¨ä¸»çº¿ç¨‹é‡Œè°ƒç”¨ ä½¿ç”¨ &lt;code>aeEventPool&lt;/code> çš„ &lt;code>beforesleep&lt;/code> å‡½æ•°æŒ‡é’ˆè°ƒç”¨ &lt;a class="link" href="https://github.com/redis/redis/blob/d2c8a4b91e8c0e6aefd1f5bc0bf582cddbe046b7/src/server.c#L1625" target="_blank" rel="noopener"
>beforeSleep&lt;/a> å‡½æ•°æ¥æ‰§è¡Œ sleepå‰çš„å¤„ç†å‡½æ•°ï¼Œç„¶ååœ¨è°ƒç”¨ &lt;a class="link" href="https://github.com/redis/redis/blob/d2c8a4b91e8c0e6aefd1f5bc0bf582cddbe046b7/src/networking.c#L4443" target="_blank" rel="noopener"
>handleClientsWithPendingReadsUsingThreads&lt;/a> å‡½æ•°æ¥åˆ¤æ–­æ˜¯å¦éœ€è¦ä½¿ç”¨å¤šçº¿ç¨‹æ¥è¯»æ•°æ®ã€‚&lt;/p>
&lt;p>æœ€åçš„è¯»å–æ˜¯ç”± &lt;a class="link" href="https://github.com/redis/redis/blob/d2c8a4b91e8c0e6aefd1f5bc0bf582cddbe046b7/src/networking.c#L2616" target="_blank" rel="noopener"
>readQueryFromClient&lt;/a> å‡½æ•°æ¥å®Œæˆæ•°æ®çš„è¯»å–ã€‚&lt;/p>
&lt;p>&lt;code>readQueryFromClient&lt;/code> å‡½æ•°å¯ä»¥é€šè¿‡ &lt;code>handleClientsWithPendingReadsUsingThreads&lt;/code> å‡½æ•°åœ¨ä¸»çº¿ç¨‹è°ƒç”¨ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ &lt;a class="link" href="https://github.com/redis/redis/blob/d2c8a4b91e8c0e6aefd1f5bc0bf582cddbe046b7/src/networking.c#L4173" target="_blank" rel="noopener"
>IOThreadMain&lt;/a> å‡½æ•°é€šè¿‡IOçº¿ç¨‹å¹¶å‘è¯»å–ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#6272a4">//å¯åŠ¨IOå¤šçº¿ç¨‹è¯»å–æ•°æ®
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span>io_threads_op &lt;span style="color:#ff79c6">=&lt;/span> IO_THREADS_OP_READ;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span>&lt;span style="color:#ff79c6">for&lt;/span> (&lt;span style="color:#8be9fd">int&lt;/span> j &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#bd93f9">1&lt;/span>; j &lt;span style="color:#ff79c6">&amp;lt;&lt;/span> server.io_threads_num; j&lt;span style="color:#ff79c6">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span> &lt;span style="color:#8be9fd">int&lt;/span> count &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#50fa7b">listLength&lt;/span>(io_threads_list[j]);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span> &lt;span style="color:#50fa7b">setIOPendingCount&lt;/span>(j, count);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span>.......
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span>&lt;span style="color:#6272a4">//ç­‰å¾…IOçº¿ç¨‹è¯»å–å®Œæˆ
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span>&lt;span style="color:#ff79c6">while&lt;/span>(&lt;span style="color:#bd93f9">1&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span> &lt;span style="color:#8be9fd">unsigned&lt;/span> &lt;span style="color:#8be9fd">long&lt;/span> pending &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span> &lt;span style="color:#ff79c6">for&lt;/span> (&lt;span style="color:#8be9fd">int&lt;/span> j &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#bd93f9">1&lt;/span>; j &lt;span style="color:#ff79c6">&amp;lt;&lt;/span> server.io_threads_num; j&lt;span style="color:#ff79c6">++&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span> pending &lt;span style="color:#ff79c6">+=&lt;/span> &lt;span style="color:#50fa7b">getIOPendingCount&lt;/span>(j);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (pending &lt;span style="color:#ff79c6">==&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>) &lt;span style="color:#ff79c6">break&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å½“æ‰§è¡Œå®Œ &lt;code>beforesleep&lt;/code> å‡½æ•°åï¼Œå†ç”± &lt;code>aeFileEvent&lt;/code> çš„ &lt;code>rfileProc&lt;/code> å‡½æ•°æŒ‡é’ˆè°ƒç”¨ &lt;a class="link" href="https://github.com/redis/redis/blob/d2c8a4b91e8c0e6aefd1f5bc0bf582cddbe046b7/src/networking.c#L2520" target="_blank" rel="noopener"
>processInputBuffer&lt;/a> å‡½æ•°å†…ä¸»è¦æ˜¯åˆ¤æ–­å’Œè§£æå­—ç¬¦ä¸²ï¼Œå°±ä¸å±•å¼€åˆ†æäº†&lt;/p>
&lt;p>ä¸»è¦å…³æ³¨è¿™éƒ¨åˆ†é€»è¾‘&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (c&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>reqtype &lt;span style="color:#ff79c6">==&lt;/span> PROTO_REQ_INLINE) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span> &lt;span style="color:#6272a4">//å¦‚æœæ˜¯ä¸€è¡Œçš„å­—ç¬¦ä¸²,è§£ææ–¹å¼
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">if&lt;/span> (&lt;span style="color:#50fa7b">processInlineBuffer&lt;/span>(c) &lt;span style="color:#ff79c6">!=&lt;/span> C_OK) &lt;span style="color:#ff79c6">break&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span> } &lt;span style="color:#ff79c6">else&lt;/span> &lt;span style="color:#ff79c6">if&lt;/span> (c&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>reqtype &lt;span style="color:#ff79c6">==&lt;/span> PROTO_REQ_MULTIBULK) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span> &lt;span style="color:#6272a4">//å¦‚æœæ˜¯å¤šè¡Œçš„,è§£ææ–¹å¼
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">if&lt;/span> (&lt;span style="color:#50fa7b">processMultibulkBuffer&lt;/span>(c) &lt;span style="color:#ff79c6">!=&lt;/span> C_OK) &lt;span style="color:#ff79c6">break&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span> } &lt;span style="color:#ff79c6">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span> &lt;span style="color:#50fa7b">serverPanic&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;Unknown request type&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span> &lt;span style="color:#6272a4">//å¦‚æœè§£æåˆ°çš„å‚æ•°ä¸ªæ•°æ˜¯0,é‚£ä¹ˆè¯´æ˜è¿˜æ²¡æœ‰è§£æå®Œæˆ,é‡ç½®client
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">if&lt;/span> (c&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>argc &lt;span style="color:#ff79c6">==&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span> &lt;span style="color:#50fa7b">resetClient&lt;/span>(c);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span> } &lt;span style="color:#ff79c6">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15&lt;/span>&lt;span> &lt;span style="color:#6272a4">//åˆ¤æ–­ä¸€ä¸‹æ˜¯å¦åœ¨IOçº¿ç¨‹é‡Œ,å¦‚æœæ˜¯çš„è¯,è®¾ç½®ä¸€ä¸‹flag,ç„¶åç»“æŸ.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#6272a4">//å› ä¸ºredisçš„å¤šçº¿ç¨‹åªèƒ½ç”¨æ¥è¯»å†™ç½‘ç»œ,æ“ä½œredisçš„æ•°æ®åº“è¿˜æ˜¯ç”¨å•çº¿çš„
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">if&lt;/span> (io_threads_op &lt;span style="color:#ff79c6">!=&lt;/span> IO_THREADS_OP_IDLE) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18&lt;/span>&lt;span> &lt;span style="color:#50fa7b">serverAssert&lt;/span>(io_threads_op &lt;span style="color:#ff79c6">==&lt;/span> IO_THREADS_OP_READ);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19&lt;/span>&lt;span> c&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>flags &lt;span style="color:#ff79c6">|=&lt;/span> CLIENT_PENDING_COMMAND;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20&lt;/span>&lt;span> &lt;span style="color:#ff79c6">break&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23&lt;/span>&lt;span> &lt;span style="color:#6272a4">//å¼€å§‹æ‰§è¡Œå‘½ä»¤äº†
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">if&lt;/span> (&lt;span style="color:#50fa7b">processCommandAndResetClient&lt;/span>(c) &lt;span style="color:#ff79c6">==&lt;/span> C_ERR) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> C_ERR;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æœ€ç»ˆä¼šè°ƒç”¨ &lt;a class="link" href="https://github.com/redis/redis/blob/d2c8a4b91e8c0e6aefd1f5bc0bf582cddbe046b7/src/server.c#L3825" target="_blank" rel="noopener"
>processCommand&lt;/a> å‡½æ•°æ‰§è¡Œå‘½ä»¤&lt;/p>
&lt;p>æ‰§è¡Œå‘½ä»¤çš„é€»è¾‘å…ˆä¸ç®¡ï¼Œè¿™ä¸æ˜¯æœ¬æ–‡çš„é‡ç‚¹ã€‚&lt;/p>
&lt;h3 id="å†™å¤„ç†">&lt;a href="#%e5%86%99%e5%a4%84%e7%90%86" class="header-anchor">&lt;/a>å†™å¤„ç†
&lt;/h3>&lt;p>å½“å‘½ä»¤å¤„ç†å®Œæˆåï¼ŒæŠŠæœ‰éœ€è¦å›å¤å®¢æˆ·ç«¯çš„æ•°æ®å†™å…¥clientçš„bufä¸­ã€‚&lt;/p>
&lt;p>æœ€åä¼šè°ƒç”¨ &lt;a class="link" href="https://github.com/redis/redis/blob/d2c8a4b91e8c0e6aefd1f5bc0bf582cddbe046b7/src/networking.c#L1939" target="_blank" rel="noopener"
>writeToClient&lt;/a> å‡½æ•°æŠŠ client buf ä¸­çš„æ•°æ®å†™å…¥åˆ°ç½‘ç»œä¸­ï¼Œå®Œæˆæ•°æ®è¿”å›ã€‚&lt;/p>
&lt;p>&lt;code>writeToClient&lt;/code> æœ‰å¤šä¸ªå›è°ƒè·¯å¾„ã€‚ä½†æ˜¯éƒ½æ˜¯ç”± &lt;code>aeEventpool&lt;/code> ä¸­çš„ &lt;code>aftersleep&lt;/code> å‡½æ•°æŒ‡é’ˆ è°ƒç”¨ &lt;code>beforeSleep&lt;/code> å‡½æ•°æ¥å®Œæˆçš„ã€‚&lt;/p>
&lt;p>åœ¨ &lt;code>beforeSleep&lt;/code> ä¸­è°ƒç”¨ &lt;a class="link" href="https://github.com/redis/redis/blob/d2c8a4b91e8c0e6aefd1f5bc0bf582cddbe046b7/src/server.c#L1738" target="_blank" rel="noopener"
>handleClientsWithPendingWritesUsingThreads&lt;/a> å‡½æ•°ã€‚&lt;/p>
&lt;p>è¿™ä¸ªå‡½æ•°ä¹Ÿæ¯”è¾ƒé•¿ï¼Œå°±ä¸è´´äº†ï¼ŒåªæŒ‘ä¸€äº›é‡ç‚¹çš„ã€‚è¿™æœŸè´´äº†ä¸å°‘æºç ï¼Œä¸€ç›´çœ‹æºç ï¼Œä¹ŸæŒºæ¯ç‡¥çš„ã€‚è¿™ä¸ªå‡½æ•°çš„å¤§æ¦‚é€»è¾‘å’Œ &lt;code>handleClientsWithPendingReadsUsingThreads&lt;/code> å‡½æ•°çš„å·®ä¸å¤šï¼Œåªä¸è¿‡è¿™é‡Œå¤„ç†çš„æ˜¯å†™ç½‘ç»œã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">if&lt;/span> (server.io_threads_num &lt;span style="color:#ff79c6">==&lt;/span> &lt;span style="color:#bd93f9">1&lt;/span> &lt;span style="color:#ff79c6">||&lt;/span> &lt;span style="color:#50fa7b">stopThreadedIOIfNeeded&lt;/span>()) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> &lt;span style="color:#50fa7b">handleClientsWithPendingWrites&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™é‡Œåˆ¤æ–­ä¸€ä¸‹ï¼Œå¦‚æœæ²¡æœ‰å¼€å¯å¤šçº¿ç¨‹æˆ–è€…åœäº†IOçº¿ç¨‹ï¼Œå°±ä½¿ç”¨ &lt;code>handleClientsWithPendingWrites&lt;/code> å‡½æ•°åœ¨ä¸»çº¿ç¨‹å¤„ç†å†™é€»è¾‘ã€‚&lt;/p>
&lt;p>&lt;a class="link" href="https://github.com/redis/redis/blob/d2c8a4b91e8c0e6aefd1f5bc0bf582cddbe046b7/src/networking.c#L2023" target="_blank" rel="noopener"
>handleClientsWithPendingWrites&lt;/a> é‡Œçš„é€»è¾‘å¾ˆç®€å•ï¼Œéå† &lt;code>server.clients_pending_write&lt;/code> ä¸­çš„clientï¼Œç„¶åè°ƒç”¨ &lt;a class="link" href="https://github.com/redis/redis/blob/d2c8a4b91e8c0e6aefd1f5bc0bf582cddbe046b7/src/networking.c#L1939" target="_blank" rel="noopener"
>writeToClient&lt;/a> æŠŠæ•°æ®å†™å…¥åˆ°ç½‘ç»œä¸­ã€‚&lt;/p>
&lt;p>å›åˆ° &lt;code>handleClientsWithPendingWritesUsingThreads&lt;/code> å‡½æ•°ä¸­ï¼Œè°ƒç”¨ &lt;code>startThreadedIO()&lt;/code> å¯åŠ¨ IOçº¿ç¨‹å¹¶å‘å¤„ç†å†™å…¥ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#6272a4">//åœ¨ä¸»çº¿ç¨‹ä¸­ä¹Ÿä¼šå¤„ç†å†™å…¥
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span>&lt;span style="color:#50fa7b">listRewind&lt;/span>(io_threads_list[&lt;span style="color:#bd93f9">0&lt;/span>],&lt;span style="color:#ff79c6">&amp;amp;&lt;/span>li);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span>&lt;span style="color:#ff79c6">while&lt;/span>((ln &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#50fa7b">listNext&lt;/span>(&lt;span style="color:#ff79c6">&amp;amp;&lt;/span>li))) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span> client &lt;span style="color:#ff79c6">*&lt;/span>c &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#50fa7b">listNodeValue&lt;/span>(ln);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span> &lt;span style="color:#50fa7b">writeToClient&lt;/span>(c,&lt;span style="color:#bd93f9">0&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span>&lt;span style="color:#50fa7b">listEmpty&lt;/span>(io_threads_list[&lt;span style="color:#bd93f9">0&lt;/span>]);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span>&lt;span style="color:#6272a4">//å’Œä¸Šé¢çš„å¤šçº¿ç¨‹è¯»ä¸€æ ·,è¿™é‡Œä¹Ÿä¼šç­‰å¾…æ‰€æœ‰IOçº¿ç¨‹ä»»åŠ¡ç»“æŸ
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span>&lt;span style="color:#ff79c6">while&lt;/span>(&lt;span style="color:#bd93f9">1&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span> &lt;span style="color:#8be9fd">unsigned&lt;/span> &lt;span style="color:#8be9fd">long&lt;/span> pending &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span> &lt;span style="color:#ff79c6">for&lt;/span> (&lt;span style="color:#8be9fd">int&lt;/span> j &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#bd93f9">1&lt;/span>; j &lt;span style="color:#ff79c6">&amp;lt;&lt;/span> server.io_threads_num; j&lt;span style="color:#ff79c6">++&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span> pending &lt;span style="color:#ff79c6">+=&lt;/span> &lt;span style="color:#50fa7b">getIOPendingCount&lt;/span>(j);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (pending &lt;span style="color:#ff79c6">==&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>) &lt;span style="color:#ff79c6">break&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>åˆ°è¿™åŸºæœ¬redisçš„æ•´ä¸ªç½‘ç»œå¤„ç†æµç¨‹å¤§æ¦‚å°±å†™å®Œäº†ã€‚æ³¨æ„ï¼Œè¿™åªæ˜¯ä¸ªå¤§æ¦‚ï¼Œå…¶ä¸­çš„ä¸€äº›ç»†èŠ‚è¿˜æ²¡æœ‰æ·±å…¥åˆ†æã€‚æ¯”å¦‚åœ¨ &lt;code>aeProcessEvents&lt;/code> å‡½æ•°ä¸­ï¼Œä¸ºä»€ä¹ˆæœ‰ &lt;code>beforesleep&lt;/code> å’Œ &lt;code>aftersleep&lt;/code> è¿™ä¸¤ä¸ªå‡½æ•°æŒ‡é’ˆï¼Œä»¥åŠè°ƒç”¨ä¸¤ä¸ªå‡½æ•°ä¸­çš„å…ˆåè°ƒç”¨é¡ºåºã€‚ &lt;code>aeFileEvent&lt;/code> ä¸­ &lt;code>rfileProc&lt;/code> å’Œ &lt;code>wfileProc&lt;/code> è¿™ä¸¤ä¸ªå‡½æ•°æŒ‡é’ˆçš„è°ƒç”¨é¡ºåºï¼Œä»¥åŠè°ƒç”¨çš„å‡½æ•°çš„é€»è¾‘ã€‚æ¯ä¸€ä¸ªéƒ½å¯ä»¥æ‹¿å‡ºæ¥å•ç‹¬å†™ä¸€ç¯‡ã€‚&lt;/p>
&lt;p>ä»¥åæœ‰æ—¶é—´åœ¨å•ç‹¬æ‹¿å‡ºæ¥åˆ†æå§ã€‚å¦‚æœæœ‰æ—¶é—´å†è¿™ç¯‡æ–‡ç« è¡¥ä¸€ä¸ªæµç¨‹å›¾ã€‚&lt;/p>
&lt;p>redisç”¨Cå†™çš„ï¼ŒCå¯¹å¤šæ€çš„æ”¯æŒä¸å¤ªå¥½ï¼Œä¸åƒé¢å‘å¯¹è±¡çš„è¯­è¨€é‚£æ ·ï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿çš„ä½¿ç”¨å¤šæ€ã€‚æ‰€ä»¥åœ¨redisçš„æºç é‡Œï¼Œå¤§é‡ä½¿ç”¨äº†å‡½æ•°æŒ‡é’ˆå’Œå›è°ƒå‡½æ•°ï¼Œæ¥é—´æ¥çš„å®ç°äº†å¤šæ€ã€‚è¿™æ ·ä¼šåœ¨é˜…è¯»æºç çš„æ—¶å€™å¢åŠ äº†å¾ˆå¤šç†è§£æˆæœ¬ã€‚&lt;/p>
&lt;p>ä½†æ˜¯é²è¿…å…ˆç”Ÿæ›¾ç»è¯´è¿‡ï¼Œåœ¨æ–­ç‚¹é¢å‰ï¼Œä¸€åˆ‡è¯­æ³•éƒ½æ˜¯çº¸è€è™ã€‚æ‰€ä»¥é‡åˆ°å¤æ‚çš„å‡½æ•°è°ƒç”¨é€»è¾‘ï¼Œä½¿ç”¨æ–­ç‚¹å»çœ‹ä¸€ä¸‹å‡½æ•°çš„è°ƒç”¨å…³ç³»ï¼Œå †æ ˆï¼ŒåŸºæœ¬éƒ½èƒ½è§£å†³é—®é¢˜ã€‚&lt;/p>
&lt;p>ä¹Ÿå¿«è¿‡å¹´äº†ï¼Œæå‰ç¥æ‰€æœ‰è¯»è€… æ–°å¹´å¿«ä¹&lt;/p></description></item><item><title>æˆ‘çš„2023</title><link>https://lqxhub.github.io/posts/f5a4584b/</link><pubDate>Mon, 25 Dec 2023 19:26:56 +0000</pubDate><guid>https://lqxhub.github.io/posts/f5a4584b/</guid><description>&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/1703414244771.jpg" alt="Featured image of post æˆ‘çš„2023" />&lt;p>2023é©¬ä¸Šå°±ç»“æŸäº†ï¼Œåœ¨å¹´åº•å›å¿†æ€»ç»“ä¸€ä¸‹ä»Šå¹´çš„ä¸€äº›äº‹æƒ…ï¼Œé¡ºä¾¿æ€è€ƒä¸€ä¸‹æ˜å¹´çš„ä¸€äº›è®¡åˆ’ã€‚
ä»¥å‰æ¯å¹´æˆ‘ä¹Ÿä¼šå†™ä¸€ä¸‹ï¼Œåªæ˜¯æ²¡æœ‰å…¬å¼€å‡ºæ¥ï¼Œä»Šå¹´æƒ³ç€å…¬å¼€ä¸€ä¸‹ï¼Œä¸€äº›äº‹æƒ…å…¬å¼€å‡ºæ¥ï¼Œå¯èƒ½è¿˜ä¼šæœ‰é­ç­–çš„ä½œç”¨ 0.0&lt;/p>
&lt;p>è¿˜æ˜¯ä» &lt;strong>ç”Ÿæ´»&lt;/strong> ä¸ &lt;strong>å·¥ä½œ&lt;/strong> ä¸¤æ–¹é¢æ¥å†™å§&lt;/p>
&lt;h2 id="ç”Ÿæ´»">&lt;a href="#%e7%94%9f%e6%b4%bb" class="header-anchor">&lt;/a>ç”Ÿæ´»
&lt;/h2>&lt;p>ä»Šå¹´æ²¡æœ‰å£ç½©ç®¡æ§äº†ï¼Œèƒ½å‡ºå»ç©ï¼Œä¸€äº›æç½®äº†å¥½ä¹…çš„äº‹æƒ…ç»ˆäºå¯ä»¥åšäº†ã€‚å›æƒ³ä¸€ä¸‹ï¼Œæ¯•ä¸šåŠå¹´åå°±é‡åˆ°äº†å£ç½©ï¼Œè¿™å‡ å¹´ä¸€ç›´æ²¡æœ‰æ€ä¹ˆå‡ºå»ç©è¿‡ï¼Œä»Šå¹´ç®—æ˜¯å¿™é‡Œå·é—²å‡ºå»ç©äº†å‡ æ¬¡ã€‚&lt;/p>
&lt;h3 id="lpl">&lt;a href="#lpl" class="header-anchor">&lt;/a>LPL
&lt;/h3>&lt;p>ä»Šå¹´ï¼Œå»çœ‹äº†ä¸€åœº LPL çš„çº¿ä¸‹èµ›ï¼Œè§åˆ°äº†shyå“¥ã€‚è™½ç„¶é‚£å¤©shyå“¥è¾“äº†ã€‚(WBG ä¸æ•Œ RNG) ä½†æ˜¯çœ‹åˆ°äº† GALA çš„å¡èäº”æ€ï¼Œä¹Ÿç®—å€¼å›ç¥¨ä»·äº†&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/1703415184111.jpg">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/1703415184111.jpg" alt="" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/1703415183619.jpg">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/1703415183619.jpg" alt="" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>æˆ‘ä¹Ÿæ²¡æœ‰æ‹ç…§çš„ä¹ æƒ¯ï¼Œå¥½å¤šç…§ç‰‡æ‰¾ä¸åˆ°äº†ï¼Œå°±å‡‘åˆæ”¾è¿™ä¸¤å¼ å§&lt;/p>
&lt;h3 id="æ¼”å”±ä¼š">&lt;a href="#%e6%bc%94%e5%94%b1%e4%bc%9a" class="header-anchor">&lt;/a>æ¼”å”±ä¼š
&lt;/h3>&lt;p>ä»Šå¹´æ˜æ˜Ÿæ‰å †å¼€æ¼”å”±ä¼šï¼Œçƒ­é—¹çš„æ—¶å€™ï¼Œä¸Šæµ·ä¸€å‘¨å¥½å‡ åœºã€‚æœ‰å‡ ä¸ªçƒ­é—¨çš„æ²¡æœ‰æŠ¢åˆ°ï¼Œä½†æ˜¯æŠ¢åˆ°äº† &lt;strong>å¤§å¼ ä¼Ÿ&lt;/strong> çš„ã€‚ä¸å¾—ä¸è¯´ï¼Œå¤§å¼ ä¼Ÿè€å¸ˆç»å¯¹æ²¡æœ‰å‡å”±(æ‰‹åŠ¨ç‹—å¤´)ç°åœºæ°›å›´æ‹‰æ»¡ï¼Œå¤ªå—¨äº†ã€‚ä¹°çš„æ˜¯æ¼”å”±ä¼šçš„é—¨ç¥¨ï¼Œè¿˜èƒ½ç°åœºå¬è„±å£ç§€ï¼Œå¤ªå€¼äº†ã€‚&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/1703415131242.jpg">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/1703415131242.jpg" alt="" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>ä»Šå¹´æœ‰å‡ ä¸ªæ²¡æœ‰æŠ¢åˆ°æœ‰ç‚¹å¯æƒœã€‚ä¸€ä¸ªæ˜¯ &lt;strong>æˆ¿ä¸œçš„çŒ«&lt;/strong> è¿˜ä¸€ä¸ªæ˜¯ &lt;strong>é™ˆç²’&lt;/strong> æˆ‘æ¯”è¾ƒå–œæ¬¢çš„ä¸¤ä¸ªæ°‘è°£æ­Œæ‰‹ï¼Œè¿˜æœ‰ &lt;strong>ä¼ä½°&lt;/strong> æ²¡æœ‰æŠ¢åˆ°æœ‰ç‚¹å¯æƒœï¼Œç­‰ä¸‹æ¬¡æœ‰æœºä¼šå§ã€‚è‡³äº å‘¨è‘£çš„ï¼Œæˆ‘éƒ½æ²¡æŠ¢è¿‡ï¼Œæˆ‘çŸ¥é“æˆ‘æŠ¢ä¸åˆ°ã€‚&lt;/p>
&lt;h3 id="ç©">&lt;a href="#%e7%8e%a9" class="header-anchor">&lt;/a>ç©
&lt;/h3>&lt;p>ä»Šå¹´æ²¡æœ‰ç®¡æ§äº†ï¼Œå¯ä»¥è‡ªç”±å‡ºå»ç©äº†ã€‚ä»¥å‰æˆ‘å§å§å’Œå¦¹å¦¹å°±æƒ³æ¥ä¸Šæµ·ç©äº†ï¼Œå¯æƒœä»¥å‰ä¸èƒ½è¯´æ¥å°±æ¥ï¼Œä»Šå¹´æš‘å‡ç»ˆäºæœ‰æœºä¼šäº†ã€‚å¥¹ä»¬æ¥ä¸Šæµ·ç©äº†å¥½å‡ å¤©ï¼Œç„¶ååˆä¸€èµ·å»æ­å·ç©äº†å‡ å¤©ã€‚æš‘å‡å‡ºå»ç©çš„ç¼ºç‚¹å°±æ˜¯äººå¤šå’Œå¤ªçƒ­ï¼Œæ„Ÿè§‰æ­å·æ¯”ä¸Šæµ·è¿˜çƒ­ã€‚&lt;/p>
&lt;p>ä»Šå¹´æˆ‘ä¸€äº›åŒå­¦ä¹Ÿæœ‰æ¥ä¸Šæµ·ç©çš„ï¼Œç„¶åå°±æ˜¯åœ¨ä¸Šæµ·è±ªé¥®ï¼Œç»™æ—è¾¹çš„äººéƒ½çœ‹è’™äº†ï¼Œä½ ä»¬è¿™æ˜¯ä»€ä¹ˆå–æ³•ï¼Œä¸€äººå¥”ç€ä¸€ç®±å•¤é…’å–0.0&lt;/p>
&lt;p>å¥½ä¹…ä¹‹å‰å°±è®¡åˆ’ç€å»é‡åº†ç©äº†ï¼Œä»Šå¹´ç»ˆäºå»äº†ã€‚åæœˆåº•å»çš„ï¼Œä¸ºäº†é¿å¼€å›½åº†å‡æœŸã€‚å»ç©äº†ä¸‰å¤©ï¼Œè€å¹´ç‰¹ç§å…µæ—…æ¸¸ï¼Œä¸€å¤©èµ°ä¸‰ä¸‡æ­¥ã€‚æ•´ä½“æ„Ÿè§‰è¿˜æ˜¯éå¸¸æ£’çš„ï¼Œéå¸¸å–œæ¬¢é‡åº†çš„ç¾é£Ÿï¼Œä¹Ÿå–œæ¬¢é‚£é‡Œçš„ç”Ÿæ´»æ°›å›´ã€‚å¦‚æœåªæ˜¯ç”Ÿæ´»çš„è¯ï¼Œæ„Ÿè§‰æ¯”ä¸Šæµ·è¦èˆ’é€‚&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/mmexport1698513234184.jpg">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/mmexport1698513234184.jpg" alt="" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/1703414244771.jpg">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/1703414244771.jpg" alt="" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/1703415086338.jpg">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/1703415086338.jpg" alt="" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>å½“æ—¶æ˜¯ä¸€ä¸ªäººå»çš„ï¼Œå»çš„æ—¶å€™è®¤è¯†äº†ä¸¤ä¸ªæ­å­ï¼ˆä»Šå¹´å¥½åƒæµè¡Œæ‰¾æ­å­ï¼‰ä¸ºäº†ä¿æŠ¤éšç§ï¼Œä¸æ”¾å¥¹ä»¬ç…§ç‰‡äº†ã€‚å‡ºå»ç©äº†ä¸€åœˆï¼Œè¿˜è®¤è¯†äº†æ–°çš„æœ‹å‹ï¼Œå¿«ä¹åˆç¥å¥‡ã€‚&lt;/p>
&lt;p>æœ¬æ¥ä»Šå¹´è¿˜è®¡åˆ’ç§‹å¤©å»ä¸€è¶Ÿå—äº¬ï¼Œçœ‹ä¸€åœºå—äº¬çš„è½å¶ï¼Œå› ä¸ºä¸€äº›äº‹æƒ…æ²¡æœ‰å»æˆã€‚ç­‰åˆ°æœ‰ç©ºçš„æ—¶å€™ï¼Œå·²ç»æ˜¯å†¬å­£äº†ã€‚æ˜å¹´ä¸€å®šå§å“ˆå“ˆå“ˆã€‚&lt;/p>
&lt;h3 id="heading">&lt;a href="#heading" class="header-anchor">&lt;/a>ğŸ§‘â€ğŸ¤â€ğŸ§‘
&lt;/h3>&lt;p>å»å¹´ç»“å©šçš„åŒå­¦å¤šï¼Œä½†æ˜¯æˆ‘æ²¡åŠæ³•å›å»ã€‚ä»Šå¹´ä¸¤ä¸ªåŒå­¦çš„å©šç¤¼éƒ½å›å»ï¼Œè¿˜ç»™ä¸€ä¸ªåŒå­¦è¿˜å½“äº†ä¸€æ¬¡ä¼´éƒã€‚&lt;/p>
&lt;p>è‡³äºæˆ‘è‡ªå·±ï¼Œè¿˜æ˜¯ä¸€ä¸ªäººã€‚å»å¹´å°±è¯´ä»Šå¹´åŠªåŠ›ï¼Œç°åœ¨æ¥çœ‹ï¼Œæ˜å¹´è¿˜è¦ç»§ç»­åŠªåŠ›ã€‚&lt;/p>
&lt;h2 id="å·¥ä½œ">&lt;a href="#%e5%b7%a5%e4%bd%9c" class="header-anchor">&lt;/a>å·¥ä½œ
&lt;/h2>&lt;p>ä»Šå¹´å·¥ä½œç®—æ˜¯æ¯”è¾ƒå¿™ï¼Œäº‹æƒ…æŒºå¤šçš„ã€‚æ•´ä½“çœ‹ä¸‹æ¥ï¼Œä¹Ÿç®—æ˜¯åœ¨å·¥ä½œå’Œç”Ÿæ´»ä¸­æ‰¾åˆ°äº†ä¸€ä¸ªå¹³è¡¡ç‚¹ã€‚å·¥ä½œè¿™ä¹ˆå¤šå¹´äº†ï¼Œå¾ˆå¤šäº‹æƒ…å¤„ç†èµ·æ¥ä¹Ÿç®—æ˜¯æ¯”è¾ƒå¾—å¿ƒåº”æ‰‹ï¼Œä»Šå¹´åœ¨å·¥ä½œä¸Šç®—æ˜¯æ²¡æœ‰é‡åˆ°å¤§çš„å›°éš¾ã€‚å»å¹´ç®—æ˜¯ç»™äº†æˆ‘ä¸€ä¸ªtitleï¼Œè´Ÿè´£çš„äº‹æƒ…å¤šäº†ã€‚ä½†æ˜¯æˆ‘æ„Ÿè§‰è¿˜æ˜¯ï¼Œå¤„ç†ä»£ç æ¯”å¤„ç†äººé™…å…³ç³»è¦ç®€å•ï¼Œæ‰€ä»¥æˆ‘ç°åœ¨ä¹Ÿè¿˜æ˜¯åªç®¡ä»£ç ï¼Œä¸ç®¡äººå§ã€‚&lt;/p>
&lt;p>æˆ‘è‡ªå·±ä¹ŸçŸ¥é“ï¼Œè¿™äº›ä¸œè¥¿éœ€è¦å»çªç ´ï¼Œå¯èƒ½è¿˜æ˜¯ä¸æƒ³èµ°å‡ºèˆ’é€‚åœˆã€‚è‡³äºæˆ‘ä¸æƒ³ç®¡äººï¼Œä¹Ÿä¸æ˜¯è¯´è‡ªå·±å†…å‘ï¼Œæˆ–è€…ä¸ä¼šè¯´è¯ï¼Œæˆ‘æƒ³å¯èƒ½å°±æ˜¯ä¸æƒ³æ“å¿ƒå¤ªå¤šäº‹å§ï¼Œå› ä¸ºä»£ç æ¯”äººè¦ç®€å•ï¼Œä»£ç å‡ºé—®é¢˜äº†ä¸€å®šæ˜¯æˆ‘çš„é—®é¢˜ï¼Œäººå°±å¤ªå¤æ‚äº†ã€‚&lt;/p>
&lt;p>è¿˜æœ‰å‰å‡ å¤©ï¼Œä¸€å¼ æ–‡ä»¶ä¸‹æ¥ï¼Œç›´æ¥ç»™æˆ‘å“å°¿äº†ã€‚æˆ‘éƒ½åœ¨æƒ³ï¼Œè¿™è¦æ˜¯çœŸå®æ–½äº†ï¼Œæˆ‘æ€•ä¸æ˜¯è¦å¤±ä¸šäº†ã€‚æ¸¸æˆè¿˜æ˜¯å¤ªçœ‹æ”¿ç­–äº†ï¼Œå¸Œæœ›ä¸€åˆ‡ç¨³ä¸­å‘å¥½å§ã€‚&lt;/p>
&lt;p>ä»Šå¹´å·¥ä½œä¸­å¥½åƒæ²¡æœ‰å‘ç”Ÿå¤ªå¤šçš„äº‹æƒ…ï¼Œä¹Ÿæ²¡æœ‰å¤ªå¤šæƒ³è®°å½•ã€‚å°±è¿™æ ·ä¸€ç¬”å¸¦è¿‡å§&lt;/p>
&lt;h2 id="å¼€æºç¤¾åŒº">&lt;a href="#%e5%bc%80%e6%ba%90%e7%a4%be%e5%8c%ba" class="header-anchor">&lt;/a>å¼€æºç¤¾åŒº
&lt;/h2>&lt;p>ä»Šå¹´å‚ä¸å¼€æºç¤¾åŒºæ¯”è¾ƒå¤šï¼Œè™½ç„¶ä»¥å‰ä¹Ÿç»™å¼€æºé¡¹ç›®æäº¤è¿‡ä»£ç ï¼Œä½†æ˜¯æ²¡æœ‰åƒä»Šå¹´è¿™æ ·æ·±åº¦å‚ä¸&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/Snipaste_2023-12-24_19-49-37.png">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/Snipaste_2023-12-24_19-49-37.png" alt="" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>æ”¾ä¸€å¼  GitHubçš„ æˆªå›¾å§ï¼Œè™½è¿œä¸åŠå¤§ä½¬ä»¬ï¼Œå¯¹è‡ªå·±æ¥è¯´ä¹Ÿæ˜¯è¿›æ­¥äº†ã€‚&lt;/p>
&lt;p>ä»Šå¹´å‘ç°äº† redisçš„ä¸€ä¸ªbugï¼Œç»™ä»–ä»¬æäº† issueï¼ŒåŸæœ¬è¿˜æƒ³ä¿®ä¸€ä¸‹ï¼Œæ··ä¸ªprå‘¢ã€‚æ²¡æƒ³åˆ°ï¼Œredisç¤¾åŒºçš„å¤§ä½¬å¤„ç†çš„å¤ªåŠæ—¶äº†ï¼Œæˆ‘æ™šä¸Š11ç‚¹å¤šå·¦å³æçš„issueï¼Œç¬¬äºŒå¤©æˆ‘ä¸Šç­æ‰“å¼€GitHubï¼Œå‘ç°é‚£è€å“¥ï¼ˆç¾å›½çš„ï¼‰å·²ç»å›å¤æˆ‘äº†ï¼Œç¡®è®¤é‚£æ˜¯bugï¼Œå¹¶ä¸”å°†bugä¿®å¤äº†ã€‚å°±è¿™æ ·præ²¡æ··æˆğŸ¤£&lt;/p>
&lt;p>ä»Šå¹´ä¸»è¦ç»™ &lt;a class="link" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/https://github.com/OpenAtomFoundation/pika" target="_blank" rel="noopener"
>pika&lt;/a> ï¼ˆå°†è¦æ”¹åä¸º pikiwidbï¼‰è´¡çŒ®ä»£ç ã€‚ä»Šå¹´ç¤¾åŒºæ˜¯é›¨å“¥åœ¨å¸¦é¢†ï¼Œç¤¾åŒºå‘å±•å¾ˆå¿«ï¼Œä»¥å‰ç›¼æœ›çš„ä¸€äº›åŠŸèƒ½ï¼Œä»Šå¹´å®ç°äº†ä¸å°‘ã€‚&lt;/p>
&lt;p>è¿™ä¸€å¹´å‚ä¸ä¸‹æ¥ï¼Œæ”¶è·è¿˜æ˜¯å¾ˆå¤§çš„ï¼Œä¹Ÿç»“è¯†äº†ä¸å°‘å¤§ä½¬ï¼Œåé¢ç»§ç»­å‚ä¸å¼€æºç¤¾åŒºï¼Œç»§ç»­å­¦ä¹ ã€‚&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/mmexport1686910637269.jpg">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/mmexport1686910637269.jpg" alt="" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/1703415230000.jpg">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/1703415230000.jpg" alt="" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>æ„Ÿè°¢ç¤¾åŒºçš„è‚¯å®š&lt;/p>
&lt;p>ä»Šå¹´å‚ä¸å¼€æºç¤¾åŒºæ¯”è¾ƒå¤šï¼Œæ¸¸æˆä¹Ÿä¸æ€ä¹ˆç©äº†ï¼Œä¸€å¹´å¥½åƒæ²¡æœ‰æ‰“å¼€è¿‡å‡ æ¬¡æ¸¸æˆäº†ã€‚&lt;/p>
&lt;h2 id="å…¶ä»–">&lt;a href="#%e5%85%b6%e4%bb%96" class="header-anchor">&lt;/a>å…¶ä»–
&lt;/h2>&lt;p>ä¹Ÿä¸çŸ¥é“è¿™äº›æ€ä¹ˆåˆ†ç±»äº†ï¼Œæƒ³åˆ°å“ªå†™åˆ°å“ªå§&lt;/p>
&lt;p>ä»Šå¹´å¤§Aè¿˜æ˜¯äºé’±çš„ä¸€å¹´ï¼Œäºå¾—è‚‰ç–¼ã€‚&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/images.jpg">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/images.jpg" alt="" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>ä»Šå¹´æœ‰ä¸€æ®µæ—¶é—´è¿˜æ˜¯ç„¦è™‘ï¼Œæœ‰æ—¶å€™è¿˜æ˜¯å¤±çœ ã€‚è‡³äºåœ¨ç„¦è™‘äº›ä»€ä¹ˆæˆ‘ä¹Ÿè¯´ä¸ä¸Šæ¥ã€‚å¾ˆå¤šæ—¶å€™ï¼Œå¯èƒ½çœ‹åˆ°ä¸€äº›äº‹æƒ…ï¼Œæœ‰äº›ä»€ä¹ˆæ„Ÿæƒ³ï¼Œæœ‰æ—¶å€™å°±ä¼šä¸€ä¸ªäººåœ¨æ·±å¤œçš„æ—¶å€™æƒ³å¾ˆå¤šã€‚äººæ€»æ˜¯åŠåˆ«äººå®¹æ˜“ï¼Œå’Œè‡ªå·±å’Œè§£å´æ²¡æœ‰é‚£ä¹ˆç®€å•ã€‚æœ‰æ—¶å€™å’Œæˆ‘å§èŠå¤©ï¼Œæˆ‘è¿˜åŠå¥¹ï¼Œä½†æ˜¯ä¸€äº›äº‹æƒ…è‡ªå·±å´ä¼šemoã€‚ä»Šå¹´å¬äº†å¾ˆå¤šæå®—ç››çš„æ­Œï¼Œå°¤å…¶æ˜¯æ·±å¤œçš„æ—¶å€™ã€‚&lt;/p>
&lt;p>å°±åœ¨æ˜¨å¤©æˆ‘ä¸€ä¸ªå¤§å­¦åŒå­¦æ¥ä¸Šæµ·ï¼Œä¸¤äººåƒå®Œé¥­åœ¨è¡—ä¸Šæºœè¾¾èŠå¤©ï¼Œå›å»ç¡å‰ä¹Ÿä¸€ç›´åœ¨èŠï¼ŒèŠåˆ°å‡Œæ™¨ä¸€ç‚¹å¤šã€‚ä»å¤§å­¦æ—¶å€™ï¼ŒèŠåˆ°ç°åœ¨å·¥ä½œã€‚ä»å·¥ä½œèŠåˆ°å®¶åº­ã€‚ä»æˆ‘ä¿©èŠåˆ°äº†ä¸€äº›å…¶ä»–çš„åŒå­¦ã€‚æœ€åæ„Ÿæ…¨ï¼Œå¾ˆå¤šæ—¶å€™å°±æ˜¯å‘½ä¸­æ³¨å®šã€‚æ¯ä¸ªäººçš„ç”Ÿæ´»éƒ½æœ‰å…‰é²œäº®ä¸½çš„ä¸€é¢ï¼Œä¹Ÿæœ‰ä¸€åœ°é¸¡æ¯›çš„çª˜è¿«ã€‚&lt;/p>
&lt;p>è¿™ä¸¤å¹´èº«è¾¹å¥½å¤šåŒå­¦éƒ½ç»“å©šäº†ï¼Œå¥½å¤šè¿˜æœ‰å­©å­ã€‚è¯´æ˜¯è‡ªå·±ä¸ç€æ€¥ï¼Œä½†æœ‰æ—¶å€™ä¹Ÿä¼šåœ¨æƒ³ï¼Œè‡ªå·±ä»€ä¹ˆæ—¶å€™èƒ½ç»“å©šå‘¢ã€‚å°±æ˜¯æ€ä¹ˆè¯´å‘¢ï¼Œåˆ«äººéƒ½äº¤å·äº†ï¼Œæˆ‘è¿˜æ²¡æœ‰å¼€å§‹ç­”é¢˜ã€‚ä¹‹å‰æˆ‘æƒ³è¿‡ï¼Œæˆ‘ä¸€ç›´åœ¨å¤–åœ°ï¼Œç®—æ˜¯ä¸€ç§é€ƒé¿ï¼Œé€ƒé¿å®¶é‡Œçš„å‚¬ã€‚ä¸€ç›´è¿™æ ·é€ƒé¿æœ‰ç‚¹è‡ªç§ï¼Œåªé¡¾è‡ªå·±ï¼Œæ²¡æœ‰è€ƒè™‘å®¶äººçš„æ„Ÿå—ä»¥å‰æ€»æ˜¯å¬å¤§äººä»¬æ˜¯è°å®¶å­©å­å¤šå¤§äº†ï¼Œå¤šå¤§äº†ï¼Œæ²¡æƒ³åˆ°æˆ‘ç°åœ¨ä¹Ÿæˆäº†åˆ«äººå£ä¸­è°å®¶çš„å­©å­äº†ã€‚&lt;/p>
&lt;p>ä¹‹å‰æ€»æ˜¯è¯´å·¥ä½œå¿™ï¼Œæ¥è§¦ä¸åˆ°äººä½œä¸ºå€Ÿå£ã€‚ç°åœ¨å‘ç°ï¼Œè¿™ç¡®å®æ˜¯ä¸€éƒ¨åˆ†åŸå› ï¼Œä½†æ˜¯è‡ªå·±ä¹Ÿæœ‰ä¸€äº›é—®é¢˜ã€‚è‡ªå·±æ²¡æœ‰æƒ³ç€å»æ”¹å˜ï¼Œèµ°å‡ºè¿™ä¸ªèˆ’é€‚åœˆï¼Œæ°¸è¿œè¿™æ ·ï¼Œæ°¸è¿œä¸å¯èƒ½æœ‰æ”¹å˜ã€‚è¿˜æœ‰ä¸€éƒ¨åˆ†åŸå› ï¼Œè‡ªå·±ä¸å–„äºå¤„ç†äººä¸äººä¹‹é—´çš„å…³ç³»ã€‚å’Œå®¶äººè¿˜æœ‰é‚£äº›ç†Ÿæ‚‰çš„æœ‹å‹ä¹‹é—´è¿˜å¥½ï¼Œå› ä¸ºéƒ½ç†Ÿæ‚‰äº†ï¼Œå¾ˆå¤šäº‹æƒ…çŸ¥é“è¯¥æ€ä¹ˆåšï¼Œä»–ä»¬ä¹ŸçŸ¥é“æˆ‘çš„ä¸€äº›æ€§æ ¼ã€‚ç›¸å¤„èµ·æ¥å°±ä¼šç®€å•å¾ˆå¤šã€‚ä½†æ˜¯å’Œä¸€ä¸ªä¸ç†Ÿæ‚‰çš„äººäº¤æµæˆ‘å°±æœ‰ç‚¹åŠ›ä¸ä»å¿ƒäº†ã€‚è¯´æ˜¯ä¸æ“…é•¿å’Œé™Œç”Ÿäººäº¤æµå§ï¼Œä½†æ˜¯ä»Šå¹´åœ¨å¼€æºç¤¾åŒºï¼Œå’Œå¾ˆå¤šäººäº¤æµæ„Ÿè§‰å´æŒºå¥½çš„ï¼Œå¯èƒ½æ˜¯å› ä¸ºåœ¨è®¨è®ºæŠ€æœ¯é—®é¢˜å§ã€‚ä»Šå¹´æˆ‘å§ç»™æˆ‘ä»‹ç»äº†ä¸€ä¸ªå¥³å­©è®¤è¯†ï¼Œè€å®¶ä¸€ä¸ªåœ°æ–¹çš„ï¼Œå¥¹ä¹Ÿæ˜¯åœ¨ä¸Šæµ·å·¥ä½œï¼Œæ¥è§¦ä¸‹æ¥æ„Ÿè§‰å°±æ˜¯ä¸¤ä¸ªäººæ²¡ä»€ä¹ˆè¯èŠï¼Œåæ¥ä¹Ÿå°±ä¸æ€ä¹ˆè”ç³»äº†ï¼Œå¯èƒ½å¾ˆå¤§ä¸€éƒ¨åˆ†åŸå› åœ¨æˆ‘å§ã€‚&lt;/p>
&lt;h2 id="æ˜å¹´">&lt;a href="#%e6%98%8e%e5%b9%b4" class="header-anchor">&lt;/a>æ˜å¹´
&lt;/h2>&lt;p>æ˜å¹´å°è¯•å»æ”¹å˜ä¸€ä¸‹å§ï¼ŒæŠŠè‡ªå·±çš„ä¸€äº›é—®é¢˜å°è¯•å»çªç ´ã€‚æŠŠå·¥ä½œåšå¥½ï¼Œå¤šå‚ä¸å¼€æºç¤¾åŒºï¼Œå¤šå­¦ä¹ ã€‚&lt;/p>
&lt;p>æ˜å¹´æœ‰æ—¶é—´çš„è¯ï¼Œè¿˜æƒ³å‡ºå»ç©ä¸€è¶Ÿã€‚è‡³äºå»å“ªè¿˜æ²¡æƒ³å¥½ï¼Œè¥¿å®‰ï¼Œå¹¿å·ï¼Œå¦é—¨ï¼ŒåŒ—äº¬ï¼Œé¦™æ¸¯ï¼Œæ­¦æ±‰ï¼Ÿåˆ°æ—¶å€™å†å®šå§&lt;/p>
&lt;p>ä»¥å‰çš„æ—¶å€™ï¼Œè¿˜è®¡åˆ’ç€å°†æ¥å’Œé‚£ä¸ªå¥¹å»é‡åº†åƒç«é”…ï¼Œå»é¼“æµªå±¿çœ‹æµ·ï¼Œå»å¹¿å·åƒå¥½åƒçš„ï¼Œå»è¥¿å®‰çš„åŸå¢™ä¸‹æ•£æ­¥ç­‰ç­‰å¥½å¤šåœ°æ–¹ã€‚ç€ç­‰äº†è¿™ä¹ˆå¤šå¹´è¿˜æ˜¯æ²¡ç­‰åˆ°ï¼Œæˆ‘å°±è‡ªå·±å…ˆå»äº†ğŸ¤£&lt;/p>
&lt;p>ä»Šå¹´å¥½åƒæ²¡æ€ä¹ˆè¯»ä¹¦ï¼Œé‚£æ˜å¹´è¦å¤šè¯»å‡ æœ¬ä¹¦ï¼Œæˆ–è€…ç¿»ç¿»ä»¥å‰è¯»çš„ä¹¦ã€‚ä¸ºæ•…è€ŒçŸ¥æ–°å˜›ã€‚&lt;/p>
&lt;p>&lt;strong>Good luck next year&lt;/strong>&lt;/p></description></item><item><title>C++ä¸­åŠ¨æ€åŠ è½½å…±äº«åº“ï¼Œä½¿ç”¨.so/dllæ–‡ä»¶ã€‚è¯¦ç»†è®²è§£ç¼–è¯‘æ—¶é“¾æ¥ä¸è¿è¡Œæ—¶åŠ¨æ€åŠ è½½çš„åŒºåˆ«</title><link>https://lqxhub.github.io/posts/b810e905/</link><pubDate>Sat, 22 Jul 2023 21:56:18 +0000</pubDate><guid>https://lqxhub.github.io/posts/b810e905/</guid><description>&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/7e0d79d47f0173b9b7a0c351c5d719303aa0f0e8.png" alt="Featured image of post C++ä¸­åŠ¨æ€åŠ è½½å…±äº«åº“ï¼Œä½¿ç”¨.so/dllæ–‡ä»¶ã€‚è¯¦ç»†è®²è§£ç¼–è¯‘æ—¶é“¾æ¥ä¸è¿è¡Œæ—¶åŠ¨æ€åŠ è½½çš„åŒºåˆ«" />&lt;p>åœ¨C++ä½¿ç”¨åŠ¨æ€åº“ï¼Œ(linuxä¸‹æ˜¯&lt;code>.so&lt;/code>ï¼Œwindowsä¸‹æ˜¯&lt;code>.dll&lt;/code>) æ¯”è¾ƒå¸¸è§çš„æ–¹å¼æ˜¯åœ¨ç¼–è¯‘æ—¶ï¼Œç›´æ¥è¿æ¥åˆ°ç¨‹åºä¸­ã€‚ä½†æ˜¯é™¤äº†è¿™ç§æ–¹å¼å¤–ï¼Œè¿˜å¯ä»¥ä½¿ç”¨çš„åŠ¨æ€åŠ è½½çš„æ–¹å¼å»ä½¿ç”¨åŠ¨æ€åº“ã€‚&lt;/p>
&lt;h2 id="ä¸¤ç§æ–¹å¼çš„åŒºåˆ«">&lt;a href="#%e4%b8%a4%e7%a7%8d%e6%96%b9%e5%bc%8f%e7%9a%84%e5%8c%ba%e5%88%ab" class="header-anchor">&lt;/a>ä¸¤ç§æ–¹å¼çš„åŒºåˆ«
&lt;/h2>&lt;ul>
&lt;li>
&lt;p>åœ¨ç¼–è¯‘æ—¶æŠŠåº“è¿æ¥åˆ°ç¨‹åºï¼šè¿™ç§æ–¹å¼æ˜¯åœ¨ç¼–è¯‘çš„æ—¶å€™ï¼Œå°±ç¡®å®šäº†è¦é“¾æ¥çš„åº“æ–‡ä»¶ï¼Œç„¶åé€šè¿‡ç¼–è¯‘å‚æ•°åœ¨é“¾æ¥æ—¶ç›´æ¥æŠŠåŠ¨æ€åº“çš„åœ°å€ç©ºé—´ç­‰ç­‰ä¿¡æ¯è¿æ¥åˆ°ç¨‹åºä¸­ã€‚ç¨‹åºåœ¨è¿è¡Œæ—¶ï¼Œå¯ä»¥ç›´æ¥æ ¹æ®è·¯å¾„å»å¯»æ‰¾åŠ¨æ€åº“ï¼Œç„¶ååŠ è½½åˆ°ç¨‹åºä¸­ï¼Œç„¶åè¿è¡Œï¼Œè¿™ç§æ–¹å¼åœ¨æ—¥å¸¸å¼€å‘ä¸­ç”¨çš„æ¯”è¾ƒå¤šã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>åœ¨ç¨‹åºè¿è¡Œæ—¶åŠ¨æ€åŠ è½½åº“ï¼šè¿™ç§æ–¹å¼æ˜¯åœ¨ç¨‹åºè¿è¡Œæ—¶ï¼Œé€šè¿‡è°ƒç”¨ç³»ç»Ÿå‡½æ•°ï¼ŒæŠŠåŠ¨æ€åº“åŠ è½½åˆ°ç¨‹åºä¸­ï¼Œç„¶åæ‰§è¡ŒåŠ¨æ€åº“ä¸­çš„ä»£ç ã€‚è¿™ç§æ–¹å¼å’Œç¼–è¯‘æ—¶é“¾æ¥çš„ä¼˜åŠ¿æ˜¯å¯ä»¥åœ¨ç¨‹åºè¿è¡Œçš„è¿‡ç¨‹ä¸­åŠ¨æ€åŠ è½½å’Œå¸è½½åº“ã€‚å¯ä»¥åœ¨ä¸ä¿®æ”¹æºç¨‹åºçš„å‰æä¸‹ï¼Œä½¿ç”¨æ–°çš„åº“ã€‚è¿™ç§æ–¹å¼ï¼Œæ¯”è¾ƒå¸¸è§çš„åº”ç”¨æ˜¯ç¨‹åºçš„æ’ä»¶ç³»ç»Ÿã€‚è¿˜æœ‰ä¸€ä¸ªå°±æ˜¯æœåŠ¡å™¨çš„çƒ­æ›´å¯ä»¥ç”¨è¿™ä¸ªæ¥å®ç°ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>åœ¨ç¼–è¯‘æ—¶ä½¿ç”¨åŠ¨æ€åº“çš„ä¾‹å­&lt;a class="link" href="https://lqxhub.github.io/posts/a20c5e48/" target="_blank" rel="noopener"
>ä¼ é€é—¨&lt;/a>&lt;/p>
&lt;h2 id="åŠ¨æ€åŠ è½½åº“">&lt;a href="#%e5%8a%a8%e6%80%81%e5%8a%a0%e8%bd%bd%e5%ba%93" class="header-anchor">&lt;/a>åŠ¨æ€åŠ è½½åº“
&lt;/h2>&lt;p>ä¸åºŸè¯äº†ï¼Œç›´æ¥å¼€å§‹ä¸Šä»£ç &lt;/p>
&lt;p>åœ¨ç¨‹åºè¿è¡Œçš„è¿‡ç¨‹ä¸­åŠ¨æ€åŠ è½½åº“ï¼Œéœ€è¦ä¾èµ–æ“ä½œç³»ç»Ÿï¼Œæ‰€ä»¥åœ¨ä¸åŒçš„ç³»ç»Ÿä¸Šæœ‰ä¸åŒçš„ç³»ç»Ÿè°ƒç”¨å‡½æ•°ã€‚&lt;/p>
&lt;p>åœ¨&lt;code>linux&lt;/code> ä¸Šéœ€è¦ç”¨åˆ° &lt;code>dlopen&lt;/code> å‡½æ•°åŠ è½½åº“ï¼Œ&lt;code>dlclose&lt;/code> å‡½æ•°é‡Šæ”¾åº“ï¼Œ&lt;code>dlsym&lt;/code> å‡½æ•° æŸ¥æ‰¾åº“å‡½æ•°
éœ€è¦çš„å¤´æ–‡ä»¶ &lt;code>#include &amp;lt;dlfcn.h&amp;gt;&lt;/code>&lt;/p>
&lt;p>åœ¨&lt;code>windows&lt;/code> ä¸Šéœ€è¦ &lt;code>LoadLibrary&lt;/code> å®åŠ è½½åº“ï¼Œ&lt;code>FreeLibrary&lt;/code> å®é‡Šæ”¾åº“ï¼Œ&lt;code>GetProcAddress&lt;/code> å‡½æ•°æŸ¥æ‰¾åº“å‡½æ•°
éœ€è¦çš„å¤´æ–‡ä»¶ &lt;code>#include &amp;lt;windows.h&amp;gt;&lt;/code>&lt;/p>
&lt;h3 id="åŸºç±»åŠŸèƒ½">&lt;a href="#%e5%9f%ba%e7%b1%bb%e5%8a%9f%e8%83%bd" class="header-anchor">&lt;/a>åŸºç±»åŠŸèƒ½
&lt;/h3>&lt;p>åœ¨C++ä¸­å¯ä»¥é€šè¿‡å®šä¹‰ä¸€ä¸ªæŠ½è±¡ç±»æ¥ä½œä¸ºæ‰€æœ‰åº“çš„åŸºç±»ï¼Œæ‰€æœ‰çš„åº“æ–‡ä»¶éƒ½å®ç°è¿™ä¸ªåŸºç±»ï¼Œç„¶åé‡å†™åŸºç±»çš„çº¯è™šå‡½æ•°ã€‚å¯ä»¥åœ¨åŠ è½½åˆ°æ‰€æœ‰åº“åï¼Œéƒ½å¯ä»¥æŠŠåº“é‡Œçš„ç±»ä½œä¸ºæŠ½è±¡ç±»çš„æ´¾ç”Ÿç±»ã€‚&lt;/p>
&lt;p>å…ˆå®šä¹‰ä¸€ä¸ªåŸºç±» base.h&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-C++" data-lang="C++">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">#ifndef DLOAD_BASE_H
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span>&lt;span style="color:#ff79c6">#define DLOAD_BASE_H
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span>&lt;span style="color:#ff79c6">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span>&lt;span style="color:#6272a4">/**
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span>&lt;span style="color:#6272a4"> * å¿…é¡»å®ç° moduleName_create å‡½æ•°,æ¥åˆå§‹åŒ–å¯¹è±¡
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span>&lt;span style="color:#6272a4"> * extern &amp;#34;C&amp;#34; Base *module1_create() {
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span>&lt;span style="color:#6272a4"> * return new Module;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span>&lt;span style="color:#6272a4"> * }
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span>&lt;span style="color:#6272a4"> *
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span>&lt;span style="color:#6272a4"> * //å¿…é¡»å®ç° moduleName_destroy å‡½æ•°,æ¥å›æ”¶å¯¹è±¡
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span>&lt;span style="color:#6272a4"> * extern &amp;#34;C&amp;#34; void module1_destroy(Base *obj) {
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span>&lt;span style="color:#6272a4"> * delete obj;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span>&lt;span style="color:#6272a4"> * }
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span>&lt;span style="color:#6272a4"> */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17&lt;/span>&lt;span>&lt;span style="color:#ff79c6">class&lt;/span> &lt;span style="color:#50fa7b">Base&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18&lt;/span>&lt;span> &lt;span style="color:#ff79c6">public&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19&lt;/span>&lt;span> &lt;span style="color:#ff79c6">virtual&lt;/span> std&lt;span style="color:#ff79c6">::&lt;/span>string readLine(&lt;span style="color:#ff79c6">const&lt;/span> std&lt;span style="color:#ff79c6">::&lt;/span>string &lt;span style="color:#ff79c6">&amp;amp;&lt;/span>) &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21&lt;/span>&lt;span> &lt;span style="color:#ff79c6">virtual&lt;/span> &lt;span style="color:#ff79c6">~&lt;/span>Base() &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#ff79c6">default&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22&lt;/span>&lt;span>};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24&lt;/span>&lt;span>&lt;span style="color:#ff79c6">#endif &lt;/span>&lt;span style="color:#6272a4">//DLOAD_BASE_H
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™ä¸ªåŸºç±»çš„åŠŸèƒ½å¾ˆç®€å•ï¼Œåªæœ‰ä¸€ä¸ªçº¯è™šå‡½æ•°&lt;code>readLine&lt;/code> è¿™ä¸ªå‡½æ•°ä¼šä¼ å…¥ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œç„¶åè¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²&lt;/p>
&lt;p>æ³¨é‡Šä¸­çš„å“ªä¸¤ä¸ªå‡½æ•°ï¼Œåé¢ä¼šæœ‰è¯¦ç»†çš„ä»‹ç»&lt;/p>
&lt;h3 id="å®ç°ä¸€ä¸ªæ¨¡å—">&lt;a href="#%e5%ae%9e%e7%8e%b0%e4%b8%80%e4%b8%aa%e6%a8%a1%e5%9d%97" class="header-anchor">&lt;/a>å®ç°ä¸€ä¸ªæ¨¡å—
&lt;/h3>&lt;p>å¯ä»¥æŠŠä¸€ä¸ªåº“çœ‹åšæ˜¯ä¸€ä¸ªæ¨¡å—ï¼Œç°åœ¨å®ç°ä¸€ä¸ªæ¨¡å—&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-C++" data-lang="C++">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#6272a4">//ç®€å•çš„æ¨¡å— ä¾‹å­
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span>&lt;span style="color:#6272a4">//è½¬å¤§å†™
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span>&lt;span style="color:#ff79c6">#include&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;algorithm&amp;gt;&lt;/span>&lt;span style="color:#ff79c6">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span>&lt;span style="color:#ff79c6">#include&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;string&amp;gt;&lt;/span>&lt;span style="color:#ff79c6">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span>&lt;span style="color:#ff79c6">#include&lt;/span> &lt;span style="color:#ff79c6">&amp;#34;../base.h&amp;#34;&lt;/span>&lt;span style="color:#ff79c6">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span>&lt;span style="color:#ff79c6">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span>&lt;span style="color:#ff79c6">class&lt;/span> &lt;span style="color:#50fa7b">Module1&lt;/span> &lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#ff79c6">public&lt;/span> Base {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span> std&lt;span style="color:#ff79c6">::&lt;/span>string readLine(&lt;span style="color:#ff79c6">const&lt;/span> std&lt;span style="color:#ff79c6">::&lt;/span>string &lt;span style="color:#ff79c6">&amp;amp;&lt;/span>str) &lt;span style="color:#ff79c6">override&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span> std&lt;span style="color:#ff79c6">::&lt;/span>string str2(str);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span> std&lt;span style="color:#ff79c6">::&lt;/span>transform(str.begin(), str.end(), str2.begin(), &lt;span style="color:#ff79c6">::&lt;/span>toupper);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> str2;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span>};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16&lt;/span>&lt;span>&lt;span style="color:#6272a4">//å¿…é¡»å®ç° moduleName_create å‡½æ•°,æ¥åˆå§‹åŒ–å¯¹è±¡
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span>&lt;span style="color:#ff79c6">extern&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;C&amp;#34;&lt;/span> Base &lt;span style="color:#ff79c6">*&lt;/span>module1_create() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> &lt;span style="color:#ff79c6">new&lt;/span> Module1;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21&lt;/span>&lt;span>&lt;span style="color:#6272a4">//å¿…é¡»å®ç° moduleName_destroy å‡½æ•°,æ¥å›æ”¶å¯¹è±¡
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span>&lt;span style="color:#ff79c6">extern&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;C&amp;#34;&lt;/span> &lt;span style="color:#8be9fd">void&lt;/span> module1_destroy(Base &lt;span style="color:#ff79c6">*&lt;/span>obj) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23&lt;/span>&lt;span> &lt;span style="color:#ff79c6">delete&lt;/span> obj;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™ä¸ªåŠŸèƒ½éå¸¸ç®€å•ï¼ŒæŠŠä¼ å…¥çš„å­—ç¬¦ä¸²è½¬æˆå¤§å†™ï¼Œç„¶åè¿”å›&lt;/p>
&lt;ol>
&lt;li>&lt;strong>ä¸ºä»€ä¹ˆéœ€è¦ &lt;code>Base *module1_create()&lt;/code> å’Œ &lt;code>void module1_destroy(Base *obj)&lt;/code> è¿™ä¸¤ä¸ªå‡½æ•°&lt;/strong>&lt;/li>
&lt;/ol>
&lt;p>å› ä¸ºåœ¨æŠŠåº“åŠ è½½å®Œæˆåï¼Œéœ€è¦ä½¿ç”¨åº“é‡Œçš„å‡½æ•°ï¼Œä½†æ˜¯ä¸èƒ½ç›´æ¥æŸ¥æ‰¾C++çš„ç±»ï¼Œç„¶åå†åˆå§‹åŒ–å¯¹è±¡ï¼Œåªèƒ½åœ¨åº“é‡Œå®ŒæˆC++å¯¹è±¡çš„åˆå§‹åŒ–ï¼Œç„¶åè¿”å›å¯¹è±¡çš„æŒ‡é’ˆã€‚&lt;/p>
&lt;p>æ‰€ä»¥éœ€è¦åœ¨åº“é‡Œæœ‰å¯¹åº”çš„å‡½æ•°æ¥åˆå§‹åŒ–å¯¹è±¡å’Œå›æ”¶å¯¹è±¡ï¼Œæ‰€ä»¥å°±æœ‰äº†è¿™ä¸¤ä¸ªå‡½æ•°ã€‚&lt;/p>
&lt;ol start="2">
&lt;li>&lt;strong>ä¸ºä»€ä¹ˆè¦ &lt;code>extern &amp;quot;C&amp;quot;&lt;/code>&lt;/strong>&lt;/li>
&lt;/ol>
&lt;p>å› ä¸ºC++æœ‰å‡½æ•°é‡è½½çš„åŠŸèƒ½ï¼Œæ‰€ä»¥ç¼–è¯‘å™¨åœ¨ç¼–è¯‘ä»£ç çš„æ—¶å€™ï¼Œä¼šå¯¹å‡½æ•°é‡å‘½åã€‚ä½†æ˜¯å¯¹å‡½æ•°é‡å‘½åçš„è§„åˆ™ï¼Œæ²¡æœ‰ç»Ÿä¸€çš„æ ‡å‡†ï¼Œä¸åŒç¼–è¯‘å™¨æœ‰ä¸åŒçš„è§„åˆ™ã€‚åƒ &lt;code>module1_create&lt;/code> è¿™ä¸ªå‡½æ•°å¯èƒ½å°±è¢«é‡å‘½åæˆ &lt;code>_Z14module1_create&lt;/code>è¿™æ ·çš„å­—ç¬¦ä¸²ã€‚è¿™æ ·åé¢ä½¿ç”¨ &lt;code>dlsym&lt;/code> æˆ–è€… &lt;code>GetProcAddress&lt;/code> å‡½æ•°æŸ¥æ‰¾åº“é‡Œçš„å‡½æ•°æ—¶ï¼Œå°±æ²¡æ³•æ‰¾åˆ°å¯¹åº”çš„å‡½æ•°äº†ã€‚æ‰€ä»¥ä½¿ç”¨&lt;code>extern &amp;quot;C&amp;quot;&lt;/code> è®©ç¼–è¯‘å™¨ä½¿ç”¨Cçš„è§„åˆ™æ¥ç¼–è¯‘è¿™æ®µå‡½æ•°&lt;/p>
&lt;p>è‡³äºè¿™ä¸¤ä¸ªå‡½æ•°çš„åå­— &lt;code>module1_create&lt;/code> å’Œ &lt;code>module1_destroy&lt;/code> æ²¡æœ‰å¼ºåˆ¶çš„è¦æ±‚ï¼Œä½†æ˜¯è¦æœ‰ä¸€å®šçš„è§„èŒƒã€‚å¦åˆ™åœ¨åŠ è½½åˆ°åº“åï¼Œæ²¡æ³•æ ¹æ®å‡½æ•°åæŸ¥æ‰¾åˆ°å¯¹åº”çš„å‡½æ•°ã€‚è¿™é‡Œç”¨åˆ°çš„è§„åˆ™æ˜¯ &lt;code>æ¨¡å—å_create&lt;/code> å’Œ &lt;code>æ¨¡å—å_destroy&lt;/code>&lt;/p>
&lt;h3 id="åŠ è½½åº“">&lt;a href="#%e5%8a%a0%e8%bd%bd%e5%ba%93" class="header-anchor">&lt;/a>åŠ è½½åº“
&lt;/h3>&lt;p>ä¸‹é¢å¼€å§‹åŠ è½½åº“ï¼Œå› ä¸ºåœ¨åŒçš„ç³»ç»Ÿä¸‹ï¼ŒåŠ è½½åº“è°ƒç”¨çš„å‡½æ•°ä¸åŒï¼Œæ‰€ä»¥ä½¿ç”¨ å®æ¥å®Œæˆä¸ç”¨ç³»ç»Ÿä¸‹çš„æ¡ä»¶ç¼–è¯‘ï¼Œæœ€ç»ˆå®ŒæˆåŠ è½½åº“&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-C++" data-lang="C++">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#6272a4">//å£°æ˜åˆ›å»ºå¯¹è±¡çš„å‡½æ•°
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span>&lt;span style="color:#ff79c6">typedef&lt;/span> Base &lt;span style="color:#ff79c6">*&lt;/span>(&lt;span style="color:#ff79c6">*&lt;/span>create)();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span>&lt;span style="color:#6272a4">//å£°æ˜å›æ”¶å¯¹è±¡çš„å‡½æ•°
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span>&lt;span style="color:#ff79c6">typedef&lt;/span> &lt;span style="color:#50fa7b">void&lt;/span> (&lt;span style="color:#ff79c6">*&lt;/span>destroy)(Base &lt;span style="color:#ff79c6">*&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span>&lt;span style="color:#6272a4">//è°ƒç”¨ç³»ç»Ÿå‡½æ•°,åŠ è½½åŠ¨æ€åº“
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span>&lt;span style="color:#ff79c6">#ifdef _WIN32
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span>&lt;span style="color:#ff79c6">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span>HINSTANCE &lt;span style="color:#50fa7b">loadLib&lt;/span>(Base &lt;span style="color:#ff79c6">**&lt;/span>base, &lt;span style="color:#ff79c6">const&lt;/span> &lt;span style="color:#8be9fd">char&lt;/span> &lt;span style="color:#ff79c6">*&lt;/span>path, &lt;span style="color:#ff79c6">const&lt;/span> &lt;span style="color:#8be9fd">char&lt;/span> &lt;span style="color:#ff79c6">*&lt;/span>funName) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span> &lt;span style="color:#ff79c6">auto&lt;/span> handle &lt;span style="color:#ff79c6">=&lt;/span> LoadLibrary(path);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (&lt;span style="color:#ff79c6">!&lt;/span>handle) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> &lt;span style="color:#ff79c6">nullptr&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16&lt;/span>&lt;span> &lt;span style="color:#ff79c6">auto&lt;/span> cr &lt;span style="color:#ff79c6">=&lt;/span> (create) GetProcAddress(handle, funName);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (cr) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18&lt;/span>&lt;span> &lt;span style="color:#ff79c6">*&lt;/span>base &lt;span style="color:#ff79c6">=&lt;/span> cr();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> handle;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23&lt;/span>&lt;span>&lt;span style="color:#6272a4">//è°ƒç”¨ç³»ç»Ÿå‡½æ•°,å¸è½½åŠ¨æ€åº“
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span>&lt;span style="color:#8be9fd">void&lt;/span> &lt;span style="color:#50fa7b">freeLib&lt;/span>(HINSTANCE handle, Base &lt;span style="color:#ff79c6">*&lt;/span>obj, &lt;span style="color:#ff79c6">const&lt;/span> &lt;span style="color:#8be9fd">char&lt;/span> &lt;span style="color:#ff79c6">*&lt;/span>funName) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25&lt;/span>&lt;span> &lt;span style="color:#ff79c6">auto&lt;/span> free &lt;span style="color:#ff79c6">=&lt;/span> (destroy) GetProcAddress(handle, funName);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (free) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27&lt;/span>&lt;span> free(obj);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29&lt;/span>&lt;span> FreeLibrary(handle);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32&lt;/span>&lt;span>&lt;span style="color:#ff79c6">#else
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33&lt;/span>&lt;span>&lt;span style="color:#ff79c6">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34&lt;/span>&lt;span>&lt;span style="color:#8be9fd">void&lt;/span> &lt;span style="color:#ff79c6">*&lt;/span>&lt;span style="color:#50fa7b">loadLib&lt;/span>(Base &lt;span style="color:#ff79c6">**&lt;/span>base, &lt;span style="color:#ff79c6">const&lt;/span> &lt;span style="color:#8be9fd">char&lt;/span> &lt;span style="color:#ff79c6">*&lt;/span>path, &lt;span style="color:#ff79c6">const&lt;/span> &lt;span style="color:#8be9fd">char&lt;/span> &lt;span style="color:#ff79c6">*&lt;/span>funName) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35&lt;/span>&lt;span> &lt;span style="color:#ff79c6">auto&lt;/span> handle &lt;span style="color:#ff79c6">=&lt;/span> dlopen(path, RTLD_LAZY);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (&lt;span style="color:#ff79c6">!&lt;/span>handle) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> &lt;span style="color:#ff79c6">nullptr&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39&lt;/span>&lt;span> &lt;span style="color:#ff79c6">auto&lt;/span> cr &lt;span style="color:#ff79c6">=&lt;/span> (create) dlsym(handle, funName);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (cr) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41&lt;/span>&lt;span> &lt;span style="color:#ff79c6">*&lt;/span>base &lt;span style="color:#ff79c6">=&lt;/span> cr();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> handle;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46&lt;/span>&lt;span>&lt;span style="color:#6272a4">//è°ƒç”¨ç³»ç»Ÿå‡½æ•°,å¸è½½åŠ¨æ€åº“
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span>&lt;span style="color:#8be9fd">void&lt;/span> &lt;span style="color:#50fa7b">freeLib&lt;/span>(&lt;span style="color:#8be9fd">void&lt;/span> &lt;span style="color:#ff79c6">*&lt;/span>handle, Base &lt;span style="color:#ff79c6">*&lt;/span>obj, &lt;span style="color:#ff79c6">const&lt;/span> &lt;span style="color:#8be9fd">char&lt;/span> &lt;span style="color:#ff79c6">*&lt;/span>funName) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48&lt;/span>&lt;span> &lt;span style="color:#ff79c6">auto&lt;/span> free &lt;span style="color:#ff79c6">=&lt;/span> (destroy) dlsym(handle, funName);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (free) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50&lt;/span>&lt;span> free(obj);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">51&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">52&lt;/span>&lt;span> dlclose(handle);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">53&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">54&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">55&lt;/span>&lt;span>&lt;span style="color:#ff79c6">#endif
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>åœ¨ä»£ç æœ€å¼€å§‹çš„ä½ç½®ï¼Œé€šè¿‡ &lt;code>typedef&lt;/code> å£°æ˜äº†ä¸¤ä¸ªå‡½æ•°çš„æŒ‡é’ˆï¼Œåœ¨æŸ¥æ‰¾åˆ°å‡½æ•°åï¼ŒæŠŠå‡½æ•°å¼ºè½¬æˆå¯¹åº”çš„ç±»å‹ï¼Œæ‰èƒ½åœ¨åé¢ä½¿ç”¨&lt;/p>
&lt;h3 id="ä½¿ç”¨åº“">&lt;a href="#%e4%bd%bf%e7%94%a8%e5%ba%93" class="header-anchor">&lt;/a>ä½¿ç”¨åº“
&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-C++" data-lang="C++">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span>&lt;span style="color:#8be9fd">int&lt;/span> &lt;span style="color:#50fa7b">main&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span> std&lt;span style="color:#ff79c6">::&lt;/span>string libPath;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span>&lt;span style="color:#ff79c6">#ifdef _WIN32
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span>&lt;span style="color:#ff79c6">&lt;/span> libPath &lt;span style="color:#ff79c6">=&lt;/span> std&lt;span style="color:#ff79c6">::&lt;/span>string(&lt;span style="color:#f1fa8c">&amp;#34;./module/libmodule1&amp;#34;&lt;/span> &lt;span style="color:#ff79c6">+&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;.dll&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span>&lt;span style="color:#ff79c6">#else
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span>&lt;span style="color:#ff79c6">&lt;/span> libPath &lt;span style="color:#ff79c6">=&lt;/span> std&lt;span style="color:#ff79c6">::&lt;/span>string(&lt;span style="color:#f1fa8c">&amp;#34;./module/libmodule1&amp;#34;&lt;/span> &lt;span style="color:#ff79c6">+&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;.so&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span>&lt;span style="color:#ff79c6">#endif
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span>&lt;span style="color:#ff79c6">&lt;/span> Base &lt;span style="color:#ff79c6">*&lt;/span>module &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#ff79c6">nullptr&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span> &lt;span style="color:#ff79c6">auto&lt;/span> handle &lt;span style="color:#ff79c6">=&lt;/span> loadLib(&lt;span style="color:#ff79c6">&amp;amp;&lt;/span>module, libPath.c_str(), std&lt;span style="color:#ff79c6">::&lt;/span>string(&lt;span style="color:#f1fa8c">&amp;#34;module1_create&amp;#34;&lt;/span>).c_str());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (&lt;span style="color:#ff79c6">!&lt;/span>module) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span> std&lt;span style="color:#ff79c6">::&lt;/span>cout &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;load lib module1&amp;#34;&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34; fail&amp;#34;&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> std&lt;span style="color:#ff79c6">::&lt;/span>endl;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> &lt;span style="color:#bd93f9">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16&lt;/span>&lt;span> std&lt;span style="color:#ff79c6">::&lt;/span>cout &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> module&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>readLine(&lt;span style="color:#f1fa8c">&amp;#34;abc&amp;#34;&lt;/span>) &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> std&lt;span style="color:#ff79c6">::&lt;/span>endl;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ç°åœ¨åŸºæœ¬å°±å®Œæˆäº†ä¸€ä¸ªåŠ¨æ€åº“çš„åŠ¨æ€åŠ è½½è¿‡ç¨‹ã€‚å¦‚æœæƒ³è¦æ‹“å±•ï¼Œåªè¦å†æŒ‰ç…§è¿™ä¸ªè§„åˆ™ï¼Œå†™ä¸€ä¸ªæ–°çš„æ¨¡å—ç„¶ååŠ è½½ä¸Šæ¥å°±å¯ä»¥äº†ã€‚&lt;/p>
&lt;p>æœ€åæ”¾ä¸€ä¸ªç›¸å¯¹å®Œæ•´çš„åŠ¨æ€åŠ è½½çš„demoï¼Œ&lt;a class="link" href="https://github.com/lqxhub/dynamic-loading-lib" target="_blank" rel="noopener"
>github&lt;/a>&lt;/p></description></item><item><title>redisæºç å­¦ä¹ |ACLï¼Œç»†æ¢è®¨äº†Redis ACLçš„ä½œç”¨ã€å‘½ä»¤å’Œæƒé™è®¾ç½®ï¼Œä»¥åŠå¦‚ä½•åœ¨æºç å±‚é¢å®ç°ACLçš„åˆå§‹åŒ–ã€åŠ è½½å’Œé‰´æƒã€‚</title><link>https://lqxhub.github.io/posts/eeb1e692/</link><pubDate>Mon, 03 Jul 2023 21:07:02 +0000</pubDate><guid>https://lqxhub.github.io/posts/eeb1e692/</guid><description>&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/174339-62bacd4b7f65d.png" alt="Featured image of post redisæºç å­¦ä¹ |ACLï¼Œç»†æ¢è®¨äº†Redis ACLçš„ä½œç”¨ã€å‘½ä»¤å’Œæƒé™è®¾ç½®ï¼Œä»¥åŠå¦‚ä½•åœ¨æºç å±‚é¢å®ç°ACLçš„åˆå§‹åŒ–ã€åŠ è½½å’Œé‰´æƒã€‚" />&lt;p>Redis åœ¨6.0 ä¸­åŠ å…¥äº†ACLï¼ˆAccess Control List) çš„æ”¯æŒï¼Œåœ¨æ­¤å‰çš„ç‰ˆæœ¬ä¸­,Redisæ˜¯æ²¡æœ‰ç”¨æˆ·çš„æ¦‚å¿µçš„ï¼Œæ²¡æœ‰åŠæ³•å¾ˆå¥½çš„æ§åˆ¶æƒé™ï¼Œåœ¨6.0ä¸­åŠ å…¥äº†ç”¨æˆ·çš„æ¦‚å¿µï¼Œå¯ä»¥ç»™æ¯ä¸ªç”¨æˆ·åˆ†é…ä¸åŒçš„æƒé™æ¥æ§åˆ¶æƒé™ã€‚&lt;/p>
&lt;h2 id="aclä½œç”¨">&lt;a href="#acl%e4%bd%9c%e7%94%a8" class="header-anchor">&lt;/a>ACLä½œç”¨
&lt;/h2>&lt;ul>
&lt;li>ACLçš„ä½œç”¨å°±æ˜¯å¯¹ä¸åŒç”¨æˆ·çš„æƒé™åšé™åˆ¶ï¼Œé™åˆ¶ä¸åŒç”¨æˆ·çš„æƒé™ã€‚æ¯”å¦‚é™åˆ¶æŸäº›ç”¨æˆ·ä½¿ç”¨åˆ é™¤å‘½ä»¤ï¼Œé™åˆ¶æŸäº›ç”¨æˆ·åªèƒ½ä½¿ç”¨è¯»å‘½ä»¤ç­‰ç­‰ã€‚åœ¨ 6.0 ä¹‹å‰ï¼Œredisæ²¡æœ‰ç”¨æˆ·çš„æ¦‚å¿µï¼Œæ˜¯ä¸èƒ½åšå…·ä½“ç”¨æˆ·çš„é™åˆ¶çš„ï¼Œå¦‚æœæœ‰çš„ç”¨æˆ·æ‰§è¡Œäº† &lt;code>FLUSHALL&lt;/code> å‘½ä»¤ï¼Œé‚£ä¹ˆæ•´ä¸ªåº“çš„æ•°æ®éƒ½æ²¡æœ‰äº†ï¼Œè¿™æ ·æ˜¯æœ‰é£é™©çš„ã€‚&lt;/li>
&lt;/ul>
&lt;h2 id="aclå‘½ä»¤">&lt;a href="#acl%e5%91%bd%e4%bb%a4" class="header-anchor">&lt;/a>ACLå‘½ä»¤
&lt;/h2>&lt;p>redisè¿˜æ˜¯ä½¿ç”¨åŸæ¥çš„ &lt;code>AUTH&lt;/code> å‘½ä»¤æ¥è¿›è¡Œè®¤è¯ï¼Œè¿™ä¸ªå‘½ä»¤åšäº†å¯¹ä½ç‰ˆæœ¬çš„å…¼å®¹&lt;/p>
&lt;ul>
&lt;li>6.0 åŠä»¥åç‰ˆæœ¬ &lt;code>AUTH &amp;lt;username&amp;gt; &amp;lt;password&amp;gt;&lt;/code>&lt;/li>
&lt;li>6.0 ä¹‹å‰ç‰ˆæœ¬ &lt;code>AUTH &amp;lt;password&amp;gt;&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>åœ¨ä½¿ç”¨ &lt;code>AUTH &amp;lt;password&amp;gt;&lt;/code> è¿™ä¸ªå‘½ä»¤æ—¶ï¼Œä½¿ç”¨çš„æ˜¯redisçš„é»˜è®¤ç”¨æˆ·ï¼Œredis ACL ä¸­åˆå§‹åŒ–äº†ä¸€ä¸ªé»˜è®¤ç”¨æˆ·&lt;code>default&lt;/code> è¿™æ ·å°±å®ç°äº†å¯¹ä½ç‰ˆæœ¬çš„å…¼å®¹ã€‚åœ¨ &lt;code>6.0&lt;/code> ä»¥åçš„ç‰ˆæœ¬ä¸­ä½¿ç”¨ &lt;code>AUTH &amp;lt;password&amp;gt;&lt;/code> è¿™ä¸ªå‘½ä»¤æ—¶ï¼Œå®é™…ä¸Šæ˜¯å¯¹defaultç”¨æˆ·åšäº†è®¤è¯ã€‚&lt;/p>
&lt;p>ACLæ˜¯ä½¿ç”¨ DSLï¼ˆdomain specific languageï¼‰å®šä¹‰çš„ï¼Œè¯¥ DSL æè¿°äº†ç»™å®šç”¨æˆ·èƒ½å¤Ÿæ‰§è¡Œçš„æ“ä½œã€‚æ­¤ç±»è§„åˆ™å§‹ç»ˆä»å·¦åˆ°å³ä»ç¬¬ä¸€ä¸ªåˆ°æœ€åä¸€ä¸ªå®æ–½ï¼Œå› ä¸ºæœ‰æ—¶è§„åˆ™çš„é¡ºåºå¯¹äºç†è§£ç”¨æˆ·çš„å®é™…èƒ½åŠ›å¾ˆé‡è¦ã€‚&lt;/p>
&lt;p>ACL ç®€å•çš„è¯­æ³•&lt;/p>
&lt;p>çœ‹ä¸€ä¸‹å½“å‰ç”¨æˆ·&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>127.0.0.1:6379&amp;gt; acl list
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span>1&lt;span style="color:#ff79c6">)&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;user default on nopass ~* &amp;amp;* +@all&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>&lt;code>default&lt;/code> ç”¨æˆ·å&lt;/li>
&lt;li>&lt;code>on&lt;/code> è¡¨ç¤ºç”¨æˆ·æ˜¯æ¿€æ´»çš„ï¼Œå¦‚æœæ˜¯ &lt;code>off&lt;/code>é‚£ä¹ˆè¿™ä¸ªç”¨æˆ·æ— æ³•é€šè¿‡ &lt;code>AUTH&lt;/code> å‘½ä»¤&lt;/li>
&lt;li>&lt;code>nopass&lt;/code> è¡¨ç¤ºè¿™ä¸ªç”¨æˆ·æ²¡æœ‰å¯†ç &lt;/li>
&lt;li>&lt;code>~*&lt;/code> è¡¨ç¤ºå¯ä»¥è®¿é—®çš„Keyï¼ˆæ­£åˆ™åŒ¹é…ï¼‰&lt;/li>
&lt;li>&lt;code>&amp;amp;*&lt;/code> 6.2 åŠ å…¥çš„ï¼Œè¡¨ç¤ºchannelçš„æƒé™&lt;/li>
&lt;li>&lt;code>+@&lt;/code> è¡¨ç¤ºç”¨æˆ·çš„æƒé™ï¼Œâ€œ+â€è¡¨ç¤ºæˆæƒæƒé™ï¼Œæœ‰æƒé™æ“ä½œæˆ–è®¿é—®ï¼Œâ€œ-â€è¡¨ç¤ºè¿˜æ˜¯æ²¡æœ‰æƒé™ï¼› @ä¸ºæƒé™åˆ†ç±»ï¼Œå¯ä»¥é€šè¿‡Â &lt;code>ACL CAT&lt;/code>Â æŸ¥è¯¢æ”¯æŒçš„åˆ†ç±»ã€‚+@all è¡¨ç¤ºæ‰€æœ‰æƒé™ï¼Œnocommands è¡¨ç¤ºä¸ç»™ä¸ä»»ä½•å‘½ä»¤çš„æ“ä½œæƒé™&lt;/li>
&lt;/ul>
&lt;p>ç”¨æˆ·æƒé™åˆ†ç±»&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-fallback" data-lang="fallback">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span> &amp;#34;keyspace&amp;#34;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span> &amp;#34;read&amp;#34;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span> &amp;#34;write&amp;#34;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span> &amp;#34;set&amp;#34;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span> &amp;#34;sortedset&amp;#34;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span> &amp;#34;list&amp;#34;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span> &amp;#34;hash&amp;#34;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span> &amp;#34;string&amp;#34;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span> &amp;#34;bitmap&amp;#34;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span> &amp;#34;hyperloglog&amp;#34;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span> &amp;#34;geo&amp;#34;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span> &amp;#34;stream&amp;#34;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span> &amp;#34;pubsub&amp;#34;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span> &amp;#34;admin&amp;#34;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15&lt;/span>&lt;span> &amp;#34;fast&amp;#34;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16&lt;/span>&lt;span> &amp;#34;slow&amp;#34;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17&lt;/span>&lt;span> &amp;#34;blocking&amp;#34;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18&lt;/span>&lt;span> &amp;#34;dangerous&amp;#34;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19&lt;/span>&lt;span> &amp;#34;connection&amp;#34;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20&lt;/span>&lt;span> &amp;#34;transaction&amp;#34;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21&lt;/span>&lt;span> &amp;#34;scripting&amp;#34;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è‡³äºæ€ä¹ˆæ“ä½œï¼Œä¸æ˜¯è¿™æ¬¡çš„é‡ç‚¹ï¼Œç›´æ¥å»çœ‹å®˜æ–¹æ–‡æ¡£å°±å¥½äº† &lt;a class="link" href="https://redis.io/docs/management/security/acl/" target="_blank" rel="noopener"
>redis acl&lt;/a>&lt;/p>
&lt;h2 id="aclæºç ">&lt;a href="#acl%e6%ba%90%e7%a0%81" class="header-anchor">&lt;/a>ACLæºç 
&lt;/h2>&lt;p>å¼€å§‹ä¸Šæºç äº†ï¼Œæœ¬æ¬¡æºç åŸºäºredisçš„ 7.0.11ç‰ˆæœ¬ï¼Œä¸åŒçš„ç‰ˆæœ¬ä¹‹é—´å¯èƒ½æœ‰å·®å¼‚ã€‚&lt;/p>
&lt;h3 id="aclç›¸å…³çš„æ•°æ®ç»“æ„">&lt;a href="#acl%e7%9b%b8%e5%85%b3%e7%9a%84%e6%95%b0%e6%8d%ae%e7%bb%93%e6%9e%84" class="header-anchor">&lt;/a>ACLç›¸å…³çš„æ•°æ®ç»“æ„
&lt;/h3>&lt;p>ACLé‰´æƒå¯¹åº”çš„æ˜¯ä¸€ä¸ª&lt;code>User&lt;/code>ï¼Œå…ˆçœ‹ä¸€ä¸‹&lt;code>User&lt;/code>å’Œç›¸å…³çš„&lt;code>selector&lt;/code>çš„å®šä¹‰&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-C" data-lang="C">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">typedef&lt;/span> &lt;span style="color:#ff79c6">struct&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span> &lt;span style="color:#6272a4">//ç”¨æˆ·å
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> sds name; &lt;span style="color:#6272a4">/* The username as an SDS string. */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span> &lt;span style="color:#6272a4">//ç”¨æˆ·çš„flag,ç”¨æ¥åšå„ç§æ¯”å¯¹
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#8be9fd">uint32_t&lt;/span> flags; &lt;span style="color:#6272a4">/* See USER_FLAG_* */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span> &lt;span style="color:#6272a4">//è¿™ä¸ªç”¨æˆ·çš„å¯†ç ï¼Œä¸€ä¸ªç”¨æˆ·å¯ä»¥æœ‰å¤šä¸ªå¯†ç ï¼Œæ‰€ä»¥æ˜¯ç”¨é“¾è¡¨ä¿å­˜çš„
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#6272a4">//è¿™ä¸ªé“¾è¡¨çš„nodeæ˜¯ä¸€ä¸ªæ˜æ–‡å¯†ç ç»è¿‡ `SHA256` è®¡ç®—è¿‡åçš„ å­—ç¬¦ä¸²
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> list &lt;span style="color:#ff79c6">*&lt;/span>passwords; &lt;span style="color:#6272a4">/* A list of SDS valid passwords for this user. */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span> &lt;span style="color:#6272a4">//éªŒè¯ç”¨æˆ·æƒé™çš„é€‰æ‹©å™¨ï¼Œè¯¥ç”¨æˆ·çš„æƒé™ä¿å­˜åœ¨è¿™ä¸ªé“¾è¡¨ä¸­
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> list &lt;span style="color:#ff79c6">*&lt;/span>selectors; &lt;span style="color:#6272a4">/* A list of selectors this user validates commands
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span>&lt;span style="color:#6272a4"> against. This list will always contain at least
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15&lt;/span>&lt;span>&lt;span style="color:#6272a4"> one selector for backwards compatibility. */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16&lt;/span>&lt;span> &lt;span style="color:#6272a4">//ç¼“å­˜ACLå‘½ä»¤çš„å­—ç¬¦ä¸²
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> robj &lt;span style="color:#ff79c6">*&lt;/span>acl_string; &lt;span style="color:#6272a4">/* cached string represent of ACLs */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18&lt;/span>&lt;span>} user;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21&lt;/span>&lt;span>&lt;span style="color:#6272a4">//userä¸­ `selectors` é“¾è¡¨ä¸­çš„ç»“æ„
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span>&lt;span style="color:#ff79c6">typedef&lt;/span> &lt;span style="color:#ff79c6">struct&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23&lt;/span>&lt;span> &lt;span style="color:#6272a4">//è¿™ä¸ª selectors çš„flag
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#8be9fd">uint32_t&lt;/span> flags; &lt;span style="color:#6272a4">/* See SELECTOR_FLAG_* */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26&lt;/span>&lt;span> &lt;span style="color:#6272a4">/* The bit in allowed_commands is set if this user has the right to
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27&lt;/span>&lt;span>&lt;span style="color:#6272a4"> * execute this command.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28&lt;/span>&lt;span>&lt;span style="color:#6272a4"> * If the bit for a given command is NOT set and the command has
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29&lt;/span>&lt;span>&lt;span style="color:#6272a4"> * allowed first-args, Redis will also check allowed_firstargs in order to
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30&lt;/span>&lt;span>&lt;span style="color:#6272a4"> * understand if the command can be executed. */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32&lt;/span>&lt;span> &lt;span style="color:#6272a4">//ä½¿ç”¨ bit è®°å½•å…è®¸çš„å‘½ä»¤
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#8be9fd">uint64_t&lt;/span> allowed_commands[USER_COMMAND_BITS_COUNT&lt;span style="color:#ff79c6">/&lt;/span>&lt;span style="color:#bd93f9">64&lt;/span>];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35&lt;/span>&lt;span> &lt;span style="color:#6272a4">/* allowed_firstargs is used by ACL rules to block access to a command unless a
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36&lt;/span>&lt;span>&lt;span style="color:#6272a4"> * specific argv[1] is given.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37&lt;/span>&lt;span>&lt;span style="color:#6272a4"> *
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38&lt;/span>&lt;span>&lt;span style="color:#6272a4"> * For each command ID (corresponding to the command bit set in allowed_commands),
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39&lt;/span>&lt;span>&lt;span style="color:#6272a4"> * This array points to an array of SDS strings, terminated by a NULL pointer,
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40&lt;/span>&lt;span>&lt;span style="color:#6272a4"> * with all the first-args that are allowed for this command. When no first-arg
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41&lt;/span>&lt;span>&lt;span style="color:#6272a4"> * matching is used, the field is just set to NULL to avoid allocating
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42&lt;/span>&lt;span>&lt;span style="color:#6272a4"> * USER_COMMAND_BITS_COUNT pointers. */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44&lt;/span>&lt;span> sds &lt;span style="color:#ff79c6">**&lt;/span>allowed_firstargs;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46&lt;/span>&lt;span> &lt;span style="color:#6272a4">//redis key åŒ¹é…è§„åˆ™çš„å­—ç¬¦ä¸²é“¾è¡¨
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> list &lt;span style="color:#ff79c6">*&lt;/span>patterns; &lt;span style="color:#6272a4">/* A list of allowed key patterns. If this field is NULL
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48&lt;/span>&lt;span>&lt;span style="color:#6272a4"> the user cannot mention any key in a command, unless
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49&lt;/span>&lt;span>&lt;span style="color:#6272a4"> the flag ALLKEYS is set in the user. */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">51&lt;/span>&lt;span> &lt;span style="color:#6272a4">//redis channels è§„åˆ™çš„å­—ç¬¦ä¸² é“¾è¡¨
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">52&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> list &lt;span style="color:#ff79c6">*&lt;/span>channels; &lt;span style="color:#6272a4">/* A list of allowed Pub/Sub channel patterns. If this
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">53&lt;/span>&lt;span>&lt;span style="color:#6272a4"> field is NULL the user cannot mention any channel in a
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">54&lt;/span>&lt;span>&lt;span style="color:#6272a4"> `PUBLISH` or [P][UNSUBSCRIBE] command, unless the flag
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">55&lt;/span>&lt;span>&lt;span style="color:#6272a4"> ALLCHANNELS is set in the user. */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">56&lt;/span>&lt;span>} aclSelector;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">57&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">58&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">59&lt;/span>&lt;span>&lt;span style="color:#6272a4">/* Structure used for handling key patterns with different key
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">60&lt;/span>&lt;span>&lt;span style="color:#6272a4"> * based permissions. */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">61&lt;/span>&lt;span>&lt;span style="color:#6272a4">//`aclSelector` ä¸­ patterns é“¾è¡¨ä¸­çš„ç»“æ„
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">62&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span>&lt;span style="color:#ff79c6">typedef&lt;/span> &lt;span style="color:#ff79c6">struct&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">63&lt;/span>&lt;span> &lt;span style="color:#8be9fd">int&lt;/span> flags; &lt;span style="color:#6272a4">/* The CMD_KEYS_* flags for this key pattern */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">64&lt;/span>&lt;span> sds pattern; &lt;span style="color:#6272a4">/* The pattern to match keys against */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">65&lt;/span>&lt;span>} keyPattern;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;a class="link" href="https://github.com/redis/redis/blob/391aa4079c0855aa20929b1e272403937e874d57/src/server.h#L1049" target="_blank" rel="noopener"
>useræºç &lt;/a>&lt;/p>
&lt;p>&lt;a class="link" href="https://github.com/redis/redis/blob/391aa4079c0855aa20929b1e272403937e874d57/src/acl.c#L113" target="_blank" rel="noopener"
>aclSelectoræºç &lt;/a>&lt;/p>
&lt;p>&lt;code>aclSelector&lt;/code> ç»“æ„å…ˆæœ‰ä¸ªå¤§æ¦‚çš„äº†è§£å³å¯ï¼Œåé¢åœ¨æƒé™æ ¡éªŒçš„é‚£éƒ¨åˆ†ä¼šæœ‰è¯¦ç»†çš„åˆ†æ&lt;/p>
&lt;h3 id="aclçš„åˆå§‹åŒ–">&lt;a href="#acl%e7%9a%84%e5%88%9d%e5%a7%8b%e5%8c%96" class="header-anchor">&lt;/a>ACLçš„åˆå§‹åŒ–
&lt;/h3>&lt;p>ACLçš„åˆå§‹åŒ–åœ¨&lt;code>ACLInit&lt;/code>å‡½æ•°ä¸­å®Œæˆ&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-C" data-lang="C">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>&lt;span style="color:#8be9fd">void&lt;/span> &lt;span style="color:#50fa7b">ACLInit&lt;/span>(&lt;span style="color:#8be9fd">void&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span> Users &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#50fa7b">raxNew&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3&lt;/span>&lt;span> UsersToLoad &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#50fa7b">listCreate&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4&lt;/span>&lt;span> &lt;span style="color:#50fa7b">listSetMatchMethod&lt;/span>(UsersToLoad, ACLListMatchLoadedUser);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5&lt;/span>&lt;span> ACLLog &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#50fa7b">listCreate&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6&lt;/span>&lt;span> DefaultUser &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#50fa7b">ACLCreateDefaultUser&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;a class="link" href="https://github.com/redis/redis/blob/391aa4079c0855aa20929b1e272403937e874d57/src/acl.c#L1379-L1380" target="_blank" rel="noopener"
>ACLInit&lt;/a>&lt;/p>
&lt;p>&lt;code>ACLInit&lt;/code>è¿™ä¸ªå‡½æ•°åœ¨ &lt;code>main&lt;/code> å‡½æ•°ä¸­è¢«è°ƒç”¨ï¼Œä¹Ÿå°±æ˜¯åœ¨rediså¯åŠ¨çš„æ—¶å€™ï¼Œå°±ä¼šåˆå§‹åŒ–ACLçš„æ•°æ®ç»“æ„&lt;/p>
&lt;p>æ‰€æœ‰çš„ç”¨æˆ·éƒ½å­˜åœ¨&lt;code>Users&lt;/code>è¿™ä¸ªå…¨å±€å˜é‡ä¸­ï¼Œè¿™ä¸ªå˜é‡æ˜¯&lt;code>rax&lt;/code>ç±»å‹çš„&lt;/p>
&lt;p>&lt;code>UsersToLoad&lt;/code> è®°å½•äº†ä»é…ç½®æ–‡ä»¶ä¸­åŠ è½½çš„ç”¨æˆ·&lt;/p>
&lt;p>&lt;code>ACLLog&lt;/code> ACLæ“ä½œç›¸å…³çš„log&lt;/p>
&lt;p>&lt;code>DefaultUser&lt;/code> ç‰¹æ®Šçš„ç”¨æˆ·ï¼Œ&lt;code>default&lt;/code>ç”¨æˆ·&lt;/p>
&lt;p>ä¼šä½¿ç”¨ &lt;code>ACLCreateDefaultUser&lt;/code> è¿™ä¸ªå‡½æ•°åˆå§‹åŒ–defaultè¿™ä¸ªç”¨æˆ·&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-C" data-lang="C">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>user &lt;span style="color:#ff79c6">*&lt;/span>&lt;span style="color:#50fa7b">ACLCreateDefaultUser&lt;/span>(&lt;span style="color:#8be9fd">void&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span> user &lt;span style="color:#ff79c6">*&lt;/span>new &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#50fa7b">ACLCreateUser&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;default&amp;#34;&lt;/span>,&lt;span style="color:#bd93f9">7&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3&lt;/span>&lt;span> &lt;span style="color:#50fa7b">ACLSetUser&lt;/span>(new,&lt;span style="color:#f1fa8c">&amp;#34;+@all&amp;#34;&lt;/span>,&lt;span style="color:#ff79c6">-&lt;/span>&lt;span style="color:#bd93f9">1&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4&lt;/span>&lt;span> &lt;span style="color:#50fa7b">ACLSetUser&lt;/span>(new,&lt;span style="color:#f1fa8c">&amp;#34;~*&amp;#34;&lt;/span>,&lt;span style="color:#ff79c6">-&lt;/span>&lt;span style="color:#bd93f9">1&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5&lt;/span>&lt;span> &lt;span style="color:#50fa7b">ACLSetUser&lt;/span>(new,&lt;span style="color:#f1fa8c">&amp;#34;&amp;amp;*&amp;#34;&lt;/span>,&lt;span style="color:#ff79c6">-&lt;/span>&lt;span style="color:#bd93f9">1&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6&lt;/span>&lt;span> &lt;span style="color:#50fa7b">ACLSetUser&lt;/span>(new,&lt;span style="color:#f1fa8c">&amp;#34;on&amp;#34;&lt;/span>,&lt;span style="color:#ff79c6">-&lt;/span>&lt;span style="color:#bd93f9">1&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7&lt;/span>&lt;span> &lt;span style="color:#50fa7b">ACLSetUser&lt;/span>(new,&lt;span style="color:#f1fa8c">&amp;#34;nopass&amp;#34;&lt;/span>,&lt;span style="color:#ff79c6">-&lt;/span>&lt;span style="color:#bd93f9">1&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> new;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">9&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;a class="link" href="https://github.com/redis/redis/blob/391aa4079c0855aa20929b1e272403937e874d57/src/acl.c#L1368" target="_blank" rel="noopener"
>ACLCreateDefaultUser&lt;/a>&lt;/p>
&lt;p>åˆ›å»ºä¸€ä¸ªç”¨æˆ·æ˜¯åœ¨&lt;code>ACLCreateUser&lt;/code> è¿™ä¸ªå‡½æ•°ä¸­å®Œæˆçš„&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-C" data-lang="C">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>user &lt;span style="color:#ff79c6">*&lt;/span>&lt;span style="color:#50fa7b">ACLCreateUser&lt;/span>(&lt;span style="color:#ff79c6">const&lt;/span> &lt;span style="color:#8be9fd">char&lt;/span> &lt;span style="color:#ff79c6">*&lt;/span>name, &lt;span style="color:#8be9fd">size_t&lt;/span> namelen) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span> &lt;span style="color:#6272a4">//å…ˆåˆ¤æ–­ä¸€ä¸‹è¿™ä¸ªé±¼æŠ¤æ˜¯å¦å­˜åœ¨,å¦‚æœå­˜åœ¨äº†ç›´æ¥return
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">if&lt;/span> (&lt;span style="color:#50fa7b">raxFind&lt;/span>(Users,(&lt;span style="color:#8be9fd">unsigned&lt;/span> &lt;span style="color:#8be9fd">char&lt;/span>&lt;span style="color:#ff79c6">*&lt;/span>)name,namelen) &lt;span style="color:#ff79c6">!=&lt;/span> raxNotFound) &lt;span style="color:#ff79c6">return&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">NULL&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span> user &lt;span style="color:#ff79c6">*&lt;/span>u &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#50fa7b">zmalloc&lt;/span>(&lt;span style="color:#ff79c6">sizeof&lt;/span>(&lt;span style="color:#ff79c6">*&lt;/span>u));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span> u&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>name &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#50fa7b">sdsnewlen&lt;/span>(name,namelen);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span> &lt;span style="color:#6272a4">//æ–°åˆ›å»ºçš„ç”¨æˆ·é»˜è®¤éƒ½æ˜¯ä¸èƒ½ä½¿ç”¨çš„
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> u&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>flags &lt;span style="color:#ff79c6">=&lt;/span> USER_FLAG_DISABLED;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span> u&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>passwords &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#50fa7b">listCreate&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span> u&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>acl_string &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">NULL&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span> &lt;span style="color:#50fa7b">listSetMatchMethod&lt;/span>(u&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>passwords,ACLListMatchSds);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span> &lt;span style="color:#50fa7b">listSetFreeMethod&lt;/span>(u&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>passwords,ACLListFreeSds);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span> &lt;span style="color:#50fa7b">listSetDupMethod&lt;/span>(u&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>passwords,ACLListDupSds);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span> u&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>selectors &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#50fa7b">listCreate&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15&lt;/span>&lt;span> &lt;span style="color:#50fa7b">listSetFreeMethod&lt;/span>(u&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>selectors,ACLListFreeSelector);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16&lt;/span>&lt;span> &lt;span style="color:#50fa7b">listSetDupMethod&lt;/span>(u&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>selectors,ACLListDuplicateSelector);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18&lt;/span>&lt;span> &lt;span style="color:#6272a4">/* Add the initial root selector */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19&lt;/span>&lt;span> aclSelector &lt;span style="color:#ff79c6">*&lt;/span>s &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#50fa7b">ACLCreateSelector&lt;/span>(SELECTOR_FLAG_ROOT);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20&lt;/span>&lt;span> &lt;span style="color:#50fa7b">listAddNodeHead&lt;/span>(u&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>selectors, s);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22&lt;/span>&lt;span> &lt;span style="color:#50fa7b">raxInsert&lt;/span>(Users,(&lt;span style="color:#8be9fd">unsigned&lt;/span> &lt;span style="color:#8be9fd">char&lt;/span>&lt;span style="color:#ff79c6">*&lt;/span>)name,namelen,u,&lt;span style="color:#8be9fd;font-style:italic">NULL&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> u;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;a class="link" href="https://github.com/redis/redis/blob/391aa4079c0855aa20929b1e272403937e874d57/src/acl.c#L382" target="_blank" rel="noopener"
>ACLCreateUser&lt;/a>&lt;/p>
&lt;p>åˆ°è¿™ï¼Œ&lt;code>default&lt;/code> ç”¨æˆ·çš„åˆå§‹åŒ–å°±å®Œæˆäº†&lt;/p>
&lt;p>åé¢ä¼šä»é…ç½®æ–‡ä»¶ä¸­åŠ è½½å…¶ä»–ç”¨æˆ·çš„æ•°æ®ï¼Œå®Œæˆå…¶ä»–ç”¨æˆ·çš„åˆå§‹åŒ–&lt;/p>
&lt;p>åœ¨&lt;code>main&lt;/code> å‡½æ•°ä¸­è°ƒç”¨ &lt;code>ACLLoadUsersAtStartup&lt;/code> å®Œæˆä»é…ç½®æ–‡ä»¶ä¸­åŠ è½½ç”¨æˆ·&lt;/p>
&lt;p>åœ¨æ­¤ä¹‹å‰ä¼šå…ˆä½¿ç”¨&lt;code>ACLAppendUserForLoading&lt;/code> å‡½æ•°å®Œæˆä» &lt;code>redis.conf&lt;/code> ä¸­åŠ è½½ç”¨æˆ·ã€‚å› ä¸ºredisä¸­çš„ç”¨æˆ·æ—¢å¯ä»¥é…ç½®åœ¨redis.confä¸­ï¼Œä¹Ÿå¯ä»¥é…ç½®åœ¨ä¸€ä¸ªå•ç‹¬çš„ACLæ–‡ä»¶ä¸­ï¼ˆä¸¤è€…åªèƒ½é€‰æ‹©å…¶ä¸­ä¸€ä¸ªï¼Œä¸èƒ½åŒæ—¶å¯ç”¨ï¼‰ã€‚è¿™ä¸ªå‡½æ•°æ˜¯ä»&lt;code>redis.conf&lt;/code>ä¸­åŠ è½½ç”¨æˆ·&lt;/p>
&lt;p>æœ€ç»ˆæŠŠä»é…ç½®æ–‡ä»¶ä¸­åŠ è½½çš„ç”¨æˆ·éƒ½æ”¾åˆ°&lt;code>UsersToLoad&lt;/code> è¿™ä¸ªé“¾è¡¨ä¸­&lt;/p>
&lt;p>&lt;a class="link" href="https://github.com/redis/redis/blob/391aa4079c0855aa20929b1e272403937e874d57/src/acl.c#L2056" target="_blank" rel="noopener"
>ACLAppendUserForLoading&lt;/a>&lt;/p>
&lt;p>å®ŒæˆåŠ è½½åï¼Œä¼šè°ƒç”¨&lt;code>ACLLoadUsersAtStartup&lt;/code> å®Œæˆç”¨æˆ·ä¿¡æ¯çš„åˆå§‹åŒ–&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-C" data-lang="C">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#8be9fd">void&lt;/span> &lt;span style="color:#50fa7b">ACLLoadUsersAtStartup&lt;/span>(&lt;span style="color:#8be9fd">void&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span> &lt;span style="color:#6272a4">//å…ˆåˆ¤æ–­ä¸€ä¸‹,å¦‚æœé…ç½®äº†ACLæ–‡ä»¶çš„åŒæ—¶ï¼Œåˆåœ¨redis.conf ä¸­é…ç½®äº†ç”¨æˆ·ï¼Œé‚£ä¹ˆrediså¯åŠ¨ä¼šå¤±è´¥
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#6272a4">//ACLçš„é…ç½®åªèƒ½åœ¨ä¸€ä¸ªé‡Œé¢é…ç½®
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">if&lt;/span> (server.acl_filename[&lt;span style="color:#bd93f9">0&lt;/span>] &lt;span style="color:#ff79c6">!=&lt;/span> &lt;span style="color:#f1fa8c">&amp;#39;\0&amp;#39;&lt;/span> &lt;span style="color:#ff79c6">&amp;amp;&amp;amp;&lt;/span> &lt;span style="color:#50fa7b">listLength&lt;/span>(UsersToLoad) &lt;span style="color:#ff79c6">!=&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span> &lt;span style="color:#50fa7b">serverLog&lt;/span>(LL_WARNING,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span> &lt;span style="color:#f1fa8c">&amp;#34;Configuring Redis with users defined in redis.conf and at &amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span> &lt;span style="color:#f1fa8c">&amp;#34;the same setting an ACL file path is invalid. This setup &amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span> &lt;span style="color:#f1fa8c">&amp;#34;is very likely to lead to configuration errors and security &amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span> &lt;span style="color:#f1fa8c">&amp;#34;holes, please define either an ACL file or declare users &amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span> &lt;span style="color:#f1fa8c">&amp;#34;directly in your redis.conf, but not both.&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span> &lt;span style="color:#50fa7b">exit&lt;/span>(&lt;span style="color:#bd93f9">1&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span> &lt;span style="color:#6272a4">//å¤„ç†ä»redisé…ç½®æ–‡ä»¶ä¸­åŠ è½½çš„ç”¨æˆ·
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">if&lt;/span> (&lt;span style="color:#50fa7b">ACLLoadConfiguredUsers&lt;/span>() &lt;span style="color:#ff79c6">==&lt;/span> C_ERR) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16&lt;/span>&lt;span> &lt;span style="color:#50fa7b">serverLog&lt;/span>(LL_WARNING,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17&lt;/span>&lt;span> &lt;span style="color:#f1fa8c">&amp;#34;Critical error while loading ACLs. Exiting.&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18&lt;/span>&lt;span> &lt;span style="color:#50fa7b">exit&lt;/span>(&lt;span style="color:#bd93f9">1&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21&lt;/span>&lt;span> &lt;span style="color:#6272a4">//å¤„ç†ä»aclæ–‡ä»¶ä¸­åŠ è½½çš„ç”¨æˆ·
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">if&lt;/span> (server.acl_filename[&lt;span style="color:#bd93f9">0&lt;/span>] &lt;span style="color:#ff79c6">!=&lt;/span> &lt;span style="color:#f1fa8c">&amp;#39;\0&amp;#39;&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23&lt;/span>&lt;span> sds errors &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#50fa7b">ACLLoadFromFile&lt;/span>(server.acl_filename);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (errors) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25&lt;/span>&lt;span> &lt;span style="color:#50fa7b">serverLog&lt;/span>(LL_WARNING,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26&lt;/span>&lt;span> &lt;span style="color:#f1fa8c">&amp;#34;Aborting Redis startup because of ACL errors: %s&amp;#34;&lt;/span>, errors);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27&lt;/span>&lt;span> &lt;span style="color:#50fa7b">sdsfree&lt;/span>(errors);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28&lt;/span>&lt;span> &lt;span style="color:#50fa7b">exit&lt;/span>(&lt;span style="color:#bd93f9">1&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;a class="link" href="https://github.com/redis/redis/blob/391aa4079c0855aa20929b1e272403937e874d57/src/acl.c#L2402" target="_blank" rel="noopener"
>ACLLoadUsersAtStartup&lt;/a>&lt;/p>
&lt;p>ä»é…ç½®æ–‡ä»¶ä¸­åŠ è½½çš„é€»è¾‘ï¼Œéœ€è¦å®Œæˆç”¨æˆ·åŠ è½½å’Œç”¨æˆ·ä¿¡æ¯çš„åˆå§‹åŒ–ï¼ˆç”¨æˆ·çš„å¯†ç ï¼Œflagï¼Œselectorsè§„åˆ™ç­‰ï¼‰&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-C" data-lang="C">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#8be9fd">int&lt;/span> &lt;span style="color:#50fa7b">ACLLoadConfiguredUsers&lt;/span>(&lt;span style="color:#8be9fd">void&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span> listIter li;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span> listNode &lt;span style="color:#ff79c6">*&lt;/span>ln;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span> &lt;span style="color:#50fa7b">listRewind&lt;/span>(UsersToLoad,&lt;span style="color:#ff79c6">&amp;amp;&lt;/span>li);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span> &lt;span style="color:#6272a4">//éå†UsersToLoadè¿™ä¸ªé“¾è¡¨ å®Œæˆä¿¡æ¯åˆå§‹åŒ–
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">while&lt;/span> ((ln &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#50fa7b">listNext&lt;/span>(&lt;span style="color:#ff79c6">&amp;amp;&lt;/span>li)) &lt;span style="color:#ff79c6">!=&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">NULL&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span> sds &lt;span style="color:#ff79c6">*&lt;/span>aclrules &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#50fa7b">listNodeValue&lt;/span>(ln);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span> sds username &lt;span style="color:#ff79c6">=&lt;/span> aclrules[&lt;span style="color:#bd93f9">0&lt;/span>];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (&lt;span style="color:#50fa7b">ACLStringHasSpaces&lt;/span>(aclrules[&lt;span style="color:#bd93f9">0&lt;/span>],&lt;span style="color:#50fa7b">sdslen&lt;/span>(aclrules[&lt;span style="color:#bd93f9">0&lt;/span>]))) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span> &lt;span style="color:#50fa7b">serverLog&lt;/span>(LL_WARNING,&lt;span style="color:#f1fa8c">&amp;#34;Spaces not allowed in ACL usernames&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> C_ERR;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15&lt;/span>&lt;span> user &lt;span style="color:#ff79c6">*&lt;/span>u &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#50fa7b">ACLCreateUser&lt;/span>(username,&lt;span style="color:#50fa7b">sdslen&lt;/span>(username));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16&lt;/span>&lt;span> &lt;span style="color:#6272a4">//åšç”¨æˆ·å»é‡ï¼Œä¸€ä¸ªç”¨æˆ·åªå…è®¸æœ‰ä¸€ä¸ª
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">if&lt;/span> (&lt;span style="color:#ff79c6">!&lt;/span>u) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18&lt;/span>&lt;span> &lt;span style="color:#6272a4">/* Only valid duplicate user is the default one. */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19&lt;/span>&lt;span> &lt;span style="color:#50fa7b">serverAssert&lt;/span>(&lt;span style="color:#ff79c6">!&lt;/span>&lt;span style="color:#50fa7b">strcmp&lt;/span>(username, &lt;span style="color:#f1fa8c">&amp;#34;default&amp;#34;&lt;/span>));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20&lt;/span>&lt;span> u &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#50fa7b">ACLGetUserByName&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;default&amp;#34;&lt;/span>,&lt;span style="color:#bd93f9">7&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21&lt;/span>&lt;span> &lt;span style="color:#50fa7b">ACLSetUser&lt;/span>(u,&lt;span style="color:#f1fa8c">&amp;#34;reset&amp;#34;&lt;/span>,&lt;span style="color:#ff79c6">-&lt;/span>&lt;span style="color:#bd93f9">1&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24&lt;/span>&lt;span> &lt;span style="color:#6272a4">/* Load every rule defined for this user. */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26&lt;/span>&lt;span> &lt;span style="color:#6272a4">//éå†å¾—åˆ°çš„è§„åˆ™ï¼ŒæŠŠè¿™äº›è§„åˆ™èµ‹ç»™userï¼Œå®Œæˆuserä¿¡æ¯çš„åˆå§‹åŒ–
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">for&lt;/span> (&lt;span style="color:#8be9fd">int&lt;/span> j &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#bd93f9">1&lt;/span>; aclrules[j]; j&lt;span style="color:#ff79c6">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (&lt;span style="color:#50fa7b">ACLSetUser&lt;/span>(u,aclrules[j],&lt;span style="color:#50fa7b">sdslen&lt;/span>(aclrules[j])) &lt;span style="color:#ff79c6">!=&lt;/span> C_OK) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29&lt;/span>&lt;span> &lt;span style="color:#ff79c6">const&lt;/span> &lt;span style="color:#8be9fd">char&lt;/span> &lt;span style="color:#ff79c6">*&lt;/span>errmsg &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#50fa7b">ACLSetUserStringError&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30&lt;/span>&lt;span> &lt;span style="color:#50fa7b">serverLog&lt;/span>(LL_WARNING,&lt;span style="color:#f1fa8c">&amp;#34;Error loading ACL rule &amp;#39;%s&amp;#39; for &amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31&lt;/span>&lt;span> &lt;span style="color:#f1fa8c">&amp;#34;the user named &amp;#39;%s&amp;#39;: %s&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32&lt;/span>&lt;span> aclrules[j],aclrules[&lt;span style="color:#bd93f9">0&lt;/span>],errmsg);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> C_ERR;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37&lt;/span>&lt;span> &lt;span style="color:#6272a4">/* Having a disabled user in the configuration may be an error,
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38&lt;/span>&lt;span>&lt;span style="color:#6272a4"> * warn about it without returning any error to the caller. */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39&lt;/span>&lt;span> &lt;span style="color:#6272a4">//å®Œæˆä¿¡æ¯åˆå§‹å,åˆ¤æ–­ä¸€ä¸‹è¿™ä¸ªç”¨æˆ·æ˜¯ä¸æ˜¯è¿˜æ˜¯ä¸å¯ç”¨çš„
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">if&lt;/span> (u&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>flags &lt;span style="color:#ff79c6">&amp;amp;&lt;/span> USER_FLAG_DISABLED) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41&lt;/span>&lt;span> &lt;span style="color:#50fa7b">serverLog&lt;/span>(LL_NOTICE, &lt;span style="color:#f1fa8c">&amp;#34;The user &amp;#39;%s&amp;#39; is disabled (there is no &amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42&lt;/span>&lt;span> &lt;span style="color:#f1fa8c">&amp;#34;&amp;#39;on&amp;#39; modifier in the user description). Make &amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43&lt;/span>&lt;span> &lt;span style="color:#f1fa8c">&amp;#34;sure this is not a configuration error.&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44&lt;/span>&lt;span> aclrules[&lt;span style="color:#bd93f9">0&lt;/span>]);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> C_OK;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;a class="link" href="https://github.com/redis/redis/blob/391aa4079c0855aa20929b1e272403937e874d57/src/acl.c#L2107" target="_blank" rel="noopener"
>ACLLoadConfiguredUsers&lt;/a>&lt;/p>
&lt;p>ä»ACLæ–‡ä»¶ä¸­åŠ è½½userä»£ç æ¯”è¾ƒå¤šï¼Œä¸‹é¢ä¼šæŠŠä¸€äº›ä¸é‡è¦çš„ï¼ˆæ¯”å¦‚æ–‡ä»¶åŠ è½½ç­‰ç­‰ï¼‰åˆ æ‰&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-C" data-lang="C">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>sds &lt;span style="color:#50fa7b">ACLLoadFromFile&lt;/span>(&lt;span style="color:#ff79c6">const&lt;/span> &lt;span style="color:#8be9fd">char&lt;/span> &lt;span style="color:#ff79c6">*&lt;/span>filename) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span> &lt;span style="color:#6272a4">//è¿™é‡Œä¼šå…ˆæŠŠå…¨å±€çš„ Users ä¿å­˜åˆ° old_usersæŒ‡é’ˆ,
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#6272a4">//ç„¶åé‡æ–° åˆå§‹åŒ–ä¸€ä¸ª User,åé¢åŠ è½½å¦‚æœå‡ºé”™äº†,å¯ä»¥å›æ»š
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> rax &lt;span style="color:#ff79c6">*&lt;/span>old_users &lt;span style="color:#ff79c6">=&lt;/span> Users;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span> Users &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#50fa7b">raxNew&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span> &lt;span style="color:#6272a4">//éå†æ–‡ä»¶ä¸­æ‰€æœ‰çš„è¡Œ,å¼€å§‹åŠ è½½user
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">for&lt;/span> (&lt;span style="color:#8be9fd">int&lt;/span> i &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>; i &lt;span style="color:#ff79c6">&amp;lt;&lt;/span> totlines; i&lt;span style="color:#ff79c6">++&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span> ............ çœç•¥è¯»æ–‡ä»¶éƒ¨åˆ†...............
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span> &lt;span style="color:#6272a4">//åˆ›å»ºä¸€ä¸ªUser
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> user &lt;span style="color:#ff79c6">*&lt;/span>u &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#50fa7b">ACLCreateUser&lt;/span>(argv[&lt;span style="color:#bd93f9">1&lt;/span>],&lt;span style="color:#50fa7b">sdslen&lt;/span>(argv[&lt;span style="color:#bd93f9">1&lt;/span>]));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span> &lt;span style="color:#6272a4">//å¦‚æœç”¨æˆ·å·²ç»å­˜åœ¨äº†,è·³è¿‡
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">if&lt;/span> (&lt;span style="color:#ff79c6">!&lt;/span>u) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15&lt;/span>&lt;span> errors &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#50fa7b">sdscatprintf&lt;/span>(errors,&lt;span style="color:#f1fa8c">&amp;#34;WARNING: Duplicate user &amp;#39;%s&amp;#39; found on line %d. &amp;#34;&lt;/span>, argv[&lt;span style="color:#bd93f9">1&lt;/span>], linenum);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16&lt;/span>&lt;span> &lt;span style="color:#50fa7b">sdsfreesplitres&lt;/span>(argv,argc);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17&lt;/span>&lt;span> &lt;span style="color:#ff79c6">continue&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20&lt;/span>&lt;span> &lt;span style="color:#6272a4">/* Finally process the options and validate they can
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21&lt;/span>&lt;span>&lt;span style="color:#6272a4"> * be cleanly applied to the user. If any option fails
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22&lt;/span>&lt;span>&lt;span style="color:#6272a4"> * to apply, the other values won&amp;#39;t be applied since
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23&lt;/span>&lt;span>&lt;span style="color:#6272a4"> * all the pending changes will get dropped. */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24&lt;/span>&lt;span> &lt;span style="color:#8be9fd">int&lt;/span> merged_argc;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26&lt;/span>&lt;span> &lt;span style="color:#6272a4">//è¿™ä¸ªå‡½æ•°çš„ä½œç”¨æ˜¯æŠŠè¯»åˆ°çš„å­—ç¬¦ä¸²,æå–æˆå…·ä½“çš„userå±æ€§çš„æ•°ç»„
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> sds &lt;span style="color:#ff79c6">*&lt;/span>acl_args &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#50fa7b">ACLMergeSelectorArguments&lt;/span>(argv &lt;span style="color:#ff79c6">+&lt;/span> &lt;span style="color:#bd93f9">2&lt;/span>, argc &lt;span style="color:#ff79c6">-&lt;/span> &lt;span style="color:#bd93f9">2&lt;/span>, &lt;span style="color:#ff79c6">&amp;amp;&lt;/span>merged_argc, &lt;span style="color:#8be9fd;font-style:italic">NULL&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (&lt;span style="color:#ff79c6">!&lt;/span>acl_args) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29&lt;/span>&lt;span> errors &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#50fa7b">sdscatprintf&lt;/span>(errors,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30&lt;/span>&lt;span> &lt;span style="color:#f1fa8c">&amp;#34;%s:%d: Unmatched parenthesis in selector definition.&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31&lt;/span>&lt;span> server.acl_filename, linenum);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34&lt;/span>&lt;span> &lt;span style="color:#8be9fd">int&lt;/span> syntax_error &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35&lt;/span>&lt;span> &lt;span style="color:#ff79c6">for&lt;/span> (&lt;span style="color:#8be9fd">int&lt;/span> j &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>; j &lt;span style="color:#ff79c6">&amp;lt;&lt;/span> merged_argc; j&lt;span style="color:#ff79c6">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36&lt;/span>&lt;span> acl_args[j] &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#50fa7b">sdstrim&lt;/span>(acl_args[j],&lt;span style="color:#f1fa8c">&amp;#34;&lt;/span>&lt;span style="color:#f1fa8c">\t\r\n&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37&lt;/span>&lt;span> &lt;span style="color:#6272a4">//éå†ä¸Šé¢å¾—åˆ°çš„æ‰‹åŠ¿,ç»™åˆ›å»ºçš„userè®¾ç½®å±æ€§
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">if&lt;/span> (&lt;span style="color:#50fa7b">ACLSetUser&lt;/span>(u,acl_args[j],&lt;span style="color:#50fa7b">sdslen&lt;/span>(acl_args[j])) &lt;span style="color:#ff79c6">!=&lt;/span> C_OK) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39&lt;/span>&lt;span> &lt;span style="color:#ff79c6">const&lt;/span> &lt;span style="color:#8be9fd">char&lt;/span> &lt;span style="color:#ff79c6">*&lt;/span>errmsg &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#50fa7b">ACLSetUserStringError&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (errno &lt;span style="color:#ff79c6">==&lt;/span> ENOENT) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41&lt;/span>&lt;span> &lt;span style="color:#6272a4">/* For missing commands, we print out more information since
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42&lt;/span>&lt;span>&lt;span style="color:#6272a4"> * it shouldn&amp;#39;t contain any sensitive information. */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43&lt;/span>&lt;span> errors &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#50fa7b">sdscatprintf&lt;/span>(errors,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44&lt;/span>&lt;span> &lt;span style="color:#f1fa8c">&amp;#34;%s:%d: Error in applying operation &amp;#39;%s&amp;#39;: %s. &amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45&lt;/span>&lt;span> server.acl_filename, linenum, acl_args[j], errmsg);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46&lt;/span>&lt;span> } &lt;span style="color:#ff79c6">else&lt;/span> &lt;span style="color:#ff79c6">if&lt;/span> (syntax_error &lt;span style="color:#ff79c6">==&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47&lt;/span>&lt;span> &lt;span style="color:#6272a4">/* For all other errors, only print out the first error encountered
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48&lt;/span>&lt;span>&lt;span style="color:#6272a4"> * since it might affect future operations. */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49&lt;/span>&lt;span> errors &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#50fa7b">sdscatprintf&lt;/span>(errors,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50&lt;/span>&lt;span> &lt;span style="color:#f1fa8c">&amp;#34;%s:%d: %s. &amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">51&lt;/span>&lt;span> server.acl_filename, linenum, errmsg);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">52&lt;/span>&lt;span> syntax_error &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#bd93f9">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">53&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">54&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">55&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">56&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">57&lt;/span>&lt;span> &lt;span style="color:#ff79c6">for&lt;/span> (&lt;span style="color:#8be9fd">int&lt;/span> i &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>; i &lt;span style="color:#ff79c6">&amp;lt;&lt;/span> merged_argc; i&lt;span style="color:#ff79c6">++&lt;/span>) &lt;span style="color:#50fa7b">sdsfree&lt;/span>(acl_args[i]);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">58&lt;/span>&lt;span> &lt;span style="color:#50fa7b">zfree&lt;/span>(acl_args);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">59&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">60&lt;/span>&lt;span> &lt;span style="color:#6272a4">/* Apply the rule to the new users set only if so far there
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">61&lt;/span>&lt;span>&lt;span style="color:#6272a4"> * are no errors, otherwise it&amp;#39;s useless since we are going
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">62&lt;/span>&lt;span>&lt;span style="color:#6272a4"> * to discard the new users set anyway. */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">63&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (&lt;span style="color:#50fa7b">sdslen&lt;/span>(errors) &lt;span style="color:#ff79c6">!=&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">64&lt;/span>&lt;span> &lt;span style="color:#50fa7b">sdsfreesplitres&lt;/span>(argv,argc);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">65&lt;/span>&lt;span> &lt;span style="color:#ff79c6">continue&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">66&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">67&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">68&lt;/span>&lt;span> &lt;span style="color:#50fa7b">sdsfreesplitres&lt;/span>(argv,argc);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">69&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">70&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">71&lt;/span>&lt;span> &lt;span style="color:#50fa7b">sdsfreesplitres&lt;/span>(lines,totlines);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">72&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">73&lt;/span>&lt;span> &lt;span style="color:#6272a4">/* Check if we found errors and react accordingly. */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">74&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (&lt;span style="color:#50fa7b">sdslen&lt;/span>(errors) &lt;span style="color:#ff79c6">==&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">75&lt;/span>&lt;span> &lt;span style="color:#6272a4">//åˆ¤æ–­ä¸€ä¸‹,æ˜¯å¦åŠ è½½äº†æ–°çš„`default` user,å¦‚æœæœ‰çš„è¯æŠŠæ—§çš„default useré‡Šæ”¾æ‰,ç”¨æ–°åŠ è½½çš„
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">76&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> user &lt;span style="color:#ff79c6">*&lt;/span>new_default &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#50fa7b">ACLGetUserByName&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;default&amp;#34;&lt;/span>,&lt;span style="color:#bd93f9">7&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">77&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (&lt;span style="color:#ff79c6">!&lt;/span>new_default) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">78&lt;/span>&lt;span> new_default &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#50fa7b">ACLCreateDefaultUser&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">79&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">80&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">81&lt;/span>&lt;span> &lt;span style="color:#50fa7b">ACLCopyUser&lt;/span>(DefaultUser,new_default);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">82&lt;/span>&lt;span> &lt;span style="color:#50fa7b">ACLFreeUser&lt;/span>(new_default);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">83&lt;/span>&lt;span> &lt;span style="color:#50fa7b">raxInsert&lt;/span>(Users,(&lt;span style="color:#8be9fd">unsigned&lt;/span> &lt;span style="color:#8be9fd">char&lt;/span>&lt;span style="color:#ff79c6">*&lt;/span>)&lt;span style="color:#f1fa8c">&amp;#34;default&amp;#34;&lt;/span>,&lt;span style="color:#bd93f9">7&lt;/span>,DefaultUser,&lt;span style="color:#8be9fd;font-style:italic">NULL&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">84&lt;/span>&lt;span> &lt;span style="color:#50fa7b">raxRemove&lt;/span>(old_users,(&lt;span style="color:#8be9fd">unsigned&lt;/span> &lt;span style="color:#8be9fd">char&lt;/span>&lt;span style="color:#ff79c6">*&lt;/span>)&lt;span style="color:#f1fa8c">&amp;#34;default&amp;#34;&lt;/span>,&lt;span style="color:#bd93f9">7&lt;/span>,&lt;span style="color:#8be9fd;font-style:italic">NULL&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">85&lt;/span>&lt;span> &lt;span style="color:#50fa7b">ACLFreeUsersSet&lt;/span>(old_users);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">86&lt;/span>&lt;span> &lt;span style="color:#50fa7b">sdsfree&lt;/span>(errors);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">87&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">NULL&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">88&lt;/span>&lt;span> } &lt;span style="color:#ff79c6">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">89&lt;/span>&lt;span> &lt;span style="color:#6272a4">//å¦‚æœå‡ºé”™äº†,æ•°æ®å›æ»š
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">90&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#50fa7b">ACLFreeUsersSet&lt;/span>(Users);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">91&lt;/span>&lt;span> Users &lt;span style="color:#ff79c6">=&lt;/span> old_users;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">92&lt;/span>&lt;span> errors &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#50fa7b">sdscat&lt;/span>(errors,&lt;span style="color:#f1fa8c">&amp;#34;WARNING: ACL errors detected, no change to the previously active ACL rules was performed&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">93&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> errors;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">94&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">95&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;a class="link" href="https://github.com/redis/redis/blob/391aa4079c0855aa20929b1e272403937e874d57/src/acl.c#L2174" target="_blank" rel="noopener"
>ACLLoadFromFile&lt;/a>&lt;/p>
&lt;p>ä¸ç®¡æ˜¯ä» é…ç½®æ–‡ä»¶ä¸­åŠ è½½ç”¨æˆ·è¿˜æ˜¯ä»ACLæ–‡ä»¶ä¸­åŠ è½½ç”¨æˆ·ï¼Œæœ€ç»ˆéƒ½ä¼šè°ƒç”¨&lt;code>ACLSetUser&lt;/code> è¿™ä¸ªå‡½æ•°æ¥å®Œæˆ &lt;code>user&lt;/code> å±æ€§çš„åˆå§‹åŒ–ã€‚ä½¿ç”¨redisçš„ &lt;code>ACL&lt;/code> å‘½ä»¤æ¥ç®¡ç†ç”¨æˆ·æ—¶ä¹Ÿæ˜¯é€šè¿‡è¿™ä¸ªå‡½æ•°æ¥å¤„ç†çš„ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-C" data-lang="C">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#8be9fd">int&lt;/span> &lt;span style="color:#50fa7b">ACLSetUser&lt;/span>(user &lt;span style="color:#ff79c6">*&lt;/span>u, &lt;span style="color:#ff79c6">const&lt;/span> &lt;span style="color:#8be9fd">char&lt;/span> &lt;span style="color:#ff79c6">*&lt;/span>op, &lt;span style="color:#8be9fd">ssize_t&lt;/span> oplen) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span> &lt;span style="color:#6272a4">//ç¬¬ä¸€æ­¥,å…ˆæŠŠä»¥å‰çš„å±æ€§å­—ç¬¦ä¸²åˆ æ‰
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">if&lt;/span> (u&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>acl_string) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span> &lt;span style="color:#50fa7b">decrRefCount&lt;/span>(u&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>acl_string);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span> u&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>acl_string &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">NULL&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (oplen &lt;span style="color:#ff79c6">==&lt;/span> &lt;span style="color:#ff79c6">-&lt;/span>&lt;span style="color:#bd93f9">1&lt;/span>) oplen &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#50fa7b">strlen&lt;/span>(op);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (oplen &lt;span style="color:#ff79c6">==&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>) &lt;span style="color:#ff79c6">return&lt;/span> C_OK; &lt;span style="color:#6272a4">/* Empty string is a no-operation. */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 10&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (&lt;span style="color:#ff79c6">!&lt;/span>&lt;span style="color:#50fa7b">strcasecmp&lt;/span>(op,&lt;span style="color:#f1fa8c">&amp;#34;on&amp;#34;&lt;/span>)) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 11&lt;/span>&lt;span> &lt;span style="color:#6272a4">//è®¾ç½® user æ˜¯ å¼€å¯çš„
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 12&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> u&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>flags &lt;span style="color:#ff79c6">|=&lt;/span> USER_FLAG_ENABLED;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 13&lt;/span>&lt;span> u&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>flags &lt;span style="color:#ff79c6">&amp;amp;=&lt;/span> &lt;span style="color:#ff79c6">~&lt;/span>USER_FLAG_DISABLED;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 14&lt;/span>&lt;span> } &lt;span style="color:#ff79c6">else&lt;/span> &lt;span style="color:#ff79c6">if&lt;/span> (&lt;span style="color:#ff79c6">!&lt;/span>&lt;span style="color:#50fa7b">strcasecmp&lt;/span>(op,&lt;span style="color:#f1fa8c">&amp;#34;off&amp;#34;&lt;/span>)) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 15&lt;/span>&lt;span> &lt;span style="color:#6272a4">//è®¾ç½® user æ˜¯å…³é—­çš„
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 16&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> u&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>flags &lt;span style="color:#ff79c6">|=&lt;/span> USER_FLAG_DISABLED;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 17&lt;/span>&lt;span> u&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>flags &lt;span style="color:#ff79c6">&amp;amp;=&lt;/span> &lt;span style="color:#ff79c6">~&lt;/span>USER_FLAG_ENABLED;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 18&lt;/span>&lt;span> } &lt;span style="color:#ff79c6">else&lt;/span> &lt;span style="color:#ff79c6">if&lt;/span> (&lt;span style="color:#ff79c6">!&lt;/span>&lt;span style="color:#50fa7b">strcasecmp&lt;/span>(op,&lt;span style="color:#f1fa8c">&amp;#34;skip-sanitize-payload&amp;#34;&lt;/span>)) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 19&lt;/span>&lt;span> u&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>flags &lt;span style="color:#ff79c6">|=&lt;/span> USER_FLAG_SANITIZE_PAYLOAD_SKIP;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 20&lt;/span>&lt;span> u&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>flags &lt;span style="color:#ff79c6">&amp;amp;=&lt;/span> &lt;span style="color:#ff79c6">~&lt;/span>USER_FLAG_SANITIZE_PAYLOAD;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 21&lt;/span>&lt;span> } &lt;span style="color:#ff79c6">else&lt;/span> &lt;span style="color:#ff79c6">if&lt;/span> (&lt;span style="color:#ff79c6">!&lt;/span>&lt;span style="color:#50fa7b">strcasecmp&lt;/span>(op,&lt;span style="color:#f1fa8c">&amp;#34;sanitize-payload&amp;#34;&lt;/span>)) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 22&lt;/span>&lt;span> u&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>flags &lt;span style="color:#ff79c6">&amp;amp;=&lt;/span> &lt;span style="color:#ff79c6">~&lt;/span>USER_FLAG_SANITIZE_PAYLOAD_SKIP;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 23&lt;/span>&lt;span> u&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>flags &lt;span style="color:#ff79c6">|=&lt;/span> USER_FLAG_SANITIZE_PAYLOAD;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 24&lt;/span>&lt;span> } &lt;span style="color:#ff79c6">else&lt;/span> &lt;span style="color:#ff79c6">if&lt;/span> (&lt;span style="color:#ff79c6">!&lt;/span>&lt;span style="color:#50fa7b">strcasecmp&lt;/span>(op,&lt;span style="color:#f1fa8c">&amp;#34;nopass&amp;#34;&lt;/span>)) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 25&lt;/span>&lt;span> u&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>flags &lt;span style="color:#ff79c6">|=&lt;/span> USER_FLAG_NOPASS;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 26&lt;/span>&lt;span> &lt;span style="color:#50fa7b">listEmpty&lt;/span>(u&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>passwords);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 27&lt;/span>&lt;span> } &lt;span style="color:#ff79c6">else&lt;/span> &lt;span style="color:#ff79c6">if&lt;/span> (&lt;span style="color:#ff79c6">!&lt;/span>&lt;span style="color:#50fa7b">strcasecmp&lt;/span>(op,&lt;span style="color:#f1fa8c">&amp;#34;resetpass&amp;#34;&lt;/span>)) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 28&lt;/span>&lt;span> u&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>flags &lt;span style="color:#ff79c6">&amp;amp;=&lt;/span> &lt;span style="color:#ff79c6">~&lt;/span>USER_FLAG_NOPASS;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 29&lt;/span>&lt;span> &lt;span style="color:#50fa7b">listEmpty&lt;/span>(u&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>passwords);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 30&lt;/span>&lt;span> } &lt;span style="color:#ff79c6">else&lt;/span> &lt;span style="color:#ff79c6">if&lt;/span> (op[&lt;span style="color:#bd93f9">0&lt;/span>] &lt;span style="color:#ff79c6">==&lt;/span> &lt;span style="color:#f1fa8c">&amp;#39;&amp;gt;&amp;#39;&lt;/span> &lt;span style="color:#ff79c6">||&lt;/span> op[&lt;span style="color:#bd93f9">0&lt;/span>] &lt;span style="color:#ff79c6">==&lt;/span> &lt;span style="color:#f1fa8c">&amp;#39;#&amp;#39;&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 31&lt;/span>&lt;span> &lt;span style="color:#6272a4">//è®¾ç½®å¯†ç 
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 32&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> sds newpass;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 33&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (op[&lt;span style="color:#bd93f9">0&lt;/span>] &lt;span style="color:#ff79c6">==&lt;/span> &lt;span style="color:#f1fa8c">&amp;#39;&amp;gt;&amp;#39;&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 34&lt;/span>&lt;span> &lt;span style="color:#6272a4">//å¦‚æœæ˜¯æ˜æ–‡,å…ˆè½¬æˆsha256å­—ç¬¦ä¸²
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 35&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> newpass &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#50fa7b">ACLHashPassword&lt;/span>((&lt;span style="color:#8be9fd">unsigned&lt;/span> &lt;span style="color:#8be9fd">char&lt;/span>&lt;span style="color:#ff79c6">*&lt;/span>)op&lt;span style="color:#ff79c6">+&lt;/span>&lt;span style="color:#bd93f9">1&lt;/span>,oplen&lt;span style="color:#ff79c6">-&lt;/span>&lt;span style="color:#bd93f9">1&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 36&lt;/span>&lt;span> } &lt;span style="color:#ff79c6">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 37&lt;/span>&lt;span> &lt;span style="color:#6272a4">//åˆ¤æ–­ä¸€ä¸‹è¾“å…¥çš„å€¼æ˜¯ä¸æ˜¯æœ‰æ•ˆçš„hashå€¼
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 38&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">if&lt;/span> (&lt;span style="color:#50fa7b">ACLCheckPasswordHash&lt;/span>((&lt;span style="color:#8be9fd">unsigned&lt;/span> &lt;span style="color:#8be9fd">char&lt;/span>&lt;span style="color:#ff79c6">*&lt;/span>)op&lt;span style="color:#ff79c6">+&lt;/span>&lt;span style="color:#bd93f9">1&lt;/span>,oplen&lt;span style="color:#ff79c6">-&lt;/span>&lt;span style="color:#bd93f9">1&lt;/span>) &lt;span style="color:#ff79c6">==&lt;/span> C_ERR) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 39&lt;/span>&lt;span> errno &lt;span style="color:#ff79c6">=&lt;/span> EBADMSG;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 40&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> C_ERR;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 41&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 42&lt;/span>&lt;span> newpass &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#50fa7b">sdsnewlen&lt;/span>(op&lt;span style="color:#ff79c6">+&lt;/span>&lt;span style="color:#bd93f9">1&lt;/span>,oplen&lt;span style="color:#ff79c6">-&lt;/span>&lt;span style="color:#bd93f9">1&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 43&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 44&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 45&lt;/span>&lt;span> listNode &lt;span style="color:#ff79c6">*&lt;/span>ln &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#50fa7b">listSearchKey&lt;/span>(u&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>passwords,newpass);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 46&lt;/span>&lt;span> &lt;span style="color:#6272a4">//å¦‚æœä¹‹å‰æœ‰è¿™ä¸ªå¯†ç ,ä¸ç”¨æ·»åŠ äº†,é¿å…åŒä¸€ä¸ªå¯†ç æ·»åŠ å¤šæ¬¡
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 47&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">if&lt;/span> (ln &lt;span style="color:#ff79c6">==&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">NULL&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 48&lt;/span>&lt;span> &lt;span style="color:#50fa7b">listAddNodeTail&lt;/span>(u&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>passwords,newpass);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 49&lt;/span>&lt;span> &lt;span style="color:#ff79c6">else&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 50&lt;/span>&lt;span> &lt;span style="color:#50fa7b">sdsfree&lt;/span>(newpass);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 51&lt;/span>&lt;span> u&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>flags &lt;span style="color:#ff79c6">&amp;amp;=&lt;/span> &lt;span style="color:#ff79c6">~&lt;/span>USER_FLAG_NOPASS;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 52&lt;/span>&lt;span> } &lt;span style="color:#ff79c6">else&lt;/span> &lt;span style="color:#ff79c6">if&lt;/span> (op[&lt;span style="color:#bd93f9">0&lt;/span>] &lt;span style="color:#ff79c6">==&lt;/span> &lt;span style="color:#f1fa8c">&amp;#39;&amp;lt;&amp;#39;&lt;/span> &lt;span style="color:#ff79c6">||&lt;/span> op[&lt;span style="color:#bd93f9">0&lt;/span>] &lt;span style="color:#ff79c6">==&lt;/span> &lt;span style="color:#f1fa8c">&amp;#39;!&amp;#39;&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 53&lt;/span>&lt;span> &lt;span style="color:#6272a4">//åˆ é™¤å¯†ç ,åŒæ ·çš„,å¦‚æœæ˜¯æ˜æ–‡,å…ˆè½¬æˆsha256å­—ç¬¦ä¸²
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 54&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> sds delpass;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 55&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (op[&lt;span style="color:#bd93f9">0&lt;/span>] &lt;span style="color:#ff79c6">==&lt;/span> &lt;span style="color:#f1fa8c">&amp;#39;&amp;lt;&amp;#39;&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 56&lt;/span>&lt;span> delpass &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#50fa7b">ACLHashPassword&lt;/span>((&lt;span style="color:#8be9fd">unsigned&lt;/span> &lt;span style="color:#8be9fd">char&lt;/span>&lt;span style="color:#ff79c6">*&lt;/span>)op&lt;span style="color:#ff79c6">+&lt;/span>&lt;span style="color:#bd93f9">1&lt;/span>,oplen&lt;span style="color:#ff79c6">-&lt;/span>&lt;span style="color:#bd93f9">1&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 57&lt;/span>&lt;span> } &lt;span style="color:#ff79c6">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 58&lt;/span>&lt;span> &lt;span style="color:#6272a4">//åŒæ ·,åˆ¤æ–­è¿™ä¸ªå­—ç¬¦ä¸²æ˜¯ä¸æ˜¯æœ‰æ•ˆçš„hashå€¼
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 59&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">if&lt;/span> (&lt;span style="color:#50fa7b">ACLCheckPasswordHash&lt;/span>((&lt;span style="color:#8be9fd">unsigned&lt;/span> &lt;span style="color:#8be9fd">char&lt;/span>&lt;span style="color:#ff79c6">*&lt;/span>)op&lt;span style="color:#ff79c6">+&lt;/span>&lt;span style="color:#bd93f9">1&lt;/span>,oplen&lt;span style="color:#ff79c6">-&lt;/span>&lt;span style="color:#bd93f9">1&lt;/span>) &lt;span style="color:#ff79c6">==&lt;/span> C_ERR) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 60&lt;/span>&lt;span> errno &lt;span style="color:#ff79c6">=&lt;/span> EBADMSG;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 61&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> C_ERR;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 62&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 63&lt;/span>&lt;span> delpass &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#50fa7b">sdsnewlen&lt;/span>(op&lt;span style="color:#ff79c6">+&lt;/span>&lt;span style="color:#bd93f9">1&lt;/span>,oplen&lt;span style="color:#ff79c6">-&lt;/span>&lt;span style="color:#bd93f9">1&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 64&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 65&lt;/span>&lt;span> listNode &lt;span style="color:#ff79c6">*&lt;/span>ln &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#50fa7b">listSearchKey&lt;/span>(u&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>passwords,delpass);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 66&lt;/span>&lt;span> &lt;span style="color:#50fa7b">sdsfree&lt;/span>(delpass);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 67&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (ln) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 68&lt;/span>&lt;span> &lt;span style="color:#50fa7b">listDelNode&lt;/span>(u&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>passwords,ln);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 69&lt;/span>&lt;span> } &lt;span style="color:#ff79c6">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 70&lt;/span>&lt;span> errno &lt;span style="color:#ff79c6">=&lt;/span> ENODEV;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 71&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> C_ERR;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 72&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 73&lt;/span>&lt;span> } &lt;span style="color:#ff79c6">else&lt;/span> &lt;span style="color:#ff79c6">if&lt;/span> (op[&lt;span style="color:#bd93f9">0&lt;/span>] &lt;span style="color:#ff79c6">==&lt;/span> &lt;span style="color:#f1fa8c">&amp;#39;(&amp;#39;&lt;/span> &lt;span style="color:#ff79c6">&amp;amp;&amp;amp;&lt;/span> op[oplen &lt;span style="color:#ff79c6">-&lt;/span> &lt;span style="color:#bd93f9">1&lt;/span>] &lt;span style="color:#ff79c6">==&lt;/span> &lt;span style="color:#f1fa8c">&amp;#39;)&amp;#39;&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 74&lt;/span>&lt;span> &lt;span style="color:#6272a4">//å¤„ç† `()` å†…çš„ selector
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 75&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> aclSelector &lt;span style="color:#ff79c6">*&lt;/span>selector &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#50fa7b">aclCreateSelectorFromOpSet&lt;/span>(op, oplen);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 76&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (&lt;span style="color:#ff79c6">!&lt;/span>selector) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 77&lt;/span>&lt;span> &lt;span style="color:#6272a4">/* No errorno set, propagate it from interior error. */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 78&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> C_ERR;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 79&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 80&lt;/span>&lt;span> &lt;span style="color:#50fa7b">listAddNodeTail&lt;/span>(u&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>selectors, selector);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 81&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> C_OK;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 82&lt;/span>&lt;span> } &lt;span style="color:#ff79c6">else&lt;/span> &lt;span style="color:#ff79c6">if&lt;/span> (&lt;span style="color:#ff79c6">!&lt;/span>&lt;span style="color:#50fa7b">strcasecmp&lt;/span>(op,&lt;span style="color:#f1fa8c">&amp;#34;clearselectors&amp;#34;&lt;/span>)) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 83&lt;/span>&lt;span> &lt;span style="color:#6272a4">//æ¸…ç†æ‰æ‰€æœ‰çš„ selector
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 84&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> listIter li;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 85&lt;/span>&lt;span> listNode &lt;span style="color:#ff79c6">*&lt;/span>ln;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 86&lt;/span>&lt;span> &lt;span style="color:#50fa7b">listRewind&lt;/span>(u&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>selectors,&lt;span style="color:#ff79c6">&amp;amp;&lt;/span>li);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 87&lt;/span>&lt;span> &lt;span style="color:#6272a4">/* There has to be a root selector */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 88&lt;/span>&lt;span> &lt;span style="color:#50fa7b">serverAssert&lt;/span>(&lt;span style="color:#50fa7b">listNext&lt;/span>(&lt;span style="color:#ff79c6">&amp;amp;&lt;/span>li));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 89&lt;/span>&lt;span> &lt;span style="color:#ff79c6">while&lt;/span>((ln &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#50fa7b">listNext&lt;/span>(&lt;span style="color:#ff79c6">&amp;amp;&lt;/span>li))) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 90&lt;/span>&lt;span> &lt;span style="color:#50fa7b">listDelNode&lt;/span>(u&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>selectors, ln);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 91&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 92&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> C_OK;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 93&lt;/span>&lt;span> } &lt;span style="color:#ff79c6">else&lt;/span> &lt;span style="color:#ff79c6">if&lt;/span> (&lt;span style="color:#ff79c6">!&lt;/span>&lt;span style="color:#50fa7b">strcasecmp&lt;/span>(op,&lt;span style="color:#f1fa8c">&amp;#34;reset&amp;#34;&lt;/span>)) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 94&lt;/span>&lt;span> &lt;span style="color:#6272a4">//é‡ç½®è¿™ä¸ªç”¨æˆ·
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 95&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#50fa7b">serverAssert&lt;/span>(&lt;span style="color:#50fa7b">ACLSetUser&lt;/span>(u,&lt;span style="color:#f1fa8c">&amp;#34;resetpass&amp;#34;&lt;/span>,&lt;span style="color:#ff79c6">-&lt;/span>&lt;span style="color:#bd93f9">1&lt;/span>) &lt;span style="color:#ff79c6">==&lt;/span> C_OK);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 96&lt;/span>&lt;span> &lt;span style="color:#50fa7b">serverAssert&lt;/span>(&lt;span style="color:#50fa7b">ACLSetUser&lt;/span>(u,&lt;span style="color:#f1fa8c">&amp;#34;resetkeys&amp;#34;&lt;/span>,&lt;span style="color:#ff79c6">-&lt;/span>&lt;span style="color:#bd93f9">1&lt;/span>) &lt;span style="color:#ff79c6">==&lt;/span> C_OK);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 97&lt;/span>&lt;span> &lt;span style="color:#50fa7b">serverAssert&lt;/span>(&lt;span style="color:#50fa7b">ACLSetUser&lt;/span>(u,&lt;span style="color:#f1fa8c">&amp;#34;resetchannels&amp;#34;&lt;/span>,&lt;span style="color:#ff79c6">-&lt;/span>&lt;span style="color:#bd93f9">1&lt;/span>) &lt;span style="color:#ff79c6">==&lt;/span> C_OK);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 98&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (server.acl_pubsub_default &lt;span style="color:#ff79c6">&amp;amp;&lt;/span> SELECTOR_FLAG_ALLCHANNELS)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 99&lt;/span>&lt;span> &lt;span style="color:#50fa7b">serverAssert&lt;/span>(&lt;span style="color:#50fa7b">ACLSetUser&lt;/span>(u,&lt;span style="color:#f1fa8c">&amp;#34;allchannels&amp;#34;&lt;/span>,&lt;span style="color:#ff79c6">-&lt;/span>&lt;span style="color:#bd93f9">1&lt;/span>) &lt;span style="color:#ff79c6">==&lt;/span> C_OK);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">100&lt;/span>&lt;span> &lt;span style="color:#50fa7b">serverAssert&lt;/span>(&lt;span style="color:#50fa7b">ACLSetUser&lt;/span>(u,&lt;span style="color:#f1fa8c">&amp;#34;off&amp;#34;&lt;/span>,&lt;span style="color:#ff79c6">-&lt;/span>&lt;span style="color:#bd93f9">1&lt;/span>) &lt;span style="color:#ff79c6">==&lt;/span> C_OK);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">101&lt;/span>&lt;span> &lt;span style="color:#50fa7b">serverAssert&lt;/span>(&lt;span style="color:#50fa7b">ACLSetUser&lt;/span>(u,&lt;span style="color:#f1fa8c">&amp;#34;sanitize-payload&amp;#34;&lt;/span>,&lt;span style="color:#ff79c6">-&lt;/span>&lt;span style="color:#bd93f9">1&lt;/span>) &lt;span style="color:#ff79c6">==&lt;/span> C_OK);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">102&lt;/span>&lt;span> &lt;span style="color:#50fa7b">serverAssert&lt;/span>(&lt;span style="color:#50fa7b">ACLSetUser&lt;/span>(u,&lt;span style="color:#f1fa8c">&amp;#34;clearselectors&amp;#34;&lt;/span>,&lt;span style="color:#ff79c6">-&lt;/span>&lt;span style="color:#bd93f9">1&lt;/span>) &lt;span style="color:#ff79c6">==&lt;/span> C_OK);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">103&lt;/span>&lt;span> &lt;span style="color:#50fa7b">serverAssert&lt;/span>(&lt;span style="color:#50fa7b">ACLSetUser&lt;/span>(u,&lt;span style="color:#f1fa8c">&amp;#34;-@all&amp;#34;&lt;/span>,&lt;span style="color:#ff79c6">-&lt;/span>&lt;span style="color:#bd93f9">1&lt;/span>) &lt;span style="color:#ff79c6">==&lt;/span> C_OK);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">104&lt;/span>&lt;span> } &lt;span style="color:#ff79c6">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">105&lt;/span>&lt;span> &lt;span style="color:#6272a4">//å¤„ç†ç”¨æˆ·çš„ selector è®¾ç½®, æ¯”å¦‚ `+@, -@, &amp;amp;, ~*` ç­‰ç­‰å‘½ä»¤
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">106&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> aclSelector &lt;span style="color:#ff79c6">*&lt;/span>selector &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#50fa7b">ACLUserGetRootSelector&lt;/span>(u);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">107&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (&lt;span style="color:#50fa7b">ACLSetSelector&lt;/span>(selector, op, oplen) &lt;span style="color:#ff79c6">==&lt;/span> C_ERR) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">108&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> C_ERR;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">109&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">110&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">111&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> C_OK;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">112&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>aclCreateSelectorFromOpSet&lt;/code> è¿™ä¸ªå‡½æ•°æœ€ç»ˆä¼šè°ƒç”¨ &lt;code>ACLSetSelector&lt;/code> æ¥æŠŠå­—ç¬¦ä¸²è½¬æ¢æˆå…·ä½“çš„è§„åˆ™&lt;/p>
&lt;p>&lt;a class="link" href="https://github.com/redis/redis/blob/391aa4079c0855aa20929b1e272403937e874d57/src/acl.c#L997" target="_blank" rel="noopener"
>ACLSetSelector&lt;/a>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-C" data-lang="C">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#8be9fd">int&lt;/span> &lt;span style="color:#50fa7b">ACLSetSelector&lt;/span>(aclSelector &lt;span style="color:#ff79c6">*&lt;/span>selector, &lt;span style="color:#ff79c6">const&lt;/span> &lt;span style="color:#8be9fd">char&lt;/span>&lt;span style="color:#ff79c6">*&lt;/span> op, &lt;span style="color:#8be9fd">size_t&lt;/span> oplen) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (&lt;span style="color:#ff79c6">!&lt;/span>&lt;span style="color:#50fa7b">strcasecmp&lt;/span>(op,&lt;span style="color:#f1fa8c">&amp;#34;allkeys&amp;#34;&lt;/span>) &lt;span style="color:#ff79c6">||&lt;/span> &lt;span style="color:#ff79c6">!&lt;/span>&lt;span style="color:#50fa7b">strcasecmp&lt;/span>(op,&lt;span style="color:#f1fa8c">&amp;#34;~*&amp;#34;&lt;/span>)) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span> &lt;span style="color:#6272a4">//å…è®¸æ‰€æœ‰key
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> selector&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>flags &lt;span style="color:#ff79c6">|=&lt;/span> SELECTOR_FLAG_ALLKEYS;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span> &lt;span style="color:#50fa7b">listEmpty&lt;/span>(selector&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>patterns);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span> } &lt;span style="color:#ff79c6">else&lt;/span> &lt;span style="color:#ff79c6">if&lt;/span> (&lt;span style="color:#ff79c6">!&lt;/span>&lt;span style="color:#50fa7b">strcasecmp&lt;/span>(op,&lt;span style="color:#f1fa8c">&amp;#34;resetkeys&amp;#34;&lt;/span>)) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span> &lt;span style="color:#6272a4">//å»æ‰æ‰€æœ‰keyæƒé™
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> selector&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>flags &lt;span style="color:#ff79c6">&amp;amp;=&lt;/span> &lt;span style="color:#ff79c6">~&lt;/span>SELECTOR_FLAG_ALLKEYS;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span> &lt;span style="color:#50fa7b">listEmpty&lt;/span>(selector&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>patterns);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 10&lt;/span>&lt;span> } &lt;span style="color:#ff79c6">else&lt;/span> &lt;span style="color:#ff79c6">if&lt;/span> (&lt;span style="color:#ff79c6">!&lt;/span>&lt;span style="color:#50fa7b">strcasecmp&lt;/span>(op,&lt;span style="color:#f1fa8c">&amp;#34;allchannels&amp;#34;&lt;/span>) &lt;span style="color:#ff79c6">||&lt;/span> &lt;span style="color:#ff79c6">!&lt;/span>&lt;span style="color:#50fa7b">strcasecmp&lt;/span>(op,&lt;span style="color:#f1fa8c">&amp;#34;&amp;amp;*&amp;#34;&lt;/span>)) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 11&lt;/span>&lt;span> &lt;span style="color:#6272a4">//channel å’Œkeyä¸€æ ·,å…è®¸æ‰€æœ‰å’Œå»æ‰æ‰€æœ‰
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 12&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> selector&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>flags &lt;span style="color:#ff79c6">|=&lt;/span> SELECTOR_FLAG_ALLCHANNELS;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 13&lt;/span>&lt;span> &lt;span style="color:#50fa7b">listEmpty&lt;/span>(selector&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>channels);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 14&lt;/span>&lt;span> } &lt;span style="color:#ff79c6">else&lt;/span> &lt;span style="color:#ff79c6">if&lt;/span> (&lt;span style="color:#ff79c6">!&lt;/span>&lt;span style="color:#50fa7b">strcasecmp&lt;/span>(op,&lt;span style="color:#f1fa8c">&amp;#34;resetchannels&amp;#34;&lt;/span>)) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 15&lt;/span>&lt;span> selector&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>flags &lt;span style="color:#ff79c6">&amp;amp;=&lt;/span> &lt;span style="color:#ff79c6">~&lt;/span>SELECTOR_FLAG_ALLCHANNELS;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 16&lt;/span>&lt;span> &lt;span style="color:#50fa7b">listEmpty&lt;/span>(selector&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>channels);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 17&lt;/span>&lt;span> } &lt;span style="color:#ff79c6">else&lt;/span> &lt;span style="color:#ff79c6">if&lt;/span> (&lt;span style="color:#ff79c6">!&lt;/span>&lt;span style="color:#50fa7b">strcasecmp&lt;/span>(op,&lt;span style="color:#f1fa8c">&amp;#34;allcommands&amp;#34;&lt;/span>) &lt;span style="color:#ff79c6">||&lt;/span> &lt;span style="color:#ff79c6">!&lt;/span>&lt;span style="color:#50fa7b">strcasecmp&lt;/span>(op,&lt;span style="color:#f1fa8c">&amp;#34;+@all&amp;#34;&lt;/span>)) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 18&lt;/span>&lt;span> &lt;span style="color:#6272a4">//å…è®¸æ‰€æœ‰çš„æƒé™, ä¸‹é¢æ˜¯å»æ‰æ‰€æœ‰æƒé™
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 19&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#50fa7b">memset&lt;/span>(selector&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>allowed_commands,&lt;span style="color:#bd93f9">255&lt;/span>,&lt;span style="color:#ff79c6">sizeof&lt;/span>(selector&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>allowed_commands));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 20&lt;/span>&lt;span> selector&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>flags &lt;span style="color:#ff79c6">|=&lt;/span> SELECTOR_FLAG_ALLCOMMANDS;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 21&lt;/span>&lt;span> &lt;span style="color:#50fa7b">ACLResetFirstArgs&lt;/span>(selector);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 22&lt;/span>&lt;span> } &lt;span style="color:#ff79c6">else&lt;/span> &lt;span style="color:#ff79c6">if&lt;/span> (&lt;span style="color:#ff79c6">!&lt;/span>&lt;span style="color:#50fa7b">strcasecmp&lt;/span>(op,&lt;span style="color:#f1fa8c">&amp;#34;nocommands&amp;#34;&lt;/span>) &lt;span style="color:#ff79c6">||&lt;/span> &lt;span style="color:#ff79c6">!&lt;/span>&lt;span style="color:#50fa7b">strcasecmp&lt;/span>(op,&lt;span style="color:#f1fa8c">&amp;#34;-@all&amp;#34;&lt;/span>)) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 23&lt;/span>&lt;span> &lt;span style="color:#50fa7b">memset&lt;/span>(selector&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>allowed_commands,&lt;span style="color:#bd93f9">0&lt;/span>,&lt;span style="color:#ff79c6">sizeof&lt;/span>(selector&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>allowed_commands));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 24&lt;/span>&lt;span> selector&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>flags &lt;span style="color:#ff79c6">&amp;amp;=&lt;/span> &lt;span style="color:#ff79c6">~&lt;/span>SELECTOR_FLAG_ALLCOMMANDS;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 25&lt;/span>&lt;span> &lt;span style="color:#50fa7b">ACLResetFirstArgs&lt;/span>(selector);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 26&lt;/span>&lt;span> } &lt;span style="color:#ff79c6">else&lt;/span> &lt;span style="color:#ff79c6">if&lt;/span> (op[&lt;span style="color:#bd93f9">0&lt;/span>] &lt;span style="color:#ff79c6">==&lt;/span> &lt;span style="color:#f1fa8c">&amp;#39;~&amp;#39;&lt;/span> &lt;span style="color:#ff79c6">||&lt;/span> op[&lt;span style="color:#bd93f9">0&lt;/span>] &lt;span style="color:#ff79c6">==&lt;/span> &lt;span style="color:#f1fa8c">&amp;#39;%&amp;#39;&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 27&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (selector&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>flags &lt;span style="color:#ff79c6">&amp;amp;&lt;/span> SELECTOR_FLAG_ALLKEYS) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 28&lt;/span>&lt;span> &lt;span style="color:#6272a4">//å¦‚æœæ˜¯å…è®¸æ‰€æœ‰keyäº†, å†åŠ é™åˆ¶keyçš„å‘½ä»¤,ä¼šè¿”å›é”™è¯¯
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 29&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> errno &lt;span style="color:#ff79c6">=&lt;/span> EEXIST;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 30&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> C_ERR;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 31&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 32&lt;/span>&lt;span> &lt;span style="color:#8be9fd">int&lt;/span> flags &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 33&lt;/span>&lt;span> &lt;span style="color:#8be9fd">size_t&lt;/span> offset &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#bd93f9">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 34&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (op[&lt;span style="color:#bd93f9">0&lt;/span>] &lt;span style="color:#ff79c6">==&lt;/span> &lt;span style="color:#f1fa8c">&amp;#39;%&amp;#39;&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 35&lt;/span>&lt;span> &lt;span style="color:#6272a4">//å¦‚æœæ˜¯%å¼€å¤´,éœ€è¦åˆ¤æ–­æ˜¯è¯»è¿˜æ˜¯å†™
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 36&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">for&lt;/span> (; offset &lt;span style="color:#ff79c6">&amp;lt;&lt;/span> oplen; offset&lt;span style="color:#ff79c6">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 37&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (&lt;span style="color:#50fa7b">toupper&lt;/span>(op[offset]) &lt;span style="color:#ff79c6">==&lt;/span> &lt;span style="color:#f1fa8c">&amp;#39;R&amp;#39;&lt;/span> &lt;span style="color:#ff79c6">&amp;amp;&amp;amp;&lt;/span> &lt;span style="color:#ff79c6">!&lt;/span>(flags &lt;span style="color:#ff79c6">&amp;amp;&lt;/span> ACL_READ_PERMISSION)) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 38&lt;/span>&lt;span> flags &lt;span style="color:#ff79c6">|=&lt;/span> ACL_READ_PERMISSION;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 39&lt;/span>&lt;span> } &lt;span style="color:#ff79c6">else&lt;/span> &lt;span style="color:#ff79c6">if&lt;/span> (&lt;span style="color:#50fa7b">toupper&lt;/span>(op[offset]) &lt;span style="color:#ff79c6">==&lt;/span> &lt;span style="color:#f1fa8c">&amp;#39;W&amp;#39;&lt;/span> &lt;span style="color:#ff79c6">&amp;amp;&amp;amp;&lt;/span> &lt;span style="color:#ff79c6">!&lt;/span>(flags &lt;span style="color:#ff79c6">&amp;amp;&lt;/span> ACL_WRITE_PERMISSION)) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 40&lt;/span>&lt;span> flags &lt;span style="color:#ff79c6">|=&lt;/span> ACL_WRITE_PERMISSION;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 41&lt;/span>&lt;span> } &lt;span style="color:#ff79c6">else&lt;/span> &lt;span style="color:#ff79c6">if&lt;/span> (op[offset] &lt;span style="color:#ff79c6">==&lt;/span> &lt;span style="color:#f1fa8c">&amp;#39;~&amp;#39;&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 42&lt;/span>&lt;span> offset&lt;span style="color:#ff79c6">++&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 43&lt;/span>&lt;span> &lt;span style="color:#ff79c6">break&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 44&lt;/span>&lt;span> } &lt;span style="color:#ff79c6">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 45&lt;/span>&lt;span> errno &lt;span style="color:#ff79c6">=&lt;/span> EINVAL;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 46&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> C_ERR;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 47&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 48&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 49&lt;/span>&lt;span> } &lt;span style="color:#ff79c6">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 50&lt;/span>&lt;span> flags &lt;span style="color:#ff79c6">=&lt;/span> ACL_ALL_PERMISSION;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 51&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 52&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 53&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (&lt;span style="color:#50fa7b">ACLStringHasSpaces&lt;/span>(op&lt;span style="color:#ff79c6">+&lt;/span>offset,oplen&lt;span style="color:#ff79c6">-&lt;/span>offset)) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 54&lt;/span>&lt;span> errno &lt;span style="color:#ff79c6">=&lt;/span> EINVAL;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 55&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> C_ERR;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 56&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 57&lt;/span>&lt;span> keyPattern &lt;span style="color:#ff79c6">*&lt;/span>newpat &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#50fa7b">ACLKeyPatternCreate&lt;/span>(&lt;span style="color:#50fa7b">sdsnewlen&lt;/span>(op&lt;span style="color:#ff79c6">+&lt;/span>offset,oplen&lt;span style="color:#ff79c6">-&lt;/span>offset), flags);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 58&lt;/span>&lt;span> listNode &lt;span style="color:#ff79c6">*&lt;/span>ln &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#50fa7b">listSearchKey&lt;/span>(selector&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>patterns,newpat);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 59&lt;/span>&lt;span> &lt;span style="color:#6272a4">//é¿å…é‡å¤
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 60&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">if&lt;/span> (ln &lt;span style="color:#ff79c6">==&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">NULL&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 61&lt;/span>&lt;span> &lt;span style="color:#50fa7b">listAddNodeTail&lt;/span>(selector&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>patterns,newpat);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 62&lt;/span>&lt;span> } &lt;span style="color:#ff79c6">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 63&lt;/span>&lt;span> &lt;span style="color:#6272a4">//å¦‚æœæœ‰é‡å¤çš„. åˆå¹¶ä¸¤ä¸ªpatternçš„flag
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 64&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> ((keyPattern &lt;span style="color:#ff79c6">*&lt;/span>)&lt;span style="color:#50fa7b">listNodeValue&lt;/span>(ln))&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>flags &lt;span style="color:#ff79c6">|=&lt;/span> flags;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 65&lt;/span>&lt;span> &lt;span style="color:#50fa7b">ACLKeyPatternFree&lt;/span>(newpat);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 66&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 67&lt;/span>&lt;span> selector&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>flags &lt;span style="color:#ff79c6">&amp;amp;=&lt;/span> &lt;span style="color:#ff79c6">~&lt;/span>SELECTOR_FLAG_ALLKEYS;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 68&lt;/span>&lt;span> } &lt;span style="color:#ff79c6">else&lt;/span> &lt;span style="color:#ff79c6">if&lt;/span> (op[&lt;span style="color:#bd93f9">0&lt;/span>] &lt;span style="color:#ff79c6">==&lt;/span> &lt;span style="color:#f1fa8c">&amp;#39;&amp;amp;&amp;#39;&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 69&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (selector&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>flags &lt;span style="color:#ff79c6">&amp;amp;&lt;/span> SELECTOR_FLAG_ALLCHANNELS) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 70&lt;/span>&lt;span> &lt;span style="color:#6272a4">//åŒæ ·,å¦‚æœå·²ç»å…è®¸æ‰€æœ‰channeläº†,å†å»é™åˆ¶channel,ä¹Ÿä¼šæŠ¥é”™
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 71&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> errno &lt;span style="color:#ff79c6">=&lt;/span> EISDIR;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 72&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> C_ERR;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 73&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 74&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (&lt;span style="color:#50fa7b">ACLStringHasSpaces&lt;/span>(op&lt;span style="color:#ff79c6">+&lt;/span>&lt;span style="color:#bd93f9">1&lt;/span>,oplen&lt;span style="color:#ff79c6">-&lt;/span>&lt;span style="color:#bd93f9">1&lt;/span>)) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 75&lt;/span>&lt;span> errno &lt;span style="color:#ff79c6">=&lt;/span> EINVAL;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 76&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> C_ERR;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 77&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 78&lt;/span>&lt;span> sds newpat &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#50fa7b">sdsnewlen&lt;/span>(op&lt;span style="color:#ff79c6">+&lt;/span>&lt;span style="color:#bd93f9">1&lt;/span>,oplen&lt;span style="color:#ff79c6">-&lt;/span>&lt;span style="color:#bd93f9">1&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 79&lt;/span>&lt;span> listNode &lt;span style="color:#ff79c6">*&lt;/span>ln &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#50fa7b">listSearchKey&lt;/span>(selector&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>channels,newpat);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 80&lt;/span>&lt;span> &lt;span style="color:#6272a4">//åŒæ ·,ä¹Ÿä¼šå¯¹channel pattern å»é‡
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 81&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">if&lt;/span> (ln &lt;span style="color:#ff79c6">==&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">NULL&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 82&lt;/span>&lt;span> &lt;span style="color:#50fa7b">listAddNodeTail&lt;/span>(selector&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>channels,newpat);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 83&lt;/span>&lt;span> &lt;span style="color:#ff79c6">else&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 84&lt;/span>&lt;span> &lt;span style="color:#50fa7b">sdsfree&lt;/span>(newpat);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 85&lt;/span>&lt;span> selector&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>flags &lt;span style="color:#ff79c6">&amp;amp;=&lt;/span> &lt;span style="color:#ff79c6">~&lt;/span>SELECTOR_FLAG_ALLCHANNELS;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 86&lt;/span>&lt;span> } &lt;span style="color:#ff79c6">else&lt;/span> &lt;span style="color:#ff79c6">if&lt;/span> (op[&lt;span style="color:#bd93f9">0&lt;/span>] &lt;span style="color:#ff79c6">==&lt;/span> &lt;span style="color:#f1fa8c">&amp;#39;+&amp;#39;&lt;/span> &lt;span style="color:#ff79c6">&amp;amp;&amp;amp;&lt;/span> op[&lt;span style="color:#bd93f9">1&lt;/span>] &lt;span style="color:#ff79c6">!=&lt;/span> &lt;span style="color:#f1fa8c">&amp;#39;@&amp;#39;&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 87&lt;/span>&lt;span> &lt;span style="color:#6272a4">//åŠ å‘½ä»¤æƒé™ (æ²¡æœ‰åœ¨ ACL CATåˆ†ç±»é‡Œçš„)
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 88&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#6272a4">//å¦‚æœä¸€ä¸ªå‘½ä»¤æ²¡æœ‰åœ¨åˆ†ç±»é‡Œ,å¯ä»¥é€šè¿‡å‰ç¼€æ¥åšåŒ¹é…,æ¯”å¦‚
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 89&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#6272a4">//DBæä¾›æ‰§è¡ŒSELECTçš„èƒ½åŠ›ï¼Œä½†å¯èƒ½ä»ç„¶å¸Œæœ›èƒ½å¤Ÿè¿è¡ŒSELECT 0ã€‚
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 90&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#6272a4">//ACL SETUSER myuser -select +select|0
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 91&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">if&lt;/span> (&lt;span style="color:#50fa7b">strrchr&lt;/span>(op,&lt;span style="color:#f1fa8c">&amp;#39;|&amp;#39;&lt;/span>) &lt;span style="color:#ff79c6">==&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">NULL&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 92&lt;/span>&lt;span> &lt;span style="color:#6272a4">//å¦‚æœopå­—ç¬¦ä¸²ä¸­æ²¡æœ‰ `|` ä¸éœ€è¦å¤„ç†å‰ç¼€, ç›´æ¥å¤„ç†å³å¯
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 93&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#6272a4">//éœ€è¦å…ˆå¤„ç†ä¸€ä¸‹é‡å‘½åçš„å‘½ä»¤
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 94&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">struct&lt;/span> redisCommand &lt;span style="color:#ff79c6">*&lt;/span>cmd &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#50fa7b">ACLLookupCommand&lt;/span>(op&lt;span style="color:#ff79c6">+&lt;/span>&lt;span style="color:#bd93f9">1&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 95&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (cmd &lt;span style="color:#ff79c6">==&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">NULL&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 96&lt;/span>&lt;span> errno &lt;span style="color:#ff79c6">=&lt;/span> ENOENT;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 97&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> C_ERR;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 98&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 99&lt;/span>&lt;span> &lt;span style="color:#6272a4">//å¤„ç†ç¦ç”¨å’Œå…è®¸çš„å‘½ä»¤,åŒ…æ‹¬å­å‘½ä»¤
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">100&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#50fa7b">ACLChangeSelectorPerm&lt;/span>(selector,cmd,&lt;span style="color:#bd93f9">1&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">101&lt;/span>&lt;span> } &lt;span style="color:#ff79c6">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">102&lt;/span>&lt;span> &lt;span style="color:#6272a4">//åˆ†å‰²å­—ç¬¦ä¸²,å¾—åˆ°å­å‘½ä»¤
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">103&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#8be9fd">char&lt;/span> &lt;span style="color:#ff79c6">*&lt;/span>copy &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#50fa7b">zstrdup&lt;/span>(op&lt;span style="color:#ff79c6">+&lt;/span>&lt;span style="color:#bd93f9">1&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">104&lt;/span>&lt;span> &lt;span style="color:#8be9fd">char&lt;/span> &lt;span style="color:#ff79c6">*&lt;/span>sub &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#50fa7b">strrchr&lt;/span>(copy,&lt;span style="color:#f1fa8c">&amp;#39;|&amp;#39;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">105&lt;/span>&lt;span> sub[&lt;span style="color:#bd93f9">0&lt;/span>] &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#f1fa8c">&amp;#39;\0&amp;#39;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">106&lt;/span>&lt;span> sub&lt;span style="color:#ff79c6">++&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">107&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">108&lt;/span>&lt;span> &lt;span style="color:#ff79c6">struct&lt;/span> redisCommand &lt;span style="color:#ff79c6">*&lt;/span>cmd &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#50fa7b">ACLLookupCommand&lt;/span>(copy);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">109&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">110&lt;/span>&lt;span> &lt;span style="color:#6272a4">/* Check if the command exists. We can&amp;#39;t check the
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">111&lt;/span>&lt;span>&lt;span style="color:#6272a4"> * first-arg to see if it is valid. */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">112&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (cmd &lt;span style="color:#ff79c6">==&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">NULL&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">113&lt;/span>&lt;span> &lt;span style="color:#50fa7b">zfree&lt;/span>(copy);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">114&lt;/span>&lt;span> errno &lt;span style="color:#ff79c6">=&lt;/span> ENOENT;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">115&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> C_ERR;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">116&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">117&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">118&lt;/span>&lt;span> &lt;span style="color:#6272a4">//ä¸èƒ½ç›´æ¥ä½œç”¨äºå­å‘½ä»¤
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">119&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">if&lt;/span> (cmd&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>parent) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">120&lt;/span>&lt;span> &lt;span style="color:#50fa7b">zfree&lt;/span>(copy);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">121&lt;/span>&lt;span> errno &lt;span style="color:#ff79c6">=&lt;/span> ECHILD;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">122&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> C_ERR;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">123&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">124&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">125&lt;/span>&lt;span> &lt;span style="color:#6272a4">//å­å‘½ä»¤ä¸èƒ½æ˜¯ç©ºçš„,æ¯”å¦‚ `HASH|` è¿™ç§æ˜¯ä¸åˆæ³•çš„
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">126&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">if&lt;/span> (&lt;span style="color:#50fa7b">strlen&lt;/span>(sub) &lt;span style="color:#ff79c6">==&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">127&lt;/span>&lt;span> &lt;span style="color:#50fa7b">zfree&lt;/span>(copy);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">128&lt;/span>&lt;span> errno &lt;span style="color:#ff79c6">=&lt;/span> EINVAL;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">129&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> C_ERR;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">130&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">131&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">132&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (cmd&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>subcommands_dict) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">133&lt;/span>&lt;span> &lt;span style="color:#6272a4">//è¿™ä¸ªå‘½ä»¤æœ‰å­å‘½ä»¤,å¤„ç†å­å‘½ä»¤
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">134&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> cmd &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#50fa7b">ACLLookupCommand&lt;/span>(op&lt;span style="color:#ff79c6">+&lt;/span>&lt;span style="color:#bd93f9">1&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">135&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (cmd &lt;span style="color:#ff79c6">==&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">NULL&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">136&lt;/span>&lt;span> &lt;span style="color:#50fa7b">zfree&lt;/span>(copy);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">137&lt;/span>&lt;span> errno &lt;span style="color:#ff79c6">=&lt;/span> ENOENT;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">138&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> C_ERR;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">139&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">140&lt;/span>&lt;span> &lt;span style="color:#50fa7b">ACLChangeSelectorPerm&lt;/span>(selector,cmd,&lt;span style="color:#bd93f9">1&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">141&lt;/span>&lt;span> } &lt;span style="color:#ff79c6">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">142&lt;/span>&lt;span> &lt;span style="color:#6272a4">/* If user is trying to use the ACL mech to block SELECT except SELECT 0 or
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">143&lt;/span>&lt;span>&lt;span style="color:#6272a4"> * block DEBUG except DEBUG OBJECT (DEBUG subcommands are not considered
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">144&lt;/span>&lt;span>&lt;span style="color:#6272a4"> * subcommands for now) we use the allowed_firstargs mechanism. */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">145&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">146&lt;/span>&lt;span> &lt;span style="color:#6272a4">/* Add the first-arg to the list of valid ones. */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">147&lt;/span>&lt;span> &lt;span style="color:#50fa7b">serverLog&lt;/span>(LL_WARNING, &lt;span style="color:#f1fa8c">&amp;#34;Deprecation warning: Allowing a first arg of an otherwise &amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">148&lt;/span>&lt;span> &lt;span style="color:#f1fa8c">&amp;#34;blocked command is a misuse of ACL and may get disabled &amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">149&lt;/span>&lt;span> &lt;span style="color:#f1fa8c">&amp;#34;in the future (offender: +%s)&amp;#34;&lt;/span>, op&lt;span style="color:#ff79c6">+&lt;/span>&lt;span style="color:#bd93f9">1&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">150&lt;/span>&lt;span> &lt;span style="color:#50fa7b">ACLAddAllowedFirstArg&lt;/span>(selector,cmd&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>id,sub);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">151&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">152&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">153&lt;/span>&lt;span> &lt;span style="color:#50fa7b">zfree&lt;/span>(copy);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">154&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">155&lt;/span>&lt;span> } &lt;span style="color:#ff79c6">else&lt;/span> &lt;span style="color:#ff79c6">if&lt;/span> (op[&lt;span style="color:#bd93f9">0&lt;/span>] &lt;span style="color:#ff79c6">==&lt;/span> &lt;span style="color:#f1fa8c">&amp;#39;-&amp;#39;&lt;/span> &lt;span style="color:#ff79c6">&amp;amp;&amp;amp;&lt;/span> op[&lt;span style="color:#bd93f9">1&lt;/span>] &lt;span style="color:#ff79c6">!=&lt;/span> &lt;span style="color:#f1fa8c">&amp;#39;@&amp;#39;&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">156&lt;/span>&lt;span> &lt;span style="color:#6272a4">//å»æ‰ å‘½ä»¤æƒé™ (æ²¡æœ‰åœ¨ ACL CATåˆ†ç±»é‡Œçš„)
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">157&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">struct&lt;/span> redisCommand &lt;span style="color:#ff79c6">*&lt;/span>cmd &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#50fa7b">ACLLookupCommand&lt;/span>(op&lt;span style="color:#ff79c6">+&lt;/span>&lt;span style="color:#bd93f9">1&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">158&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (cmd &lt;span style="color:#ff79c6">==&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">NULL&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">159&lt;/span>&lt;span> errno &lt;span style="color:#ff79c6">=&lt;/span> ENOENT;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">160&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> C_ERR;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">161&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">162&lt;/span>&lt;span> &lt;span style="color:#50fa7b">ACLChangeSelectorPerm&lt;/span>(selector,cmd,&lt;span style="color:#bd93f9">0&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">163&lt;/span>&lt;span> } &lt;span style="color:#ff79c6">else&lt;/span> &lt;span style="color:#ff79c6">if&lt;/span> ((op[&lt;span style="color:#bd93f9">0&lt;/span>] &lt;span style="color:#ff79c6">==&lt;/span> &lt;span style="color:#f1fa8c">&amp;#39;+&amp;#39;&lt;/span> &lt;span style="color:#ff79c6">||&lt;/span> op[&lt;span style="color:#bd93f9">0&lt;/span>] &lt;span style="color:#ff79c6">==&lt;/span> &lt;span style="color:#f1fa8c">&amp;#39;-&amp;#39;&lt;/span>) &lt;span style="color:#ff79c6">&amp;amp;&amp;amp;&lt;/span> op[&lt;span style="color:#bd93f9">1&lt;/span>] &lt;span style="color:#ff79c6">==&lt;/span> &lt;span style="color:#f1fa8c">&amp;#39;@&amp;#39;&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">164&lt;/span>&lt;span> &lt;span style="color:#6272a4">//åŠ æˆ–è€…å‡æƒé™ (åªå¤„ç†åœ¨ACL CATåˆ†ç±»é‡Œçš„)
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">165&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#8be9fd">int&lt;/span> bitval &lt;span style="color:#ff79c6">=&lt;/span> op[&lt;span style="color:#bd93f9">0&lt;/span>] &lt;span style="color:#ff79c6">==&lt;/span> &lt;span style="color:#f1fa8c">&amp;#39;+&amp;#39;&lt;/span> &lt;span style="color:#ff79c6">?&lt;/span> &lt;span style="color:#bd93f9">1&lt;/span> &lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">166&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (&lt;span style="color:#50fa7b">ACLSetSelectorCommandBitsForCategory&lt;/span>(selector,op&lt;span style="color:#ff79c6">+&lt;/span>&lt;span style="color:#bd93f9">2&lt;/span>,bitval) &lt;span style="color:#ff79c6">==&lt;/span> C_ERR) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">167&lt;/span>&lt;span> errno &lt;span style="color:#ff79c6">=&lt;/span> ENOENT;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">168&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> C_ERR;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">169&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">170&lt;/span>&lt;span> } &lt;span style="color:#ff79c6">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">171&lt;/span>&lt;span> errno &lt;span style="color:#ff79c6">=&lt;/span> EINVAL;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">172&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> C_ERR;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">173&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">174&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> C_OK;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">175&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æƒé™è®¾ç½®ç›¸å…³çš„å·®ä¸å¤šå°±æ˜¯è¿™äº›äº†ï¼ŒåŸºæœ¬éƒ½æ˜¯å¾—åˆ°å­—ç¬¦ä¸²åï¼Œå¤„ç†å­—ç¬¦ä¸²ï¼Œç„¶åå¤„ç†å¯¹åº”çš„æƒé™ã€‚ä»£ç é‡ä¸å°ï¼Œå…¶ä¸­ä¸€äº›ç»†èŠ‚æ²¡æœ‰è¯¦ç»†å±•å¼€åˆ†æï¼Œé€»è¾‘éƒ½ä¸å¤ªå¤æ‚ï¼Œåé¢æœ‰æ—¶é—´ä¼šè€ƒè™‘æŠŠè¿™é‡Œçš„å‘å¡«ä¸Šã€‚&lt;/p>
&lt;h3 id="aclè§„åˆ™å­˜å‚¨">&lt;a href="#acl%e8%a7%84%e5%88%99%e5%ad%98%e5%82%a8" class="header-anchor">&lt;/a>ACLè§„åˆ™å­˜å‚¨
&lt;/h3>&lt;p>ä½¿ç”¨ &lt;code>ACL SETUSER &lt;/code>å‘½ä»¤è®¾ç½®çš„è§„åˆ™ï¼Œé»˜è®¤åªä¼šå­˜åœ¨å†…å­˜ä¸­ï¼Œå¦‚æœæ²¡æœ‰è°ƒç”¨&lt;code>ACL SAVE&lt;/code>å‘½ä»¤è¿›è¡Œå­˜å‚¨ï¼Œredisé‡å¯åä¼šä¸¢å¤±æ‰€æœ‰ ç”¨æˆ·ä¿¡æ¯&lt;/p>
&lt;p>ä½¿ç”¨&lt;code>ACL SAVE&lt;/code> å‘½ä»¤çš„å‰ææ˜¯ redis é…ç½®äº† ACL æ–‡ä»¶ï¼Œå¦‚æœæ²¡æœ‰é…ç½® ACL æ–‡ä»¶ï¼Œé‚£ä¹ˆ ä½¿ç”¨ &lt;code>ACL SAVE&lt;/code>å‘½ä»¤ä¼šæŠ¥é”™&lt;/p>
&lt;p>ä½¿ç”¨ &lt;code>ACL SAVE&lt;/code> å’Œ &lt;code>ACL LIST&lt;/code>æœ€ç»ˆéƒ½ä¼šè°ƒç”¨è¿™ä¸ªå‡½æ•°æ¥ç”Ÿæˆ ACL è§„åˆ™çš„å­—ç¬¦ä¸²&lt;/p>
&lt;p>&lt;a class="link" href="https://github.com/redis/redis/blob/391aa4079c0855aa20929b1e272403937e874d57/src/acl.c#L818" target="_blank" rel="noopener"
>ACLDescribeUser&lt;/a>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-C" data-lang="C">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>robj &lt;span style="color:#ff79c6">*&lt;/span>&lt;span style="color:#50fa7b">ACLDescribeUser&lt;/span>(user &lt;span style="color:#ff79c6">*&lt;/span>u) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (u&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>acl_string) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span> &lt;span style="color:#50fa7b">incrRefCount&lt;/span>(u&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>acl_string);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> u&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>acl_string;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span> sds res &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#50fa7b">sdsempty&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span> å…ˆå¤„ç†flag
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span> &lt;span style="color:#ff79c6">for&lt;/span> (&lt;span style="color:#8be9fd">int&lt;/span> j &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>; ACLUserFlags[j].flag; j&lt;span style="color:#ff79c6">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (u&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>flags &lt;span style="color:#ff79c6">&amp;amp;&lt;/span> ACLUserFlags[j].flag) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span> res &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#50fa7b">sdscat&lt;/span>(res,ACLUserFlags[j].name);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span> res &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#50fa7b">sdscatlen&lt;/span>(res,&lt;span style="color:#f1fa8c">&amp;#34; &amp;#34;&lt;/span>,&lt;span style="color:#bd93f9">1&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17&lt;/span>&lt;span> &lt;span style="color:#6272a4">//å¤„ç†å¯†ç 
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> listIter li;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19&lt;/span>&lt;span> listNode &lt;span style="color:#ff79c6">*&lt;/span>ln;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20&lt;/span>&lt;span> &lt;span style="color:#50fa7b">listRewind&lt;/span>(u&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>passwords,&lt;span style="color:#ff79c6">&amp;amp;&lt;/span>li);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21&lt;/span>&lt;span> &lt;span style="color:#ff79c6">while&lt;/span>((ln &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#50fa7b">listNext&lt;/span>(&lt;span style="color:#ff79c6">&amp;amp;&lt;/span>li))) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22&lt;/span>&lt;span> sds thispass &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#50fa7b">listNodeValue&lt;/span>(ln);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23&lt;/span>&lt;span> res &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#50fa7b">sdscatlen&lt;/span>(res,&lt;span style="color:#f1fa8c">&amp;#34;#&amp;#34;&lt;/span>,&lt;span style="color:#bd93f9">1&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24&lt;/span>&lt;span> res &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#50fa7b">sdscatsds&lt;/span>(res,thispass);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25&lt;/span>&lt;span> res &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#50fa7b">sdscatlen&lt;/span>(res,&lt;span style="color:#f1fa8c">&amp;#34; &amp;#34;&lt;/span>,&lt;span style="color:#bd93f9">1&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28&lt;/span>&lt;span> &lt;span style="color:#6272a4">//ç”Ÿæˆ selectorçš„è§„åˆ™å­—ç¬¦ä¸²
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#50fa7b">listRewind&lt;/span>(u&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>selectors,&lt;span style="color:#ff79c6">&amp;amp;&lt;/span>li);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30&lt;/span>&lt;span> &lt;span style="color:#ff79c6">while&lt;/span>((ln &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#50fa7b">listNext&lt;/span>(&lt;span style="color:#ff79c6">&amp;amp;&lt;/span>li))) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31&lt;/span>&lt;span> aclSelector &lt;span style="color:#ff79c6">*&lt;/span>selector &lt;span style="color:#ff79c6">=&lt;/span> (aclSelector &lt;span style="color:#ff79c6">*&lt;/span>) &lt;span style="color:#50fa7b">listNodeValue&lt;/span>(ln);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32&lt;/span>&lt;span> &lt;span style="color:#6272a4">//é€šè¿‡ ACLDescribeSelector ç”Ÿæˆ selectorçš„è§„åˆ™å­—ç¬¦ä¸²
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#6272a4">//è¿™é‡Œé¢çš„å¤„ç†å¦‚æœè¯¦ç»†æ¥æ‹†åˆ†çš„è¯,è¿˜æ˜¯æœ‰ç‚¹å¤šçš„,å°±ä¸å±•å¼€äº†
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> sds default_perm &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#50fa7b">ACLDescribeSelector&lt;/span>(selector);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35&lt;/span>&lt;span> &lt;span style="color:#6272a4">//è¿™é‡Œéœ€è¦æ³¨æ„ä¸€ä¸‹, å¦‚æœæ˜¯éroot selector, è§„åˆ™éœ€è¦ç”¨ () åŒ…è£¹
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">if&lt;/span> (selector&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>flags &lt;span style="color:#ff79c6">&amp;amp;&lt;/span> SELECTOR_FLAG_ROOT) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37&lt;/span>&lt;span> res &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#50fa7b">sdscatfmt&lt;/span>(res, &lt;span style="color:#f1fa8c">&amp;#34;%s&amp;#34;&lt;/span>, default_perm);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38&lt;/span>&lt;span> } &lt;span style="color:#ff79c6">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39&lt;/span>&lt;span> res &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#50fa7b">sdscatfmt&lt;/span>(res, &lt;span style="color:#f1fa8c">&amp;#34; (%s)&amp;#34;&lt;/span>, default_perm);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41&lt;/span>&lt;span> &lt;span style="color:#50fa7b">sdsfree&lt;/span>(default_perm);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44&lt;/span>&lt;span> u&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>acl_string &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#50fa7b">createObject&lt;/span>(OBJ_STRING, res);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45&lt;/span>&lt;span> &lt;span style="color:#6272a4">/* because we are returning it, have to increase count */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46&lt;/span>&lt;span> &lt;span style="color:#50fa7b">incrRefCount&lt;/span>(u&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>acl_string);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> u&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>acl_string;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="aclé‰´æƒ">&lt;a href="#acl%e9%89%b4%e6%9d%83" class="header-anchor">&lt;/a>ACLé‰´æƒ
&lt;/h3>&lt;p>ä¸‹é¢å¼€å§‹åˆ†æ é‰´æƒç›¸å…³çš„ä»£ç ã€‚&lt;/p>
&lt;p>ä¸Šé¢çš„åŸºæœ¬æ˜¯å’Œæƒé™è®¾ç½®ç›¸å…³çš„ï¼Œæœ‰äº†æƒé™åï¼Œè¦æ‰§è¡Œå‘½ä»¤æ—¶ï¼Œéœ€è¦åˆ¤æ–­æ˜¯å¦å¯ä»¥æ‰§è¡Œï¼Œè¿™éƒ¨åˆ†å°±æ˜¯é‰´æƒäº†ã€‚&lt;/p>
&lt;p>å…ˆæ¥æœ€åŸºæœ¬çš„ &lt;code>AUTH&lt;/code> å‘½ä»¤&lt;/p>
&lt;p>&lt;a class="link" href="https://github.com/redis/redis/blob/391aa4079c0855aa20929b1e272403937e874d57/src/acl.c#L3003" target="_blank" rel="noopener"
>authCommand&lt;/a>&lt;/p>
&lt;p>&lt;code>AUTH&lt;/code> å‘½ä»¤å…¼å®¹ä»¥å‰çš„å‘½ä»¤å‚æ•°ï¼Œä¼šæ ¹æ®å‚æ•°çš„ä¸ªæ•°åˆ¤æ–­å‘½åçš„ç‰ˆæœ¬ï¼Œå¦‚æœå‚æ•°é•¿åº¦æ˜¯2ï¼Œä¼šä½¿ç”¨ä»¥å‰çš„æ¨¡å¼æ¥å¤„ç†ã€‚&lt;/p>
&lt;p>å¦‚æœå‚æ•°é•¿åº¦æ˜¯3ï¼Œä¼šæŒ‰ç…§ACLçš„æ¨¡å¼æ¥å¤„ç†&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-C" data-lang="C">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#8be9fd">void&lt;/span> &lt;span style="color:#50fa7b">authCommand&lt;/span>(client &lt;span style="color:#ff79c6">*&lt;/span>c) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span> &lt;span style="color:#6272a4">//å¦‚æœå‚æ•°&amp;gt;3äº†è¿™ä¸ªå‘½ä»¤æ˜¯é”™è¯¯çš„,ç›´æ¥è¿”å›
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">if&lt;/span> (c&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>argc &lt;span style="color:#ff79c6">&amp;gt;&lt;/span> &lt;span style="color:#bd93f9">3&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span> &lt;span style="color:#50fa7b">addReplyErrorObject&lt;/span>(c,shared.syntaxerr);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span> &lt;span style="color:#50fa7b">redactClientCommandArgument&lt;/span>(c, &lt;span style="color:#bd93f9">1&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span> &lt;span style="color:#6272a4">/* Handle the two different forms here. The form with two arguments
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span>&lt;span style="color:#6272a4"> * will just use &amp;#34;default&amp;#34; as username. */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span> robj &lt;span style="color:#ff79c6">*&lt;/span>username, &lt;span style="color:#ff79c6">*&lt;/span>password;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (c&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>argc &lt;span style="color:#ff79c6">==&lt;/span> &lt;span style="color:#bd93f9">2&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span> &lt;span style="color:#6272a4">//å¤„ç†ä¸¤ç§å‚æ•°çš„æƒ…å†µ,å¦‚æœé»˜è®¤ç”¨æˆ·æ˜¯æ²¡æœ‰å¯†ç çš„, è¿”å›é”™è°
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">if&lt;/span> (DefaultUser&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>flags &lt;span style="color:#ff79c6">&amp;amp;&lt;/span> USER_FLAG_NOPASS) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15&lt;/span>&lt;span> &lt;span style="color:#50fa7b">addReplyError&lt;/span>(c,&lt;span style="color:#f1fa8c">&amp;#34;AUTH &amp;lt;password&amp;gt; called without any password &amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16&lt;/span>&lt;span> &lt;span style="color:#f1fa8c">&amp;#34;configured for the default user. Are you sure &amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17&lt;/span>&lt;span> &lt;span style="color:#f1fa8c">&amp;#34;your configuration is correct?&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21&lt;/span>&lt;span> username &lt;span style="color:#ff79c6">=&lt;/span> shared.default_username;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22&lt;/span>&lt;span> password &lt;span style="color:#ff79c6">=&lt;/span> c&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>argv[&lt;span style="color:#bd93f9">1&lt;/span>];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23&lt;/span>&lt;span> } &lt;span style="color:#ff79c6">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24&lt;/span>&lt;span> &lt;span style="color:#6272a4">//å¤„ç†ä¸‰ç§å‚æ•°çš„æƒ…å†µ
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> username &lt;span style="color:#ff79c6">=&lt;/span> c&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>argv[&lt;span style="color:#bd93f9">1&lt;/span>];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26&lt;/span>&lt;span> password &lt;span style="color:#ff79c6">=&lt;/span> c&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>argv[&lt;span style="color:#bd93f9">2&lt;/span>];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27&lt;/span>&lt;span> &lt;span style="color:#50fa7b">redactClientCommandArgument&lt;/span>(c, &lt;span style="color:#bd93f9">2&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29&lt;/span>&lt;span> &lt;span style="color:#6272a4">//æ ¡éªŒç”¨æˆ·åå’Œå¯†ç æ˜¯å¦åŒ¹é…
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">if&lt;/span> (&lt;span style="color:#50fa7b">ACLAuthenticateUser&lt;/span>(c,username,password) &lt;span style="color:#ff79c6">==&lt;/span> C_OK) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31&lt;/span>&lt;span> &lt;span style="color:#50fa7b">addReply&lt;/span>(c,shared.ok);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32&lt;/span>&lt;span> } &lt;span style="color:#ff79c6">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33&lt;/span>&lt;span> &lt;span style="color:#50fa7b">addReplyError&lt;/span>(c,&lt;span style="color:#f1fa8c">&amp;#34;-WRONGPASS invalid username-password pair or user is disabled.&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>AUTH&lt;/code> å‘½ä»¤å¤„ç†è¿˜æ˜¯æŒºç®€å•çš„ï¼Œä¸‹é¢å¼€å§‹ACLå¯¹å…·ä½“å‘½ä»¤çš„åˆ¤æ–­&lt;/p>
&lt;p>å½“ä¸€ä¸ªå‘½ä»¤è¿›æ¥åï¼Œredisè¦å…ˆåˆ¤æ–­å‘½ä»¤æ˜¯å¦èƒ½æ‰§è¡Œï¼Œä» &lt;a class="link" href="https://github.com/redis/redis/blob/391aa4079c0855aa20929b1e272403937e874d57/src/server.c#L3769" target="_blank" rel="noopener"
>server.c:3769&lt;/a> å¼€å§‹ï¼Œè°ƒç”¨&lt;code>ACLCheckAllPerm&lt;/code>å‡½æ•°ã€‚&lt;/p>
&lt;p>æœ€ç»ˆä¼šè°ƒç”¨åˆ° &lt;a class="link" href="https://github.com/redis/redis/blob/391aa4079c0855aa20929b1e272403937e874d57/src/acl.c#L1767" target="_blank" rel="noopener"
>ACLCheckAllUserCommandPerm&lt;/a> å‡½æ•°å»åšå…·ä½“çš„æ ¡éªŒé€»è¾‘&lt;/p>
&lt;p>ä¼šéå†&lt;code>user&lt;/code>çš„ &lt;code>Selectors&lt;/code> è¿™ä¸ªé“¾è¡¨æ¥åšé‰´æƒ&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-C" data-lang="C">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span> &lt;span style="color:#50fa7b">listRewind&lt;/span>(u&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>selectors,&lt;span style="color:#ff79c6">&amp;amp;&lt;/span>li);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span> &lt;span style="color:#ff79c6">while&lt;/span>((ln &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#50fa7b">listNext&lt;/span>(&lt;span style="color:#ff79c6">&amp;amp;&lt;/span>li))) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span> aclSelector &lt;span style="color:#ff79c6">*&lt;/span>s &lt;span style="color:#ff79c6">=&lt;/span> (aclSelector &lt;span style="color:#ff79c6">*&lt;/span>) &lt;span style="color:#50fa7b">listNodeValue&lt;/span>(ln);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span> &lt;span style="color:#8be9fd">int&lt;/span> acl_retval &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#50fa7b">ACLSelectorCheckCmd&lt;/span>(s, cmd, argv, argc, &lt;span style="color:#ff79c6">&amp;amp;&lt;/span>local_idxptr, &lt;span style="color:#ff79c6">&amp;amp;&lt;/span>cache);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (acl_retval &lt;span style="color:#ff79c6">==&lt;/span> ACL_OK) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span> &lt;span style="color:#6272a4">//å¦‚æœé€šè¿‡æ ¡éªŒäº†,å¯ä»¥ç»“æŸå¾ªç¯,ç„¶åè¿”å›æ­£ç¡®
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#50fa7b">cleanupACLKeyResultCache&lt;/span>(&lt;span style="color:#ff79c6">&amp;amp;&lt;/span>cache);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> ACL_OK;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (acl_retval &lt;span style="color:#ff79c6">&amp;gt;&lt;/span> relevant_error &lt;span style="color:#ff79c6">||&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span> (acl_retval &lt;span style="color:#ff79c6">==&lt;/span> relevant_error &lt;span style="color:#ff79c6">&amp;amp;&amp;amp;&lt;/span> local_idxptr &lt;span style="color:#ff79c6">&amp;gt;&lt;/span> last_idx))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span> relevant_error &lt;span style="color:#ff79c6">=&lt;/span> acl_retval;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span> last_idx &lt;span style="color:#ff79c6">=&lt;/span> local_idxptr;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>åšé‰´æƒåˆ¤æ–­çš„æ˜¯è¿™ä¸ªå‡½æ•°&lt;code>ACLSelectorCheckCmd&lt;/code>&lt;/p>
&lt;p>&lt;a class="link" href="https://github.com/redis/redis/blob/391aa4079c0855aa20929b1e272403937e874d57/src/acl.c#L1612" target="_blank" rel="noopener"
>ACLSelectorCheckCmd&lt;/a>&lt;/p>
&lt;p>é‰´æƒçš„ä¼˜å…ˆçº§&lt;/p>
&lt;ol>
&lt;li>åˆ¤æ–­å‘½ä»¤ç±»å‹ï¼Œæ¯”å¦‚&lt;code>GET&lt;/code>,&lt;code>SET&lt;/code>,&lt;code>HGET&lt;/code> ç­‰ç­‰,åˆ¤æ–­æ˜¯å¦æœ‰è¿™ä¸ªç±»å‹å‘½ä»¤çš„æƒé™&lt;/li>
&lt;li>åˆ¤æ–­keyåï¼Œé€šè¿‡å¯¹æ¯”keyçš„åå­—ï¼Œåˆ¤æ–­è¿™ä¸ªkeyæ˜¯å¦æœ‰æƒé™&lt;/li>
&lt;li>åˆ¤æ–­æ˜¯å¦æ˜¯channelå‘½ä»¤ï¼Œç„¶ååˆ¤æ–­æƒé™&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-C" data-lang="C">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">static&lt;/span> &lt;span style="color:#8be9fd">int&lt;/span> &lt;span style="color:#50fa7b">ACLSelectorCheckCmd&lt;/span>(aclSelector &lt;span style="color:#ff79c6">*&lt;/span>selector, &lt;span style="color:#ff79c6">struct&lt;/span> redisCommand &lt;span style="color:#ff79c6">*&lt;/span>cmd, robj &lt;span style="color:#ff79c6">**&lt;/span>argv, &lt;span style="color:#8be9fd">int&lt;/span> argc, &lt;span style="color:#8be9fd">int&lt;/span> &lt;span style="color:#ff79c6">*&lt;/span>keyidxptr, aclKeyResultCache &lt;span style="color:#ff79c6">*&lt;/span>cache) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span> &lt;span style="color:#8be9fd">uint64_t&lt;/span> id &lt;span style="color:#ff79c6">=&lt;/span> cmd&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>id;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span> &lt;span style="color:#8be9fd">int&lt;/span> ret;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span> &lt;span style="color:#6272a4">//å¦‚æœ flags ä¸æ˜¯å…¨éƒ¨ ALLCOMMANDS å¹¶ä¸” è¿™ä¸ªå‘½ä»¤ä¸æ˜¯ä¸éœ€è¦éªŒè¯çš„å‘½ä»¤(è¿™ä¸ªå‘½ä»¤éœ€è¦authåæ‰èƒ½ä½¿ç”¨)
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#6272a4">//CMD_NO_AUTHå‘½ä»¤åŒ…æ‹¬ `auth`,`hello`,`quit`,`reset`
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">if&lt;/span> (&lt;span style="color:#ff79c6">!&lt;/span>(selector&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>flags &lt;span style="color:#ff79c6">&amp;amp;&lt;/span> SELECTOR_FLAG_ALLCOMMANDS) &lt;span style="color:#ff79c6">&amp;amp;&amp;amp;&lt;/span> &lt;span style="color:#ff79c6">!&lt;/span>(cmd&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>flags &lt;span style="color:#ff79c6">&amp;amp;&lt;/span> CMD_NO_AUTH)) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span> &lt;span style="color:#6272a4">//å¦‚æœå‘½ä»¤bité‡Œæ²¡æœ‰æ‰¾åˆ°,éœ€è¦å†å»åŒ¹é…ä¸€ä¸‹å‰ç¼€,é˜²æ­¢æ¼åˆ¤
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">if&lt;/span> (&lt;span style="color:#50fa7b">ACLGetSelectorCommandBit&lt;/span>(selector,id) &lt;span style="color:#ff79c6">==&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span> &lt;span style="color:#6272a4">/* Check if the first argument matches. */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (argc &lt;span style="color:#ff79c6">&amp;lt;&lt;/span> &lt;span style="color:#bd93f9">2&lt;/span> &lt;span style="color:#ff79c6">||&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span> selector&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>allowed_firstargs &lt;span style="color:#ff79c6">==&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">NULL&lt;/span> &lt;span style="color:#ff79c6">||&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span> selector&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>allowed_firstargs[id] &lt;span style="color:#ff79c6">==&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">NULL&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> ACL_DENIED_CMD;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17&lt;/span>&lt;span> &lt;span style="color:#8be9fd">long&lt;/span> subid &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18&lt;/span>&lt;span> &lt;span style="color:#6272a4">//éå†,æ¯”è¾ƒå‰ç¼€
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">while&lt;/span> (&lt;span style="color:#bd93f9">1&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (selector&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>allowed_firstargs[id][subid] &lt;span style="color:#ff79c6">==&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">NULL&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> ACL_DENIED_CMD;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22&lt;/span>&lt;span> &lt;span style="color:#8be9fd">int&lt;/span> idx &lt;span style="color:#ff79c6">=&lt;/span> cmd&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>parent &lt;span style="color:#ff79c6">?&lt;/span> &lt;span style="color:#bd93f9">2&lt;/span> &lt;span style="color:#ff79c6">:&lt;/span> &lt;span style="color:#bd93f9">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (&lt;span style="color:#ff79c6">!&lt;/span>&lt;span style="color:#50fa7b">strcasecmp&lt;/span>(argv[idx]&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>ptr,selector&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>allowed_firstargs[id][subid]))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24&lt;/span>&lt;span> &lt;span style="color:#ff79c6">break&lt;/span>; &lt;span style="color:#6272a4">/* First argument match found. Stop here. */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25&lt;/span>&lt;span> subid&lt;span style="color:#ff79c6">++&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30&lt;/span>&lt;span> &lt;span style="color:#6272a4">//å¦‚æœä¸æ˜¯å…è®¸æ‰€æœ‰çš„key å¹¶ä¸”è¿™ä¸ªå‘½ä»¤é‡Œ åŒ…å«äº†key
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#6272a4">//æ’é™¤ç±»ä¼¼ select 0 ç­‰ç­‰æ²¡æœ‰keyæ“ä½œçš„å‘½ä»¤
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">if&lt;/span> (&lt;span style="color:#ff79c6">!&lt;/span>(selector&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>flags &lt;span style="color:#ff79c6">&amp;amp;&lt;/span> SELECTOR_FLAG_ALLKEYS) &lt;span style="color:#ff79c6">&amp;amp;&amp;amp;&lt;/span> &lt;span style="color:#50fa7b">doesCommandHaveKeys&lt;/span>(cmd)) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33&lt;/span>&lt;span> &lt;span style="color:#6272a4">//è¿™é‡Œæœ‰ä¸€ä¸ªä»å‡½æ•°å¤–ä¼ è¿›æ¥çš„,ç”¨æ¥ç¼“å­˜key çš„ç»“æ„, å¦‚æœæ²¡æœ‰åˆå§‹åŒ–è¿‡,éœ€è¦åˆå§‹åŒ–ä¸€ä¸‹
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">if&lt;/span> (&lt;span style="color:#ff79c6">!&lt;/span>(cache&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>keys_init)) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35&lt;/span>&lt;span> cache&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>keys &lt;span style="color:#ff79c6">=&lt;/span> (getKeysResult) GETKEYS_RESULT_INIT;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36&lt;/span>&lt;span> &lt;span style="color:#6272a4">//è·å–åˆ°è¿™æ¡å‘½ä»¤ä¸­æ‰€æœ‰çš„key
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#50fa7b">getKeysFromCommandWithSpecs&lt;/span>(cmd, argv, argc, GET_KEYSPEC_DEFAULT, &lt;span style="color:#ff79c6">&amp;amp;&lt;/span>(cache&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>keys));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38&lt;/span>&lt;span> cache&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>keys_init &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#bd93f9">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40&lt;/span>&lt;span> getKeysResult &lt;span style="color:#ff79c6">*&lt;/span>result &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#ff79c6">&amp;amp;&lt;/span>(cache&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>keys);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41&lt;/span>&lt;span> keyReference &lt;span style="color:#ff79c6">*&lt;/span>resultidx &lt;span style="color:#ff79c6">=&lt;/span> result&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>keys;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42&lt;/span>&lt;span> &lt;span style="color:#ff79c6">for&lt;/span> (&lt;span style="color:#8be9fd">int&lt;/span> j &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>; j &lt;span style="color:#ff79c6">&amp;lt;&lt;/span> result&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>numkeys; j&lt;span style="color:#ff79c6">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43&lt;/span>&lt;span> &lt;span style="color:#8be9fd">int&lt;/span> idx &lt;span style="color:#ff79c6">=&lt;/span> resultidx[j].pos;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44&lt;/span>&lt;span> &lt;span style="color:#6272a4">//é€šè¿‡éå†æ‰€æœ‰çš„key,åˆ¤æ–­æ˜¯å¦ç¬¦åˆè§„åˆ™
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> ret &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#50fa7b">ACLSelectorCheckKey&lt;/span>(selector, argv[idx]&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>ptr, &lt;span style="color:#50fa7b">sdslen&lt;/span>(argv[idx]&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>ptr), resultidx[j].flags);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46&lt;/span>&lt;span> &lt;span style="color:#6272a4">//é‡åˆ°ä¸€ä¸ªä¸ç¬¦åˆçš„,ç›´æ¥å°±å¯ä»¥é€€å‡º,å¹¶è¿”å›é”™è¯¯
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">if&lt;/span> (ret &lt;span style="color:#ff79c6">!=&lt;/span> ACL_OK) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (keyidxptr) &lt;span style="color:#ff79c6">*&lt;/span>keyidxptr &lt;span style="color:#ff79c6">=&lt;/span> resultidx[j].pos;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> ret;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">51&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">52&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">53&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">54&lt;/span>&lt;span> &lt;span style="color:#6272a4">//æ£€æŸ¥channelçš„æƒé™,åªéœ€è¦æ£€æŸ¥ pub å’Œ subè¿™ä¸¤ä¸ªæƒé™å³å¯
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">55&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">const&lt;/span> &lt;span style="color:#8be9fd">int&lt;/span> channel_flags &lt;span style="color:#ff79c6">=&lt;/span> CMD_CHANNEL_PUBLISH &lt;span style="color:#ff79c6">|&lt;/span> CMD_CHANNEL_SUBSCRIBE;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">56&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (&lt;span style="color:#ff79c6">!&lt;/span>(selector&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>flags &lt;span style="color:#ff79c6">&amp;amp;&lt;/span> SELECTOR_FLAG_ALLCHANNELS) &lt;span style="color:#ff79c6">&amp;amp;&amp;amp;&lt;/span> &lt;span style="color:#50fa7b">doesCommandHaveChannelsWithFlags&lt;/span>(cmd, channel_flags)) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">57&lt;/span>&lt;span> getKeysResult channels &lt;span style="color:#ff79c6">=&lt;/span> (getKeysResult) GETKEYS_RESULT_INIT;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">58&lt;/span>&lt;span> &lt;span style="color:#50fa7b">getChannelsFromCommand&lt;/span>(cmd, argv, argc, &lt;span style="color:#ff79c6">&amp;amp;&lt;/span>channels);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">59&lt;/span>&lt;span> keyReference &lt;span style="color:#ff79c6">*&lt;/span>channelref &lt;span style="color:#ff79c6">=&lt;/span> channels.keys;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">60&lt;/span>&lt;span> &lt;span style="color:#ff79c6">for&lt;/span> (&lt;span style="color:#8be9fd">int&lt;/span> j &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>; j &lt;span style="color:#ff79c6">&amp;lt;&lt;/span> channels.numkeys; j&lt;span style="color:#ff79c6">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">61&lt;/span>&lt;span> &lt;span style="color:#8be9fd">int&lt;/span> idx &lt;span style="color:#ff79c6">=&lt;/span> channelref[j].pos;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">62&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (&lt;span style="color:#ff79c6">!&lt;/span>(channelref[j].flags &lt;span style="color:#ff79c6">&amp;amp;&lt;/span> channel_flags)) &lt;span style="color:#ff79c6">continue&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">63&lt;/span>&lt;span> &lt;span style="color:#8be9fd">int&lt;/span> is_pattern &lt;span style="color:#ff79c6">=&lt;/span> channelref[j].flags &lt;span style="color:#ff79c6">&amp;amp;&lt;/span> CMD_CHANNEL_PATTERN;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">64&lt;/span>&lt;span> &lt;span style="color:#6272a4">//å’ŒåŒ¹é…keyç±»ä¼¼,ä¹Ÿæ˜¯éå†åŒ¹é…,é‡åˆ°ä¸ç¬¦åˆçš„å°±ç»“æŸå¹¶è¿”å›é”™è¯¯
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">65&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#8be9fd">int&lt;/span> ret &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#50fa7b">ACLCheckChannelAgainstList&lt;/span>(selector&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>channels, argv[idx]&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>ptr, &lt;span style="color:#50fa7b">sdslen&lt;/span>(argv[idx]&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>ptr), is_pattern);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">66&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (ret &lt;span style="color:#ff79c6">!=&lt;/span> ACL_OK) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">67&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (keyidxptr) &lt;span style="color:#ff79c6">*&lt;/span>keyidxptr &lt;span style="color:#ff79c6">=&lt;/span> channelref[j].pos;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">68&lt;/span>&lt;span> &lt;span style="color:#50fa7b">getKeysFreeResult&lt;/span>(&lt;span style="color:#ff79c6">&amp;amp;&lt;/span>channels);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">69&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> ret;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">70&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">71&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">72&lt;/span>&lt;span> &lt;span style="color:#50fa7b">getKeysFreeResult&lt;/span>(&lt;span style="color:#ff79c6">&amp;amp;&lt;/span>channels);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">73&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">74&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> ACL_OK;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">75&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ACLé‰´æƒçš„åŸºæœ¬å°±æ˜¯è¿™äº›äº†&lt;/p>
&lt;h3 id="aclç›¸å…³çš„ä¸€äº›çŸ¥è¯†">&lt;a href="#acl%e7%9b%b8%e5%85%b3%e7%9a%84%e4%b8%80%e4%ba%9b%e7%9f%a5%e8%af%86" class="header-anchor">&lt;/a>ACLç›¸å…³çš„ä¸€äº›çŸ¥è¯†
&lt;/h3>&lt;p>&lt;a class="link" href="https://github.com/redis/redis/blob/391aa4079c0855aa20929b1e272403937e874d57/src/acl.c#L60-L61" target="_blank" rel="noopener"
>ACL ç›¸å…³çš„ä¸€äº›å®šä¹‰&lt;/a>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-C" data-lang="C">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#6272a4">//å‘½ä»¤åˆ†ç±»çš„å®šä¹‰
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span>&lt;span style="color:#ff79c6">struct&lt;/span> ACLCategoryItem {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span> &lt;span style="color:#ff79c6">const&lt;/span> &lt;span style="color:#8be9fd">char&lt;/span> &lt;span style="color:#ff79c6">*&lt;/span>name;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span> &lt;span style="color:#8be9fd">uint64_t&lt;/span> flag;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span>} ACLCommandCategories[] &lt;span style="color:#ff79c6">=&lt;/span> { &lt;span style="color:#6272a4">/* See redis.conf for details on each category. */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span> {&lt;span style="color:#f1fa8c">&amp;#34;keyspace&amp;#34;&lt;/span>, ACL_CATEGORY_KEYSPACE},
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span> {&lt;span style="color:#f1fa8c">&amp;#34;read&amp;#34;&lt;/span>, ACL_CATEGORY_READ},
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span> {&lt;span style="color:#f1fa8c">&amp;#34;write&amp;#34;&lt;/span>, ACL_CATEGORY_WRITE},
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span> {&lt;span style="color:#f1fa8c">&amp;#34;set&amp;#34;&lt;/span>, ACL_CATEGORY_SET},
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span> {&lt;span style="color:#f1fa8c">&amp;#34;sortedset&amp;#34;&lt;/span>, ACL_CATEGORY_SORTEDSET},
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span> {&lt;span style="color:#f1fa8c">&amp;#34;list&amp;#34;&lt;/span>, ACL_CATEGORY_LIST},
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span> {&lt;span style="color:#f1fa8c">&amp;#34;hash&amp;#34;&lt;/span>, ACL_CATEGORY_HASH},
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span> {&lt;span style="color:#f1fa8c">&amp;#34;string&amp;#34;&lt;/span>, ACL_CATEGORY_STRING},
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span> {&lt;span style="color:#f1fa8c">&amp;#34;bitmap&amp;#34;&lt;/span>, ACL_CATEGORY_BITMAP},
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15&lt;/span>&lt;span> {&lt;span style="color:#f1fa8c">&amp;#34;hyperloglog&amp;#34;&lt;/span>, ACL_CATEGORY_HYPERLOGLOG},
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16&lt;/span>&lt;span> {&lt;span style="color:#f1fa8c">&amp;#34;geo&amp;#34;&lt;/span>, ACL_CATEGORY_GEO},
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17&lt;/span>&lt;span> {&lt;span style="color:#f1fa8c">&amp;#34;stream&amp;#34;&lt;/span>, ACL_CATEGORY_STREAM},
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18&lt;/span>&lt;span> {&lt;span style="color:#f1fa8c">&amp;#34;pubsub&amp;#34;&lt;/span>, ACL_CATEGORY_PUBSUB},
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19&lt;/span>&lt;span> {&lt;span style="color:#f1fa8c">&amp;#34;admin&amp;#34;&lt;/span>, ACL_CATEGORY_ADMIN},
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20&lt;/span>&lt;span> {&lt;span style="color:#f1fa8c">&amp;#34;fast&amp;#34;&lt;/span>, ACL_CATEGORY_FAST},
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21&lt;/span>&lt;span> {&lt;span style="color:#f1fa8c">&amp;#34;slow&amp;#34;&lt;/span>, ACL_CATEGORY_SLOW},
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22&lt;/span>&lt;span> {&lt;span style="color:#f1fa8c">&amp;#34;blocking&amp;#34;&lt;/span>, ACL_CATEGORY_BLOCKING},
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23&lt;/span>&lt;span> {&lt;span style="color:#f1fa8c">&amp;#34;dangerous&amp;#34;&lt;/span>, ACL_CATEGORY_DANGEROUS},
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24&lt;/span>&lt;span> {&lt;span style="color:#f1fa8c">&amp;#34;connection&amp;#34;&lt;/span>, ACL_CATEGORY_CONNECTION},
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25&lt;/span>&lt;span> {&lt;span style="color:#f1fa8c">&amp;#34;transaction&amp;#34;&lt;/span>, ACL_CATEGORY_TRANSACTION},
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26&lt;/span>&lt;span> {&lt;span style="color:#f1fa8c">&amp;#34;scripting&amp;#34;&lt;/span>, ACL_CATEGORY_SCRIPTING},
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27&lt;/span>&lt;span> {&lt;span style="color:#8be9fd;font-style:italic">NULL&lt;/span>,&lt;span style="color:#bd93f9">0&lt;/span>} &lt;span style="color:#6272a4">/* Terminator. */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28&lt;/span>&lt;span>};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30&lt;/span>&lt;span>&lt;span style="color:#6272a4">//userflagçš„å®šä¹‰
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span>&lt;span style="color:#ff79c6">struct&lt;/span> ACLUserFlag {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32&lt;/span>&lt;span> &lt;span style="color:#ff79c6">const&lt;/span> &lt;span style="color:#8be9fd">char&lt;/span> &lt;span style="color:#ff79c6">*&lt;/span>name;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33&lt;/span>&lt;span> &lt;span style="color:#8be9fd">uint64_t&lt;/span> flag;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34&lt;/span>&lt;span>} ACLUserFlags[] &lt;span style="color:#ff79c6">=&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35&lt;/span>&lt;span> &lt;span style="color:#6272a4">/* Note: the order here dictates the emitted order at ACLDescribeUser */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36&lt;/span>&lt;span> {&lt;span style="color:#f1fa8c">&amp;#34;on&amp;#34;&lt;/span>, USER_FLAG_ENABLED},
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37&lt;/span>&lt;span> {&lt;span style="color:#f1fa8c">&amp;#34;off&amp;#34;&lt;/span>, USER_FLAG_DISABLED},
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38&lt;/span>&lt;span> {&lt;span style="color:#f1fa8c">&amp;#34;nopass&amp;#34;&lt;/span>, USER_FLAG_NOPASS},
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39&lt;/span>&lt;span> {&lt;span style="color:#f1fa8c">&amp;#34;skip-sanitize-payload&amp;#34;&lt;/span>, USER_FLAG_SANITIZE_PAYLOAD_SKIP},
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40&lt;/span>&lt;span> {&lt;span style="color:#f1fa8c">&amp;#34;sanitize-payload&amp;#34;&lt;/span>, USER_FLAG_SANITIZE_PAYLOAD},
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41&lt;/span>&lt;span> {&lt;span style="color:#8be9fd;font-style:italic">NULL&lt;/span>,&lt;span style="color:#bd93f9">0&lt;/span>} &lt;span style="color:#6272a4">/* Terminator. */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42&lt;/span>&lt;span>};
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿˜æœ‰ä¸€ä¸ªåœ¨æƒé™æ ¡éªŒä¸­ç”¨åˆ°çš„ä¸œè¥¿ &lt;code>cmd-&amp;gt;id&lt;/code> è¿™ä¸ªæ˜¯æ¯ä¸ªrediså‘½ä»¤çš„idï¼Œå…·ä½“æ˜¯é€šè¿‡è¿™ä¸ªå‡½æ•°å¾—åˆ°çš„&lt;/p>
&lt;p>&lt;a class="link" href="https://github.com/redis/redis/blob/391aa4079c0855aa20929b1e272403937e874d57/src/acl.c#L1456" target="_blank" rel="noopener"
>ACLGetCommandID&lt;/a>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-C" data-lang="C">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#6272a4">//è·å–ä¸€ä¸ªå‘½ä»¤çš„id
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span>&lt;span style="color:#8be9fd">unsigned&lt;/span> &lt;span style="color:#8be9fd">long&lt;/span> &lt;span style="color:#50fa7b">ACLGetCommandID&lt;/span>(sds cmdname) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span> sds lowername &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#50fa7b">sdsdup&lt;/span>(cmdname);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span> &lt;span style="color:#50fa7b">sdstolower&lt;/span>(lowername);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (commandId &lt;span style="color:#ff79c6">==&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">NULL&lt;/span>) commandId &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#50fa7b">raxNew&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span> &lt;span style="color:#8be9fd">void&lt;/span> &lt;span style="color:#ff79c6">*&lt;/span>id &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#50fa7b">raxFind&lt;/span>(commandId,(&lt;span style="color:#8be9fd">unsigned&lt;/span> &lt;span style="color:#8be9fd">char&lt;/span>&lt;span style="color:#ff79c6">*&lt;/span>)lowername,&lt;span style="color:#50fa7b">sdslen&lt;/span>(lowername));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (id &lt;span style="color:#ff79c6">!=&lt;/span> raxNotFound) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span> &lt;span style="color:#50fa7b">sdsfree&lt;/span>(lowername);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span> &lt;span style="color:#6272a4">//å¦‚æœæ‰¾åˆ°äº†,ç›´æ¥return idå°±å¯ä»¥äº†
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">return&lt;/span> (&lt;span style="color:#8be9fd">unsigned&lt;/span> &lt;span style="color:#8be9fd">long&lt;/span>)id;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span> &lt;span style="color:#6272a4">//å¦‚æœæ²¡æœ‰æ‰¾åˆ°, æŠŠè¿™ä¸ªå‘½ä»¤æ’å…¥çš„raxè¡¨ä¸­,å¹¶å¾—åˆ°id
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#50fa7b">raxInsert&lt;/span>(commandId,(&lt;span style="color:#8be9fd">unsigned&lt;/span> &lt;span style="color:#8be9fd">char&lt;/span>&lt;span style="color:#ff79c6">*&lt;/span>)lowername,&lt;span style="color:#50fa7b">strlen&lt;/span>(lowername),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15&lt;/span>&lt;span> (&lt;span style="color:#8be9fd">void&lt;/span>&lt;span style="color:#ff79c6">*&lt;/span>)nextid,&lt;span style="color:#8be9fd;font-style:italic">NULL&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16&lt;/span>&lt;span> &lt;span style="color:#50fa7b">sdsfree&lt;/span>(lowername);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17&lt;/span>&lt;span> &lt;span style="color:#8be9fd">unsigned&lt;/span> &lt;span style="color:#8be9fd">long&lt;/span> thisid &lt;span style="color:#ff79c6">=&lt;/span> nextid;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18&lt;/span>&lt;span> &lt;span style="color:#6272a4">//idè‡ªå¢, nextidæ˜¯åœ¨aclä¸­å®šä¹‰çš„
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> nextid&lt;span style="color:#ff79c6">++&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21&lt;/span>&lt;span> &lt;span style="color:#6272a4">//å¦‚æœid==1023äº†, å†è‡ªå¢ä¸€æ¬¡,é˜²æ­¢idæ˜¯1024
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#6272a4">//å› ä¸ºè¿™ä¸ªå€¼è¦ç»™aclSelectorä¸­çš„allowed_commandsåšç´¢å¼•,
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#6272a4">//allowed_commands æ˜¯ä¸€ä¸ªé•¿åº¦ä¸º16çš„æ•°ç»„,è‡³äºä¸ºä»€ä¹ˆä¸èƒ½æ˜¯1024è¿™ä¸ªå€¼,åé¢ä¼šçœ‹åˆ°
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">if&lt;/span> (nextid &lt;span style="color:#ff79c6">==&lt;/span> USER_COMMAND_BITS_COUNT&lt;span style="color:#ff79c6">-&lt;/span>&lt;span style="color:#bd93f9">1&lt;/span>) nextid&lt;span style="color:#ff79c6">++&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> thisid;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28&lt;/span>&lt;span>&lt;span style="color:#6272a4">//nextidçš„å®šä¹‰
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span>&lt;span style="color:#ff79c6">static&lt;/span> &lt;span style="color:#8be9fd">unsigned&lt;/span> &lt;span style="color:#8be9fd">long&lt;/span> nextid &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>; &lt;span style="color:#6272a4">/* Next command id that has not been assigned */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31&lt;/span>&lt;span>&lt;span style="color:#6272a4">//aclSelector ä¸­çš„ allowed_commandså®šä¹‰
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span>&lt;span style="color:#8be9fd">uint64_t&lt;/span> allowed_commands[USER_COMMAND_BITS_COUNT&lt;span style="color:#ff79c6">/&lt;/span>&lt;span style="color:#bd93f9">64&lt;/span>];
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;a class="link" href="https://github.com/redis/redis/blob/391aa4079c0855aa20929b1e272403937e874d57/src/acl.c#L528" target="_blank" rel="noopener"
>ACLSetSelectorCommandBit&lt;/a>&lt;/p>
&lt;p>æ ¹æ® &lt;code>cmd.id&lt;/code> è®¾ç½® &lt;code>selector&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-C" data-lang="C">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#8be9fd">void&lt;/span> &lt;span style="color:#50fa7b">ACLSetSelectorCommandBit&lt;/span>(aclSelector &lt;span style="color:#ff79c6">*&lt;/span>selector, &lt;span style="color:#8be9fd">unsigned&lt;/span> &lt;span style="color:#8be9fd">long&lt;/span> id, &lt;span style="color:#8be9fd">int&lt;/span> value) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span> &lt;span style="color:#8be9fd">uint64_t&lt;/span> word, bit;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span> &lt;span style="color:#6272a4">//è°ƒç”¨ ACLGetCommandBitCoordinates è®¡ç®—å¾—åˆ° word å’Œbit
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">if&lt;/span> (&lt;span style="color:#50fa7b">ACLGetCommandBitCoordinates&lt;/span>(id,&lt;span style="color:#ff79c6">&amp;amp;&lt;/span>word,&lt;span style="color:#ff79c6">&amp;amp;&lt;/span>bit) &lt;span style="color:#ff79c6">==&lt;/span> C_ERR) &lt;span style="color:#ff79c6">return&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (value) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span> &lt;span style="color:#6272a4">//å¦‚æœæ˜¯å…è®¸çš„è¯,è®¾ç½®è¿™ä¸ªbit
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> selector&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>allowed_commands[word] &lt;span style="color:#ff79c6">|=&lt;/span> bit;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span> } &lt;span style="color:#ff79c6">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span> &lt;span style="color:#6272a4">//å¦‚æœæ˜¯ä¸äºˆè®¸, å–æ¶ˆè¿™ä¸ªä½, å†æŠŠflagè®¾ç½®ä¸€ä¸‹
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> selector&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>allowed_commands[word] &lt;span style="color:#ff79c6">&amp;amp;=&lt;/span> &lt;span style="color:#ff79c6">~&lt;/span>bit;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span> selector&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>flags &lt;span style="color:#ff79c6">&amp;amp;=&lt;/span> &lt;span style="color:#ff79c6">~&lt;/span>SELECTOR_FLAG_ALLCOMMANDS;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15&lt;/span>&lt;span>&lt;span style="color:#8be9fd">int&lt;/span> &lt;span style="color:#50fa7b">ACLGetCommandBitCoordinates&lt;/span>(&lt;span style="color:#8be9fd">uint64_t&lt;/span> id, &lt;span style="color:#8be9fd">uint64_t&lt;/span> &lt;span style="color:#ff79c6">*&lt;/span>word, &lt;span style="color:#8be9fd">uint64_t&lt;/span> &lt;span style="color:#ff79c6">*&lt;/span>bit) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16&lt;/span>&lt;span> &lt;span style="color:#6272a4">//å¦‚æœid &amp;gt;= 1024äº†,return é”™è¯¯
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">if&lt;/span> (id &lt;span style="color:#ff79c6">&amp;gt;=&lt;/span> USER_COMMAND_BITS_COUNT) &lt;span style="color:#ff79c6">return&lt;/span> C_ERR;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18&lt;/span>&lt;span> &lt;span style="color:#6272a4">//sizeof(uint64_t) è®¡ç®—å¾—åˆ°8
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#6272a4">//word å¾—åˆ°ä½†æ˜¯ æ•°ç»„çš„ç´¢å¼•
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#6272a4">//åˆ°è¿™åº”è¯¥å°±æ˜ç™½ä¸ºä»€ä¹ˆ åœ¨ `ACLGetCommandID` id ä¸èƒ½æ˜¯1024äº†å§
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">*&lt;/span>word &lt;span style="color:#ff79c6">=&lt;/span> id &lt;span style="color:#ff79c6">/&lt;/span> &lt;span style="color:#ff79c6">sizeof&lt;/span>(&lt;span style="color:#8be9fd">uint64_t&lt;/span>) &lt;span style="color:#ff79c6">/&lt;/span> &lt;span style="color:#bd93f9">8&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22&lt;/span>&lt;span> &lt;span style="color:#6272a4">//bit æ˜¯é€šè¿‡ä½è¿ç®—å¾—åˆ°çš„, æ˜¯id%64 å¾—åˆ°çš„ä¸€ä¸ª[0,63]çš„å€¼,ç„¶åå†å·¦ç§»å¾—åˆ° bitçš„å€¼
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">*&lt;/span>bit &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#bd93f9">1ULL&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> (id &lt;span style="color:#ff79c6">%&lt;/span> (&lt;span style="color:#ff79c6">sizeof&lt;/span>(&lt;span style="color:#8be9fd">uint64_t&lt;/span>) &lt;span style="color:#ff79c6">*&lt;/span> &lt;span style="color:#bd93f9">8&lt;/span>));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> C_OK;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™æ ·ä¸€ç•ªæ“ä½œä¸‹æ¥ï¼Œ&lt;code>selector.allowed_commands&lt;/code> å¾—åˆ°ä¸€ä¸ªé•¿åº¦æ˜¯64çš„ &lt;code>uint64_t&lt;/code> çš„æ•°ç»„ï¼Œæ•°ç»„å†…çš„æ¯ä¸€ä¸ªæ•´æ•°çš„æ¯ä¸€ä¸ªä½ï¼Œè®°å½•äº†ä¸€ä¸ªå‘½ä»¤å¼€å¯æˆ–è€…å…³é—­ï¼ˆå¯¹åº”ä½çš„0æˆ–1ï¼‰&lt;/p>
&lt;p>è¿™é‡Œæœ‰ä¸ªéå¸¸å·§å¦™çš„è®¡ç®—è¿‡ç¨‹ã€‚&lt;/p>
&lt;p>ä¸€èˆ¬æˆ‘ä»¬åœ¨ä½¿ç”¨ä½è¿ç®—è®°å½•çš„æ—¶å€™ï¼Œéƒ½æ˜¯1ï¼Œ2ï¼Œ4ï¼Œ8 ç­‰ç­‰è¿™äº›2çš„å€æ•°æ¥åšï¼Œå› ä¸ºè¦ä¿è¯ä¸ä¼šå‡ºç°ä½å†²çªã€‚æ¯”å¦‚2çš„äºŒè¿›åˆ¶æ˜¯ &lt;code>10&lt;/code>, 3çš„äºŒè¿›åˆ¶æ˜¯ &lt;code>11&lt;/code> åœ¨åŒæ—¶ä½¿ç”¨ &lt;code>10&lt;/code> å’Œ &lt;code>11&lt;/code> è¿›è¡Œ ä¸æˆ–è¿ç®—çš„æ—¶å€™ï¼Œ2 å’Œ 3 ç¬¬ä¸€ä½çš„ &lt;code>1&lt;/code> ä¼šç›¸äº’å½±å“ï¼Œä½¿ç»“æœä¸å‡†ç¡®ã€‚&lt;/p>
&lt;p>ä½†æ˜¯å¦‚æœç›´æ¥ç”¨idçš„å€¼å·¦ç§»æ¥è®¡ç®—ï¼Œ&lt;code>uint64_t bit = 1ULL &amp;lt;&amp;lt; id&lt;/code> å‡è®¾æœ‰100ä¸ªcmd,idçš„å€¼å°±æ˜¯100ï¼Œé‚£å°±éœ€è¦ä¸€ä¸ªæ•´æ•°æ˜¯100ä½çš„é•¿åº¦ã€‚ä½†æ˜¯ç°åœ¨Cè¯­è¨€çš„æœ€å¤§æ•´æ•°æ˜¯64ä½é•¿åº¦ã€‚æ˜¾ç„¶æ˜¯ä¸å¤Ÿç”¨çš„ã€‚æ‰€ä»¥è¿™é‡Œåœ¨è®¡ç®—çš„æ—¶å€™ï¼Œä¼šæŠŠå‘½ä»¤å…ˆåˆ†ç»„ï¼Œè®©å‘½ä»¤è½åœ¨[0,63]è¿™ä¸ªèŒƒå›´å†…ï¼Œç„¶åå†å¯¹ç»„å†…çš„æ•°å­—è¿›è¡Œå·¦ç§»è®¡ç®—ã€‚è¿™æ ·ï¼Œä½¿ç”¨é•¿åº¦æ˜¯64çš„ &lt;code>uint64_t&lt;/code> çš„æ•°ç»„å°±èƒ½å®Œæˆ 1024ä¸ªå‘½ä»¤çš„bitè®°å½•äº†ã€‚&lt;/p>
&lt;h3 id="å‘½ä»¤åˆå§‹åŒ–">&lt;a href="#%e5%91%bd%e4%bb%a4%e5%88%9d%e5%a7%8b%e5%8c%96" class="header-anchor">&lt;/a>å‘½ä»¤åˆå§‹åŒ–
&lt;/h3>&lt;p>åœ¨ACLä¸­ï¼Œæœ‰ &lt;code>å‘½ä»¤åˆ†ç±» (acl_categories)&lt;/code> å’Œ &lt;code>å­å‘½ä»¤(subcommands)&lt;/code> è¿™ä¸¤ä¸ªæ¦‚å¿µï¼Œè¿™ä¸ªä¸œè¥¿éœ€è¦åœ¨å‘½ä»¤åˆå§‹åŒ–æ—¶å°±èµ‹å€¼ã€‚&lt;/p>
&lt;p>&lt;code>acl_categories&lt;/code> æ˜¯ä¸€ä¸ª &lt;code>uint64_t&lt;/code> ç±»å‹çš„ï¼Œå¯¹åº”çš„å€¼æ˜¯ &lt;code>ACL_CATEGORY_&lt;/code> çš„å®å®šä¹‰ï¼Œåœ¨ &lt;a class="link" href="https://github.com/redis/redis/blob/391aa4079c0855aa20929b1e272403937e874d57/src/server.h#L225" target="_blank" rel="noopener"
>è¿™é‡Œ&lt;/a> è¢«å®šä¹‰&lt;/p>
&lt;p>&lt;code>subcommands&lt;/code> æ˜¯ä¸€ä¸ª &lt;code>redisCommand&lt;/code>ç±»å‹çš„æŒ‡é’ˆï¼Œå…¶å®å°±æ˜¯ &lt;code>redisCommand&lt;/code> ç±»å‹çš„æ•°ç»„&lt;/p>
&lt;p>&lt;a class="link" href="https://github.com/redis/redis/blob/391aa4079c0855aa20929b1e272403937e874d57/src/commands.c#L7143" target="_blank" rel="noopener"
>commandsåˆå§‹åŒ–&lt;/a>&lt;/p>
&lt;p>åœ¨è¿™é‡Œï¼Œredisçš„æ‰€æœ‰å‘½ä»¤éƒ½ä¼šè¢«åˆå§‹åŒ–&lt;/p>
&lt;p>å°±æ‹¿ &lt;code>ACL&lt;/code> è¿™ä¸ªå‘½ä»¤æ¥è¯´å§ &lt;a class="link" href="https://github.com/redis/redis/blob/391aa4079c0855aa20929b1e272403937e874d57/src/commands.c#L7274" target="_blank" rel="noopener"
>ACLå‘½ä»¤åˆå§‹åŒ–&lt;/a>&lt;/p>
&lt;p>ACLå‘½ä»¤çš„ &lt;code>acl_categories&lt;/code> è¢«è®¾ç½®ä¸ºäº†&lt;code>0&lt;/code>, &lt;code>subcommands&lt;/code> è¢«è®¾ç½®ä¸ºäº† &lt;code>ACL_Subcommands&lt;/code>&lt;/p>
&lt;p>å…¶ä¸­ &lt;code>ACL_Subcommands&lt;/code> æ˜¯ä¸€ä¸ªå‘½ä»¤çš„æ•°ç»„ï¼Œåœ¨&lt;a class="link" href="https://github.com/redis/redis/blob/391aa4079c0855aa20929b1e272403937e874d57/src/commands.c#L4155" target="_blank" rel="noopener"
>è¿™é‡Œ&lt;/a>è¢«åˆå§‹åŒ–&lt;/p>
&lt;p>æœ‰å­å‘½ä»¤çš„ä¼šæŠŠå¯¹åº”çš„å­å‘½ä»¤èµ‹å€¼å¯¹ &lt;code>subcommands&lt;/code> ä¸­ï¼Œæ²¡æœ‰å­å‘½ä»¤çš„å°±ç›´æ¥æ˜¯ç©ºæŒ‡é’ˆäº†&lt;/p>
&lt;p>æš‚æ—¶èƒ½æƒ³åˆ°çš„å°±æ˜¯è¿™äº›äº†ï¼Œåé¢æœ‰æ–°çš„å†è¡¥å……&lt;/p></description></item><item><title>redis ä¹è§‚é”ï¼Œäº‹åŠ¡ä¸­å¦‚ä½•ç¡®ä¿æ•°æ®ä¸€è‡´æ€§,watchå‘½ä»¤æºç ,watchçš„å®ç°åŸç†ï¼Œæ•°æ®ç»“æ„ã€å¦‚ä½•ç›‘æ§å’Œç®¡ç†keyçš„å˜åŒ–</title><link>https://lqxhub.github.io/posts/aadf9734/</link><pubDate>Sat, 27 May 2023 15:20:19 +0000</pubDate><guid>https://lqxhub.github.io/posts/aadf9734/</guid><description>&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/2293d1c588ec113daecfde68815267b8.png" alt="Featured image of post redis ä¹è§‚é”ï¼Œäº‹åŠ¡ä¸­å¦‚ä½•ç¡®ä¿æ•°æ®ä¸€è‡´æ€§,watchå‘½ä»¤æºç ,watchçš„å®ç°åŸç†ï¼Œæ•°æ®ç»“æ„ã€å¦‚ä½•ç›‘æ§å’Œç®¡ç†keyçš„å˜åŒ–" />&lt;p>æœ€è¿‘æƒ³æ·±å…¥å­¦ä¹ ä¸€ä¸‹redisï¼Œé‚£é˜…è¯»æºç æ˜¯æœ€å¥½çš„å­¦ä¹ æ–¹å¼äº†ï¼Œæ­£å¥½æœ€è¿‘pikaç¤¾åŒºåœ¨è®¨è®º &lt;strong>äº‹åŠ¡&lt;/strong> çš„å®ç°ï¼Œå®ç°äº‹åŠ¡çš„åŸºç¡€å°±æ˜¯æ•°æ®çš„ä¸€è‡´æ€§
è™½ç„¶redisçš„äº‹åŠ¡æ²¡æœ‰åƒ å…³ç³»å‹æ•°æ®åº“é‚£æ ·ï¼Œæ”¯æŒæ•°æ®å›æ»šã€‚ä½†æ˜¯redisçš„äº‹åŠ¡ä¹Ÿå¯ä»¥ä¿è¯æ•°æ®çš„ä¸€è‡´æ€§ï¼Œå¦‚ä½•ä¿è¯æ•°æ® ä¸€è‡´æ€§ï¼Œå°±æ˜¯é  &lt;strong>watch&lt;/strong> è¿™ä¸ªåŠŸèƒ½æ¥å®ç°çš„ã€‚è¯´ç™½äº†ï¼Œredisçš„watchåŠŸèƒ½å°±æ˜¯ä¸€ä¸ª&lt;strong>ä¹è§‚é”&lt;/strong>&lt;/p>
&lt;h2 id="ä¹è§‚é”">&lt;a href="#%e4%b9%90%e8%a7%82%e9%94%81" class="header-anchor">&lt;/a>ä¹è§‚é”
&lt;/h2>&lt;p>æˆ‘çš„ç†è§£æ˜¯ï¼Œæ‰€è°“çš„ä¹è§‚é”ï¼Œå¯¹æ•°æ®åŠ é”ä¸ä¼šé˜»æ­¢åˆ«çš„äººä¿®æ”¹æ•°æ®ï¼Œä½†æ˜¯åˆ«äººä¿®æ”¹è¿‡çš„æ•°æ®ï¼ŒåŠ é”çš„äººèƒ½çŸ¥é“è¿™ä¸ªæ•°æ®è¢«ä¿®æ”¹è¿‡&lt;/p>
&lt;h2 id="redis-å®ç°">&lt;a href="#redis-%e5%ae%9e%e7%8e%b0" class="header-anchor">&lt;/a>redis å®ç°
&lt;/h2>&lt;p>æœ¬æ–‡ä¸­çš„æºç åŸºäºredis 7.0.11ï¼Œä¸åŒçš„ç‰ˆæœ¬å®ç°å¯èƒ½ä¼šä¸åŒ&lt;/p>
&lt;p>å…ˆæ”¾ä¸€å¼ watchçš„æ•°æ®ç»“æ„å›¾&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/redis_1.png">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/redis_1.png" alt="" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>åœ¨redisçš„ &lt;strong>db&lt;/strong> ç»“æ„ä¸­ï¼Œæœ‰ä¸€ä¸ªmapï¼Œç”¨æ¥è®°å½•æ‰€æœ‰è¢«watchçš„keyï¼Œæ‰€æœ‰watchè¿™ä¸ªkeyçš„clientéƒ½ä½¿ç”¨é“¾è¡¨ä¸²è”åœ¨ä¸€èµ·&lt;/p>
&lt;p>&lt;a class="link" href="https://github.com/redis/redis/blob/391aa4079c0855aa20929b1e272403937e874d57/src/server.h#L922" target="_blank" rel="noopener"
>æºç &lt;/a>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#6272a4">/* Redis database representation. There are multiple databases identified
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span>&lt;span style="color:#6272a4"> * by integers from 0 (the default database) up to the max configured
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span>&lt;span style="color:#6272a4"> * database. The database number is the &amp;#39;id&amp;#39; field in the structure. */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span>&lt;span style="color:#ff79c6">typedef&lt;/span> &lt;span style="color:#ff79c6">struct&lt;/span> redisDb {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span> dict &lt;span style="color:#ff79c6">*&lt;/span>dict; &lt;span style="color:#6272a4">/* The keyspace for this DB */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span> dict &lt;span style="color:#ff79c6">*&lt;/span>expires; &lt;span style="color:#6272a4">/* Timeout of keys with a timeout set */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span> dict &lt;span style="color:#ff79c6">*&lt;/span>blocking_keys; &lt;span style="color:#6272a4">/* Keys with clients waiting for data (BLPOP)*/&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span> dict &lt;span style="color:#ff79c6">*&lt;/span>ready_keys; &lt;span style="color:#6272a4">/* Blocked keys that received a PUSH */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span> dict &lt;span style="color:#ff79c6">*&lt;/span>watched_keys; &lt;span style="color:#6272a4">/* WATCHED keys for MULTI/EXEC CAS è¿™ä¸ªmapå°±æ˜¯è®°å½•è¢«watchçš„key*/&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span> &lt;span style="color:#8be9fd">int&lt;/span> id; &lt;span style="color:#6272a4">/* Database ID */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span> &lt;span style="color:#8be9fd">long&lt;/span> &lt;span style="color:#8be9fd">long&lt;/span> avg_ttl; &lt;span style="color:#6272a4">/* Average TTL, just for stats */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span> &lt;span style="color:#8be9fd">unsigned&lt;/span> &lt;span style="color:#8be9fd">long&lt;/span> expires_cursor; &lt;span style="color:#6272a4">/* Cursor of the active expire cycle. */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span> list &lt;span style="color:#ff79c6">*&lt;/span>defrag_later; &lt;span style="color:#6272a4">/* List of key names to attempt to defrag one by one, gradually. */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span> clusterSlotToKeyMapping &lt;span style="color:#ff79c6">*&lt;/span>slots_to_keys; &lt;span style="color:#6272a4">/* Array of slots to keys. Only used in cluster mode (db 0). */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15&lt;/span>&lt;span>} redisDb;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>åœ¨redisçš„ &lt;strong>client&lt;/strong>ä¸­ä¹Ÿæœ‰ä¸€ä¸ªé“¾è¡¨ï¼Œè®°å½•äº†å½“å‰client watchçš„æ‰€æœ‰key&lt;/p>
&lt;p>è¿˜æœ‰ä¸€ä¸ª&lt;strong>flag&lt;/strong>è®°å½•å½“å‰clientçš„çŠ¶æ€ï¼Œè¿™ä¸ªflagå¯ä»¥è®°å½•å¾ˆå¤šçŠ¶æ€ï¼Œåœ¨watchåŠŸèƒ½é‡Œï¼Œå¯ä»¥è®°å½•è¿™ä¸ªå½“å‰client watchçš„keyï¼Œæ˜¯å¦è¢«åˆ«çš„clientä¿®æ”¹è¿‡&lt;/p>
&lt;p>&lt;a class="link" href="https://github.com/redis/redis/blob/391aa4079c0855aa20929b1e272403937e874d57/src/server.h#L1089" target="_blank" rel="noopener"
>æºç &lt;/a>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">typedef&lt;/span> &lt;span style="color:#ff79c6">struct&lt;/span> client {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span> &lt;span style="color:#8be9fd">uint64_t&lt;/span> flags; &lt;span style="color:#6272a4">/* Client flags: CLIENT_* macros. */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3&lt;/span>&lt;span> list &lt;span style="color:#ff79c6">*&lt;/span>watched_keys; &lt;span style="color:#6272a4">/* Keys WATCHED for MULTI/EXEC CAS */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4&lt;/span>&lt;span>};
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å› ä¸ºredisä¸åŒçš„dbæ˜¯äº’ç›¸éš”ç¦»çš„ï¼Œæ‰€ä»¥åœ¨dbå±‚é¢åšwatchå°±å¯ä»¥äº†&lt;/p>
&lt;h3 id="watch-key">&lt;a href="#watch-key" class="header-anchor">&lt;/a>watch key
&lt;/h3>&lt;p>ç°åœ¨æ¥çœ‹ä¸€ä¸‹å¦‚ä½•watchä¸€ä¸ªkey&lt;/p>
&lt;p>&lt;a class="link" href="https://github.com/redis/redis/blob/391aa4079c0855aa20929b1e272403937e874d57/src/multi.c#L279" target="_blank" rel="noopener"
>æºç &lt;/a>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#8be9fd">void&lt;/span> &lt;span style="color:#50fa7b">watchForKey&lt;/span>(client &lt;span style="color:#ff79c6">*&lt;/span>c, robj &lt;span style="color:#ff79c6">*&lt;/span>key) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span> list &lt;span style="color:#ff79c6">*&lt;/span>clients &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">NULL&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span> listIter li;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span> listNode &lt;span style="color:#ff79c6">*&lt;/span>ln;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span> watchedKey &lt;span style="color:#ff79c6">*&lt;/span>wk;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span> &lt;span style="color:#6272a4">/* Check if we are already watching for this key */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span> &lt;span style="color:#50fa7b">listRewind&lt;/span>(c&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>watched_keys,&lt;span style="color:#ff79c6">&amp;amp;&lt;/span>li);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span> &lt;span style="color:#6272a4">//éå†å½“å‰clientå·²ç»watchçš„keyä¸­,æ˜¯å¦åŒ…å«å½“å‰è¦watchçš„key
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">while&lt;/span>((ln &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#50fa7b">listNext&lt;/span>(&lt;span style="color:#ff79c6">&amp;amp;&lt;/span>li))) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span> wk &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#50fa7b">listNodeValue&lt;/span>(ln);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span> &lt;span style="color:#6272a4">//å› ä¸ºredisä¸åŒçš„dbä¸­,æ•°æ®æ˜¯éš”ç¦»çš„,æ‰€ä»¥è¦åˆ¤æ–­ä¸€ä¸‹,dbæ˜¯å¦ç›¸åŒ
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#6272a4">//æ¯”å¦‚db0å’Œdb1éƒ½æœ‰key1è¿™ä¸ªkey
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">if&lt;/span> (wk&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>db &lt;span style="color:#ff79c6">==&lt;/span> c&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>db &lt;span style="color:#ff79c6">&amp;amp;&amp;amp;&lt;/span> &lt;span style="color:#50fa7b">equalStringObjects&lt;/span>(key,wk&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>key))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15&lt;/span>&lt;span> &lt;span style="color:#6272a4">//å¦‚æœè¿™ä¸ªkeyå·²ç»è¢«watchäº†,ç›´æ¥rerunå°±å¥½äº†
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">return&lt;/span>; &lt;span style="color:#6272a4">/* Key already watched */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18&lt;/span>&lt;span> &lt;span style="color:#6272a4">/* This key is not already watched in this DB. Let&amp;#39;s add it */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19&lt;/span>&lt;span> &lt;span style="color:#6272a4">//å»db çš„ `watched_keys`è¿™ä¸ªmapä¸­,æ‰¾åˆ°watchè¿™ä¸ªkeyçš„æ‰€æœ‰client
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> clients &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#50fa7b">dictFetchValue&lt;/span>(c&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>db&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>watched_keys,key);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (&lt;span style="color:#ff79c6">!&lt;/span>clients) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22&lt;/span>&lt;span> &lt;span style="color:#6272a4">//å¦‚æœæ²¡æœ‰client watch è¿™ä¸ªkey,è¿”å›çš„é“¾è¡¨æ˜¯ç©ºæŒ‡é’ˆ,è¿™æ—¶å€™åˆå§‹åŒ–ä¸€ä¸ªé“¾è¡¨
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> clients &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#50fa7b">listCreate&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24&lt;/span>&lt;span> &lt;span style="color:#6272a4">//æŠŠé“¾è¡¨èµ‹å€¼ç»™map
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#50fa7b">dictAdd&lt;/span>(c&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>db&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>watched_keys,key,clients);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26&lt;/span>&lt;span> &lt;span style="color:#50fa7b">incrRefCount&lt;/span>(key);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28&lt;/span>&lt;span> &lt;span style="color:#6272a4">/* Add the new key to the list of keys watched by this client */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29&lt;/span>&lt;span> wk &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#50fa7b">zmalloc&lt;/span>(&lt;span style="color:#ff79c6">sizeof&lt;/span>(&lt;span style="color:#ff79c6">*&lt;/span>wk));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30&lt;/span>&lt;span> wk&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>key &lt;span style="color:#ff79c6">=&lt;/span> key;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31&lt;/span>&lt;span> wk&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>client &lt;span style="color:#ff79c6">=&lt;/span> c;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32&lt;/span>&lt;span> wk&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>db &lt;span style="color:#ff79c6">=&lt;/span> c&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>db;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33&lt;/span>&lt;span> &lt;span style="color:#6272a4">//è®°å½•ä¸€ä¸‹,åœ¨watchæ—¶,è¿™ä¸ªkeyæ˜¯å¦è¿‡æœŸäº†,å¦‚æœåœ¨watchå‰å°±å·²ç»è¿‡æœŸäº†,åœ¨æ‰§è¡Œäº‹åŠ¡çš„æ—¶å€™,å°±å¿½ç•¥è¿™ä¸ªkey
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> wk&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>expired &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#50fa7b">keyIsExpired&lt;/span>(c&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>db, key);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35&lt;/span>&lt;span> &lt;span style="color:#50fa7b">incrRefCount&lt;/span>(key);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36&lt;/span>&lt;span> &lt;span style="color:#6272a4">//æŠŠå½“å‰çš„clientåŠ åˆ°é“¾è¡¨ä¸­
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#50fa7b">listAddNodeTail&lt;/span>(c&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>watched_keys,wk);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38&lt;/span>&lt;span> &lt;span style="color:#6272a4">//æŠŠwatchçš„key åŠ å…¥çš„client watché“¾è¡¨ä¸­
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#50fa7b">listAddNodeTail&lt;/span>(clients,wk);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>watchä¸€ä¸ªkeyå‰ï¼Œä¼šæ£€æŸ¥ä¸€ä¸‹è¿™ä¸ªkeyæ˜¯å¦å·²ç»è¢«watchäº†ï¼Œé¿å…é‡å¤watch&lt;/p>
&lt;p>æ‰¾åˆ°watchè¿™ä¸ªkeyçš„æ‰€æœ‰clientï¼Œå¹¶ä½¿ç”¨å°¾æ’æ³•æŠŠå½“å‰clientåŠ å…¥é“¾è¡¨ï¼Œå¹¶ä¸”è®°å½•ä¸€ä¸‹watchè¿™ä¸ªkeyä¹‹å‰ï¼Œè¿™ä¸ªkeyæ˜¯å¦è¿‡æœŸäº†&lt;/p>
&lt;p>åˆ°è¿™é‡Œï¼Œwatchçš„è¿‡ç¨‹å°±å®Œæˆäº†ï¼Œé€šè¿‡æºç å¯ä»¥å‘ç°ï¼Œwatchçš„è¿‡ç¨‹è¿˜æ˜¯æŒºå¥½ç†è§£çš„ï¼Œå°±æ˜¯åœ¨è®°å½•ä¸€ä¸‹&lt;/p>
&lt;h3 id="æ‰§è¡Œäº‹åŠ¡">&lt;a href="#%e6%89%a7%e8%a1%8c%e4%ba%8b%e5%8a%a1" class="header-anchor">&lt;/a>æ‰§è¡Œäº‹åŠ¡
&lt;/h3>&lt;p>å½“redisçš„clientåœ¨æ‰§è¡Œ &lt;strong>EXEC&lt;/strong>å‘½ä»¤æ—¶ï¼Œä¼šæŠŠå½“å‰äº‹åŠ¡æ‰€æœ‰çš„å‘½ä»¤ä¸€èµ·æ‰§è¡Œï¼Œåœ¨æ‰§è¡Œå‘½ä»¤å‰ï¼Œä¼šå…ˆæ£€æŸ¥ä¸€ä¸‹watchçš„keyæ˜¯å¦è¢«ä¿®æ”¹äº†ï¼Œå¦‚æœè¢«ä¿®æ”¹äº†ï¼Œ
å°±ä¼šæ”¾å¼ƒæ‰§è¡Œå‘½ä»¤ï¼Œè¿”å›å¤±è´¥&lt;/p>
&lt;p>&lt;a class="link" href="https://github.com/redis/redis/blob/391aa4079c0855aa20929b1e272403937e874d57/src/multi.c#L148" target="_blank" rel="noopener"
>æºç &lt;/a>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#8be9fd">void&lt;/span> &lt;span style="color:#50fa7b">execCommand&lt;/span>(client &lt;span style="color:#ff79c6">*&lt;/span>c) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span> &lt;span style="color:#8be9fd">int&lt;/span> j;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span> robj &lt;span style="color:#ff79c6">**&lt;/span>orig_argv;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span> &lt;span style="color:#8be9fd">int&lt;/span> orig_argc, orig_argv_len;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span> &lt;span style="color:#ff79c6">struct&lt;/span> redisCommand &lt;span style="color:#ff79c6">*&lt;/span>orig_cmd;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span> &lt;span style="color:#6272a4">//å…ˆæ£€æŸ¥ä¸€ä¸‹,å¦‚æœclientåœ¨æ­¤ä¹‹å‰æ²¡æœ‰æ‰§è¡Œè¿‡`MULTI`å‘½ä»¤,å°±æ‰§è¡Œ`EXEC`,è¿”å›é”™è¯¯
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">if&lt;/span> (&lt;span style="color:#ff79c6">!&lt;/span>(c&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>flags &lt;span style="color:#ff79c6">&amp;amp;&lt;/span> CLIENT_MULTI)) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span> &lt;span style="color:#50fa7b">addReplyError&lt;/span>(c,&lt;span style="color:#f1fa8c">&amp;#34;EXEC without MULTI&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span> &lt;span style="color:#6272a4">/* EXEC with expired watched key is disallowed*/&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span> &lt;span style="color:#6272a4">//æ£€æŸ¥ä¸€ä¸‹è¢«watchçš„keyæ˜¯å¦è¿‡æœŸäº†,å¦‚æœè¿‡æœŸäº†,äº‹åŠ¡ä¹Ÿä¼šå¤±è´¥
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#6272a4">//å¦‚æœè¿™ä¸ªkeyåœ¨watchä¹‹å‰å°±è¿‡æœŸäº†,é‚£ä¹ˆè¿™ä¸ªkeyä¼šè¢«å¿½ç•¥
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">if&lt;/span> (&lt;span style="color:#50fa7b">isWatchedKeyExpired&lt;/span>(c)) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17&lt;/span>&lt;span> c&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>flags &lt;span style="color:#ff79c6">|=&lt;/span> (CLIENT_DIRTY_CAS);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20&lt;/span>&lt;span> &lt;span style="color:#6272a4">/* Check if we need to abort the EXEC because:
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21&lt;/span>&lt;span>&lt;span style="color:#6272a4"> * 1) Some WATCHed key was touched.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22&lt;/span>&lt;span>&lt;span style="color:#6272a4"> * 2) There was a previous error while queueing commands.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23&lt;/span>&lt;span>&lt;span style="color:#6272a4"> * A failed EXEC in the first case returns a multi bulk nil object
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24&lt;/span>&lt;span>&lt;span style="color:#6272a4"> * (technically it is not an error but a special behavior), while
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25&lt;/span>&lt;span>&lt;span style="color:#6272a4"> * in the second an EXECABORT error is returned. */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26&lt;/span>&lt;span> &lt;span style="color:#6272a4">//è¿™é‡Œå°±æ˜¯åˆ¤æ–­è¿™ä¸ªkeyæ˜¯å¦è¢«å…¶ä»–clientæ”¹åŠ¨äº†,å¦‚æœkeyè¢«åˆ«çš„clientæ”¹åŠ¨äº†,æˆ–è€…äº‹åŠ¡å‡ºé”™äº†,é‚£ä¹ˆæœ¬æ¬¡äº‹åŠ¡éƒ½ä¼šå¤±è´¥
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">if&lt;/span> (c&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>flags &lt;span style="color:#ff79c6">&amp;amp;&lt;/span> (CLIENT_DIRTY_CAS &lt;span style="color:#ff79c6">|&lt;/span> CLIENT_DIRTY_EXEC)) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (c&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>flags &lt;span style="color:#ff79c6">&amp;amp;&lt;/span> CLIENT_DIRTY_EXEC) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29&lt;/span>&lt;span> &lt;span style="color:#50fa7b">addReplyErrorObject&lt;/span>(c, shared.execaborterr);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30&lt;/span>&lt;span> } &lt;span style="color:#ff79c6">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31&lt;/span>&lt;span> &lt;span style="color:#50fa7b">addReply&lt;/span>(c, shared.nullarray[c&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>resp]);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34&lt;/span>&lt;span> &lt;span style="color:#50fa7b">discardTransaction&lt;/span>(c);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37&lt;/span>&lt;span> &lt;span style="color:#8be9fd">uint64_t&lt;/span> old_flags &lt;span style="color:#ff79c6">=&lt;/span> c&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>flags;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39&lt;/span>&lt;span> &lt;span style="color:#6272a4">/* we do not want to allow blocking commands inside multi */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40&lt;/span>&lt;span> c&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>flags &lt;span style="color:#ff79c6">|=&lt;/span> CLIENT_DENY_BLOCKING;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42&lt;/span>&lt;span> &lt;span style="color:#6272a4">/* Exec all the queued commands */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43&lt;/span>&lt;span> &lt;span style="color:#6272a4">//å–æ¶ˆwatchçš„æ‰€æœ‰key
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#50fa7b">unwatchAllKeys&lt;/span>(c); &lt;span style="color:#6272a4">/* Unwatch ASAP otherwise we&amp;#39;ll waste CPU cycles */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45&lt;/span>&lt;span> .....................................................
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46&lt;/span>&lt;span> çœç•¥
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>åœ¨æ‰§è¡Œäº‹åŠ¡å‰ï¼Œä¼šæ£€æŸ¥ä¸€ä¸‹å½“å‰clientæ˜¯å¦å¼€å¯äº†äº‹åŠ¡ï¼ˆæ˜¯å¦æ‰§è¡Œäº† &lt;strong>MULTI&lt;/strong> å‘½ä»¤ï¼‰ï¼Œæ²¡æœ‰å¼€å¯äº‹åŠ¡ï¼Œè¿™æ¬¡äº‹åŠ¡ä¼šå¤±è´¥&lt;/p>
&lt;p>å†æ£€æŸ¥è¿™ä¸ªclient watchçš„keyæ˜¯å¦è¢«ä¿®æ”¹äº†ã€‚å¦‚æœè¿™ä¸ªkeyè¢«å…¶ä»–çš„clientä¿®æ”¹äº†ï¼Œåˆ™è¿™ä¸ªäº‹åŠ¡ä¼šæ‰§è¡Œå¤±è´¥&lt;/p>
&lt;p>watchæ£€æŸ¥æ²¡æœ‰é—®é¢˜åï¼Œä¼šæ¸…é™¤å½“å‰client watchçš„æ‰€æœ‰key&lt;/p>
&lt;p>åˆ°è¿™ï¼Œäº‹åŠ¡æ‰§è¡Œå‰çš„æ£€æŸ¥å°±å®Œæˆäº†ï¼Œåé¢å°±æ˜¯äº‹åŠ¡ç›¸å…³çš„åˆ¤æ–­å’Œæ“ä½œäº†&lt;/p>
&lt;h3 id="ä¿®æ”¹watchçš„key">&lt;a href="#%e4%bf%ae%e6%94%b9watch%e7%9a%84key" class="header-anchor">&lt;/a>ä¿®æ”¹watchçš„key
&lt;/h3>&lt;p>å¦‚æœä¸€ä¸ªè¢«watchçš„keyè¢«ä¿®æ”¹äº†ï¼Œé‚£ä¹ˆæ‰€æœ‰watchè¿™ä¸ªkeyçš„clientéƒ½ä¼šçŸ¥é“ï¼Œå…·ä½“å®ç°å¦‚ä¸‹&lt;/p>
&lt;p>&lt;a class="link" href="https://github.com/redis/redis/blob/391aa4079c0855aa20929b1e272403937e874d57/src/multi.c#L357" target="_blank" rel="noopener"
>æºç &lt;/a>&lt;/p>
&lt;p>æ‰€æœ‰ä¿®æ”¹å‘½ä»¤(æ¯”å¦‚set,hsetç­‰ç­‰)åœ¨æ‰§è¡Œå,éƒ½ä¼šè°ƒç”¨è¿™ä¸ªå‡½æ•°ï¼ŒæŠŠwatchçš„keyæ ‡è®°ä¸ºä¿®æ”¹çŠ¶æ€&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#8be9fd">void&lt;/span> &lt;span style="color:#50fa7b">touchWatchedKey&lt;/span>(redisDb &lt;span style="color:#ff79c6">*&lt;/span>db, robj &lt;span style="color:#ff79c6">*&lt;/span>key) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span> list &lt;span style="color:#ff79c6">*&lt;/span>clients;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span> listIter li;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span> listNode &lt;span style="color:#ff79c6">*&lt;/span>ln;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span> &lt;span style="color:#6272a4">//å¦‚æœè®°å½•keyçš„mapä¸ºç©ºæˆ–è€…clienté“¾è¡¨æ˜¯ç©º,ç›´æ¥return
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">if&lt;/span> (&lt;span style="color:#50fa7b">dictSize&lt;/span>(db&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>watched_keys) &lt;span style="color:#ff79c6">==&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>) &lt;span style="color:#ff79c6">return&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span> clients &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#50fa7b">dictFetchValue&lt;/span>(db&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>watched_keys, key);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (&lt;span style="color:#ff79c6">!&lt;/span>clients) &lt;span style="color:#ff79c6">return&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span> &lt;span style="color:#6272a4">/* Mark all the clients watching this key as CLIENT_DIRTY_CAS */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span> &lt;span style="color:#6272a4">/* Check if we are already watching for this key */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span> &lt;span style="color:#50fa7b">listRewind&lt;/span>(clients,&lt;span style="color:#ff79c6">&amp;amp;&lt;/span>li);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span> &lt;span style="color:#6272a4">//éå†watchè¿™ä¸ªkeyçš„clienté“¾è¡¨,æŠŠæ‰€æœ‰clientçš„flagä¿®æ”¹ä¸º `CLIENT_DIRTY_CAS` çŠ¶æ€
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">while&lt;/span>((ln &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#50fa7b">listNext&lt;/span>(&lt;span style="color:#ff79c6">&amp;amp;&lt;/span>li))) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16&lt;/span>&lt;span> watchedKey &lt;span style="color:#ff79c6">*&lt;/span>wk &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#50fa7b">listNodeValue&lt;/span>(ln);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17&lt;/span>&lt;span> client &lt;span style="color:#ff79c6">*&lt;/span>c &lt;span style="color:#ff79c6">=&lt;/span> wk&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>client;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (wk&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>expired) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20&lt;/span>&lt;span> &lt;span style="color:#6272a4">/* The key was already expired when WATCH was called. */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (db &lt;span style="color:#ff79c6">==&lt;/span> wk&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>db &lt;span style="color:#ff79c6">&amp;amp;&amp;amp;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22&lt;/span>&lt;span> &lt;span style="color:#50fa7b">equalStringObjects&lt;/span>(key, wk&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>key) &lt;span style="color:#ff79c6">&amp;amp;&amp;amp;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23&lt;/span>&lt;span> &lt;span style="color:#50fa7b">dictFind&lt;/span>(db&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>dict, key&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>ptr) &lt;span style="color:#ff79c6">==&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">NULL&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24&lt;/span>&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25&lt;/span>&lt;span> &lt;span style="color:#6272a4">//å¦‚æœåœ¨è¿™ä¸ªclientåœ¨watchå‰,è¿™ä¸ªkeyå°±å·²ç»è¿‡æœŸäº† &amp;amp;&amp;amp; æ˜¯è¿™ä¸ªdbçš„ &amp;amp;&amp;amp; keyæ˜¯åŒä¸€ä¸ª &amp;amp;&amp;amp; å†…å­˜é‡Œæ²¡æœ‰è¿™ä¸ªkeyäº†
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#6272a4">//å°±æ¸…é™¤ watchå°±è¿‡æœŸçš„ flag
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#6272a4">/* Already expired key is deleted, so logically no change. Clear
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28&lt;/span>&lt;span>&lt;span style="color:#6272a4"> * the flag. Deleted keys are not flagged as expired. */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29&lt;/span>&lt;span> wk&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>expired &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30&lt;/span>&lt;span> &lt;span style="color:#ff79c6">goto&lt;/span> skip_client;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32&lt;/span>&lt;span> &lt;span style="color:#6272a4">//å¦åˆ™å°±ç»“æŸ
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">break&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36&lt;/span>&lt;span> &lt;span style="color:#6272a4">//æŠŠè¿™ä¸ªclientçš„flagä¿®æ”¹ä¸º è¢«å…¶ä»–clientä¿®æ”¹äº†
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> c&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>flags &lt;span style="color:#ff79c6">|=&lt;/span> CLIENT_DIRTY_CAS;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38&lt;/span>&lt;span> &lt;span style="color:#6272a4">/* As the client is marked as dirty, there is no point in getting here
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39&lt;/span>&lt;span>&lt;span style="color:#6272a4"> * again in case that key (or others) are modified again (or keep the
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40&lt;/span>&lt;span>&lt;span style="color:#6272a4"> * memory overhead till EXEC). */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41&lt;/span>&lt;span> &lt;span style="color:#6272a4">//å¦‚æœè¿™ä¸ªclient watchçš„keyè¢«æ ‡è®°ä¸ºä»¥ä¿®æ”¹,é‚£ä¹ˆå°±æŠŠè¿™ä¸ªclient watchçš„keyéƒ½åˆ æ‰
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#50fa7b">unwatchAllKeys&lt;/span>(c);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44&lt;/span>&lt;span> &lt;span style="color:#8be9fd;font-style:italic">skip_client&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45&lt;/span>&lt;span> &lt;span style="color:#ff79c6">continue&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49&lt;/span>&lt;span>&lt;span style="color:#6272a4">//åˆ é™¤client watchçš„key
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span>&lt;span style="color:#8be9fd">void&lt;/span> &lt;span style="color:#50fa7b">unwatchAllKeys&lt;/span>(client &lt;span style="color:#ff79c6">*&lt;/span>c) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">51&lt;/span>&lt;span> listIter li;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">52&lt;/span>&lt;span> listNode &lt;span style="color:#ff79c6">*&lt;/span>ln;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">53&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">54&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (&lt;span style="color:#50fa7b">listLength&lt;/span>(c&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>watched_keys) &lt;span style="color:#ff79c6">==&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>) &lt;span style="color:#ff79c6">return&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">55&lt;/span>&lt;span> &lt;span style="color:#50fa7b">listRewind&lt;/span>(c&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>watched_keys,&lt;span style="color:#ff79c6">&amp;amp;&lt;/span>li);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">56&lt;/span>&lt;span> &lt;span style="color:#6272a4">//å˜é‡å½“å‰client watchçš„key æŠŠè¿™äº›keyåœ¨å¯¹åº”çš„dbçš„`watched_keys`ä¸­åˆ é™¤
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">57&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">while&lt;/span>((ln &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#50fa7b">listNext&lt;/span>(&lt;span style="color:#ff79c6">&amp;amp;&lt;/span>li))) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">58&lt;/span>&lt;span> list &lt;span style="color:#ff79c6">*&lt;/span>clients;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">59&lt;/span>&lt;span> watchedKey &lt;span style="color:#ff79c6">*&lt;/span>wk;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">60&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">61&lt;/span>&lt;span> &lt;span style="color:#6272a4">/* Lookup the watched key -&amp;gt; clients list and remove the client&amp;#39;s wk
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">62&lt;/span>&lt;span>&lt;span style="color:#6272a4"> * from the list */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">63&lt;/span>&lt;span> wk &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#50fa7b">listNodeValue&lt;/span>(ln);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">64&lt;/span>&lt;span> clients &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#50fa7b">dictFetchValue&lt;/span>(wk&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>db&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>watched_keys, wk&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>key);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">65&lt;/span>&lt;span> &lt;span style="color:#50fa7b">serverAssertWithInfo&lt;/span>(c,&lt;span style="color:#8be9fd;font-style:italic">NULL&lt;/span>,clients &lt;span style="color:#ff79c6">!=&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">NULL&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">66&lt;/span>&lt;span> &lt;span style="color:#50fa7b">listDelNode&lt;/span>(clients,&lt;span style="color:#50fa7b">listSearchKey&lt;/span>(clients,wk));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">67&lt;/span>&lt;span> &lt;span style="color:#6272a4">/* Kill the entry at all if this was the only client */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">68&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (&lt;span style="color:#50fa7b">listLength&lt;/span>(clients) &lt;span style="color:#ff79c6">==&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">69&lt;/span>&lt;span> &lt;span style="color:#50fa7b">dictDelete&lt;/span>(wk&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>db&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>watched_keys, wk&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>key);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">70&lt;/span>&lt;span> &lt;span style="color:#6272a4">/* Remove this watched key from the client-&amp;gt;watched list */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">71&lt;/span>&lt;span> &lt;span style="color:#50fa7b">listDelNode&lt;/span>(c&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>watched_keys,ln);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">72&lt;/span>&lt;span> &lt;span style="color:#50fa7b">decrRefCount&lt;/span>(wk&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>key);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">73&lt;/span>&lt;span> &lt;span style="color:#50fa7b">zfree&lt;/span>(wk);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">74&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">75&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä»»æ„clientåœ¨ä¿®æ”¹keyå,éƒ½ä¼šè°ƒç”¨ &lt;code>touchWatchedKey&lt;/code> æŠŠwatchè¿™ä¸ªkeyçš„clientçš„flagæ ‡è®°ä¸ºè¢«ä¿®æ”¹çŠ¶æ€ï¼Œwatchè¿™ä¸ªkeyçš„clientï¼Œä¼šéå†è‡ªå·±çš„watch çš„é“¾è¡¨ï¼ŒæŠŠæ‰€æœ‰çš„keyéƒ½åˆ æ‰ã€‚åç»­åœ¨æ‰§è¡Œäº‹åŠ¡æ—¶ä¼šå¤±è´¥&lt;/p>
&lt;p>åœ¨æ‰§è¡Œ &lt;strong>UNWATCH&lt;/strong> å‘½ä»¤æ—¶ï¼Œæœ€ç»ˆè°ƒç”¨çš„ä¹Ÿæ˜¯ &lt;code>unwatchAllKeys&lt;/code> è¿™ä¸ªå‡½æ•°&lt;/p>
&lt;h2 id="æ€»ç»“">&lt;a href="#%e6%80%bb%e7%bb%93" class="header-anchor">&lt;/a>æ€»ç»“
&lt;/h2>&lt;p>redisé€šè¿‡ &lt;strong>watch&lt;/strong> å‘½ä»¤å®ç°ä¹è§‚é”ï¼Œä¿è¯äº†äº‹åŠ¡ä¸­æ•°æ®çš„ä¸€è‡´æ€§ã€‚&lt;/p>
&lt;p>redisçš„ä¹è§‚é”åœ¨é›†ç¾¤æ¨¡å¼ä¸‹å¹¶ä¸é€‚ç”¨ï¼Œåœ¨é›†ç¾¤æ¨¡å¼ä¸‹ï¼Œè¿˜æ˜¯è¦ä½¿ç”¨ &lt;code>SETEX KEY_NAME TIMEOUT VALUE&lt;/code> è¿™ç§æ–¹å¼åŠ é”æ¥ä¿è¯æ•°æ®ä¸€è‡´&lt;/p>
&lt;p>åˆšå¼€å§‹å­¦ä¹ redisæºç ï¼Œå¯¹ä¸€äº›æ¦‚å¿µç†è§£è¿˜ä¸æ˜¯å¾ˆæ·±ï¼Œå¦‚æœæœ‰é”™è¯¯çš„åœ°æ–¹ï¼Œè¿˜è¯·æ‰¹è¯„æŒ‡æ­£&lt;/p></description></item><item><title>debian11 å‡çº§åˆ° debian12</title><link>https://lqxhub.github.io/posts/39fad342/</link><pubDate>Sun, 14 May 2023 14:12:12 +0000</pubDate><guid>https://lqxhub.github.io/posts/39fad342/</guid><description>&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/debian-12-banner.jpg" alt="Featured image of post debian11 å‡çº§åˆ° debian12" />&lt;p>æ ¹æ®debianå®˜æ–¹å‘å¸ƒçš„å…¬å‘Šï¼Œdebian12çš„å‘å¸ƒæ—¥æœŸæ˜¯2023å¹´6æœˆ10æ—¥ã€‚
æˆ‘åŸæœ¬ä»¥ä¸ºè¦ç­‰åˆ°é‚£å¤©æ‰èƒ½æ›´æ–°å‘¢ï¼Œå»ç½‘ç«™çœ‹äº†ä¸€ä¸‹ï¼Œç°åœ¨å°±å¯ä»¥æ›´æ–°äº†ï¼Œé‚£è¿˜ç”¨è¯´äº†ï¼Œç›´æ¥å†²ã€‚&lt;/p>
&lt;p>å…¶å®æ›´æ–°æ–¹å¼ä¹Ÿéå¸¸ç®€å•ï¼Œåªéœ€è¦æŠŠ &lt;strong>apt&lt;/strong> çš„æºæ¢æˆ debian12çš„ï¼Œç„¶åæ‰§è¡Œ &lt;code>apt full-upgrade&lt;/code>
å°±å¯ä»¥äº†&lt;/p>
&lt;p>åœ¨å›½å†…ï¼Œä¸å»ºè®®ä½¿ç”¨å®˜æ–¹çš„æºï¼Œç½‘é€Ÿæ…¢ï¼Œå›½å†…æœ‰å¾ˆå¤šé•œåƒï¼Œæ‰¾ä¸€ä¸‹æ›¿æ¢ä¸€ä¸‹å°±è¡Œã€‚&lt;/p>
&lt;p>æˆ‘ç”¨çš„æ˜¯æ¸…åå¤§å­¦çš„é•œåƒï¼Œ&lt;/p>
&lt;p>&lt;a class="link" href="https://mirrors.tuna.tsinghua.edu.cn/help/debian/" target="_blank" rel="noopener"
>åœ°å€&lt;/a>&lt;/p>
&lt;p>é€‰æ‹©å¯¹åº”çš„debianç‰ˆæœ¬ï¼Œå¦‚å›¾ä¸­&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/tsinghua.png">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/tsinghua.png" alt="" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>å›åˆ°linuxä¸­ï¼Œåœ¨å‡çº§12å‰ï¼Œå»ºè®®æŠŠå…³é”®æ•°æ®åšä¸€æ¬¡å¤‡ä»½ï¼Œå‡ºé—®é¢˜äº†è¿˜æœ‰å›å¤´è·¯ã€‚ æˆ‘ä½¿ç”¨çš„è™šæ‹Ÿæœºï¼Œåœ¨å‡çº§å‰åˆ›å»ºäº†ä¸€ä¸ªå¿«ç…§&lt;/p>
&lt;p>åœ¨å‡çº§å‰ å…ˆæŠŠ11çš„æ‰€æœ‰åŒ…éƒ½æ›´æ–°åˆ°æœ€æ–°&lt;/p>
&lt;ol>
&lt;li>&lt;code>sudo apt update&lt;/code>&lt;/li>
&lt;li>&lt;code>sudo apt upgrade&lt;/code>&lt;/li>
&lt;/ol>
&lt;p>å°† &lt;code>/etc/apt/sources.list&lt;/code> æ‰€æœ‰çš„é…ç½®åˆ æ‰ï¼ŒæŠŠdebian12 çš„å¤åˆ¶è¿›å»&lt;/p>
&lt;p>ç„¶åæ‰§è¡Œ&lt;/p>
&lt;ol>
&lt;li>&lt;code>sudo apt update&lt;/code>&lt;/li>
&lt;li>&lt;code>sudo apt full-upgrade&lt;/code>&lt;/li>
&lt;/ol>
&lt;p>ç­‰å¾…ä¸‹è½½å®Œæˆåä¼šè‡ªåŠ¨å®‰è£…ã€‚å¦‚æœä½ æœ‰æ›´æ”¹è¿‡ä¸€äº›åŒ…çš„é…ç½®ï¼Œåœ¨é‡æ–°å®‰è£…çš„æ—¶å€™ä¼šè¯¢é—®ä½ ä½¿ç”¨é»˜è®¤çš„é…ç½®è¿˜æ˜¯ä¿®æ”¹åçš„é…ç½®&lt;/p>
&lt;p>ä¸€èˆ¬æƒ…å†µä¸‹é€‰æ‹©è‡ªå·±ä¿®æ”¹åçš„é…ç½®å°±å¯ä»¥äº†ã€‚&lt;/p>
&lt;p>ç­‰å…¨éƒ¨å®Œæˆå é‡å¯è¿›å…¥ç³»ç»Ÿï¼Œæ•´ä¸ªå‡çº§å°±å®Œæˆäº†&lt;/p>
&lt;p>ç³»ç»Ÿå‡çº§åï¼Œå¦‚æœä½¿ç”¨çš„æ˜¯gnomeæ¡Œé¢ï¼Œå› ä¸ºgnomeä»3å‡çº§åˆ°äº†4ï¼Œæ‰€ä»¥åŸæ¥çš„ä¸€äº›æ’ä»¶å°±ä¸èƒ½ç”¨äº†ï¼Œè¿™æ—¶å€™åªéœ€è¦æŠŠæ—§çš„æ’ä»¶å¸è½½ æ¢æˆæ–°çš„å°±å¯ä»¥&lt;/p>
&lt;p>å¦‚æœè¿™ä¸ªæ’ä»¶æ²¡æœ‰å…¼å®¹gnome4çš„ï¼Œé‚£å°±æ²¡æ³•äº† 0.0&lt;/p>
&lt;p>æˆ‘å‡çº§ååªæœ‰ä¸€ä¸ªæ’ä»¶ä¸èƒ½ç”¨äº†ï¼Œæ¢æˆæœ€æ–°ç‰ˆçš„å°±å¯ä»¥ï¼ŒåŸæ¥è½¯ä»¶éƒ½èƒ½æ­£å¸¸ä½¿ç”¨ï¼Œå·²ç»ç”¨äº†ä¸¤å¤©äº†ï¼Œå®Œå…¨æ²¡æœ‰é—®é¢˜&lt;/p></description></item><item><title>goå°æ•°å››èˆäº”å…¥å–æ•´</title><link>https://lqxhub.github.io/posts/9a5e1240/</link><pubDate>Mon, 17 Apr 2023 19:08:17 +0000</pubDate><guid>https://lqxhub.github.io/posts/9a5e1240/</guid><description>&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/OIP-C.5vDPz8YnSqT_cxT-CicKkwHaEK" alt="Featured image of post goå°æ•°å››èˆäº”å…¥å–æ•´" />&lt;p>goçš„ &lt;code>math&lt;/code> åŒ…åªæä¾›äº†ç®€å•çš„å°æ•°æ“ä½œï¼Œåƒå¸¸ç”¨çš„å››èˆäº”å…¥ï¼Œä¿ç•™å‡ ä½å°æ•°è¿™äº›å¸¸ç”¨çš„æ“ä½œï¼Œå´æ²¡æœ‰æä¾›ï¼Œé‚£åªå¥½è‡ªå·±é€ è½®å­äº†ã€‚&lt;/p>
&lt;h2 id="å››èˆäº”å…¥å–æ•´">&lt;a href="#%e5%9b%9b%e8%88%8d%e4%ba%94%e5%85%a5%e5%8f%96%e6%95%b4" class="header-anchor">&lt;/a>å››èˆäº”å…¥å–æ•´
&lt;/h2>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> &lt;span style="color:#50fa7b">Rounding&lt;/span>(v &lt;span style="color:#8be9fd">float64&lt;/span>) &lt;span style="color:#8be9fd">int&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">int&lt;/span>(v &lt;span style="color:#ff79c6">+&lt;/span> &lt;span style="color:#bd93f9">0.5&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å››èˆäº”å…¥å–æ•´è¿˜æ˜¯å¾ˆç®€å•çš„ï¼Œç›´æ¥ &lt;code>+0.5&lt;/code> ç„¶åå–æ•´å°±å¯ä»¥äº†ã€‚&lt;/p>
&lt;h2 id="ä¿ç•™æŒ‡å®šå°æ•°ä½æ•°">&lt;a href="#%e4%bf%9d%e7%95%99%e6%8c%87%e5%ae%9a%e5%b0%8f%e6%95%b0%e4%bd%8d%e6%95%b0" class="header-anchor">&lt;/a>ä¿ç•™æŒ‡å®šå°æ•°ä½æ•°
&lt;/h2>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> &lt;span style="color:#50fa7b">FloatRetainBit&lt;/span>(v &lt;span style="color:#8be9fd">float64&lt;/span>, bit &lt;span style="color:#8be9fd">int&lt;/span>) &lt;span style="color:#8be9fd">float64&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> bit &lt;span style="color:#ff79c6">==&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> math.&lt;span style="color:#50fa7b">Floor&lt;/span>(v)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5&lt;/span>&lt;span> pow10 &lt;span style="color:#ff79c6">:=&lt;/span> math.&lt;span style="color:#50fa7b">Pow10&lt;/span>(bit)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> math.&lt;span style="color:#50fa7b">Floor&lt;/span>(v&lt;span style="color:#ff79c6">*&lt;/span>pow10) &lt;span style="color:#ff79c6">/&lt;/span> pow10
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™ä¸ªå¤šäº†ä¸€ç‚¹æ•°å­¦è¿ç®—ï¼Œå…¶å®å°±æ˜¯ &lt;code>* 10 çš„ å¤šå°‘æ¬¡æ–¹&lt;/code>ï¼Œç„¶åå‘ä¸‹å–æ•´ï¼Œå† &lt;code>Ã· 10 çš„ å¤šå°‘æ¬¡æ–¹&lt;/code>å°±å¯ä»¥äº†&lt;/p>
&lt;p>å…¶ä¸­çš„æ•°å­¦çŸ¥è¯†ï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>&lt;code>* 10 çš„ å¤šå°‘æ¬¡æ–¹&lt;/code> å°±æ˜¯å°æ•°ç‚¹ &lt;strong>å³&lt;/strong> ç§»å¤šå°‘ä½&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>Ã· 10 çš„ å¤šå°‘æ¬¡æ–¹&lt;/code> å°±æ˜¯å°æ•°ç‚¹ &lt;strong>å·¦&lt;/strong> ç§»å¤šå°‘ä½&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h2 id="ä¿ç•™æŒ‡å®šå°æ•°ä½æ•°å–æ•´">&lt;a href="#%e4%bf%9d%e7%95%99%e6%8c%87%e5%ae%9a%e5%b0%8f%e6%95%b0%e4%bd%8d%e6%95%b0%e5%8f%96%e6%95%b4" class="header-anchor">&lt;/a>ä¿ç•™æŒ‡å®šå°æ•°ä½æ•°å–æ•´
&lt;/h2>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> &lt;span style="color:#50fa7b">FloatRoundingRetainBit&lt;/span>(v &lt;span style="color:#8be9fd">float64&lt;/span>, bit &lt;span style="color:#8be9fd">int&lt;/span>) &lt;span style="color:#8be9fd">float64&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> bit &lt;span style="color:#ff79c6">==&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> math.&lt;span style="color:#50fa7b">Floor&lt;/span>(v &lt;span style="color:#ff79c6">+&lt;/span> &lt;span style="color:#bd93f9">0.5&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5&lt;/span>&lt;span> pow10 &lt;span style="color:#ff79c6">:=&lt;/span> math.&lt;span style="color:#50fa7b">Pow10&lt;/span>(bit)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> math.&lt;span style="color:#50fa7b">Floor&lt;/span>(v&lt;span style="color:#ff79c6">*&lt;/span>pow10&lt;span style="color:#ff79c6">+&lt;/span>&lt;span style="color:#bd93f9">0.5&lt;/span>) &lt;span style="color:#ff79c6">/&lt;/span> pow10
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™ä¸ªä¹Ÿæ²¡å•¥å¤æ‚çš„ï¼Œå°±æ˜¯åœ¨ä¿ç•™ä½æ•°çš„åŸºç¡€ä¸Šå†åŠ ä¸€ä¸ªå››èˆäº”å…¥å°±å¥½äº†&lt;/p>
&lt;h2 id="æµ‹è¯•ä¸€ä¸‹">&lt;a href="#%e6%b5%8b%e8%af%95%e4%b8%80%e4%b8%8b" class="header-anchor">&lt;/a>æµ‹è¯•ä¸€ä¸‹
&lt;/h2>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">package&lt;/span> main
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span>&lt;span style="color:#ff79c6">import&lt;/span> (
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span> &lt;span style="color:#f1fa8c">&amp;#34;fmt&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span> &lt;span style="color:#f1fa8c">&amp;#34;math&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span> &lt;span style="color:#f1fa8c">&amp;#34;math/rand&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> &lt;span style="color:#50fa7b">main&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span> f &lt;span style="color:#ff79c6">:=&lt;/span> rand.&lt;span style="color:#50fa7b">Float64&lt;/span>()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span> fmt.&lt;span style="color:#50fa7b">Println&lt;/span>(f)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span> fmt.&lt;span style="color:#50fa7b">Println&lt;/span>(&lt;span style="color:#50fa7b">Rounding&lt;/span>(f))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span> fmt.&lt;span style="color:#50fa7b">Println&lt;/span>(&lt;span style="color:#50fa7b">FloatRetainBit&lt;/span>(f, &lt;span style="color:#bd93f9">4&lt;/span>))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span> fmt.&lt;span style="color:#50fa7b">Println&lt;/span>(&lt;span style="color:#50fa7b">FloatRoundingRetainBit&lt;/span>(f, &lt;span style="color:#bd93f9">4&lt;/span>))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> &lt;span style="color:#50fa7b">Rounding&lt;/span>(v &lt;span style="color:#8be9fd">float64&lt;/span>) &lt;span style="color:#8be9fd">int&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">int&lt;/span>(v &lt;span style="color:#ff79c6">+&lt;/span> &lt;span style="color:#bd93f9">0.5&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> &lt;span style="color:#50fa7b">FloatRetainBit&lt;/span>(v &lt;span style="color:#8be9fd">float64&lt;/span>, bit &lt;span style="color:#8be9fd">int&lt;/span>) &lt;span style="color:#8be9fd">float64&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> bit &lt;span style="color:#ff79c6">==&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> math.&lt;span style="color:#50fa7b">Floor&lt;/span>(v)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25&lt;/span>&lt;span> pow10 &lt;span style="color:#ff79c6">:=&lt;/span> math.&lt;span style="color:#50fa7b">Pow10&lt;/span>(bit)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> math.&lt;span style="color:#50fa7b">Floor&lt;/span>(v&lt;span style="color:#ff79c6">*&lt;/span>pow10) &lt;span style="color:#ff79c6">/&lt;/span> pow10
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> &lt;span style="color:#50fa7b">FloatRoundingRetainBit&lt;/span>(v &lt;span style="color:#8be9fd">float64&lt;/span>, bit &lt;span style="color:#8be9fd">int&lt;/span>) &lt;span style="color:#8be9fd">float64&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> bit &lt;span style="color:#ff79c6">==&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> math.&lt;span style="color:#50fa7b">Floor&lt;/span>(v &lt;span style="color:#ff79c6">+&lt;/span> &lt;span style="color:#bd93f9">0.5&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33&lt;/span>&lt;span> pow10 &lt;span style="color:#ff79c6">:=&lt;/span> math.&lt;span style="color:#50fa7b">Pow10&lt;/span>(bit)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> math.&lt;span style="color:#50fa7b">Floor&lt;/span>(v&lt;span style="color:#ff79c6">*&lt;/span>pow10&lt;span style="color:#ff79c6">+&lt;/span>&lt;span style="color:#bd93f9">0.5&lt;/span>) &lt;span style="color:#ff79c6">/&lt;/span> pow10
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>çœ‹ä¸€ä¸‹è¿è¡Œç»“æœ&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-fallback" data-lang="fallback">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>0.6046602879796196
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span>1
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3&lt;/span>&lt;span>0.6046
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4&lt;/span>&lt;span>0.6047
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æ˜¯ç¬¦åˆé€»è¾‘çš„&lt;/p>
&lt;h2 id="benchmark">&lt;a href="#benchmark" class="header-anchor">&lt;/a>benchmark
&lt;/h2>&lt;p>ä¿ç•™æŒ‡å®šä½æ•°çš„å°æ•°ï¼Œå‡ºäº†ç”¨è¿™ç§æ•°å­¦è®¡ç®—çš„æ–¹å¼å¤–ï¼Œè¿˜å¯ä»¥ç”¨ &lt;code>fmt&lt;/code> åŒ…çš„å‡½æ•°æ¥åš&lt;/p>
&lt;p>æ¯”å¦‚ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>sprintf &lt;span style="color:#ff79c6">:=&lt;/span> fmt.&lt;span style="color:#50fa7b">Sprintf&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;%.4f&amp;#34;&lt;/span>, f)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span>&lt;span style="color:#8be9fd">float&lt;/span>, = strconv.&lt;span style="color:#50fa7b">ParseFloat&lt;/span>(sprintf, &lt;span style="color:#bd93f9">64&lt;/span>)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>é€šè¿‡å ä½ç¬¦ &lt;code>%.4f&lt;/code> æ¥ç¡®å®šå°æ•°ç‚¹åé¢ä¿ç•™å‡ ä½&lt;/p>
&lt;p>è¿™ä¸ªæ–¹å¼åœ¨æ€§èƒ½ä¸Šæ¯”æ•°å­¦è®¡ç®—çš„è¦å·®å¥½å¤šï¼Œç”¨benchmark æµ‹è¯•ä¸€ä¸‹&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">package&lt;/span> main
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span>&lt;span style="color:#ff79c6">import&lt;/span> (
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span> &lt;span style="color:#f1fa8c">&amp;#34;fmt&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span> &lt;span style="color:#f1fa8c">&amp;#34;math/rand&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span> &lt;span style="color:#f1fa8c">&amp;#34;strconv&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span> &lt;span style="color:#f1fa8c">&amp;#34;testing&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> &lt;span style="color:#50fa7b">BenchmarkFloatRetainBit&lt;/span>(b &lt;span style="color:#ff79c6">*&lt;/span>testing.B) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span> f &lt;span style="color:#ff79c6">:=&lt;/span> rand.&lt;span style="color:#50fa7b">Float64&lt;/span>()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span> &lt;span style="color:#ff79c6">for&lt;/span> i &lt;span style="color:#ff79c6">:=&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>; i &amp;lt; b.N; i&lt;span style="color:#ff79c6">++&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span> &lt;span style="color:#50fa7b">FloatRetainBit&lt;/span>(f, &lt;span style="color:#bd93f9">5&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> &lt;span style="color:#50fa7b">BenchmarkFloatRetainFmt&lt;/span>(b &lt;span style="color:#ff79c6">*&lt;/span>testing.B) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18&lt;/span>&lt;span> f &lt;span style="color:#ff79c6">:=&lt;/span> rand.&lt;span style="color:#50fa7b">Float64&lt;/span>()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19&lt;/span>&lt;span> &lt;span style="color:#ff79c6">for&lt;/span> i &lt;span style="color:#ff79c6">:=&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>; i &amp;lt; b.N; i&lt;span style="color:#ff79c6">++&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20&lt;/span>&lt;span> sprintf &lt;span style="color:#ff79c6">:=&lt;/span> fmt.&lt;span style="color:#50fa7b">Sprintf&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;%.4f&amp;#34;&lt;/span>, f)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21&lt;/span>&lt;span> _, _ = strconv.&lt;span style="color:#50fa7b">ParseFloat&lt;/span>(sprintf, &lt;span style="color:#bd93f9">64&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æ‰§è¡Œï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-fallback" data-lang="fallback">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>go test -bench . -benchmem
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ç»“æœï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-fallback" data-lang="fallback">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>goos: windows
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span>goarch: amd64
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3&lt;/span>&lt;span>pkg: test2
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4&lt;/span>&lt;span>cpu: AMD Ryzen 5 3500X 6-Core Processor
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5&lt;/span>&lt;span>BenchmarkFloatRetainBit-6 310487731 3.865 ns/op 0 B/op 0 allocs/op
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6&lt;/span>&lt;span>BenchmarkFloatRetainFmt-6 3773605 322.6 ns/op 16 B/op 2 allocs/op
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7&lt;/span>&lt;span>PASS
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8&lt;/span>&lt;span>ok test2 3.179s
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å¯ä»¥çœ‹åˆ°ï¼Œæ— è®ºæ˜¯é€Ÿåº¦è¿˜æ˜¯å†…å­˜ä½¿ç”¨ä¸Šï¼Œéƒ½æ˜¯æ•°å­¦è®¡ç®—æ›´å¥½&lt;/p></description></item><item><title>cmakeç¬”è®°3ã€‚CMakeä¸­å‡ ä¸ªå¸¸ç”¨å‡½æ•°å’Œå‘½ä»¤çš„åº”ç”¨åœºæ™¯å’Œä»£ç ç¤ºä¾‹ï¼Œfind_programã€execute_processã€cmake_host_system_informationä»¥åŠExternalProject_Add</title><link>https://lqxhub.github.io/posts/d026638f/</link><pubDate>Sun, 16 Apr 2023 12:53:34 +0000</pubDate><guid>https://lqxhub.github.io/posts/d026638f/</guid><description>&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/bdbfc42c62bafe98a218d05d53402cb4ecb80454.jpg" alt="Featured image of post cmakeç¬”è®°3ã€‚CMakeä¸­å‡ ä¸ªå¸¸ç”¨å‡½æ•°å’Œå‘½ä»¤çš„åº”ç”¨åœºæ™¯å’Œä»£ç ç¤ºä¾‹ï¼Œfind_programã€execute_processã€cmake_host_system_informationä»¥åŠExternalProject_Add" />&lt;p>å¥½ä¹…æ²¡æœ‰å†™ä¸œè¥¿äº†ï¼Œä¸Šæ¬¡å†™è¿˜æ˜¯åœ¨å»å¹´10æœˆï¼Œéƒ½å¿«åŠå¹´äº†ã€‚è¿™æœŸé—´ï¼Œé™¤äº†å·¥ä½œæ¯”è¾ƒå¿™å¤–ï¼Œä¹Ÿå¼€å§‹å‚ä¸ä¸€äº›å¼€æºé¡¹ç›®ï¼Œæ¯”å¦‚ &lt;code>pika&lt;/code> åˆšå¥½ä»Šå¹´pikaåšäº†ä¸€äº›æ”¹åŠ¨ï¼Œæ¯”å¦‚ç¼–è¯‘æ–¹å¼ä»&lt;code>MakeFile&lt;/code> æ”¹æˆäº† &lt;code>cmake&lt;/code>ã€‚æˆ‘æœ‰å¹¸å‚ä¸äº†ä¸€äº›å·¥ä½œï¼Œæ­£å¥½è¶æ­¤æœºä¼šï¼Œåˆæ·±å…¥å­¦ä¹ äº†ä¸€ä¸‹&lt;code>cmake&lt;/code> çš„çŸ¥è¯†ï¼Œè¿™å‘¨æœ«æœ‰æ—¶é—´ï¼Œæ¥è®°å½•ä¸€ä¸‹&lt;/p>
&lt;p>ä»¥å‰æˆ‘ä¹Ÿå†™è¿‡ä¸¤ç¯‡å’Œcmakeç›¸å…³çš„æ–‡ç« ï¼Œè¿™æ¬¡åˆæœ‰äº†æ–°çš„æ”¶è·ï¼Œå°±æƒ³ç€å†å†™ä¸€ç¯‡è®°å½•ä¸€ä¸‹&lt;/p>
&lt;p>æˆ‘é‚£å°±ä»pikaä¸­ç”¨åˆ°çš„cmakeçš„ä¸€äº›çŸ¥è¯†ï¼Œè®°å½•ä¸€ä¸‹å§ã€‚æˆ‘æ²¡æœ‰æ‰¾åˆ°å¥½çš„ä¸­æ–‡cmakeæ–‡æ¡£ï¼Œé‡åˆ°é—®é¢˜æœ€å¥½è¿˜æ˜¯å»å®˜ç½‘æŸ¥ï¼Œæ–‡ä¸­çš„ç›¸å…³çŸ¥è¯†,å¾ˆå¤šéƒ½æ˜¯ä»å®˜ç½‘å­¦åˆ°çš„ã€‚cmakeå®˜ç½‘ &lt;a class="link" href="https://cmake.org/cmake/help/latest/" target="_blank" rel="noopener"
>ä¼ é€é—¨&lt;/a>&lt;/p>
&lt;h2 id="find_program">&lt;a href="#find_program" class="header-anchor">&lt;/a>find_program
&lt;/h2>&lt;p>ä¸»è¦åŠŸèƒ½æ˜¯æ£€æŸ¥å½“å‰ç³»ç»Ÿä¸Šæ˜¯å¦æœ‰å¯¹åº”çš„ç¨‹åº&lt;/p>
&lt;p>æ¯”å¦‚åœ¨pikaä¸­ï¼Œç”¨æ¥æ£€æŸ¥ç³»ç»Ÿä¸­æ˜¯å¦æœ‰&lt;code>autoconf&lt;/code>è¿™ä¸ªç¨‹åº&lt;/p>
&lt;ul>
&lt;li>
&lt;p>è¿™ä¸ªå‡½æ•°çš„ç¬¬ä¸€å‚æ•°æ˜¯ä¸€ä¸ªå˜é‡ï¼Œç”¨æ¥æ¥æ”¶æ£€æŸ¥ç»“æœ&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ç¬¬äºŒä¸ªå‚æ•°æ˜¯è¦æ£€æŸ¥çš„ç¨‹åºçš„åå­—&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>åé¢æ˜¯ä¸€äº›å¯é€‰å‚æ•°ï¼Œåœ¨cmakeä¸­ï¼Œå¯é€‰å‚æ•°è¦åŠ ä¸Šå‚æ•°çš„åæ¯”å¦‚åœ¨è¿™é‡Œï¼Œè¦ç»™å‡ºæ£€æŸ¥çš„è·¯å¾„ï¼Œå‚æ•°åæ˜¯&lt;code>PATHS&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cmake" data-lang="cmake">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">find_program&lt;/span>(&lt;span style="color:#f1fa8c">AUTOCONF&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span> &lt;span style="color:#f1fa8c">autoconf&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3&lt;/span>&lt;span> &lt;span style="color:#f1fa8c">PATHS&lt;/span> &lt;span style="color:#f1fa8c">/usr/bin&lt;/span> &lt;span style="color:#f1fa8c">/usr/local/bin&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">if&lt;/span> (&lt;span style="color:#ff79c6">${&lt;/span>&lt;span style="color:#8be9fd;font-style:italic">AUTOCONF&lt;/span>&lt;span style="color:#ff79c6">}&lt;/span> &lt;span style="color:#f1fa8c">MATCHES&lt;/span> &lt;span style="color:#f1fa8c">AUTOCONF-NOTFOUND&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6&lt;/span>&lt;span> &lt;span style="color:#8be9fd;font-style:italic">message&lt;/span>(&lt;span style="color:#f1fa8c">FATAL_ERROR&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;not find autoconf on localhost&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">endif&lt;/span>()
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>åé¢é€šè¿‡æ¯”è¾ƒ &lt;code>AUTOCONF&lt;/code> æ˜¯ä¸æ˜¯ &lt;code>AUTOCONF-NOTFOUND&lt;/code>æ¥ç¡®å®šç³»ç»Ÿä¸­æ˜¯å¦å­˜åœ¨ &lt;code>autoconf&lt;/code>è¿™ä¸ªç¨‹åº&lt;/p>
&lt;p>è¿™çŸ¥è¯†æœ€åŸºæœ¬çš„ç”¨æ³•ï¼Œ&lt;code>find_program&lt;/code> è¿˜æœ‰å¾ˆå¤šå‚æ•°ï¼Œå¯ä»¥å®ç°æ›´å¤šçš„åŠŸèƒ½ï¼Œå¯ä»¥å»å®˜ç½‘ç›´æ¥å­¦ä¹ &lt;a class="link" href="https://cmake.org/cmake/help/latest/command/find_program.html" target="_blank" rel="noopener"
>ä¼ é€é—¨&lt;/a>&lt;/p>
&lt;h2 id="execute_process">&lt;a href="#execute_process" class="header-anchor">&lt;/a>execute_process
&lt;/h2>&lt;p>ä¸»è¦åŠŸèƒ½æ˜¯æ‰§è¡Œä¸€ä¸ªå‘½ä»¤ï¼Œä¸€èˆ¬å¸¸ç”¨äºæ‰§è¡Œä¸€ä¸ªæœ¬æœºçš„ç¨‹åºæˆ–è€…è„šæœ¬&lt;/p>
&lt;p>è¿™ä¸ªå‡½æ•°å¸¸ç”¨çš„æœ‰ä¸‹é¢è¿™äº›å‚æ•°&lt;/p>
&lt;ul>
&lt;li>
&lt;p>COMMAND è¦æ‰§è¡Œçš„å‘½ä»¤ï¼Œåé¢å¯ä»¥åŠ å‚æ•°ï¼Œå¯ä»¥æ”¯æŒæ‰§è¡Œå¤šä¸ªå‘½ä»¤&lt;/p>
&lt;/li>
&lt;li>
&lt;p>WORKING_DIRECTORY è¿™ä¸ªå‘½ä»¤æ‰§è¡Œæ—¶çš„å·¥ä½œç›®å½•&lt;/p>
&lt;/li>
&lt;li>
&lt;p>TIMEOUT æ‰§è¡Œè¿™ä¸ªå‘½ä»¤çš„è¶…æ—¶æ—¶é—´&lt;/p>
&lt;/li>
&lt;li>
&lt;p>RESULT_VARIABLE è¿™æ˜¯ä¸€ä¸ªå˜é‡ï¼Œä¿å­˜å‘½ä»¤æ‰§è¡Œçš„ç»“æœ&lt;/p>
&lt;/li>
&lt;li>
&lt;p>OUTPUT_VARIABLE è°ƒç”¨ç»“æœçš„è¿”å›å€¼&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ERROR_VARIABLE å¦‚æœå‡ºé”™äº†ï¼Œerrorçš„è¿”å›å€¼&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>åœ¨pikaä¸­çš„åº”ç”¨&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cmake" data-lang="cmake">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">execute_process&lt;/span>(&lt;span style="color:#f1fa8c">COMMAND&lt;/span> &lt;span style="color:#f1fa8c">sh&lt;/span> &lt;span style="color:#ff79c6">${&lt;/span>&lt;span style="color:#8be9fd;font-style:italic">CMAKE_UTILS_DIR&lt;/span>&lt;span style="color:#ff79c6">}&lt;/span>&lt;span style="color:#f1fa8c">/Get_OS_Version.sh&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span> &lt;span style="color:#f1fa8c">OUTPUT_VARIABLE&lt;/span> &lt;span style="color:#f1fa8c">OS_VERSION&lt;/span>)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™æ®µå‘½ä»¤çš„ä½œç”¨æ˜¯æ‰§è¡Œä¸€ä¸ªshellè„šæœ¬ï¼Œå¾—åˆ°è¿™ä¸ªè„šæœ¬çš„è¿”å›å€¼&lt;/p>
&lt;p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œexecute_processä¸æ˜¯ä½¿ç”¨shellå»æ‰§è¡Œå‘½ä»¤ï¼Œæ‰€ä»¥è¦æŒ‡å®šæ‰§è¡Œçš„ç¨‹åºã€‚&lt;/p>
&lt;p>æ¯”å¦‚è¿™é‡Œï¼Œè¦æ‰§è¡Œshellè„šæœ¬ï¼Œå¿…é¡»æŒ‡å®šç”¨shç¨‹åºå»æ‰§è¡Œè¿™ä¸ªè„šæœ¬ã€‚&lt;/p>
&lt;h2 id="cmake_host_system_information">&lt;a href="#cmake_host_system_information" class="header-anchor">&lt;/a>cmake_host_system_information
&lt;/h2>&lt;p>è·å–æœ¬æœºçš„ä¸€äº›ä¿¡æ¯&lt;/p>
&lt;p>è¿™ä¸ªå‡½æ•°ä½¿ç”¨æ¯”è¾ƒç®€å•ï¼Œåªæœ‰ä¸¤ä¸ªå‚æ•°ï¼Œ&lt;/p>
&lt;ul>
&lt;li>
&lt;p>RESULT è·å–çš„ç»“æœ&lt;/p>
&lt;/li>
&lt;li>
&lt;p>QUERY è¦è·å–çš„ä¿¡æ¯&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>&lt;code>QUERY&lt;/code> å¸¸ç”¨çš„å€¼ï¼Œè¿™äº›å€¼åœ¨ä¸åŒç‰ˆæœ¬çš„cmakeä¸Šæ”¯æŒç¨‹åº¦ä¹Ÿæ˜¯ä¸ä¸€æ ·çš„ï¼Œä½¿ç”¨å‰è¿˜æ˜¯å»å®˜ç½‘çœ‹ä¸€ä¸‹ï¼Œ&lt;a class="link" href="https://cmake.org/cmake/help/latest/command/cmake_host_system_information.html?highlight=cmake_host_system_information" target="_blank" rel="noopener"
>ä¼ é€é—¨&lt;/a>&lt;/p>
&lt;ul>
&lt;li>&lt;code>NUMBER_OF_LOGICAL_CORES&lt;/code>ï¼šé€»è¾‘æ ¸å¿ƒæ•°é‡ã€‚&lt;/li>
&lt;li>&lt;code>NUMBER_OF_PHYSICAL_CORES&lt;/code>ï¼šç‰©ç†æ ¸å¿ƒæ•°é‡ã€‚&lt;/li>
&lt;li>&lt;code>HOSTNAME&lt;/code>ï¼šä¸»æœºåç§°ã€‚&lt;/li>
&lt;li>&lt;code>TOTAL_VIRTUAL_MEMORY&lt;/code>ï¼šæ€»è™šæ‹Ÿå†…å­˜ï¼Œå•ä½æ˜¯&lt;code>M&lt;/code>ã€‚&lt;/li>
&lt;li>&lt;code>AVAILABLE_VIRTUAL_MEMORY&lt;/code>ï¼šå¯ç”¨è™šæ‹Ÿå†…å­˜ï¼Œå•ä½æ˜¯&lt;code>M&lt;/code>ã€‚&lt;/li>
&lt;li>&lt;code>TOTAL_PHYSICAL_MEMORY&lt;/code>ï¼šæ€»ç‰©ç†å†…å­˜ï¼Œå•ä½æ˜¯&lt;code>M&lt;/code>ã€‚&lt;/li>
&lt;li>&lt;code>AVAILABLE_PHYSICAL_MEMORY&lt;/code>ï¼šå¯ç”¨ç‰©ç†å†…å­˜ï¼Œå•ä½æ˜¯&lt;code>M&lt;/code>ã€‚&lt;/li>
&lt;li>&lt;code>IS_64BIT&lt;/code>ï¼šå¦‚æœå¤„ç†å™¨æ˜¯&lt;code>64&lt;/code>ä½ï¼ŒæŸ¥è¯¢ç»“æœä¸º&lt;code>1&lt;/code>ã€‚&lt;/li>
&lt;li>&lt;code>HAS_FPU&lt;/code>ï¼šå¦‚æœå¤„ç†å™¨æ‹¥æœ‰æµ®ç‚¹å¤„ç†å•å…ƒï¼ŒæŸ¥è¯¢ç»“æœä¸º&lt;code>1&lt;/code>ã€‚&lt;/li>
&lt;li>&lt;code>HAS_MMX&lt;/code>ï¼šå¦‚æœå¤„ç†å™¨æ”¯æŒ&lt;code>MMX&lt;/code>æŒ‡ä»¤é›†ï¼ŒæŸ¥è¯¢ç»“æœä¸º&lt;code>1&lt;/code>ã€‚&lt;/li>
&lt;li>&lt;code>HAS_MMX_PLUS&lt;/code>ï¼šå¦‚æœå¤„ç†å™¨æ”¯æŒ&lt;code>Ext. MMX&lt;/code>æŒ‡ä»¤é›†ï¼ŒæŸ¥è¯¢ç»“æœä¸º&lt;code>1&lt;/code>ã€‚&lt;/li>
&lt;li>&lt;code>HAS_SSE&lt;/code>ï¼šå¦‚æœå¤„ç†å™¨æ”¯æŒ&lt;code>SSE&lt;/code>æŒ‡ä»¤é›†ï¼ŒæŸ¥è¯¢ç»“æœä¸º&lt;code>1&lt;/code>ã€‚&lt;/li>
&lt;li>&lt;code>HAS_SSE2&lt;/code>ï¼šå¦‚æœå¤„ç†å™¨æ”¯æŒ&lt;code>SSE2&lt;/code>æŒ‡ä»¤é›†ï¼ŒæŸ¥è¯¢ç»“æœä¸º&lt;code>1&lt;/code>ã€‚&lt;/li>
&lt;li>&lt;code>HAS_SSE_FP&lt;/code>ï¼šå¦‚æœå¤„ç†å™¨æ”¯æŒ&lt;code>SSE FP&lt;/code>æŒ‡ä»¤é›†ï¼ŒæŸ¥è¯¢ç»“æœä¸º&lt;code>1&lt;/code>ã€‚&lt;/li>
&lt;li>&lt;code>HAS_SSE_MMX&lt;/code>ï¼šå¦‚æœå¤„ç†å™¨æ”¯æŒ&lt;code>SSE MMX&lt;/code>æŒ‡ä»¤é›†ï¼ŒæŸ¥è¯¢ç»“æœä¸º&lt;code>1&lt;/code>ã€‚&lt;/li>
&lt;li>&lt;code>HAS_AMD_3DNOW&lt;/code>ï¼šå¦‚æœå¤„ç†å™¨æ”¯æŒ&lt;code>3DNow&lt;/code>æŒ‡ä»¤é›†ï¼ŒæŸ¥è¯¢ç»“æœä¸º&lt;code>1&lt;/code>ã€‚&lt;/li>
&lt;li>&lt;code>HAS_AMD_3DNOW_PLUS&lt;/code>ï¼šå¦‚æœå¤„ç†å™¨æ”¯æŒ&lt;code>3DNow+&lt;/code>æŒ‡ä»¤é›†ï¼ŒæŸ¥è¯¢ç»“æœä¸º&lt;code>1&lt;/code>ã€‚&lt;/li>
&lt;li>&lt;code>HAS_IA64&lt;/code>ï¼šå¦‚æœ&lt;code>IA64&lt;/code>å¤„ç†å™¨å¯ä»¥æ¨¡æ‹Ÿ&lt;code>X86&lt;/code>ï¼ŒæŸ¥è¯¢ç»“æœä¸º&lt;code>1&lt;/code>ã€‚&lt;/li>
&lt;li>&lt;code>HAS_SERIAL_NUMBER&lt;/code>ï¼šå¦‚æœå¤„ç†å™¨æœ‰åºåˆ—å·ï¼ŒæŸ¥è¯¢ç»“æœä¸º&lt;code>1&lt;/code>ã€‚&lt;/li>
&lt;li>&lt;code>PROCESSOR_SERIAL_NUMBER&lt;/code>ï¼šå¤„ç†å™¨åºåˆ—å·ã€‚&lt;/li>
&lt;li>&lt;code>PROCESSOR_NAME&lt;/code>ï¼šå¯è¯»çš„å¤„ç†å™¨å…¨ç§°ã€‚&lt;/li>
&lt;li>&lt;code>OS_NAME&lt;/code>ï¼šæ“ä½œç³»ç»Ÿåç§°ï¼Œä¹Ÿå°±æ˜¯&lt;code>uname -s&lt;/code>çš„è¾“å‡ºï¼Œä¸‰å¤§æ“ä½œç³»ç»Ÿå¯¹åº”çš„åç§°æ˜¯&lt;code>Linux&lt;/code>ã€&lt;code>Windows&lt;/code>å’Œ&lt;code>Darwin&lt;/code>ï¼ˆ&lt;code>masOS&lt;/code>ï¼‰ï¼Œä¹Ÿå¯ä»¥é€šè¿‡&lt;code>CMAKE_HOST_SYSTEM_NAME&lt;/code>å˜é‡è·å–ã€‚&lt;/li>
&lt;li>&lt;code>OS_RELEASE&lt;/code>ï¼šæ“ä½œç³»ç»Ÿå­ç±»å‹ï¼Œä¾‹å¦‚&lt;code>Windows Professional&lt;/code>ã€‚&lt;/li>
&lt;li>&lt;code>OS_VERSION&lt;/code>ï¼šæ“ä½œç³»ç»Ÿæ„å»º&lt;code>ID&lt;/code>ã€‚&lt;/li>
&lt;li>&lt;code>OS_PLATFORM&lt;/code>ï¼šå¤„ç†å™¨æ¶æ„ï¼Œ&lt;code>Windows&lt;/code>ä¸‹å¯ä»¥é€šè¿‡&lt;code>PROCESSOR_ARCHITECTURE&lt;/code>å˜é‡è·å–ï¼Œ&lt;code>Unix/Linux/macOS&lt;/code>ç­‰å¹³å°å¯ä»¥é€šè¿‡&lt;code>uname -m&lt;/code>æˆ–&lt;code>uname -p&lt;/code>è·å–ã€‚ä¹Ÿå¯ä»¥é€šè¿‡&lt;code>CMAKE_HOST_SYSTEM_PROCESSOR&lt;/code>å˜é‡è·å–ã€‚&lt;/li>
&lt;/ul>
&lt;p>ç¤ºä¾‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cmake" data-lang="cmake">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">cmake_host_system_information&lt;/span>(&lt;span style="color:#f1fa8c">RESULT&lt;/span> &lt;span style="color:#f1fa8c">CPU_CORE&lt;/span> &lt;span style="color:#f1fa8c">QUERY&lt;/span> &lt;span style="color:#f1fa8c">NUMBER_OF_LOGICAL_CORES&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">message&lt;/span>(&lt;span style="color:#f1fa8c">STATUS&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;Cpu core ${CPU_CORE}&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è·å–å½“å‰ç”µè„‘çš„é€»è¾‘æ ¸æ•°&lt;/p>
&lt;h2 id="externalproject_add">&lt;a href="#externalproject_add" class="header-anchor">&lt;/a>ExternalProject_Add
&lt;/h2>&lt;p>è¿™ä¸ªå°±æ¯”è¾ƒå¤æ‚äº†ï¼Œä¸»è¦åŠŸèƒ½æ˜¯å¼•å…¥ä¸€ä¸ªå¤–éƒ¨é¡¹ç›®ã€‚æ¯”å¦‚åœ¨ä¸€äº›é¡¹ç›®ä¸­ï¼Œéœ€è¦åˆ«çš„åº“ï¼Œå¯ä»¥ä½¿ç”¨è¿™ä¸ªå‡½æ•°æ¥å®ç°ã€‚åªéœ€è¦ä¸€äº›ç®€å•çš„é…ç½®å°±èƒ½å®Œæˆä¾èµ–çš„ç¼–è¯‘å’Œå®‰è£…ï¼Œæå¤§çš„ç®€åŒ–äº†C++çš„ä¾èµ–ç®¡ç†ã€‚&lt;/p>
&lt;p>ä½¿ç”¨è¿™ä¸ªå‡½æ•°å‰ï¼Œéœ€è¦å…ˆå¯¼å…¥&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cmake" data-lang="cmake">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">include&lt;/span>(&lt;span style="color:#f1fa8c">ExternalProject&lt;/span>)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™ä¸ªå‡½æ•°çš„å¸¸ç”¨å‚æ•°æœ‰&lt;/p>
&lt;h3 id="directory-options">&lt;a href="#directory-options" class="header-anchor">&lt;/a>Directory Options:
&lt;/h3>&lt;p>è¿™éƒ¨åˆ†æ˜¯ç›®å½•ç›¸å…³çš„é…ç½®&lt;/p>
&lt;ul>
&lt;li>
&lt;p>&lt;code>PREFIX&lt;/code>ï¼šå¤–éƒ¨é¡¹ç›®çš„æ ¹ç›®å½•&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>TMP_DIR&lt;/code>ï¼šå¤–éƒ¨é¡¹ç›®çš„ä¸´æ—¶ç›®å½•&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>LOG_DIR&lt;/code> ï¼šå¤–éƒ¨é¡¹ç›®åœ¨æ‰§è¡Œæ—¶ï¼Œäº§ç”Ÿçš„logç›®å½•&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>STAMP_DIR&lt;/code>ï¼šå¤–éƒ¨é¡¹ç›®åœ¨æ‰§è¡Œæ—¶ï¼Œæ¯ä¸€æ­¥çš„æ—¶é—´æˆ³éƒ½ä¼šè®°å½•åœ¨è¿™é‡Œï¼Œå¦‚æœæ²¡æœ‰è®¾ç½®&lt;code>LOG_DIR&lt;/code> logæ–‡ä»¶é»˜è®¤ä¹Ÿä¼šåœ¨è¿™é‡Œ&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>DOWNLOAD_DIR&lt;/code>ï¼š å¤–éƒ¨é¡¹ç›®ä¸‹è½½æ–‡ä»¶çš„å­˜æ”¾ç›®å½•&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>SOURCE_DIR&lt;/code>ï¼š å¤–éƒ¨é¡¹ç›®çš„æºç å­˜æ”¾ç›®å½•&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>BINARY_DIR&lt;/code>ï¼š å¤–éƒ¨é¡¹ç›®ç¼–è¯‘äº§ç”Ÿçš„äºŒè¿›åˆ¶æ–‡ä»¶çš„å­˜æ”¾ç›®å½•&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>INSTALL_DIR&lt;/code>ï¼š å¤–éƒ¨é¡¹ç›®ç¼–è¯‘äº§ç”Ÿçš„åŠ¨æ€åº“å’Œé™æ€åº“çš„å­˜æ”¾ç›®å½•&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>å¦‚æœè®¾ç½®äº†&lt;code>PREFIX&lt;/code> å±æ€§ï¼Œé‚£ä¹ˆé»˜è®¤çš„ç›®å½•ç»“æ„æ˜¯è¿™æ ·çš„&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-fallback" data-lang="fallback">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>TMP_DIR = &amp;lt;prefix&amp;gt;/tmp
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span>STAMP_DIR = &amp;lt;prefix&amp;gt;/src/&amp;lt;name&amp;gt;-stamp
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3&lt;/span>&lt;span>DOWNLOAD_DIR = &amp;lt;prefix&amp;gt;/src
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4&lt;/span>&lt;span>SOURCE_DIR = &amp;lt;prefix&amp;gt;/src/&amp;lt;name&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5&lt;/span>&lt;span>BINARY_DIR = &amp;lt;prefix&amp;gt;/src/&amp;lt;name&amp;gt;-build
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6&lt;/span>&lt;span>INSTALL_DIR = &amp;lt;prefix&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7&lt;/span>&lt;span>LOG_DIR = &amp;lt;STAMP_DIR&amp;gt;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å¦‚æœè®¾ç½®äº†&lt;code>EP_BASE&lt;/code>ï¼Œç›®å½•ç»“æ„æ˜¯è¿™æ ·çš„&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>TMP_DIR &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;&lt;/span>base&lt;span style="color:#ff79c6">&amp;gt;/&lt;/span>tmp&lt;span style="color:#ff79c6">/&amp;lt;&lt;/span>name&lt;span style="color:#ff79c6">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span>STAMP_DIR &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;&lt;/span>base&lt;span style="color:#ff79c6">&amp;gt;/&lt;/span>Stamp&lt;span style="color:#ff79c6">/&amp;lt;&lt;/span>name&lt;span style="color:#ff79c6">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3&lt;/span>&lt;span>DOWNLOAD_DIR &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;&lt;/span>base&lt;span style="color:#ff79c6">&amp;gt;/&lt;/span>Download&lt;span style="color:#ff79c6">/&amp;lt;&lt;/span>name&lt;span style="color:#ff79c6">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4&lt;/span>&lt;span>SOURCE_DIR &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;&lt;/span>base&lt;span style="color:#ff79c6">&amp;gt;/&lt;/span>Source&lt;span style="color:#ff79c6">/&amp;lt;&lt;/span>name&lt;span style="color:#ff79c6">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5&lt;/span>&lt;span>BINARY_DIR &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;&lt;/span>base&lt;span style="color:#ff79c6">&amp;gt;/&lt;/span>Build&lt;span style="color:#ff79c6">/&amp;lt;&lt;/span>name&lt;span style="color:#ff79c6">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6&lt;/span>&lt;span>INSTALL_DIR &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;&lt;/span>base&lt;span style="color:#ff79c6">&amp;gt;/&lt;/span>Install&lt;span style="color:#ff79c6">/&amp;lt;&lt;/span>name&lt;span style="color:#ff79c6">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7&lt;/span>&lt;span>LOG_DIR &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;&lt;/span>STAMP_DIR&lt;span style="color:#ff79c6">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>åœ¨pikaä¸­ï¼Œæ˜¯è¿™æ ·è®¾ç½®çš„&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cmake" data-lang="cmake">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">set&lt;/span>(&lt;span style="color:#f1fa8c">EP_BASE_SUFFIX&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;buildtrees&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">set_property&lt;/span>(&lt;span style="color:#f1fa8c">DIRECTORY&lt;/span> &lt;span style="color:#f1fa8c">PROPERTY&lt;/span> &lt;span style="color:#f1fa8c">EP_BASE&lt;/span> &lt;span style="color:#ff79c6">${&lt;/span>&lt;span style="color:#8be9fd;font-style:italic">CMAKE_CURRENT_SOURCE_DIR&lt;/span>&lt;span style="color:#ff79c6">}&lt;/span>&lt;span style="color:#f1fa8c">/&lt;/span>&lt;span style="color:#ff79c6">${&lt;/span>&lt;span style="color:#8be9fd;font-style:italic">EP_BASE_SUFFIX&lt;/span>&lt;span style="color:#ff79c6">}&lt;/span>)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æœ€åçš„ç›®å½•ç»“æ„æ˜¯è¿™æ ·çš„&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>buildtrees/
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span>â”œâ”€â”€ Build
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3&lt;/span>&lt;span>â”œâ”€â”€ Download
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4&lt;/span>&lt;span>â”œâ”€â”€ Install
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5&lt;/span>&lt;span>â”œâ”€â”€ Source
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6&lt;/span>&lt;span>â”œâ”€â”€ Stamp
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7&lt;/span>&lt;span>â””â”€â”€ tmp
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="download-step-options">&lt;a href="#download-step-options" class="header-anchor">&lt;/a>Download Step Options:
&lt;/h3>&lt;p>è¿™éƒ¨åˆ†æ˜¯ä¾èµ–ä¸‹è½½ç›¸å…³çš„ï¼Œä¸‹è½½åˆå¯ä»¥åˆ†urlä¸‹è½½ï¼Œgitã€svnã€ç­‰ç­‰ç‰ˆæœ¬ç®¡ç†å·¥å…·çš„ä¸‹è½½&lt;/p>
&lt;ul>
&lt;li>
&lt;p>&lt;code>URL&lt;/code>ï¼šæ²¡ä»€ä¹ˆå¥½è¯´çš„ï¼Œå°±æ˜¯ä¸‹è½½ä¾èµ–åŒ…æˆ‘ç½‘å€&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>URL_HASH&lt;/code>ï¼šå¯¹ä¸‹è½½çš„æ–‡ä»¶åšæ ¡éªŒï¼Œå¿…é¡»è¦æŒ‡å®šæ ¡éªŒçš„ç®—æ³•ï¼Œæ¯”å¦‚ &lt;code>SHA1=0cf3c3d176a2134dec9702c64abb13da593aea0c&lt;/code>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>URL_MD5&lt;/code>ï¼šä½¿ç”¨md5å¯¹æ–‡ä»¶æ ¡éªŒ&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>DOWNLOAD_NAME&lt;/code>ï¼šä¸‹è½½çš„æ–‡ä»¶å&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>TIMEOUT&lt;/code>ï¼šä¸‹è½½çš„è¶…æ—¶æ—¶é—´&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>GIT_REPOSITORY&lt;/code>ï¼šæ‹‰å–ä»£ç çš„gitä»“åº“çš„urlåœ°å€&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>GIT_TAG&lt;/code>ï¼šæ‹‰å–ä»£ç çš„tag&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>è¿˜æœ‰ä¸€äº›å°±ä¸ä¸€ä¸€åˆ—ä¸¾äº†&lt;/p>
&lt;h3 id="configure-step-options">&lt;a href="#configure-step-options" class="header-anchor">&lt;/a>&lt;strong>Configure Step Options:&lt;/strong>
&lt;/h3>&lt;p>ç¼–è¯‘å‰çš„å‡†å¤‡æ­¥éª¤ï¼Œæ¯”å¦‚ç”Ÿæˆ&lt;code>MakeFile&lt;/code>&lt;/p>
&lt;ul>
&lt;li>
&lt;p>&lt;code>CONFIGURE_COMMAND&lt;/code>ï¼š é€šè¿‡&lt;code>autoconf&lt;/code>ç”ŸæˆMakeFileæ–‡ä»¶&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>CMAKE_COMMAND&lt;/code>ï¼šä½¿ç”¨&lt;code>CMakeList.txt&lt;/code>ç”ŸæˆMakeFileæ–‡ä»¶&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>CMAKE_ARGS&lt;/code>ï¼šcmakeçš„å‚æ•°&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h3 id="build-step-options">&lt;a href="#build-step-options" class="header-anchor">&lt;/a>&lt;strong>Build Step Options:&lt;/strong>
&lt;/h3>&lt;p>ç¼–è¯‘ç›¸å…³çš„å‚æ•°&lt;/p>
&lt;ul>
&lt;li>
&lt;p>&lt;code>BUILD_COMMAND&lt;/code>ï¼šç¼–è¯‘å‘½ä»¤&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>BUILD_IN_SOURCE&lt;/code>ï¼šæ˜¯å¦åœ¨æºä»£ç ç›®å½•è¿›è¡Œç¼–è¯‘ï¼Œä¸€èˆ¬æ¥è¯´è¿™ä¸ªä¸ç”¨æŒ‡å®šå³å¯&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>BUILD_ALWAYS&lt;/code>ï¼šå¯ç”¨æ­¤é€‰é¡¹å°†å¼ºåˆ¶å§‹ç»ˆè¿è¡Œæ„å»ºæ­¥éª¤ã€‚è¿™å¯èƒ½æ˜¯æœ€ç®€å•çš„æ–¹æ³•ï¼Œå¯ä»¥å¯é åœ°ç¡®ä¿è¯„ä¼°å¤–éƒ¨é¡¹ç›®è‡ªå·±çš„æ„å»ºä¾èµ–å…³ç³»ï¼Œè€Œä¸æ˜¯ä¾èµ–äºé»˜è®¤çš„åŸºäºæˆåŠŸæ—¶é—´æˆ³çš„æ–¹æ³•ã€‚ä¸€èˆ¬ä¹Ÿä¸ç”¨è®¾ç½®&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>åé¢çš„ä¸€äº›ä¸å¤ªå¸¸ç”¨ï¼Œå°±ä¸åˆ—ä¸¾äº†ã€‚æœ‰éœ€è¦è¿˜æ˜¯çœ‹&lt;a class="link" href="https://cmake.org/cmake/help/latest/module/ExternalProject.html" target="_blank" rel="noopener"
>å®˜æ–¹æ–‡æ¡£&lt;/a>&lt;/p>
&lt;h3 id="åœ¨pikaä¸­çš„ä½¿ç”¨">&lt;a href="#%e5%9c%a8pika%e4%b8%ad%e7%9a%84%e4%bd%bf%e7%94%a8" class="header-anchor">&lt;/a>åœ¨pikaä¸­çš„ä½¿ç”¨
&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cmake" data-lang="cmake">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">ExternalProject_Add&lt;/span>(&lt;span style="color:#f1fa8c">gflags&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span> &lt;span style="color:#f1fa8c">URL&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span> &lt;span style="color:#f1fa8c">https://github.com/gflags/gflags/archive/refs/tags/v2.2.2.tar.gz&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span> &lt;span style="color:#f1fa8c">URL_HASH&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span> &lt;span style="color:#f1fa8c">MD5=1a865b93bacfa963201af3f75b7bd64c&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span> &lt;span style="color:#f1fa8c">DOWNLOAD_NO_PROGRESS&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span> &lt;span style="color:#f1fa8c">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span> &lt;span style="color:#f1fa8c">UPDATE_COMMAND&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span> &lt;span style="color:#f1fa8c">&amp;#34;&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span> &lt;span style="color:#f1fa8c">LOG_CONFIGURE&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span> &lt;span style="color:#f1fa8c">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span> &lt;span style="color:#f1fa8c">LOG_BUILD&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span> &lt;span style="color:#f1fa8c">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span> &lt;span style="color:#f1fa8c">LOG_INSTALL&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15&lt;/span>&lt;span> &lt;span style="color:#f1fa8c">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16&lt;/span>&lt;span> &lt;span style="color:#f1fa8c">BUILD_ALWAYS&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17&lt;/span>&lt;span> &lt;span style="color:#f1fa8c">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18&lt;/span>&lt;span> &lt;span style="color:#f1fa8c">CMAKE_ARGS&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19&lt;/span>&lt;span> &lt;span style="color:#f1fa8c">-DCMAKE_INSTALL_PREFIX=&lt;/span>&lt;span style="color:#ff79c6">${&lt;/span>&lt;span style="color:#8be9fd;font-style:italic">STAGED_INSTALL_PREFIX&lt;/span>&lt;span style="color:#ff79c6">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20&lt;/span>&lt;span> &lt;span style="color:#f1fa8c">-DCMAKE_BUILD_TYPE=&lt;/span>&lt;span style="color:#ff79c6">${&lt;/span>&lt;span style="color:#8be9fd;font-style:italic">LIB_BUILD_TYPE&lt;/span>&lt;span style="color:#ff79c6">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21&lt;/span>&lt;span> &lt;span style="color:#f1fa8c">-DGFLAGS_NAMESPACE=gflags&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22&lt;/span>&lt;span> &lt;span style="color:#f1fa8c">-DBUILD_STATIC_LIBS=ON&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23&lt;/span>&lt;span> &lt;span style="color:#f1fa8c">-DBUILD_SHARED_LIBS=OFF&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24&lt;/span>&lt;span> &lt;span style="color:#f1fa8c">BUILD_COMMAND&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25&lt;/span>&lt;span> &lt;span style="color:#f1fa8c">make&lt;/span> &lt;span style="color:#f1fa8c">-j&lt;/span>&lt;span style="color:#ff79c6">${&lt;/span>&lt;span style="color:#8be9fd;font-style:italic">CPU_CORE&lt;/span>&lt;span style="color:#ff79c6">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26&lt;/span>&lt;span>)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å°±æ˜¯ä¸€äº›å¾ˆå¸¸è§„çš„ä½¿ç”¨&lt;/p>
&lt;h2 id="æ€»ç»“">&lt;a href="#%e6%80%bb%e7%bb%93" class="header-anchor">&lt;/a>æ€»ç»“
&lt;/h2>&lt;p>cmakeåŠŸèƒ½è¿˜æ˜¯éå¸¸å¼ºå¤§ï¼Œä½†æ˜¯åŒæ ·çš„ï¼Œä½¿ç”¨ä¹Ÿæ˜¯æƒ³å¯¹å¤æ‚çš„ï¼Œè€Œä¸”ä¹Ÿæ²¡æœ‰ç›¸å¯¹å¥½çš„ä¸­æ–‡æ–‡æ¡£ï¼Œè¦ç”¨å¥½è¿˜æ˜¯æœ‰ä¸€å®šå­¦ä¹ é—¨æ§›çš„ã€‚ä½†æ˜¯ç”¨å¥½cmake å¯ä»¥å¾ˆå¤§ç¨‹åº¦ä¸Šå‡è½»ä¸€äº›å·¥ä½œé‡çš„ã€‚&lt;/p>
&lt;p>pikaåœ¨æ”¹ç”¨cmakeçš„è¿‡ç¨‹ä¸­æˆ‘ä¹Ÿæäº¤è¿‡å‡ ä¸ªç®€å•çš„PRï¼Œä¹Ÿæ˜¯ä¸€æ¬¡å¾ˆå¥½çš„å­¦ä¹ è¿‡ç¨‹ï¼Œå…ˆè®°å½•è¿™äº›å§ï¼Œåé¢æƒ³èµ·æ¥å†è¡¥å……ã€‚&lt;/p></description></item><item><title>tcp loopbcakä¸unix domainåŒºåˆ«ä¸æ€§èƒ½å¯¹æ¯”ï¼Œåœ¨Linuxç³»ç»Ÿä¸­å¦‚ä½•ä½¿ç”¨è¿™ä¸¤ç§ç½‘ç»œé€šä¿¡æ–¹å¼ï¼Œå±•ç¤ºUnixå¥—æ¥å­—çš„ä½¿ç”¨æ–¹æ³•</title><link>https://lqxhub.github.io/posts/afb2aaad/</link><pubDate>Sun, 23 Oct 2022 17:35:05 +0000</pubDate><guid>https://lqxhub.github.io/posts/afb2aaad/</guid><description>&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/8025.jpg_wh860.jpg" alt="Featured image of post tcp loopbcakä¸unix domainåŒºåˆ«ä¸æ€§èƒ½å¯¹æ¯”ï¼Œåœ¨Linuxç³»ç»Ÿä¸­å¦‚ä½•ä½¿ç”¨è¿™ä¸¤ç§ç½‘ç»œé€šä¿¡æ–¹å¼ï¼Œå±•ç¤ºUnixå¥—æ¥å­—çš„ä½¿ç”¨æ–¹æ³•" />&lt;h2 id="è®¿é—®æœ¬æœºç½‘ç»œçš„æ–¹å¼">&lt;a href="#%e8%ae%bf%e9%97%ae%e6%9c%ac%e6%9c%ba%e7%bd%91%e7%bb%9c%e7%9a%84%e6%96%b9%e5%bc%8f" class="header-anchor">&lt;/a>è®¿é—®æœ¬æœºç½‘ç»œçš„æ–¹å¼
&lt;/h2>&lt;p>è®¿é—®åŒä¸€å°ç”µè„‘ä¸Šçš„ç½‘ç»œï¼Œä¸€èˆ¬ç”¨çš„åœ°å€æ˜¯ &lt;code>localhost&lt;/code> æˆ–è€… &lt;code>127.0.0.1&lt;/code>è¿™ä¸¤ç§æ–¹å¼ï¼Œæ¯”å¦‚æœ¬æœºæœ‰ä¸€ä¸ªNginxæœåŠ¡å™¨ï¼Œæƒ³è¦è®¿é—®æœ¬æœºNginxï¼Œåœ¨æµè§ˆå™¨ä¸­è¾“å…¥&lt;code>localhost&lt;/code> æˆ–è€… &lt;code>127.0.0.1&lt;/code>å°±èƒ½è®¿é—®åˆ°Nginxçš„é¦–é¡µã€‚å¦‚æœè¦è¿æ¥åˆ°æœ¬æœºçš„mysqlï¼Œ åœ¨è¿æ¥çš„æ—¶å€™ï¼ŒæŠŠåœ°å€å¡«&lt;code>127.0.0.1&lt;/code>å°±å¥½äº†&lt;/p>
&lt;h2 id="tcp-æœ¬åœ°å›ç¯">&lt;a href="#tcp-%e6%9c%ac%e5%9c%b0%e5%9b%9e%e7%8e%af" class="header-anchor">&lt;/a>tcp æœ¬åœ°å›ç¯
&lt;/h2>&lt;p>ä¸ºä»€ä¹ˆä½¿ç”¨&lt;code>localhost&lt;/code>æˆ–è€…&lt;code>1270.0.1&lt;/code>å°±èƒ½è®¿é—®æœ¬æœºçš„ç½‘ç»œæˆ–è€…ç¨‹åºå‘¢ï¼Œæ˜¯å› ä¸ºåœ¨æ¯å°ç”µè„‘ä¸Šéƒ½æœ‰ä¸€ä¸ªç‰¹æ®Šçš„ç½‘ç»œï¼Œè¿™ä¸ªç½‘ç»œå°±æ˜¯æœ¬åœ°å›ç¯ï¼ˆlocal loopbackï¼‰ã€‚&lt;code>localhost&lt;/code>å¯ä»¥çœ‹åšæ˜¯ 127.0.0.1 çš„åŸŸåã€‚ä¸€èˆ¬åœ¨hostsæ–‡ä»¶ä¸­éƒ½ä¼šæœ‰ä¸€æ¡é…ç½®ï¼Œä½¿ &lt;code>localhost&lt;/code> æ˜ å°„åˆ°&lt;code>1270.0.0.1&lt;/code>&lt;/p>
&lt;p>åœ¨linuxç³»ç»Ÿ(debin 11)ä¸­, ä½¿ç”¨ &lt;code>ip a&lt;/code>å‘½ä»¤å¯ä»¥æŸ¥çœ‹æœ¬æœºçš„ç½‘ç»œ&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-c3a8b53e75c2b3d6.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-c3a8b53e75c2b3d6.webp" alt="" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>å¯ä»¥çœ‹åˆ°ï¼Œç¬¬ä¸€ä¸ªç½‘ç»œå°±æ˜¯æœ¬åœ°å›ç¯ï¼ˆloopbackï¼‰ï¼Œä»–çš„ ip åœ°å€å°±æ˜¯å°±æ˜¯ &lt;code>127.0.0.1&lt;/code>&lt;/p>
&lt;p>æœ¬åœ°å›ç¯ä¹Ÿæ˜¯ç½‘ç»œï¼Œæ˜¯ä¸€ä¸ªç‰¹æ®Šçš„è™šæ‹Ÿç½‘å¡ã€‚ä½¿ç”¨æœ¬åœ°å›ç¯ç½‘ç»œæ—¶ï¼Œæ•°æ®ä¹Ÿä¼šç»è¿‡ç½‘ç»œæ ˆçš„å°åŒ…å’Œè§£åŒ…ã€‚&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-69e2bb8bc11cc8d3.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-69e2bb8bc11cc8d3.webp" alt="" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>å¯ä»¥çœ‹åˆ°ï¼Œtcpå±äºè¿è¾“å±‚ï¼ˆä¼ è¾“å±‚ï¼‰åè®®ï¼Œæ‰€ä»¥åœ¨æœ¬æœºå‘é€æ•°æ®æ—¶ï¼Œä¹Ÿä¼šç»è¿‡&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-fallback" data-lang="fallback">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>ä¼ è¾“å±‚-&amp;gt;ç½‘ç»œå±‚-&amp;gt;lookback-&amp;gt;ç½‘ç»œå±‚-&amp;gt;ä¼ è¾“å±‚
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™æ ·ä¸€ä¸ªè¿‡ç¨‹ã€‚&lt;/p>
&lt;h2 id="unix-domain">&lt;a href="#unix-domain" class="header-anchor">&lt;/a>unix domain
&lt;/h2>&lt;p>ä¸Šé¢è¯´äº†ä»€ä¹ˆæ˜¯ tcp æœ¬åœ°å›ç¯ï¼Œé‚£ä»€ä¹ˆæ˜¯ &lt;code>unix domain&lt;/code> å‘¢ã€‚unix domain ä¸¥æ ¼æ¥è¯´ä¸æ˜¯ç½‘ç»œï¼Œæ˜¯&lt;code>unix&lt;/code> å’Œ &lt;code>linux&lt;/code>ç³»ç»Ÿæä¾›çš„ä¸€ä¸ªè¿›ç¨‹é—´é€šä¿¡çš„æ–¹å¼ï¼Œæœ‰ç‚¹ç±»ä¼¼ç®¡é“ã€‚çœ‹åå­—ä¹ŸçŸ¥é“ï¼Œunix domain åªæ”¯æŒ&lt;code>unix&lt;/code>ç±»çš„ç³»ç»Ÿä¸­ï¼Œ&lt;code>windows&lt;/code>ç³»ç»Ÿæ˜¯ä¸æ”¯æŒçš„ã€‚unix çš„ä½¿ç”¨æ–¹å¼å’Œ tcpå¾ˆåƒï¼Œä½†æ˜¯åº•å±‚çš„å·¥ä½œåŸç†å·®åˆ«å´å¾ˆå¤§ã€‚&lt;/p>
&lt;p>unix domain ä¸­çš„æ•°æ®ä¼ è¾“ å°±ä¸éœ€è¦ç½‘ç»œæ ˆäº†ï¼Œå¯ä»¥çœ‹åšæ˜¯æ“ä½œç³»ç»Ÿåšäº†ä¸€æ¬¡å†…å­˜ä¸­çš„ä¸€ä¸ªæ•°æ®å¤åˆ¶ã€‚&lt;/p>
&lt;h2 id="ä½¿ç”¨-unix-domain">&lt;a href="#%e4%bd%bf%e7%94%a8-unix-domain" class="header-anchor">&lt;/a>ä½¿ç”¨ unix domain
&lt;/h2>&lt;p>å¦‚ä½•ä½¿ç”¨tcp ç›¸ä¿¡éƒ½å¾ˆç†Ÿäº†ï¼Œå°±ä¸ä¸Šdemoäº†ã€‚åªä¸Š unix domain çš„ä»£ç å§ã€‚å› ä¸º unix domain ä¸æ”¯æŒ windowsç³»ç»Ÿï¼Œæ‰€ä»¥è¦åœ¨linuxæˆ–è€…unixç³»ç»Ÿä¸­æµ‹è¯•ï¼Œä¸‹é¢ä¼šä½¿ç”¨goåœ¨debinä¸­æµ‹è¯•ä¸€ä¸‹&lt;/p>
&lt;p>unix domain å’Œtcp ä¸€æ · ä¹Ÿæ˜¯åˆ† &lt;code>æœåŠ¡å™¨&lt;/code> å’Œ &lt;code>å®¢æˆ·ç«¯&lt;/code> çš„&lt;/p>
&lt;p>&lt;code>unix domain æœåŠ¡å™¨ &lt;/code>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">package&lt;/span> main
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span>&lt;span style="color:#ff79c6">import&lt;/span> (
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span> &lt;span style="color:#f1fa8c">&amp;#34;fmt&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span> &lt;span style="color:#f1fa8c">&amp;#34;io&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span> &lt;span style="color:#f1fa8c">&amp;#34;net&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> &lt;span style="color:#50fa7b">main&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span> listen, err &lt;span style="color:#ff79c6">:=&lt;/span> &lt;span style="color:#50fa7b">GetUnixListen&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;/tmp/test_server.sock&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> err &lt;span style="color:#ff79c6">!=&lt;/span> &lt;span style="color:#ff79c6">nil&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span> &lt;span style="color:#8be9fd;font-style:italic">panic&lt;/span>(err)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15&lt;/span>&lt;span> &lt;span style="color:#ff79c6">defer&lt;/span> listen.&lt;span style="color:#50fa7b">Close&lt;/span>()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16&lt;/span>&lt;span> &lt;span style="color:#ff79c6">for&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17&lt;/span>&lt;span> conn, err &lt;span style="color:#ff79c6">:=&lt;/span> listen.&lt;span style="color:#50fa7b">Accept&lt;/span>()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> err &lt;span style="color:#ff79c6">!=&lt;/span> &lt;span style="color:#ff79c6">nil&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19&lt;/span>&lt;span> &lt;span style="color:#8be9fd;font-style:italic">panic&lt;/span>(err)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22&lt;/span>&lt;span> buf &lt;span style="color:#ff79c6">:=&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">make&lt;/span>([]&lt;span style="color:#8be9fd">byte&lt;/span>, &lt;span style="color:#bd93f9">1024&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23&lt;/span>&lt;span> &lt;span style="color:#6272a4">//è¯»æ•°æ®
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> n, err &lt;span style="color:#ff79c6">:=&lt;/span> conn.&lt;span style="color:#50fa7b">Read&lt;/span>(buf)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> err &lt;span style="color:#ff79c6">!=&lt;/span> &lt;span style="color:#ff79c6">nil&lt;/span> &lt;span style="color:#ff79c6">&amp;amp;&amp;amp;&lt;/span> err &lt;span style="color:#ff79c6">!=&lt;/span> io.EOF {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26&lt;/span>&lt;span> &lt;span style="color:#8be9fd;font-style:italic">panic&lt;/span>(err)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28&lt;/span>&lt;span> fmt.&lt;span style="color:#50fa7b">Printf&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;%s\n&amp;#34;&lt;/span>, buf[:n])
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30&lt;/span>&lt;span> &lt;span style="color:#6272a4">//å†™æ•°æ®
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> _, err = conn.&lt;span style="color:#50fa7b">Write&lt;/span>([]&lt;span style="color:#8be9fd;font-style:italic">byte&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;hello&amp;#34;&lt;/span>))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32&lt;/span>&lt;span> &lt;span style="color:#8be9fd;font-style:italic">panic&lt;/span>(err)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> &lt;span style="color:#50fa7b">GetUnixListen&lt;/span>(addr &lt;span style="color:#8be9fd">string&lt;/span>) (net.Listener, &lt;span style="color:#8be9fd">error&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37&lt;/span>&lt;span> listen, err &lt;span style="color:#ff79c6">:=&lt;/span> net.&lt;span style="color:#50fa7b">Listen&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;unix&amp;#34;&lt;/span>, addr)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> err &lt;span style="color:#ff79c6">!=&lt;/span> &lt;span style="color:#ff79c6">nil&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> &lt;span style="color:#ff79c6">nil&lt;/span>, err
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> listen, &lt;span style="color:#ff79c6">nil&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>unix domain&lt;/code> å®¢æˆ·ç«¯&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">package&lt;/span> main
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span>&lt;span style="color:#ff79c6">import&lt;/span> (
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span> &lt;span style="color:#f1fa8c">&amp;#34;fmt&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span> &lt;span style="color:#f1fa8c">&amp;#34;io&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span> &lt;span style="color:#f1fa8c">&amp;#34;net&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> &lt;span style="color:#50fa7b">main&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span> conn, err &lt;span style="color:#ff79c6">:=&lt;/span> &lt;span style="color:#50fa7b">GetUnixConn&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;/tmp/test_server.sock&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> err &lt;span style="color:#ff79c6">!=&lt;/span> &lt;span style="color:#ff79c6">nil&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span> &lt;span style="color:#8be9fd;font-style:italic">panic&lt;/span>(err)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15&lt;/span>&lt;span> buff &lt;span style="color:#ff79c6">:=&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">make&lt;/span>([]&lt;span style="color:#8be9fd">byte&lt;/span>, &lt;span style="color:#bd93f9">1024&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16&lt;/span>&lt;span> n, err &lt;span style="color:#ff79c6">:=&lt;/span> conn.&lt;span style="color:#50fa7b">Read&lt;/span>(buff)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> err &lt;span style="color:#ff79c6">!=&lt;/span> &lt;span style="color:#ff79c6">nil&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> err &lt;span style="color:#ff79c6">!=&lt;/span> io.EOF {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19&lt;/span>&lt;span> &lt;span style="color:#8be9fd;font-style:italic">panic&lt;/span>(err)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22&lt;/span>&lt;span> fmt.&lt;span style="color:#50fa7b">Printf&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;%s\n&amp;#34;&lt;/span>, buff[:n])
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24&lt;/span>&lt;span> conn.&lt;span style="color:#50fa7b">Write&lt;/span>([]&lt;span style="color:#8be9fd;font-style:italic">byte&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;ok&amp;#34;&lt;/span>))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> &lt;span style="color:#50fa7b">GetUnixConn&lt;/span>(addr &lt;span style="color:#8be9fd">string&lt;/span>) (net.Conn, &lt;span style="color:#8be9fd">error&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28&lt;/span>&lt;span> conn, err &lt;span style="color:#ff79c6">:=&lt;/span> net.&lt;span style="color:#50fa7b">Dial&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;unix&amp;#34;&lt;/span>, addr)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> err &lt;span style="color:#ff79c6">!=&lt;/span> &lt;span style="color:#ff79c6">nil&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> &lt;span style="color:#ff79c6">nil&lt;/span>, err
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> conn, &lt;span style="color:#ff79c6">nil&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å¯ä»¥çœ‹åˆ°ï¼Œåœ¨goä¸­ä½¿ç”¨ unix domainçš„api å’ŒtcpåŸºæœ¬æ²¡æœ‰åŒºåˆ«ã€‚æœ‰åŒºåˆ«çš„åœ°æ–¹æ˜¯åœ¨ç›‘å¬å’Œè¿æ¥çš„åœ°æ–¹ã€‚&lt;/p>
&lt;p>tcp é€šè¿‡ &lt;code>IP&lt;/code>+&lt;code>ç«¯å£&lt;/code>çš„æ–¹å¼æ¥ç¡®å®šåœ°å€çš„ï¼Œè€Œunix domain åŒæ—¶ä¸€ä¸ªæ–‡ä»¶ç¬¦ æ¥ç¡®å®šåœ°å€ã€‚&lt;/p>
&lt;p>å½“unix domainå¼€å¯ç›‘å¬åï¼Œä¼šåœ¨ç›®å½•ä¸­åˆ›å»ºä¸€ä¸ªæ–‡ä»¶ã€‚åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œå°±ä¼šåœ¨ &lt;code>/tmp&lt;/code> ç›®å½•ä¸­åˆ›å»ºä¸€ä¸ª&lt;code>test_server.sock&lt;/code> æ–‡ä»¶ã€‚
è¿™æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„æ–‡ä»¶é€šè¿‡ &lt;code>file&lt;/code>å‘½ä»¤å¯ä»¥çœ‹åˆ°&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>file test_server.sock
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span>test_server.sock: socket
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å¦‚æœåœ¨åŒä¸€ä¸ªç›®å½•ä¸‹æœ‰ä¸€ä¸ªåŒåçš„æ–‡ä»¶ï¼Œunix domain çš„ç›‘å¬å°±ä¼šå¤±è´¥ã€‚å°±åƒä¸€ä¸ªç«¯å£é»˜è®¤åªèƒ½è¢«ç›‘å¬ä¸€æ¬¡ä¸€æ ·ã€‚&lt;/p>
&lt;h2 id="unix-domain-å’Œ-tcp-loopback-æ€§èƒ½å¯¹æ¯”">&lt;a href="#unix-domain-%e5%92%8c-tcp-loopback-%e6%80%a7%e8%83%bd%e5%af%b9%e6%af%94" class="header-anchor">&lt;/a>unix domain å’Œ tcp loopback æ€§èƒ½å¯¹æ¯”
&lt;/h2>&lt;p>æˆ‘æ²¡æœ‰è¿‡ä¸¥æ ¼çš„æ€§èƒ½æµ‹è¯•ï¼Œåªæ˜¯å†™äº†ä¸€äº›ç®€å•çš„æµ‹è¯•çœ‹äº†ä¸€ä¸‹ï¼Œåœ¨å‘é€å°çš„æ•°æ®åŒ…æ—¶ï¼Œunix domain çš„æ€§èƒ½ä¼šå¥½äº tcpã€‚å½“å‘é€å¤§çš„æ•°æ®åŒ…æ—¶ï¼Œä¸¤è€…çš„æ€§èƒ½å·®è·å¯ä»¥å¿½ç•¥ä¸è®¡äº†ã€‚&lt;/p>
&lt;p>è¿™ä¸ªä¹Ÿæ˜¯ç¬¦åˆé¢„æœŸçš„ï¼Œå°çš„æ•°æ®åŒ…æ—¶ï¼Œtcpä¼šç»è¿‡ç½‘ç»œåè®®æ ˆï¼Œå½“æ•°æ®é‡å˜å¤§æ—¶ï¼Œç½‘ç»œåè®®æ ˆçš„å½±å“å¯ä»¥å¿½ç•¥ä¸è®¡äº†ã€‚&lt;/p>
&lt;h2 id="æ€»ç»“">&lt;a href="#%e6%80%bb%e7%bb%93" class="header-anchor">&lt;/a>æ€»ç»“
&lt;/h2>&lt;ol>
&lt;li>tcp look back&lt;/li>
&lt;/ol>
&lt;p>å¯ä»¥åœ¨å¤šä¸ªå¹³å°ä½¿ç”¨ï¼Œé€šè¿‡æœ¬æœºçš„è™šæ‹Ÿç½‘å¡å®Œæˆæ•°æ®ä¼ è¾“ï¼Œéœ€è¦ç»è¿‡ç½‘ç»œåè®®æ ˆï¼Œæ€§èƒ½å¼€é”€ç›¸å¯¹å¤§ä¸€äº›ã€‚&lt;/p>
&lt;ol start="2">
&lt;li>unix domain&lt;/li>
&lt;/ol>
&lt;p>åªèƒ½åœ¨unixç±»ç³»ç»Ÿä¸­ä½¿ç”¨ï¼Œæ˜¯æ“ä½œç³»ç»Ÿæä¾›çš„ä¸€ç§è¿›ç¨‹é—´é€šä¿¡æ–¹å¼ã€‚ä¸éœ€è¦ç»è¿‡ç½‘ç»œåè®®æ ˆï¼Œæ€§èƒ½ç›¸å¯¹é«˜ä¸€äº›ã€‚&lt;/p></description></item><item><title>èŠä¸€èŠgoçš„å†…å­˜é€ƒé€¸åˆ†æ</title><link>https://lqxhub.github.io/posts/e0a249f3/</link><pubDate>Sat, 15 Oct 2022 20:13:45 +0000</pubDate><guid>https://lqxhub.github.io/posts/e0a249f3/</guid><description>&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/51143d2916746e4930adcb7433814f52eb693f29.jpg" alt="Featured image of post èŠä¸€èŠgoçš„å†…å­˜é€ƒé€¸åˆ†æ" />&lt;h2 id="ä»€ä¹ˆæ˜¯å†…å­˜é€ƒé€¸åˆ†æ">&lt;a href="#%e4%bb%80%e4%b9%88%e6%98%af%e5%86%85%e5%ad%98%e9%80%83%e9%80%b8%e5%88%86%e6%9e%90" class="header-anchor">&lt;/a>ä»€ä¹ˆæ˜¯å†…å­˜é€ƒé€¸åˆ†æ
&lt;/h2>&lt;p>å†…å­˜é€ƒé€¸åˆ†ææ˜¯goçš„ç¼–è¯‘å™¨åœ¨ç¼–è¯‘æœŸé—´ï¼Œæ ¹æ®å˜é‡çš„ç±»å‹å’Œä½œç”¨åŸŸï¼Œç¡®å®šå˜é‡æ˜¯å †ä¸Šè¿˜æ˜¯æ ˆä¸Š&lt;/p>
&lt;p>ç®€å•è¯´å°±æ˜¯ç¼–è¯‘å™¨åœ¨ç¼–è¯‘æœŸé—´ï¼Œå¯¹ä»£ç è¿›è¡Œåˆ†æï¼Œç¡®å®šå˜é‡åˆ†é…å†…å­˜çš„ä½ç½®ã€‚å¦‚æœå˜é‡éœ€è¦åˆ†é…åœ¨å †ä¸Šï¼Œåˆ™ç§°ä½œå†…å­˜é€ƒé€¸äº†ã€‚&lt;/p>
&lt;h2 id="ä¸ºä»€ä¹ˆéœ€è¦é€ƒé€¸åˆ†æ">&lt;a href="#%e4%b8%ba%e4%bb%80%e4%b9%88%e9%9c%80%e8%a6%81%e9%80%83%e9%80%b8%e5%88%86%e6%9e%90" class="header-anchor">&lt;/a>ä¸ºä»€ä¹ˆéœ€è¦é€ƒé€¸åˆ†æ
&lt;/h2>&lt;p>å› ä¸ºgoè¯­è¨€æ˜¯è‡ªåŠ¨è‡ªåŠ¨å†…å­˜ç®¡ç†çš„ï¼Œä¹Ÿå°±æ˜¯æœ‰GCçš„ã€‚å¼€å‘è€…åœ¨å†™ä»£ç çš„æ—¶å€™ä¸éœ€è¦å…³å¿ƒè€ƒè™‘å†…å­˜é‡Šæ”¾çš„é—®é¢˜ï¼Œè¿™æ ·ç¼–è¯‘å™¨å’Œgoè¿è¡Œæ—¶ï¼ˆruntimeï¼‰å°±éœ€è¦å‡†ç¡®åˆ†é…å’Œç®¡ç†å†…å­˜ï¼Œæ‰€ä»¥ç¼–è¯‘å™¨åœ¨ç¼–è¯‘æœŸé—´è¦ç¡®å®šå˜é‡æ˜¯æ”¾åœ¨å †ç©ºé—´å’Œæ ˆç©ºé—´ã€‚&lt;/p>
&lt;h3 id="å¦‚æœå˜é‡æ”¾é”™äº†ä½ç½®ä¼šæ€æ ·">&lt;a href="#%e5%a6%82%e6%9e%9c%e5%8f%98%e9%87%8f%e6%94%be%e9%94%99%e4%ba%86%e4%bd%8d%e7%bd%ae%e4%bc%9a%e6%80%8e%e6%a0%b7" class="header-anchor">&lt;/a>å¦‚æœå˜é‡æ”¾é”™äº†ä½ç½®ä¼šæ€æ ·
&lt;/h3>&lt;p>æˆ‘ä»¬çŸ¥é“ï¼Œæ ˆç©ºé—´å’Œç”Ÿå‘½å‘¨æœŸæ˜¯å’Œå‡½æ•°ç”Ÿå‘½å‘¨æœŸç›¸å…³çš„ï¼Œå¦‚æœä¸€ä¸ªå‡½æ•°çš„å±€éƒ¨å˜é‡ç¦»å¼€äº†å‡½æ•°çš„èŒƒå›´ï¼Œæ¯”å¦‚å‡½æ•°ç»“æŸæ—¶ï¼Œå±€éƒ¨å˜é‡å°±ä¼šå¤±æ•ˆã€‚æ‰€ä»¥è¦æŠŠè¿™æ ·çš„å˜é‡æ”¾åˆ°å †ç©ºé—´ä¸Šã€‚&lt;/p>
&lt;p>æ—¢ç„¶å¦‚æ­¤ï¼Œé‚£æŠŠæ‰€æœ‰åœ¨å˜é‡éƒ½æ”¾åœ¨å †ä¸Šä¸å°±è¡Œäº†ï¼Œè¿™æ ·ä¸€æ¥ï¼Œæ˜¯æ²¡å•¥é—®é¢˜äº†ï¼Œä½†æ˜¯å †å†…å­˜çš„ä½¿ç”¨æˆæœ¬æ¯”å å†…å­˜è¦é«˜å¥½å¤šã€‚ä½¿ç”¨å †å†…å­˜ï¼Œè¦å‘æ“ä½œç³»ç»Ÿç”³è¯·å’Œå½’è¿˜ï¼Œè€Œå å†…å­˜æ˜¯ç¨‹åºè¿è¡Œæ—¶å°±ç¡®å®šå¥½äº†ï¼Œå¦‚ä½•ä½¿ç”¨å®Œå…¨ç”±ç¨‹åºè‡ªå·±ç¡®å®šã€‚åœ¨æ ˆä¸Šåˆ†é…å’Œå›æ”¶å†…å­˜æˆæœ¬å¾ˆä½ï¼Œåªéœ€è¦ 2 ä¸ª CPU æŒ‡ä»¤ï¼š&lt;strong>PUSH&lt;/strong> å’Œ &lt;strong>POP&lt;/strong>ï¼Œpush å°†æ•°æ®æ”¾åˆ°åˆ°æ ˆç©ºé—´å®Œæˆåˆ†é…ï¼Œpop åˆ™æ˜¯é‡Šæ”¾ç©ºé—´ã€‚&lt;/p>
&lt;p>æ¯”å¦‚ C++ ç»å…¸é”™è¯¯ï¼Œreturn ä¸€ä¸ª å‡½æ•°å†…éƒ¨å˜é‡çš„æŒ‡é’ˆ&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-C++" data-lang="C++">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">#include&amp;lt;iostream&amp;gt;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span>&lt;span style="color:#ff79c6">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span>&lt;span style="color:#8be9fd">int&lt;/span>&lt;span style="color:#ff79c6">*&lt;/span> &lt;span style="color:#50fa7b">one&lt;/span>(){
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span> &lt;span style="color:#8be9fd">int&lt;/span> i &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#bd93f9">10&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> &lt;span style="color:#ff79c6">&amp;amp;&lt;/span>i;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span>&lt;span style="color:#8be9fd">int&lt;/span> &lt;span style="color:#50fa7b">main&lt;/span>(){
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span> std&lt;span style="color:#ff79c6">::&lt;/span>cout &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#ff79c6">*&lt;/span>one();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™æ®µä»£ç åœ¨ç¼–è¯‘çš„æ—¶å€™ä¼šå¦‚ä¸‹è­¦å‘Š:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-fallback" data-lang="fallback">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>one.cpp: åœ¨å‡½æ•°â€˜int* one()â€™ä¸­:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span>one.cpp:4:6: è­¦å‘Šï¼šè¿”å›äº†å±€éƒ¨å˜é‡çš„â€˜iâ€™çš„åœ°å€ [-Wreturn-local-addr]
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3&lt;/span>&lt;span> int i = 10;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4&lt;/span>&lt;span> ^
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è™½ç„¶ç¨‹åºçš„è¿è¡Œç»“æœå¤§å¤šæ•°æ—¶å€™éƒ½å’Œæˆ‘ä»¬é¢„æœŸçš„ä¸€æ ·ï¼Œä½†æ˜¯è¿™æ ·çš„ä»£ç è¿˜æ˜¯æœ‰é£é™©çš„ã€‚&lt;/p>
&lt;p>è¿™æ ·çš„ä»£ç åœ¨goé‡Œå°±å®Œå…¨æ²¡æœ‰é—®é¢˜äº†ï¼Œå› ä¸ºgoçš„ç¼–è¯‘å™¨ä¼šæ ¹æ®å˜é‡çš„ä½œç”¨èŒƒå›´ç¡®å®šå˜é‡æ˜¯æ”¾åœ¨æ ˆä¸Šå’Œå †ä¸Šã€‚&lt;/p>
&lt;h2 id="å†…å­˜é€ƒé€¸åœºæ™¯">&lt;a href="#%e5%86%85%e5%ad%98%e9%80%83%e9%80%b8%e5%9c%ba%e6%99%af" class="header-anchor">&lt;/a>å†…å­˜é€ƒé€¸åœºæ™¯
&lt;/h2>&lt;p>goçš„ç¼–è¯‘å™¨æä¾›äº†é€ƒé€¸åˆ†æçš„å·¥å…·ï¼Œåªéœ€è¦åœ¨ç¼–è¯‘çš„æ—¶å€™åŠ ä¸Š &lt;code>-gcflags=-m&lt;/code> å°±å¯ä»¥çœ‹åˆ°é€ƒé€¸åˆ†æçš„ç»“æœäº†&lt;/p>
&lt;p>å¸¸è§çš„æœ‰4ç§åœºæ™¯ä¸‹ä¼šå‡ºç°å†…å­˜é€ƒé€¸&lt;/p>
&lt;h2 id="return-å±€éƒ¨å˜é‡çš„æŒ‡é’ˆ">&lt;a href="#return-%e5%b1%80%e9%83%a8%e5%8f%98%e9%87%8f%e7%9a%84%e6%8c%87%e9%92%88" class="header-anchor">&lt;/a>return å±€éƒ¨å˜é‡çš„æŒ‡é’ˆ
&lt;/h2>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">package&lt;/span> main
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> &lt;span style="color:#50fa7b">main&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> &lt;span style="color:#50fa7b">One&lt;/span>() &lt;span style="color:#ff79c6">*&lt;/span>&lt;span style="color:#8be9fd">int&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span> i &lt;span style="color:#ff79c6">:=&lt;/span> &lt;span style="color:#bd93f9">10&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> &lt;span style="color:#ff79c6">&amp;amp;&lt;/span>i
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æ‰§è¡Œ&lt;code> go build -gcflags=-m main.go&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>&lt;span style="color:#6272a4"># command-line-arguments&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span>.&lt;span style="color:#f1fa8c">\m&lt;/span>ain.go:3:6: can inline main
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3&lt;/span>&lt;span>.&lt;span style="color:#f1fa8c">\m&lt;/span>ain.go:7:6: can inline One
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4&lt;/span>&lt;span>.&lt;span style="color:#f1fa8c">\m&lt;/span>ain.go:8:2: moved to heap: i
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å¯ä»¥çœ‹åˆ°å˜é‡ &lt;code>i&lt;/code> å·²ç»è¢«åˆ†é…åˆ°å †ä¸Šäº†&lt;/p>
&lt;h3 id="interface-åŠ¨æ€ç±»å‹">&lt;a href="#interface-%e5%8a%a8%e6%80%81%e7%b1%bb%e5%9e%8b" class="header-anchor">&lt;/a>interface{} åŠ¨æ€ç±»å‹
&lt;/h3>&lt;p>å½“å‡½æ•°ä¼ é€’çš„å˜é‡ç±»å‹æ˜¯ &lt;code>interface{}&lt;/code> ç±»å‹çš„æ—¶å€™ï¼Œå› ä¸ºç¼–è¯‘å™¨æ— æ³•æ¨æ–­è¿è¡Œæ—¶å˜é‡çš„å®é™…ç±»å‹ï¼Œæ‰€ä»¥ä¹Ÿä¼šå‘ç”Ÿé€ƒé€¸&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">package&lt;/span> main
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3&lt;/span>&lt;span>&lt;span style="color:#ff79c6">import&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;fmt&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> &lt;span style="color:#50fa7b">main&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6&lt;/span>&lt;span> i &lt;span style="color:#ff79c6">:=&lt;/span> &lt;span style="color:#bd93f9">10&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7&lt;/span>&lt;span> fmt.&lt;span style="color:#50fa7b">Println&lt;/span>(i)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æ‰§è¡Œ &lt;code>go build -gcflags=-m .\main.go&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>.&lt;span style="color:#f1fa8c">\m&lt;/span>ain.go:11:13: inlining call to fmt.Println
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span>.&lt;span style="color:#f1fa8c">\m&lt;/span>ain.go:11:13: i escapes to heap
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3&lt;/span>&lt;span>.&lt;span style="color:#f1fa8c">\m&lt;/span>ain.go:11:13: &lt;span style="color:#ff79c6">[]&lt;/span>interface &lt;span style="color:#ff79c6">{}&lt;/span> literal does not escape
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4&lt;/span>&lt;span>&amp;lt;autogenerated&amp;gt;:1: .this does not escape
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5&lt;/span>&lt;span>&amp;lt;autogenerated&amp;gt;:1: .this does not escape
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å¯çœ‹åˆ°ï¼Œ&lt;code>i&lt;/code> ä¹Ÿè¢«åˆ†é…åˆ°å †ä¸Šäº†&lt;/p>
&lt;h3 id="æ ˆç©ºé—´ä¸è¶³">&lt;a href="#%e6%a0%88%e7%a9%ba%e9%97%b4%e4%b8%8d%e8%b6%b3" class="header-anchor">&lt;/a>æ ˆç©ºé—´ä¸è¶³
&lt;/h3>&lt;p>å› ä¸ºæ ˆçš„ç©ºé—´æ˜¯æœ‰é™çš„ï¼Œæ‰€ä»¥åœ¨åˆ†é…å¤§å—å†…å­˜æ—¶ï¼Œä¼šè€ƒè™‘æ ˆç©ºé—´å†…å¦å­˜ä¸‹ï¼Œå¦‚æœæ ˆç©ºé—´å­˜ä¸ä¸‹ï¼Œä¼šåˆ†é…åˆ°å †ä¸Šã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">package&lt;/span> main
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> &lt;span style="color:#50fa7b">main&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span> &lt;span style="color:#50fa7b">Make10&lt;/span>()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span> &lt;span style="color:#50fa7b">Make100&lt;/span>()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span> &lt;span style="color:#50fa7b">Make10000&lt;/span>()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span> &lt;span style="color:#50fa7b">MakeN&lt;/span>(&lt;span style="color:#bd93f9">5&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> &lt;span style="color:#50fa7b">Make10&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span> arr10 &lt;span style="color:#ff79c6">:=&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">make&lt;/span>([]&lt;span style="color:#8be9fd">int&lt;/span>, &lt;span style="color:#bd93f9">10&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span> _ = arr10
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> &lt;span style="color:#50fa7b">Make100&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16&lt;/span>&lt;span> arr100 &lt;span style="color:#ff79c6">:=&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">make&lt;/span>([]&lt;span style="color:#8be9fd">int&lt;/span>, &lt;span style="color:#bd93f9">100&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17&lt;/span>&lt;span> _ = arr100
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> &lt;span style="color:#50fa7b">Make10000&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21&lt;/span>&lt;span> arr10000 &lt;span style="color:#ff79c6">:=&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">make&lt;/span>([]&lt;span style="color:#8be9fd">int&lt;/span>, &lt;span style="color:#bd93f9">10000&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22&lt;/span>&lt;span> _ = arr10000
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> &lt;span style="color:#50fa7b">MakeN&lt;/span>(n &lt;span style="color:#8be9fd">int&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26&lt;/span>&lt;span> arrN &lt;span style="color:#ff79c6">:=&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">make&lt;/span>([]&lt;span style="color:#8be9fd">int&lt;/span>, n)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27&lt;/span>&lt;span> _ = arrN
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æ‰§è¡Œ&lt;code> go build -gcflags=-m main.go&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#6272a4"># command-line-arguments&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span>.&lt;span style="color:#f1fa8c">\m&lt;/span>ain.go:10:6: can inline Make10
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span>.&lt;span style="color:#f1fa8c">\m&lt;/span>ain.go:15:6: can inline Make100
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span>.&lt;span style="color:#f1fa8c">\m&lt;/span>ain.go:20:6: can inline Make10000
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span>.&lt;span style="color:#f1fa8c">\m&lt;/span>ain.go:25:6: can inline MakeN
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span>.&lt;span style="color:#f1fa8c">\m&lt;/span>ain.go:3:6: can inline main
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span>.&lt;span style="color:#f1fa8c">\m&lt;/span>ain.go:4:8: inlining call to Make10
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span>.&lt;span style="color:#f1fa8c">\m&lt;/span>ain.go:5:9: inlining call to Make100
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span>.&lt;span style="color:#f1fa8c">\m&lt;/span>ain.go:6:11: inlining call to Make10000
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span>.&lt;span style="color:#f1fa8c">\m&lt;/span>ain.go:7:7: inlining call to MakeN
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span>.&lt;span style="color:#f1fa8c">\m&lt;/span>ain.go:4:8: make&lt;span style="color:#ff79c6">([]&lt;/span>int, 10&lt;span style="color:#ff79c6">)&lt;/span> does not escape
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span>.&lt;span style="color:#f1fa8c">\m&lt;/span>ain.go:5:9: make&lt;span style="color:#ff79c6">([]&lt;/span>int, 100&lt;span style="color:#ff79c6">)&lt;/span> does not escape
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span>.&lt;span style="color:#f1fa8c">\m&lt;/span>ain.go:6:11: make&lt;span style="color:#ff79c6">([]&lt;/span>int, 10000&lt;span style="color:#ff79c6">)&lt;/span> escapes to heap
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span>.&lt;span style="color:#f1fa8c">\m&lt;/span>ain.go:7:7: make&lt;span style="color:#ff79c6">([]&lt;/span>int, n&lt;span style="color:#ff79c6">)&lt;/span> escapes to heap
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15&lt;/span>&lt;span>.&lt;span style="color:#f1fa8c">\m&lt;/span>ain.go:11:15: make&lt;span style="color:#ff79c6">([]&lt;/span>int, 10&lt;span style="color:#ff79c6">)&lt;/span> does not escape
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16&lt;/span>&lt;span>.&lt;span style="color:#f1fa8c">\m&lt;/span>ain.go:16:16: make&lt;span style="color:#ff79c6">([]&lt;/span>int, 100&lt;span style="color:#ff79c6">)&lt;/span> does not escape
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17&lt;/span>&lt;span>.&lt;span style="color:#f1fa8c">\m&lt;/span>ain.go:21:18: make&lt;span style="color:#ff79c6">([]&lt;/span>int, 10000&lt;span style="color:#ff79c6">)&lt;/span> escapes to heap
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18&lt;/span>&lt;span>.&lt;span style="color:#f1fa8c">\m&lt;/span>ain.go:26:14: make&lt;span style="color:#ff79c6">([]&lt;/span>int, n&lt;span style="color:#ff79c6">)&lt;/span> escapes to heap
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å¯ä»¥çœ‹åˆ°å½“éœ€è¦åˆ†é…é•¿åº¦ä¸º10ï¼Œ100çš„intç±»å‹çš„sliceæ—¶ï¼Œä¸éœ€è¦é€ƒé€¸åˆ°å †ä¸Šï¼Œåœ¨æ ˆä¸Šå°±å¯ä»¥ï¼Œå¦‚æœsliceé•¿åº¦è¾¾åˆ°1000æ—¶ï¼Œå°±éœ€è¦åˆ†é…åˆ°å †ä¸Šäº†ã€‚&lt;/p>
&lt;p>è¿˜æœ‰ä¸€ç§æƒ…å†µï¼Œå½“åœ¨ç¼–è¯‘æœŸé—´é•¿åº¦ä¸ç¡®å®šæ—¶ï¼Œä¹Ÿéœ€è¦åˆ†é…åˆ°å †ä¸Šã€‚&lt;/p>
&lt;h3 id="é—­åŒ…">&lt;a href="#%e9%97%ad%e5%8c%85" class="header-anchor">&lt;/a>é—­åŒ…
&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">package&lt;/span> main
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> &lt;span style="color:#50fa7b">main&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span> &lt;span style="color:#50fa7b">One&lt;/span>()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> &lt;span style="color:#50fa7b">One&lt;/span>() &lt;span style="color:#8be9fd;font-style:italic">func&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span> n &lt;span style="color:#ff79c6">:=&lt;/span> &lt;span style="color:#bd93f9">10&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">func&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span> n&lt;span style="color:#ff79c6">++&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>åœ¨å‡½æ•°&lt;code>One&lt;/code>ä¸­returnäº†ä¸€ä¸ªåŒ¿åå‡½æ•°ï¼Œå½¢æˆäº†ä¸€ä¸ªé—­åŒ…ï¼Œçœ‹ä¸€ä¸‹é€ƒé€¸åˆ†æ&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>&lt;span style="color:#6272a4"># command-line-arguments&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span>&lt;span style="color:#ff79c6">.&lt;/span>\main&lt;span style="color:#ff79c6">.&lt;/span>go:&lt;span style="color:#bd93f9">3&lt;/span>:&lt;span style="color:#bd93f9">6&lt;/span>: can inline main
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3&lt;/span>&lt;span>&lt;span style="color:#ff79c6">.&lt;/span>\main&lt;span style="color:#ff79c6">.&lt;/span>go:&lt;span style="color:#bd93f9">9&lt;/span>:&lt;span style="color:#bd93f9">9&lt;/span>: can inline One&lt;span style="color:#ff79c6">.&lt;/span>func1
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4&lt;/span>&lt;span>&lt;span style="color:#ff79c6">.&lt;/span>\main&lt;span style="color:#ff79c6">.&lt;/span>go:&lt;span style="color:#bd93f9">8&lt;/span>:&lt;span style="color:#bd93f9">2&lt;/span>: moved to heap: n
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5&lt;/span>&lt;span>&lt;span style="color:#ff79c6">.&lt;/span>\main&lt;span style="color:#ff79c6">.&lt;/span>go:&lt;span style="color:#bd93f9">9&lt;/span>:&lt;span style="color:#bd93f9">9&lt;/span>: &lt;span style="color:#ff79c6">func&lt;/span> literal escapes to heap
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å¯ä»¥çœ‹åˆ° å˜é‡ &lt;code>n&lt;/code> ä¹Ÿåˆ†é…åˆ°å †ä¸Šäº†&lt;/p>
&lt;p>è¿˜æœ‰ä¸€ç§æƒ…å†µï¼Œ&lt;code>new&lt;/code> å‡ºæ¥çš„å˜é‡ä¸ä¸€å®šåˆ†é…åˆ°å †ä¸Š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">package&lt;/span> main
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> &lt;span style="color:#50fa7b">main&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4&lt;/span>&lt;span> i &lt;span style="color:#ff79c6">:=&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">new&lt;/span>(&lt;span style="color:#8be9fd">int&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5&lt;/span>&lt;span> _ = i
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>åƒjava C++ç­‰è¯­è¨€ï¼Œnew å‡ºæ¥çš„å˜é‡æ­£å¸¸éƒ½ä¼šåˆ†é…åˆ°å †ä¸Šï¼Œä½†æ˜¯åœ¨goé‡Œï¼Œnewå‡ºæ¥çš„å˜é‡ä¸ä¸€å®šåˆ†é…åˆ°å †ä¸Šï¼Œè‡³äºåˆ†é…åˆ°å“ªé‡Œï¼Œè¿˜æ˜¯çœ‹ç¼–è¯‘å™¨çš„é€ƒé€¸åˆ†ææ¥ç¡®å®š&lt;/p>
&lt;p>ç¼–è¯‘ä¸€ä¸‹çœ‹çœ‹
&lt;code>go build -gcflags=-m main.go&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>&lt;span style="color:#6272a4"># command-line-arguments&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span>.&lt;span style="color:#f1fa8c">\m&lt;/span>ain.go:3:6: can inline main
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3&lt;/span>&lt;span>.&lt;span style="color:#f1fa8c">\m&lt;/span>ain.go:4:10: new&lt;span style="color:#ff79c6">(&lt;/span>int&lt;span style="color:#ff79c6">)&lt;/span> does not escape
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å¯ä»¥çœ‹åˆ° newå‡ºæ¥çš„å˜é‡ï¼Œå¹¶æ²¡æœ‰é€ƒé€¸ï¼Œè¿˜æ˜¯åœ¨æ ˆä¸Šã€‚&lt;/p>
&lt;p>å¸¸è§çš„å†…å­˜é€ƒé€¸åœºæ™¯å·®ä¸å¤šå°±æ˜¯è¿™äº›äº†ï¼Œå†è¯´ä¸€ä¸‹å†…å­˜é€ƒé€¸å¸¦æ¥çš„å½±å“å§&lt;/p>
&lt;h2 id="æ€§èƒ½">&lt;a href="#%e6%80%a7%e8%83%bd" class="header-anchor">&lt;/a>æ€§èƒ½
&lt;/h2>&lt;p>é‚£è‚¯å®šå°±æ˜¯æ€§èƒ½é—®é¢˜äº†ï¼Œå› ä¸ºæ“ä½œæ ˆç©ºé—´æ¯”å †ç©ºé—´è¦å¿«å¤šäº†ï¼Œè€Œä¸”ä½¿ç”¨å †ç©ºé—´è¿˜ä¼šæœ‰GCé—®é¢˜ï¼Œé¢‘ç¹çš„åˆ›å»ºå’Œé‡Šæ”¾å †ç©ºé—´ï¼Œä¼šå¢åŠ GCçš„å‹åŠ›&lt;/p>
&lt;p>ä¸€ä¸ªç®€å•çš„ä¾‹å­æµ‹è¯•ä¸€ä¸‹ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œå‡½æ•°è¿”å›ç»“æ„ä½“çš„æŒ‡é’ˆæ¯”ç›´æ¥è¿”å›ç»“æ„ä½“æ€§èƒ½è¦å¥½&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">package&lt;/span> main
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span>&lt;span style="color:#ff79c6">import&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;testing&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">type&lt;/span> MyStruct &lt;span style="color:#8be9fd;font-style:italic">struct&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span> A &lt;span style="color:#8be9fd">int&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> &lt;span style="color:#50fa7b">BenchmarkOne&lt;/span>(b &lt;span style="color:#ff79c6">*&lt;/span>testing.B) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span> &lt;span style="color:#ff79c6">for&lt;/span> i &lt;span style="color:#ff79c6">:=&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>; i &amp;lt; b.N; i&lt;span style="color:#ff79c6">++&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span> &lt;span style="color:#50fa7b">One&lt;/span>()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15&lt;/span>&lt;span>&lt;span style="color:#6272a4">//go:noinline
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> &lt;span style="color:#50fa7b">One&lt;/span>() MyStruct {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> MyStruct{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18&lt;/span>&lt;span> A: &lt;span style="color:#bd93f9">10&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> &lt;span style="color:#50fa7b">BenchmarkTwo&lt;/span>(b &lt;span style="color:#ff79c6">*&lt;/span>testing.B) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23&lt;/span>&lt;span> &lt;span style="color:#ff79c6">for&lt;/span> i &lt;span style="color:#ff79c6">:=&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>; i &amp;lt; b.N; i&lt;span style="color:#ff79c6">++&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24&lt;/span>&lt;span> &lt;span style="color:#50fa7b">Two&lt;/span>()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28&lt;/span>&lt;span>&lt;span style="color:#6272a4">//go:noinline
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> &lt;span style="color:#50fa7b">Two&lt;/span>() &lt;span style="color:#ff79c6">*&lt;/span>MyStruct {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> &lt;span style="color:#ff79c6">&amp;amp;&lt;/span>MyStruct{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31&lt;/span>&lt;span> A: &lt;span style="color:#bd93f9">10&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>æ³¨æ„&lt;/strong> è¢«è°ƒç”¨çš„å‡½æ•°ä¸€å®šè¦åŠ ä¸Š &lt;code>//go:noinline&lt;/code> æ¥ç¦æ­¢ç¼–è¯‘å™¨å†…è”ä¼˜åŒ–&lt;/p>
&lt;p>ç„¶åæ‰§è¡Œ&lt;/p>
&lt;p>&lt;code>go test -bench . -benchmem&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>goos: windows
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span>goarch: amd64
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3&lt;/span>&lt;span>pkg: escape
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4&lt;/span>&lt;span>BenchmarkOne-6 &lt;span style="color:#bd93f9">951519297&lt;/span> 1.26 ns/op &lt;span style="color:#bd93f9">0&lt;/span> B/op &lt;span style="color:#bd93f9">0&lt;/span> allocs/op
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5&lt;/span>&lt;span>BenchmarkTwo-6 &lt;span style="color:#bd93f9">74933496&lt;/span> 15.4 ns/op &lt;span style="color:#bd93f9">8&lt;/span> B/op &lt;span style="color:#bd93f9">1&lt;/span> allocs/op
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6&lt;/span>&lt;span>PASS
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7&lt;/span>&lt;span>ok escape 2.698s
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å¯ä»¥æ˜æ˜¾çœ‹åˆ° å‡½æ•° &lt;code>One&lt;/code>è¿”å›ç»“æ„ä½“ æ¯” å‡½æ•°&lt;code>Two&lt;/code> è¿”å› ç»“æ„ä½“æŒ‡é’ˆ çš„æ€§èƒ½æ›´å¥½ï¼Œè€Œä¸”è¿˜ä¸ä¼šæœ‰å†…å­˜åˆ†é…ï¼Œä¸ä¼šå¢åŠ GCå‹åŠ›&lt;/p>
&lt;p>æŠ›å¼€ç»“æ„ä½“çš„å¤§å°è°ˆæ€§èƒ½éƒ½æ˜¯è€æµæ°“ï¼Œå¦‚æœç»“æ„ä½“æ¯”è¾ƒå¤æ‚äº†è¿˜æ˜¯æŒ‡é’ˆæ€§èƒ½æ›´é«˜ï¼Œè¿˜æœ‰ä¸€äº›åœºæ™¯å¿…é¡»ä½¿ç”¨æŒ‡é’ˆï¼Œæ‰€ä»¥å®é™…å·¥ä½œä¸­è¿˜æ˜¯è¦åˆ†åœºæ™¯åˆç†ä½¿ç”¨&lt;/p>
&lt;h2 id="æœ€å">&lt;a href="#%e6%9c%80%e5%90%8e" class="header-anchor">&lt;/a>æœ€å
&lt;/h2>&lt;p>å¸¸è§çš„go é€ƒé€¸åˆ†æå·®ä¸å¤šå°±æ˜¯è¿™äº›äº†ï¼Œè™½ç„¶goä¼šè‡ªåŠ¨ç®¡ç†å†…å­˜ï¼Œå‡å°äº†å†™ä»£ç çš„è´Ÿæ‹…ï¼Œä½†æ˜¯æƒ³è¦å†™å‡ºé«˜æ•ˆå¯é çš„ä»£ç è¿˜æ˜¯æœ‰ä¸€äº›ç»†èŠ‚æœ‰æ³¨æ„çš„ã€‚&lt;/p></description></item><item><title>èŠä¸€èŠgoçš„å†…å­˜å¯¹é½</title><link>https://lqxhub.github.io/posts/4992c058/</link><pubDate>Sat, 24 Sep 2022 18:56:10 +0000</pubDate><guid>https://lqxhub.github.io/posts/4992c058/</guid><description>&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/13daf0aa276c1739c5ae961efd41eeacac540a19.jpg" alt="Featured image of post èŠä¸€èŠgoçš„å†…å­˜å¯¹é½" />&lt;h2 id="ä»€ä¹ˆæ˜¯å†…å­˜å¯¹é½å‘¢">&lt;a href="#%e4%bb%80%e4%b9%88%e6%98%af%e5%86%85%e5%ad%98%e5%af%b9%e9%bd%90%e5%91%a2" class="header-anchor">&lt;/a>ä»€ä¹ˆæ˜¯å†…å­˜å¯¹é½å‘¢
&lt;/h2>&lt;p>ç®€å•è¯´å°±æ˜¯ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­ï¼Œç¨‹åºä¸­çš„å˜é‡åœ¨å†…å­˜ä¸­çš„åˆ†å¸ƒæƒ…å†µï¼Œä¸ºä»€ä¹ˆè¦æœ‰å¯¹é½è¿™ä¸ªé—®é¢˜å‘¢ï¼Œæ˜¯å› ä¸ºä¸åŒç±»å‹çš„å˜é‡å ç”¨å†…å­˜çš„å¤§å°æ˜¯ä¸ä¸€æ ·çš„ï¼Œ
ä½†æ˜¯cpuæ¯æ¬¡è¯»å–çš„å†…å­˜é•¿åº¦æ˜¯å›ºå®šçš„ï¼Œä¸ºäº†cpuèƒ½é«˜æ•ˆçš„è¯»å†™æ•°æ®ï¼ˆcpuè¯»å–æ•°æ®ä¸æ˜¯ä¸€ä¸ªå­—èŠ‚ä¸€ä¸ªå­—èŠ‚è¯»å–çš„ï¼Œä¸€æ¬¡è¯»å–çš„ä¸€å—å†…å­˜ï¼‰ï¼Œ
æ‰€ä»¥ç¼–è¯‘å™¨åœ¨ç¼–è¯‘çš„æ—¶å€™ä¼šé€šè¿‡å¡«å……ç©ºæ•°æ®(æ•°æ®ä¸æ˜¯è¿ç»­çš„)ï¼Œè®©ä¸€ä¸ªå˜é‡ï¼Œä½¿cpuèƒ½ä¸€æ¬¡æ“ä½œå°±èƒ½å®Œæˆè¯»å†™ã€‚è¿˜æœ‰è·¨å¹³å°çš„é—®é¢˜ï¼Œæœ‰çš„å¹³å°ä¸æ”¯æŒè®¿é—®ä»»æ„åœ°å€ä¸Šçš„ä»»æ„æ•°æ®ï¼Œå¿…é¡»æŒ‰ç…§é¡ºåºä¾æ¬¡æŒ‰å—è¯»å–ã€‚&lt;/p>
&lt;p>ä¸€ä¸ªç®€å•çš„ä¾‹å­çœ‹ä¸€ä¸‹:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">package&lt;/span> main
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span>&lt;span style="color:#ff79c6">import&lt;/span> (
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span> &lt;span style="color:#f1fa8c">&amp;#34;fmt&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span> &lt;span style="color:#f1fa8c">&amp;#34;unsafe&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">type&lt;/span> One &lt;span style="color:#8be9fd;font-style:italic">struct&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span> a &lt;span style="color:#8be9fd">bool&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span> b &lt;span style="color:#8be9fd">int8&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span> c &lt;span style="color:#8be9fd">int32&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">type&lt;/span> Two &lt;span style="color:#8be9fd;font-style:italic">struct&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15&lt;/span>&lt;span> a &lt;span style="color:#8be9fd">bool&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16&lt;/span>&lt;span> c &lt;span style="color:#8be9fd">int32&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17&lt;/span>&lt;span> b &lt;span style="color:#8be9fd">int8&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> &lt;span style="color:#50fa7b">main&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21&lt;/span>&lt;span> fmt.&lt;span style="color:#50fa7b">Println&lt;/span>(unsafe.&lt;span style="color:#50fa7b">Sizeof&lt;/span>(One{}))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22&lt;/span>&lt;span> fmt.&lt;span style="color:#50fa7b">Println&lt;/span>(unsafe.&lt;span style="color:#50fa7b">Sizeof&lt;/span>(Two{}))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™ä¸¤ä¸ªç»“æ„ä½“åœ¨è¿è¡Œæ—¶ï¼Œå ç”¨çš„å†…å­˜å¤§å°ï¼Œçœ‹èµ·æ¥åº”è¯¥æ¥è¯´æ˜¯ä¸€æ ·å¤§çš„ï¼Œæ¯•ç«Ÿå†…éƒ¨çš„å˜é‡æ˜¯ä¸€æ ·çš„ï¼Œåªæ˜¯é¡ºåºä¸åŒè€Œå·²ã€‚&lt;/p>
&lt;p>ä½†å®é™…ä¸Šï¼Œå ç”¨çš„å†…å­˜æ˜¯ä¸ä¸€æ ·çš„ï¼Œçœ‹ä¸€ä¸‹è¿è¡Œç»“æœï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>go run main.go
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span>&lt;span style="color:#bd93f9">4&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3&lt;/span>&lt;span>&lt;span style="color:#bd93f9">12&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä¸ºä»€ä¹ˆä¼šè¿™æ ·å‘¢ï¼Œç”»ä¸€ä¸‹å†…å­˜çš„ç¤ºæ„å›¾å°±æ¸…æ¥šäº†&lt;/p>
&lt;p>&lt;strong>Oneçš„å†…å­˜&lt;/strong>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-b61dc75cfd3192df.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-b61dc75cfd3192df.webp" alt="" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>&lt;strong>Twoçš„å†…å­˜&lt;/strong>&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-943bc293458d9517.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-943bc293458d9517.webp" alt="" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>å›¾ä¸­ç°è‰²çš„å—æ˜¯ä¸ºäº†å¯¹é½è€Œå¡«å……çš„æ— ç”¨åŒºåŸŸï¼Œå¯è§ &lt;strong>One&lt;/strong> çš„ å†…å­˜åˆ©ç”¨ç‡æ¯” &lt;strong>Two&lt;/strong> è¦é«˜å¥½å¤šï¼Œå› ä¸ºcpuä¸€æ¬¡è¯»å–çš„å†…å­˜å¤§å°æ˜¯4ä¸ªå­—èŠ‚ï¼Œä¹Ÿå°±æ˜¯32ä½ã€‚ä¸ºäº†èƒ½è®©cpuä¸€æ¬¡å°±è¯»å–å®Œè¿™ä¸ªå˜é‡ï¼Œæ‰€ä»¥ç¼–è¯‘å™¨å°±åšäº†ä¸€äº›è°ƒæ•´ï¼Œä½¿å†…å­˜åˆ©ç”¨ç‡ä½äº†ï¼Œä½†æ˜¯å´æé«˜äº†æ•ˆç‡ã€‚&lt;/p>
&lt;p>è¿™é‡Œåˆå¸¦æ¥ä¸€ä¸ªé—®é¢˜ï¼Œcpuä¸€æ¬¡è¯»å–æ•°æ®çš„é•¿åº¦æ˜¯å¦‚ä½•ç¡®å®šçš„ï¼Œè¿™ä¸ªå«å¯¹é½ç³»æ•°ã€‚&lt;/p>
&lt;p>goä¸­æœ‰ä¸€ä¸ªå‡½æ•°ï¼Œå¯ä»¥è®¡ç®—å‡ºå¯¹é½ç³»æ•°ï¼Œä¸€æ®µä»£ç çœ‹ä¸€ä¸‹&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">package&lt;/span> main
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span>&lt;span style="color:#ff79c6">import&lt;/span> (
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span> &lt;span style="color:#f1fa8c">&amp;#34;fmt&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span> &lt;span style="color:#f1fa8c">&amp;#34;unsafe&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">type&lt;/span> One &lt;span style="color:#8be9fd;font-style:italic">struct&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span> a &lt;span style="color:#8be9fd">bool&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span> b &lt;span style="color:#8be9fd">int8&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">type&lt;/span> Two &lt;span style="color:#8be9fd;font-style:italic">struct&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span> a &lt;span style="color:#8be9fd">bool&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15&lt;/span>&lt;span> c &lt;span style="color:#8be9fd">int32&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16&lt;/span>&lt;span> b &lt;span style="color:#8be9fd">int8&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">type&lt;/span> Three &lt;span style="color:#8be9fd;font-style:italic">struct&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20&lt;/span>&lt;span> a &lt;span style="color:#8be9fd">bool&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21&lt;/span>&lt;span> b &lt;span style="color:#8be9fd">int8&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22&lt;/span>&lt;span> c &lt;span style="color:#8be9fd">int64&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> &lt;span style="color:#50fa7b">main&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26&lt;/span>&lt;span> fmt.&lt;span style="color:#50fa7b">Println&lt;/span>(unsafe.&lt;span style="color:#50fa7b">Alignof&lt;/span>(One{}))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27&lt;/span>&lt;span> fmt.&lt;span style="color:#50fa7b">Println&lt;/span>(unsafe.&lt;span style="color:#50fa7b">Alignof&lt;/span>(Two{}))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28&lt;/span>&lt;span> fmt.&lt;span style="color:#50fa7b">Println&lt;/span>(unsafe.&lt;span style="color:#50fa7b">Alignof&lt;/span>(Three{}))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿è¡Œç»“æœå¦‚ä¸‹&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>go run main.go
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span>&lt;span style="color:#bd93f9">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3&lt;/span>&lt;span>&lt;span style="color:#bd93f9">4&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4&lt;/span>&lt;span>&lt;span style="color:#bd93f9">8&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å¯ä»¥å¾—åˆ°ï¼Œcpuä¸€æ¬¡è¯»å–çš„æ•°æ®é•¿åº¦å’Œè¿™ç»“æ„ä½“ä¸­çš„æœ€å¤§çš„æ•°æ®æœ‰å…³ã€‚&lt;/p>
&lt;p>&lt;strong>One&lt;/strong> ä¸­æœ€å¤§çš„æ•°æ®é•¿åº¦æ˜¯1ä¸ªå­—èŠ‚, &lt;strong>Two&lt;/strong> ä¸­æœ€å¤§çš„æ•°æ®é•¿åº¦æ˜¯4ä¸ªå­—èŠ‚, &lt;strong>Three&lt;/strong> ä¸­æœ€å¤§çš„æ•°æ®é•¿åº¦æ˜¯8ä¸ªå­—èŠ‚&lt;/p>
&lt;p>å¦‚æœæˆ‘æ¢æˆ &lt;strong>32ä½æ“ä½œç³»ç»Ÿ&lt;/strong> å‘¢&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">$env&lt;/span>:GOARCH&lt;span style="color:#ff79c6">=&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;386&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span>go run main.go
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3&lt;/span>&lt;span>&lt;span style="color:#bd93f9">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4&lt;/span>&lt;span>&lt;span style="color:#bd93f9">4&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5&lt;/span>&lt;span>&lt;span style="color:#bd93f9">4&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æ­¤æ—¶çš„å¯¹é½ç³»æ•°å˜æˆäº†4ï¼Œå› ä¸º32ä½çš„ç³»ç»Ÿä¸€æ¬¡èƒ½å¤„ç†çš„æ•°æ®é•¿åº¦å°±æ˜¯ &lt;strong>4ä¸ªå­—èŠ‚&lt;/strong>ï¼Œè¯´æ˜å¯¹é½ç³»æ•°è¿˜å’Œæ“ä½œç³»ç»Ÿæœ‰å…³ã€‚&lt;/p>
&lt;p>æ‰€ä»¥ï¼šå¯¹é½ç³»æ•°å’Œç»“æ„ä½“ä¸­æœ€å¤§çš„çš„æ•°æ®æœ‰å…³ï¼ŒåŒæ—¶å’Œæ“ä½œç³»ç»Ÿä¹Ÿæœ‰å…³ã€‚å–è¿™ä¸¤ä¸ªæ¡ä»¶ä¸­çš„å°å€¼&lt;/p>
&lt;h2 id="å†…å­˜å¯¹é½çš„åˆ©å¼Š">&lt;a href="#%e5%86%85%e5%ad%98%e5%af%b9%e9%bd%90%e7%9a%84%e5%88%a9%e5%bc%8a" class="header-anchor">&lt;/a>å†…å­˜å¯¹é½çš„åˆ©å¼Š
&lt;/h2>&lt;p>&lt;strong>åˆ©&lt;/strong>&lt;/p>
&lt;ol>
&lt;li>é«˜æ•ˆ. æ•°æ®åªéœ€è¦ä¸€æ¬¡å°±èƒ½å®Œæˆè¯»å†™ï¼Œæ•ˆç‡è‚¯å®šæ¯”å¤šæ¬¡è¯»å†™è¦é«˜æ•ˆ&lt;/li>
&lt;li>æ•°æ®åŸå­æ€§. è¿˜æ˜¯æ•°æ®ä¸€æ¬¡å°±èƒ½å®Œæˆè¯»å†™ï¼Œä¿è¯äº†åŸå­æ€§&lt;/li>
&lt;/ol>
&lt;p>&lt;strong>å¼Š&lt;/strong>&lt;/p>
&lt;p>é‚£å°±æ˜¯å†…å­˜çš„åˆ©ç”¨ç‡å˜ä½äº†ï¼Œè¿™ä¸ªå¯ä»¥é€šè¿‡ä¼˜åŒ–æ¥è§£å†³ä¸€éƒ¨åˆ†&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-f0d8037647181da7.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-f0d8037647181da7.webp" alt="" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>çœ‹ä¸€ä¸‹å¦‚æœæ²¡æœ‰å†…å­˜å¯¹é½çš„æƒ…å†µå§ï¼Œå¦‚æœåœ¨32ä½çš„ç³»ç»Ÿä¸Šï¼Œå˜é‡Cè¦ç»è¿‡ä¸¤æ¬¡æ‰èƒ½è¯»åˆ°&lt;/p>
&lt;h2 id="ä¸åŒç±»å‹çš„å¯¹é½ç³»æ•°">&lt;a href="#%e4%b8%8d%e5%90%8c%e7%b1%bb%e5%9e%8b%e7%9a%84%e5%af%b9%e9%bd%90%e7%b3%bb%e6%95%b0" class="header-anchor">&lt;/a>ä¸åŒç±»å‹çš„å¯¹é½ç³»æ•°
&lt;/h2>&lt;p>åœ¨64ä½æ“ä½œç³»ç»Ÿä¸­&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>ç±»å‹&lt;/th>
&lt;th>ç³»æ•°&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>bool, byte, uint8, int8&lt;/td>
&lt;td>1&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>uint16, int16&lt;/td>
&lt;td>2&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>uint32, int32&lt;/td>
&lt;td>4&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>float32, complex64&lt;/td>
&lt;td>4&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>int, uint, int64, uint64,string,uintptr,float64&lt;/td>
&lt;td>8&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>æœ‰ä¸ªç‰¹æ®Šçš„ç±»å‹ &lt;code>struct{}&lt;/code> ç©ºç»“æ„ä½“ï¼Œè¿™ä¸ªç»“æ„ä½“çš„ç©ºé—´å¤§å°æ˜¯0ï¼Œä½†æ˜¯è®¡ç®—å‡ºçš„å¯¹é½ç³»æ•°æ˜¯1ã€‚&lt;/p>
&lt;p>è€Œä¸” &lt;code>struct{}&lt;/code>çš„ä½ç½®ä¸åŒï¼Œå ç”¨çš„ç©ºé—´ä¹Ÿä¸ç›¸åŒ&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">package&lt;/span> main
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span>&lt;span style="color:#ff79c6">import&lt;/span> (
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span> &lt;span style="color:#f1fa8c">&amp;#34;fmt&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span> &lt;span style="color:#f1fa8c">&amp;#34;unsafe&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">type&lt;/span> One &lt;span style="color:#8be9fd;font-style:italic">struct&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span> s &lt;span style="color:#8be9fd;font-style:italic">struct&lt;/span>{}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span> x &lt;span style="color:#8be9fd">int&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">type&lt;/span> Two &lt;span style="color:#8be9fd;font-style:italic">struct&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span> x &lt;span style="color:#8be9fd">int&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span> s &lt;span style="color:#8be9fd;font-style:italic">struct&lt;/span>{}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> &lt;span style="color:#50fa7b">main&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18&lt;/span>&lt;span> fmt.&lt;span style="color:#50fa7b">Println&lt;/span>(unsafe.&lt;span style="color:#50fa7b">Sizeof&lt;/span>(One{}))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19&lt;/span>&lt;span> fmt.&lt;span style="color:#50fa7b">Println&lt;/span>(unsafe.&lt;span style="color:#50fa7b">Sizeof&lt;/span>(Two{}))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿è¡Œç»“æœå¦‚ä¸‹:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>go run main.go
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span>&lt;span style="color:#bd93f9">8&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3&lt;/span>&lt;span>&lt;span style="color:#bd93f9">16&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>One&lt;/strong> å’Œ &lt;strong>Two&lt;/strong> ä¸­ï¼Œåªæ˜¯ &lt;code>struct{}&lt;/code>çš„ä½ç½®ä¸åŒï¼Œå°±ä¼šå¯¼è‡´å†…å­˜å ç”¨ä¸åŒ&lt;/p>
&lt;p>ä¹‹æ‰€ä»¥è¿™æ ·æ˜¯å› ä¸ºï¼Œå½“&lt;code>struct{}&lt;/code> ä½œä¸ºç»“æ„ä½“æœ€åä¸€ä¸ªå­—æ®µæ—¶ï¼Œå¦‚æœ&lt;code>struct{}&lt;/code>ä¸åšå¡«å……ï¼Œå°±ä¼šå¯¼è‡´æŒ‡å‘ &lt;code>struct{}&lt;/code> çš„åœ°å€æŒ‡å‘äº† ç»“æ„ä½“ä¹‹å¤–äº†ï¼Œæ‰€ä»¥ä¸ºäº†å‡ºé”™ï¼Œå°±ä¼šå¡«å……ä¸€ä¸ªæ•°æ®ä½ç½®ï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ª intçš„å¤§å°ã€‚&lt;/p>
&lt;h2 id="å¦‚ä½•ä¼˜åŒ–å†…å­˜å¸ƒå±€">&lt;a href="#%e5%a6%82%e4%bd%95%e4%bc%98%e5%8c%96%e5%86%85%e5%ad%98%e5%b8%83%e5%b1%80" class="header-anchor">&lt;/a>å¦‚ä½•ä¼˜åŒ–å†…å­˜å¸ƒå±€
&lt;/h2>&lt;p>é¦–å…ˆï¼Œgoçš„ç¼–è¯‘å™¨ä¸ä¼šåšå†…å­˜å¯¹é½çš„ä¼˜åŒ–ï¼Œä¹Ÿå°±æ˜¯åœ¨ç¼–è¯‘æœŸé—´ï¼Œç¼–è¯‘å™¨ä¸ä¼šè°ƒæ•´ç»“æ„ä½“ä¸­å­—æ®µçš„é¡ºåºã€‚è‡³äºä¸ºå•¥ä¸åšï¼Œæˆ‘è¿˜æ²¡æƒ³é€šï¼Œæœ‰çŸ¥é“çš„æ¬¢è¿è¯„è®ºåŒºæ¢è®¨ã€‚&lt;/p>
&lt;p>æ‰€ä»¥å†…å­˜å¯¹é½çš„ä¼˜åŒ–éœ€è¦æˆ‘ä»¬è‡ªå·±åšã€‚&lt;/p>
&lt;p>æˆ‘è‡ªå·±æ€»ç»“çš„ä¸¤ç‚¹ï¼Œæ¬¢è¿è¡¥å……&lt;/p>
&lt;ol>
&lt;li>å°½é‡æŠŠç›¸åŒç±»å‹çš„å˜é‡æ”¾åˆ°ä¸€èµ·&lt;/li>
&lt;li>æŠŠå°çš„æ•°æ®æ”¾åˆ°å‰é¢ï¼Œå¤§çš„æ•°æ®æ”¾åˆ°åé¢&lt;/li>
&lt;/ol>
&lt;p>å¥½äº†ï¼Œå¸¸è§çš„goå†…å­˜å¯¹é½çš„é—®é¢˜ å·®ä¸å¤šå°±æ˜¯è¿™äº›äº†ã€‚&lt;/p>
&lt;p>è¯´å®è¯ï¼Œæˆ‘åœ¨å·¥ä½œä¸­ä¸æ˜¯ç‰¹åˆ«æ³¨æ„å†…å­˜å¯¹é½çš„é—®é¢˜ï¼Œåªæœ‰åœ¨æƒ³åˆ°çš„æ—¶å€™æ‰ä¼šåšä¸€ä¸‹ã€‚è¿™ä¸ªä¸œè¥¿å¸¦æ¥çš„æ”¶ç›Šä¸æ˜¯ç‰¹åˆ«å¤§ï¼Œåœ¨å†…å­˜åŠ¨ä¸åŠ¨16Gèµ·æ­¥çš„æ—¶ä»£ï¼Œè¿™ç‚¹ä¼˜åŒ–å¯ä»¥å¿½ç•¥ä¸è®¡çš„ï¼Œå½“åšçŸ¥è¯†äº†è§£ä¸€ä¸‹å°±å¥½äº†ã€‚&lt;/p></description></item><item><title>githubæäº¤pull requestæµç¨‹å’Œcommité‡å¤è§£å†³åŠæ³•</title><link>https://lqxhub.github.io/posts/639c962/</link><pubDate>Sat, 20 Aug 2022 17:44:17 +0000</pubDate><guid>https://lqxhub.github.io/posts/639c962/</guid><description>&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/1573462520_5dc921f8018f2.jpeg" alt="Featured image of post githubæäº¤pull requestæµç¨‹å’Œcommité‡å¤è§£å†³åŠæ³•" />&lt;p>ç»™Githubä¸Šçš„å¼€æºé¡¹ç›®è´¡çŒ®ä»£ç ï¼Œå°±å°‘ä¸äº† &lt;strong>pull request&lt;/strong> ä¹Ÿä¼šç®€ç§°ä¸º &lt;strong>PR&lt;/strong> æˆ–è€… &lt;strong>MR&lt;/strong>&lt;/p>
&lt;p>ä¸ºå•¥æˆ‘ä¸èƒ½ç›´æ¥ç»™å¼€æºé¡¹ç›®æäº¤ä»£ç ï¼Œéè¦é€šè¿‡ PR è´¡çŒ®å‘¢ã€‚
ä¸»è¦æœ‰ä¸¤ä¸ªæ–¹é¢å§&lt;/p>
&lt;ol>
&lt;li>å¼€æºé¡¹ç›®çš„ä½œè€…è¦ç”„åˆ«æäº¤çš„ä»£ç çš„è´¨é‡ï¼Œä¸èƒ½ä»€ä¹ˆçƒ‚ä»£ç éƒ½å¯ä»¥æäº¤åˆ°è¿™ä¸ªé¡¹ç›®é‡Œï¼Œåªæœ‰ä½œè€…è§‰å¾—åˆé€‚çš„ä»£ç æ‰å¯ä»¥åŠ åˆ°é¡¹ç›®é‡Œ&lt;/li>
&lt;li>é˜²æ­¢åˆ«äººæç ´åï¼Œè¦æ˜¯è°éƒ½èƒ½éšä¾¿æäº¤ä»£ç ï¼Œä¸‡ä¸€ä½ ç»™æˆ‘æ¥ä¸ªåˆ åº“è·‘è·¯ï¼Œä½œè€…æƒ³é—®å€™ä»–å…¨å®¶&lt;/li>
&lt;/ol>
&lt;p>åŸºäºè¿™ä¸¤ä¸ªæ–¹é¢çš„è€ƒè™‘å§ï¼Œgitbubåªèƒ½ä¿®æ”¹è‡ªå·±çš„é¡¹ç›®çš„ä»£ç ï¼Œç„¶åå‘åŸé¡¹ç›®æäº¤ PRï¼Œ åŸé¡¹ç›®ä½œè€…å¯ä»¥é€‰æ‹©æ€§çš„åˆå¹¶åˆ°é¡¹ç›®ä¸­ã€‚&lt;/p>
&lt;p>æ‰€ä»¥ï¼ŒGithubè´¡çŒ®ä»£ç åŸºæœ¬æµç¨‹å¦‚ä¸‹ï¼š&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-fb1797fd039b58aa.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-fb1797fd039b58aa.webp" alt="" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;h2 id="fork">&lt;a href="#fork" class="header-anchor">&lt;/a>fork
&lt;/h2>&lt;p>è¿™ä¸ªæ²¡ä»€ä¹ˆå¥½è¯´çš„ï¼Œæ‰¾åˆ°ä½ æƒ³è¦è´¡çŒ®ä»£ç çš„é¡¹ç›®ï¼Œç„¶åç‚¹å³ä¸Šè§’çš„ &lt;strong>fork&lt;/strong> å°±å¥½äº†&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-c6738f0061021264.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-c6738f0061021264.webp" alt="" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>ç„¶åå›åˆ°è‡ªå·±çš„ repositories ä¸­å°±èƒ½çœ‹åˆ°åˆšæ‰fork çš„é¡¹ç›®äº†ï¼Œå…¶å®forkå°±æ˜¯å¤åˆ¶äº†å½“å‰é¡¹ç›®çš„é•œåƒï¼Œè¿™ä¸ªå¤åˆ¶åçš„é•œåƒå°±æ˜¯ä½ è‡ªå·±çš„äº†ï¼Œä½ æ‹¥æœ‰æœ€é«˜çš„æƒé™ã€‚&lt;/p>
&lt;h2 id="pull">&lt;a href="#pull" class="header-anchor">&lt;/a>pull
&lt;/h2>&lt;p>pull å°±æ˜¯æŠŠfork åçš„é¡¹ç›®æ‹‰åˆ°æœ¬åœ°ï¼Œç„¶åä¿®æ”¹ä»£ç ã€‚è¿™ä¸ªæ²¡å•¥è¯´çš„ï¼Œå°±æ˜¯å¸¸è§„æ“ä½œã€‚&lt;/p>
&lt;h2 id="commit">&lt;a href="#commit" class="header-anchor">&lt;/a>commit
&lt;/h2>&lt;p>commit ä¹Ÿæ²¡å•¥ï¼Œå’Œæ­£å¸¸çš„æäº¤ä»£ç ä¸€æ ·ï¼Œå†™å¥½æäº¤ä¿¡æ¯å°±å¥½äº†ã€‚&lt;/p>
&lt;h2 id="push">&lt;a href="#push" class="header-anchor">&lt;/a>push
&lt;/h2>&lt;p>push å°±æ˜¯æŠŠè¿™æ¬¡çš„commitæäº¤åˆ°è‡ªå·±çš„githubä¸Šå»ã€‚æ³¨æ„ï¼Œè¿™æ¬¡pushæ˜¯pushåˆ°è‡ªå·±forkåçš„ä»“åº“ä¸­ï¼Œåˆ«ææ··äº†ã€‚&lt;/p>
&lt;h2 id="pull-request">&lt;a href="#pull-request" class="header-anchor">&lt;/a>pull request
&lt;/h2>&lt;p>ç°åœ¨å°±åˆ°æœ€é‡è¦çš„ä¸€æ­¥äº†ï¼Œåˆ›å»º pull requestäº†ã€‚
åˆ°è‡ªå·±çš„githubä¸­ï¼Œèƒ½çœ‹åˆ°è‡ªå·±åˆšæ‰çš„commitäº†ï¼Œè¿™æ—¶å€™github å°±ä¼šæç¤ºæˆ‘ä»¬å»åˆ›å»ºpull requestäº†&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-1c15af0ce9f3bfad.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-1c15af0ce9f3bfad.webp" alt="" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>æˆ–è€…æŒ‰ç…§ä¸‹å›¾ä¸­çš„é¡ºåºï¼Œä¸€æ ·å¯ä»¥åˆ°åˆ›å»º PRçš„é¡µé¢&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-0ef49a14cfac4231.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-0ef49a14cfac4231.webp" alt="" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>é€šè¿‡ä¸‹å›¾æ ‡æ³¨çš„åœ°æ–¹ï¼Œé€‰æ‹©è¦Mergeçš„åˆ†æ”¯ï¼Œä¸€èˆ¬é»˜è®¤éƒ½æ˜¯æ­£ç¡®çš„ã€‚&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-4fceaea1aac2486e.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-4fceaea1aac2486e.webp" alt="" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>å› ä¸ºæˆ‘å·²ç»æŠŠè¿™ä¸ªPRæäº¤äº†ï¼Œæ‰€ä»¥æ˜¾ç¤ºçš„æ˜¯ &lt;strong>View pull request&lt;/strong>ï¼Œæ­£å¸¸çš„æ˜¾ç¤ºçš„æ˜¯ &lt;strong>create pull request&lt;/strong>
ç„¶åæ ¹æ®æç¤ºåˆ›å»ºè¿™ä¸ªPRå°±å¥½äº†ã€‚&lt;/p>
&lt;p>åˆ°è¿™é‡Œï¼Œä¸€æ¬¡å®Œæ•´çš„PRæµç¨‹åŸºæœ¬å°±å®Œæˆäº†ï¼Œå‰©ä¸‹çš„å°±ç­‰ç€åŸé¡¹ç›®ä½œè€…Mergeå°±è¡Œäº†ã€‚&lt;/p>
&lt;p>&lt;strong>ä½†æ˜¯äº‹æƒ…æ²¡æœ‰ç»“æŸ&lt;/strong>&lt;/p>
&lt;p>å¦‚æœåŸé¡¹ç›®ä½œè€…åŒæ„åˆå¹¶äº†ï¼Œæäº¤çš„ä»£ç å°±ä¼šåˆå¹¶åˆ°ä¸»é¡¹ç›®ä¸­ï¼Œæˆ–è€…æœ‰åˆ«äººä¹Ÿæäº¤PRäº†ï¼Œè¿™æ˜¯ä½ æƒ³å†æ¬¡æäº¤PRçš„è¯ï¼Œå°±è¦å…ˆåŒæ­¥ä»“åº“äº†ï¼Œå°±æ˜¯æŠŠè‡ªå·±forkçš„ä»“åº“å’Œæºé¡¹ç›®çš„ä»“åº“ä¿æŒåŒæ­¥ã€‚
å¦‚æœç›´æ¥åœ¨githubä¸Šç‚¹ &lt;strong>sync fork&lt;/strong>ï¼Œgithubä¼šè‡ªåŠ¨å¸®ä½ Mergeä¸¤ä¸ªä»“åº“ï¼Œä¹Ÿå°±æ˜¯ä¼šæŠŠä¹‹å‰ä½ çš„commitä¿¡æ¯ä¸€èµ·Mergeè¿‡æ¥ï¼Œ
å½“ä½ ä¸‹æ¬¡å†è¦æäº¤PRçš„æ—¶å€™ï¼Œå°±ä¼šå‡ºç°ä¹‹å‰çš„commitä¿¡æ¯ã€‚å› ä¸ºåœ¨ &lt;strong>sync fork&lt;/strong> çš„æ—¶å€™æ˜¯Mergeçš„ï¼Œæ‰€ä»¥ä¼šå¸¦ä¸Šä¹‹å‰çš„æäº¤ä¿¡æ¯ã€‚&lt;/p>
&lt;h2 id="å…ˆè¯´å·²ç»sync-forkååœ¨åˆ›å»º-præ—¶æ‰å‘ç°çš„è§£å†³åŠæ³•">&lt;a href="#%e5%85%88%e8%af%b4%e5%b7%b2%e7%bb%8fsync-fork%e5%90%8e%e5%9c%a8%e5%88%9b%e5%bb%ba-pr%e6%97%b6%e6%89%8d%e5%8f%91%e7%8e%b0%e7%9a%84%e8%a7%a3%e5%86%b3%e5%8a%9e%e6%b3%95" class="header-anchor">&lt;/a>å…ˆè¯´å·²ç»&lt;strong>sync fork&lt;/strong>åï¼Œåœ¨åˆ›å»º PRæ—¶æ‰å‘ç°çš„è§£å†³åŠæ³•ï¼š
&lt;/h2>&lt;p>å›åˆ°è‡ªå·±ç”µè„‘ä¸Š&lt;/p>
&lt;p>æŠŠæœ¬åœ°çš„ä»£ç å›é€€åˆ°é‡å¤ä¹‹å‰çš„é‚£ä¸ªç‰ˆæœ¬
é€šè¿‡ &lt;code>git log&lt;/code> æ‰¾åˆ°é‡å¤å‰çš„é‚£ä¸ªç‰ˆæœ¬ã€‚
ç„¶åå›é€€åˆ°é‚£ä¸ªç‰ˆæœ¬&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>git reset å¯¹åº”ç‰ˆæœ¬çš„id
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™æ—¶å€™æœ¬åœ°ä¿®æ”¹çš„ä»£ç å°±ä¼šå›åˆ°æœªæäº¤çš„çŠ¶æ€ï¼Œè¿™æ—¶å€™å…ˆæŠŠæ”¹çš„ä»£ç å¤åˆ¶ä¸€ä»½å‡ºæ¥ï¼Œé¿å…æ“ä½œå¤±è¯¯æ‰¾ä¸åˆ°äº†å°±å°´å°¬äº†ã€‚
å†é€šè¿‡&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>git checkout .
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æŠŠæ”¾å¼ƒæœ¬åœ°ä¿®æ”¹ã€‚&lt;/p>
&lt;p>ç„¶åé‡ç‚¹æ¥äº†ï¼Œç»™é¡¹ç›®åŠ ä¸€ä¸ªä¸Šæ¸¸åœ°å€ã€‚
å…ˆçœ‹ä¸€ä¸‹å½“å‰çš„åˆ†æ”¯&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>git remote -v
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3&lt;/span>&lt;span>origin git@github.com:lqxhub/pika.git &lt;span style="color:#ff79c6">(&lt;/span>fetch&lt;span style="color:#ff79c6">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4&lt;/span>&lt;span>origin git@github.com:lqxhub/pika.git &lt;span style="color:#ff79c6">(&lt;/span>push&lt;span style="color:#ff79c6">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æ­¤æ—¶åªæœ‰è‡ªå·±forkåçš„ä»“åº“ã€‚
ç°åœ¨è¦ç»™forkåçš„ä»“åº“ï¼ŒåŠ ä¸€ä¸ªä¸Šæ¸¸åœ°å€ï¼Œä¹Ÿå°±æ˜¯æŒ‡å®šè¿™ä¸ªä»“åº“æ˜¯ä»å“ªé‡Œforkæ¥çš„&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>git remote add upstream https://github.com/OpenAtomFoundation/pika.git
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>upstream &lt;/code>åé¢è·Ÿä¸Šæºä»“åº“åœ°å€
ç°åœ¨æ¥çœ‹çœ‹åˆ†æ”¯å™¨æƒ…å†µ&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>git remote -v
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span>origin git@github.com:lqxhub/pika.git &lt;span style="color:#ff79c6">(&lt;/span>fetch&lt;span style="color:#ff79c6">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3&lt;/span>&lt;span>origin git@github.com:lqxhub/pika.git &lt;span style="color:#ff79c6">(&lt;/span>push&lt;span style="color:#ff79c6">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5&lt;/span>&lt;span>upstream https://github.com/OpenAtomFoundation/pika.git &lt;span style="color:#ff79c6">(&lt;/span>fetch&lt;span style="color:#ff79c6">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6&lt;/span>&lt;span>upstream https://github.com/OpenAtomFoundation/pika.git &lt;span style="color:#ff79c6">(&lt;/span>push&lt;span style="color:#ff79c6">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>åˆ°è¿™ä¸Šæ¸¸ä»“åº“å·²ç»åŠ å¥½äº†&lt;/p>
&lt;p>ç„¶åæ‰§è¡Œ&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>git fetch upstream
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>åŒæ­¥ä¸Šæ¸¸ä»“åº“åˆ°æœ¬åœ°&lt;/p>
&lt;p>ç­‰ä»£ç åŒæ­¥å®Œæˆ&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>git branch -a
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>çœ‹ä¸€ä¸‹å½“å‰çš„åˆ†æ”¯æƒ…å†µ&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>* master
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span> remotes/origin/HEAD -&amp;gt; origin/master
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span> remotes/origin/master
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span> remotes/upstream/2.3
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span> remotes/upstream/3.0
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span> remotes/upstream/3.0.16
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span> remotes/upstream/3.2.9_beta_rocksdb5.18.3
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span> remotes/upstream/develop
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span> remotes/upstream/master
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span> remotes/upstream/pika_codis
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™æ—¶å€™å°±èƒ½çœ‹åˆ°å¾ˆå¤šåˆ†æ”¯äº†ï¼Œç„¶åæŠŠè‡ªå·±æœ¬åœ°çš„ä»£ç rebaseåˆ°æƒ³è¦çš„åˆ†æ”¯ï¼Œä¸€èˆ¬å°±æ˜¯&lt;code>remote/upstream/master&lt;/code>&lt;/p>
&lt;p>æ‰§è¡Œ&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>git rebase remotes/upstream/master
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>åˆ°è¿™ï¼Œæœ¬åœ°çš„ä»£ç å°±å·²ç»å’ŒåŸä»“åº“ä¿æŒåŒæ­¥äº†ã€‚æ³¨æ„ä¸€å®šæ˜¯ &lt;strong>bebase&lt;/strong> ä¸è¦ &lt;strong>merge&lt;/strong>&lt;/p>
&lt;p>&lt;strong>æ ¸å¿ƒæ€æƒ³å°±æ˜¯è®©æœ¬åœ°ä»£ç è½åäºä¸Šæ¸¸ä»“åº“ï¼Œç„¶åå†æŠŠæœ¬åœ°çš„rebaseåˆ°æœ€æ–°çš„&lt;/strong>&lt;/p>
&lt;p>ç„¶åå°±æ­£å¸¸çš„ä¿®æ”¹ä»£ç  &lt;code>commit&lt;/code> &lt;code>push&lt;/code>&lt;/p>
&lt;p>&lt;strong>æ³¨æ„&lt;/strong> è¿™é‡Œpushçš„æ—¶å€™è¦å¼ºåˆ¶ push &lt;code>git push -f&lt;/code> è¦ä¸ç„¶ä¼šå¤±è´¥&lt;/p>
&lt;p>æœ€åå»githubä¸Š æäº¤ PRå°±å¥½äº†ã€‚&lt;/p>
&lt;p>ä¸Šé¢è¯´çš„æ˜¯å‡ºé”™äº†æ€ä¹ˆè¡¥æ•‘ï¼Œå†è¯´ä¸€ä¸‹åº”è¯¥æ€ä¹ˆæ­£ç¡®æ“ä½œ&lt;/p>
&lt;h2 id="æ­£ç¡®çš„æ“ä½œ">&lt;a href="#%e6%ad%a3%e7%a1%ae%e7%9a%84%e6%93%8d%e4%bd%9c" class="header-anchor">&lt;/a>æ­£ç¡®çš„æ“ä½œ
&lt;/h2>&lt;p>æ­£ç¡®çš„æ“ä½œæ˜¯ï¼Œæ¯æ¬¡ä¿®æ”¹ä»£ç éƒ½æ–°å»ºä¸€ä¸ªåˆ†æ”¯ï¼Œåœ¨åˆ†æ”¯ä¸Šä¿®æ”¹ä»£ç ï¼Œè¿™æ ·å°±ä¸ä¼šå¸¦ä¸Šä¹‹å‰çš„ä¿¡æ¯äº†ã€‚&lt;/p>
&lt;p>æˆ–è€…ä¸€å¼€å§‹å°±åœ¨æœ¬åœ°åŠ ä¸Šä¸Šæ¸¸ä»“åº“åœ°å€ï¼Œæ¯æ¬¡éƒ½æ˜¯&lt;code>git fetch upstream&lt;/code> ç„¶ååŸºäº&lt;code>remote/upstream/master&lt;/code>åˆ†æ”¯ï¼Œåœ¨æœ¬åœ°æ–°å»ºä¸€ä¸ªåˆ†æ”¯(å‡è®¾æ–°åˆ†æ”¯æ˜¯ newDev)å¼€å§‹å¼€å‘ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>git checkout -b newDev remote/upstream/master
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æ–°ç‰ˆæœ¬çš„gitå¯ä»¥ç”¨&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>git switch -c newDev remote/upstream/master
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å¥½äº†ï¼Œé—®é¢˜è§£å†³äº†ï¼Œåˆå¯ä»¥æ„‰å¿«çš„å‚ä¸å¼€æºé¡¹ç›®äº†ã€‚&lt;/p></description></item><item><title>goä½¿ç”¨build tagså®ç°æ¡ä»¶ç¼–è¯‘ï¼ŒGoä¸­çš„æ¡ä»¶ç¼–è¯‘ï¼ŒGoä¸­çš„build tagsçš„ä½¿ç”¨æ–¹æ³•åŠå…¶å®ç°åŸç† - QX's blog</title><link>https://lqxhub.github.io/posts/84a29eaf/</link><pubDate>Sun, 31 Jul 2022 17:11:07 +0000</pubDate><guid>https://lqxhub.github.io/posts/84a29eaf/</guid><description>&lt;p>åœ¨C/C++ä¸­å¯ä»¥é€šè¿‡å®å®šä¹‰å®ç°æ¡ä»¶ç¼–è¯‘ï¼Œæ¯”å¦‚åœ¨ä¸åŒå¹³å°çš„æœºå™¨ä¸Šï¼Œè°ƒç”¨ä¸åŒçš„å‡½æ•°ï¼Œæˆ–è€…é€šè¿‡ç¼–è¯‘æ˜¯ä¼ é€’å‚æ•°ï¼Œè°ƒç”¨ä¸åŒçš„å‡½æ•°ï¼Œæ¯”å¦‚ä¸‹é¢çš„ä¾‹å­&lt;/p>
&lt;h2 id="cæ¡ä»¶ç¼–è¯‘">&lt;a href="#c%e6%9d%a1%e4%bb%b6%e7%bc%96%e8%af%91" class="header-anchor">&lt;/a>C++æ¡ä»¶ç¼–è¯‘
&lt;/h2>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c++" data-lang="c++">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">#include&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;iostream&amp;gt;&lt;/span>&lt;span style="color:#ff79c6">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span>&lt;span style="color:#ff79c6">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span>&lt;span style="color:#ff79c6">#ifdef DEBUG
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span>&lt;span style="color:#ff79c6">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span>&lt;span style="color:#8be9fd">void&lt;/span> &lt;span style="color:#50fa7b">fun1&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span> std&lt;span style="color:#ff79c6">::&lt;/span>cout &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;I am debug&amp;#34;&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> std&lt;span style="color:#ff79c6">::&lt;/span>endl;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span>&lt;span style="color:#ff79c6">#else
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span>&lt;span style="color:#ff79c6">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span>&lt;span style="color:#8be9fd">void&lt;/span> &lt;span style="color:#50fa7b">fun1&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span> std&lt;span style="color:#ff79c6">::&lt;/span>cout &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;I am release&amp;#34;&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> std&lt;span style="color:#ff79c6">::&lt;/span>endl;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15&lt;/span>&lt;span>&lt;span style="color:#ff79c6">#endif
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16&lt;/span>&lt;span>&lt;span style="color:#ff79c6">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17&lt;/span>&lt;span>&lt;span style="color:#8be9fd">int&lt;/span> &lt;span style="color:#50fa7b">main&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18&lt;/span>&lt;span> fun1();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ç°åœ¨å°±å¯ä»¥ä½¿ç”¨ä¸åŒçš„ç¼–è¯‘å‚æ•°ï¼Œæ§åˆ¶ç¨‹åºè°ƒç”¨ä¸åŒçš„å‡½æ•°&lt;/p>
&lt;ol>
&lt;li>ä¸æ·»åŠ å‚æ•°ï¼Œç›´æ¥ç¼–è¯‘&lt;/li>
&lt;/ol>
&lt;p>&lt;code>g++ -o test main.cpp &lt;/code>&lt;/p>
&lt;p>ç¨‹åºä¸­æ²¡æœ‰å®šä¹‰ &lt;strong>DEBUG&lt;/strong>è¿™ä¸ªå®ï¼Œæ‰€ä»¥ç¨‹åºæœ€ç»ˆä¼šè°ƒç”¨ &lt;strong>I am release&lt;/strong>è¿™ä¸ªå‡½æ•°
æ‰§è¡Œç¨‹åºéªŒè¯ä¸€ä¸‹
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-989a6b3837a07e5b.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-989a6b3837a07e5b.webp" alt="" />
&lt;/a>
&lt;/div>
å’Œæˆ‘ä»¬é¢„æœŸçš„ä¸€æ ·&lt;/p>
&lt;ol start="2">
&lt;li>åœ¨ç¼–è¯‘çš„æ—¶å€™æ·»åŠ å‚æ•°ï¼Œè®©ç¨‹åºè°ƒç”¨debugå‡½æ•°
&lt;code>g++ -DDEBUG -o test main.cpp &lt;/code>&lt;/li>
&lt;/ol>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-ca32d3c9250d5d20.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-ca32d3c9250d5d20.webp" alt="" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>ä¹Ÿæ²¡æœ‰é—®é¢˜ï¼Œç¨‹åºæœ€ç»ˆè°ƒç”¨çš„æ˜¯ &lt;strong>I am debug&lt;/strong> è¿™ä¸ªå‡½æ•°&lt;/p>
&lt;h2 id="goæ¡ä»¶ç¼–è¯‘">&lt;a href="#go%e6%9d%a1%e4%bb%b6%e7%bc%96%e8%af%91" class="header-anchor">&lt;/a>goæ¡ä»¶ç¼–è¯‘
&lt;/h2>&lt;p>goè™½ç„¶ä¸æ”¯æŒå®å®šä¹‰ï¼Œä½†æ˜¯goå¯ä»¥é€šè¿‡ &lt;strong>build tags&lt;/strong> å®ç°ç±»ä¼¼çš„åŠŸèƒ½ã€‚
goçš„æ¡ä»¶ç¼–è¯‘æ²¡æœ‰C++é‚£ä¹ˆå¼ºå¤§ï¼Œå¯ä»¥åœ¨ä»£ç ä»»æ„ä½ç½®æ·»åŠ å®ï¼Œå®ç°æ¡ä»¶ç¼–è¯‘ï¼Œgoçš„tagsçš„ä½œç”¨èŒƒå›´æ˜¯æ–‡ä»¶ï¼Œä¹Ÿå°±æ˜¯è¯´goçš„ç¼–è¯‘å™¨é€šè¿‡ä¸åŒçš„tagå»é€‰æ‹©ä¸åŒçš„æ–‡ä»¶ã€‚
å…ˆåˆ›å»º&lt;code>file.go&lt;/code> &lt;code>file_debug.go&lt;/code> &lt;code>main.go&lt;/code>è¿™ä¸‰ä¸ªæ–‡ä»¶&lt;/p>
&lt;p>&lt;strong>file.go&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>&lt;span style="color:#6272a4">// +build !debug
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3&lt;/span>&lt;span>&lt;span style="color:#ff79c6">package&lt;/span> main
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5&lt;/span>&lt;span>&lt;span style="color:#ff79c6">import&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;fmt&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> &lt;span style="color:#50fa7b">Fun1&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8&lt;/span>&lt;span> fmt.&lt;span style="color:#50fa7b">Println&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;I am release&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">9&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>file_debug.go&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>&lt;span style="color:#6272a4">// +build debug
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3&lt;/span>&lt;span>&lt;span style="color:#ff79c6">package&lt;/span> main
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5&lt;/span>&lt;span>&lt;span style="color:#ff79c6">import&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;fmt&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> &lt;span style="color:#50fa7b">Fun1&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8&lt;/span>&lt;span> fmt.&lt;span style="color:#50fa7b">Println&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;I am debug&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">9&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>main.go&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">package&lt;/span> main
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> &lt;span style="color:#50fa7b">main&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4&lt;/span>&lt;span> &lt;span style="color:#50fa7b">Fun1&lt;/span>()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>goçš„tagsæœ‰å‡ ä¸ªæ³¨æ„çš„ç‚¹&lt;/p>
&lt;ul>
&lt;li>&lt;code>// +build debug&lt;/code> å¿…é¡»åœ¨æ–‡ä»¶çš„æœ€å¼€å§‹ä½ç½®ï¼Œä¸€èˆ¬åœ¨ç¬¬ä¸€è¡Œ&lt;/li>
&lt;li>&lt;code>//&lt;/code> å’Œ &lt;code>+&lt;/code>ä¹‹é—´å¿…é¡»æœ‰ä¸€ä¸ªç©ºæ ¼&lt;/li>
&lt;li>&lt;code>// +build debug&lt;/code> ä¸‹é¢å¿…é¡»æœ‰ä¸€ä¸ªç©ºè¡Œ&lt;/li>
&lt;/ul>
&lt;p>åªæœ‰æ»¡è¶³è¿™äº›æ¡ä»¶åï¼Œè¿™ä¸ªtagæ‰èƒ½æ­£ç¡®çš„è¢«ç¼–è¯‘å™¨è¯†åˆ«&lt;/p>
&lt;ol>
&lt;li>
&lt;p>å…ˆæ­£å¸¸ç¼–è¯‘
&lt;code>go build -o release.exe&lt;/code>
æ‰§è¡Œç¨‹åºï¼Œæœ€ç»ˆç¨‹åºè°ƒç”¨çš„æ˜¯&lt;strong>I am release&lt;/strong> è¿™ä¸ªå‡½æ•°
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-8c0881b251d4919f.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-8c0881b251d4919f.webp" alt="" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;/li>
&lt;li>
&lt;p>åœ¨ç¼–è¯‘çš„æ—¶å€™ï¼ŒåŠ å‚æ•°ä½¿ç”¨debugç‰ˆæœ¬çš„å‡½æ•°
&lt;code>go build -tags debug -o debug.exe&lt;/code>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-b2047513684e91b5.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-b2047513684e91b5.webp" alt="" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;/li>
&lt;/ol>
&lt;h3 id="go117æ”¹å˜">&lt;a href="#go117%e6%94%b9%e5%8f%98" class="header-anchor">&lt;/a>go1.17æ”¹å˜
&lt;/h3>&lt;p>åœ¨go1.17ä¹‹å‰ï¼Œgoçš„build tags æ ¼å¼æ˜¯ &lt;code> // +build æ¡ä»¶&lt;/code>&lt;/p>
&lt;p>ä»go1.17å¼€å§‹ï¼Œå¼€å§‹æ”¯æŒ &lt;code>//go:build æ¡ä»¶&lt;/code> è¿™ç§æ ¼å¼äº†&lt;/p>
&lt;p>&lt;code>//go:build æ¡ä»¶&lt;/code> è¿™ç§æ ¼å¼æœ‰ä»€ä¹ˆå¥½å¤„å‘¢ï¼Œæœ€æ˜æ˜¾çš„å°±æ˜¯å…³ç³»è¿ç®—æ›´ç¬¦åˆç¼–ç¨‹è¯­æ³•äº†&lt;/p>
&lt;p>åœ¨ä¹‹å‰ï¼Œæƒ³è¦è¡¨ç¤º &lt;code>windows 64ä½ç³»ç»Ÿ&lt;/code> æˆ–è€… æ˜¯ &lt;code>linux&lt;/code> ç³»ç»Ÿéœ€è¦ä¸‹é¢çš„è¯­æ³•&lt;/p>
&lt;p>&lt;code>// +build windows,amd64 linux&lt;/code>&lt;/p>
&lt;p>åŸæ¥çš„build tags &lt;code>,&lt;/code> æ˜¯ &lt;code>and&lt;/code> &lt;code>ç©ºæ ¼&lt;/code> æ˜¯ &lt;code>or&lt;/code> ï¼Œä¸ç¬¦åˆå¸¸è§ç¼–ç¨‹è¯­è¨€çš„è¯­æ³•&lt;/p>
&lt;p>ä»go1.17å¼€å§‹ï¼ŒåŒæ ·çš„æ¡ä»¶å¯ä»¥è¿™æ ·å†™äº†&lt;/p>
&lt;p>&lt;code>//go:build (windows &amp;amp;&amp;amp; amd64) || linux&lt;/code>&lt;/p>
&lt;p>è¿™ä¸ªè¡¨è¾¾å¼å°±æ¯”ä¹‹å‰çš„æ˜æ˜¾å¤šäº†&lt;/p>
&lt;p>å¼€å§‹æµ‹è¯•ä¸€ä¸‹
å…ˆåˆ›å»º&lt;code>file.go&lt;/code> &lt;code>file_x64.go&lt;/code> &lt;code>main.go&lt;/code>ä¸‰ä¸ªæ–‡ä»¶&lt;/p>
&lt;p>&lt;strong>file.go&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>&lt;span style="color:#6272a4">//go:build windows &amp;amp;&amp;amp; 386
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3&lt;/span>&lt;span>&lt;span style="color:#ff79c6">package&lt;/span> main
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5&lt;/span>&lt;span>&lt;span style="color:#ff79c6">import&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;fmt&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> &lt;span style="color:#50fa7b">Fun1&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8&lt;/span>&lt;span> fmt.&lt;span style="color:#50fa7b">Println&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;I am windows 386&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">9&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>file_x64&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>&lt;span style="color:#6272a4">//go:build windows &amp;amp;&amp;amp; amd64
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3&lt;/span>&lt;span>&lt;span style="color:#ff79c6">package&lt;/span> main
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5&lt;/span>&lt;span>&lt;span style="color:#ff79c6">import&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;fmt&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> &lt;span style="color:#50fa7b">Fun1&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8&lt;/span>&lt;span> fmt.&lt;span style="color:#50fa7b">Println&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;I am windows amd64&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">9&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>main.go&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">package&lt;/span> main
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> &lt;span style="color:#50fa7b">main&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4&lt;/span>&lt;span> &lt;span style="color:#50fa7b">Fun1&lt;/span>()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ç¼–è¯‘ 32ä½ç¨‹åº
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-641818ec09a634f9.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-641818ec09a634f9.webp" alt="" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>ç¼–è¯‘64ä½ç¨‹åº
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-3b55d63abe683017.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-3b55d63abe683017.webp" alt="" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>å…¨éƒ½ç¬¦åˆé¢„æœŸ&lt;/p>
&lt;h2 id="å®é™…åº”ç”¨">&lt;a href="#%e5%ae%9e%e9%99%85%e5%ba%94%e7%94%a8" class="header-anchor">&lt;/a>å®é™…åº”ç”¨
&lt;/h2>&lt;p>è¯´äº†è¿™ä¹ˆå¤šï¼Œtagsåœ¨å®é™…å¼€å‘ä¸­æœ‰ä»€ä¹ˆç”¨å¤„å‘¢ã€‚
æœ€ä¸»è¦çš„å°±æ˜¯åŠŸèƒ½å°±æ˜¯å¯ä»¥é€šè¿‡ç¼–è¯‘å‚æ•°æ§åˆ¶ä½¿ç”¨é‚£äº›ä»£ç ç¼–è¯‘å¾—åˆ°ç¨‹åºã€‚æ¯”å¦‚åœ¨ä¸åŒçš„å¹³å°å¯ä»¥æœ‰ä¸åŒçš„å‡½æ•°å®ç°ã€‚ä¸åŒçš„ç‰ˆæœ¬æœ‰ä¸åŒçš„å®ç°ã€‚&lt;/p>
&lt;h3 id="ä¸¾ä¸ªæ —å­">&lt;a href="#%e4%b8%be%e4%b8%aa%e6%a0%97%e5%ad%90" class="header-anchor">&lt;/a>ä¸¾ä¸ªæ —å­
&lt;/h3>&lt;p>ä¸€èˆ¬logéƒ½ä¼šæœ‰ä¸åŒçš„çº§åˆ«ï¼Œå¿…é¡»å¼€å‘ä¸­å¯ä»¥é€šè¿‡å¤šæ‰“å°ä¸€äº›æ•°æ®ï¼Œæ–¹ä¾¿è°ƒè¯•ã€‚ä½†æ˜¯ç¨‹åºä¸Šçº¿åï¼Œä¸ºäº†æ€§èƒ½è€ƒè™‘ä¼šå…³é—­ä¸€äº›ä½çº§åˆ«çš„logï¼Œåªä¿ç•™ &lt;strong>error&lt;/strong> å’Œ &lt;strong>waning&lt;/strong> çº§åˆ«çš„logã€‚&lt;/p>
&lt;p>è™½ç„¶ç°åœ¨å¤§å¤šæ•°logåº“éƒ½æœ‰logçº§åˆ«ï¼Œä½†æ˜¯å¦‚æœä¸éœ€è¦æ‰“å°çš„logï¼Œä½†æ˜¯è¿˜æ˜¯è°ƒç”¨äº†å‡½æ•°ï¼Œå…¶å®è¿˜æ˜¯ä¼šæœ‰ä¸€éƒ¨åˆ†æ€§èƒ½å¼€é”€çš„ï¼Œæ¯”å¦‚å‡½æ•°è°ƒç”¨å¼€é”€ï¼Œå‚æ•°ä¼ é€’å¼€é”€ç­‰ã€‚ä¸ºäº†è¿›ä¸€æ­¥å‹æ¦¨æ€§èƒ½ï¼Œå¯ä»¥é€šè¿‡tags åœ¨ç¼–è¯‘ç¨‹åºçš„æ—¶å€™ï¼ŒæŠŠä½ç­‰çº§çš„logç›´æ¥ä¸ç¼–è¯‘åˆ°ç¨‹åºä¸­ã€‚&lt;/p>
&lt;p>å›åˆ°ç¬¬ä¸€ä¸ªç¤ºä¾‹ä¸­ï¼Œä¿®æ”¹ä¸€ä¸‹ä»£ç &lt;/p>
&lt;p>&lt;strong>file.go&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>&lt;span style="color:#6272a4">// +build !debug
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3&lt;/span>&lt;span>&lt;span style="color:#ff79c6">package&lt;/span> main
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5&lt;/span>&lt;span>&lt;span style="color:#ff79c6">import&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;fmt&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> &lt;span style="color:#50fa7b">LogDebug&lt;/span>(info &lt;span style="color:#8be9fd">string&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8&lt;/span>&lt;span> fmt.&lt;span style="color:#50fa7b">Println&lt;/span>(info)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">9&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>file_debug.go&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>&lt;span style="color:#6272a4">// +build debug
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3&lt;/span>&lt;span>&lt;span style="color:#ff79c6">package&lt;/span> main
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> &lt;span style="color:#50fa7b">LogDebug&lt;/span>(info &lt;span style="color:#8be9fd">string&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>main.go&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">package&lt;/span> main
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> &lt;span style="color:#50fa7b">main&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4&lt;/span>&lt;span> &lt;span style="color:#50fa7b">LogDebug&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;aaaaaaaaaaaa&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å¯ä»¥çœ‹åˆ°ï¼Œåœ¨édebugç‰ˆæœ¬ä¸­ï¼Œæ¨¡æ‹Ÿæ­£å¸¸æ‰“å°logï¼Œåœ¨debugç‰ˆæœ¬ä¸­ï¼Œlogå‡½æ•°åªæœ‰ä¸€ä¸ªç©ºçš„å‡½æ•°ï¼Œæ²¡æœ‰å®ç°ã€‚
å…ˆç¼–è¯‘ä¸¤ä¸ªç¨‹åºï¼Œç„¶åé€šè¿‡åç¼–è¯‘çœ‹çœ‹ä¸¤æ¬¡å‡½æ•°è°ƒç”¨çš„åŒºåˆ«&lt;/p>
&lt;p>æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>go build -tags debug -o debug.exe
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span>go build -o release.exe
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3&lt;/span>&lt;span>go tool objdump -s &lt;span style="color:#f1fa8c">&amp;#34;main.main&amp;#34;&lt;/span> ./debug.exe &amp;gt; ./debug.s
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4&lt;/span>&lt;span>go tool objdump -s &lt;span style="color:#f1fa8c">&amp;#34;main.main&amp;#34;&lt;/span> ./release.exe &amp;gt; ./release.s
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>åˆ†åˆ«å¾—åˆ°debugç‰ˆæœ¬å’Œreleaseç‰ˆæœ¬çš„æ±‡ç¼–ä»£ç &lt;/p>
&lt;p>&lt;strong>debug.s&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-fallback" data-lang="fallback">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>TEXT main.main(SB) D:/goProject/src/build_tag/main.go
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span> main.go:3 0x49e750 65488b0c2528000000 MOVQ GS:0x28, CX
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span> main.go:3 0x49e759 488b8900000000 MOVQ 0(CX), CX
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span> main.go:3 0x49e760 483b6110 CMPQ 0x10(CX), SP
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span> main.go:3 0x49e764 0f8687000000 JBE 0x49e7f1
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span> main.go:3 0x49e76a 4883ec58 SUBQ $0x58, SP
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span> main.go:3 0x49e76e 48896c2450 MOVQ BP, 0x50(SP)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span> main.go:3 0x49e773 488d6c2450 LEAQ 0x50(SP), BP
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span> main.go:4 0x49e778 488d0542fd0200 LEAQ go.string.*+5001(SB), AX
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span> file.go:8 0x49e77f 48890424 MOVQ AX, 0(SP)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span> file.go:8 0x49e783 48c74424080c000000 MOVQ $0xc, 0x8(SP)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span> file.go:8 0x49e78c e87fb1f6ff CALL runtime.convTstring(SB)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span> file.go:8 0x49e791 488b442410 MOVQ 0x10(SP), AX
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span> file.go:8 0x49e796 0f57c0 XORPS X0, X0
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15&lt;/span>&lt;span> file.go:8 0x49e799 0f11442440 MOVUPS X0, 0x40(SP)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16&lt;/span>&lt;span> file.go:8 0x49e79e 488d0d3be70000 LEAQ runtime.types+57056(SB), CX
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17&lt;/span>&lt;span> file.go:8 0x49e7a5 48894c2440 MOVQ CX, 0x40(SP)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18&lt;/span>&lt;span> file.go:8 0x49e7aa 4889442448 MOVQ AX, 0x48(SP)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19&lt;/span>&lt;span> print.go:274 0x49e7af 488b0592a50d00 MOVQ os.Stdout(SB), AX
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20&lt;/span>&lt;span> print.go:274 0x49e7b6 488d0da3c40400 LEAQ go.itab.*os.File,io.Writer(SB), CX
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21&lt;/span>&lt;span> print.go:274 0x49e7bd 48890c24 MOVQ CX, 0(SP)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22&lt;/span>&lt;span> print.go:274 0x49e7c1 4889442408 MOVQ AX, 0x8(SP)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23&lt;/span>&lt;span> print.go:274 0x49e7c6 488d442440 LEAQ 0x40(SP), AX
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24&lt;/span>&lt;span> print.go:274 0x49e7cb 4889442410 MOVQ AX, 0x10(SP)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25&lt;/span>&lt;span> print.go:274 0x49e7d0 48c744241801000000 MOVQ $0x1, 0x18(SP)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26&lt;/span>&lt;span> print.go:274 0x49e7d9 48c744242001000000 MOVQ $0x1, 0x20(SP)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27&lt;/span>&lt;span> print.go:274 0x49e7e2 e8e998ffff CALL fmt.Fprintln(SB)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28&lt;/span>&lt;span> file.go:8 0x49e7e7 488b6c2450 MOVQ 0x50(SP), BP
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29&lt;/span>&lt;span> file.go:8 0x49e7ec 4883c458 ADDQ $0x58, SP
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30&lt;/span>&lt;span> file.go:8 0x49e7f0 c3 RET
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31&lt;/span>&lt;span> main.go:3 0x49e7f1 e87acffbff CALL runtime.morestack_noctxt(SB)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32&lt;/span>&lt;span> main.go:3 0x49e7f6 e955ffffff JMP main.main(SB)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å¯ä»¥çœ‹åˆ°åœ¨debugç‰ˆæœ¬ä¸­ï¼Œ&lt;code>LogDebug&lt;/code> å‡½æ•°å·²ç»è¢«ç¼–è¯‘å™¨å†…è”å¤„ç†äº†ã€‚æœ€ç»ˆç¨‹åºæ˜¯è°ƒç”¨äº†&lt;code>fmt.Println&lt;/code>å‡½æ•°ã€‚&lt;/p>
&lt;p>&lt;strong>release.s&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-fallback" data-lang="fallback">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>TEXT main.main(SB) D:/goProject/src/build_tag/main.go
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span> main.go:4 0x45b630 c3 RET
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span> :0 0x45b631 cc INT $0x3
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span> :0 0x45b632 cc INT $0x3
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span> :0 0x45b633 cc INT $0x3
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span> :0 0x45b634 cc INT $0x3
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span> :0 0x45b635 cc INT $0x3
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span> :0 0x45b636 cc INT $0x3
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span> :0 0x45b637 cc INT $0x3
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span> :0 0x45b638 cc INT $0x3
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span> :0 0x45b639 cc INT $0x3
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span> :0 0x45b63a cc INT $0x3
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span> :0 0x45b63b cc INT $0x3
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span> :0 0x45b63c cc INT $0x3
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15&lt;/span>&lt;span> :0 0x45b63d cc INT $0x3
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16&lt;/span>&lt;span> :0 0x45b63e cc INT $0x3
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17&lt;/span>&lt;span> :0 0x45b63f cc INT $0x3
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ç›¸æ¯”ä¹‹ä¸‹ï¼Œreleaseç‰ˆæœ¬çš„æ±‡ç¼–ä»£ç å°±ç®€å•å¤šäº†ï¼Œå› ä¸ºç¼–è¯‘å™¨ä¼šè¿›è¡Œå†…è”å¤„ç†ï¼Œä½†æ˜¯å‘ç°&lt;code>LogDebug&lt;/code>è¿™ä¸ªå‡½æ•°æ˜¯ä¸€ä¸ªç©ºå‡½æ•°ï¼Œæ‰€ä»¥å°±ç›´æ¥è·³è¿‡ç¼–è¯‘äº†ã€‚&lt;/p>
&lt;h2 id="æ€»ç»“">&lt;a href="#%e6%80%bb%e7%bb%93" class="header-anchor">&lt;/a>æ€»ç»“
&lt;/h2>&lt;ol>
&lt;li>goä¹Ÿå¯ä»¥å®ç°æ¡ä»¶ç¼–è¯‘ï¼Œä½†æ˜¯ä¸èƒ½åƒC++é‚£æ ·çµæ´»ï¼Œåªèƒ½ä»¥æ–‡ä»¶ä¸ºå•ä½&lt;/li>
&lt;li>åœ¨go1.17ä¹‹å‰ä½¿ç”¨&lt;code>// +build æ¡ä»¶&lt;/code>ï¼Œä»1.17å¼€å§‹å¯ä»¥ä½¿ç”¨&lt;code>//go:build æ¡ä»¶&lt;/code>&lt;/li>
&lt;li>goé¢„è®¾äº†å¾ˆå¤štagsï¼Œä¹Ÿå¯ä»¥è‡ªå®šä¹‰tags&lt;/li>
&lt;li>åœ¨ç¼–è¯‘æ—¶ï¼Œä½¿ç”¨ -tags ä¸ªè‡ªå®šä¹‰çš„tagsèµ‹å€¼&lt;/li>
&lt;/ol></description></item><item><title>é“¾è¡¨æ’åºï¼ŒLeetCodeé“¾è¡¨æ’åºï¼Œgolangé“¾è¡¨å½’å¹¶æ’åº - QX's blog</title><link>https://lqxhub.github.io/posts/f8e89faa/</link><pubDate>Sat, 21 May 2022 16:56:04 +0000</pubDate><guid>https://lqxhub.github.io/posts/f8e89faa/</guid><description>&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images/blog/02F73302CA875C38.jpg" alt="Featured image of post é“¾è¡¨æ’åºï¼ŒLeetCodeé“¾è¡¨æ’åºï¼Œgolangé“¾è¡¨å½’å¹¶æ’åº - QX's blog" />&lt;p>ä¸€ç›´ä»¥æ¥ç®—æ³•é¢˜åˆ·çš„æ¯”è¾ƒå°‘ï¼Œç®—æ³•è¿™å—ç®—æ˜¯æˆ‘çš„å¼±é¡¹ã€‚å‰å‡ å¤©ï¼Œçœ‹åˆ°ä¸€ä¸ªæŒºæœ‰æ„æ€çš„é“¾è¡¨é¢˜&lt;/p>
&lt;h2 id="åŸé¢˜">&lt;a href="#%e5%8e%9f%e9%a2%98" class="header-anchor">&lt;/a>åŸé¢˜
&lt;/h2>&lt;p>åŸé¢˜æ˜¯è¿™æ ·çš„ï¼Œç»™ä¸€ä¸ªé“¾è¡¨ &lt;code>[1,2,3,4,5]&lt;/code> ç„¶åè½¬æ¢æˆ &lt;code>[5,3,1,2,4]&lt;/code> è¿™ç§æ ¼å¼
æ‰¾ä¸€ä¸‹è§„å¾‹ï¼Œå…¶å®å°±æ˜¯ç¬¬ä¸€ä¸ªå…ˆæ‹¿ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œç„¶åæŠŠç¬¬äºŒä¸ªå…ƒç´ æ”¾åœ¨æ–°çš„é“¾è¡¨åé¢ï¼Œç¬¬ä¸‰ä¸ªå…ƒç´ æ”¾åœ¨æ–°çš„é“¾è¡¨å‰é¢ï¼Œç„¶åç¬¬å››ä¸ªæ”¾åœ¨æ–°é“¾è¡¨çš„åé¢ï¼Œç¬¬äº”ä¸ªæ”¾åœ¨æ–°é“¾è¡¨å‰é¢ï¼Œä»¥æ­¤ç±»æ¨ã€‚&lt;/p>
&lt;p>å…¶å®å°±æ˜¯ä¸€ä¸ªé“¾è¡¨å¤´æ’å’Œå°¾æ’çš„ç»“åˆå˜›&lt;/p>
&lt;p>ç›´æ¥ä¸Šä»£ç &lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">package&lt;/span> main
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span>&lt;span style="color:#ff79c6">import&lt;/span> (
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span> &lt;span style="color:#f1fa8c">&amp;#34;fmt&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">type&lt;/span> Node &lt;span style="color:#8be9fd;font-style:italic">struct&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span> Next &lt;span style="color:#ff79c6">*&lt;/span>Node
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span> Val &lt;span style="color:#8be9fd">int&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span>&lt;span style="color:#6272a4">//é€šè¿‡æ•°ç»„ç”Ÿæˆé“¾è¡¨
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> &lt;span style="color:#50fa7b">Make&lt;/span>(nums []&lt;span style="color:#8be9fd">int&lt;/span>) &lt;span style="color:#ff79c6">*&lt;/span>Node {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span> head &lt;span style="color:#ff79c6">:=&lt;/span> &lt;span style="color:#ff79c6">&amp;amp;&lt;/span>Node{}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15&lt;/span>&lt;span> move &lt;span style="color:#ff79c6">:=&lt;/span> head
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16&lt;/span>&lt;span> &lt;span style="color:#ff79c6">for&lt;/span> _, num &lt;span style="color:#ff79c6">:=&lt;/span> &lt;span style="color:#ff79c6">range&lt;/span> nums {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17&lt;/span>&lt;span> t &lt;span style="color:#ff79c6">:=&lt;/span> &lt;span style="color:#ff79c6">&amp;amp;&lt;/span>Node{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18&lt;/span>&lt;span> Val: num,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20&lt;/span>&lt;span> move.Next = t
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21&lt;/span>&lt;span> move = move.Next
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> head.Next
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26&lt;/span>&lt;span>&lt;span style="color:#6272a4">//æ‰“å°é“¾è¡¨
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> &lt;span style="color:#50fa7b">Print&lt;/span>(list &lt;span style="color:#ff79c6">*&lt;/span>Node) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28&lt;/span>&lt;span> &lt;span style="color:#ff79c6">for&lt;/span> h &lt;span style="color:#ff79c6">:=&lt;/span> list; h &lt;span style="color:#ff79c6">!=&lt;/span> &lt;span style="color:#ff79c6">nil&lt;/span>; h = h.Next {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29&lt;/span>&lt;span> fmt.&lt;span style="color:#50fa7b">Printf&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;%d &amp;#34;&lt;/span>, h.Val)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31&lt;/span>&lt;span> fmt.&lt;span style="color:#50fa7b">Println&lt;/span>()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> &lt;span style="color:#50fa7b">main&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35&lt;/span>&lt;span> nums &lt;span style="color:#ff79c6">:=&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">make&lt;/span>([]&lt;span style="color:#8be9fd">int&lt;/span>, &lt;span style="color:#bd93f9">5&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36&lt;/span>&lt;span> &lt;span style="color:#ff79c6">for&lt;/span> i &lt;span style="color:#ff79c6">:=&lt;/span> &lt;span style="color:#bd93f9">1&lt;/span>; i &lt;span style="color:#ff79c6">&amp;lt;=&lt;/span> &lt;span style="color:#bd93f9">5&lt;/span>; i&lt;span style="color:#ff79c6">++&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37&lt;/span>&lt;span> nums[i&lt;span style="color:#ff79c6">-&lt;/span>&lt;span style="color:#bd93f9">1&lt;/span>] = i
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39&lt;/span>&lt;span> nodes &lt;span style="color:#ff79c6">:=&lt;/span> &lt;span style="color:#50fa7b">Make&lt;/span>(nums)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40&lt;/span>&lt;span> &lt;span style="color:#50fa7b">Print&lt;/span>(nodes)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41&lt;/span>&lt;span> nodes = &lt;span style="color:#50fa7b">TurnList&lt;/span>(nodes)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42&lt;/span>&lt;span> &lt;span style="color:#50fa7b">Print&lt;/span>(nodes)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45&lt;/span>&lt;span>&lt;span style="color:#6272a4">//è½¬æ¢é“¾è¡¨
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> &lt;span style="color:#50fa7b">TurnList&lt;/span>(list &lt;span style="color:#ff79c6">*&lt;/span>Node) &lt;span style="color:#ff79c6">*&lt;/span>Node {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47&lt;/span>&lt;span> i &lt;span style="color:#ff79c6">:=&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48&lt;/span>&lt;span> h &lt;span style="color:#ff79c6">:=&lt;/span> list
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49&lt;/span>&lt;span> t &lt;span style="color:#ff79c6">:=&lt;/span> list
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50&lt;/span>&lt;span> list = list.Next
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">51&lt;/span>&lt;span> &lt;span style="color:#ff79c6">for&lt;/span> list &lt;span style="color:#ff79c6">!=&lt;/span> &lt;span style="color:#ff79c6">nil&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">52&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> i&lt;span style="color:#ff79c6">%&lt;/span>&lt;span style="color:#bd93f9">2&lt;/span> &lt;span style="color:#ff79c6">==&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">53&lt;/span>&lt;span> t.Next = list
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">54&lt;/span>&lt;span> list = list.Next
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">55&lt;/span>&lt;span> t = t.Next
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">56&lt;/span>&lt;span> t.Next = &lt;span style="color:#ff79c6">nil&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">57&lt;/span>&lt;span> } &lt;span style="color:#ff79c6">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">58&lt;/span>&lt;span> x &lt;span style="color:#ff79c6">:=&lt;/span> list.Next
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">59&lt;/span>&lt;span> list.Next = h
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">60&lt;/span>&lt;span> h = list
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">61&lt;/span>&lt;span> list = x
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">62&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">63&lt;/span>&lt;span> i&lt;span style="color:#ff79c6">++&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">64&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">65&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> h
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">66&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>åˆå§‹é“¾è¡¨å¦‚å›¾ï¼š
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-2a170216963b147b.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-2a170216963b147b.webp" alt="" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>å˜æ¢è¿‡ç¨‹ï¼š
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-d04c853f0c91a1c0.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-d04c853f0c91a1c0.webp" alt="" />
&lt;/a>
&lt;/div>
å°±æ˜¯æ ·æ ¹æ®å¥‡å¶åˆ†åˆ«å¤´æ’å’Œå°¾æ’å°±èƒ½å®Œæˆ
è¿™ä¹ˆç®€å•å½“æ—¶å°±æ˜¯æ²¡å†™å‡ºæ¥ã€‚ æ·¦&lt;/p>
&lt;p>åªå†™è¿™ä¸€ä¸ªä¹ŸæŠ¬ä¸è¿‡ç˜¾äº†ï¼Œå†æ¥ä¸€ä¸ªé“¾è¡¨æ’åºçš„ &lt;a class="link" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/https://leetcode.cn/problems/sort-list/" target="_blank" rel="noopener"
>leetcode 148&lt;/a>&lt;/p>
&lt;h2 id="é“¾è¡¨æ’åº">&lt;a href="#%e9%93%be%e8%a1%a8%e6%8e%92%e5%ba%8f" class="header-anchor">&lt;/a>é“¾è¡¨æ’åº
&lt;/h2>&lt;p>æ’åºçš„æ–¹æ³•æœ‰å¥½å¤šï¼Œä½†æ˜¯æˆ‘æ„Ÿè§‰é€‚åˆç”¨äºé“¾è¡¨çš„æ˜¯ &lt;strong>æ’å…¥æ’åº&lt;/strong> å’Œ &lt;strong>å½’å¹¶æ’åº&lt;/strong> å°¤å…¶æ˜¯å½’å¹¶æ’åºï¼Œç®€ç›´å°±æ˜¯ä¸ºé“¾è¡¨å®šåšçš„ã€‚&lt;/p>
&lt;h3 id="å…ˆæ¥ä¸€ä¸ªç®€å•çš„æ’å…¥æ’åºå§">&lt;a href="#%e5%85%88%e6%9d%a5%e4%b8%80%e4%b8%aa%e7%ae%80%e5%8d%95%e7%9a%84%e6%8f%92%e5%85%a5%e6%8e%92%e5%ba%8f%e5%90%a7" class="header-anchor">&lt;/a>å…ˆæ¥ä¸€ä¸ªç®€å•çš„ï¼Œæ’å…¥æ’åºå§
&lt;/h3>&lt;p>æ’å…¥æ’åºçš„æ€æƒ³å°±æ˜¯é€‰æ‹©ä¸€ä¸ªåŸºå‡†ï¼Œç„¶åæŠŠæ•´ä¸ªåºåˆ—ä¸­çš„æ¯”è‡ªå·±å°çš„æ”¾åˆ°åŸºå‡†çš„å‰é¢ï¼Œç”¨æ•°ç»„çš„å½¢å¼è¿˜æ˜¯å¾ˆå¥½ç†è§£å’Œæ“ä½œçš„ã€‚ä½†æ˜¯é“¾è¡¨ä¸èƒ½éšæœºè®¿é—®ï¼Œæ‰€ä»¥ä¸èƒ½ç”¨æ•°ç»„é‚£æ ·çš„æ’å…¥æ’åºäº†ï¼Œéœ€è¦åšä¸€ä¸‹å˜æ¢ï¼Œçœ‹èµ·æ¥æœ‰ç‚¹åƒæ˜¯é€‰æ‹©æ’åºå’Œæ’å…¥æ’åºçš„ç»“åˆã€‚
ä¸åºŸè¯äº†ï¼Œç›´æ¥ä¸Šä»£ç ï¼Œæ’å…¥æ’åºï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> &lt;span style="color:#50fa7b">InsertSort&lt;/span>(list &lt;span style="color:#ff79c6">*&lt;/span>Node) &lt;span style="color:#ff79c6">*&lt;/span>Node {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span> head &lt;span style="color:#ff79c6">:=&lt;/span> &lt;span style="color:#ff79c6">&amp;amp;&lt;/span>Node{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span> Next: list,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span> h &lt;span style="color:#ff79c6">:=&lt;/span> head
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span> &lt;span style="color:#ff79c6">for&lt;/span> h.Next &lt;span style="color:#ff79c6">!=&lt;/span> &lt;span style="color:#ff79c6">nil&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span> t &lt;span style="color:#ff79c6">:=&lt;/span> h
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span> &lt;span style="color:#ff79c6">for&lt;/span> t.Next &lt;span style="color:#ff79c6">!=&lt;/span> &lt;span style="color:#ff79c6">nil&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> t.Next.Val &amp;lt; h.Next.Val {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span> x &lt;span style="color:#ff79c6">:=&lt;/span> t.Next
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span> t.Next = t.Next.Next
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span> x.Next = h.Next
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span> h.Next = x
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span> } &lt;span style="color:#ff79c6">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15&lt;/span>&lt;span> t = t.Next
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18&lt;/span>&lt;span> h = h.Next
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> head.Next
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æ— åºçš„é“¾è¡¨&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-55dfdacfe5e27308.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-55dfdacfe5e27308.webp" alt="" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>æ’åºè¿‡ç¨‹
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-03d5c37f8538b13f.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-03d5c37f8538b13f.webp" alt="" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>å›¾ä¸­æœ‰ä¸ªè¿·æƒ‘çš„åœ°æ–¹ï¼Œå°±æ˜¯è“è‰²çš„çº¿æ˜¯ &lt;code>next&lt;/code> æŒ‡é’ˆçš„æŒ‡å‘ï¼Œå°±æ˜¯ä¸€å¼€å§‹çš„æ—¶å€™ï¼Œ&lt;code>head&lt;/code> &lt;code>h&lt;/code> &lt;code>t&lt;/code> çš„nextæŒ‡é’ˆæŒ‡å‘ &lt;strong>3&lt;/strong>
ä¹Ÿå°±æ˜¯ &lt;code>h&lt;/code> &lt;code>t&lt;/code>è‡ªèº«æ˜¯æŒ‡å‘ &lt;code>head&lt;/code>çš„ï¼Œheadæ˜¯ä¸€å¼€å§‹çš„æ—¶å€™ï¼Œæ–°å»ºçš„ä¸€ä¸ªä¸´æ—¶ç»“ç‚¹ï¼Œå› ä¸ºå•å‘é“¾è¡¨æ— æ³•å‘å‰æŸ¥æ‰¾ï¼Œåªèƒ½å‘åæŸ¥æ‰¾ï¼Œæ‰€ä»¥è¦ç”¨ &lt;code>next&lt;/code> æŒ‡é’ˆã€‚
åŒæ ·ï¼Œåœ¨ä½¿ç”¨ &lt;code>t&lt;/code> å’Œ &lt;code>h&lt;/code> æŒ‡é’ˆçš„æ—¶å€™ï¼Œä¹Ÿéƒ½æ˜¯ä½¿ç”¨ &lt;code>next&lt;/code> ç”¨æ¥åˆ¤æ–­ã€‚
æ¯”è¾ƒé€»è¾‘ &lt;code>t.Next.Val &amp;lt; h.Next.Val&lt;/code> å½“ &lt;code>t&lt;/code>çš„ &lt;code>next&lt;/code> æ˜¯ &lt;strong>3&lt;/strong>ï¼Œ&lt;code>h&lt;/code>çš„ &lt;code>next&lt;/code> æ˜¯ &lt;strong>2&lt;/strong> æ—¶,æ»¡è¶³æ¡ä»¶ï¼Œæ‰€ä»¥äº¤æ¢ &lt;strong>2&lt;/strong> å’Œ &lt;strong>3&lt;/strong>
å¦‚æ­¤å¾€å¤ï¼Œå½“ &lt;code>t&lt;/code> èµ°å®Œä¸€è¶Ÿåï¼Œé“¾è¡¨ä¸­çš„ç¬¬ä¸€ä¸ªç»“ç‚¹å°±æ˜¯æœ€å°çš„äº†ã€‚
å½“ &lt;code>t&lt;/code> èµ°å®Œä¸€è¶Ÿåï¼ŒhæŒ‡é’ˆè¦åç§»ä¸€ä¸ªã€‚ä»¥æ­¤ç±»æ¨ï¼Œç›´åˆ° &lt;code>h&lt;/code> å’Œ &lt;code>t&lt;/code> éƒ½èµ°å®Œåï¼Œå°±å®Œæˆäº†æ’åºã€‚&lt;/p>
&lt;p>è¿™ä¸ªæ’åºæ–¹æ³•ç”¨çš„æ˜¯æ’å…¥æ’åºçš„æ€æƒ³åŠ ä¸Šä¸€äº›é€‰æ‹©æ’åºçš„æ–¹æ³•å®Œæˆçš„ï¼Œæ—¶é—´å¤æ‚åº¦è¿˜æ˜¯O(nÂ²)ã€‚æ˜¯ç¨³å®šçš„æ’åºã€‚&lt;/p>
&lt;h3 id="å½’å¹¶æ’åº">&lt;a href="#%e5%bd%92%e5%b9%b6%e6%8e%92%e5%ba%8f" class="header-anchor">&lt;/a>å½’å¹¶æ’åº
&lt;/h3>&lt;p>ç›¸æ¯”æ’å…¥æ’åºå’Œé€‰æ‹©æ’åºï¼Œå½’å¹¶æ’åºå°±è¦å¤æ‚ä¸€äº›äº†&lt;/p>
&lt;p>å½’å¹¶æ’åºçš„æ€æƒ³æ˜¯åˆ†æ²»æ³•ï¼ŒæŠŠæ•´ä¸ªåºåˆ—æ‹†åˆ†ï¼Œå½“æ‹†åˆ†åˆ°ä¸èƒ½å†æ‹†åˆ†æ—¶ï¼Œå­åºåˆ—å°±æ˜¯æœ‰åºçš„äº†ã€‚ä¹Ÿå°±æ˜¯å½“åºåˆ—é•¿åº¦æ˜¯1çš„æ—¶å€™ï¼Œåºåˆ—å°±æ˜¯æœ‰åºçš„ã€‚ç„¶ååœ¨æŠŠå­åºåˆ—æœ‰åºçš„åˆå¹¶èµ·æ¥ã€‚&lt;/p>
&lt;p>å½’å¹¶æ’åºç®€ç›´å°±æ˜¯ä¸ºäº†é“¾è¡¨æ’åºè€Œç”Ÿçš„ã€‚å¦‚æœç”¨æ•°ç»„æ’åºï¼Œæ‹†åˆ†å’Œé‡ç»„è¿˜æ˜¯æ¯”è¾ƒå¤æ‚çš„ï¼Œé“¾è¡¨å°±ç®€å•å¤šäº†ã€‚è¯´å®è¯ï¼Œæ•°ç»„çš„å½’å¹¶æ’åºæˆ‘éƒ½ä¸ä¼šå†™ã€‚&lt;/p>
&lt;p>çº¿ä¸Šä»£ç ï¼Œå½’å¹¶æ’åº&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> &lt;span style="color:#50fa7b">MergerSort&lt;/span>(list &lt;span style="color:#ff79c6">*&lt;/span>Node) &lt;span style="color:#ff79c6">*&lt;/span>Node {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> list &lt;span style="color:#ff79c6">==&lt;/span> &lt;span style="color:#ff79c6">nil&lt;/span> &lt;span style="color:#ff79c6">||&lt;/span> list.Next &lt;span style="color:#ff79c6">==&lt;/span> &lt;span style="color:#ff79c6">nil&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> list
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span> fast &lt;span style="color:#ff79c6">:=&lt;/span> list.Next
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span> slow &lt;span style="color:#ff79c6">:=&lt;/span> list
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span> &lt;span style="color:#ff79c6">for&lt;/span> fast &lt;span style="color:#ff79c6">!=&lt;/span> &lt;span style="color:#ff79c6">nil&lt;/span> &lt;span style="color:#ff79c6">&amp;amp;&amp;amp;&lt;/span> fast.Next &lt;span style="color:#ff79c6">!=&lt;/span> &lt;span style="color:#ff79c6">nil&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span> fast = fast.Next.Next
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span> slow = slow.Next
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span> h1 &lt;span style="color:#ff79c6">:=&lt;/span> &lt;span style="color:#50fa7b">MergerSort&lt;/span>(slow.Next)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span> slow.Next = &lt;span style="color:#ff79c6">nil&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15&lt;/span>&lt;span> h2 &lt;span style="color:#ff79c6">:=&lt;/span> &lt;span style="color:#50fa7b">MergerSort&lt;/span>(list)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> &lt;span style="color:#50fa7b">Merge&lt;/span>(h1, h2)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> &lt;span style="color:#50fa7b">Merge&lt;/span>(list1, list2 &lt;span style="color:#ff79c6">*&lt;/span>Node) &lt;span style="color:#ff79c6">*&lt;/span>Node {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21&lt;/span>&lt;span> head &lt;span style="color:#ff79c6">:=&lt;/span> &lt;span style="color:#ff79c6">&amp;amp;&lt;/span>Node{}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22&lt;/span>&lt;span> h &lt;span style="color:#ff79c6">:=&lt;/span> head
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23&lt;/span>&lt;span> &lt;span style="color:#ff79c6">for&lt;/span> list1 &lt;span style="color:#ff79c6">!=&lt;/span> &lt;span style="color:#ff79c6">nil&lt;/span> &lt;span style="color:#ff79c6">&amp;amp;&amp;amp;&lt;/span> list2 &lt;span style="color:#ff79c6">!=&lt;/span> &lt;span style="color:#ff79c6">nil&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> list1.Val &amp;lt; list2.Val {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25&lt;/span>&lt;span> h.Next = list1
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26&lt;/span>&lt;span> list1 = list1.Next
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27&lt;/span>&lt;span> } &lt;span style="color:#ff79c6">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28&lt;/span>&lt;span> h.Next = list2
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29&lt;/span>&lt;span> list2 = list2.Next
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31&lt;/span>&lt;span> h = h.Next
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> list1 &lt;span style="color:#ff79c6">!=&lt;/span> &lt;span style="color:#ff79c6">nil&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34&lt;/span>&lt;span> h.Next = list1
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35&lt;/span>&lt;span> } &lt;span style="color:#ff79c6">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36&lt;/span>&lt;span> h.Next = list2
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> head.Next
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å½’å¹¶æ’åºæœ‰ä¸¤ä¸ªéƒ¨åˆ†ï¼Œä¸€ä¸ªæ˜¯æ‹†åˆ†ï¼Œå¦ä¸€ä¸ªæ˜¯åˆå¹¶ã€‚&lt;/p>
&lt;ol>
&lt;li>
&lt;p>æ‹†åˆ†
æ‹†åˆ†æ˜¯äºŒåˆ†æ³•ï¼Œä¹Ÿå°±æ˜¯æ¯æ¬¡ä»ä¸­é—´åˆ†å¼€ã€‚é“¾è¡¨ä¸­æ‰¾åˆ°ä¸­é—´ä½ç½®ï¼Œæœ€æ–¹ä¾¿çš„å°±æ˜¯å¿«æ…¢æŒ‡é’ˆäº†ï¼Œå°±æ˜¯ä¸€ä¸ªæŒ‡é’ˆæ¯æ¬¡ç§»åŠ¨ä¸€ä¸ªä½ç½®ï¼ŒæŒ‡é’ˆæ¯æ¬¡ç§»åŠ¨ä¸¤ä¸ªä½ç½®ã€‚å½“å¿«çš„æŒ‡é’ˆç§»åŠ¨åˆ°æœ€åçš„æ—¶å€™ï¼Œæ…¢çš„æŒ‡é’ˆæ­£å¥½ç§»åŠ¨åˆ°é“¾è¡¨çš„ä¸­é—´ä½ç½®ã€‚é€’å½’æ‹†åˆ†ï¼Œç›´åˆ°é“¾è¡¨é•¿åº¦æ˜¯1çš„æ—¶å€™ï¼Œå°±å®Œæˆäº†æ‹†åˆ†ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>åˆå¹¶
åˆå¹¶çš„è¿‡ç¨‹å…¶å®å°±æ˜¯åˆå¹¶ä¸¤ä¸ªæœ‰åºé“¾è¡¨ã€‚&lt;a class="link" href="https://leetcode.cn/problems/merge-two-sorted-lists/" target="_blank" rel="noopener"
>leetcode 21&lt;/a> å¾ˆç®€å•æ²¡ä»€ä¹ˆéœ€è¦è§£é‡Šçš„ã€‚&lt;/p>
&lt;/li>
&lt;/ol>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-0409bcd8c06825d0.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-0409bcd8c06825d0.webp" alt="" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>ç®€å•çš„æŠŠæ’åºè¿‡ç¨‹èŠ±äº†å‡ºæ¥ã€‚&lt;/p>
&lt;p>æ•´ä¸ªå½’å¹¶æ’åºï¼Œä¸å¥½ç†è§£çš„åœ°æ–¹å°±æ˜¯é€’å½’æ‹†åˆ†çš„è¿‡ç¨‹ï¼Œå…¶å®ä¹Ÿä¸éš¾ç†è§£ï¼Œå°±æ˜¯èƒ½æ‹†çš„æƒ…å†µä¸‹å°±ä¸€ç›´æ‹†ï¼Œç›´åˆ°ä¸èƒ½æ‹†äº†ä¸ºæ­¢ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span> fast &lt;span style="color:#ff79c6">:=&lt;/span> list.Next
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span> slow &lt;span style="color:#ff79c6">:=&lt;/span> list
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3&lt;/span>&lt;span> &lt;span style="color:#ff79c6">for&lt;/span> fast &lt;span style="color:#ff79c6">!=&lt;/span> &lt;span style="color:#ff79c6">nil&lt;/span> &lt;span style="color:#ff79c6">&amp;amp;&amp;amp;&lt;/span> fast.Next &lt;span style="color:#ff79c6">!=&lt;/span> &lt;span style="color:#ff79c6">nil&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4&lt;/span>&lt;span> fast = fast.Next.Next
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5&lt;/span>&lt;span> slow = slow.Next
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å½“ä¸€æ¬¡æ‹†åˆ†å®Œæˆæ—¶ï¼Œ&lt;code>slow&lt;/code> æŒ‡é’ˆæŒ‡å‘çš„å°±æ˜¯é“¾è¡¨çš„ä¸­é—´ä½ç½®ï¼Œæ‰€ä»¥ &lt;code>slow&lt;/code> çš„ &lt;code>next&lt;/code> å°±æ˜¯é“¾è¡¨çš„ååŠéƒ¨åˆ†äº†ï¼Œ&lt;code>list&lt;/code> æŒ‡é’ˆå°±æ˜¯é“¾è¡¨çš„å‰åŠéƒ¨åˆ†ã€‚&lt;/p>
&lt;p>æ‹†åˆ†çš„è¿‡ç¨‹ä¸­æœ‰ä¸ªåœ°æ–¹éœ€è¦æ³¨æ„ï¼Œå°±æ˜¯æ–­é“¾ï¼Œ&lt;code>slow.Next = nil&lt;/code> å› ä¸ºåœ¨ç”¨å¿«æ…¢æŒ‡é’ˆæ‰¾åˆ°é“¾è¡¨çš„ä¸­é—´ä½ç½®æ—¶,å¹¶æ²¡æœ‰æŠŠé“¾è¡¨åˆ‡åˆ†å¼€ï¼Œéœ€è¦æ‰‹åŠ¨æŠŠé“¾è¡¨æ–­å¼€ï¼Œè¦ä¸ç„¶ä»å¤´å¼€å§‹éå†ï¼Œè¿˜æ˜¯èƒ½éå†æ•´ä¸ªé“¾è¡¨çš„ã€‚&lt;/p>
&lt;h2 id="æ€»ç»“">&lt;a href="#%e6%80%bb%e7%bb%93" class="header-anchor">&lt;/a>æ€»ç»“
&lt;/h2>&lt;p>é“¾è¡¨çš„é—®é¢˜å…¶å®æ²¡æœ‰æ²¡æœ‰ç‰¹åˆ«éš¾çš„ç®—æ³•ï¼ŒåŸºæœ¬éƒ½æ˜¯ä¸€äº›åŸºç¡€çš„æ“ä½œã€‚é“¾è¡¨éš¾çš„åœ°æ–¹æ˜¯å› ä¸ºå†…å­˜åœ°å€ä¸è¿ç»­ï¼Œä¸åƒæ•°ç»„é‚£æ ·å¯ä»¥éšæœºè®¿é—®ï¼Œåªèƒ½é€šè¿‡æŒ‡é’ˆæ“ä½œï¼Œç†è§£èµ·æ¥æ²¡æœ‰é‚£ä¹ˆç›´è§‚æ‰€ä»¥ä¼šè§‰éš¾ã€‚é‡åˆ°é“¾è¡¨é—®é¢˜å°±ç”»å›¾ï¼ŒåŸºæœ¬ä¸Šå›¾ç”»å‡ºæ¥äº†ï¼Œé—®é¢˜ä¹ŸåŸºæœ¬èƒ½è§£å†³äº†ã€‚&lt;/p></description></item><item><title>golangæ±‡ç¼– æ·±å…¥æ¢è®¨äº† Go è¯­è¨€ä¸­çš„æ±‡ç¼–å®ç°åŠå‚æ•°ä¼ é€’çš„æ¼”å˜ - QX's blog</title><link>https://lqxhub.github.io/posts/549df04c/</link><pubDate>Mon, 02 May 2022 19:10:56 +0000</pubDate><guid>https://lqxhub.github.io/posts/549df04c/</guid><description>&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-778243d5661a39cd.webp" alt="Featured image of post golangæ±‡ç¼– æ·±å…¥æ¢è®¨äº† Go è¯­è¨€ä¸­çš„æ±‡ç¼–å®ç°åŠå‚æ•°ä¼ é€’çš„æ¼”å˜ - QX's blog" />&lt;p>äº”ä¸€å‡æœŸåœ¨å®¶æ²¡äº‹é€›è®ºå›çš„æ—¶å€™ï¼Œå‘ç°äº†ä¸€ä¸ªå®è—ç½‘ç«™ï¼Œ&lt;a class="link" href="https://godbolt.org/" target="_blank" rel="noopener"
>ä¼ é€é—¨&lt;/a> è¿™ä¸ªç½‘ç«™å¯ä»¥åœ¨çº¿ç”Ÿæˆå¤šç§è¯­è¨€çš„æ±‡ç¼–ä»£ç ï¼Œæœ‰è¿™ä¸ªå¥½ä¸œè¥¿ï¼Œé‚£å¿…é¡»æ‹¿goå®éªŒä¸€ç•ªã€‚&lt;/p>
&lt;p>å¾ˆä¹…ä¹‹å‰æˆ‘å†™è¿‡ä¸€ç¯‡goé€šè¿‡goæ±‡ç¼–çœ‹å¤šè¿”å›å€¼å®ç°çš„æ–‡ç« &lt;a class="link" href="https://www.jianshu.com/p/0e0ee4091d97" target="_blank" rel="noopener"
>ä¼ é€é—¨&lt;/a>ã€‚å½“æ—¶å†™çš„æ—¶å€™æ¯”è¾ƒæ—©ï¼Œåæ¥ go 1.17 å¯¹å‡½æ•°è°ƒç”¨æ—¶ï¼Œä¼ é€’å‚æ•°åšäº†ä¿®æ”¹ï¼Œç®€å•è¯´å°±æ˜¯go1.17ä¹‹å‰ï¼Œå‡½æ•°å‚æ•°æ˜¯é€šè¿‡æ ˆç©ºé—´æ¥ä¼ é€’çš„ï¼Œåœ¨go1.17æ—¶åšå‡ºäº†æ”¹å˜ï¼Œåœ¨ä¸€äº›å¹³å°ä¸Šï¼ˆAMD64ï¼‰å¯ä»¥åƒC,C++é‚£æ ·ä½¿ç”¨å¯„å­˜å™¨ä¼ é€’å‚æ•°å’Œå‡½æ•°è¿”å›å€¼äº†ã€‚ä¸ºä»€ä¹ˆåšå‡ºè¿™ä¸ªæ”¹å˜å‘¢ï¼ŒåŸå› å°±æ˜¯å¯„å­˜å™¨æ›´å¿«ã€‚è™½ç„¶å†…å­˜å·²ç»å¾ˆå¿«äº†ï¼Œä½†æ˜¯è¿˜æ˜¯æ²¡æ³•å’Œå¯„å­˜å™¨ç›¸æ¯”ã€‚ä¹‹å‰ä¸ºå•¥ä¸ç”¨å¯„å­˜å™¨ï¼Œç”¨æ ˆç©ºé—´ï¼ŒåŸå› æ˜¯å®ç°ç®€å•ï¼Œä¸ç”¨è€ƒè™‘ä¸åŒå¹³å°ï¼Œä¸ç”¨æ¶æ„çš„åŒºåˆ«ã€‚&lt;/p>
&lt;p>ç®€å•æ€»ç»“ä¸€ä¸‹ä¸¤ç§æ–¹å¼&lt;/p>
&lt;ol>
&lt;li>æ ˆç©ºé—´ï¼š&lt;/li>
&lt;/ol>
&lt;ul>
&lt;li>ä¼˜ç‚¹ï¼šå®ç°ç®€å•ï¼Œä¸ç”¨åŒºåˆ†ä¸åŒçš„å¹³å°ï¼Œé€šç”¨æ€§å¼º&lt;/li>
&lt;li>ç¼ºç‚¹ï¼šæ•ˆç‡ä½&lt;/li>
&lt;/ul>
&lt;ol start="2">
&lt;li>å¯„å­˜å™¨ï¼š&lt;/li>
&lt;/ol>
&lt;ul>
&lt;li>ä¼˜ç‚¹ï¼šé€Ÿåº¦å¿«&lt;/li>
&lt;li>ç¼ºç‚¹ï¼šé€šç”¨æ€§å·®ï¼Œä¸åŒçš„å¹³å°éœ€è¦å•ç‹¬å¤„ç†
å½“ç„¶ï¼Œè¿™é‡Œè¯´çš„é€šç”¨æ€§å·®æ˜¯å¯¹äºç¼–è¯‘å™¨æ¥è¯´çš„&lt;/li>
&lt;/ul>
&lt;h2 id="goæ±‡ç¼–åŸºç¡€çŸ¥è¯†">&lt;a href="#go%e6%b1%87%e7%bc%96%e5%9f%ba%e7%a1%80%e7%9f%a5%e8%af%86" class="header-anchor">&lt;/a>goæ±‡ç¼–åŸºç¡€çŸ¥è¯†
&lt;/h2>&lt;p>å†æ¥æ€»ç»“ä¸€æ¬¡goæ±‡ç¼–çš„åŸºç¡€çŸ¥è¯†å§ï¼Œç°åœ¨å›å¤´çœ‹ä¹‹å‰æ€»ç»“çš„è¿˜æ˜¯ä¸å…¨é¢çš„
goä½¿ç”¨çš„ &lt;strong>plan9&lt;/strong> æ±‡ç¼–ï¼Œè¿™ä¸ªå’Œ &lt;strong>AT&amp;amp;T&lt;/strong> çš„æ±‡ç¼–å·®åˆ«è¿˜æ˜¯æœ‰ç‚¹å¤§çš„ï¼Œæˆ‘ä¸ªäººæ„Ÿè§‰plan9æ±‡ç¼–æ¯”è¾ƒé‡è¦çš„å°±æ˜¯å››ä¸ªå¯„å­˜å™¨ï¼Œåªè¦ç†è§£äº†è¿™å››ä¸ªå¯„å­˜å™¨ï¼Œæ±‡ç¼–å°±ç†è§£äº†ä¸€åŠäº†&lt;/p>
&lt;p>æ±‡ç¼–ä¸­ä¸ªå‡ ä¸ªæœ¯è¯­:&lt;/p>
&lt;ul>
&lt;li>æ ˆï¼šè¿›ç¨‹ã€çº¿ç¨‹ã€goroutine éƒ½æœ‰è‡ªå·±çš„è°ƒç”¨æ ˆï¼Œå…ˆè¿›åå‡ºï¼ˆFILOï¼‰&lt;/li>
&lt;li>æ ˆå¸§ï¼šå¯ä»¥ç†è§£æ˜¯å‡½æ•°è°ƒç”¨æ—¶ï¼Œåœ¨æ ˆä¸Šä¸ºå‡½æ•°æ‰€åˆ†é…çš„å†…å­˜åŒºåŸŸ&lt;/li>
&lt;li>è°ƒç”¨è€…ï¼šcallerï¼Œæ¯”å¦‚ï¼šA å‡½æ•°è°ƒç”¨äº† B å‡½æ•°ï¼Œé‚£ä¹ˆ A å°±æ˜¯è°ƒç”¨è€…&lt;/li>
&lt;li>è¢«è°ƒè€…ï¼šcalleeï¼Œæ¯”å¦‚ï¼šA å‡½æ•°è°ƒç”¨äº† B å‡½æ•°ï¼Œé‚£ä¹ˆ B å°±æ˜¯è¢«è°ƒè€…&lt;/li>
&lt;/ul>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>å¯„å­˜å™¨&lt;/th>
&lt;th>è¯´æ˜&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>SB(Static base pointer)&lt;/td>
&lt;td>global symbols å…¨å±€é™æ€æŒ‡é’ˆ&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>FP(Frame pointer)&lt;/td>
&lt;td>arguments and locals æŒ‡å‘æ ˆå¸§çš„å¼€å§‹&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>SP(Stack pointer)&lt;/td>
&lt;td>top of stack æŒ‡å‘æ ˆé¡¶&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>PC(Program counter)&lt;/td>
&lt;td>jumps and branches ç®€å•è¯´ç¨‹åºè®¡æ•°å™¨&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>ç®€å•å±•å¼€è¯´ä¸€ä¸‹å‡ ä¸ªå¯„å­˜å™¨å§&lt;/p>
&lt;ul>
&lt;li>SBï¼šå…¨å±€é™æ€æŒ‡é’ˆï¼Œå³ç¨‹åºåœ°å€ç©ºé—´çš„å¼€å§‹åœ°å€ã€‚ä¸€èˆ¬ç”¨åœ¨å£°æ˜å‡½æ•°ã€å…¨å±€å˜é‡ä¸­ã€‚&lt;/li>
&lt;li>FPï¼šæŒ‡å‘çš„æ˜¯ caller è°ƒç”¨ callee æ—¶ä¼ é€’çš„ç¬¬ä¸€ä¸ªå‚æ•°çš„ä½ç½®ï¼Œå¯ä»¥çœ‹ä½œæ˜¯æŒ‡å‘ä¸¤ä¸ªå‡½æ•°æ ˆçš„åˆ†å‰²ä½ç½®ï¼›ä½†æ˜¯FPæŒ‡å‘çš„ä½ç½®ä¸åœ¨ callee çš„ stack frame ä¹‹å†…ã€‚è€Œæ˜¯åœ¨ caller çš„ stack frame ä¸Šï¼ŒæŒ‡å‘è°ƒç”¨ add å‡½æ•°æ—¶ä¼ é€’çš„ç¬¬ä¸€ä¸ªå‚æ•°çš„ä½ç½®ï¼›å¯ä»¥åœ¨ callee ä¸­ç”¨ &lt;code>symbol+offset(FP)&lt;/code> æ¥è·å–å…¥å‚çš„å‚æ•°å€¼ï¼Œæ¯”å¦‚ &lt;code>a+8(FP)&lt;/code>ã€‚è™½ç„¶ &lt;code>symbol&lt;/code> æ²¡æœ‰ä»€ä¹ˆå…·ä½“æ„ä¹‰ï¼Œä½†æ˜¯ä¸åŠ ç¼–è¯‘å™¨ä¼šæŠ¥é”™ã€‚&lt;/li>
&lt;li>SPï¼šè¿™ä¸ªæ˜¯æœ€å¸¸ç”¨çš„å¯„å­˜å™¨äº†ï¼ŒåŒæ ·ä¹Ÿæ˜¯æœ€å¤æ‚çš„å¯„å­˜å™¨äº†ã€‚ä¸åŒçš„å¼•ç”¨æ–¹å¼ï¼Œä»£è¡¨ä¸åŒçš„ä½ç½®ã€‚SPå¯„å­˜å™¨ åˆ†ä¸ºä¼ª SP å¯„å­˜å™¨å’Œç¡¬ä»¶ SP å¯„å­˜å™¨ã€‚&lt;code>symbol+offset(SP)&lt;/code> å½¢å¼ï¼Œåˆ™è¡¨ç¤ºä¼ªå¯„å­˜å™¨ SP ï¼ˆè¿™ä¸ªä¹Ÿç®€ç§°ä¸º &lt;strong>BP&lt;/strong>ï¼‰ã€‚å¦‚æœæ˜¯ &lt;code>offset(SP)&lt;/code> åˆ™è¡¨ç¤ºç¡¬ä»¶å¯„å­˜å™¨ SPã€‚ä¼ª SP å¯„å­˜å™¨æŒ‡å‘å½“å‰æ ˆå¸§ç¬¬ä¸€ä¸ªå±€éƒ¨å˜é‡çš„ç»“æŸä½ç½®ï¼›ç¡¬ä»¶SPæŒ‡å‘çš„æ˜¯æ•´ä¸ªå‡½æ•°æ ˆç»“æŸçš„ä½ç½®ã€‚**æœ‰ä¸ªæ¯”è¾ƒå‘çš„åœ°æ–¹ï¼š**å¯¹äºç¼–è¯‘è¾“å‡º(go tool compile -S / go tool objdump)çš„ä»£ç æ¥è®²ï¼Œæ‰€æœ‰çš„ SP éƒ½æ˜¯ç¡¬ä»¶ SP å¯„å­˜å™¨ï¼Œæ— è®ºæ˜¯å¦å¸¦ symbolï¼ˆè¿™ä¸€ç‚¹éå¸¸å…·æœ‰è¿·æƒ‘æ€§ï¼Œéœ€è¦æ…¢æ…¢ç†è§£ã€‚å¾€å¾€åœ¨åˆ†æç¼–è¯‘è¾“å‡ºçš„æ±‡ç¼–æ—¶ï¼Œçœ‹åˆ°çš„å°±æ˜¯ç¡¬ä»¶ SP å¯„å­˜å™¨ï¼‰ã€‚&lt;/li>
&lt;li>PCï¼šè¿™ä¸ªå°±æ˜¯è®¡ç®—æœºå¸¸è§çš„ pc å¯„å­˜å™¨ï¼Œåœ¨ x86 å¹³å°ä¸‹å¯¹åº” ip å¯„å­˜å™¨ï¼Œamd64 ä¸Šåˆ™æ˜¯ ripã€‚è¿™ä¸ªå¾ˆå°‘æœ‰ç”¨åˆ°ã€‚&lt;/li>
&lt;/ul>
&lt;p>é€šè¿‡ä¸€ä¸ªæ ˆå¸§çš„å›¾æ¥ç†è§£ä¸€ä¸‹è¿™å‡ ä¸ªå¯„å­˜å™¨&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-778243d5661a39cd.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-778243d5661a39cd.webp" alt="æ ˆå¸§.jpg" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>å¤§ä½“çš„æ ˆå¸§å°±æ˜¯å›¾ä¸­çš„è¿™æ ·ï¼Œå›¾ä¸­æ ‡æ³¨çš„å¯„å­˜å™¨éƒ½æ˜¯ä»¥ &lt;strong>callee&lt;/strong> å‡½æ•°ä¸ºåŸºå‡†çš„&lt;/p>
&lt;p>é€šè¿‡å›¾ä¸­å¯çŸ¥ï¼Œå¦‚æœcalleeå‡½æ•°ä¸­æ²¡æœ‰å±€éƒ¨å˜é‡çš„è¯ï¼ŒSPç¡¬å¯„å­˜å™¨å’ŒSPä¼ªå¯„å­˜å™¨æŒ‡å‘çš„æ˜¯åŒä¸€ä¸ªåœ°æ–¹&lt;/p>
&lt;p>ä¼ª FP å¯„å­˜å™¨å¯¹åº”çš„æ˜¯ caller å‡½æ•°çš„å¸§æŒ‡é’ˆï¼Œä¸€èˆ¬ç”¨æ¥è®¿é—® callee å‡½æ•°çš„å…¥å‚å‚æ•°å’Œè¿”å›å€¼ã€‚ä¼ª SP æ ˆæŒ‡é’ˆå¯¹åº”çš„æ˜¯å½“å‰ callee å‡½æ•°æ ˆå¸§çš„åº•éƒ¨ï¼ˆä¸åŒ…æ‹¬å‚æ•°å’Œè¿”å›å€¼éƒ¨åˆ†ï¼‰ï¼Œä¸€èˆ¬ç”¨äºå®šä½å±€éƒ¨å˜é‡ã€‚ç¡¬ä»¶ SP æ˜¯ä¸€ä¸ªæ¯”è¾ƒç‰¹æ®Šçš„å¯„å­˜å™¨ï¼Œå› ä¸ºè¿˜å­˜åœ¨ä¸€ä¸ªåŒåçš„ SP çœŸå¯„å­˜å™¨ï¼Œç¡¬ä»¶ SP å¯„å­˜å™¨å¯¹åº”çš„æ˜¯æ ˆçš„é¡¶éƒ¨ã€‚&lt;/p>
&lt;p>åœ¨ç¼–å†™ Go æ±‡ç¼–æ—¶ï¼Œå½“éœ€è¦åŒºåˆ†ä¼ªå¯„å­˜å™¨å’ŒçœŸå¯„å­˜å™¨çš„æ—¶å€™åªéœ€è¦è®°ä½ä¸€ç‚¹ï¼šä¼ªå¯„å­˜å™¨ä¸€èˆ¬éœ€è¦ä¸€ä¸ªæ ‡è¯†ç¬¦å’Œåç§»é‡ä¸ºå‰ç¼€ï¼Œå¦‚æœæ²¡æœ‰æ ‡è¯†ç¬¦å‰ç¼€åˆ™æ˜¯çœŸå¯„å­˜å™¨ã€‚æ¯”å¦‚(SP)ã€+8(SP)æ²¡æœ‰æ ‡è¯†ç¬¦å‰ç¼€ä¸ºçœŸ SP å¯„å­˜å™¨ï¼Œè€Œ a(SP)ã€b+8(SP)æœ‰æ ‡è¯†ç¬¦ä¸ºå‰ç¼€è¡¨ç¤ºä¼ªå¯„å­˜å™¨ã€‚&lt;/p>
&lt;p>&lt;strong>è¿˜æœ‰ä¸€ç‚¹&lt;/strong>&lt;/p>
&lt;p>å¦‚æœcalleeçš„æ ˆç©ºé—´å¤§å°æ˜¯0çš„è¯ï¼Œ &lt;strong>caller BP&lt;/strong> æ˜¯ä¸ä¼šè¢«å‹å…¥æ ˆä¸­çš„ï¼Œæ­¤æ—¶çš„SPç¡¬ä»¶å¯„å­˜å™¨å’Œä¼ªFPå¯„å­˜å™¨æŒ‡å‘çš„æ˜¯åŒä¸€ä¸ªä½ç½®ã€‚&lt;/p>
&lt;p>åœ¨æ±‡ç¼–ä¸­ï¼Œå‡½æ•°çš„å®šä¹‰&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-fallback" data-lang="fallback">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>TEXT &amp;#34;&amp;#34;.add(SB), NOSPLIT|ABIInternal, $0-24
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>TEXT&lt;/code> æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„æŒ‡ä»¤ï¼Œå®šä¹‰ä¸€ä¸ªå‡½æ•°&lt;/p>
&lt;p>&lt;code>.add&lt;/code> æ˜¯å‡½æ•°çš„å&lt;/p>
&lt;p>&lt;code>NOSPLIT&lt;/code> å‘ç¼–è¯‘å™¨è¡¨æ˜ä¸åº”è¯¥æ’å…¥ stack-split çš„ç”¨æ¥æ£€æŸ¥æ ˆéœ€è¦æ‰©å¼ çš„å‰å¯¼æŒ‡ä»¤&lt;/p>
&lt;p>&lt;code> $0-24&lt;/code> è¿™ä¸¤ä¸ªå‚æ•°ï¼Œ0æ˜¯å£°æ˜è¿™ä¸ªå‡½æ•°éœ€è¦çš„æ ˆç©ºé—´çš„å¤§å°ï¼Œä¸€èˆ¬æ¥è¯´å°±æ˜¯å±€éƒ¨å˜é‡éœ€è¦çš„ç©ºé—´ï¼Œå•ä½æ˜¯ä½ã€‚
24æ˜¯å£°æ˜å‡½æ•°ä¼ å…¥å‚æ•°å’Œè¿”å›å€¼éœ€è¦çš„æ ˆç©ºé—´çš„å¤§å°ï¼Œå•ä½ä¹Ÿæ˜¯ä½ã€‚&lt;/p>
&lt;h2 id="ç”Ÿæˆæ±‡ç¼–">&lt;a href="#%e7%94%9f%e6%88%90%e6%b1%87%e7%bc%96" class="header-anchor">&lt;/a>ç”Ÿæˆæ±‡ç¼–
&lt;/h2>&lt;p>äº†è§£äº†è¿™äº›åŸºæœ¬æ¦‚å¿µåï¼Œä¸Šä¸€æ®µä»£ç ï¼Œé€šè¿‡æ±‡ç¼–çœ‹ä¸€ä¸‹ä¸åŒç‰ˆæœ¬goæ˜¯å¦‚ä½•å¤„ç†å‡½æ•°ä¼ é€’å‚æ•°çš„&lt;/p>
&lt;p>å…ˆé€šè¿‡ä¸€æ®µç®€å•çš„ä»£ç çœ‹ä¸€ä¸‹åŒºåˆ«&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">package&lt;/span> main
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> &lt;span style="color:#50fa7b">main&lt;/span>(){
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span> &lt;span style="color:#50fa7b">add&lt;/span>(&lt;span style="color:#bd93f9">10&lt;/span>,&lt;span style="color:#bd93f9">20&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span>&lt;span style="color:#6272a4">//go:noinline
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> &lt;span style="color:#50fa7b">add&lt;/span>(a,b &lt;span style="color:#8be9fd">int&lt;/span>) &lt;span style="color:#8be9fd">int&lt;/span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> a&lt;span style="color:#ff79c6">+&lt;/span>b
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>//go:noinline&lt;/code>
è¿™ä¸ªæ˜¯å‘Šè¯‰ç¼–è¯‘å™¨ä¸è¦å¯¹è¿™ä¸ªå‡½æ•°å†…è”ï¼Œè¿™ä¸ªä¸œè¥¿å«goçš„ç¼–è¯‘æŒ‡ä»¤ï¼Œgoè¿˜æœ‰ä½ å¾ˆå¤šåˆ«çš„æŒ‡ä»¤ï¼Œè¿™é‡Œå°±ä¸å±•å¼€äº†ã€‚
æƒ³æƒ³goä¹ŸæŒºæœ‰æ„æ€çš„ï¼ŒC++æ˜¯é€šè¿‡ &lt;code> inline&lt;/code> æ˜¾å¼çš„æŒ‡å®šè¦å†…è”ï¼Œgoæ˜¯å‘Šè¯‰ç¼–è¯‘å™¨ä¸è¦å†…è”ã€‚&lt;/p>
&lt;p>å…ˆçœ‹ä¸€ä¸‹åœ¨1.16ä¸‹çš„æ±‡ç¼–ä»£ç &lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-fallback" data-lang="fallback">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>main_pc0:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span> .file 1 &amp;#34;&amp;lt;source&amp;gt;&amp;#34;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span> .loc 1 5 0
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span> TEXT &amp;#34;&amp;#34;.main(SB), ABIInternal, $32-0
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span> MOVQ (TLS), CX
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span> CMPQ SP, 16(CX)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span> PCDATA $0, $-2
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span> JLS main_pc64
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span> PCDATA $0, $-1
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span> SUBQ $32, SP
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span> MOVQ BP, 24(SP)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span> LEAQ 24(SP), BP
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span> FUNCDATA $0, gclocalsÂ·33cdeccccebe80329f1fdbee7f5874cb(SB)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span> FUNCDATA $1, gclocalsÂ·33cdeccccebe80329f1fdbee7f5874cb(SB)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15&lt;/span>&lt;span> .loc 1 11 0
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16&lt;/span>&lt;span> MOVQ $10, (SP)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17&lt;/span>&lt;span> MOVQ $20, 8(SP)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18&lt;/span>&lt;span> PCDATA $1, $0
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19&lt;/span>&lt;span> CALL &amp;#34;&amp;#34;.add(SB)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20&lt;/span>&lt;span> .loc 1 12 0
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21&lt;/span>&lt;span> MOVQ 24(SP), BP
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22&lt;/span>&lt;span> ADDQ $32, SP
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23&lt;/span>&lt;span> RET
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24&lt;/span>&lt;span> NOP
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25&lt;/span>&lt;span> .loc 1 5 0
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26&lt;/span>&lt;span> PCDATA $1, $-1
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27&lt;/span>&lt;span> PCDATA $0, $-2
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28&lt;/span>&lt;span> NOP
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29&lt;/span>&lt;span>main_pc64:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30&lt;/span>&lt;span> CALL runtime.morestack_noctxt(SB)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31&lt;/span>&lt;span> PCDATA $0, $-1
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32&lt;/span>&lt;span> JMP main_pc0
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33&lt;/span>&lt;span> .loc 1 21 0
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34&lt;/span>&lt;span> TEXT &amp;#34;&amp;#34;.add(SB), NOSPLIT|ABIInternal, $0-24
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35&lt;/span>&lt;span> FUNCDATA $0, gclocalsÂ·33cdeccccebe80329f1fdbee7f5874cb(SB)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36&lt;/span>&lt;span> FUNCDATA $1, gclocalsÂ·33cdeccccebe80329f1fdbee7f5874cb(SB)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37&lt;/span>&lt;span> .loc 1 22 0
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38&lt;/span>&lt;span> MOVQ &amp;#34;&amp;#34;.b+16(SP), AX
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39&lt;/span>&lt;span> MOVQ &amp;#34;&amp;#34;.a+8(SP), CX
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40&lt;/span>&lt;span> ADDQ CX, AX
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41&lt;/span>&lt;span> MOVQ AX, &amp;#34;&amp;#34;.~r2+24(SP)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42&lt;/span>&lt;span> RET
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä»£ç æœ‰å¾ˆå¤šï¼Œåªå…³æ³¨ä¸‹é¢å›¾ä¸­æ ‡æ³¨çš„&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-2629b0b47ac282e0.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-2629b0b47ac282e0.webp" alt="" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>é€š &lt;code> MOVQ &amp;quot;&amp;quot;.b+16(SP), AX&lt;/code> å’Œ &lt;code>MOVQ &amp;quot;&amp;quot;.a+8(SP), CX&lt;/code> å¯ä»¥å¾—çŸ¥ï¼Œå‡½æ•°æ˜¯é€šè¿‡SPå¯„å­˜å™¨åç§»å®Œæˆä¼ é€’å‚æ•°çš„ã€‚
è¿™é‡Œè¦æ³¨æ„ï¼Œ&lt;code>.b+16(SP)&lt;/code> è¿™ç§å†™æ³•çœ‹ç€åƒæ˜¯ä½¿ç”¨çš„æ˜¯ä¼ªSPå¯„å­˜å™¨ï¼Œå®é™…ä¸Šç”¨çš„æ˜¯ç¡¬ä»¶SPå¯„å­˜å™¨&lt;/p>
&lt;p>åŒæ ·çš„ï¼Œåœ¨å‡½æ•°è°ƒç”¨ä¹‹å‰ï¼Œä¹Ÿä¼šæŠŠæ•°å€¼æ”¾åˆ°æ ˆçš„æŒ‡å®šä½ç½®&lt;/p>
&lt;p>&lt;code>MOVQ $10, (SP)&lt;/code> , &lt;code>MOVQ $20, 8(SP)&lt;/code>&lt;/p>
&lt;p>æŠŠç¼–è¯‘å™¨æ¢æˆæœ€æ–°çš„ 1.18çœ‹ä¸€ä¸‹&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-fallback" data-lang="fallback">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>main_pc0:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span> .file 1 &amp;#34;&amp;lt;source&amp;gt;&amp;#34;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span> .loc 1 5 0
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span> TEXT &amp;#34;&amp;#34;.main(SB), ABIInternal, $24-0
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span> CMPQ SP, 16(R14)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span> PCDATA $0, $-2
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span> JLS main_pc47
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span> PCDATA $0, $-1
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span> SUBQ $24, SP
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span> MOVQ BP, 16(SP)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span> LEAQ 16(SP), BP
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span> FUNCDATA $0, gclocalsÂ·33cdeccccebe80329f1fdbee7f5874cb(SB)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span> FUNCDATA $1, gclocalsÂ·33cdeccccebe80329f1fdbee7f5874cb(SB)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span> .loc 1 11 0
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15&lt;/span>&lt;span> MOVL $10, AX
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16&lt;/span>&lt;span> MOVL $20, BX
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17&lt;/span>&lt;span> PCDATA $1, $0
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18&lt;/span>&lt;span> NOP
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19&lt;/span>&lt;span> CALL &amp;#34;&amp;#34;.add(SB)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20&lt;/span>&lt;span> .loc 1 12 0
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21&lt;/span>&lt;span> MOVQ 16(SP), BP
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22&lt;/span>&lt;span> ADDQ $24, SP
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23&lt;/span>&lt;span> RET
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24&lt;/span>&lt;span>main_pc47:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25&lt;/span>&lt;span> NOP
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26&lt;/span>&lt;span> .loc 1 5 0
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27&lt;/span>&lt;span> PCDATA $1, $-1
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28&lt;/span>&lt;span> PCDATA $0, $-2
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29&lt;/span>&lt;span> CALL runtime.morestack_noctxt(SB)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30&lt;/span>&lt;span> PCDATA $0, $-1
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31&lt;/span>&lt;span> JMP main_pc0
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32&lt;/span>&lt;span> .loc 1 21 0
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33&lt;/span>&lt;span> TEXT &amp;#34;&amp;#34;.add(SB), NOSPLIT|ABIInternal, $0-16
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34&lt;/span>&lt;span> FUNCDATA $0, gclocalsÂ·33cdeccccebe80329f1fdbee7f5874cb(SB)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35&lt;/span>&lt;span> FUNCDATA $1, gclocalsÂ·33cdeccccebe80329f1fdbee7f5874cb(SB)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36&lt;/span>&lt;span> FUNCDATA $5, &amp;#34;&amp;#34;.add.arginfo1(SB)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37&lt;/span>&lt;span> FUNCDATA $6, &amp;#34;&amp;#34;.add.argliveinfo(SB)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38&lt;/span>&lt;span> PCDATA $3, $1
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39&lt;/span>&lt;span> .loc 1 22 0
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40&lt;/span>&lt;span> ADDQ BX, AX
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41&lt;/span>&lt;span> RET
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>åœ¨1.18çš„æ±‡ç¼–ä»£ç ä¸­å°±æ²¡æœ‰é€šè¿‡æ ˆç©ºé—´æ¥ä¼ é€’å‚æ•°äº†ï¼Œè€Œæ˜¯ç›´æ¥é€šè¿‡å¯„å­˜å™¨å®Œæˆæ“ä½œï¼Œ
&lt;code>ADDQ BX, AX&lt;/code>ï¼Œå¹¶ä¸”è¿”å›å€¼ç›´æ¥æ”¾åˆ°å¯„å­˜å™¨ä¸­ã€‚&lt;/p>
&lt;p>å¯„å­˜å™¨æ•°é‡æ˜¯æœ‰ä¸Šé™çš„ï¼Œå¦‚æœä¼ é€’çš„å‚æ•°ä¸ªæ•°è¶…è¿‡äº†å¯„å­˜å™¨çš„ä¸Šé™ï¼Œåˆä¼šæ€æ ·å¤„ç†å‘¢&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">package&lt;/span> main
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> &lt;span style="color:#50fa7b">main&lt;/span>(){
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span> &lt;span style="color:#50fa7b">add&lt;/span>(&lt;span style="color:#bd93f9">1&lt;/span>,&lt;span style="color:#bd93f9">2&lt;/span>,&lt;span style="color:#bd93f9">3&lt;/span>,&lt;span style="color:#bd93f9">4&lt;/span>,&lt;span style="color:#bd93f9">5&lt;/span>,&lt;span style="color:#bd93f9">6&lt;/span>,&lt;span style="color:#bd93f9">7&lt;/span>,&lt;span style="color:#bd93f9">8&lt;/span>,&lt;span style="color:#bd93f9">9&lt;/span>,&lt;span style="color:#bd93f9">10&lt;/span>,&lt;span style="color:#bd93f9">11&lt;/span>,&lt;span style="color:#bd93f9">12&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span>&lt;span style="color:#6272a4">//go:noinline
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> &lt;span style="color:#50fa7b">add&lt;/span>(a,b,c,d,e,f,g,h,i,j,k,l &lt;span style="color:#8be9fd">int&lt;/span>) &lt;span style="color:#8be9fd">int&lt;/span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> a&lt;span style="color:#ff79c6">+&lt;/span>b&lt;span style="color:#ff79c6">+&lt;/span>c&lt;span style="color:#ff79c6">+&lt;/span>d&lt;span style="color:#ff79c6">+&lt;/span>e&lt;span style="color:#ff79c6">+&lt;/span>f&lt;span style="color:#ff79c6">+&lt;/span>g&lt;span style="color:#ff79c6">+&lt;/span>h&lt;span style="color:#ff79c6">+&lt;/span>i&lt;span style="color:#ff79c6">+&lt;/span>j&lt;span style="color:#ff79c6">+&lt;/span>k&lt;span style="color:#ff79c6">+&lt;/span>l
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å¯¹åº”çš„æ±‡ç¼–&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-fallback" data-lang="fallback">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>main_pc0:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span> .file 1 &amp;#34;&amp;lt;source&amp;gt;&amp;#34;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span> .loc 1 5 0
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span> TEXT &amp;#34;&amp;#34;.main(SB), ABIInternal, $104-0
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span> CMPQ SP, 16(R14)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span> PCDATA $0, $-2
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span> JLS main_pc111
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span> PCDATA $0, $-1
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span> SUBQ $104, SP
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span> MOVQ BP, 96(SP)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span> LEAQ 96(SP), BP
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span> FUNCDATA $0, gclocalsÂ·33cdeccccebe80329f1fdbee7f5874cb(SB)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span> FUNCDATA $1, gclocalsÂ·33cdeccccebe80329f1fdbee7f5874cb(SB)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span> .loc 1 11 0
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15&lt;/span>&lt;span> MOVQ $10, (SP)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16&lt;/span>&lt;span> MOVQ $11, 8(SP)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17&lt;/span>&lt;span> MOVQ $12, 16(SP)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18&lt;/span>&lt;span> MOVL $1, AX
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19&lt;/span>&lt;span> MOVL $2, BX
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20&lt;/span>&lt;span> MOVL $3, CX
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21&lt;/span>&lt;span> MOVL $4, DI
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22&lt;/span>&lt;span> MOVL $5, SI
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23&lt;/span>&lt;span> MOVL $6, R8
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24&lt;/span>&lt;span> MOVL $7, R9
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25&lt;/span>&lt;span> MOVL $8, R10
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26&lt;/span>&lt;span> MOVL $9, R11
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27&lt;/span>&lt;span> PCDATA $1, $0
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28&lt;/span>&lt;span> NOP
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29&lt;/span>&lt;span> CALL &amp;#34;&amp;#34;.add(SB)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30&lt;/span>&lt;span> .loc 1 12 0
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31&lt;/span>&lt;span> MOVQ 96(SP), BP
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32&lt;/span>&lt;span> ADDQ $104, SP
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33&lt;/span>&lt;span> RET
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34&lt;/span>&lt;span>main_pc111:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35&lt;/span>&lt;span> NOP
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36&lt;/span>&lt;span> .loc 1 5 0
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37&lt;/span>&lt;span> PCDATA $1, $-1
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38&lt;/span>&lt;span> PCDATA $0, $-2
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39&lt;/span>&lt;span> CALL runtime.morestack_noctxt(SB)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40&lt;/span>&lt;span> PCDATA $0, $-1
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41&lt;/span>&lt;span> JMP main_pc0
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42&lt;/span>&lt;span> .loc 1 21 0
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43&lt;/span>&lt;span> TEXT &amp;#34;&amp;#34;.add(SB), NOSPLIT|ABIInternal, $0-96
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44&lt;/span>&lt;span> FUNCDATA $0, gclocalsÂ·33cdeccccebe80329f1fdbee7f5874cb(SB)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45&lt;/span>&lt;span> FUNCDATA $1, gclocalsÂ·33cdeccccebe80329f1fdbee7f5874cb(SB)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46&lt;/span>&lt;span> FUNCDATA $5, &amp;#34;&amp;#34;.add.arginfo1(SB)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47&lt;/span>&lt;span> FUNCDATA $6, &amp;#34;&amp;#34;.add.argliveinfo(SB)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48&lt;/span>&lt;span> PCDATA $3, $1
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49&lt;/span>&lt;span> .loc 1 22 0
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50&lt;/span>&lt;span> LEAQ (BX)(AX*1), DX
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">51&lt;/span>&lt;span> ADDQ DX, CX
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">52&lt;/span>&lt;span> ADDQ DI, CX
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">53&lt;/span>&lt;span> ADDQ SI, CX
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">54&lt;/span>&lt;span> ADDQ R8, CX
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">55&lt;/span>&lt;span> ADDQ R9, CX
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">56&lt;/span>&lt;span> ADDQ R10, CX
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">57&lt;/span>&lt;span> ADDQ R11, CX
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">58&lt;/span>&lt;span> MOVQ &amp;#34;&amp;#34;.j+8(SP), DX
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">59&lt;/span>&lt;span> ADDQ DX, CX
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">60&lt;/span>&lt;span> MOVQ &amp;#34;&amp;#34;.k+16(SP), DX
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">61&lt;/span>&lt;span> ADDQ DX, CX
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">62&lt;/span>&lt;span> MOVQ &amp;#34;&amp;#34;.l+24(SP), DX
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">63&lt;/span>&lt;span> LEAQ (DX)(CX*1), AX
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">64&lt;/span>&lt;span> RET
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>é€šè¿‡æ±‡ç¼–å¯ä»¥çœ‹åˆ°ï¼Œä¼šå…ˆä½¿ç”¨å¯„å­˜å™¨ï¼Œå½“å¯„å­˜å™¨ä¸å¤Ÿæ—¶ï¼Œä¼šä½¿ç”¨æ ˆç©ºé—´ã€‚&lt;/p>
&lt;h2 id="æ‰‹å†™æ±‡ç¼–">&lt;a href="#%e6%89%8b%e5%86%99%e6%b1%87%e7%bc%96" class="header-anchor">&lt;/a>æ‰‹å†™æ±‡ç¼–
&lt;/h2>&lt;p>é€šè¿‡æ‰‹å†™ä¸€æ®µæ±‡ç¼–ä»£ç ï¼ŒéªŒè¯ä¸€ä¸‹å„ä¸ªå¯„å­˜å™¨çš„ä½ç½®ï¼Œæˆ‘ç”¨çš„goç‰ˆæœ¬æ˜¯ 1.14.13ï¼Œæ‰€ä»¥ä¼ å‚æ•°ç”¨çš„æ˜¯æ ˆç©ºé—´ã€‚
åœ¨ &lt;strong>main.go&lt;/strong> æ–‡ä»¶ä¸­&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">package&lt;/span> main
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> &lt;span style="color:#50fa7b">add&lt;/span>(&lt;span style="color:#8be9fd">int&lt;/span>, &lt;span style="color:#8be9fd">int&lt;/span>) &lt;span style="color:#8be9fd">int&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> &lt;span style="color:#50fa7b">main&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6&lt;/span>&lt;span> &lt;span style="color:#8be9fd;font-style:italic">print&lt;/span>(&lt;span style="color:#50fa7b">add&lt;/span>(&lt;span style="color:#bd93f9">10&lt;/span>, &lt;span style="color:#bd93f9">20&lt;/span>))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å®šä¹‰ä¸€ä¸ª &lt;strong>main&lt;/strong> å‡½æ•°ä½œä¸ºæ•´ä¸ªç¨‹åºçš„å…¥å£ï¼Œå£°æ˜ä¸€ä¸ª &lt;code>add(int, int) int&lt;/code> å‡½æ•°ï¼Œadd å‡½æ•°çš„å…·ä½“å®ç°æ˜¯ç”¨æ±‡ç¼–å†™çš„,
åœ¨ &lt;strong>main.go&lt;/strong> åŒçº§ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª &lt;strong>add_amd64.s&lt;/strong> çš„æ–‡ä»¶ã€‚&lt;/p>
&lt;h3 id="ä½¿ç”¨ç¡¬bpå¯„å­˜å™¨">&lt;a href="#%e4%bd%bf%e7%94%a8%e7%a1%acbp%e5%af%84%e5%ad%98%e5%99%a8" class="header-anchor">&lt;/a>ä½¿ç”¨ç¡¬BPå¯„å­˜å™¨
&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-fallback" data-lang="fallback">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>TEXT Â·add(SB), $0-24
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span> MOVQ 8(SP), AX
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3&lt;/span>&lt;span> MOVQ 16(SP), BX
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4&lt;/span>&lt;span> ADDQ BX, AX
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5&lt;/span>&lt;span> MOVQ AX, 24(SP)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6&lt;/span>&lt;span> RET
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä½¿ç”¨ &lt;strong>go run .&lt;/strong> å‘½ä»¤ï¼Œçœ‹ä¸€ä¸‹ç¨‹åºæ‰§è¡Œçš„ç»“æœã€‚
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-66c52609a214fb8c.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-66c52609a214fb8c.webp" alt="" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>è¿™æ—¶å€™çš„æ ˆå¸§å¦‚å›¾æ‰€ç¤º
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-029c4c14cf366e1c.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-029c4c14cf366e1c.webp" alt="" />
&lt;/a>
&lt;/div>
å› ä¸ºaddå‡½æ•°æ ˆç©ºé—´æ˜¯0ï¼Œæ‰€ä»¥ä¼ªSPå¯„å­˜å™¨æ²¡æœ‰è¢«å‹å…¥æ ˆä¸­ï¼Œä¼ªSPå¯„å­˜å™¨å’Œç¡¬ä»¶SPå¯„å­˜å™¨æŒ‡å‘çš„æ˜¯åŒä¸€ä¸ªä½ç½®ã€‚&lt;/p>
&lt;h3 id="ä½¿ç”¨ä¼ªspå¯„å­˜å™¨">&lt;a href="#%e4%bd%bf%e7%94%a8%e4%bc%aasp%e5%af%84%e5%ad%98%e5%99%a8" class="header-anchor">&lt;/a>ä½¿ç”¨ä¼ªSPå¯„å­˜å™¨
&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-fallback" data-lang="fallback">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>TEXT Â·add(SB), $16-24
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span> MOVQ a+16(SP), AX
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3&lt;/span>&lt;span> MOVQ b+24(SP), BX
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4&lt;/span>&lt;span> ADDQ BX, AX
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5&lt;/span>&lt;span> MOVQ AX, ret+32(SP)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6&lt;/span>&lt;span> RET
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä¸ºäº†åŒºåˆ†å¯¹æ¯”ï¼Œè¿™æ—¶å€™æŠŠaddå‡½æ•°çš„æ ˆç©ºé—´è®¾ç½®ä¸º16ï¼Œç„¶åä½¿ç”¨ä¼ªSPå¯„å­˜å™¨æ¥è·å–å€¼ã€‚
æ‰§è¡Œç»“æœå¦‚ä¸‹ï¼š
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-4d9226937d2d365d.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-4d9226937d2d365d.webp" alt="" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>è¿™æ—¶å€™çš„æ ˆç©ºé—´å¦‚å›¾
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-418927831c585496.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-418927831c585496.webp" alt="" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;h3 id="ä½¿ç”¨fpå¯„å­˜å™¨">&lt;a href="#%e4%bd%bf%e7%94%a8fp%e5%af%84%e5%ad%98%e5%99%a8" class="header-anchor">&lt;/a>ä½¿ç”¨FPå¯„å­˜å™¨
&lt;/h3>&lt;p>ä»£ç å¦‚ä¸‹:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-fallback" data-lang="fallback">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>TEXT Â·add(SB), $16-24
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span> MOVQ a+0(FP), AX
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3&lt;/span>&lt;span> MOVQ b+8(FP), BX
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4&lt;/span>&lt;span> ADDQ BX, AX
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5&lt;/span>&lt;span> MOVQ AX, ret+16(FP)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6&lt;/span>&lt;span> RET
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æ‰§è¡Œç»“æœ:&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-66c52609a214fb8c%20%281%29.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-66c52609a214fb8c%20%281%29.webp" alt="" />
&lt;/a>
&lt;/div>
è¯´æ˜è¿˜æ˜¯æ­£ç¡®çš„ï¼Œæ­¤æ—¶çš„æ ˆç©ºé—´æ²¡æœ‰å˜åŒ–ï¼Œå’Œä¸Šé¢æ˜¯ä¸€æ ·çš„ã€‚&lt;/p>
&lt;p>åˆ°è¿™ï¼Œåº”è¯¥èƒ½ç†è§£å„ä¸ªå¯„å­˜å™¨çš„ç›¸å¯¹ä½ç½®äº†å§ï¼š
åœ¨calleeæ ˆç©ºé—´ä¸ä¸º0çš„æ—¶å€™ï¼Œ&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-fallback" data-lang="fallback">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>FP = ç¡¬ä»¶SP + framsize + 16
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span>SP = ç¡¬ä»¶SP + framsize
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>åœ¨calleeæ ˆç©ºé—´ä¸º0çš„æ—¶å€™ï¼Œ&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-fallback" data-lang="fallback">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>FP = ç¡¬ä»¶SP + 8
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span>SP = ç¡¬ä»¶SP
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="æ±‡ç¼–ç®€å•åˆ†æ">&lt;a href="#%e6%b1%87%e7%bc%96%e7%ae%80%e5%8d%95%e5%88%86%e6%9e%90" class="header-anchor">&lt;/a>æ±‡ç¼–ç®€å•åˆ†æ
&lt;/h2>&lt;p>é€šè¿‡ä¸Šé¢çš„ä»£ç ä¼šå‘ç°ï¼Œæ‰‹å†™æ±‡ç¼–çš„ä»£ç å’Œåæ±‡ç¼–çš„ä»£ç æœ‰äº›ä¸åŒã€‚åæ±‡ç¼–å¾—åˆ°çš„ä»£ç ï¼Œåœ¨å‡½æ•°å‰é¢ä¼šæœ‰ä¸€æ®µ
&lt;code> CALL runtime.morestack_noctxt(SB)&lt;/code>
å…¶å®è¿™ä¸ªæ˜¯ç¼–è¯‘å™¨è‡ªåŠ¨æ’å…¥çš„ä¸€æ®µå‡½æ•°ï¼Œè¿™æ®µæŒ‡ä»¤ä¼šè°ƒç”¨ä¸€æ¬¡ &lt;code>runtime.morestack_noctxt&lt;/code> è¿™ä¸ªå‡½æ•°å…·ä½“çš„ä½œç”¨æ˜¯æŒºå¤æ‚çš„ï¼Œä¸»è¦æœ‰ æ£€æŸ¥æ˜¯å¦éœ€è¦æ‰©å¼ æ ˆï¼Œgoçš„æ ˆç©ºé—´æ˜¯å¯ä»¥åŠ¨æ€æ‰©å……çš„ï¼Œæ‰€ä»¥åœ¨è°ƒç”¨å‡½æ•°å‰ä¼šæ£€æŸ¥å½“å‰çš„æ ˆç©ºé—´æ˜¯å¦éœ€è¦æ‰©å……ã€‚è¿˜æœ‰ä¸€ä¸ªåŠŸèƒ½å°±æ˜¯æ£€æŸ¥å½“å‰åç¨‹éœ€è¦æŠ¢å ã€‚goåœ¨1.14ä¹‹å‰goroutineçš„æŠ¢å æ˜¯åä½œå¼æŠ¢å æ¨¡å¼ï¼Œæ€ä¹ˆåˆ¤æ–­ä¸€ä¸ªåç¨‹æ˜¯å¦éœ€è¦æŠ¢å å‘¢ï¼Ÿåå°åç¨‹ä¼šå®šæ—¶æ‰«æå½“å‰è¿è¡Œä¸­çš„åç¨‹ï¼Œå¦‚æœå‘ç°ä¸€ä¸ªåç¨‹è¿è¡Œæ¯”è¾ƒä¹…ï¼Œä¼šå°†å…¶æ ‡è®°ä¸ºæŠ¢å çŠ¶æ€ã€‚è¿™ä¸ªæ‰«æçš„æ—¶é—´ç‚¹å°±æ˜¯å‡½æ•°è°ƒç”¨æœŸé—´å®Œæˆçš„ã€‚&lt;/p>
&lt;h2 id="ä¸åŒç±»å‹å‚æ•°ä¼ é€’">&lt;a href="#%e4%b8%8d%e5%90%8c%e7%b1%bb%e5%9e%8b%e5%8f%82%e6%95%b0%e4%bc%a0%e9%80%92" class="header-anchor">&lt;/a>ä¸åŒç±»å‹å‚æ•°ä¼ é€’
&lt;/h2>&lt;h2 id="ä¼ ç»“æ„ä½“">&lt;a href="#%e4%bc%a0%e7%bb%93%e6%9e%84%e4%bd%93" class="header-anchor">&lt;/a>ä¼ ç»“æ„ä½“
&lt;/h2>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">package&lt;/span> main
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">type&lt;/span> One &lt;span style="color:#8be9fd;font-style:italic">struct&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span> a &lt;span style="color:#8be9fd">int&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span> b &lt;span style="color:#8be9fd">int&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> &lt;span style="color:#50fa7b">main&lt;/span>(){
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span> o &lt;span style="color:#ff79c6">:=&lt;/span> One {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span> a:&lt;span style="color:#bd93f9">10&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span> b&lt;span style="color:#bd93f9">.20&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span> &lt;span style="color:#50fa7b">f1&lt;/span>(o)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16&lt;/span>&lt;span>&lt;span style="color:#6272a4">//go:noinline
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> &lt;span style="color:#50fa7b">f1&lt;/span>(o One) &lt;span style="color:#8be9fd">int&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> o.a &lt;span style="color:#ff79c6">+&lt;/span> o.b
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>åªè´´ å…³é”®çš„æ±‡ç¼–ä»£ç å§&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-fallback" data-lang="fallback">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span> MOVQ $10, (SP)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span> MOVQ $0, 8(SP)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span> PCDATA $1, $0
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span> CALL &amp;#34;&amp;#34;.f1(SB)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span>..........................
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span> TEXT &amp;#34;&amp;#34;.f1(SB), NOSPLIT|ABIInternal, $0-24
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span> MOVQ &amp;#34;&amp;#34;.o+16(SP), AX
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span> MOVQ &amp;#34;&amp;#34;.o+8(SP), CX
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span> ADDQ CX, AX
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span> MOVQ AX, &amp;#34;&amp;#34;.~r1+24(SP)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span> RET
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>åœ¨ä¼ ç»“æ„ä½“çš„æ—¶å€™ï¼ŒåªæŠŠç»“æ„ä½“çš„å†…å®¹ä¼ è¿›å»äº†ã€‚&lt;/p>
&lt;h3 id="ä¼ ç»“æ„ä½“æŒ‡é’ˆ">&lt;a href="#%e4%bc%a0%e7%bb%93%e6%9e%84%e4%bd%93%e6%8c%87%e9%92%88" class="header-anchor">&lt;/a>ä¼ ç»“æ„ä½“æŒ‡é’ˆ
&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">package&lt;/span> main
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">type&lt;/span> One &lt;span style="color:#8be9fd;font-style:italic">struct&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span> a &lt;span style="color:#8be9fd">int&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span> b &lt;span style="color:#8be9fd">int&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> &lt;span style="color:#50fa7b">main&lt;/span>(){
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span> o &lt;span style="color:#ff79c6">:=&lt;/span> &lt;span style="color:#ff79c6">&amp;amp;&lt;/span>One{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span> a:&lt;span style="color:#bd93f9">10&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span> b:&lt;span style="color:#bd93f9">20&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span> &lt;span style="color:#50fa7b">f1&lt;/span>(o)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16&lt;/span>&lt;span>&lt;span style="color:#6272a4">//go:noinline
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> &lt;span style="color:#50fa7b">f1&lt;/span>(o &lt;span style="color:#ff79c6">*&lt;/span>One) &lt;span style="color:#8be9fd">int&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> o.a &lt;span style="color:#ff79c6">+&lt;/span> o.b
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æ±‡ç¼–&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-fallback" data-lang="fallback">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span> LEAQ &amp;#34;&amp;#34;..autotmp_2+16(SP), AX
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span> MOVQ AX, (SP)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span> PCDATA $1, $0
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span> CALL &amp;#34;&amp;#34;.f1(SB)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span>.......................
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span> TEXT &amp;#34;&amp;#34;.f1(SB), NOSPLIT|ABIInternal, $0-16
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span> MOVQ &amp;#34;&amp;#34;.o+8(SP), AX
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span> MOVQ (AX), CX
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span> ADDQ 8(AX), CX
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span> MOVQ CX, &amp;#34;&amp;#34;.~r1+16(SP)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span> RET
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å¯ä»¥çœ‹åˆ°ï¼Œä¼ é€’æŒ‡é’ˆçš„æ—¶å€™ï¼Œåªæ˜¯æŠŠç»“æ„ä½“ç¬¬ä¸€ä¸ªå…ƒç´ çš„åœ°å€ä¼ é€’è¿›å»äº†ã€‚&lt;/p>
&lt;p>å¦‚æœæ˜¯ä¼ ä¸€ä¸ªç©ºçš„ç»“æ„ä½“&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">package&lt;/span> main
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">type&lt;/span> One &lt;span style="color:#8be9fd;font-style:italic">struct&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> &lt;span style="color:#50fa7b">main&lt;/span>(){
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span> o &lt;span style="color:#ff79c6">:=&lt;/span> One{}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span> &lt;span style="color:#50fa7b">f1&lt;/span>(o,&lt;span style="color:#bd93f9">10&lt;/span>,&lt;span style="color:#bd93f9">20&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span>&lt;span style="color:#6272a4">//go:noinline
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> &lt;span style="color:#50fa7b">f1&lt;/span>(o One, a,b &lt;span style="color:#8be9fd">int&lt;/span>) &lt;span style="color:#8be9fd">int&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> a &lt;span style="color:#ff79c6">+&lt;/span> b
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æ±‡ç¼–&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-fallback" data-lang="fallback">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span> TEXT &amp;#34;&amp;#34;.f1(SB), NOSPLIT|ABIInternal, $0-24
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span> .loc 1 15 0
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3&lt;/span>&lt;span> MOVQ &amp;#34;&amp;#34;.b+16(SP), AX
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4&lt;/span>&lt;span> MOVQ &amp;#34;&amp;#34;.a+8(SP), CX
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5&lt;/span>&lt;span> ADDQ CX, AX
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6&lt;/span>&lt;span> MOVQ AX, &amp;#34;&amp;#34;.~r3+24(SP)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7&lt;/span>&lt;span> RET
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å¯ä»¥çœ‹åˆ°ï¼Œå½“ä¼ é€’ä¸€ä¸ªç©ºç»“æ„ä½“æ—¶ï¼Œç›¸å½“äºæ²¡æœ‰ä¼ é€’ï¼Œå› ä¸ºç©ºç»“æ„ä½“çš„ç©ºé—´å¤§å°æ˜¯0ï¼Œæ‰€ä»¥ç¼–è¯‘å™¨å°±ç»™å¿½ç•¥äº†ã€‚&lt;/p>
&lt;h2 id="æœ€å">&lt;a href="#%e6%9c%80%e5%90%8e" class="header-anchor">&lt;/a>æœ€å
&lt;/h2>&lt;p>æš‚æ—¶å°±æƒ³åˆ°è¿™ä¹ˆå¤šï¼Œå…ˆå†™è¿™äº›å§ï¼Œåé¢æƒ³èµ·åˆ«çš„å†è¡¥å……å§&lt;/p></description></item><item><title>golangæ³›å‹åˆå°è¯•</title><link>https://lqxhub.github.io/posts/c86abacd/</link><pubDate>Sat, 19 Mar 2022 17:38:55 +0000</pubDate><guid>https://lqxhub.github.io/posts/c86abacd/</guid><description>&lt;p>goçš„1.18ç‰ˆæœ¬åœ¨3æœˆ15è¿™å¤©æ­£å¼å‘å¸ƒäº† &lt;a class="link" href="https://tip.golang.org/doc/go1.18" target="_blank" rel="noopener"
>release notes&lt;/a>ï¼Œè™½ç„¶åœ¨bateç‰ˆæœ¬å°±å¯ä»¥å°è¯•äº†ï¼Œæ¯•ç«Ÿé‚£æ—¶å€™è¿˜æ²¡æ­£å¼å‘å¸ƒï¼Œä¹Ÿå°±æ²¡å»å°è¯•äº†ï¼Œç°åœ¨æ­£å¼å‘å¸ƒäº†ï¼Œé©¬ä¸Šå°±æ›´äº†å°è¯•ä¸€ä¸‹ã€‚&lt;/p>
&lt;p>æ€»ç®—æ˜¯åƒå‘¼ä¸‡å”¤å§‹å‡ºæ¥ï¼Œå…¶å®æˆ‘å¯¹Goçš„æ³›å‹è¿˜æ˜¯æŒºæœŸå¾…çš„ï¼Œæ¯•ç«Ÿç”¨ &lt;code>interface&lt;/code> èƒ½å®ç°ä¸€äº›ä¸œè¥¿ï¼Œä½†æ˜¯è¿˜æ˜¯ä¸å¦‚åŸç”Ÿæ”¯æŒæ¥å¾—å¥½ï¼Œç”¨interfaceé¦–å…ˆä¼šå› ä¸ºç±»å‹è½¬æ¢å¸¦æ¥ä¸€äº›æ€§èƒ½æŸå¤±ï¼Œç”¨interfaceåšç±»å‹å¼ºè½¬ï¼Œæœ‰æ—¶å€™ä¼šå› ä¸ºä¸å°å¿ƒå†™é”™äº†ï¼Œå¯¼è‡´ä¸€äº›è¿è¡Œæ—¶é”™è¯¯ã€‚è¦æ˜¯æ”¯æŒæ³›å‹ï¼Œè¿™äº›é—®é¢˜å°±ä¼šè§£å†³äº†ï¼Œä¸€äº›é€šç”¨çš„åº“å°±ä¼šæ›´å¥½ç”¨äº†ã€‚&lt;/p>
&lt;p>å½“ç„¶æ³›å‹ä¹Ÿä¸æ˜¯å®Œç¾æ— ç¼ºçš„ï¼Œæ³›å‹ä¼šå¯¼è‡´è¯­è¨€å˜å¾—å¤æ‚ï¼Œå¤§å‹é¡¹ç›®çš„ä»£ç å¯èƒ½ä¼šæ›´éš¾è¯»ã€éš¾ç†è§£äº†ï¼Œè¿™ä¹Ÿä¼šå¯¼è‡´ç¼–è¯‘å™¨å®ç°èµ·æ¥æ›´å¤æ‚ã€‚ä½†æ˜¯ä¼˜åŠ¿è¿˜æ˜¯å¤§äºåŠ£åŠ¿çš„&lt;/p>
&lt;p>è¿™é‡Œæƒ³éª‚ä¸€å¥ï¼Œå…¶ä»–è¯­è¨€çš„æ³›å‹ä¸€èˆ¬éƒ½æ˜¯ç”¨ &lt;code>&amp;lt;&amp;gt;&lt;/code> go çš„æ³›å‹ç”¨ &lt;code>[]&lt;/code> æä¸æ‡‚ä¸ºå•¥ä¸ç”¨ &lt;code>&amp;lt;&amp;gt;&lt;/code> éè¦ç‹¬æ ‘ä¸€å¸œï¼Œæ‰“ä¸è¿‡å°±åŠ å…¥ï¼Œä½ è¯´ç”¨å•¥å°±ç”¨å•¥å§&lt;/p>
&lt;p>å…ˆé€šè¿‡å‡ ä¸ªç®€å•çš„ä¾‹å­æ¥ç»ƒä¹ ä¸€ä¸‹&lt;/p>
&lt;h2 id="æ³›å‹å‡½æ•°">&lt;a href="#%e6%b3%9b%e5%9e%8b%e5%87%bd%e6%95%b0" class="header-anchor">&lt;/a>æ³›å‹å‡½æ•°
&lt;/h2>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> &lt;span style="color:#50fa7b">main&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span> fmt.&lt;span style="color:#50fa7b">Println&lt;/span>(Max[&lt;span style="color:#8be9fd">int&lt;/span>](&lt;span style="color:#bd93f9">1&lt;/span>, &lt;span style="color:#bd93f9">2&lt;/span>))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span> fmt.&lt;span style="color:#50fa7b">Println&lt;/span>(&lt;span style="color:#50fa7b">Max&lt;/span>(&lt;span style="color:#bd93f9">1.5&lt;/span>, &lt;span style="color:#bd93f9">2.6&lt;/span>))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span> fmt.&lt;span style="color:#50fa7b">Println&lt;/span>(&lt;span style="color:#50fa7b">Max&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;abc&amp;#34;&lt;/span>, &lt;span style="color:#f1fa8c">&amp;#34;efg&amp;#34;&lt;/span>))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> Max[T &lt;span style="color:#8be9fd">int&lt;/span> | &lt;span style="color:#8be9fd">float64&lt;/span> | &lt;span style="color:#8be9fd">string&lt;/span>](a, b T) T {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> a &amp;gt; b {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> a
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> b
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>é€šè¿‡æ³›å‹ï¼Œå®ç°äº†ä¸€ä¸ªè·å–å¤§å€¼çš„å‡½æ•°ï¼Œå¦‚æœæ²¡æœ‰æ³›å‹ï¼Œå°±è¦æ‰‹å†™ä¸‰ä¸ªä¸åŒç±»å‹çš„å‡½æ•°ã€‚
åœ¨ä½¿ç”¨æ³›å‹å‡½æ•°çš„æ—¶å€™ï¼Œ&lt;code>fmt.Println(Max[int](1, 2))&lt;/code> å’Œ &lt;code>fmt.Println(Max(1.5, 2.6))&lt;/code> ä¸¤ç§å†™æ³•éƒ½æ˜¯å¯ä»¥çš„ã€‚å¯ä»¥æŒ‡å®šç±»å‹ï¼Œä¹Ÿå¯ä»¥ä¸æŒ‡å®šï¼Œè®©ç¼–è¯‘å™¨è‡ªå·±ç±»å‹æ¨å¯¼&lt;/p>
&lt;p>&lt;code>Max&lt;/code>å‡½æ•°çš„å‚æ•°å¯ä¸æ˜¯ä»»æ„ç±»å‹çš„å‚æ•°éƒ½å¯ä»¥ä¼ å…¥ï¼Œåªèƒ½ä¼ å…¥&lt;code>int&lt;/code> &lt;code>float64&lt;/code> &lt;code>string&lt;/code> è¿™ä¸‰ç§ç±»å‹ï¼Œå› ä¸ºå®šä¹‰å‡½æ•°çš„æ—¶å€™ï¼Œç±»å‹å‚æ•°å°±åªæœ‰è¿™ä¸‰ç§ã€‚æ³›å‹ä¸æ˜¯ä»»æ„ç±»å‹çš„ï¼Œä¹Ÿæ˜¯æœ‰ç±»å‹çš„ï¼Œè¿™å°±æ˜¯æ³›å‹çš„ç±»å‹çº¦æŸ&lt;/p>
&lt;h2 id="æ³›å‹çº¦æŸ">&lt;a href="#%e6%b3%9b%e5%9e%8b%e7%ba%a6%e6%9d%9f" class="header-anchor">&lt;/a>æ³›å‹çº¦æŸ
&lt;/h2>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> &lt;span style="color:#50fa7b">main&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span> x &lt;span style="color:#ff79c6">:=&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">uint32&lt;/span>(&lt;span style="color:#bd93f9">10&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span> y &lt;span style="color:#ff79c6">:=&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">uint32&lt;/span>(&lt;span style="color:#bd93f9">20&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span> fmt.&lt;span style="color:#50fa7b">Println&lt;/span>(&lt;span style="color:#50fa7b">Max&lt;/span>(x, y))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> Max[T &lt;span style="color:#8be9fd">int&lt;/span> | &lt;span style="color:#8be9fd">float64&lt;/span> | &lt;span style="color:#8be9fd">string&lt;/span>](a, b T) T {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> a &amp;gt; b {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> a
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> b
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä¸Šé¢è¿™æ®µä»£ç æ˜¯æ— æ³•é€šè¿‡ç¼–è¯‘çš„ï¼Œä¼šæœ‰å¦‚ä¸‹çš„æŠ¥é”™ &lt;code> uint32 does not implement int|float64|string&lt;/code>
å› ä¸º &lt;code>Max&lt;/code> åªå…è®¸ &lt;code>int float64 string&lt;/code> è¿™ä¸‰ç§&lt;/p>
&lt;p>è¿˜æœ‰ä¸€ç§æƒ…å†µæ˜¯æ— æ³•é€šè¿‡ç¼–è¯‘çš„&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">type&lt;/span> Myint &lt;span style="color:#8be9fd">int&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> &lt;span style="color:#50fa7b">main&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span> x &lt;span style="color:#ff79c6">:=&lt;/span> &lt;span style="color:#50fa7b">Myint&lt;/span> (&lt;span style="color:#bd93f9">10&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span> y &lt;span style="color:#ff79c6">:=&lt;/span> &lt;span style="color:#50fa7b">Myint&lt;/span> (&lt;span style="color:#bd93f9">20&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span> fmt.&lt;span style="color:#50fa7b">Println&lt;/span>(&lt;span style="color:#50fa7b">Max&lt;/span>(x, y))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> Max[T &lt;span style="color:#8be9fd">int&lt;/span> | &lt;span style="color:#8be9fd">float64&lt;/span> | &lt;span style="color:#8be9fd">string&lt;/span>](a, b T) T {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> a &amp;gt; b {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> a
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> b
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™ä¸ªä¹Ÿæ˜¯æ— æ³•é€šè¿‡ç¼–è¯‘çš„ï¼Œè™½ç„¶ &lt;code>Myint&lt;/code> æ˜¯ &lt;code>int&lt;/code> ç±»å‹çš„ï¼Œä½†æ˜¯ä¾ç„¶æ— æ³•é€šè¿‡ç¼–è¯‘ã€‚è¿™ç§æƒ…å†µæ˜¯å¯ä»¥åœ¨å®šä¹‰æ—¶ï¼Œä¿®æ”¹ä¸€ä¸‹å°±è¡Œäº†&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">type&lt;/span> Myint &lt;span style="color:#8be9fd">int&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> &lt;span style="color:#50fa7b">main&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span> x &lt;span style="color:#ff79c6">:=&lt;/span> &lt;span style="color:#50fa7b">Myint&lt;/span> (&lt;span style="color:#bd93f9">10&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span> y &lt;span style="color:#ff79c6">:=&lt;/span> &lt;span style="color:#50fa7b">Myint&lt;/span> (&lt;span style="color:#bd93f9">20&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span> fmt.&lt;span style="color:#50fa7b">Println&lt;/span>(&lt;span style="color:#50fa7b">Max&lt;/span>(x, y))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> Max[T ~&lt;span style="color:#8be9fd">int&lt;/span> | ~&lt;span style="color:#8be9fd">float64&lt;/span> | ~&lt;span style="color:#8be9fd">string&lt;/span>](a, b T) T {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> a &amp;gt; b {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> a
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> b
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>åœ¨å®šä¹‰å‡½æ•°æ—¶ï¼Œåªè¦åœ¨ç±»å‹å‰åŠ ä¸Š &lt;code>~&lt;/code> å°±å¯ä»¥äº†ã€‚&lt;/p>
&lt;p>æ¯æ¬¡åœ¨å®šä¹‰æ³›å‹çº¦æŸæ—¶ï¼Œéƒ½è¦å†™ä¸€å †ç±»å‹å¥½éº»çƒ¦å•Šï¼Œgo å®˜æ–¹ä¹Ÿæƒ³åˆ°äº†ï¼Œå°±æ˜¯å®šä¹‰çº¦æŸç±»å‹&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">type&lt;/span> MyGenerics &lt;span style="color:#8be9fd;font-style:italic">interface&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span> ~&lt;span style="color:#8be9fd">int&lt;/span> | ~&lt;span style="color:#8be9fd">float64&lt;/span> | ~&lt;span style="color:#8be9fd">string&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> Max[T MyGenerics](a, b T) T {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> a &amp;gt; b {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> a
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> b
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™æ ·å°±å®Œæˆäº†ä¸€ä¸ªæ³›å‹çš„çº¦æŸç±»å‹çš„å®šä¹‰&lt;/p>
&lt;p>è€Œä¸”goçš„æ³›å‹çº¦æŸä¹Ÿå¯ä»¥åƒ interface é‚£æ ·ç›¸äº’åµŒå¥—çš„&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">type&lt;/span> Int &lt;span style="color:#8be9fd;font-style:italic">interface&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span> ~&lt;span style="color:#8be9fd">int&lt;/span> | ~&lt;span style="color:#8be9fd">uint&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">type&lt;/span> Float &lt;span style="color:#8be9fd;font-style:italic">interface&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span> ~&lt;span style="color:#8be9fd">float32&lt;/span> | ~&lt;span style="color:#8be9fd">float64&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">type&lt;/span> Number &lt;span style="color:#8be9fd;font-style:italic">interface&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span> Int | Float
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> Max2[T Number](a, b T) T {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> a &amp;gt; b {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> a
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> b
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Goå†…ç½®ä¸€ä¸ª &lt;code>constraints&lt;/code>åŒ…ï¼Œå®šä¹‰å¥½äº†ä¸€äº›å¸¸ç”¨çš„æ³›å‹çº¦æŸ&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">type&lt;/span> Signed &lt;span style="color:#8be9fd;font-style:italic">interface&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span> ~&lt;span style="color:#8be9fd">int&lt;/span> | ~&lt;span style="color:#8be9fd">int8&lt;/span> | ~&lt;span style="color:#8be9fd">int16&lt;/span> | ~&lt;span style="color:#8be9fd">int32&lt;/span> | ~&lt;span style="color:#8be9fd">int64&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">type&lt;/span> Unsigned &lt;span style="color:#8be9fd;font-style:italic">interface&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span> ~&lt;span style="color:#8be9fd">uint&lt;/span> | ~&lt;span style="color:#8be9fd">uint8&lt;/span> | ~&lt;span style="color:#8be9fd">uint16&lt;/span> | ~&lt;span style="color:#8be9fd">uint32&lt;/span> | ~&lt;span style="color:#8be9fd">uint64&lt;/span> | ~&lt;span style="color:#8be9fd">uintptr&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">type&lt;/span> Integer &lt;span style="color:#8be9fd;font-style:italic">interface&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span> Signed | Unsigned
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">type&lt;/span> Float &lt;span style="color:#8be9fd;font-style:italic">interface&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span> ~&lt;span style="color:#8be9fd">float32&lt;/span> | ~&lt;span style="color:#8be9fd">float64&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">type&lt;/span> Complex &lt;span style="color:#8be9fd;font-style:italic">interface&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18&lt;/span>&lt;span> ~&lt;span style="color:#8be9fd">complex64&lt;/span> | ~&lt;span style="color:#8be9fd">complex128&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">type&lt;/span> Ordered &lt;span style="color:#8be9fd;font-style:italic">interface&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22&lt;/span>&lt;span> Integer | Float | ~&lt;span style="color:#8be9fd">string&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>go è¿˜å®šä¹‰äº†ä¸€ä¸ª ç±»å‹çº¦æŸ &lt;code>any&lt;/code> çœ‹è¿™ä¸ªåå­—åº”è¯¥å°±çŸ¥é“ä»€ä¹ˆæ„æ€äº†ï¼Œå°±æ˜¯ä»»æ„ç±»å‹ï¼Œè¿™ä¸ªä¹Ÿæ²¡å•¥ç¥ç§˜çš„ï¼Œå°±æ˜¯ç»™ &lt;code>interface&lt;/code> æ•´äº†ä¸€ä¸ªåˆ«å&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">type&lt;/span> any &lt;span style="color:#8be9fd;font-style:italic">interface&lt;/span>{}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>go è¿˜æœ‰ä¸€ç§çº¦æŸç±»å‹ï¼Œ&lt;strong>å‡½æ•°ç±»å‹çº¦æŸ&lt;/strong>ï¼Œä¹Ÿå°±æ˜¯åªæœ‰å®ç°äº† å¯¹åº”å‡½æ•°ï¼Œæ‰èƒ½ä½œä¸ºæ³›å‹ç±»å‹&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">type&lt;/span> MyToString &lt;span style="color:#8be9fd;font-style:italic">interface&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span> &lt;span style="color:#50fa7b">ToString&lt;/span>() &lt;span style="color:#8be9fd">string&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">type&lt;/span> Myint &lt;span style="color:#8be9fd">int&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> (m Myint) &lt;span style="color:#50fa7b">ToString&lt;/span>() &lt;span style="color:#8be9fd">string&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> strconv.&lt;span style="color:#50fa7b">Itoa&lt;/span>(&lt;span style="color:#8be9fd;font-style:italic">int&lt;/span>(m))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> MyString[T MyToString](value T) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span> fmt.&lt;span style="color:#50fa7b">Println&lt;/span>(value.&lt;span style="color:#50fa7b">ToString&lt;/span>())
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> &lt;span style="color:#50fa7b">main&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16&lt;/span>&lt;span> &lt;span style="color:#8be9fd;font-style:italic">var&lt;/span> x Myint
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17&lt;/span>&lt;span> x = &lt;span style="color:#bd93f9">100&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18&lt;/span>&lt;span> MyString[Myint](x)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>åœ¨å®šä¹‰å‡½æ•° &lt;code>MyString&lt;/code> å‡½æ•°çš„æ—¶å€™ï¼Œ&lt;code>MyString[T MyToString](value T) &lt;/code> å‡½æ•°çš„æ³›å‹çº¦æŸæ—¶ä¸€ä¸ªæ¥å£ï¼Œå‡½æ•° &lt;code>MyString&lt;/code> çš„ç±»å‹çº¦æŸå°±æ˜¯ å®ç°äº† &lt;code>MyToString &lt;/code> æ¥å£çš„ç±»å‹ã€‚æ‰€ä»¥ä¼ å…¥å‡½æ•°çš„ &lt;code>T&lt;/code> ç±»å‹çš„ &lt;code>value&lt;/code> ä¸€å®šä¼šæœ‰ &lt;code>ToString&lt;/code> è¿™ä¸ªå‡½æ•°ã€‚&lt;/p>
&lt;h2 id="æ³›å‹ç»“æ„ä½“">&lt;a href="#%e6%b3%9b%e5%9e%8b%e7%bb%93%e6%9e%84%e4%bd%93" class="header-anchor">&lt;/a>æ³›å‹ç»“æ„ä½“
&lt;/h2>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> &lt;span style="color:#50fa7b">main&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span> stack &lt;span style="color:#ff79c6">:=&lt;/span> NewStack[&lt;span style="color:#8be9fd">int&lt;/span>](&lt;span style="color:#bd93f9">10&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span> &lt;span style="color:#ff79c6">for&lt;/span> i &lt;span style="color:#ff79c6">:=&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>; i &amp;lt; &lt;span style="color:#bd93f9">10&lt;/span>; i&lt;span style="color:#ff79c6">++&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span> stack.&lt;span style="color:#50fa7b">Push&lt;/span>(i)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span> &lt;span style="color:#ff79c6">for&lt;/span> i &lt;span style="color:#ff79c6">:=&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>; i &amp;lt; &lt;span style="color:#bd93f9">10&lt;/span>; i&lt;span style="color:#ff79c6">++&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span> fmt.&lt;span style="color:#50fa7b">Printf&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;%d &amp;#34;&lt;/span>, stack.&lt;span style="color:#50fa7b">Pop&lt;/span>())
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> NewStack[T any](size &lt;span style="color:#8be9fd">int&lt;/span>) &lt;span style="color:#ff79c6">*&lt;/span>Stack[T] {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span> stack &lt;span style="color:#ff79c6">:=&lt;/span> &lt;span style="color:#ff79c6">&amp;amp;&lt;/span>Stack[T]{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15&lt;/span>&lt;span> arr: &lt;span style="color:#8be9fd;font-style:italic">make&lt;/span>([]T, size),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17&lt;/span>&lt;span> stack.size = size
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18&lt;/span>&lt;span> stack.index = &lt;span style="color:#ff79c6">-&lt;/span>&lt;span style="color:#bd93f9">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> stack
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">type&lt;/span> Stack[T any] &lt;span style="color:#8be9fd;font-style:italic">struct&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23&lt;/span>&lt;span> arr []T
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24&lt;/span>&lt;span> size &lt;span style="color:#8be9fd">int&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25&lt;/span>&lt;span> index &lt;span style="color:#8be9fd">int&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> (s &lt;span style="color:#ff79c6">*&lt;/span>Stack[T]) &lt;span style="color:#50fa7b">Full&lt;/span>() &lt;span style="color:#8be9fd">bool&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> s.index&lt;span style="color:#ff79c6">+&lt;/span>&lt;span style="color:#bd93f9">1&lt;/span> &lt;span style="color:#ff79c6">==&lt;/span> s.size
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> (s &lt;span style="color:#ff79c6">*&lt;/span>Stack[T]) &lt;span style="color:#50fa7b">Empty&lt;/span>() &lt;span style="color:#8be9fd">bool&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> s.index &amp;lt; &lt;span style="color:#bd93f9">0&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> (s &lt;span style="color:#ff79c6">*&lt;/span>Stack[T]) &lt;span style="color:#50fa7b">Push&lt;/span>(v T) &lt;span style="color:#8be9fd">bool&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> s.&lt;span style="color:#50fa7b">Full&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> &lt;span style="color:#ff79c6">false&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40&lt;/span>&lt;span> s.index&lt;span style="color:#ff79c6">++&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41&lt;/span>&lt;span> s.arr[s.index] = v
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> &lt;span style="color:#ff79c6">true&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> (s &lt;span style="color:#ff79c6">*&lt;/span>Stack[T]) &lt;span style="color:#50fa7b">Pop&lt;/span>() T {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46&lt;/span>&lt;span> &lt;span style="color:#8be9fd;font-style:italic">var&lt;/span> v T
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> s.&lt;span style="color:#50fa7b">Empty&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> v
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50&lt;/span>&lt;span> v = s.arr[s.index]
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">51&lt;/span>&lt;span> s.index&lt;span style="color:#ff79c6">--&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">52&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> v
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">53&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ç”¨æ³›å‹å†™äº†ä¸€ä¸ªç®€å•çš„æ ˆ&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">type&lt;/span> Stack[T any] &lt;span style="color:#8be9fd;font-style:italic">struct&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span> arr []T
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3&lt;/span>&lt;span> size &lt;span style="color:#8be9fd">int&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4&lt;/span>&lt;span> index &lt;span style="color:#8be9fd">int&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>åœ¨å®šä¹‰ç»“æ„ä½“çš„åŒæ—¶æŒ‡å®šäº†æ³›å‹ç±»å‹ï¼Œè¿™æ ·å°±å®šä¹‰äº†æ³›å‹çš„ç»“æ„ä½“&lt;/p>
&lt;p>ç›®å‰ç»“æ„ä½“çš„æ³›å‹è¿˜æ˜¯æœ‰ä¸€äº›é™åˆ¶ï¼Œæ¯”å¦‚ç»“æ„çš„ &lt;code>method&lt;/code> ä¸èƒ½æ˜¯æ³›å‹çš„&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">type&lt;/span> Mystruct &lt;span style="color:#8be9fd;font-style:italic">struct&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> (m Mystruct) One[T ~&lt;span style="color:#8be9fd">int&lt;/span> | ~&lt;span style="color:#8be9fd">float64&lt;/span>](value T) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5&lt;/span>&lt;span> fmt.&lt;span style="color:#50fa7b">Println&lt;/span>(value)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™æ®µä»£ç æ˜¯ç¼–è¯‘ä¸è¿‡çš„ï¼Œåç»­å¯èƒ½ä¼šå®Œå–„è¿™éƒ¨åˆ†å§&lt;/p>
&lt;h2 id="end">&lt;a href="#end" class="header-anchor">&lt;/a>end
&lt;/h2>&lt;p>goçš„æ³›å‹æ€»ç®—æ˜¯æ­£å¼å‘å¸ƒäº†ï¼Œè¶å‘¨æœ«å­¦ä¹ äº†ä¸€æ³¢ã€‚ç°åœ¨goæ³›å‹åˆšå‘å¸ƒï¼Œå·¥ä½œä¸­ç”¨ä¸Šæ³›å‹å¯èƒ½è¿˜è¦ç­‰å¾ˆé•¿æ—¶é—´ï¼Œæ¯•ç«Ÿçº¿ä¸Šçš„ä¸œè¥¿ç¨³å®šæœ€é‡è¦ã€‚æˆ‘è®°å¾—æˆ‘åˆšå…¥èŒå…¬å¸çš„æ—¶å€™ï¼Œé‚£æ—¶å€™å…¬å¸ç”¨çš„goç‰ˆæœ¬è¿˜æ˜¯ 1.4ï¼Œ é‚£æ—¶å€™go å·²ç»åˆ°äº† 1.13äº†ã€‚åæ¥å› ä¸ºdlvè°ƒè¯•ä¸å…¼å®¹ä½ç‰ˆæœ¬çš„goï¼Œå°±é€æ­¥å‡ä¸Šæ¥äº†ã€‚ç›¸ä¿¡goçš„æ³›å‹è‚¯å®šæ˜¯ä¸€ä¸ªè¶‹åŠ¿ï¼Œåç»­å¾ˆå¤šçš„å†…ç½®é…·å’Œç¬¬ä¸‰æ–¹åº“éƒ½ä¼šç”¨ä¸Šæ³›å‹äº†ã€‚
å…ˆå­¦åˆ°è¿™é‡Œå§ï¼Œç­‰æœ‰ç©ºç»§ç»­å­¦ä¹ goæ³›å‹çš„æ›´å¤šçŸ¥è¯†ï¼Œæ¯”å¦‚åº•å±‚æ˜¯æ€æ ·å®ç°çš„ï¼Œæ˜¯javaé‚£æ ·ç±»å‹æ“¦é™¤è¿˜æ˜¯C++é‚£æ ·ä»£ç å±•å¼€çš„ã€‚&lt;/p></description></item><item><title>go ä½¿ç”¨ epoll å®ç°é«˜æ€§èƒ½tcpæœåŠ¡å™¨</title><link>https://lqxhub.github.io/posts/a59127c5/</link><pubDate>Sun, 13 Feb 2022 15:17:44 +0000</pubDate><guid>https://lqxhub.github.io/posts/a59127c5/</guid><description>&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/c03de538924642947b1683e7e8f4ba121339581a.jpg" alt="Featured image of post go ä½¿ç”¨ epoll å®ç°é«˜æ€§èƒ½tcpæœåŠ¡å™¨" />&lt;p>åœ¨goä¸­å®ç°ä¸€ä¸ªtcpæœåŠ¡å™¨è¿˜æ˜¯å¾ˆç®€å•çš„ï¼Œè‡³å°‘å’ŒC/C++ç›¸æ¯”è¿˜æ˜¯å¾ˆç®€å•çš„äº†ã€‚&lt;/p>
&lt;p>ä¸€ä¸ªç®€å•çš„ä¾‹å­&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span> listen, err &lt;span style="color:#ff79c6">:=&lt;/span> net.&lt;span style="color:#50fa7b">Listen&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;tcp&amp;#34;&lt;/span>, &lt;span style="color:#f1fa8c">&amp;#34;0.0.0.0:8088&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>åªéœ€è¦è¿™æ ·ä¸€è¡Œå°±å¯ä»¥ç›‘å¬äº†ï¼Œå°±èƒ½ç­‰å¾…å®¢æˆ·ç«¯è¿æ¥äº†ã€‚æ˜¯ä¸æ˜¯è¿˜æ˜¯å¾ˆç®€å•çš„&lt;/p>
&lt;p>åœ¨C/C++ä¸­ï¼Œéœ€è¦ä¾æ¬¡ è°ƒç”¨&lt;code>socket()&lt;/code> &lt;code>bind()&lt;/code> &lt;code>listen()&lt;/code> &lt;code>accept()&lt;/code>å‡½æ•°ï¼Œå®Œæˆæ‰“å¼€ï¼Œç»‘å®šï¼Œç›‘å¬ï¼Œç­‰å¾…æ“ä½œï¼Œæ‰èƒ½å®Œæˆç­‰å¾…å®¢æˆ·ç«¯æ¥è¿æ¥ã€‚
è¿™è¿˜æ²¡å®Œï¼Œæƒ³è¦æé«˜æ€§èƒ½è¿˜éœ€è¦è‡ªå·±é€šè¿‡ &lt;code>epoll&lt;/code>ç­‰æ‰‹æ®µå®Œæˆå¤šè·¯å¤ç”¨ã€‚&lt;/p>
&lt;p>å…¶å®åœ¨C/C++ä¸­æ˜¯é€šè¿‡è°ƒç”¨ç³»ç»Ÿå‡½æ•°æ¥å®Œæˆçš„ï¼Œåªæ˜¯goæŠŠè¿™éƒ¨åˆ†ä¸œè¥¿éƒ½ç»™åŒ…è£…äº†ï¼Œåªéœ€è¦ç®€å•çš„ä¸€è¡Œå°±å¯ä»¥å®Œæˆäº†ã€‚&lt;/p>
&lt;p>å…¶å®åœ¨goä¸­ä¹Ÿå¯ä»¥é€šè¿‡ç³»ç»Ÿå‡½æ•°è‡ªå·±æ¥å®Œæˆäº›äº‹æƒ…ã€‚åªæ˜¯è¿™äº›äº‹æƒ…æ¯”è¾ƒå¤æ‚ï¼Œè·¨å¹³å°è¿˜ä¸å¥½å¼„ï¼Œåƒä½¿ç”¨äº†&lt;code>epoll&lt;/code>å°±åªèƒ½åœ¨linuxç³»ç»Ÿä¸Šç¼–è¯‘è¿è¡Œäº†ã€‚&lt;/p>
&lt;p>åºŸè¯ä¸å¤šè¯´äº†ï¼Œç›´æ¥ä¸Šå‡½æ•°å§ã€‚åœ¨goä¸­å’ŒC/C++ä¸­åŒºåˆ«ä¸å¤§ï¼ŒåŒæ ·æ˜¯é€šè¿‡ç³»ç»Ÿè°ƒç”¨è¿™äº›å‡½æ•°æ¥å®Œæˆã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> &lt;span style="color:#50fa7b">Socket&lt;/span>(domain, typ, proto &lt;span style="color:#8be9fd">int&lt;/span>) (fd &lt;span style="color:#8be9fd">int&lt;/span>, err &lt;span style="color:#8be9fd">error&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> &lt;span style="color:#50fa7b">Bind&lt;/span>(fd &lt;span style="color:#8be9fd">int&lt;/span>, sa Sockaddr) (err &lt;span style="color:#8be9fd">error&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> &lt;span style="color:#50fa7b">Listen&lt;/span>(s &lt;span style="color:#8be9fd">int&lt;/span>, n &lt;span style="color:#8be9fd">int&lt;/span>) (err &lt;span style="color:#8be9fd">error&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> &lt;span style="color:#50fa7b">Accept&lt;/span>(fd &lt;span style="color:#8be9fd">int&lt;/span>) (nfd &lt;span style="color:#8be9fd">int&lt;/span>, sa Sockaddr, err &lt;span style="color:#8be9fd">error&lt;/span>)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>åœ¨goå¼€å¯tcp æœåŠ¡éœ€è¦ç”¨åˆ°çš„å‡½æ•°.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> &lt;span style="color:#50fa7b">EpollCreate&lt;/span>(size &lt;span style="color:#8be9fd">int&lt;/span>) (fd &lt;span style="color:#8be9fd">int&lt;/span>, err &lt;span style="color:#8be9fd">error&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> &lt;span style="color:#50fa7b">EpollCtl&lt;/span>(epfd &lt;span style="color:#8be9fd">int&lt;/span>, op &lt;span style="color:#8be9fd">int&lt;/span>, fd &lt;span style="color:#8be9fd">int&lt;/span>, event &lt;span style="color:#ff79c6">*&lt;/span>EpollEvent) (err &lt;span style="color:#8be9fd">error&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> &lt;span style="color:#50fa7b">EpollWait&lt;/span>(epfd &lt;span style="color:#8be9fd">int&lt;/span>, events []EpollEvent, msec &lt;span style="color:#8be9fd">int&lt;/span>) (n &lt;span style="color:#8be9fd">int&lt;/span>, err &lt;span style="color:#8be9fd">error&lt;/span>)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>åœ¨goä¸­ä½¿ç”¨epolléœ€è¦çš„å‡½æ•°&lt;/p>
&lt;p>è¿™äº›å‡½æ•°éƒ½æ˜¯åœ¨&lt;code>syscall&lt;/code> åŒ…ä¸‹ï¼Œæ‰€ä»¥è¿™äº›å‡½æ•°ä¸æ˜¯æ‰€æœ‰ç³»ç»Ÿä¸‹éƒ½æœ‰çš„ï¼Œ
åƒ&lt;code>epoll&lt;/code> ç›¸å…³çš„å‡½æ•°ï¼Œå°±åªèƒ½åœ¨linuxä¸‹æ‰èƒ½ç¼–è¯‘è¿‡ã€‚&lt;/p>
&lt;p>æ‰€ä»¥ï¼Œåœ¨è¿™é‡Œå°±å¼•ç”³å‡ºä¸€ä¸ªä¸œè¥¿å°±æ˜¯ &lt;strong>æ¡ä»¶ç¼–è¯‘&lt;/strong>
åœ¨C/C++ä¸­å¯ä»¥é€šè¿‡å®å®šä¹‰æ¥å®ç°æ¡ä»¶ç¼–è¯‘&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-C++" data-lang="C++">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span> &lt;span style="color:#ff79c6">#ifdef linux
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span>&lt;span style="color:#ff79c6">&lt;/span> cout&lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;It is in Linux OS!&amp;#34;&lt;/span>&lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span>endl;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3&lt;/span>&lt;span> &lt;span style="color:#ff79c6">#endif
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™æ®µä»£ç å°±åªèƒ½åœ¨linuxç³»ç»Ÿä¸Šæ‰ä¼šè¢«ç¼–è¯‘&lt;/p>
&lt;p>goè™½ç„¶æ²¡æœ‰è¿™ä¹ˆå¼ºå¤§çš„å®å‘½ä»¤æ¥åˆ¤æ–­ï¼Œä½†æ˜¯goä¸­å¯ä»¥é€šè¿‡&lt;strong>ç¼–è¯‘æ ‡ç­¾&lt;/strong> å’Œ &lt;strong>æ–‡ä»¶åç¼€&lt;/strong>æ¥åˆ¤æ–­ã€‚&lt;/p>
&lt;p>æ¯”å¦‚åœ¨æ–‡ä»¶çš„ç¬¬ä¸€è¡ŒåŠ ä¸Š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>&lt;span style="color:#6272a4">// +build linux
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span>&lt;span style="color:#ff79c6">...&lt;/span>..
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3&lt;/span>&lt;span>&lt;span style="color:#ff79c6">...&lt;/span>..
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™æ ·ï¼Œè¿™ä¸ªæ–‡ä»¶å°±åªèƒ½åœ¨linuxä¸Šæ‰ä¼šè¢«ç¼–è¯‘ï¼ˆæ³¨æ„ï¼Œ// +build linuxä¸‹é¢ä¸€å®šè¦æœ‰ä¸€ä¸ªç©ºè¡Œï¼‰
è¯¦ç»†ç”¨æ³•çœ‹è¿™é‡Œ &lt;a class="link" href="https://zsy-cn.github.io/%E6%9D%A1%E4%BB%B6%E7%BC%96%E8%AF%91.html" target="_blank" rel="noopener"
>goæ¡ä»¶ç¼–è¯‘&lt;/a>&lt;/p>
&lt;p>ä¸‹é¢å¼€å§‹å…·ä½“çš„ä»£ç &lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#6272a4">//å®šä¹‰ä¸€ä¸ªç»“æ„ä½“å­˜å‚¨ç›¸å…³çš„æ•°æ®
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span>&lt;span style="color:#8be9fd;font-style:italic">type&lt;/span> EpollM &lt;span style="color:#8be9fd;font-style:italic">struct&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span> conn &lt;span style="color:#8be9fd;font-style:italic">map&lt;/span>[&lt;span style="color:#8be9fd">int&lt;/span>]&lt;span style="color:#ff79c6">*&lt;/span>ServerConn
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span> socketFd &lt;span style="color:#8be9fd">int&lt;/span> &lt;span style="color:#6272a4">//ç›‘å¬socketçš„fd
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> epollFd &lt;span style="color:#8be9fd">int&lt;/span> &lt;span style="color:#6272a4">//epollçš„fd
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span>&lt;span style="color:#6272a4">//å¼€å¯ç›‘å¬
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> (e &lt;span style="color:#ff79c6">*&lt;/span>EpollM) &lt;span style="color:#50fa7b">Listen&lt;/span>(ipAddr &lt;span style="color:#8be9fd">string&lt;/span>, port &lt;span style="color:#8be9fd">int&lt;/span>) &lt;span style="color:#8be9fd">error&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span> &lt;span style="color:#6272a4">//ä½¿ç”¨ç³»ç»Ÿè°ƒç”¨,æ‰“å¼€ä¸€ä¸ªsocket
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> fd, err &lt;span style="color:#ff79c6">:=&lt;/span> syscall.&lt;span style="color:#50fa7b">Socket&lt;/span>(syscall.AF_INET, syscall.SOCK_STREAM, syscall.IPPROTO_TCP)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> err &lt;span style="color:#ff79c6">!=&lt;/span> &lt;span style="color:#ff79c6">nil&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> err
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17&lt;/span>&lt;span> &lt;span style="color:#6272a4">//ipåœ°å€è½¬æ¢
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">var&lt;/span> addr [&lt;span style="color:#bd93f9">4&lt;/span>]&lt;span style="color:#8be9fd">byte&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19&lt;/span>&lt;span> &lt;span style="color:#8be9fd;font-style:italic">copy&lt;/span>(addr[:], net.&lt;span style="color:#50fa7b">ParseIP&lt;/span>(ipAddr).&lt;span style="color:#50fa7b">To4&lt;/span>())
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20&lt;/span>&lt;span> net.&lt;span style="color:#50fa7b">ParseIP&lt;/span>(ipAddr).&lt;span style="color:#50fa7b">To4&lt;/span>()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21&lt;/span>&lt;span> err = syscall.&lt;span style="color:#50fa7b">Bind&lt;/span>(fd, &lt;span style="color:#ff79c6">&amp;amp;&lt;/span>syscall.SockaddrInet4{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22&lt;/span>&lt;span> Port: port,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23&lt;/span>&lt;span> Addr: addr,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24&lt;/span>&lt;span> })
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> err &lt;span style="color:#ff79c6">!=&lt;/span> &lt;span style="color:#ff79c6">nil&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> err
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29&lt;/span>&lt;span> &lt;span style="color:#6272a4">//å¼€å¯ç›‘å¬
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> err = syscall.&lt;span style="color:#50fa7b">Listen&lt;/span>(fd, &lt;span style="color:#bd93f9">10&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> err &lt;span style="color:#ff79c6">!=&lt;/span> &lt;span style="color:#ff79c6">nil&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> err
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34&lt;/span>&lt;span> e.socketFd = fd
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> &lt;span style="color:#ff79c6">nil&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™æ ·å°±å®Œæˆäº†ç›‘å¬&lt;/p>
&lt;p>ä¸‹é¢æ˜¯ &lt;strong>epoll&lt;/strong> å¤„ç†éƒ¨åˆ†&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span>&lt;span style="color:#6272a4">//å¤„ç†epoll
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> (e &lt;span style="color:#ff79c6">*&lt;/span>EpollM) &lt;span style="color:#50fa7b">HandlerEpoll&lt;/span>() &lt;span style="color:#8be9fd">error&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span> events &lt;span style="color:#ff79c6">:=&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">make&lt;/span>([]syscall.EpollEvent, &lt;span style="color:#bd93f9">100&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span> &lt;span style="color:#6272a4">//åœ¨æ­»å¾ªç¯ä¸­å¤„ç†epoll
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">for&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span> &lt;span style="color:#6272a4">//msec -1,ä¼šä¸€ç›´é˜»å¡,ç›´åˆ°æœ‰äº‹ä»¶å¯ä»¥å¤„ç†æ‰ä¼šè¿”å›, n äº‹ä»¶ä¸ªæ•°
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> n, err &lt;span style="color:#ff79c6">:=&lt;/span> syscall.&lt;span style="color:#50fa7b">EpollWait&lt;/span>(e.epollFd, events, &lt;span style="color:#ff79c6">-&lt;/span>&lt;span style="color:#bd93f9">1&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> err &lt;span style="color:#ff79c6">!=&lt;/span> &lt;span style="color:#ff79c6">nil&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> err
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span> &lt;span style="color:#ff79c6">for&lt;/span> i &lt;span style="color:#ff79c6">:=&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>; i &amp;lt; n; i&lt;span style="color:#ff79c6">++&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span> &lt;span style="color:#6272a4">//å…ˆåœ¨mapä¸­æ˜¯å¦æœ‰è¿™ä¸ªé“¾æ¥
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> conn &lt;span style="color:#ff79c6">:=&lt;/span> e.&lt;span style="color:#50fa7b">GetConn&lt;/span>(&lt;span style="color:#8be9fd;font-style:italic">int&lt;/span>(events[i].Fd))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> conn &lt;span style="color:#ff79c6">==&lt;/span> &lt;span style="color:#ff79c6">nil&lt;/span> { &lt;span style="color:#6272a4">//æ²¡æœ‰è¿™ä¸ªé“¾æ¥,å¿½ç•¥
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">continue&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> events[i].Events&lt;span style="color:#ff79c6">&amp;amp;&lt;/span>syscall.EPOLLHUP &lt;span style="color:#ff79c6">==&lt;/span> syscall.EPOLLHUP &lt;span style="color:#ff79c6">||&lt;/span> events[i].Events&lt;span style="color:#ff79c6">&amp;amp;&lt;/span>syscall.EPOLLERR &lt;span style="color:#ff79c6">==&lt;/span> syscall.EPOLLERR {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20&lt;/span>&lt;span> &lt;span style="color:#6272a4">//æ–­å¼€||å‡ºé”™
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">if&lt;/span> err &lt;span style="color:#ff79c6">:=&lt;/span> e.&lt;span style="color:#50fa7b">CloseConn&lt;/span>(&lt;span style="color:#8be9fd;font-style:italic">int&lt;/span>(events[i].Fd)); err &lt;span style="color:#ff79c6">!=&lt;/span> &lt;span style="color:#ff79c6">nil&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> err
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24&lt;/span>&lt;span> } &lt;span style="color:#ff79c6">else&lt;/span> &lt;span style="color:#ff79c6">if&lt;/span> events[i].Events &lt;span style="color:#ff79c6">==&lt;/span> syscall.EPOLLIN {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25&lt;/span>&lt;span> &lt;span style="color:#6272a4">//å¯è¯»äº‹ä»¶
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> conn.&lt;span style="color:#50fa7b">Read&lt;/span>()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä»è¿æ¥ä¸­è¯»å†™æ•°æ®&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#6272a4">//è¯»å–æ•°æ®
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> (s &lt;span style="color:#ff79c6">*&lt;/span>ServerConn) &lt;span style="color:#50fa7b">Read&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span> data &lt;span style="color:#ff79c6">:=&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">make&lt;/span>([]&lt;span style="color:#8be9fd">byte&lt;/span>, &lt;span style="color:#bd93f9">100&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span> &lt;span style="color:#6272a4">//é€šè¿‡ç³»ç»Ÿè°ƒç”¨,è¯»å–æ•°æ®,næ˜¯è¯»åˆ°çš„é•¿åº¦
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> n, err &lt;span style="color:#ff79c6">:=&lt;/span> syscall.&lt;span style="color:#50fa7b">Read&lt;/span>(s.fd, data)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> n &lt;span style="color:#ff79c6">==&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> err &lt;span style="color:#ff79c6">!=&lt;/span> &lt;span style="color:#ff79c6">nil&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span> fmt.&lt;span style="color:#50fa7b">Printf&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;fd %d read error:%s\n&amp;#34;&lt;/span>, s.fd, err.&lt;span style="color:#50fa7b">Error&lt;/span>())
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span> } &lt;span style="color:#ff79c6">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span> fmt.&lt;span style="color:#50fa7b">Printf&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;%d say: %s \n&amp;#34;&lt;/span>, s.fd, data[:n])
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span> s.&lt;span style="color:#50fa7b">Write&lt;/span>([]&lt;span style="color:#8be9fd;font-style:italic">byte&lt;/span>(fmt.&lt;span style="color:#50fa7b">Sprintf&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;hello %d&amp;#34;&lt;/span>, s.fd)))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18&lt;/span>&lt;span>&lt;span style="color:#6272a4">//å‘è¿™ä¸ªé“¾æ¥ä¸­å†™æ•°æ®
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> (s &lt;span style="color:#ff79c6">*&lt;/span>ServerConn) &lt;span style="color:#50fa7b">Write&lt;/span>(data []&lt;span style="color:#8be9fd">byte&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20&lt;/span>&lt;span> _, err &lt;span style="color:#ff79c6">:=&lt;/span> syscall.&lt;span style="color:#50fa7b">Write&lt;/span>(s.fd, data)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> err &lt;span style="color:#ff79c6">!=&lt;/span> &lt;span style="color:#ff79c6">nil&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22&lt;/span>&lt;span> fmt.&lt;span style="color:#50fa7b">Printf&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;fd %d write error:%s\n&amp;#34;&lt;/span>, s.fd, err.&lt;span style="color:#50fa7b">Error&lt;/span>())
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æœ€ååœ¨ä¾æ¬¡è°ƒç”¨è¿™äº›å‡½æ•°&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">package&lt;/span> main
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> &lt;span style="color:#50fa7b">main&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span> epollM &lt;span style="color:#ff79c6">:=&lt;/span> &lt;span style="color:#50fa7b">NewEpollM&lt;/span>()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span> &lt;span style="color:#6272a4">//å¼€å¯ç›‘å¬
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> err &lt;span style="color:#ff79c6">:=&lt;/span> epollM.&lt;span style="color:#50fa7b">Listen&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;0.0.0.0&amp;#34;&lt;/span>, &lt;span style="color:#bd93f9">8088&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> err &lt;span style="color:#ff79c6">!=&lt;/span> &lt;span style="color:#ff79c6">nil&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span> &lt;span style="color:#8be9fd;font-style:italic">panic&lt;/span>(err)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span> &lt;span style="color:#6272a4">//åˆ›å»ºepoll
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> err = epollM.&lt;span style="color:#50fa7b">CreateEpoll&lt;/span>()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> err &lt;span style="color:#ff79c6">!=&lt;/span> &lt;span style="color:#ff79c6">nil&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span> &lt;span style="color:#8be9fd;font-style:italic">panic&lt;/span>(err)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17&lt;/span>&lt;span> &lt;span style="color:#6272a4">//å¼‚æ­¥å¤„ç†epoll
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">go&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">func&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19&lt;/span>&lt;span> err &lt;span style="color:#ff79c6">:=&lt;/span> epollM.&lt;span style="color:#50fa7b">HandlerEpoll&lt;/span>()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20&lt;/span>&lt;span> epollM.&lt;span style="color:#50fa7b">Close&lt;/span>()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21&lt;/span>&lt;span> &lt;span style="color:#8be9fd;font-style:italic">panic&lt;/span>(err)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22&lt;/span>&lt;span> }()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24&lt;/span>&lt;span> &lt;span style="color:#6272a4">//ç­‰å¾…clientçš„è¿æ¥
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> err = epollM.&lt;span style="color:#50fa7b">Accept&lt;/span>()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26&lt;/span>&lt;span> epollM.&lt;span style="color:#50fa7b">Close&lt;/span>()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27&lt;/span>&lt;span> &lt;span style="color:#8be9fd;font-style:italic">panic&lt;/span>(err)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>åˆ°è¿™æ•´ä¸ªæœåŠ¡å°±è¿è¡Œèµ·æ¥äº†ï¼Œä»£ç å·²ç»ä¸Šä¼ åˆ°githubäº†ï¼Œ&lt;a class="link" href="https://github.com/lqxhub/go_epoll" target="_blank" rel="noopener"
>ä¼ é€é—¨&lt;/a>&lt;/p>
&lt;p>æ•´ä¸ªè¿‡ç¨‹çœ‹ä¸‹æ¥ï¼Œå’ŒC/C++å®ç°è¿‡ç¨‹è¿˜æ˜¯éå¸¸ç›¸ä¼¼çš„ï¼Œéƒ½æ˜¯é€šè¿‡ç³»ç»Ÿè°ƒç”¨å®Œæˆçš„ã€‚ä¹Ÿæ²¡æœ‰ä»€ä¹ˆéš¾ç‚¹ï¼Œå°±è¿™æ ·å§&lt;/p></description></item><item><title>pikaç¼–è¯‘ç¬”è®°</title><link>https://lqxhub.github.io/posts/d9a4c4a4/</link><pubDate>Sat, 12 Feb 2022 14:28:10 +0000</pubDate><guid>https://lqxhub.github.io/posts/d9a4c4a4/</guid><description>&lt;p>&lt;strong>pika&lt;/strong> æ˜¯å•¥æ‡‚å¾—éƒ½æ‡‚ï¼Œå¦‚æœä½ ä¸çŸ¥é“ï¼Œè¿™ç¯‡æ–‡ç« å¯¹ä½ ä¹Ÿæ²¡æœ‰ä»»ä½•å¸®åŠ©&lt;/p>
&lt;p>è¿™ç¯‡æ–‡ç« å·²ç»åŒæ­¥åˆ° pika çš„ githubä¸­&lt;/p>
&lt;p>&lt;a class="link" href="https://github.com/OpenAtomFoundation/pika/issues/1148" target="_blank" rel="noopener"
>pika issue&lt;/a>&lt;/p>
&lt;h3 id="ç¼–è¯‘-pika">&lt;a href="#%e7%bc%96%e8%af%91-pika" class="header-anchor">&lt;/a>ç¼–è¯‘ pika
&lt;/h3>&lt;h2 id="0-å‡†å¤‡">&lt;a href="#0-%e5%87%86%e5%a4%87" class="header-anchor">&lt;/a>0 å‡†å¤‡
&lt;/h2>&lt;p>éœ€è¦è½¯ä»¶ &lt;strong>centos7.x&lt;/strong> &lt;strong>gcc4.8&lt;/strong> &lt;strong>g++4.8&lt;/strong> &lt;strong>git&lt;/strong> &lt;strong>cmake&lt;/strong>
æœ€å¥½ç”¨centos7ç³»åˆ—, åœ¨åˆ«çš„ç³»ç»Ÿä¸­ç¼–è¯‘å¯èƒ½ä¼šæŠ¥é”™, äººç”Ÿè‹¦çŸ­, åˆ«å’Œè‡ªå·±è¿‡ä¸å»&lt;/p>
&lt;p>ä½¿ç”¨make ç¼–è¯‘çš„æ—¶å€™, ä½¿ç”¨ make -jN &lt;em>(N=cpuæ ¸æ•° åŠ å¿«ç¼–è¯‘é€Ÿåº¦)&lt;/em>&lt;/p>
&lt;hr>
&lt;h2 id="1-å®‰è£…å·¥å…·">&lt;a href="#1-%e5%ae%89%e8%a3%85%e5%b7%a5%e5%85%b7" class="header-anchor">&lt;/a>1 å®‰è£…å·¥å…·
&lt;/h2>&lt;ol>
&lt;li>
&lt;p>gcc g++ git ä¸€èˆ¬ç”¨ yum å®‰è£…&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å®‰è£…cmake&lt;/p>
&lt;p>cmake æºç  &lt;a class="link" href="https://cmake.org/download/" target="_blank" rel="noopener"
>https://cmake.org/download/&lt;/a>&lt;/p>
&lt;p>cmakeä¾èµ– openssl-devel å…ˆç”¨yumå®‰è£… openssl-devel
&lt;code>yum install openssl openssl-devel&lt;/code>&lt;/p>
&lt;p>ç¼–è¯‘å®‰è£…cmake&lt;/p>
&lt;p>è§£å‹cmakeæºç &lt;/p>
&lt;p>&lt;code>./bootstrap&lt;/code>&lt;/p>
&lt;p>&lt;code>make &amp;amp;&amp;amp; make install&lt;/code>&lt;/p>
&lt;/li>
&lt;/ol>
&lt;hr>
&lt;h2 id="2-è§£å†³rocksdbä¾èµ–å®‰è£…å¿…å¤‡çš„åº“">&lt;a href="#2-%e8%a7%a3%e5%86%b3rocksdb%e4%be%9d%e8%b5%96%e5%ae%89%e8%a3%85%e5%bf%85%e5%a4%87%e7%9a%84%e5%ba%93" class="header-anchor">&lt;/a>2 è§£å†³rocksdbä¾èµ–,å®‰è£…å¿…å¤‡çš„åº“
&lt;/h2>&lt;h2 id="rocksdb-ä¾èµ–åº“">&lt;a href="#rocksdb-%e4%be%9d%e8%b5%96%e5%ba%93" class="header-anchor">&lt;/a>rocksdb ä¾èµ–åº“
&lt;/h2>&lt;p>snappy gflags zlib bzip2 stdc++ lz4 zstd lzma è¿™äº›åº“éƒ½è¦å®‰è£… ä¸ºäº†èƒ½é™æ€ç¼–è¯‘,è¿™äº›åº“éƒ½è¦å®‰è£…é™æ€åº“&lt;/p>
&lt;ol>
&lt;li>
&lt;p>ç¼–è¯‘snappy&lt;/p>
&lt;p>&lt;code>mkdir build &amp;amp;&amp;amp; cd build&lt;/code>&lt;/p>
&lt;p>ç¼–è¯‘ åŠ¨æ€åº“
&lt;code>cmake -DSNAPPY_BUILD_BENCHMARKS=OFF -DSNAPPY_BUILD_TESTS=OFF -DBUILD_SHARED_LIBS=ON ..&lt;/code>&lt;/p>
&lt;p>&lt;code>make &amp;amp;&amp;amp; make install&lt;/code>&lt;/p>
&lt;p>ç¼–è¯‘ é™æ€åº“
&lt;code>cmake -DSNAPPY_BUILD_BENCHMARKS=OFF -DSNAPPY_BUILD_TESTS=OFF -DBUILD_SHARED_LIBS=OFF ..&lt;/code>&lt;/p>
&lt;p>&lt;code>make &amp;amp;&amp;amp; make install&lt;/code>&lt;/p>
&lt;p>æˆ‘æ²¡æœ‰æ‰¾åˆ°åŒæ—¶ç¼–è¯‘åŠ¨æ€åº“å’Œé™æ€åº“çš„æ–¹æ³•ï¼Œåªèƒ½åˆ†å¼€ç¼–è¯‘äº†&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ç¼–è¯‘gflags&lt;/p>
&lt;p>&lt;code>./configure&lt;/code>&lt;/p>
&lt;p>&lt;code>make &amp;amp;&amp;amp; make install&lt;/code>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ç¼–è¯‘zlib&lt;/p>
&lt;p>&lt;code>./configure&lt;/code>&lt;/p>
&lt;p>&lt;code>make &amp;amp;&amp;amp; make install&lt;/code>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>bzip2 ä¸€èˆ¬linuxéƒ½è‡ªå¸¦, æ²¡æœ‰çš„ç”¨ yum å®‰è£…ä¸€ä¸ª&lt;/p>
&lt;p>&lt;code>yum install bzip2-devel bzip2-libs&lt;/code>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>stdc++ è¿™ä¸ªåº“éœ€è¦å®‰è£…é™æ€åº“,ç›´æ¥ yum å®‰è£…&lt;/p>
&lt;p>&lt;code>yum install libstdc++ libstdc++-devel libstdc++-static&lt;/code>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å®‰è£…lz4&lt;/p>
&lt;p>è§£å‹,è¿›å…¥ æºç ç›®å½•&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-fallback" data-lang="fallback">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>cd build/cmake
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3&lt;/span>&lt;span>mkdir build &amp;amp;&amp;amp; build
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5&lt;/span>&lt;span>cmake -DBUILD_STATIC_LIBS=ON -DLZ4_BUILD_CLI=OFF -DLZ4_BUILD_LEGACY_LZ4C=OFF CMAKE_BUILD_TYPE=Relase -D LZ4_POSITION_INDEPENDENT_LIB=OFF ..
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7&lt;/span>&lt;span>make &amp;amp;&amp;amp; make install
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>å®‰è£… zstd&lt;/p>
&lt;p>è§£å‹æºç &lt;/p>
&lt;p>&lt;code>cd build/cmake/lib&lt;/code>&lt;/p>
&lt;p>&lt;code>make &amp;amp;&amp;amp; make install&lt;/code>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å®‰è£…lzma&lt;/p>
&lt;p>è§£å‹æºç  xzå‹ç¼©åŒ…&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-fallback" data-lang="fallback">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>./configure --disable-xz --disable-xzdec --disable-lzmadec --disable-lzmainfo --disable-lzma-links --disable-scripts --disable-doc
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span>make &amp;amp;&amp;amp; make install
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;/ol>
&lt;p>æœ€å, æ‰€æœ‰çš„åº“éƒ½å®‰è£…å¥½å,æŠŠåº“åŠ åˆ° ld ç›®å½•ä¸­ã€‚å› ä¸ºæœ‰çš„åº“ä¼šå®‰è£…åˆ° &lt;strong>/usr/local/lib64&lt;/strong> ç›®å½•ä¸‹ï¼Œä½†æ˜¯æœ‰çš„ç³»ç»Ÿæ²¡æœ‰æŠŠè¿™ä¸ªç›®å½•åŠ åˆ°åŠ¨æ€åº“æœç´¢ç›®å½•ä¸­,&lt;/p>
&lt;p>è§£å†³åŠæ³•&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">echo&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;/usr/local/lib64&amp;#34;&lt;/span> &amp;gt;&amp;gt; /etc/ld.so.conf.d/usr.local.conf
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">echo&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;/usr/local/lib&amp;#34;&lt;/span> &amp;gt;&amp;gt; /etc/ld.so.conf.d/usr.local.conf
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æ‰§è¡Œ &lt;code>ldconfig&lt;/code>&lt;/p>
&lt;hr>
&lt;h2 id="å®‰è£…-protobuf">&lt;a href="#%e5%ae%89%e8%a3%85-protobuf" class="header-anchor">&lt;/a>å®‰è£… protobuf
&lt;/h2>&lt;p>ç¼–è¯‘ protobuf, ç”¨cmakeç¼–è¯‘ protobuf release åœ°å€ &lt;a class="link" href="https://github.com/protocolbuffers/protobuf/releases" target="_blank" rel="noopener"
>https://github.com/protocolbuffers/protobuf/releases&lt;/a>
ä¸‹è½½ protobuf-cpp-XX.XX.XX.tar.gz&lt;/p>
&lt;p>&lt;em>xx.XX.XX æ˜¯ç‰ˆæœ¬å·&lt;/em>ï¼Œ&lt;strong>éœ€è¦ä¸‹è½½3.Xç‰ˆæœ¬çš„&lt;/strong>&lt;/p>
&lt;p>&lt;code>./configure&lt;/code>&lt;/p>
&lt;p>&lt;code>make &amp;amp;&amp;amp; make install&lt;/code>&lt;/p>
&lt;p>protobuf ä¹Ÿè¦å®‰è£…é™æ€åº“&lt;/p>
&lt;p>åˆ°è¿™ protobuf å®‰è£…å®Œæˆ&lt;/p>
&lt;hr>
&lt;h2 id="3--æ‹‰ä»£ç ">&lt;a href="#3--%e6%8b%89%e4%bb%a3%e7%a0%81" class="header-anchor">&lt;/a>3 æ‹‰ä»£ç 
&lt;/h2>&lt;p>æ‹‰ pika ä»£ç  github &lt;a class="link" href="https://github.com/OpenAtomFoundation/pika" target="_blank" rel="noopener"
>https://github.com/OpenAtomFoundation/pika&lt;/a>
è¿™é‡Œæœ€å¥½é€šè¿‡ä»£ç†å»æ‹‰ä»£ç ,è¦ä¸ç„¶ é€Ÿåº¦æ„Ÿäºº&lt;/p>
&lt;ol>
&lt;li>git è®¾ç½®ä»£ç†&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>git config --global https.proxy http://127.0.0.1:1080
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3&lt;/span>&lt;span>git config --global https.proxy https://127.0.0.1:1080
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5&lt;/span>&lt;span>git config --global --unset http.proxy
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7&lt;/span>&lt;span>git config --global --unset https.proxy
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ol start="2">
&lt;li>æ‹‰å– ä¾èµ–åº“ä»£ç &lt;/li>
&lt;/ol>
&lt;p>cd pika æºç ç›®å½•&lt;/p>
&lt;p>&lt;code>git submodule init&lt;/code>
&lt;code>git submodule update&lt;/code>&lt;/p>
&lt;hr>
&lt;h2 id="4-ç¼–è¯‘">&lt;a href="#4-%e7%bc%96%e8%af%91" class="header-anchor">&lt;/a>4 ç¼–è¯‘
&lt;/h2>&lt;h2 id="é¢„å…ˆç¼–è¯‘">&lt;a href="#%e9%a2%84%e5%85%88%e7%bc%96%e8%af%91" class="header-anchor">&lt;/a>é¢„å…ˆç¼–è¯‘
&lt;/h2>&lt;p>é¢„å…ˆç¼–è¯‘ä¸€æ¬¡ &lt;strong>glog&lt;/strong> å’Œ &lt;strong>rocksdb&lt;/strong>, å› ä¸ºè¿™ä¸¤ä¸ªåº“ç›´æ¥ç”¨ pika çš„ MakeFile ç¼–è¯‘å®¹æ˜“å‡ºé—®é¢˜,å…ˆé¢„ç¼–è¯‘ä¸€ä¸‹&lt;/p>
&lt;ol>
&lt;li>å…ˆç‰¹æ®Šç¼–è¯‘ä¸€ä¸‹glogåº“&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">cd&lt;/span> /third/glog
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span>./configu
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3&lt;/span>&lt;span>make &lt;span style="color:#ff79c6">&amp;amp;&amp;amp;&lt;/span> make install
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ol start="2">
&lt;li>ç¼–è¯‘rocksdb&lt;/li>
&lt;/ol>
&lt;p>rocksdbç¼–è¯‘å®Œä¸éœ€è¦å®‰è£…ï¼Œåªéœ€è¦å¤åˆ¶ä¸€ä¸‹é™æ€åº“å°±å¥½&lt;/p>
&lt;p>ä½¿ç”¨cmakeæ„å»º&lt;/p>
&lt;p>cmake éœ€è¦ cmake3, cmakeå‘½ä»¤å¦‚ä¸‹&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>cmakeç¬”è®°3 -DWITH_BZ2&lt;span style="color:#ff79c6">=&lt;/span>ON -DWITH_MD_LIBRARY&lt;span style="color:#ff79c6">=&lt;/span>OFF -DWITH_SNAPPY&lt;span style="color:#ff79c6">=&lt;/span>ON -DWITH_ZLIB&lt;span style="color:#ff79c6">=&lt;/span>ON -DWITH_ZSTD&lt;span style="color:#ff79c6">=&lt;/span>ON -DWITH_TOOLS&lt;span style="color:#ff79c6">=&lt;/span>OFF -DWITH_TESTS&lt;span style="color:#ff79c6">=&lt;/span>OFF -DCMAKE_BUILD_TYPE&lt;span style="color:#ff79c6">=&lt;/span>Release ..
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3&lt;/span>&lt;span>make -jN
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æŠŠç¼–è¯‘åçš„ &lt;strong>librocksdb.a&lt;/strong> å¤åˆ¶åˆ° &lt;strong>rocksdb&lt;/strong> çš„æ ¹ç›®å½•&lt;/p>
&lt;h2 id="æ­£å¸¸ç¼–è¯‘">&lt;a href="#%e6%ad%a3%e5%b8%b8%e7%bc%96%e8%af%91" class="header-anchor">&lt;/a>æ­£å¸¸ç¼–è¯‘
&lt;/h2>&lt;p>æŒ‰ç…§å®˜æ–¹ç»™çš„æ–‡æ¡£ç¼–è¯‘å³å¯,&lt;/p>
&lt;p>æ‰§è¡Œ &lt;code>make&lt;/code>&lt;/p>
&lt;p>ç­‰å¾…æ‹‰å„ä¸ªä¾èµ–æ¨¡å—çš„ä»£ç  ç„¶åè‡ªåŠ¨ç¼–è¯‘&lt;/p>
&lt;p>å‰æœŸå·¥ä½œåšå¥½,ç¼–è¯‘ä¸­åº”è¯¥ä¸ä¼šå‡ºé”™&lt;/p>
&lt;p>æ£€æŸ¥ç¼–è¯‘æ˜¯å¦æ­£ç¡®&lt;/p>
&lt;h2 id="åç»­">&lt;a href="#%e5%90%8e%e7%bb%ad" class="header-anchor">&lt;/a>åç»­
&lt;/h2>&lt;p>ç¼–è¯‘å®Œæˆå,è¿™ä¸ªå¯æ‰§è¡Œæ–‡ä»¶æœ‰å¾ˆå¤š .soçš„ä¾èµ–, å¯ç§»æ¤æ¯”è¾ƒå·®, é€šè¿‡ è„šæœ¬ç¼–è¯‘ä¸€ä¸ªä¾èµ–è¾ƒå°‘çš„.soæ–‡ä»¶&lt;/p>
&lt;p>æ‰§è¡Œ &lt;strong>link_3_3_path-master.sh&lt;/strong> è„šæœ¬ç­‰å¾…å®Œæˆé“¾æ¥&lt;/p>
&lt;hr>
&lt;h2 id="ç¼–è¯‘å®Œæˆ">&lt;a href="#%e7%bc%96%e8%af%91%e5%ae%8c%e6%88%90" class="header-anchor">&lt;/a>ç¼–è¯‘å®Œæˆ
&lt;/h2>&lt;ol>
&lt;li>
&lt;p>æ­£å¸¸ç¼–è¯‘&lt;/p>
&lt;p>åˆ° &lt;strong>output/bin/&lt;/strong> ç›®å½•ä¸­, æ‰§è¡Œ &lt;code>ldd pika&lt;/code> å¦‚æœæ²¡æœ‰ notfind çš„ä¾èµ–åº“ è¯´æ˜ç¼–è¯‘å®Œæˆäº†&lt;/p>
&lt;/li>
&lt;li>
&lt;p>é™æ€é“¾æ¥
&lt;strong>output/bin/&lt;/strong> ç›®å½•ä¸­çš„æ˜¯æ­£å¸¸ç¼–è¯‘çš„, &lt;strong>link_3_3_path-master.sh&lt;/strong> åŒçº§ç›®å½•ä¸‹çš„æ˜¯é™æ€é“¾æ¥çš„&lt;/p>
&lt;/li>
&lt;/ol>
&lt;h2 id="é™æ€é“¾æ¥è„šæœ¬">&lt;a href="#%e9%9d%99%e6%80%81%e9%93%be%e6%8e%a5%e8%84%9a%e6%9c%ac" class="header-anchor">&lt;/a>é™æ€é“¾æ¥è„šæœ¬
&lt;/h2>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">#!/usr/bin/sh
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span>&lt;span style="color:#ff79c6">&lt;/span>&lt;span style="color:#8be9fd;font-style:italic">source_path&lt;/span>&lt;span style="color:#ff79c6">=&lt;/span>/root
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">dependence_path&lt;/span>&lt;span style="color:#ff79c6">=&lt;/span>/root/pika_static
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span>g++ &lt;span style="color:#f1fa8c">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span>&lt;span style="color:#f1fa8c">&lt;/span> &lt;span style="color:#f1fa8c">${&lt;/span>&lt;span style="color:#8be9fd;font-style:italic">source_path&lt;/span>&lt;span style="color:#f1fa8c">}&lt;/span>/pika/src/build_version.o &lt;span style="color:#f1fa8c">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span>&lt;span style="color:#f1fa8c">&lt;/span> &lt;span style="color:#f1fa8c">${&lt;/span>&lt;span style="color:#8be9fd;font-style:italic">source_path&lt;/span>&lt;span style="color:#f1fa8c">}&lt;/span>/pika/src/pika_stable_log.o &lt;span style="color:#f1fa8c">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span>&lt;span style="color:#f1fa8c">&lt;/span> &lt;span style="color:#f1fa8c">${&lt;/span>&lt;span style="color:#8be9fd;font-style:italic">source_path&lt;/span>&lt;span style="color:#f1fa8c">}&lt;/span>/pika/src/pika_consensus.o &lt;span style="color:#f1fa8c">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span>&lt;span style="color:#f1fa8c">&lt;/span> &lt;span style="color:#f1fa8c">${&lt;/span>&lt;span style="color:#8be9fd;font-style:italic">source_path&lt;/span>&lt;span style="color:#f1fa8c">}&lt;/span>/pika/src/pika_slave_node.o &lt;span style="color:#f1fa8c">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span>&lt;span style="color:#f1fa8c">&lt;/span> &lt;span style="color:#f1fa8c">${&lt;/span>&lt;span style="color:#8be9fd;font-style:italic">source_path&lt;/span>&lt;span style="color:#f1fa8c">}&lt;/span>/pika/src/pika_statistic.o &lt;span style="color:#f1fa8c">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span>&lt;span style="color:#f1fa8c">&lt;/span> &lt;span style="color:#f1fa8c">${&lt;/span>&lt;span style="color:#8be9fd;font-style:italic">source_path&lt;/span>&lt;span style="color:#f1fa8c">}&lt;/span>/pika/src/pika_client_processor.o &lt;span style="color:#f1fa8c">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span>&lt;span style="color:#f1fa8c">&lt;/span> &lt;span style="color:#f1fa8c">${&lt;/span>&lt;span style="color:#8be9fd;font-style:italic">source_path&lt;/span>&lt;span style="color:#f1fa8c">}&lt;/span>/pika/src/pika_admin.o &lt;span style="color:#f1fa8c">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span>&lt;span style="color:#f1fa8c">&lt;/span> &lt;span style="color:#f1fa8c">${&lt;/span>&lt;span style="color:#8be9fd;font-style:italic">source_path&lt;/span>&lt;span style="color:#f1fa8c">}&lt;/span>/pika/src/pika_binlog.o &lt;span style="color:#f1fa8c">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span>&lt;span style="color:#f1fa8c">&lt;/span> &lt;span style="color:#f1fa8c">${&lt;/span>&lt;span style="color:#8be9fd;font-style:italic">source_path&lt;/span>&lt;span style="color:#f1fa8c">}&lt;/span>/pika/src/pika_bit.o &lt;span style="color:#f1fa8c">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span>&lt;span style="color:#f1fa8c">&lt;/span> &lt;span style="color:#f1fa8c">${&lt;/span>&lt;span style="color:#8be9fd;font-style:italic">source_path&lt;/span>&lt;span style="color:#f1fa8c">}&lt;/span>/pika/src/pika.o &lt;span style="color:#f1fa8c">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15&lt;/span>&lt;span>&lt;span style="color:#f1fa8c">&lt;/span> &lt;span style="color:#f1fa8c">${&lt;/span>&lt;span style="color:#8be9fd;font-style:italic">source_path&lt;/span>&lt;span style="color:#f1fa8c">}&lt;/span>/pika/src/pika_proxy.o &lt;span style="color:#f1fa8c">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16&lt;/span>&lt;span>&lt;span style="color:#f1fa8c">&lt;/span> &lt;span style="color:#f1fa8c">${&lt;/span>&lt;span style="color:#8be9fd;font-style:italic">source_path&lt;/span>&lt;span style="color:#f1fa8c">}&lt;/span>/pika/src/pika_proxy_cli.o &lt;span style="color:#f1fa8c">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17&lt;/span>&lt;span>&lt;span style="color:#f1fa8c">&lt;/span> &lt;span style="color:#f1fa8c">${&lt;/span>&lt;span style="color:#8be9fd;font-style:italic">source_path&lt;/span>&lt;span style="color:#f1fa8c">}&lt;/span>/pika/src/pika_proxy_conn.o &lt;span style="color:#f1fa8c">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18&lt;/span>&lt;span>&lt;span style="color:#f1fa8c">&lt;/span> &lt;span style="color:#f1fa8c">${&lt;/span>&lt;span style="color:#8be9fd;font-style:italic">source_path&lt;/span>&lt;span style="color:#f1fa8c">}&lt;/span>/pika/src/pika_client_conn.o &lt;span style="color:#f1fa8c">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19&lt;/span>&lt;span>&lt;span style="color:#f1fa8c">&lt;/span> &lt;span style="color:#f1fa8c">${&lt;/span>&lt;span style="color:#8be9fd;font-style:italic">source_path&lt;/span>&lt;span style="color:#f1fa8c">}&lt;/span>/pika/src/pika_command.o &lt;span style="color:#f1fa8c">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20&lt;/span>&lt;span>&lt;span style="color:#f1fa8c">&lt;/span> &lt;span style="color:#f1fa8c">${&lt;/span>&lt;span style="color:#8be9fd;font-style:italic">source_path&lt;/span>&lt;span style="color:#f1fa8c">}&lt;/span>/pika/src/pika_pubsub.o &lt;span style="color:#f1fa8c">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21&lt;/span>&lt;span>&lt;span style="color:#f1fa8c">&lt;/span> &lt;span style="color:#f1fa8c">${&lt;/span>&lt;span style="color:#8be9fd;font-style:italic">source_path&lt;/span>&lt;span style="color:#f1fa8c">}&lt;/span>/pika/src/pika_conf.o &lt;span style="color:#f1fa8c">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22&lt;/span>&lt;span>&lt;span style="color:#f1fa8c">&lt;/span> &lt;span style="color:#f1fa8c">${&lt;/span>&lt;span style="color:#8be9fd;font-style:italic">source_path&lt;/span>&lt;span style="color:#f1fa8c">}&lt;/span>/pika/src/pika_dispatch_thread.o &lt;span style="color:#f1fa8c">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23&lt;/span>&lt;span>&lt;span style="color:#f1fa8c">&lt;/span> &lt;span style="color:#f1fa8c">${&lt;/span>&lt;span style="color:#8be9fd;font-style:italic">source_path&lt;/span>&lt;span style="color:#f1fa8c">}&lt;/span>/pika/src/pika_hash.o &lt;span style="color:#f1fa8c">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24&lt;/span>&lt;span>&lt;span style="color:#f1fa8c">&lt;/span> &lt;span style="color:#f1fa8c">${&lt;/span>&lt;span style="color:#8be9fd;font-style:italic">source_path&lt;/span>&lt;span style="color:#f1fa8c">}&lt;/span>/pika/src/pika_hyperloglog.o &lt;span style="color:#f1fa8c">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25&lt;/span>&lt;span>&lt;span style="color:#f1fa8c">&lt;/span> &lt;span style="color:#f1fa8c">${&lt;/span>&lt;span style="color:#8be9fd;font-style:italic">source_path&lt;/span>&lt;span style="color:#f1fa8c">}&lt;/span>/pika/src/pika_kv.o &lt;span style="color:#f1fa8c">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26&lt;/span>&lt;span>&lt;span style="color:#f1fa8c">&lt;/span> &lt;span style="color:#f1fa8c">${&lt;/span>&lt;span style="color:#8be9fd;font-style:italic">source_path&lt;/span>&lt;span style="color:#f1fa8c">}&lt;/span>/pika/src/pika_list.o &lt;span style="color:#f1fa8c">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27&lt;/span>&lt;span>&lt;span style="color:#f1fa8c">&lt;/span> &lt;span style="color:#f1fa8c">${&lt;/span>&lt;span style="color:#8be9fd;font-style:italic">source_path&lt;/span>&lt;span style="color:#f1fa8c">}&lt;/span>/pika/src/pika_monitor_thread.o &lt;span style="color:#f1fa8c">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28&lt;/span>&lt;span>&lt;span style="color:#f1fa8c">&lt;/span> &lt;span style="color:#f1fa8c">${&lt;/span>&lt;span style="color:#8be9fd;font-style:italic">source_path&lt;/span>&lt;span style="color:#f1fa8c">}&lt;/span>/pika/src/pika_server.o &lt;span style="color:#f1fa8c">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29&lt;/span>&lt;span>&lt;span style="color:#f1fa8c">&lt;/span> &lt;span style="color:#f1fa8c">${&lt;/span>&lt;span style="color:#8be9fd;font-style:italic">source_path&lt;/span>&lt;span style="color:#f1fa8c">}&lt;/span>/pika/src/pika_set.o &lt;span style="color:#f1fa8c">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30&lt;/span>&lt;span>&lt;span style="color:#f1fa8c">&lt;/span> &lt;span style="color:#f1fa8c">${&lt;/span>&lt;span style="color:#8be9fd;font-style:italic">source_path&lt;/span>&lt;span style="color:#f1fa8c">}&lt;/span>/pika/src/pika_geo.o &lt;span style="color:#f1fa8c">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31&lt;/span>&lt;span>&lt;span style="color:#f1fa8c">&lt;/span> &lt;span style="color:#f1fa8c">${&lt;/span>&lt;span style="color:#8be9fd;font-style:italic">source_path&lt;/span>&lt;span style="color:#f1fa8c">}&lt;/span>/pika/src/pika_geohash.o &lt;span style="color:#f1fa8c">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32&lt;/span>&lt;span>&lt;span style="color:#f1fa8c">&lt;/span> &lt;span style="color:#f1fa8c">${&lt;/span>&lt;span style="color:#8be9fd;font-style:italic">source_path&lt;/span>&lt;span style="color:#f1fa8c">}&lt;/span>/pika/src/pika_geohash_helper.o &lt;span style="color:#f1fa8c">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33&lt;/span>&lt;span>&lt;span style="color:#f1fa8c">&lt;/span> &lt;span style="color:#f1fa8c">${&lt;/span>&lt;span style="color:#8be9fd;font-style:italic">source_path&lt;/span>&lt;span style="color:#f1fa8c">}&lt;/span>/pika/src/pika_binlog_transverter.o &lt;span style="color:#f1fa8c">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34&lt;/span>&lt;span>&lt;span style="color:#f1fa8c">&lt;/span> &lt;span style="color:#f1fa8c">${&lt;/span>&lt;span style="color:#8be9fd;font-style:italic">source_path&lt;/span>&lt;span style="color:#f1fa8c">}&lt;/span>/pika/src/pika_binlog_reader.o &lt;span style="color:#f1fa8c">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35&lt;/span>&lt;span>&lt;span style="color:#f1fa8c">&lt;/span> &lt;span style="color:#f1fa8c">${&lt;/span>&lt;span style="color:#8be9fd;font-style:italic">source_path&lt;/span>&lt;span style="color:#f1fa8c">}&lt;/span>/pika/src/pika_partition.o &lt;span style="color:#f1fa8c">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36&lt;/span>&lt;span>&lt;span style="color:#f1fa8c">&lt;/span> &lt;span style="color:#f1fa8c">${&lt;/span>&lt;span style="color:#8be9fd;font-style:italic">source_path&lt;/span>&lt;span style="color:#f1fa8c">}&lt;/span>/pika/src/pika_repl_bgworker.o &lt;span style="color:#f1fa8c">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37&lt;/span>&lt;span>&lt;span style="color:#f1fa8c">&lt;/span> &lt;span style="color:#f1fa8c">${&lt;/span>&lt;span style="color:#8be9fd;font-style:italic">source_path&lt;/span>&lt;span style="color:#f1fa8c">}&lt;/span>/pika/src/pika_repl_client.o &lt;span style="color:#f1fa8c">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38&lt;/span>&lt;span>&lt;span style="color:#f1fa8c">&lt;/span> &lt;span style="color:#f1fa8c">${&lt;/span>&lt;span style="color:#8be9fd;font-style:italic">source_path&lt;/span>&lt;span style="color:#f1fa8c">}&lt;/span>/pika/src/pika_repl_client_conn.o &lt;span style="color:#f1fa8c">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39&lt;/span>&lt;span>&lt;span style="color:#f1fa8c">&lt;/span> &lt;span style="color:#f1fa8c">${&lt;/span>&lt;span style="color:#8be9fd;font-style:italic">source_path&lt;/span>&lt;span style="color:#f1fa8c">}&lt;/span>/pika/src/pika_repl_client_thread.o &lt;span style="color:#f1fa8c">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40&lt;/span>&lt;span>&lt;span style="color:#f1fa8c">&lt;/span> &lt;span style="color:#f1fa8c">${&lt;/span>&lt;span style="color:#8be9fd;font-style:italic">source_path&lt;/span>&lt;span style="color:#f1fa8c">}&lt;/span>/pika/src/pika_repl_server.o &lt;span style="color:#f1fa8c">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41&lt;/span>&lt;span>&lt;span style="color:#f1fa8c">&lt;/span> &lt;span style="color:#f1fa8c">${&lt;/span>&lt;span style="color:#8be9fd;font-style:italic">source_path&lt;/span>&lt;span style="color:#f1fa8c">}&lt;/span>/pika/src/pika_repl_server_conn.o &lt;span style="color:#f1fa8c">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42&lt;/span>&lt;span>&lt;span style="color:#f1fa8c">&lt;/span> &lt;span style="color:#f1fa8c">${&lt;/span>&lt;span style="color:#8be9fd;font-style:italic">source_path&lt;/span>&lt;span style="color:#f1fa8c">}&lt;/span>/pika/src/pika_repl_server_thread.o &lt;span style="color:#f1fa8c">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43&lt;/span>&lt;span>&lt;span style="color:#f1fa8c">&lt;/span> &lt;span style="color:#f1fa8c">${&lt;/span>&lt;span style="color:#8be9fd;font-style:italic">source_path&lt;/span>&lt;span style="color:#f1fa8c">}&lt;/span>/pika/src/pika_cmd_table_manager.o &lt;span style="color:#f1fa8c">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44&lt;/span>&lt;span>&lt;span style="color:#f1fa8c">&lt;/span> &lt;span style="color:#f1fa8c">${&lt;/span>&lt;span style="color:#8be9fd;font-style:italic">source_path&lt;/span>&lt;span style="color:#f1fa8c">}&lt;/span>/pika/src/pika_auxiliary_thread.o &lt;span style="color:#f1fa8c">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45&lt;/span>&lt;span>&lt;span style="color:#f1fa8c">&lt;/span> &lt;span style="color:#f1fa8c">${&lt;/span>&lt;span style="color:#8be9fd;font-style:italic">source_path&lt;/span>&lt;span style="color:#f1fa8c">}&lt;/span>/pika/src/pika_rm.o &lt;span style="color:#f1fa8c">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46&lt;/span>&lt;span>&lt;span style="color:#f1fa8c">&lt;/span> &lt;span style="color:#f1fa8c">${&lt;/span>&lt;span style="color:#8be9fd;font-style:italic">source_path&lt;/span>&lt;span style="color:#f1fa8c">}&lt;/span>/pika/src/pika_table.o &lt;span style="color:#f1fa8c">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47&lt;/span>&lt;span>&lt;span style="color:#f1fa8c">&lt;/span> &lt;span style="color:#f1fa8c">${&lt;/span>&lt;span style="color:#8be9fd;font-style:italic">source_path&lt;/span>&lt;span style="color:#f1fa8c">}&lt;/span>/pika/src/pika_rsync_service.o &lt;span style="color:#f1fa8c">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48&lt;/span>&lt;span>&lt;span style="color:#f1fa8c">&lt;/span> &lt;span style="color:#f1fa8c">${&lt;/span>&lt;span style="color:#8be9fd;font-style:italic">source_path&lt;/span>&lt;span style="color:#f1fa8c">}&lt;/span>/pika/src/pika_inner_message.pb.o &lt;span style="color:#f1fa8c">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49&lt;/span>&lt;span>&lt;span style="color:#f1fa8c">&lt;/span> &lt;span style="color:#f1fa8c">${&lt;/span>&lt;span style="color:#8be9fd;font-style:italic">source_path&lt;/span>&lt;span style="color:#f1fa8c">}&lt;/span>/pika/src/pika_slot.o &lt;span style="color:#f1fa8c">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50&lt;/span>&lt;span>&lt;span style="color:#f1fa8c">&lt;/span> &lt;span style="color:#f1fa8c">${&lt;/span>&lt;span style="color:#8be9fd;font-style:italic">source_path&lt;/span>&lt;span style="color:#f1fa8c">}&lt;/span>/pika/src/pika_data_distribution.o &lt;span style="color:#f1fa8c">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">51&lt;/span>&lt;span>&lt;span style="color:#f1fa8c">&lt;/span> &lt;span style="color:#f1fa8c">${&lt;/span>&lt;span style="color:#8be9fd;font-style:italic">source_path&lt;/span>&lt;span style="color:#f1fa8c">}&lt;/span>/pika/src/pika_meta.o &lt;span style="color:#f1fa8c">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">52&lt;/span>&lt;span>&lt;span style="color:#f1fa8c">&lt;/span> &lt;span style="color:#f1fa8c">${&lt;/span>&lt;span style="color:#8be9fd;font-style:italic">source_path&lt;/span>&lt;span style="color:#f1fa8c">}&lt;/span>/pika/src/pika_cluster.o &lt;span style="color:#f1fa8c">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">53&lt;/span>&lt;span>&lt;span style="color:#f1fa8c">&lt;/span> &lt;span style="color:#f1fa8c">${&lt;/span>&lt;span style="color:#8be9fd;font-style:italic">source_path&lt;/span>&lt;span style="color:#f1fa8c">}&lt;/span>/pika/third/slash/slash/lib/libslash.a &lt;span style="color:#f1fa8c">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">54&lt;/span>&lt;span>&lt;span style="color:#f1fa8c">&lt;/span> &lt;span style="color:#f1fa8c">${&lt;/span>&lt;span style="color:#8be9fd;font-style:italic">source_path&lt;/span>&lt;span style="color:#f1fa8c">}&lt;/span>/pika/third/pink/pink/lib/libpink.a &lt;span style="color:#f1fa8c">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">55&lt;/span>&lt;span>&lt;span style="color:#f1fa8c">&lt;/span> &lt;span style="color:#f1fa8c">${&lt;/span>&lt;span style="color:#8be9fd;font-style:italic">source_path&lt;/span>&lt;span style="color:#f1fa8c">}&lt;/span>/pika/third/blackwidow/lib/libblackwidow.a &lt;span style="color:#f1fa8c">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">56&lt;/span>&lt;span>&lt;span style="color:#f1fa8c">&lt;/span> &lt;span style="color:#f1fa8c">${&lt;/span>&lt;span style="color:#8be9fd;font-style:italic">source_path&lt;/span>&lt;span style="color:#f1fa8c">}&lt;/span>/pika/third/rocksdb/librocksdb.a &lt;span style="color:#f1fa8c">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">57&lt;/span>&lt;span>&lt;span style="color:#f1fa8c">&lt;/span> &lt;span style="color:#f1fa8c">${&lt;/span>&lt;span style="color:#8be9fd;font-style:italic">source_path&lt;/span>&lt;span style="color:#f1fa8c">}&lt;/span>/pika/src/pika_zset.o -static-libstdc++ -Wl,-Bstatic -lprotobuf -llz4 -lzstd -llz4 -lglog -lgflags -llzma -lsnappy -Wl,-Bdynamic -lpthread -lrt -lz -lbz2 -Wl,--dynamic-linker&lt;span style="color:#ff79c6">=&lt;/span>/lib64/ld-linux-x86-64.so.2 -o pika
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>-Wl,-Bstatic&lt;/strong> åé¢çš„æ˜¯è¦ &lt;strong>é™æ€é“¾æ¥&lt;/strong> çš„åº“&lt;/p>
&lt;p>&lt;strong>-Wl,-Bdynamic&lt;/strong> åé¢çš„æ˜¯è¦ &lt;strong>åŠ¨æ€é“¾&lt;/strong> æ¥çš„åº“&lt;/p></description></item><item><title>4000å­—è¯¦è§£è·³è¡¨å®ç°(æŒ‘æˆ˜å…¨ç½‘ä¸­æ–‡æœ€è¯¦ç»†)</title><link>https://lqxhub.github.io/posts/4f40161/</link><pubDate>Sun, 17 Oct 2021 18:30:19 +0000</pubDate><guid>https://lqxhub.github.io/posts/4f40161/</guid><description>&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/fcc8e8e79ed84bc3a42374e0cac652db.webp" alt="Featured image of post 4000å­—è¯¦è§£è·³è¡¨å®ç°(æŒ‘æˆ˜å…¨ç½‘ä¸­æ–‡æœ€è¯¦ç»†)" />&lt;p>æœ€è¿‘åœ¨çœ‹ç ”ç©¶å…¬å¸ä¸šåŠ¡çš„å­˜å‚¨æ¶æ„ï¼Œç°æœ‰çš„å­˜å‚¨ç”¨redis å’Œ leveldb é€šè¿‡è‡ªå·±å†™çš„ä¸­é—´ä»¶åšæ•°æ®è½åœ°ã€‚è¿™æ ·å†™ä¸šåŠ¡å’Œæ•°æ®æ¢å¤æœ‰ç‚¹éº»çƒ¦ï¼Œæƒ³ç€ä¼˜åŒ–ä¸€ä¸‹ï¼Œå°±å»ç ”ç©¶rediså’Œleveldbçš„æºç ã€‚å‘ç°äº†è·³è¡¨è¿™ä¸ªæ•°æ®ç»“æ„å¾ˆæœ‰æ„æ€ï¼Œæ€§èƒ½ä¸é”™ï¼Œå®ç°ä¹Ÿç›¸å¯¹ç®€å•ï¼Œå°±æƒ³ç€è‡ªå·±ç”¨goå®ç°ä¸€ä¸ªè·³è¡¨ï¼Œåœ¨é€šè¿‡è¿™ä¸ªè·³è¡¨å®ç°ä¸€ä¸ªç±»ä¼¼redis çš„ zset åŠŸèƒ½ã€‚æˆ‘ä¼šå°½å¯èƒ½ è¯¦ç»†çš„å»ä»‹ç»æ‰€æœ‰å®ç°ç»†èŠ‚ã€‚&lt;/p>
&lt;p>çœ‹ç€ç¯‡æ–‡ç« ï¼Œé¦–å…ˆç†Ÿæ‚‰é“¾è¡¨çš„ç›¸å…³çŸ¥è¯†ï¼Œæ¯”å¦‚é“¾è¡¨çš„æ’å…¥å’Œåˆ é™¤ã€‚æœ€å¥½ä¼šä¸€ç‚¹goï¼Œä¸ä¼šå…³ç³»ä¹Ÿä¸å¤§ï¼Œgoçš„è¯­æ³•å¾ˆç®€å•ï¼Œå’ŒCæœ‰ä¸€ç‚¹åƒï¼Œæœ‰è®¡ç®—æœºåŸºç¡€çš„åŸºæœ¬å¾ˆå¿«å°±èƒ½çœ‹æ‡‚goçš„è¯­æ³•ã€‚&lt;/p>
&lt;p>&lt;strong>ä¸‹é¢åˆ†è¿™ä¸ªå‡ ç‚¹æ¥ä»‹ç»&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>è·³è¡¨æ˜¯ä»€ä¹ˆ&lt;/li>
&lt;li>è·³è¡¨çš„ä¼˜ç¼ºç‚¹&lt;/li>
&lt;li>è·³è¡¨çš„ç»“æ„&lt;/li>
&lt;li>æ€ä¹ˆå®ç°ä¸€ä¸ªè·³è¡¨(å¢åˆ æ”¹æŸ¥)&lt;/li>
&lt;/ul>
&lt;h2 id="è·³è¡¨æ˜¯ä»€ä¹ˆ">&lt;a href="#%e8%b7%b3%e8%a1%a8%e6%98%af%e4%bb%80%e4%b9%88" class="header-anchor">&lt;/a>è·³è¡¨æ˜¯ä»€ä¹ˆ
&lt;/h2>&lt;p>è·³è¡¨æ˜¯ä¸€ä¸ªå¯ä»¥å¿«é€ŸæŸ¥æ‰¾çš„æœ‰åºé“¾è¡¨, æœç´¢ã€æ’å…¥ã€åˆ é™¤æ“ä½œçš„æ—¶é—´å‡ä¸ºO(logn), å…³äºè·³è¡¨çš„è¯¦ç»†å®šä¹‰ &lt;a class="link" href="https://zh.wikipedia.org/wiki/%E8%B7%B3%E8%B7%83%E5%88%97%E8%A1%A8" target="_blank" rel="noopener"
>ç»´åŸºç™¾ç§‘&lt;/a> &lt;a class="link" href="https://baike.baidu.com/item/%E8%B7%B3%E8%A1%A8/22819833" target="_blank" rel="noopener"
>ç™¾åº¦ç™¾ç§‘&lt;/a> è·³è¡¨è™½ç„¶æ˜¯éå¸¸æœ‰ç”¨çš„æ•°æ®ç»“æ„ï¼Œä½†æ˜¯å¾ˆå¤šä¹¦é‡Œéƒ½æ²¡æœ‰å†™è¿™ä¸ªï¼Œæˆ‘åœ¨å¤§å­¦çš„æ•°æ®ç»“æ„è¯¾æœ¬é‡Œä¹Ÿæ²¡æœ‰å†™è·³è¡¨ï¼Œå°±å¯¼è‡´å¾ˆå¤šäººå¯¹è·³è¡¨ä¸ç†Ÿæ‚‰ã€‚&lt;/p>
&lt;p>è·³è¡¨æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªé“¾è¡¨ï¼Œå› ä¸ºé“¾è¡¨çš„éšæœºæŸ¥æ‰¾æ€§èƒ½å¤ªå·®ï¼Œæ˜¯O(N)ï¼ŒæŸ¥æ‰¾å…ƒç´ åªèƒ½ä»å¤´ç»“ç‚¹æˆ–è€…å°¾ç»“ç‚¹éå†ã€‚&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-8a5c496ba69e55bb.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-8a5c496ba69e55bb.webp" alt="å•å‘é“¾è¡¨" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>å¦‚å›¾ä¸­è¦æŸ¥æ‰¾ç»“ç‚¹6ï¼Œåªèƒ½ä»ç»“ç‚¹1 ä¸€ç‚¹ç‚¹å¾€å³éå†ã€‚&lt;/p>
&lt;p>èƒ½ä¸èƒ½åœ¨é“¾è¡¨ä¸­ä½¿ç”¨äºŒåˆ†æŸ¥æ‰¾å‘¢ï¼Œå½“ç„¶æ˜¯å¯ä»¥çš„ï¼Œå°±æ˜¯ç»™é“¾è¡¨åŠ ç´¢å¼•ï¼Œä¹Ÿå°±æ˜¯è·³è¡¨äº†&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-7e8eb6e18ce9f5af.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-7e8eb6e18ce9f5af.webp" alt="è·³è¡¨" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>ä¸Šå›¾å°±æ˜¯ä¸€ä¸ªç®€å•çš„è·³è¡¨äº†ï¼ˆå›¾ä¸­çš„å„ç§é¢œè‰²å’Œæ•°å­—åé¢ä¼šæœ‰è¯¦ç»†çš„ä»‹ç»ï¼‰ã€‚ä»å›¾ä¸­å¯ä»¥çœ‹å‡ºï¼Œè·³è¡¨æ˜¯åœ¨åŒå‘é“¾è¡¨çš„åŸºç¡€ä¸Šï¼ŒåŠ äº†å¤šå±‚ç´¢å¼•å®ç°çš„ã€‚&lt;/p>
&lt;h2 id="è·³è¡¨çš„ä¼˜ç¼ºç‚¹">&lt;a href="#%e8%b7%b3%e8%a1%a8%e7%9a%84%e4%bc%98%e7%bc%ba%e7%82%b9" class="header-anchor">&lt;/a>è·³è¡¨çš„ä¼˜ç¼ºç‚¹
&lt;/h2>&lt;p>ä½œä¸ºå¿«é€ŸæŸ¥æ‰¾çš„æ•°æ®ç»“æ„ï¼Œè·³è¡¨å¸¸ç”¨æ¥å’Œçº¢é»‘æ ‘ åšæ¯”è¾ƒï¼Œåˆ—ä¸€ä¸‹è·³è¡¨å’Œçº¢é»‘æ ‘çš„ä¼˜ç¼ºç‚¹å§&lt;/p>
&lt;ul>
&lt;li>è·³è¡¨çš„ä¼˜ç‚¹ï¼š&lt;/li>
&lt;/ul>
&lt;ol>
&lt;li>è·³è¡¨å®ç°èµ·æ¥ç›¸å¯¹ç®€å•ã€‚çº¢é»‘æ ‘çš„å®šä¹‰å’Œå·¦æ—‹å³æ—‹æ“ä½œï¼Œç¡®å®å¤æ‚ï¼Œæˆ‘èµ„è´¨æ„šé’ï¼Œç†è§£èµ·æ¥è¿˜æ˜¯æœ‰å•å›°éš¾ã€‚åé¢æˆ‘ä¼šè§£é‡Šè·³è¡¨å®ç°ç®€å•çš„åŸå› çš„.&lt;/li>
&lt;li>åŒºé—´æŸ¥æ‰¾æ–¹ä¾¿ã€‚åœ¨è·³è¡¨ä¸­æ‰¾åˆ°ä¸€ä¸ªèŠ‚ç‚¹åï¼Œå°±å¯ä»¥é€šè¿‡å‰åæŒ‡é’ˆæ‰¾åˆ°ç›¸é‚»çš„å…ƒç´ ã€‚çº¢é»‘æ ‘åˆ™éœ€è¦é€šè¿‡çˆ¶èŠ‚ç‚¹ï¼Œå­èŠ‚ç‚¹å»å¯»æ‰¾ï¼Œç›¸å¯¹éº»çƒ¦ã€‚&lt;/li>
&lt;/ol>
&lt;ul>
&lt;li>çº¢é»‘æ ‘çš„ä¼˜ç‚¹&lt;/li>
&lt;/ul>
&lt;ol>
&lt;li>å†…å­˜å ç”¨å°ï¼Œåªéœ€è¦3ä¸ªæŒ‡é’ˆå°±å¯ä»¥ï¼ˆå·¦å­æ ‘ï¼Œå³å­æ ‘ï¼Œçˆ¶èŠ‚ç‚¹ï¼‰ è€Œè·³è¡¨æœ‰ä¸€ä¸ªå‘åçš„æŒ‡é’ˆï¼Œæ¯ä¸€å±‚éƒ½æœ‰ä¸€ä¸ªå‘å‰çš„æŒ‡é’ˆ&lt;/li>
&lt;li>çº¢é»‘æ ‘çš„æŸ¥æ‰¾ç¨³å®šï¼Œçº¢é»‘æ ‘æœ‰ç€ä¸¥æ ¼çš„å®šä¹‰ï¼Œæ¯æ¬¡æ’å…¥å’Œåˆ é™¤æ•°æ®éƒ½ä¼šé€šè¿‡å·¦æ—‹å³æ—‹æ¥å¹³è¡¡æ ‘çš„ç»“æ„ï¼Œé€šè¿‡çº¢é»‘æ ‘æŸ¥æ‰¾æœ‰ç€ç¨³å®šçš„æŸ¥æ‰¾æ—¶é—´O(logn) ï¼Œä¸ºå•¥è·³è¡¨æ˜¯ä¸ç¨³å®šçš„ï¼Œçœ‹åˆ°è·³è¡¨æ˜¯æ€æ ·ç¡®å®šå±‚æ•°çš„å°±æ˜ç™½äº†&lt;/li>
&lt;/ol>
&lt;ul>
&lt;li>è·³è¡¨å’Œæ™®é€šé“¾è¡¨ç›¸æ¯”ï¼Œé™¤äº†è´¹å†…å­˜ï¼Œå¥½åƒæ²¡å•¥ç¼ºç‚¹äº†&lt;/li>
&lt;/ul>
&lt;h2 id="è·³è¡¨çš„ç»“æ„å’Œå®ç°">&lt;a href="#%e8%b7%b3%e8%a1%a8%e7%9a%84%e7%bb%93%e6%9e%84%e5%92%8c%e5%ae%9e%e7%8e%b0" class="header-anchor">&lt;/a>è·³è¡¨çš„ç»“æ„å’Œå®ç°
&lt;/h2>&lt;p>è·³è¡¨çš„å®ç°æ€è·¯å€Ÿé‰´äº†redisçš„zsetå®ç°æ€æƒ³å…·ä½“ä»£ç åœ¨&lt;a class="link" href="https://github.com/redis/redis/blob/unstable/src/t_zset.c" target="_blank" rel="noopener"
>github&lt;/a>
è·³è¡¨ç®€å•è¯´å¯ä»¥æœ‰ä¸¤ç§å®ç°æ€è·¯ï¼Œä¸€ç§æ˜¯è·³è¡¨å†…ä¸èƒ½æœ‰é‡å¤çš„å…ƒç´ ï¼Œå¦ä¸€ç§æ˜¯è·³è¡¨å†…å…è®¸æœ‰é‡å¤å…ƒç´ ã€‚redisä¸­çš„è·³è¡¨æ˜¯å…è®¸æœ‰é‡å¤å…ƒç´ çš„ï¼Œæˆ‘è¿™æ¬¡å®ç°çš„ä¹Ÿæ˜¯å¯ä»¥æœ‰é‡å¤å…ƒç´ çš„ã€‚&lt;/p>
&lt;h3 id="è·³è¡¨node-çš„ç»“æ„">&lt;a href="#%e8%b7%b3%e8%a1%a8node-%e7%9a%84%e7%bb%93%e6%9e%84" class="header-anchor">&lt;/a>è·³è¡¨node çš„ç»“æ„
&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">type&lt;/span> SkipListLevel &lt;span style="color:#8be9fd;font-style:italic">struct&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span> &lt;span style="color:#6272a4">//æŒ‡å‘ä¸‹ä¸€ä¸ªç»“ç‚¹
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> forward &lt;span style="color:#ff79c6">*&lt;/span>SkipListNode
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span> &lt;span style="color:#6272a4">/*
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span>&lt;span style="color:#6272a4"> * åˆ°ä¸‹ä¸€ä¸ªnodeçš„è·ç¦»;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span>&lt;span style="color:#6272a4"> * æ€è€ƒ,ä¸ºå•¥æ˜¯è®°å½•åˆ°ä¸‹ä¸€ä¸ªnode, è€Œä¸æ˜¯è®°å½•ä¸Šä¸€ä¸ªnodeåˆ°è¿™çš„è·ç¦»
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span>&lt;span style="color:#6272a4"> */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span> span &lt;span style="color:#8be9fd">int64&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">type&lt;/span> SkipListNode &lt;span style="color:#8be9fd;font-style:italic">struct&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span> &lt;span style="color:#6272a4">//æŒ‡å‘ä¸Šä¸€ä¸ªç»“ç‚¹
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> backward &lt;span style="color:#ff79c6">*&lt;/span>SkipListNode
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15&lt;/span>&lt;span> &lt;span style="color:#6272a4">//ç´¢å¼•ç”¨çš„å±‚
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> level []SkipListLevel
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17&lt;/span>&lt;span> &lt;span style="color:#6272a4">//å­˜å‚¨çš„å€¼
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> value ISkipListNode
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19&lt;/span>&lt;span> &lt;span style="color:#6272a4">//æ’åç”¨çš„åˆ†æ•°
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> score &lt;span style="color:#8be9fd">float64&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-8d7d615cb137328e.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-8d7d615cb137328e.webp" alt="å•ä¸ªnode" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>åœ¨ä¸€ä¸ªnodeä¸­ï¼Œé»‘è‰²çš„&lt;strong>1&lt;/strong>æ˜¯ &lt;strong>value&lt;/strong>ï¼Œ é»„è‰²çš„æ–¹å—æ˜¯&lt;strong>level&lt;/strong>ï¼Œç™½è‰²çš„æ•°å­—æ˜¯&lt;strong>span&lt;/strong>ï¼Œ&lt;strong>backward&lt;/strong> å’Œ &lt;strong>forward&lt;/strong> è¿™ä¸¤ä¸ªæŒ‡é’ˆåœ¨å›¾ä¸­æ²¡æœ‰ä½“ç°å‡ºæ¥ï¼Œåªä¼šæœ‰ä¸€ä¸ªbackward ï¼ˆå‘åçš„æŒ‡é’ˆï¼‰ï¼Œlevelæ•°ç»„é•¿åº¦æ˜¯å¤šå°‘ï¼Œå°±ä¼šæœ‰å¤šå°‘ä¸ªforwardï¼ˆå‘å‰çš„ï¼‰æŒ‡é’ˆã€‚
spanå€¼æ˜¯åˆ°ä¸‹ä¸€ä¸ªç»“ç‚¹çš„è·¨åº¦æ˜¯å¤šå°‘ï¼Œç›¸é‚»çš„ç»“ç‚¹æ•°å€¼æ˜¯1ã€‚è¿™ä¸ªå€¼çš„ä½œç”¨æ˜¯ç”¨æ¥è®¡ç®—è¿™ä¸ªnodeåœ¨è·³è¡¨ä¸­çš„æ’åã€‚ä¸€å¼€å§‹æˆ‘å¯¹spançš„å€¼ ä¸ç†è§£ï¼Œä»¥ä¸ºæ˜¯ä¸Šä¸ªç»“ç‚¹åˆ°è¿™é‡Œçš„è·ç¦»ï¼Œç›´åˆ°åœ¨å†™æ’å…¥å’Œæœç´¢ç»“ç‚¹çš„æ—¶å€™ï¼Œæ‰æ„è¯†åˆ°è¿™ä¸ªæ˜¯åˆ°ä¸‹ä¸ªç»“ç‚¹çš„è·¨åº¦ã€‚&lt;/p>
&lt;h3 id="è·³è¡¨ç»“æ„">&lt;a href="#%e8%b7%b3%e8%a1%a8%e7%bb%93%e6%9e%84" class="header-anchor">&lt;/a>è·³è¡¨ç»“æ„
&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">type&lt;/span> SkipList &lt;span style="color:#8be9fd;font-style:italic">struct&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span> &lt;span style="color:#6272a4">//å¤´ç»“ç‚¹å’Œå°¾ç»“ç‚¹
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#6272a4">//é‡ç‚¹,å¤´ç»“ç‚¹æ˜¯ä¸€ä¸ªçœŸå®å­˜åœ¨çš„,å°¾ç»“ç‚¹åªæ˜¯ä¸€ä¸ªæŒ‡é’ˆ
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> head, tail &lt;span style="color:#ff79c6">*&lt;/span>SkipListNode
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span> size &lt;span style="color:#8be9fd">int64&lt;/span> &lt;span style="color:#6272a4">//nodeæ€»æ•°
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span> level &lt;span style="color:#8be9fd">int&lt;/span> &lt;span style="color:#6272a4">//å½“å‰è·³è¡¨çš„æœ€é«˜level
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span> maxLevel &lt;span style="color:#8be9fd">int&lt;/span> &lt;span style="color:#6272a4">//å½“å‰æœ€å¤§å±‚æ•°
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>head&lt;/strong> å’Œ &lt;strong>tail&lt;/strong> æ˜¯ä¸¤ä¸ªæŒ‡é’ˆæŒ‡å‘è·³è¡¨çš„å¤´å’Œå°¾ï¼Œ&lt;strong>size&lt;/strong> æ˜¯æ•´ä¸ªè·³è¡¨ä¸­nodeçš„çš„æ•°é‡ï¼Œ &lt;strong>level&lt;/strong> æ˜¯è·³è¡¨ä¸­ï¼Œå½“å‰çš„æœ€å¤§é«˜åº¦ï¼Œè¿™é‡Œä¼šå¼•ç”³å‡ºä¸€ä¸ªçŸ¥è¯†ç‚¹ï¼Œè·³è¡¨ä¸­çš„é«˜åº¦ä¸æ˜¯å›ºå®šä¸å˜çš„ï¼Œè€Œæ˜¯éšç€æ’å…¥å’Œåˆ é™¤åŠ¨æ€å˜åŒ–çš„ã€‚&lt;strong>maxLevel&lt;/strong> æ˜¯è·³è¡¨å¯ä»¥è¾¾åˆ°çš„æœ€å¤§é«˜åº¦ï¼Œè¿™ä¸ªå€¼æ˜¯ä¸€å¼€å§‹å°±å›ºå®šçš„ä¸å˜çš„ã€‚&lt;/p>
&lt;p>å†æŠŠä¸Šé¢çš„å›¾æ‹¿è¿‡æ¥ï¼Œåˆ†æä¸€ä¸‹æ•´ä¸ªè·³è¡¨ç»“ç‚¹é—´çš„ç»„ç»‡å…³ç³»&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-7e8eb6e18ce9f5af.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-7e8eb6e18ce9f5af.webp" alt="è·³è¡¨" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>è·³è¡¨ä¸­ä¼šæœ‰ä¸€ä¸ª &lt;strong>head&lt;/strong> ç»“ç‚¹ï¼Œä½†æ˜¯æ²¡æœ‰ &lt;strong>tail&lt;/strong> ç»“ç‚¹ï¼Œtailåªæ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼ŒæŒ‡å‘è·³è¡¨çš„æœ€åä¸€ä¸ªç»“ç‚¹ã€‚è¿™ä¸ªåœ¨åˆå§‹åŒ–å‡½æ•°é‡Œæœ‰ä½“ç°&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#6272a4">//åˆå§‹åŒ–ä¸€ä¸ªé»˜è®¤çš„è·³è¡¨
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> &lt;span style="color:#50fa7b">NewDefaultSkipTable&lt;/span>() &lt;span style="color:#ff79c6">*&lt;/span>SkipList {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span> rand.&lt;span style="color:#50fa7b">Seed&lt;/span>(time.&lt;span style="color:#50fa7b">Now&lt;/span>().&lt;span style="color:#50fa7b">UnixNano&lt;/span>())
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> &lt;span style="color:#ff79c6">&amp;amp;&lt;/span>SkipList{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span> head: &lt;span style="color:#50fa7b">NewSkipListNode&lt;/span>(SKIP_TABLE_DEFAULT_MAX_LEVEL, &lt;span style="color:#bd93f9">0&lt;/span>, &lt;span style="color:#ff79c6">nil&lt;/span>),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span> size: &lt;span style="color:#bd93f9">0&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span> level: &lt;span style="color:#bd93f9">1&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span> maxLevel: SKIP_TABLE_DEFAULT_MAX_LEVEL,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å›¾ä¸­å‘å‰çš„æŒ‡é’ˆ (forward)ï¼Œä¹Ÿå°±æ˜¯æ©™è‰²çš„ç®­å¤´ï¼Œå‘åçš„æŒ‡é’ˆ (backward)ï¼Œä¹Ÿå°±æ˜¯ç»¿è‰²çš„ç®­å¤´ã€‚
forwardæŒ‡é’ˆåœ¨levelä¸­ï¼Œä¹Ÿå°±æ˜¯æ¯ä¸€å±‚éƒ½æœ‰ä¸€ä¸ªå‘å‰çš„æŒ‡é’ˆï¼Œbackwardåªå­˜åœ¨äºnodeä¸­ï¼Œä¹Ÿå°±æ˜¯æ¯ä¸ªèŠ‚ç‚¹åªæœ‰ä¸€ä¸ªå‘åçš„æŒ‡é’ˆã€‚æƒ³ä¸€ä¸‹ä¸ºå•¥åªéœ€è¦ä¸€ä¸ªå‘åçš„æŒ‡é’ˆå‘¢ï¼Ÿï¼Ÿï¼Ÿçœ‹å®Œæ•´ä¸ªæŸ¥æ‰¾è¿‡ç¨‹å°±æ˜ç™½ä¸ºå•¥åªéœ€è¦ä¸€ä¸ªå‘åæŒ‡é’ˆå°±è¡Œäº†ã€‚&lt;/p>
&lt;h3 id="æ’å…¥node">&lt;a href="#%e6%8f%92%e5%85%a5node" class="header-anchor">&lt;/a>æ’å…¥node
&lt;/h3>&lt;p>åŸºç¡€çŸ¥è¯†å‡†å¤‡çš„å·®ä¸å¤šäº†ï¼Œå¼€å§‹è¿›å…¥è·³è¡¨çš„æ’å…¥é€»è¾‘ï¼Œå…ˆé€šè¿‡ä¸€å¼ å›¾æŠŠé€»è¾‘å±•ç¤ºä¸€ä¸‹&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-4a320f4d9ffe2c71.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-4a320f4d9ffe2c71.webp" alt="æ’å…¥å…ƒç´ " />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>æ’å…¥å…ƒç´ çš„ç¬¬ä¸€æ­¥å°±æ˜¯å…ˆæŸ¥æ‰¾å…ƒç´ ã€‚å› ä¸ºæ˜¯æœ‰åºé“¾è¡¨ï¼Œå…ƒç´ éƒ½æ˜¯æŒ‰åºæ’åˆ—çš„ï¼Œæ’å…¥å…ƒç´ å‰å…ˆæ‰¾åˆ°å…ƒç´ åº”è¯¥åœ¨çš„ä½ç½®ã€‚&lt;/p>
&lt;p>å›¾ä¸­è¦æŠŠscoreä¸º3çš„å…ƒç´ æ’å…¥è·³è¡¨ä¸­ï¼Œå¸¦åºå·çš„ç®­å¤´ï¼ˆæŒ‡é’ˆï¼‰æ˜¯æœç´¢é¡ºåºï¼Œå…¶ä¸­é»‘è‰²çš„ç®­å¤´æ˜¯å®é™…ç¡®å®šçš„è·¯å¾„ï¼Œåœ¨æœç´¢è¿‡ç¨‹ä¸­ï¼Œè¿˜è¦è®°å½•ä¸€ä¸‹rankï¼Œä¹Ÿå°±æ˜¯ç»è¿‡æ‰€æœ‰nodeçš„spanä¹‹å’Œã€‚
å…ˆæ˜ç¡®ä¸€ä¸‹æˆ‘ä»¬è¦æœç´¢çš„ç»“ç‚¹æ˜¯å“ªä¸ªã€‚æˆ‘ä»¬è¦æ‰¾ä¸€ä¸ªå°äº3çš„æœ€å¤§çš„æ•°ï¼ˆå…ˆä¸è€ƒå°æ•°å’Œè™‘é“¾è¡¨ä¸­æœ‰å¤šä¸ª3çš„æƒ…å†µï¼‰ï¼Œä½“ç°åœ¨å›¾ä¸­ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬è¦æ‰¾åˆ°å…ƒç´ 2çš„ä½ç½®ã€‚&lt;/p>
&lt;p>æœç´¢å‰å…ˆç¡®å®š å½“å‰è·³è¡¨çš„æœ€é«˜levelå€¼ã€‚ä¹Ÿå¯ä»¥æ— è„‘ä»æœ€ä¸Šå±‚å¼€å§‹ï¼Œä½†æ˜¯æ²¡æœ‰æ„ä¹‰ã€‚å›¾ä¸­æœ€é«˜levelæ˜¯4ï¼Œä¹Ÿå°±æ˜¯level3ï¼ˆå› ä¸ºlevelæ•°ç»„ä»0å¼€å§‹ï¼‰ã€‚ç„¶åä»å¤´ç»“ç‚¹ï¼ˆheadï¼‰çš„levelå±‚ï¼ˆlevel3ï¼‰å¼€å§‹ã€‚&lt;/p>
&lt;p>å…ˆè®¾ä¸€ä¸ªä¸´æ—¶æŒ‡é’ˆ &lt;strong>t&lt;/strong> æŒ‡å‘headç»“ç‚¹ã€‚
å…ˆé€šè¿‡å›¾ä¸­ &lt;strong>1&lt;/strong> æŒ‡é’ˆï¼ŒæŒ‡å‘çš„æ˜¯å…ƒç´ 4ï¼Œè¦æ’å…¥çš„èŠ‚ç‚¹æ˜¯3ï¼Œè¿™ä¸ªæ˜æ˜¾æ˜¯å¤§äº3çš„ï¼Œæ‰€ä»¥ä¸ç¬¦åˆã€‚åˆ’é‡ç‚¹äº† &lt;strong>å½“ ç°åœ¨çš„nodeå½“å‰å±‚çš„ä¸‹ä¸€ä¸ªnodeä¸ç¬¦åˆæ¡ä»¶æ—¶ï¼Œå°±éœ€è¦å¼€å§‹æœç´¢ä¸‹ä¸€å±‚&lt;/strong> è¿™ç®—æ˜¯ä¸€ä¸ªè½¬ç§»æ¡ä»¶å§ã€‚
è¿™æ—¶å€™å½“å‰nodeè¿˜æ˜¯åœ¨headï¼Œæ‰€ä»¥ä»headçš„level2å¼€å§‹å‘å³æœç´¢ã€‚æ­¤æ—¶nodeçš„ä¸‹ä¸€ä¸ªnodeæ˜¯1ï¼Œ1å°äº3ï¼Œæ‰€ä»¥ç¬¦åˆæ¡ä»¶ï¼Œæ‰€ä»¥ &lt;strong>t&lt;/strong> æŒ‡é’ˆè¦æŒ‡å‘ &lt;strong>1&lt;/strong> nodeï¼Œå†è®°å½•ä¸€ä¸‹headçš„spanå€¼ã€‚&lt;/p>
&lt;p>å¦‚æ­¤å¾€å¤ï¼Œç»è¿‡ &lt;strong>3&lt;/strong> &lt;strong>4&lt;/strong> &lt;strong>5&lt;/strong> æŒ‡é’ˆçš„åˆ¤æ–­ï¼Œæœ€ç»ˆæ¥åˆ°äº†node 2 çš„level0ï¼Œè¿™æ—¶node2çš„ä¸‹ä¸€ä¸ªnodeæ˜¯å¤§äº3çš„ï¼Œè€Œæ­¤æ—¶ä¹Ÿæ˜¯æœ€åä¸€å±‚äº†ï¼Œæ‰€ä»¥node 2 å°±æ˜¯å°äº3 çš„æœ€å¤§å€¼äº†ï¼Œä¹Ÿå°±æ˜¯è¦æ‰¾çš„å…ƒç´ ã€‚&lt;/p>
&lt;p>æ‰¾åˆ°åˆé€‚çš„ä½ç½®ï¼Œæ¥ä¸‹æ¥å°±æ˜¯æŠŠnode 3 æ’å…¥è¿›å»äº†ï¼Œå¹¶æŠŠspanè°ƒæ•´ä¸€ä¸‹ã€‚&lt;/p>
&lt;p>åœ¨ç¡®å®šå¥½è¦æ’å…¥çš„ä½ç½®åï¼Œè¿˜è¦ç¡®å®šnode3å…ƒç´ çš„levelé«˜åº¦ï¼Œè¿™ä¸ªé«˜åº¦æŒ‰ç…§ç†æƒ³çŠ¶æ€è·³è¡¨ä¸­é—´çš„nodeæ˜¯æœ€é«˜çš„ï¼Œç±»ä¼¼ä¸€ä¸ª &lt;strong>å±±&lt;/strong> å­—å‹ï¼Œå±±å­—çš„å·¦åŠè¾¹ï¼Œå†æ‰¾åˆ°ä¸­é—´çš„nodeï¼Œè¿™ä¸ªnodeæ˜¯æ¬¡é«˜çš„ï¼Œä»¥æ­¤ç±»æ¨ã€‚ä½†å®é™…ä¸Šï¼Œè·³è¡¨æ²¡æœ‰ä¸¥æ ¼æ‰§è¡Œè¿™ç§ç†æƒ³çŠ¶æ€ï¼Œnodeçš„é«˜åº¦æ˜¯é€šè¿‡ &lt;strong>éšæœº&lt;/strong> æ•°ç¡®å®šçš„ï¼Œä½ æ²¡çœ‹é”™ï¼Œå°±æ˜¯é€šè¿‡éšæœºæ•°ç¡®å®šã€‚è¿™ä¹Ÿå°±æ˜¯è·³è¡¨ç›¸å¯¹çº¢é»‘æ ‘å®ç°èµ·æ¥ç®€å•çš„åŸå› ã€‚&lt;/p>
&lt;p>è¿™æ˜¯éšæœºå‡½æ•°&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#6272a4">//è·³è¡¨åŠ ä¸€å±‚ç´¢å¼•çš„æ¦‚ç‡
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span>&lt;span style="color:#8be9fd;font-style:italic">var&lt;/span> SKIPLIST_P = &lt;span style="color:#bd93f9">0.25&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span>&lt;span style="color:#6272a4">//éšæœºç´¢å¼•çš„å±‚æ•°
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> (list &lt;span style="color:#ff79c6">*&lt;/span>SkipList) &lt;span style="color:#50fa7b">randLevel&lt;/span>() &lt;span style="color:#8be9fd">int&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span> level &lt;span style="color:#ff79c6">:=&lt;/span> &lt;span style="color:#bd93f9">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span> &lt;span style="color:#ff79c6">for&lt;/span> (rand.&lt;span style="color:#50fa7b">Uint32&lt;/span>()&lt;span style="color:#ff79c6">&amp;amp;&lt;/span>&lt;span style="color:#bd93f9">0xFFFF&lt;/span>) &amp;lt; &lt;span style="color:#8be9fd;font-style:italic">uint32&lt;/span>(&lt;span style="color:#bd93f9">0xFFFF&lt;/span>&lt;span style="color:#ff79c6">*&lt;/span>SKIPLIST_P) &lt;span style="color:#ff79c6">&amp;amp;&amp;amp;&lt;/span> level &amp;lt; list.maxLevel {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span> level&lt;span style="color:#ff79c6">++&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> level
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> (list &lt;span style="color:#ff79c6">*&lt;/span>SkipList) &lt;span style="color:#50fa7b">randLevel&lt;/span>() &lt;span style="color:#8be9fd">int&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span> level &lt;span style="color:#ff79c6">:=&lt;/span> &lt;span style="color:#bd93f9">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3&lt;/span>&lt;span> &lt;span style="color:#ff79c6">for&lt;/span> rand.&lt;span style="color:#50fa7b">Int31n&lt;/span>(&lt;span style="color:#bd93f9">100&lt;/span>) &amp;lt; &lt;span style="color:#bd93f9">25&lt;/span> &lt;span style="color:#ff79c6">&amp;amp;&amp;amp;&lt;/span> level &amp;lt; list.maxLevel {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4&lt;/span>&lt;span> level&lt;span style="color:#ff79c6">++&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> level
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä¸Šé¢è¿™ä¸¤æ®µå‡½æ•°åŠŸèƒ½éƒ½æ˜¯ä¸€æ ·çš„ï¼Œéƒ½æ˜¯25%çš„æ¦‚ç‡è®©node çš„ level æ•°+1ã€‚&lt;/p>
&lt;p>ä¸‹é¢å°±æ˜¯æ•´ä¸ªæ’å…¥nodeçš„æºç &lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#6272a4">//æ’å…¥ä¸€ä¸ªç»“ç‚¹
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> (list &lt;span style="color:#ff79c6">*&lt;/span>SkipList) &lt;span style="color:#50fa7b">InsertByScore&lt;/span>(score &lt;span style="color:#8be9fd">float64&lt;/span>, value ISkipListNode) &lt;span style="color:#ff79c6">*&lt;/span>SkipListNode {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span> rank &lt;span style="color:#ff79c6">:=&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">make&lt;/span>([]&lt;span style="color:#8be9fd">int64&lt;/span>, list.maxLevel)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span> update &lt;span style="color:#ff79c6">:=&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">make&lt;/span>([]&lt;span style="color:#ff79c6">*&lt;/span>SkipListNode, list.maxLevel)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span> t &lt;span style="color:#ff79c6">:=&lt;/span> list.head
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span> &lt;span style="color:#6272a4">//æœç´¢node
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">for&lt;/span> i &lt;span style="color:#ff79c6">:=&lt;/span> list.level &lt;span style="color:#ff79c6">-&lt;/span> &lt;span style="color:#bd93f9">1&lt;/span>; i &lt;span style="color:#ff79c6">&amp;gt;=&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>; i&lt;span style="color:#ff79c6">--&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> i &lt;span style="color:#ff79c6">==&lt;/span> list.level&lt;span style="color:#ff79c6">-&lt;/span>&lt;span style="color:#bd93f9">1&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span> rank[i] = &lt;span style="color:#bd93f9">0&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span> } &lt;span style="color:#ff79c6">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span> rank[i] = rank[i&lt;span style="color:#ff79c6">+&lt;/span>&lt;span style="color:#bd93f9">1&lt;/span>]
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span> &lt;span style="color:#6272a4">//å½“å‰å±‚çš„ä¸‹ä¸€ä¸ªç»“ç‚¹å­˜åœ¨ &amp;amp;&amp;amp; (ä¸‹ä¸€ä¸ªç»“ç‚¹score&amp;lt;score || å½“scoreç›¸åŒæ—¶,æ¯”è¾ƒè¿™ä¸¤ä¸ªç»“ç‚¹,ä¸‹ä¸€ä¸ªç»“ç‚¹&amp;lt;æ–°æ’å…¥çš„ç»“ç‚¹)
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">for&lt;/span> t.&lt;span style="color:#50fa7b">Next&lt;/span>(i) &lt;span style="color:#ff79c6">!=&lt;/span> &lt;span style="color:#ff79c6">nil&lt;/span> &lt;span style="color:#ff79c6">&amp;amp;&amp;amp;&lt;/span> (t.&lt;span style="color:#50fa7b">Next&lt;/span>(i).score &amp;lt; score &lt;span style="color:#ff79c6">||&lt;/span> (t.&lt;span style="color:#50fa7b">Next&lt;/span>(i).score &lt;span style="color:#ff79c6">==&lt;/span> value.&lt;span style="color:#50fa7b">Score&lt;/span>() &lt;span style="color:#ff79c6">&amp;amp;&amp;amp;&lt;/span> t.&lt;span style="color:#50fa7b">Next&lt;/span>(i).value.&lt;span style="color:#50fa7b">Compare&lt;/span>(value) &amp;lt; &lt;span style="color:#bd93f9">0&lt;/span>)) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15&lt;/span>&lt;span> rank[i] &lt;span style="color:#ff79c6">+=&lt;/span> t.level[i].span
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16&lt;/span>&lt;span> t = t.&lt;span style="color:#50fa7b">Next&lt;/span>(i)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18&lt;/span>&lt;span> update[i] = t
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21&lt;/span>&lt;span> level &lt;span style="color:#ff79c6">:=&lt;/span> list.&lt;span style="color:#50fa7b">randLevel&lt;/span>()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> level &amp;gt; list.level {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24&lt;/span>&lt;span> &lt;span style="color:#6272a4">//å¤„ç†rand levelå, level&amp;gt;å½“å‰levelåçš„æƒ…å†µ
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">for&lt;/span> i &lt;span style="color:#ff79c6">:=&lt;/span> list.level; i &amp;lt; level; i&lt;span style="color:#ff79c6">++&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26&lt;/span>&lt;span> rank[i] = &lt;span style="color:#bd93f9">0&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27&lt;/span>&lt;span> update[i] = list.head
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28&lt;/span>&lt;span> update[i].&lt;span style="color:#50fa7b">SetSpan&lt;/span>(i, list.size)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30&lt;/span>&lt;span> list.level = level
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32&lt;/span>&lt;span> newNode &lt;span style="color:#ff79c6">:=&lt;/span> &lt;span style="color:#50fa7b">NewSkipListNode&lt;/span>(level, score, value)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33&lt;/span>&lt;span> &lt;span style="color:#6272a4">//æ’å…¥æ–°çš„node
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">for&lt;/span> i &lt;span style="color:#ff79c6">:=&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>; i &amp;lt; level; i&lt;span style="color:#ff79c6">++&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35&lt;/span>&lt;span> newNode.&lt;span style="color:#50fa7b">SetNext&lt;/span>(i, update[i].&lt;span style="color:#50fa7b">Next&lt;/span>(i))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36&lt;/span>&lt;span> update[i].&lt;span style="color:#50fa7b">SetNext&lt;/span>(i, newNode)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38&lt;/span>&lt;span> newNode.&lt;span style="color:#50fa7b">SetSpan&lt;/span>(i, update[i].&lt;span style="color:#50fa7b">Span&lt;/span>(i)&lt;span style="color:#ff79c6">-&lt;/span>(rank[&lt;span style="color:#bd93f9">0&lt;/span>]&lt;span style="color:#ff79c6">-&lt;/span>rank[i]))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39&lt;/span>&lt;span> update[i].&lt;span style="color:#50fa7b">SetSpan&lt;/span>(i, rank[&lt;span style="color:#bd93f9">0&lt;/span>]&lt;span style="color:#ff79c6">-&lt;/span>rank[i]&lt;span style="color:#ff79c6">+&lt;/span>&lt;span style="color:#bd93f9">1&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42&lt;/span>&lt;span> &lt;span style="color:#6272a4">//å¤„ç†æ–°å¢ç»“ç‚¹çš„span
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">for&lt;/span> i &lt;span style="color:#ff79c6">:=&lt;/span> level; i &amp;lt; list.level; i&lt;span style="color:#ff79c6">++&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44&lt;/span>&lt;span> update[i].level[i].span&lt;span style="color:#ff79c6">++&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46&lt;/span>&lt;span> &lt;span style="color:#6272a4">//å¤„ç†æ–°èŠ‚ç‚¹çš„åé€€æŒ‡é’ˆ
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">if&lt;/span> update[&lt;span style="color:#bd93f9">0&lt;/span>] &lt;span style="color:#ff79c6">==&lt;/span> list.head {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48&lt;/span>&lt;span> newNode.backward = &lt;span style="color:#ff79c6">nil&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49&lt;/span>&lt;span> } &lt;span style="color:#ff79c6">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50&lt;/span>&lt;span> newNode.backward = update[&lt;span style="color:#bd93f9">0&lt;/span>]
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">51&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">52&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">53&lt;/span>&lt;span> &lt;span style="color:#6272a4">//åˆ¤æ–­æ–°æ’å…¥çš„èŠ‚ç‚¹æ˜¯ä¸æ˜¯æœ€åä¸€ä¸ªèŠ‚ç‚¹
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">54&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">if&lt;/span> newNode.&lt;span style="color:#50fa7b">Next&lt;/span>(&lt;span style="color:#bd93f9">0&lt;/span>) &lt;span style="color:#ff79c6">!=&lt;/span> &lt;span style="color:#ff79c6">nil&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">55&lt;/span>&lt;span> newNode.&lt;span style="color:#50fa7b">Next&lt;/span>(&lt;span style="color:#bd93f9">0&lt;/span>).backward = newNode
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">56&lt;/span>&lt;span> } &lt;span style="color:#ff79c6">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">57&lt;/span>&lt;span> &lt;span style="color:#6272a4">//å¦‚æœæ˜¯æœ€åä¸€ä¸ªèŠ‚ç‚¹,å°±è®©tailæŒ‡é’ˆæŒ‡å‘è¿™æ–°æ’å…¥çš„èŠ‚ç‚¹
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">58&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> list.tail = newNode
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">59&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">60&lt;/span>&lt;span> list.size&lt;span style="color:#ff79c6">++&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">61&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> newNode
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">62&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>åœ¨æœç´¢è¿‡ç¨‹ä¸­ï¼Œéœ€è¦ä¸€ä¸ª &lt;strong>rank&lt;/strong> æ•°ç»„å’Œä¸€ä¸ª &lt;strong>update&lt;/strong> æ•°ç»„ è¿™ä¸¤ä¸ªè¾…åŠ©ç»“æ„ã€‚
rankç”¨æ¥è®°å½•æ¯å±‚çš„æ’åå€¼ï¼Œç”¨æ¥åé¢è°ƒæ•´æ–°node çš„rank ä½¿ç”¨ã€‚ updateç”¨æ¥è®°å½•ä»ä¸Šè€Œä¸‹ç»è¿‡çš„è·¯å¾„ï¼Œä¹Ÿå°±æ˜¯æ–°nodeçš„æ¯ä¸€å±‚åœ¨è·³è¡¨ä¸­çš„ä¸Šä¸€ä¸ªnodeã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span> &lt;span style="color:#6272a4">//å½“å‰å±‚çš„ä¸‹ä¸€ä¸ªç»“ç‚¹å­˜åœ¨ &amp;amp;&amp;amp; (ä¸‹ä¸€ä¸ªç»“ç‚¹score&amp;lt;score || å½“scoreç›¸åŒæ—¶,æ¯”è¾ƒè¿™ä¸¤ä¸ªç»“ç‚¹,ä¸‹ä¸€ä¸ªç»“ç‚¹&amp;lt;æ–°æ’å…¥çš„ç»“ç‚¹)
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">for&lt;/span> t.&lt;span style="color:#50fa7b">Next&lt;/span>(i) &lt;span style="color:#ff79c6">!=&lt;/span> &lt;span style="color:#ff79c6">nil&lt;/span> &lt;span style="color:#ff79c6">&amp;amp;&amp;amp;&lt;/span> (t.&lt;span style="color:#50fa7b">Next&lt;/span>(i).score &amp;lt; score &lt;span style="color:#ff79c6">||&lt;/span> (t.&lt;span style="color:#50fa7b">Next&lt;/span>(i).score &lt;span style="color:#ff79c6">==&lt;/span> value.&lt;span style="color:#50fa7b">Score&lt;/span>() &lt;span style="color:#ff79c6">&amp;amp;&amp;amp;&lt;/span> t.&lt;span style="color:#50fa7b">Next&lt;/span>(i).value.&lt;span style="color:#50fa7b">Compare&lt;/span>(value) &amp;lt; &lt;span style="color:#bd93f9">0&lt;/span>)) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3&lt;/span>&lt;span> rank[i] &lt;span style="color:#ff79c6">+=&lt;/span> t.level[i].span
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4&lt;/span>&lt;span> t = t.&lt;span style="color:#50fa7b">Next&lt;/span>(i)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä¸Šé¢æ˜¯æœç´¢è¿‡ç¨‹ä¸­ï¼Œåˆ¤æ–­æ˜¯å³ç§»è¿˜æ˜¯è°ƒåˆ°ä¸‹ä¸€å±‚çš„é€»è¾‘ã€‚è¿™é‡Œä¸æ­¢éœ€è¦åˆ¤æ–­nodeçš„socoreï¼Œè¿˜è¦è€ƒè™‘ä¸¤ä¸ªnode çš„ scoreç›¸åŒçš„æƒ…å†µï¼Œä¸¤ä¸ªnode çš„ socreç›¸åŒæ—¶ï¼Œéœ€è¦é€šè¿‡&lt;strong>Compare&lt;/strong> å‡½æ•°åˆ¤æ–­ä¸¤ä¸ªnodeçš„å¤§å°ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span> level &lt;span style="color:#ff79c6">:=&lt;/span> list.&lt;span style="color:#50fa7b">randLevel&lt;/span>()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> level &amp;gt; list.level {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span> &lt;span style="color:#6272a4">//å¤„ç†rand levelå, level&amp;gt;å½“å‰levelåçš„æƒ…å†µ
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">for&lt;/span> i &lt;span style="color:#ff79c6">:=&lt;/span> list.level; i &amp;lt; level; i&lt;span style="color:#ff79c6">++&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span> rank[i] = &lt;span style="color:#bd93f9">0&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span> update[i] = list.head
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span> update[i].&lt;span style="color:#50fa7b">SetSpan&lt;/span>(i, list.size)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span> list.level = level
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™æ®µä»£ç ï¼Œæ˜¯ç¡®å®šæ–°nodeçš„é«˜åº¦åï¼Œå¤„ç†ä¸€ä¸‹æ–°åŠ å±‚çš„ã€‚å› ä¸ºåœ¨æœç´¢çš„æ—¶å€™ï¼Œæ²¡æœ‰æŠŠç°åœ¨é«˜å‡ºå±‚æ•°çš„headæ”¾åˆ°updateä¸­ï¼Œç°åœ¨æ”¾åˆ°å…¶ä¸­ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span> &lt;span style="color:#6272a4">//æ’å…¥æ–°çš„node
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">for&lt;/span> i &lt;span style="color:#ff79c6">:=&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>; i &amp;lt; level; i&lt;span style="color:#ff79c6">++&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3&lt;/span>&lt;span> newNode.&lt;span style="color:#50fa7b">SetNext&lt;/span>(i, update[i].&lt;span style="color:#50fa7b">Next&lt;/span>(i))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4&lt;/span>&lt;span> update[i].&lt;span style="color:#50fa7b">SetNext&lt;/span>(i, newNode)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6&lt;/span>&lt;span> newNode.&lt;span style="color:#50fa7b">SetSpan&lt;/span>(i, update[i].&lt;span style="color:#50fa7b">Span&lt;/span>(i)&lt;span style="color:#ff79c6">-&lt;/span>(rank[&lt;span style="color:#bd93f9">0&lt;/span>]&lt;span style="color:#ff79c6">-&lt;/span>rank[i]))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7&lt;/span>&lt;span> update[i].&lt;span style="color:#50fa7b">SetSpan&lt;/span>(i, rank[&lt;span style="color:#bd93f9">0&lt;/span>]&lt;span style="color:#ff79c6">-&lt;/span>rank[i]&lt;span style="color:#ff79c6">+&lt;/span>&lt;span style="color:#bd93f9">1&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™æ®µä»£ç æ˜¯é€šè¿‡è°ƒæ•´nodeçš„å‰åæŒ‡é’ˆï¼Œå°†æ–°çš„nodeåŠ å…¥åˆ°è·³è¡¨ä¸­ã€‚å¹¶ä¸”è°ƒæ•´nodeçš„spanå€¼ã€‚è¿™æ—¶å€™ï¼Œspanå€¼æ˜¯åˆ°ä¸‹ä¸ªnodeçš„è·ç¦»è€Œä¸æ˜¯ä¸Šä¸ªnodeåˆ°è¿™çš„è·ç¦»çš„å¥½å¤„å°±æç°å‡ºæ¥äº†ï¼Œå› ä¸ºæ˜¯åˆ°ä¸‹ä¸ªnodeçš„è·ç¦»ï¼Œåªéœ€è¦æ”¹å½“å‰nodeçš„spanå€¼å°±å¥½äº†ï¼Œå¦‚æœå­˜çš„æ˜¯ä¸Šä¸ªnodeåˆ°è¿™ä¸ªnodeçš„è·ç¦»ï¼Œå°±éœ€è¦æ”¹ä¸‹ä¸ªnodeçš„spanäº†ï¼Œæ”¹åŠ¨èµ·äº†å°±ä¼šéº»çƒ¦äº†ã€‚è¯´çš„å¯èƒ½æœ‰ç‚¹å•°å—¦ï¼Œè‡ªå·±æ¨å¯¼ä¸€éå°±èƒ½ä½“ä¼šå‡ºæ¥äº†ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span> &lt;span style="color:#6272a4">//å¤„ç†æ–°å¢ç»“ç‚¹çš„span
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">for&lt;/span> i &lt;span style="color:#ff79c6">:=&lt;/span> level; i &amp;lt; list.level; i&lt;span style="color:#ff79c6">++&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3&lt;/span>&lt;span> update[i].level[i].span&lt;span style="color:#ff79c6">++&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™æ®µå¯èƒ½æ˜¯ä¸å¤ªå¥½ç†è§£çš„ï¼Œè¿™æ®µä»£ç çš„ä½œç”¨æ˜¯ï¼Œå¦‚æœæ–°nodeçš„levelå°äºè·³è¡¨ä¸­çš„æœ€å¤§levelæ—¶ï¼ˆæ–°nodeçš„levelæ˜¯2ï¼Œæ­¤æ—¶è·³è¡¨ä¸­æœ€å¤§çš„levelæ˜¯5çš„æƒ…å†µï¼‰ï¼Œè¿™æ—¶å€™è¦æŠŠ2ä¸Šé¢çš„æ‰€æœ‰çš„nodeçš„span+1ã€‚&lt;/p>
&lt;p>å‰©ä¸‹çš„ï¼Œå¤„ç†æ–°nodeçš„åé€€æŒ‡é’ˆï¼ˆbackwardï¼‰å’Œåˆ¤æ–­æ˜¯å¦æ˜¯æœ€åä¸€ä¸ªnodeï¼Œçš„æƒ…å†µå°±å¾ˆç®€å•äº†ã€‚&lt;/p>
&lt;p>åˆ°ç°åœ¨ï¼Œæ’å…¥nodeå°±å®Œæˆäº†ï¼Œæ˜¯ä¸æ˜¯ä¹Ÿä¸éš¾å˜›ï¼Œå¯¹ä¸å¯¹ã€‚å…¶å®è·³è¡¨ä¸­æœ€å¤æ‚çš„å°±æ˜¯æ’å…¥è¿‡ç¨‹äº†ï¼Œå‰©ä¸‹çš„åˆ é™¤ï¼Œæ›´æ–°ï¼ŒæŸ¥æ‰¾å°±æ˜¯å·®ä¸å¤šçš„é€»è¾‘ï¼Œå…ˆæ‰¾åˆ°å…³é”®nodeï¼Œå†åšå¤„ç†ã€‚&lt;/p>
&lt;h3 id="åˆ é™¤node">&lt;a href="#%e5%88%a0%e9%99%a4node" class="header-anchor">&lt;/a>åˆ é™¤node
&lt;/h3>&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-796f3d16ab6ea01a.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-796f3d16ab6ea01a.webp" alt="åˆ é™¤node" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>åŒæ ·çš„ï¼Œåˆ é™¤ä¹Ÿæ˜¯è¦å…ˆæœç´¢ï¼Œé€šè¿‡é»‘è‰²ç®­å¤´çš„è·¯å¾„ï¼Œæ‰¾åˆ°è¦åˆ é™¤çš„nodeå‰ä¸€ä¸ªï¼Œç„¶åä¿®æ”¹ç›®æ ‡nodeçš„ä¸Šä¸€ä¸ªnodeçš„æŒ‡é’ˆ,è·³è¿‡ç›®æ ‡node,å®Œæˆåˆ é™¤,æœ€åè°ƒæ•´ç›®æ ‡nodeå‰é¢nodeçš„spanå€¼ã€‚&lt;/p>
&lt;p>å…ˆæœç´¢node,å¹¶è®°å½•åˆ°updateæ•°ç»„&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#6272a4">//è·å–æ‰¾åˆ°è¯¥ç»“ç‚¹çš„å„å±‚ç»“ç‚¹(è·¯å¾„)
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> (list &lt;span style="color:#ff79c6">*&lt;/span>SkipList) &lt;span style="color:#50fa7b">GetUpdateList&lt;/span>(node &lt;span style="color:#ff79c6">*&lt;/span>SkipListNode) (update []&lt;span style="color:#ff79c6">*&lt;/span>SkipListNode) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span> update = &lt;span style="color:#8be9fd;font-style:italic">make&lt;/span>([]&lt;span style="color:#ff79c6">*&lt;/span>SkipListNode, list.maxLevel)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span> t &lt;span style="color:#ff79c6">:=&lt;/span> list.head
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span> &lt;span style="color:#ff79c6">for&lt;/span> i &lt;span style="color:#ff79c6">:=&lt;/span> list.level &lt;span style="color:#ff79c6">-&lt;/span> &lt;span style="color:#bd93f9">1&lt;/span>; i &lt;span style="color:#ff79c6">&amp;gt;=&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>; i&lt;span style="color:#ff79c6">--&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span> &lt;span style="color:#ff79c6">for&lt;/span> t.&lt;span style="color:#50fa7b">Next&lt;/span>(i) &lt;span style="color:#ff79c6">!=&lt;/span> &lt;span style="color:#ff79c6">nil&lt;/span> &lt;span style="color:#ff79c6">&amp;amp;&amp;amp;&lt;/span> (t.&lt;span style="color:#50fa7b">Next&lt;/span>(i).score &amp;lt; node.score &lt;span style="color:#ff79c6">||&lt;/span> (t.&lt;span style="color:#50fa7b">Next&lt;/span>(i).score &lt;span style="color:#ff79c6">==&lt;/span> node.score &lt;span style="color:#ff79c6">&amp;amp;&amp;amp;&lt;/span> t.&lt;span style="color:#50fa7b">Next&lt;/span>(i).value.&lt;span style="color:#50fa7b">Compare&lt;/span>(node.value) &amp;lt; &lt;span style="color:#bd93f9">0&lt;/span>)) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span> t = t.&lt;span style="color:#50fa7b">Next&lt;/span>(i)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span> update[i] = t
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™æ®µé€»è¾‘å’Œæ’å…¥æ—¶çš„æœç´¢é€»è¾‘ä¸€æ ·&lt;/p>
&lt;p>ä¸‹é¢æ˜¯åˆ é™¤çš„é€»è¾‘&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#6272a4">//åˆ é™¤å¯¹åº”çš„ç»“ç‚¹
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> (list &lt;span style="color:#ff79c6">*&lt;/span>SkipList) &lt;span style="color:#50fa7b">Delete&lt;/span>(node &lt;span style="color:#ff79c6">*&lt;/span>SkipListNode, update []&lt;span style="color:#ff79c6">*&lt;/span>SkipListNode) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> node &lt;span style="color:#ff79c6">==&lt;/span> &lt;span style="color:#ff79c6">nil&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span> &lt;span style="color:#6272a4">//head ä¸èƒ½åˆ 
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">if&lt;/span> node &lt;span style="color:#ff79c6">==&lt;/span> list.head {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span> &lt;span style="color:#ff79c6">for&lt;/span> i &lt;span style="color:#ff79c6">:=&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>; i &amp;lt; list.level; i&lt;span style="color:#ff79c6">++&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> update[i].&lt;span style="color:#50fa7b">Next&lt;/span>(i) &lt;span style="color:#ff79c6">==&lt;/span> node {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span> &lt;span style="color:#6272a4">//ä¿®æ”¹span
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> update[i].&lt;span style="color:#50fa7b">SetSpan&lt;/span>(i, update[i].&lt;span style="color:#50fa7b">Span&lt;/span>(i)&lt;span style="color:#ff79c6">+&lt;/span>node.&lt;span style="color:#50fa7b">Span&lt;/span>(i)&lt;span style="color:#ff79c6">-&lt;/span>&lt;span style="color:#bd93f9">1&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15&lt;/span>&lt;span> &lt;span style="color:#6272a4">//åˆ é™¤å¯¹åº”çš„ç»“ç‚¹
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> update[i].&lt;span style="color:#50fa7b">SetNext&lt;/span>(i, node.&lt;span style="color:#50fa7b">Next&lt;/span>(i))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17&lt;/span>&lt;span> } &lt;span style="color:#ff79c6">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18&lt;/span>&lt;span> update[i].level[i].span&lt;span style="color:#ff79c6">--&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22&lt;/span>&lt;span> &lt;span style="color:#6272a4">//å¤„ç†nodeçš„åæŒ‡é’ˆ
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">if&lt;/span> node.&lt;span style="color:#50fa7b">Next&lt;/span>(&lt;span style="color:#bd93f9">0&lt;/span>) &lt;span style="color:#ff79c6">==&lt;/span> &lt;span style="color:#ff79c6">nil&lt;/span> { &lt;span style="color:#6272a4">//nodeæ˜¯æœ€åä¸€ä¸ª,æŠŠtailæŒ‡é’ˆæŒ‡å‘nodeçš„ä¸Šä¸€ä¸ª(update[0])
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> list.tail = update[&lt;span style="color:#bd93f9">0&lt;/span>]
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25&lt;/span>&lt;span> } &lt;span style="color:#ff79c6">else&lt;/span> { &lt;span style="color:#6272a4">//nodeä¸æ˜¯æœ€åä¸€ä¸ª,nodeçš„ä¸‹ä¸€ä¸ªæŒ‡å‘nodeçš„ä¸Šä¸€ä¸ª(update[0])
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> node.&lt;span style="color:#50fa7b">Next&lt;/span>(&lt;span style="color:#bd93f9">0&lt;/span>).backward = update[&lt;span style="color:#bd93f9">0&lt;/span>]
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29&lt;/span>&lt;span> &lt;span style="color:#6272a4">//å¤„ç†åˆ æ‰çš„æ˜¯æœ€é«˜levelçš„æƒ…å†µ,å½“å‰çš„levelè¦å¯¹åº”çš„--
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">for&lt;/span> list.level &amp;gt; &lt;span style="color:#bd93f9">1&lt;/span> &lt;span style="color:#ff79c6">&amp;amp;&amp;amp;&lt;/span> list.head.&lt;span style="color:#50fa7b">Next&lt;/span>(list.level&lt;span style="color:#ff79c6">-&lt;/span>&lt;span style="color:#bd93f9">1&lt;/span>) &lt;span style="color:#ff79c6">==&lt;/span> &lt;span style="color:#ff79c6">nil&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31&lt;/span>&lt;span> list.level&lt;span style="color:#ff79c6">--&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34&lt;/span>&lt;span> list.size&lt;span style="color:#ff79c6">--&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>åˆ é™¤nodeçš„ä»£ç å°±ç®€å•å¤šäº†ï¼Œè¿™é‡Œé€šè¿‡å‚æ•°ä¼ å…¥ä»æœ€é«˜åˆ°æ‰¾åˆ°nodeçš„è·¯å¾„ï¼Œä¹Ÿå°±æ˜¯updateæ•°ç»„ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span> &lt;span style="color:#ff79c6">for&lt;/span> i &lt;span style="color:#ff79c6">:=&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>; i &amp;lt; list.level; i&lt;span style="color:#ff79c6">++&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> update[i].&lt;span style="color:#50fa7b">Next&lt;/span>(i) &lt;span style="color:#ff79c6">==&lt;/span> node {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span> &lt;span style="color:#6272a4">//ä¿®æ”¹span
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> update[i].&lt;span style="color:#50fa7b">SetSpan&lt;/span>(i, update[i].&lt;span style="color:#50fa7b">Span&lt;/span>(i)&lt;span style="color:#ff79c6">+&lt;/span>node.&lt;span style="color:#50fa7b">Span&lt;/span>(i)&lt;span style="color:#ff79c6">-&lt;/span>&lt;span style="color:#bd93f9">1&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span> &lt;span style="color:#6272a4">//åˆ é™¤å¯¹åº”çš„ç»“ç‚¹
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> update[i].&lt;span style="color:#50fa7b">SetNext&lt;/span>(i, node.&lt;span style="color:#50fa7b">Next&lt;/span>(i))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span> } &lt;span style="color:#ff79c6">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span> update[i].level[i].span&lt;span style="color:#ff79c6">--&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™ä¸ªæ®µé€»è¾‘å°±æ˜¯åˆ é™¤nodeçš„ï¼Œåˆ é™¤è¯´ç™½äº†å°±æ˜¯è®©ç›®æ ‡nodeçš„å‰é¢çš„nodeçš„åæŒ‡é’ˆæŒ‡å‘ç›®æ ‡nodeåé¢çš„nodeã€‚
å‰©ä¸‹çš„å°±æ˜¯å¤„ç†nodeçš„åé€€æŒ‡é’ˆå’Œåˆ¤æ–­æ˜¯å¦æ˜¯æœ€åä¸€ä¸ªnodeäº†ã€‚&lt;/p>
&lt;h3 id="æ›´æ–°node">&lt;a href="#%e6%9b%b4%e6%96%b0node" class="header-anchor">&lt;/a>æ›´æ–°node
&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#6272a4">//æ›´æ–°ç»“ç‚¹çš„score
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> (list &lt;span style="color:#ff79c6">*&lt;/span>SkipList) &lt;span style="color:#50fa7b">UpdateScore&lt;/span>(node &lt;span style="color:#ff79c6">*&lt;/span>SkipListNode, score &lt;span style="color:#8be9fd">float64&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> score &lt;span style="color:#ff79c6">==&lt;/span> node.score {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span> &lt;span style="color:#6272a4">//æ›´æ–°å,åˆ†æ•°è¿˜æ˜¯ &amp;lt; next nodeçš„ä½ç½®ä¸ç”¨å˜
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">if&lt;/span> score &amp;gt; node.score {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> node.&lt;span style="color:#50fa7b">Next&lt;/span>(&lt;span style="color:#bd93f9">0&lt;/span>) &lt;span style="color:#ff79c6">!=&lt;/span> &lt;span style="color:#ff79c6">nil&lt;/span> &lt;span style="color:#ff79c6">&amp;amp;&amp;amp;&lt;/span> score &amp;lt; node.&lt;span style="color:#50fa7b">Next&lt;/span>(&lt;span style="color:#bd93f9">0&lt;/span>).score {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span> node.score = score
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span> &lt;span style="color:#6272a4">//æ›´æ–°å,åˆ†æ•°è¿˜æ˜¯ &amp;gt; per nodeçš„ä½ç½®ä¸ç”¨å˜
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">if&lt;/span> score &amp;lt; node.score {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> node.&lt;span style="color:#50fa7b">Pre&lt;/span>() &lt;span style="color:#ff79c6">!=&lt;/span> &lt;span style="color:#ff79c6">nil&lt;/span> &lt;span style="color:#ff79c6">&amp;amp;&amp;amp;&lt;/span> score &amp;gt; node.&lt;span style="color:#50fa7b">Pre&lt;/span>().score {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17&lt;/span>&lt;span> node.score = score
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21&lt;/span>&lt;span> &lt;span style="color:#6272a4">//åˆ æ‰node,é‡æ–°æ’å…¥
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> updateList &lt;span style="color:#ff79c6">:=&lt;/span> list.&lt;span style="color:#50fa7b">GetUpdateList&lt;/span>(node)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23&lt;/span>&lt;span> list.&lt;span style="color:#50fa7b">Delete&lt;/span>(node, updateList)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24&lt;/span>&lt;span> &lt;span style="color:#6272a4">//é‡æ–°æ’å…¥
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> list.&lt;span style="color:#50fa7b">InsertByScore&lt;/span>(score, node.value)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æ›´æ–°nodeçš„scoreï¼Œæ›´æ–°nodeçš„å‰ææ˜¯æ‰¾åˆ°ç›®æ ‡nodeï¼ŒåŸç†å’Œå‰é¢çš„æ’å…¥ï¼Œåˆ é™¤æ—¶çš„æœç´¢é€»è¾‘ä¸€æ ·ï¼Œå°±ä¸èµ˜è¿°äº†ã€‚
è¯´ä¸€ä¸‹æ›´æ–°node scoreçš„é€»è¾‘æŠŠï¼Œæœ€ç®€å•å°±æ˜¯æŠŠnodeåˆ äº†ï¼Œç„¶åå†æ’å…¥ã€‚å½“ç„¶è¿™æ ·çš„é€»è¾‘æ˜¯å¯ä»¥ä¼˜åŒ–çš„ï¼Œæ¯”å¦‚æœ‰ä¸€ç§æƒ…å†µ&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-f323e13d9f1fe929.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-f323e13d9f1fe929.webp" alt="æ›´æ–°node" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>å¦‚å›¾æ‰€ç¤ºï¼Œè¦æŠŠnode4çš„scoreæ›´æ–°æˆ5ï¼Œè¿™æ—¶å€™ä¿®æ”¹nodeçš„scoreä¸å½±å“nodeçš„ä½ç½®ï¼Œæ‰€ä»¥è¿™ç§æƒ…å†µå°±åªéœ€è¦ä¿®æ”¹nodeçš„scoreå°±å¥½äº†ï¼Œä¸ç”¨è€ƒè™‘nodeåœ¨è·³è¡¨ä¸­çš„ä½ç½®ã€‚&lt;/p>
&lt;p>å¯¹äºé‚£ç§ä¿®æ”¹åˆ†æ•°ä¼šæ”¹å˜ä½ç½®çš„æƒ…å†µï¼Œå°±éœ€è¦å…ˆåˆ é™¤nodeï¼Œå†é‡æ–°æ’å…¥nodeäº†ã€‚&lt;/p>
&lt;h3 id="æŸ¥æ‰¾node">&lt;a href="#%e6%9f%a5%e6%89%benode" class="header-anchor">&lt;/a>æŸ¥æ‰¾node
&lt;/h3>&lt;p>çœ‹åˆ°è¿™é‡Œï¼ŒæŸ¥æ‰¾nodeåº”è¯¥æ˜¯éå¸¸ç®€å•äº†å§ï¼Œå› ä¸ºå‰é¢çš„æ’å…¥ï¼Œæ›´æ–°ï¼Œåˆ é™¤éƒ½éœ€è¦å‰æŸ¥æ‰¾nodeã€‚ä½†æ˜¯æŸ¥æ‰¾åˆ†ä¸¤ç§æƒ…å†µï¼Œä¸€ç§æ˜¯æ ¹æ®æ’åæŸ¥æ‰¾ï¼Œå¦ä¸€ç§æ˜¯æ ¹æ®scoreæŸ¥æ‰¾ã€‚&lt;/p>
&lt;p>å…ˆçœ‹æ ¹æ®æ’åæŸ¥æ‰¾&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#6272a4">//æ ¹æ®æ’å èŒƒå›´ æŸ¥æ‰¾ node
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> (list &lt;span style="color:#ff79c6">*&lt;/span>SkipList) &lt;span style="color:#50fa7b">GetNodeByRank&lt;/span>(left, right &lt;span style="color:#8be9fd">int64&lt;/span>) (result []&lt;span style="color:#ff79c6">*&lt;/span>SkipListNode) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span> &lt;span style="color:#6272a4">//èŒƒå›´å‡ºé”™
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">if&lt;/span> list.&lt;span style="color:#50fa7b">Size&lt;/span>() &lt;span style="color:#ff79c6">==&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span> &lt;span style="color:#ff79c6">||&lt;/span> left &lt;span style="color:#ff79c6">==&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span> &lt;span style="color:#ff79c6">||&lt;/span> right &lt;span style="color:#ff79c6">==&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span> &lt;span style="color:#ff79c6">||&lt;/span> right &amp;lt; left &lt;span style="color:#ff79c6">||&lt;/span> left &amp;gt; list.&lt;span style="color:#50fa7b">Size&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span> tRank &lt;span style="color:#ff79c6">:=&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">int64&lt;/span>(&lt;span style="color:#bd93f9">0&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span> t &lt;span style="color:#ff79c6">:=&lt;/span> list.head
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span> result = &lt;span style="color:#8be9fd;font-style:italic">make&lt;/span>([]&lt;span style="color:#ff79c6">*&lt;/span>SkipListNode, &lt;span style="color:#bd93f9">0&lt;/span>, right&lt;span style="color:#ff79c6">-&lt;/span>left&lt;span style="color:#ff79c6">+&lt;/span>&lt;span style="color:#bd93f9">1&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span> &lt;span style="color:#6272a4">//å…ˆæ‰¾åˆ°æ’åæœ€å°çš„å…ƒç´ ,ç„¶åå‘å³ä¸€ç‚¹ç‚¹æŸ¥æ‰¾,ç›´åˆ°æ‰¾åˆ°æ’åæœ€å¤§çš„å…ƒç´ 
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">for&lt;/span> i &lt;span style="color:#ff79c6">:=&lt;/span> list.level &lt;span style="color:#ff79c6">-&lt;/span> &lt;span style="color:#bd93f9">1&lt;/span>; i &lt;span style="color:#ff79c6">&amp;gt;=&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>; i&lt;span style="color:#ff79c6">--&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span> &lt;span style="color:#ff79c6">for&lt;/span> t.&lt;span style="color:#50fa7b">Next&lt;/span>(i) &lt;span style="color:#ff79c6">!=&lt;/span> &lt;span style="color:#ff79c6">nil&lt;/span> &lt;span style="color:#ff79c6">&amp;amp;&amp;amp;&lt;/span> tRank&lt;span style="color:#ff79c6">+&lt;/span>t.level[i].span &lt;span style="color:#ff79c6">&amp;lt;=&lt;/span> left {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span> tRank &lt;span style="color:#ff79c6">+=&lt;/span> t.level[i].span
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span> t = t.&lt;span style="color:#50fa7b">Next&lt;/span>(i)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> tRank &lt;span style="color:#ff79c6">==&lt;/span> left {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17&lt;/span>&lt;span> &lt;span style="color:#ff79c6">for&lt;/span> ; t &lt;span style="color:#ff79c6">!=&lt;/span> &lt;span style="color:#ff79c6">nil&lt;/span> &lt;span style="color:#ff79c6">&amp;amp;&amp;amp;&lt;/span> tRank &lt;span style="color:#ff79c6">&amp;lt;=&lt;/span> right; t = t.&lt;span style="color:#50fa7b">Next&lt;/span>(&lt;span style="color:#bd93f9">0&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18&lt;/span>&lt;span> result = &lt;span style="color:#8be9fd;font-style:italic">append&lt;/span>(result, t)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19&lt;/span>&lt;span> tRank&lt;span style="color:#ff79c6">++&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å…ˆæ’é™¤ä¸ç¬¦åˆçš„æƒ…å†µï¼Œå†æ ¹æ®ä¹‹å‰çš„æŸ¥æ‰¾é€»è¾‘ï¼Œä¸€æ­¥æ­¥å»æŸ¥æ‰¾ã€‚ä¸åŒçš„æ˜¯ï¼Œç°åœ¨çš„é™åˆ¶æ¡ä»¶æ—¶æ’åã€‚&lt;/p>
&lt;p>åœ¨çœ‹æ ¹æ®scoreæŸ¥æ‰¾&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span>&lt;span style="color:#6272a4">//åˆ¤æ–­ è¿™ä¸ªè·³è¡¨ çš„æœ€å¤§å€¼å’Œæœ€å°å€¼ æ˜¯å¦åŒ…å« è¦æŸ¥è¯¢çš„scoreèŒƒå›´
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> (list &lt;span style="color:#ff79c6">*&lt;/span>SkipList) &lt;span style="color:#50fa7b">ScoreInRange&lt;/span>(findRange &lt;span style="color:#ff79c6">*&lt;/span>SkipListFindRange) &lt;span style="color:#8be9fd">bool&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> !findRange.MaxInf &lt;span style="color:#ff79c6">&amp;amp;&amp;amp;&lt;/span> list.head.&lt;span style="color:#50fa7b">Next&lt;/span>(&lt;span style="color:#bd93f9">0&lt;/span>).score &amp;gt; findRange.Max {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> &lt;span style="color:#ff79c6">false&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> !findRange.MinInf &lt;span style="color:#ff79c6">&amp;amp;&amp;amp;&lt;/span> list.tail.score &amp;lt; findRange.Min {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> &lt;span style="color:#ff79c6">false&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> &lt;span style="color:#ff79c6">true&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span>&lt;span style="color:#6272a4">//æ ¹æ® score èŒƒå›´ æŸ¥æ‰¾ node
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> (list &lt;span style="color:#ff79c6">*&lt;/span>SkipList) &lt;span style="color:#50fa7b">GetNodeByScore&lt;/span>(findRange &lt;span style="color:#ff79c6">*&lt;/span>SkipListFindRange) (result []&lt;span style="color:#ff79c6">*&lt;/span>SkipListNode) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> findRange &lt;span style="color:#ff79c6">==&lt;/span> &lt;span style="color:#ff79c6">nil&lt;/span> &lt;span style="color:#ff79c6">||&lt;/span> list.&lt;span style="color:#50fa7b">Size&lt;/span>() &lt;span style="color:#ff79c6">==&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18&lt;/span>&lt;span> &lt;span style="color:#6272a4">//æŸ¥æ‰¾èŒƒå›´ä¸åœ¨è¿™è·³è¡¨ä¸­,ç›´æ¥return
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">if&lt;/span> !list.&lt;span style="color:#50fa7b">ScoreInRange&lt;/span>(findRange) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22&lt;/span>&lt;span> t &lt;span style="color:#ff79c6">:=&lt;/span> list.head
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> findRange.MinInf {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24&lt;/span>&lt;span> &lt;span style="color:#6272a4">//ä»å¤´å¼€å§‹æŸ¥æ‰¾
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> t = list.head.&lt;span style="color:#50fa7b">Next&lt;/span>(&lt;span style="color:#bd93f9">0&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26&lt;/span>&lt;span> } &lt;span style="color:#ff79c6">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27&lt;/span>&lt;span> &lt;span style="color:#6272a4">//ä¸æ˜¯ä»å¤´,æ‰¾åˆ°æœ€å°çš„é‚£ä¸ªå…ƒç´ 
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">for&lt;/span> i &lt;span style="color:#ff79c6">:=&lt;/span> list.level &lt;span style="color:#ff79c6">-&lt;/span> &lt;span style="color:#bd93f9">1&lt;/span>; i &lt;span style="color:#ff79c6">&amp;gt;=&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>; i&lt;span style="color:#ff79c6">--&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29&lt;/span>&lt;span> &lt;span style="color:#ff79c6">for&lt;/span> t.&lt;span style="color:#50fa7b">Next&lt;/span>(i) &lt;span style="color:#ff79c6">!=&lt;/span> &lt;span style="color:#ff79c6">nil&lt;/span> &lt;span style="color:#ff79c6">&amp;amp;&amp;amp;&lt;/span> t.&lt;span style="color:#50fa7b">Next&lt;/span>(i).score &amp;lt; findRange.Min {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30&lt;/span>&lt;span> t = t.&lt;span style="color:#50fa7b">Next&lt;/span>(i)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34&lt;/span>&lt;span> &lt;span style="color:#ff79c6">for&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35&lt;/span>&lt;span> &lt;span style="color:#6272a4">//ç¬¦åˆèŒƒå›´çš„æ¡ä»¶ (ä»è´Ÿæ— ç©· || å½“å‰çš„score &amp;gt;= æŸ¥æ‰¾çš„æœ€å°å€¼) &amp;amp;&amp;amp; (åˆ°æ­£æ— ç©· || å½“å‰å…ƒç´  &amp;lt;= æŸ¥æ‰¾çš„æœ€å¤§å€¼)
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">if&lt;/span> (findRange.MinInf &lt;span style="color:#ff79c6">||&lt;/span> t.score &lt;span style="color:#ff79c6">&amp;gt;=&lt;/span> findRange.Min) &lt;span style="color:#ff79c6">&amp;amp;&amp;amp;&lt;/span> (findRange.MaxInf &lt;span style="color:#ff79c6">||&lt;/span> t.score &lt;span style="color:#ff79c6">&amp;lt;=&lt;/span> findRange.Max) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37&lt;/span>&lt;span> result = &lt;span style="color:#8be9fd;font-style:italic">append&lt;/span>(result, t)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> t.&lt;span style="color:#50fa7b">Next&lt;/span>(&lt;span style="color:#bd93f9">0&lt;/span>) &lt;span style="color:#ff79c6">==&lt;/span> &lt;span style="color:#ff79c6">nil&lt;/span> &lt;span style="color:#ff79c6">||&lt;/span> (!findRange.MaxInf &lt;span style="color:#ff79c6">&amp;amp;&amp;amp;&lt;/span> t.&lt;span style="color:#50fa7b">Next&lt;/span>(&lt;span style="color:#bd93f9">0&lt;/span>).score &amp;gt; findRange.Max) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40&lt;/span>&lt;span> &lt;span style="color:#6272a4">//ä¸‹ä¸€ä¸ªå…ƒç´ æ˜¯ç©º(åˆ°å°¾äº†) || (ä¸æ˜¯æŸ¥æ‰¾åˆ°æ­£æ— ç©· &amp;amp;&amp;amp; ä¸‹ä¸€ä¸ªå…ƒç´ çš„ score &amp;gt; è¦æŸ¥æ‰¾çš„æœ€å¤§å€¼)
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">break&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42&lt;/span>&lt;span> } &lt;span style="color:#ff79c6">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43&lt;/span>&lt;span> &lt;span style="color:#6272a4">//å‘å³ç§»åŠ¨
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> t = t.&lt;span style="color:#50fa7b">Next&lt;/span>(&lt;span style="color:#bd93f9">0&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æ ¹æ®scoreæŸ¥æ‰¾ç¨å¾®å¤æ‚ä¸€ç‚¹ï¼Œå› ä¸ºæ ¹æ®scoreä¼šæœ‰æ­£æ— ç©·å’Œè´Ÿæ— ç©·è¿™ä¸¤ç§æƒ…å†µã€‚è¿™æ—¶å€™åªç»™ä¸¤ä¸ªç®€å•çš„èŒƒå›´å€¼å°±ä¸å¤Ÿç”¨äº†ï¼Œéœ€è¦ç”¨ä¸€ä¸ªç»“æ„ä½“æ¥æè¿°èŒƒå›´äº†ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>&lt;span style="color:#6272a4">//æ ¹æ®scoresæŸ¥æ‰¾å…ƒç´ çš„æ¡ä»¶
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span>&lt;span style="color:#8be9fd;font-style:italic">type&lt;/span> SkipListFindRange &lt;span style="color:#8be9fd;font-style:italic">struct&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3&lt;/span>&lt;span> Min, Max &lt;span style="color:#8be9fd">float64&lt;/span> &lt;span style="color:#6272a4">//æœ€å¤§å€¼å’Œæœ€å°å€¼
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> MinInf, MaxInf &lt;span style="color:#8be9fd">bool&lt;/span> &lt;span style="color:#6272a4">//æ˜¯å¦æ˜¯æ­£æ— ç©·å’Œè´Ÿæ— ç©·
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>åœ¨æŸ¥æ‰¾å‰å…ˆåˆ¤æ–­ä¸€ä¸‹ï¼Œç»™å®šçš„èŒƒå›´æ˜¯å¦åœ¨è·³è¡¨çš„èŒƒå›´å†…ï¼Œå¦‚æœä¸åœ¨å°±ä¸ç”¨æŸ¥æ‰¾äº†ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span> t &lt;span style="color:#ff79c6">:=&lt;/span> list.head
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> findRange.MinInf {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span> &lt;span style="color:#6272a4">//ä»å¤´å¼€å§‹æŸ¥æ‰¾
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> t = list.head.&lt;span style="color:#50fa7b">Next&lt;/span>(&lt;span style="color:#bd93f9">0&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span> } &lt;span style="color:#ff79c6">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span> &lt;span style="color:#6272a4">//ä¸æ˜¯ä»å¤´,æ‰¾åˆ°æœ€å°çš„é‚£ä¸ªå…ƒç´ 
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">for&lt;/span> i &lt;span style="color:#ff79c6">:=&lt;/span> list.level &lt;span style="color:#ff79c6">-&lt;/span> &lt;span style="color:#bd93f9">1&lt;/span>; i &lt;span style="color:#ff79c6">&amp;gt;=&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>; i&lt;span style="color:#ff79c6">--&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span> &lt;span style="color:#ff79c6">for&lt;/span> t.&lt;span style="color:#50fa7b">Next&lt;/span>(i) &lt;span style="color:#ff79c6">!=&lt;/span> &lt;span style="color:#ff79c6">nil&lt;/span> &lt;span style="color:#ff79c6">&amp;amp;&amp;amp;&lt;/span> t.&lt;span style="color:#50fa7b">Next&lt;/span>(i).score &amp;lt; findRange.Min {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span> t = t.&lt;span style="color:#50fa7b">Next&lt;/span>(i)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™æ®µé€»è¾‘æ˜¯ç¡®å®šæŸ¥æ‰¾çš„å¼€å§‹ä½ç½®ä¹Ÿå°±æ˜¯æ‰¾åˆ°ç›®æ ‡nodeï¼ˆæ ¹æ®èŒƒå›´æ‰¾åˆ°æœ€å°çš„nodeï¼‰ï¼Œå¦‚æœæ˜¯ä»è´Ÿæ— ç©·å¼€å§‹ï¼Œå°±ä¸ç”¨é€šè¿‡ä¹‹å‰çš„æ–¹å¼å»ç¡®å®šå¼€å§‹nodeäº†ï¼Œç›´æ¥ä»headå¼€å§‹å°±å¥½äº†ã€‚
åé¢çš„é€»è¾‘å°±æ²¡ä»€ä¹ˆç‰¹åˆ«çš„ï¼Œæ‰¾åˆ°ç›®æ ‡å¼„çš„åï¼Œå¼€å§‹å¾€åæ‰¾ï¼Œç›´åˆ°æœ€åæˆ–è€…ä¸ç¬¦åˆèŒƒå›´äº†ï¼Œå°±ç»“æŸã€‚&lt;/p>
&lt;p>å¥½äº†æŸ¥æ‰¾ä¹Ÿå®Œæˆäº†ã€‚&lt;/p>
&lt;p>è·³è¡¨çš„åŸºæœ¬åŠŸèƒ½åˆ°ç°åœ¨å·²ç»å®Œæˆï¼Œå‰©ä¸‹çš„å°±æ˜¯æŠŠè·³è¡¨åŒ…è£…ä¸€å±‚ï¼Œå»å®ç°redisä¸­zsetçš„åŠŸèƒ½å°±å¥½äº†ã€‚å…·ä½“ä»£ç å°±ä¸è´´äº†ï¼Œæœ€åæˆ‘ä¼šç»™å‡ºgithubçš„è¿æ¥ã€‚&lt;/p>
&lt;h2 id="æ€»ç»“">&lt;a href="#%e6%80%bb%e7%bb%93" class="header-anchor">&lt;/a>æ€»ç»“
&lt;/h2>&lt;ol>
&lt;li>è·³è¡¨å¯ä»¥çœ‹åšä¸€ä¸ªæ”¯æŒäºŒåˆ†æŸ¥æ‰¾çš„æœ‰åºåŒå‘é“¾è¡¨&lt;/li>
&lt;li>è·³è¡¨ä¸­æœ€æ ¸å¿ƒçš„å°±æ˜¯æœç´¢ï¼Œä¸ç®¡æ˜¯åœ¨æ’å…¥ï¼Œæ›´æ–°ï¼Œåˆ é™¤è¿˜æ˜¯æŸ¥æ‰¾ä¸­ï¼Œéƒ½è¦å…ˆæœç´¢&lt;/li>
&lt;li>è·³è¡¨åœ¨æ’å…¥nodeæ—¶ï¼Œé€šè¿‡éšæœºæ•°ç¡®å®šnodeä¸­å±‚æ•°çš„&lt;/li>
&lt;li>è·³è¡¨çš„nodeä¸­ï¼Œæœ‰ä¸€ä¸ªå‘åçš„æŒ‡é’ˆï¼Œåœ¨æ¯ä¸€å±‚ä¸­æœ‰ä¸€ä¸ªå‘å‰çš„æŒ‡é’ˆ&lt;/li>
&lt;li>è·³è¡¨ç›¸å¯¹äºçº¢é»‘æ ‘ï¼Œä¼˜åŠ¿æ˜¯ç›¸å¯¹å®¹æ˜“å®ç°ï¼Œå’ŒèŒƒå›´æŸ¥æ‰¾æ–¹ä¾¿&lt;/li>
&lt;/ol>
&lt;p>æœ€ååœ¨è¯´ä¸€ä¸‹å¸¸è§çš„è·³è¡¨çš„åº”ç”¨å§ã€‚&lt;a class="link" href="https://github.com/redis/redis" target="_blank" rel="noopener"
>redis&lt;/a> çš„zsetå°±æ˜¯åŸºäºè·³è¡¨å®ç°çš„ï¼Œå½“ç„¶æˆ‘ä¹Ÿæ˜¯é€šè¿‡è¯»redisçš„æºç ï¼Œå­¦ä¹ è·³è¡¨çš„ã€‚è¿˜æœ‰ä¸€ä¸ªæ˜¯Googleå¼€å‘çš„ &lt;a class="link" href="https://github.com/google/leveldb" target="_blank" rel="noopener"
>leveldb&lt;/a> ä¹Ÿæ˜¯åŸºäºè·³è¡¨å®ç°çš„ã€‚&lt;/p>
&lt;p>æœ€åæ”¾ä¸Šæ‰€æœ‰çš„æºç ï¼Œ&lt;a class="link" href="https://github.com/lqxhub/skip_table" target="_blank" rel="noopener"
>github&lt;/a> &lt;a class="link" href="https://gitee.com/lqxlucky/skip_table" target="_blank" rel="noopener"
>gitee&lt;/a>&lt;/p>
&lt;p>å¦‚æœè¿™ä¸ªæ–‡ç« å¯¹ä½ æœ‰å¸®åŠ©è®°å¾—ç»™æˆ‘ç‚¹ä¸ªstar è°¢è°¢äº†&lt;/p></description></item><item><title>linux å¤šçº¿ç¨‹æˆ–å¤šè¿›ç¨‹ epollå¤„ç† accept å¯¼è‡´æƒŠç¾¤</title><link>https://lqxhub.github.io/posts/4926d2f3/</link><pubDate>Sun, 22 Aug 2021 00:10:33 +0000</pubDate><guid>https://lqxhub.github.io/posts/4926d2f3/</guid><description>&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-75bcac218baeff46.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-75bcac218baeff46.webp" alt="" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;h2 id="ä»€ä¹ˆæ˜¯æƒŠç¾¤">&lt;a href="#%e4%bb%80%e4%b9%88%e6%98%af%e6%83%8a%e7%be%a4" class="header-anchor">&lt;/a>ä»€ä¹ˆæ˜¯æƒŠç¾¤
&lt;/h2>&lt;p>ç®€å•è¯´ï¼ŒæƒŠç¾¤æ˜¯å› ä¸ºå¤šè¿›ç¨‹ï¼ˆå¤šçº¿ç¨‹ï¼‰åœ¨åŒæ—¶é˜»å¡ç­‰å¾…åŒä¸€ä¸ªäº‹ä»¶çš„æ—¶å€™ï¼ˆä¼‘çœ çŠ¶æ€ï¼‰ï¼Œå½“äº‹ä»¶å‘ç”Ÿæ—¶ï¼Œå°±ä¼šå”¤é†’æ‰€æœ‰ç­‰å¾…çš„ï¼ˆä¼‘çœ çš„ï¼‰è¿›ç¨‹ï¼ˆçº¿ç¨‹ï¼‰ã€‚ä½†æ˜¯äº‹ä»¶åªèƒ½è¢«ä¸€ä¸ªè¿›ç¨‹æˆ–çº¿ç¨‹å¤„ç†ï¼Œè€Œå…¶ä»–è¿›ç¨‹ï¼ˆçº¿ç¨‹ï¼‰è·å–å¤±è´¥ï¼Œåªèƒ½é‡æ–°è¿›å…¥ä¼‘çœ çŠ¶æ€ï¼Œè¿™ç§ç°è±¡å’Œæ€§èƒ½æµªè´¹å°±å«åšæƒŠç¾¤ã€‚&lt;a class="link" href="https://zh.wikipedia.org/wiki/%E6%83%8A%E7%BE%A4%E9%97%AE%E9%A2%98" target="_blank" rel="noopener"
>ç»´åŸºç™¾ç§‘-æƒŠç¾¤&lt;/a>&lt;/p>
&lt;h2 id="äº§ç”ŸæƒŠç¾¤çš„æ¡ä»¶">&lt;a href="#%e4%ba%a7%e7%94%9f%e6%83%8a%e7%be%a4%e7%9a%84%e6%9d%a1%e4%bb%b6" class="header-anchor">&lt;/a>äº§ç”ŸæƒŠç¾¤çš„æ¡ä»¶
&lt;/h2>&lt;ol>
&lt;li>å¤šä¸ªè¿›ç¨‹æˆ–è€…å¤šä¸ªçº¿ç¨‹&lt;/li>
&lt;li>åŒæ—¶ç­‰å¾…å¤„ç†ä¸€ä¸ªäº‹ä»¶&lt;/li>
&lt;/ol>
&lt;h2 id="å…·ä½“åœºæ™¯å¤ç°">&lt;a href="#%e5%85%b7%e4%bd%93%e5%9c%ba%e6%99%af%e5%a4%8d%e7%8e%b0" class="header-anchor">&lt;/a>å…·ä½“åœºæ™¯å¤ç°
&lt;/h2>&lt;p>æµ‹è¯•ç¯å¢ƒ :&lt;/p>
&lt;ol>
&lt;li>debian11&lt;/li>
&lt;li>å†…æ ¸5.10.0-8&lt;/li>
&lt;li>ç¼–è¯‘å™¨ clang11&lt;/li>
&lt;/ol>
&lt;p>å¤šçº¿ç¨‹å’Œå¤šè¿›ç¨‹åœ¨æƒŠç¾¤é—®é¢˜ä¸Šå·®ä¸å¤šï¼Œä¸ºäº†å°‘äº›ä¸€ç‚¹ï¼Œä¸‹æ–‡ä¸­æ²¡æœ‰ç‰¹æ®Šè¯´æ˜ï¼Œå¤šçº¿ç¨‹ ä¹ŸåŒ…å«äº†å¤šè¿›ç¨‹&lt;/p>
&lt;p>åœ¨linuxä¸­ï¼Œä½¿ç”¨C/C++ ç¼–å†™ tcp serveræ—¶ï¼Œä¼šä¾æ¬¡è°ƒç”¨ &lt;code>socket()&lt;/code> &lt;code>bind()&lt;/code> &lt;code>listen()&lt;/code> &lt;code>accept()&lt;/code> è¿™å‡ ä¸ªå‡½æ•°ï¼Œè¿™å‡ ä¸ªå‡½æ•°ä¼šæ‰“å¼€socketï¼Œç»‘å®šipå’Œç«¯å£ï¼Œå¼€å§‹ç›‘å¬ç«¯å£ï¼Œacceptå‡½æ•°ä¼šé˜»å¡å½“å‰è¿›ç¨‹ï¼Œç­‰å¾…å®¢æˆ·ç«¯è¿æ¥ã€‚&lt;/p>
&lt;p>å¦‚æœåœ¨å•çº¿ç¨‹ä¸­ï¼Œåªæœ‰ä¸€ä¸ªacceptå‡½æ•°åœ¨ç­‰å¾…å®¢æˆ·ç«¯è¿æ¥ï¼Œå½“å®¢æˆ·ç«¯æ¥è¿æ¥çš„æ—¶å€™ï¼Œåªä¼šæœ‰ä¸€ä¸ªacceptå‡½æ•°æ¥å¤„ç†ï¼Œæ‰€ä»¥ä¹Ÿä¸ä¼šå­˜åœ¨æƒŠç¾¤é—®é¢˜äº†ã€‚&lt;/p>
&lt;p>åœ¨å¤šçº¿æ¨¡å‹ä¸­ï¼Œå¤šä¸ªçº¿ç¨‹åˆ†åˆ«acceptåŒä¸€ä¸ªsocketï¼Œå½“æœ‰å®¢æˆ·ç«¯è¿æ¥æ—¶ï¼Œå†…æ ¸ä¼šé€šçŸ¥æ‰€æœ‰çš„çº¿ç¨‹æ¥å¤„ç†è¿™ä¸ªè¯·æ±‚ï¼Œä½†æ˜¯å‘¢ï¼Œè¯·æ±‚åªèƒ½è¢«ä¸€ä¸ªçº¿ç¨‹å¤„ç†ï¼Œå…¶ä»–çš„çº¿ç¨‹çš„ä¸åˆ°è¿™ä¸ªäº‹ä»¶ï¼Œåªèƒ½ç™½ç™½è¢«å”¤é†’ã€‚&lt;/p>
&lt;p>è¿™æ˜¯æœ€ç®€å•çš„ä¸€ç§æƒŠç¾¤ï¼Œè¿™ç§æƒ…å†µåœ¨linux2.6ä»¥åå°±ä¸ä¼šäº§ç”Ÿäº†ã€‚å› ä¸ºåœ¨Linux 2.6 ç‰ˆæœ¬ä¹‹åï¼Œé€šè¿‡å¼•å…¥ä¸€ä¸ªæ ‡è®°ä½ WQ_FLAG_EXCLUSIVEï¼Œè§£å†³æ‰äº† Accept æƒŠç¾¤æ•ˆåº”ã€‚æˆ‘åŸæœ¬è¿˜æƒ³åœ¨centos3.9ï¼ˆå†…æ ¸ç‰ˆæœ¬æ˜¯2.5ï¼‰ä¸­å»å¤ç°è¿™ç§æƒ…å†µï¼Œä½†æ˜¯æŠ˜è…¾äº†å¥½ä¹…ï¼Œä¹Ÿæ²¡èƒ½åœ¨centosä¸Šç¼–è¯‘ä¹Ÿè¿è¡ŒC++ç¨‹åºï¼Œé‚æ”¾å¼ƒã€‚
ä¸åºŸè¯äº†ï¼Œä¸Šä»£ç ï¼Œæµ‹è¯•ç¬¬ä¸€ç§æƒ…å†µ&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c++" data-lang="c++">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">#include&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;netinet/in.h&amp;gt;&lt;/span>&lt;span style="color:#ff79c6">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span>&lt;span style="color:#ff79c6">#include&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;iostream&amp;gt;&lt;/span>&lt;span style="color:#ff79c6">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span>&lt;span style="color:#ff79c6">#include&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;sys/epoll.h&amp;gt;&lt;/span>&lt;span style="color:#ff79c6">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span>&lt;span style="color:#ff79c6">#include&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;iostream&amp;gt;&lt;/span>&lt;span style="color:#ff79c6">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span>&lt;span style="color:#ff79c6">#include&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;thread&amp;gt;&lt;/span>&lt;span style="color:#ff79c6">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span>&lt;span style="color:#ff79c6">#include&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;mutex&amp;gt;&lt;/span>&lt;span style="color:#ff79c6">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span>&lt;span style="color:#ff79c6">#include&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;condition_variable&amp;gt;&lt;/span>&lt;span style="color:#ff79c6">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span>&lt;span style="color:#ff79c6">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span>&lt;span style="color:#ff79c6">#define WORKER_THREAD 4
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span>&lt;span style="color:#ff79c6">&lt;/span>&lt;span style="color:#6272a4">//åˆ›å»ºsocketï¼Œå¹¶è¿”å›fd
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span>&lt;span style="color:#8be9fd">int&lt;/span> &lt;span style="color:#50fa7b">createSocket&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span> &lt;span style="color:#8be9fd">int&lt;/span> fd &lt;span style="color:#ff79c6">=&lt;/span> socket(AF_INET, SOCK_STREAM, IPPROTO_TCP);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (fd &lt;span style="color:#ff79c6">&amp;lt;&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span> std&lt;span style="color:#ff79c6">::&lt;/span>cout &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;create socket error&amp;#34;&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> std&lt;span style="color:#ff79c6">::&lt;/span>endl;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18&lt;/span>&lt;span> sockaddr_in sockAddr{};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19&lt;/span>&lt;span> sockAddr.sin_port &lt;span style="color:#ff79c6">=&lt;/span> htons(PORT);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20&lt;/span>&lt;span> sockAddr.sin_family &lt;span style="color:#ff79c6">=&lt;/span> AF_INET;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21&lt;/span>&lt;span> sockAddr.sin_addr.s_addr &lt;span style="color:#ff79c6">=&lt;/span> htons(INADDR_ANY);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (bind(fd, (sockaddr &lt;span style="color:#ff79c6">*&lt;/span>) &lt;span style="color:#ff79c6">&amp;amp;&lt;/span>sockAddr, &lt;span style="color:#ff79c6">sizeof&lt;/span>(sockAddr)) &lt;span style="color:#ff79c6">&amp;lt;&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24&lt;/span>&lt;span> std&lt;span style="color:#ff79c6">::&lt;/span>cout &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;bind socket error, port:&amp;#34;&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> PORT &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> std&lt;span style="color:#ff79c6">::&lt;/span>endl;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (listen(fd, &lt;span style="color:#bd93f9">100&lt;/span>) &lt;span style="color:#ff79c6">&amp;lt;&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29&lt;/span>&lt;span> std&lt;span style="color:#ff79c6">::&lt;/span>cout &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;listen port error&amp;#34;&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> std&lt;span style="color:#ff79c6">::&lt;/span>endl;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> fd;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35&lt;/span>&lt;span>&lt;span style="color:#8be9fd">void&lt;/span> &lt;span style="color:#50fa7b">Worker1&lt;/span>(&lt;span style="color:#8be9fd">int&lt;/span> socketFd, &lt;span style="color:#8be9fd">int&lt;/span> k) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36&lt;/span>&lt;span> std&lt;span style="color:#ff79c6">::&lt;/span>cout &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34; Worker&amp;#34;&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> k &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34; run &amp;#34;&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> std&lt;span style="color:#ff79c6">::&lt;/span>endl;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37&lt;/span>&lt;span> &lt;span style="color:#ff79c6">while&lt;/span> (&lt;span style="color:#8be9fd;font-style:italic">true&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38&lt;/span>&lt;span> &lt;span style="color:#8be9fd">int&lt;/span> tfd &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39&lt;/span>&lt;span> sockaddr_in cli_addr{};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40&lt;/span>&lt;span> socklen_t length &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#ff79c6">sizeof&lt;/span>(cli_addr);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41&lt;/span>&lt;span> tfd &lt;span style="color:#ff79c6">=&lt;/span> accept(socketFd, (sockaddr &lt;span style="color:#ff79c6">*&lt;/span>) &lt;span style="color:#ff79c6">&amp;amp;&lt;/span>cli_addr, &lt;span style="color:#ff79c6">&amp;amp;&lt;/span>length);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42&lt;/span>&lt;span> std&lt;span style="color:#ff79c6">::&lt;/span>cout &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;worker&amp;#34;&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> k &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34; in &amp;#34;&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> std&lt;span style="color:#ff79c6">::&lt;/span>endl;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (tfd &lt;span style="color:#ff79c6">&amp;lt;=&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44&lt;/span>&lt;span> std&lt;span style="color:#ff79c6">::&lt;/span>cout &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;accept error&amp;#34;&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> std&lt;span style="color:#ff79c6">::&lt;/span>endl;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46&lt;/span>&lt;span> } &lt;span style="color:#ff79c6">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47&lt;/span>&lt;span> std&lt;span style="color:#ff79c6">::&lt;/span>cout &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;worker&amp;#34;&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> k &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34; accept &amp;#34;&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> std&lt;span style="color:#ff79c6">::&lt;/span>endl;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">51&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">52&lt;/span>&lt;span>&lt;span style="color:#8be9fd">int&lt;/span> &lt;span style="color:#50fa7b">main&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">53&lt;/span>&lt;span> std&lt;span style="color:#ff79c6">::&lt;/span>mutex mutex;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">54&lt;/span>&lt;span> std&lt;span style="color:#ff79c6">::&lt;/span>unique_lock&lt;span style="color:#ff79c6">&amp;lt;&lt;/span>std&lt;span style="color:#ff79c6">::&lt;/span>mutex&lt;span style="color:#ff79c6">&amp;gt;&lt;/span> lck(mutex);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">55&lt;/span>&lt;span> std&lt;span style="color:#ff79c6">::&lt;/span>condition_variable cv;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">56&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">57&lt;/span>&lt;span> &lt;span style="color:#8be9fd">int&lt;/span> fd &lt;span style="color:#ff79c6">=&lt;/span> createSocket();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">58&lt;/span>&lt;span> &lt;span style="color:#6272a4">//ç¬¬ä¸€ç§,å¤šä¸ªçº¿ç¨‹ä¸ä½¿ç”¨å¤šè·¯å¤ç”¨,acceptåŒä¸€ä¸ªsocket
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">59&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">for&lt;/span> (&lt;span style="color:#8be9fd">int&lt;/span> i &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>; i &lt;span style="color:#ff79c6">&amp;lt;&lt;/span> WORKER_THREAD; &lt;span style="color:#ff79c6">++&lt;/span>i) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">60&lt;/span>&lt;span> std&lt;span style="color:#ff79c6">::&lt;/span>&lt;span style="color:#ff79c6">thread&lt;/span> th(&lt;span style="color:#ff79c6">&amp;amp;&lt;/span>Worker1, fd, i &lt;span style="color:#ff79c6">+&lt;/span> &lt;span style="color:#bd93f9">1&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">61&lt;/span>&lt;span> th.detach();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">62&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">63&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">64&lt;/span>&lt;span> cv.wait(lck);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">65&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">66&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™ä»£ç å¯ä»¥ç”¨Cå†™ï¼Œä½†æ˜¯ä¹ æƒ¯ç”¨C++äº†ï¼Œå°±ç”¨C++å†™å§ã€‚ä»£ç ä¹Ÿæ¯”è¾ƒç®€å•ï¼Œ&lt;code>createSocket()&lt;/code>åˆ›å»ºäº†ä¸€ä¸ªsocketï¼Œç„¶å4ä¸ªçº¿ç¨‹åˆ†åˆ«å»acceptè¿™ä¸ªsocketã€‚
ä¸‹é¢æ˜¯è¿è¡Œç»“æœï¼š
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-c48c3f0cd5d7d843.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-c48c3f0cd5d7d843.webp" alt="" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>å¯ä»¥çœ‹åˆ°ï¼Œ4ä¸ªçº¿ç¨‹éƒ½åœ¨è¿è¡Œï¼Œå¹¶ä¸”acceptï¼Œä½†æ˜¯å½“è¿æ¥æ¥çš„æ—¶å€™ï¼Œåªæœ‰ä¸ªçº¿ç¨‹èƒ½å¾—åˆ°äº‹ä»¶ã€‚&lt;/p>
&lt;p>æ—¢ç„¶linuxå†…æ ¸å·²ç»å¸®æˆ‘ä»¬å¤„ç†äº†æƒŠç¾¤ï¼Œé‚£æˆ‘ä»¬è¿˜è€ƒè™‘è¿™äº›å¹²å•¥ï¼Œç›´æ¥ç”¨ä¸å°±å®Œäº†ã€‚&lt;/p>
&lt;p>ä½†æ˜¯ï¼Œæˆ‘ä»¬åœ¨å†™ä»£ç çš„æ—¶å€™ä¸€èˆ¬ä¸ä¼šç›´æ¥é˜»å¡acceptçš„ï¼Œéƒ½æ˜¯ä½¿ç”¨å¤šè·¯å¤ç”¨æ¥å¸®æˆ‘ä»¬å¤„ç†è¿æ¥é˜»å¡çš„æ˜¯å¤šè·¯å¤ç”¨å‡½æ•°ã€‚ç›®å‰ç»¼åˆæ€§èƒ½æ¯”è¾ƒå¥½çš„IOå¤šè·¯å¤ç”¨æ˜¯epollã€‚å½“åœ¨å¤šçº¿ç¨‹ä¸­ä½¿ç”¨epollæ—¶ï¼ŒæƒŠç¾¤é—®é¢˜å°±ä¼šå‡ºç°äº†ã€‚
å…ˆä»£ç å’Œç»“æœï¼Œç„¶åå†è§£é‡Š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c++" data-lang="c++">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">#include&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;netinet/in.h&amp;gt;&lt;/span>&lt;span style="color:#ff79c6">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span>&lt;span style="color:#ff79c6">#include&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;iostream&amp;gt;&lt;/span>&lt;span style="color:#ff79c6">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span>&lt;span style="color:#ff79c6">#include&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;sys/epoll.h&amp;gt;&lt;/span>&lt;span style="color:#ff79c6">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span>&lt;span style="color:#ff79c6">#include&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;iostream&amp;gt;&lt;/span>&lt;span style="color:#ff79c6">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span>&lt;span style="color:#ff79c6">#include&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;thread&amp;gt;&lt;/span>&lt;span style="color:#ff79c6">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span>&lt;span style="color:#ff79c6">#include&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;mutex&amp;gt;&lt;/span>&lt;span style="color:#ff79c6">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span>&lt;span style="color:#ff79c6">#include&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;condition_variable&amp;gt;&lt;/span>&lt;span style="color:#ff79c6">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span>&lt;span style="color:#ff79c6">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span>&lt;span style="color:#ff79c6">#define WORKER_THREAD 4
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span>&lt;span style="color:#ff79c6">&lt;/span>&lt;span style="color:#6272a4">//åˆ›å»ºsocketï¼Œå¹¶è¿”å›fd
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span>&lt;span style="color:#8be9fd">int&lt;/span> &lt;span style="color:#50fa7b">createSocket&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span> &lt;span style="color:#8be9fd">int&lt;/span> fd &lt;span style="color:#ff79c6">=&lt;/span> socket(AF_INET, SOCK_STREAM, IPPROTO_TCP);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (fd &lt;span style="color:#ff79c6">&amp;lt;&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span> std&lt;span style="color:#ff79c6">::&lt;/span>cout &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;create socket error&amp;#34;&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> std&lt;span style="color:#ff79c6">::&lt;/span>endl;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18&lt;/span>&lt;span> sockaddr_in sockAddr{};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19&lt;/span>&lt;span> sockAddr.sin_port &lt;span style="color:#ff79c6">=&lt;/span> htons(PORT);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20&lt;/span>&lt;span> sockAddr.sin_family &lt;span style="color:#ff79c6">=&lt;/span> AF_INET;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21&lt;/span>&lt;span> sockAddr.sin_addr.s_addr &lt;span style="color:#ff79c6">=&lt;/span> htons(INADDR_ANY);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (bind(fd, (sockaddr &lt;span style="color:#ff79c6">*&lt;/span>) &lt;span style="color:#ff79c6">&amp;amp;&lt;/span>sockAddr, &lt;span style="color:#ff79c6">sizeof&lt;/span>(sockAddr)) &lt;span style="color:#ff79c6">&amp;lt;&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24&lt;/span>&lt;span> std&lt;span style="color:#ff79c6">::&lt;/span>cout &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;bind socket error, port:&amp;#34;&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> PORT &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> std&lt;span style="color:#ff79c6">::&lt;/span>endl;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (listen(fd, &lt;span style="color:#bd93f9">100&lt;/span>) &lt;span style="color:#ff79c6">&amp;lt;&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29&lt;/span>&lt;span> std&lt;span style="color:#ff79c6">::&lt;/span>cout &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;listen port error&amp;#34;&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> std&lt;span style="color:#ff79c6">::&lt;/span>endl;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> fd;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35&lt;/span>&lt;span>&lt;span style="color:#8be9fd">void&lt;/span> &lt;span style="color:#50fa7b">Worker2&lt;/span>(&lt;span style="color:#8be9fd">int&lt;/span> socketFd, &lt;span style="color:#8be9fd">int&lt;/span> k) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36&lt;/span>&lt;span> std&lt;span style="color:#ff79c6">::&lt;/span>cout &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34; Worker&amp;#34;&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> k &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34; run &amp;#34;&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> std&lt;span style="color:#ff79c6">::&lt;/span>endl;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38&lt;/span>&lt;span> &lt;span style="color:#8be9fd">int&lt;/span> eFd &lt;span style="color:#ff79c6">=&lt;/span> epoll_create(&lt;span style="color:#bd93f9">1&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (eFd &lt;span style="color:#ff79c6">&amp;lt;&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40&lt;/span>&lt;span> std&lt;span style="color:#ff79c6">::&lt;/span>cout &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;create epoll fail&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43&lt;/span>&lt;span> epoll_event epev_{};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44&lt;/span>&lt;span> epev_.events &lt;span style="color:#ff79c6">=&lt;/span> EPOLLIN;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45&lt;/span>&lt;span> epev_.data.fd &lt;span style="color:#ff79c6">=&lt;/span> socketFd;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46&lt;/span>&lt;span> epoll_ctl(eFd, EPOLL_CTL_ADD, socketFd, &lt;span style="color:#ff79c6">&amp;amp;&lt;/span>epev_);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47&lt;/span>&lt;span> epoll_event events[EVENT_NUM];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49&lt;/span>&lt;span> &lt;span style="color:#ff79c6">while&lt;/span> (&lt;span style="color:#8be9fd;font-style:italic">true&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50&lt;/span>&lt;span> &lt;span style="color:#8be9fd">int&lt;/span> eNum &lt;span style="color:#ff79c6">=&lt;/span> epoll_wait(eFd, events, EVENT_NUM, &lt;span style="color:#ff79c6">-&lt;/span>&lt;span style="color:#bd93f9">1&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">51&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (eNum &lt;span style="color:#ff79c6">==&lt;/span> &lt;span style="color:#ff79c6">-&lt;/span>&lt;span style="color:#bd93f9">1&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">52&lt;/span>&lt;span> std&lt;span style="color:#ff79c6">::&lt;/span>cout &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;epoll error&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">53&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">54&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">55&lt;/span>&lt;span> &lt;span style="color:#6272a4">//ä¸€å®šè¦åŠ ä¸Šè¿™å¥,é˜²æ­¢äº‹ä»¶è¢«ç¬é—´å¤„ç†,å¯¼è‡´çœ‹ä¸åˆ°ç»“æœ
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">56&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> std&lt;span style="color:#ff79c6">::&lt;/span>this_thread&lt;span style="color:#ff79c6">::&lt;/span>sleep_for((std&lt;span style="color:#ff79c6">::&lt;/span>chrono&lt;span style="color:#ff79c6">::&lt;/span>seconds (&lt;span style="color:#bd93f9">1&lt;/span>)));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">57&lt;/span>&lt;span> std&lt;span style="color:#ff79c6">::&lt;/span>cout &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;worker&amp;#34;&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> k &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34; in &amp;#34;&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> std&lt;span style="color:#ff79c6">::&lt;/span>endl;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">58&lt;/span>&lt;span> &lt;span style="color:#ff79c6">for&lt;/span> (&lt;span style="color:#8be9fd">int&lt;/span> i &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>; i &lt;span style="color:#ff79c6">&amp;lt;&lt;/span> eNum; &lt;span style="color:#ff79c6">++&lt;/span>i) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">59&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (events[i].data.fd &lt;span style="color:#ff79c6">==&lt;/span> socketFd) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">60&lt;/span>&lt;span> &lt;span style="color:#8be9fd">int&lt;/span> tfd &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">61&lt;/span>&lt;span> sockaddr_in cli_addr{};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">62&lt;/span>&lt;span> socklen_t length &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#ff79c6">sizeof&lt;/span>(cli_addr);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">63&lt;/span>&lt;span> tfd &lt;span style="color:#ff79c6">=&lt;/span> accept(socketFd, (sockaddr &lt;span style="color:#ff79c6">*&lt;/span>) &lt;span style="color:#ff79c6">&amp;amp;&lt;/span>cli_addr, &lt;span style="color:#ff79c6">&amp;amp;&lt;/span>length);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">64&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (tfd &lt;span style="color:#ff79c6">&amp;lt;=&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">65&lt;/span>&lt;span> std&lt;span style="color:#ff79c6">::&lt;/span>cout &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;accept error&amp;#34;&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> std&lt;span style="color:#ff79c6">::&lt;/span>endl;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">66&lt;/span>&lt;span> } &lt;span style="color:#ff79c6">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">67&lt;/span>&lt;span> std&lt;span style="color:#ff79c6">::&lt;/span>cout &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;worker&amp;#34;&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> k &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34; accept &amp;#34;&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> std&lt;span style="color:#ff79c6">::&lt;/span>endl;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">68&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">69&lt;/span>&lt;span> } &lt;span style="color:#ff79c6">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">70&lt;/span>&lt;span> &lt;span style="color:#6272a4">//å¤„ç†æ­£å¸¸çš„socketè¯»å†™äº‹ä»¶,è¿™é‡Œå¯ä»¥å¿½ç•¥,ä¸æ˜¯è¿™æ¬¡å…³æ³¨çš„ç‚¹
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">71&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">72&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">73&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">74&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">75&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">76&lt;/span>&lt;span>&lt;span style="color:#8be9fd">int&lt;/span> &lt;span style="color:#50fa7b">main&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">77&lt;/span>&lt;span> std&lt;span style="color:#ff79c6">::&lt;/span>mutex mutex;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">78&lt;/span>&lt;span> std&lt;span style="color:#ff79c6">::&lt;/span>unique_lock&lt;span style="color:#ff79c6">&amp;lt;&lt;/span>std&lt;span style="color:#ff79c6">::&lt;/span>mutex&lt;span style="color:#ff79c6">&amp;gt;&lt;/span> lck(mutex);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">79&lt;/span>&lt;span> std&lt;span style="color:#ff79c6">::&lt;/span>condition_variable cv;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">80&lt;/span>&lt;span> &lt;span style="color:#8be9fd">int&lt;/span> fd &lt;span style="color:#ff79c6">=&lt;/span> createSocket();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">81&lt;/span>&lt;span> &lt;span style="color:#6272a4">//ç¬¬äºŒç§,å¤šä¸ªçº¿ç¨‹ä½¿ç”¨epollå¤šè·¯å¤ç”¨,acceptåŒä¸€ä¸ªsocket
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">82&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">for&lt;/span> (&lt;span style="color:#8be9fd">int&lt;/span> i &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>; i &lt;span style="color:#ff79c6">&amp;lt;&lt;/span> WORKER_THREAD; &lt;span style="color:#ff79c6">++&lt;/span>i) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">83&lt;/span>&lt;span> std&lt;span style="color:#ff79c6">::&lt;/span>&lt;span style="color:#ff79c6">thread&lt;/span> th(&lt;span style="color:#ff79c6">&amp;amp;&lt;/span>Worker2, fd, i &lt;span style="color:#ff79c6">+&lt;/span> &lt;span style="color:#bd93f9">1&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">84&lt;/span>&lt;span> th.detach();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">85&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">86&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ç»“æœ
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-7e95cb7234b64dc1.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-7e95cb7234b64dc1.webp" alt="" />
&lt;/a>
&lt;/div>
è¿™é‡Œå¯ä»¥çœ‹åˆ°ï¼Œå½“æœ‰å®¢æˆ·ç«¯æ¥è¿æ¥çš„æ—¶å€™ï¼Œ4ä¸ªçº¿ç¨‹éƒ½è¢«å”¤é†’äº†ï¼Œä½†æ˜¯åªæœ‰workr2 çº¿ç¨‹æˆåŠŸè·å–äº†äº‹ä»¶ï¼Œå…¶ä½™çš„3ä¸ªçº¿ç¨‹éƒ½ç™½ç™½å”¤é†’æµªè´¹äº†æ€§èƒ½&lt;/p>
&lt;p>ä¸ºå•¥å†…æ ¸å·²ç»å¤„ç†äº†ç¬¬ä¸€ç§æƒ…æ™¯ä¸‹çš„æƒŠç¾¤é—®é¢˜ï¼Œç¬¬äºŒç§æƒ…æ™¯ä¸‹çš„æƒŠç¾¤é—®é¢˜ä¸ºå•¥å°±ä¸å¤„ç†äº†å‘¢ï¼Ÿ&lt;/p>
&lt;p>æˆ‘çš„çŒœæƒ³ä¸ä¸€å®šæ­£ç¡®ï¼Œå¦‚æœæœ‰é”™è¯¯ï¼Œè¯·æŒ‡å‡ºï¼š&lt;/p>
&lt;blockquote>
&lt;p>accept åªèƒ½æ˜¯è¢«ä¸€ä¸ªè¿›ç¨‹è°ƒç”¨æˆåŠŸï¼ˆè¿æ¥äº‹ä»¶åªä¼šå¤„ç†ä¸€æ¬¡å˜›ï¼‰ï¼Œæ‰€ä»¥å†…æ ¸å°±ç›´æ¥å¤„ç†äº†ï¼ˆä¸€ä¸ªacceptåªä¼šå”¤é†’ä¸€ä¸ªè¿›ç¨‹ï¼‰ã€‚ä½† epoll ä¸ä¸€æ ·ï¼Œepollä¸­ç®¡ç†äº†å¾ˆå¤šè¿æ¥ï¼Œä¸æ­¢socketè¿™ä¸€ä¸ªï¼Œé™¤äº†å¯èƒ½åç»­è¢« accept è°ƒç”¨å¤–ï¼Œè¿˜æœ‰å¯èƒ½æ˜¯å…¶ä»–ç½‘ç»œ IO äº‹ä»¶çš„ï¼Œè€Œå…¶ä»– IO äº‹ä»¶æ˜¯å¦åªèƒ½ç”±ä¸€ä¸ªè¿›ç¨‹å¤„ç†ï¼Œæ˜¯ä¸ä¸€å®šçš„ï¼Œè¿™æ˜¯ä¸€ä¸ªç”±ç”¨æˆ·å†³å®šçš„äº‹æƒ…ï¼Œä¾‹å¦‚å¯èƒ½ä¸€ä¸ªæ–‡ä»¶ä¼šç”±å¤šä¸ªè¿›ç¨‹æ¥è¯»å†™ã€‚æ‰€ä»¥ï¼Œå¯¹ epoll é»˜è®¤å¯¹äºå¤šè¿›ç¨‹ç›‘å¬åŒä¸€æ–‡ä»¶ä¸ä¼šè®¾ç½®äº’æ–¥ï¼Œæ‰€ä»¥å°±å¯¼è‡´äº†epollæƒŠç¾¤é—®é¢˜ã€‚&lt;/p>
&lt;/blockquote>
&lt;p>åœ¨linux4.5å†…æ ¸ä¹‹åç»™epollæ·»åŠ äº†ä¸€ä¸ª &lt;code>EPOLLEXCLUSIVE&lt;/code>çš„æ ‡å¿—ä½ï¼Œå¦‚æœè®¾ç½®äº†è¿™ä¸ªæ ‡å¿—ä½ï¼Œé‚£epollå°†è¿›ç¨‹æŒ‚åˆ°ç­‰å¾…é˜Ÿåˆ—æ—¶å°†ä¼šè®¾ç½®ä¸€ä¸‹äº’æ–¥æ ‡å¿—ä½ï¼Œè¿™æ—¶å®ç°è·Ÿå†…æ ¸åŸç”Ÿacceptä¸€æ ·çš„ç‰¹æ€§ï¼Œåªä¼šå”¤é†’é˜Ÿåˆ—ä¸­çš„ä¸€ä¸ªè¿›ç¨‹ã€‚&lt;a class="link" href="https://segmentfault.com/a/1190000039676522" target="_blank" rel="noopener"
>å‚è€ƒèµ„æ–™&lt;/a> æ„Ÿè°¢è¿™ä½å¤§ç¥çš„æ–‡ç« &lt;/p>
&lt;p>ä¿®æ”¹ä¸€ä¸‹worker2å‡½æ•°:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c++" data-lang="c++">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#8be9fd">void&lt;/span> &lt;span style="color:#50fa7b">Worker2&lt;/span>(&lt;span style="color:#8be9fd">int&lt;/span> socketFd, &lt;span style="color:#8be9fd">int&lt;/span> k) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span> std&lt;span style="color:#ff79c6">::&lt;/span>cout &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34; Worker&amp;#34;&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> k &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34; run &amp;#34;&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> std&lt;span style="color:#ff79c6">::&lt;/span>endl;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span> &lt;span style="color:#8be9fd">int&lt;/span> eFd &lt;span style="color:#ff79c6">=&lt;/span> epoll_create(&lt;span style="color:#bd93f9">1&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (eFd &lt;span style="color:#ff79c6">&amp;lt;&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span> std&lt;span style="color:#ff79c6">::&lt;/span>cout &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;create epoll fail&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span> epoll_event epev_{};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span> &lt;span style="color:#6272a4">//ç»™epollåŠ ä¸Š äº’æ–¥æ ‡å¿—
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> epev_.events &lt;span style="color:#ff79c6">=&lt;/span> EPOLLIN &lt;span style="color:#ff79c6">|&lt;/span> EPOLLEXCLUSIVE;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span> epev_.data.fd &lt;span style="color:#ff79c6">=&lt;/span> socketFd;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span> epoll_ctl(eFd, EPOLL_CTL_ADD, socketFd, &lt;span style="color:#ff79c6">&amp;amp;&lt;/span>epev_);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span> epoll_event events[EVENT_NUM];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16&lt;/span>&lt;span> &lt;span style="color:#ff79c6">while&lt;/span> (&lt;span style="color:#8be9fd;font-style:italic">true&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17&lt;/span>&lt;span> &lt;span style="color:#8be9fd">int&lt;/span> eNum &lt;span style="color:#ff79c6">=&lt;/span> epoll_wait(eFd, events, EVENT_NUM, &lt;span style="color:#ff79c6">-&lt;/span>&lt;span style="color:#bd93f9">1&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (eNum &lt;span style="color:#ff79c6">==&lt;/span> &lt;span style="color:#ff79c6">-&lt;/span>&lt;span style="color:#bd93f9">1&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19&lt;/span>&lt;span> std&lt;span style="color:#ff79c6">::&lt;/span>cout &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;epoll error&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22&lt;/span>&lt;span> &lt;span style="color:#6272a4">//ä¸€å®šè¦åŠ ä¸Šè¿™å¥,é˜²æ­¢äº‹ä»¶è¢«ç¬é—´å¤„ç†,å¯¼è‡´çœ‹ä¸åˆ°ç»“æœ
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> std&lt;span style="color:#ff79c6">::&lt;/span>this_thread&lt;span style="color:#ff79c6">::&lt;/span>sleep_for((std&lt;span style="color:#ff79c6">::&lt;/span>chrono&lt;span style="color:#ff79c6">::&lt;/span>seconds(&lt;span style="color:#bd93f9">1&lt;/span>)));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24&lt;/span>&lt;span> std&lt;span style="color:#ff79c6">::&lt;/span>cout &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;worker&amp;#34;&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> k &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34; in &amp;#34;&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> std&lt;span style="color:#ff79c6">::&lt;/span>endl;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25&lt;/span>&lt;span> &lt;span style="color:#ff79c6">for&lt;/span> (&lt;span style="color:#8be9fd">int&lt;/span> i &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>; i &lt;span style="color:#ff79c6">&amp;lt;&lt;/span> eNum; &lt;span style="color:#ff79c6">++&lt;/span>i) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (events[i].data.fd &lt;span style="color:#ff79c6">==&lt;/span> socketFd) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27&lt;/span>&lt;span> &lt;span style="color:#8be9fd">int&lt;/span> tfd &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28&lt;/span>&lt;span> sockaddr_in cli_addr{};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29&lt;/span>&lt;span> socklen_t length &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#ff79c6">sizeof&lt;/span>(cli_addr);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30&lt;/span>&lt;span> tfd &lt;span style="color:#ff79c6">=&lt;/span> accept(socketFd, (sockaddr &lt;span style="color:#ff79c6">*&lt;/span>) &lt;span style="color:#ff79c6">&amp;amp;&lt;/span>cli_addr, &lt;span style="color:#ff79c6">&amp;amp;&lt;/span>length);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (tfd &lt;span style="color:#ff79c6">&amp;lt;=&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32&lt;/span>&lt;span> std&lt;span style="color:#ff79c6">::&lt;/span>cout &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;accept error&amp;#34;&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> std&lt;span style="color:#ff79c6">::&lt;/span>endl;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33&lt;/span>&lt;span> } &lt;span style="color:#ff79c6">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34&lt;/span>&lt;span> std&lt;span style="color:#ff79c6">::&lt;/span>cout &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;worker&amp;#34;&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> k &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34; accept &amp;#34;&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> std&lt;span style="color:#ff79c6">::&lt;/span>endl;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36&lt;/span>&lt;span> } &lt;span style="color:#ff79c6">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37&lt;/span>&lt;span> &lt;span style="color:#6272a4">//å¤„ç†æ­£å¸¸çš„socketè¯»å†™äº‹ä»¶,è¿™é‡Œå¯ä»¥å¿½ç•¥,ä¸æ˜¯è¿™æ¬¡å…³æ³¨çš„ç‚¹
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ç°åœ¨æ¥æµ‹è¯•ä¸€ä¸‹
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-5b7fb90f54f0e9d8.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-5b7fb90f54f0e9d8.webp" alt="" />
&lt;/a>
&lt;/div>
ç°åœ¨çš„epollå·²ç»ä¸ä¼šæœ‰æƒŠç¾¤é—®é¢˜äº†&lt;/p>
&lt;h2 id="å¦ä¸€ç§æ–¹å¼">&lt;a href="#%e5%8f%a6%e4%b8%80%e7%a7%8d%e6%96%b9%e5%bc%8f" class="header-anchor">&lt;/a>å¦ä¸€ç§æ–¹å¼
&lt;/h2>&lt;p>å…¶å®è§£å†³å¤šçº¿ç¨‹ä½¿ç”¨epollç­‰å¤šè·¯å¤ç”¨å¯¼è‡´çš„æƒŠç¾¤é—®é¢˜ï¼Œè¿˜æœ‰ä¸€ä¸ªæ›´å½»åº•è§£å†³æ–¹æ³•ï¼Œè®©æ¯ä¸ªçº¿ç¨‹åˆ†åˆ«æ‰“å¼€ä¸€ä¸ªsocketï¼Œå¹¶ä¸”è¿™äº›socketç»‘å®šåœ¨åŒä¸€ä¸ªç«¯å£ï¼Œç„¶åacceptè¿™ä¸ªsocketã€‚è¿™å°±åƒç¬¬ä¸€ç§æƒ…æ™¯é‚£æ ·ï¼Œå†…æ ¸ç›´æ¥å¸®æˆ‘ä»¬åšäº†æƒŠç¾¤å¤„ç†ã€‚è¿™é‡Œä¼šä½¿ç”¨åˆ° linux 3.9å socketæä¾›&lt;code>SO_REUSEPORT&lt;/code>æ ‡å¿—ã€‚ä½¿ç”¨è¿™ä¸ªæ ‡å¿—åï¼Œä¼šå…è®¸å¤šä¸ªsocketç»‘å®šå’Œç›‘å¬åŒä¸€ä¸ªç«¯å£ã€‚
ä»£ç å¦‚ä¸‹&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c++" data-lang="c++">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">#include&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;netinet/in.h&amp;gt;&lt;/span>&lt;span style="color:#ff79c6">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span>&lt;span style="color:#ff79c6">#include&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;iostream&amp;gt;&lt;/span>&lt;span style="color:#ff79c6">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span>&lt;span style="color:#ff79c6">#include&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;sys/epoll.h&amp;gt;&lt;/span>&lt;span style="color:#ff79c6">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span>&lt;span style="color:#ff79c6">#include&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;iostream&amp;gt;&lt;/span>&lt;span style="color:#ff79c6">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span>&lt;span style="color:#ff79c6">#include&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;thread&amp;gt;&lt;/span>&lt;span style="color:#ff79c6">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span>&lt;span style="color:#ff79c6">#include&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;mutex&amp;gt;&lt;/span>&lt;span style="color:#ff79c6">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span>&lt;span style="color:#ff79c6">#include&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;condition_variable&amp;gt;&lt;/span>&lt;span style="color:#ff79c6">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span>&lt;span style="color:#ff79c6">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span>&lt;span style="color:#ff79c6">#define WORKER_THREAD 4
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span>&lt;span style="color:#ff79c6">&lt;/span>&lt;span style="color:#6272a4">//åˆ›å»ºsocketï¼Œå¹¶è¿”å›fd
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span>&lt;span style="color:#8be9fd">int&lt;/span> &lt;span style="color:#50fa7b">createSocket2&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span> &lt;span style="color:#8be9fd">int&lt;/span> fd &lt;span style="color:#ff79c6">=&lt;/span> socket(AF_INET, SOCK_STREAM, IPPROTO_TCP);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (fd &lt;span style="color:#ff79c6">==&lt;/span> &lt;span style="color:#ff79c6">-&lt;/span>&lt;span style="color:#bd93f9">1&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span> std&lt;span style="color:#ff79c6">::&lt;/span>cout &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;create socket error&amp;#34;&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> std&lt;span style="color:#ff79c6">::&lt;/span>endl;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18&lt;/span>&lt;span> &lt;span style="color:#8be9fd">int&lt;/span> on &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#bd93f9">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (setsockopt(fd, SOL_SOCKET, SO_REUSEPORT, (&lt;span style="color:#ff79c6">const&lt;/span> &lt;span style="color:#8be9fd">void&lt;/span> &lt;span style="color:#ff79c6">*&lt;/span>) &lt;span style="color:#ff79c6">&amp;amp;&lt;/span>on, &lt;span style="color:#ff79c6">sizeof&lt;/span>(on)) &lt;span style="color:#ff79c6">&amp;lt;&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20&lt;/span>&lt;span> std&lt;span style="color:#ff79c6">::&lt;/span>cout &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;set opt error, ret:&amp;#34;&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> std&lt;span style="color:#ff79c6">::&lt;/span>endl;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23&lt;/span>&lt;span> sockaddr_in sockAddr{};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24&lt;/span>&lt;span> sockAddr.sin_port &lt;span style="color:#ff79c6">=&lt;/span> htons(PORT);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25&lt;/span>&lt;span> sockAddr.sin_family &lt;span style="color:#ff79c6">=&lt;/span> AF_INET;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26&lt;/span>&lt;span> sockAddr.sin_addr.s_addr &lt;span style="color:#ff79c6">=&lt;/span> htons(INADDR_ANY);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (bind(fd, (sockaddr &lt;span style="color:#ff79c6">*&lt;/span>) &lt;span style="color:#ff79c6">&amp;amp;&lt;/span>sockAddr, &lt;span style="color:#ff79c6">sizeof&lt;/span>(sockAddr)) &lt;span style="color:#ff79c6">&amp;lt;&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29&lt;/span>&lt;span> std&lt;span style="color:#ff79c6">::&lt;/span>cout &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;bind socket error, port:&amp;#34;&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> PORT &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> std&lt;span style="color:#ff79c6">::&lt;/span>endl;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (listen(fd, &lt;span style="color:#bd93f9">100&lt;/span>) &lt;span style="color:#ff79c6">&amp;lt;&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34&lt;/span>&lt;span> std&lt;span style="color:#ff79c6">::&lt;/span>cout &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;listen port error&amp;#34;&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> std&lt;span style="color:#ff79c6">::&lt;/span>endl;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> fd;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40&lt;/span>&lt;span>&lt;span style="color:#8be9fd">void&lt;/span> &lt;span style="color:#50fa7b">Worker3&lt;/span>(&lt;span style="color:#8be9fd">int&lt;/span> k) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41&lt;/span>&lt;span> std&lt;span style="color:#ff79c6">::&lt;/span>cout &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34; Worker&amp;#34;&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> k &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34; run &amp;#34;&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> std&lt;span style="color:#ff79c6">::&lt;/span>endl;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43&lt;/span>&lt;span> &lt;span style="color:#8be9fd">int&lt;/span> socketFd &lt;span style="color:#ff79c6">=&lt;/span> createSocket2();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44&lt;/span>&lt;span> &lt;span style="color:#8be9fd">int&lt;/span> eFd &lt;span style="color:#ff79c6">=&lt;/span> epoll_create(&lt;span style="color:#bd93f9">1&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (eFd &lt;span style="color:#ff79c6">==&lt;/span> &lt;span style="color:#ff79c6">-&lt;/span>&lt;span style="color:#bd93f9">1&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46&lt;/span>&lt;span> std&lt;span style="color:#ff79c6">::&lt;/span>cout &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;create epoll fail&amp;#34;&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> std&lt;span style="color:#ff79c6">::&lt;/span>endl;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50&lt;/span>&lt;span> epoll_event epev_{};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">51&lt;/span>&lt;span> epev_.events &lt;span style="color:#ff79c6">=&lt;/span> EPOLLIN;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">52&lt;/span>&lt;span> epev_.data.fd &lt;span style="color:#ff79c6">=&lt;/span> socketFd;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">53&lt;/span>&lt;span> epoll_ctl(eFd, EPOLL_CTL_ADD, socketFd, &lt;span style="color:#ff79c6">&amp;amp;&lt;/span>epev_);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">54&lt;/span>&lt;span> epoll_event events[EVENT_NUM];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">55&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">56&lt;/span>&lt;span> &lt;span style="color:#ff79c6">while&lt;/span> (&lt;span style="color:#8be9fd;font-style:italic">true&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">57&lt;/span>&lt;span> &lt;span style="color:#8be9fd">int&lt;/span> eNum &lt;span style="color:#ff79c6">=&lt;/span> epoll_wait(eFd, events, EVENT_NUM, &lt;span style="color:#ff79c6">-&lt;/span>&lt;span style="color:#bd93f9">1&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">58&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (eNum &lt;span style="color:#ff79c6">==&lt;/span> &lt;span style="color:#ff79c6">-&lt;/span>&lt;span style="color:#bd93f9">1&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">59&lt;/span>&lt;span> std&lt;span style="color:#ff79c6">::&lt;/span>cout &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;epoll error&amp;#34;&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> std&lt;span style="color:#ff79c6">::&lt;/span>endl;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">60&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">61&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">62&lt;/span>&lt;span> std&lt;span style="color:#ff79c6">::&lt;/span>this_thread&lt;span style="color:#ff79c6">::&lt;/span>sleep_for((std&lt;span style="color:#ff79c6">::&lt;/span>chrono&lt;span style="color:#ff79c6">::&lt;/span>seconds(&lt;span style="color:#bd93f9">1&lt;/span>)));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">63&lt;/span>&lt;span> std&lt;span style="color:#ff79c6">::&lt;/span>cout &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;worker&amp;#34;&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> k &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34; in &amp;#34;&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> std&lt;span style="color:#ff79c6">::&lt;/span>endl;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">64&lt;/span>&lt;span> &lt;span style="color:#ff79c6">for&lt;/span> (&lt;span style="color:#8be9fd">int&lt;/span> i &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>; i &lt;span style="color:#ff79c6">&amp;lt;&lt;/span> eNum; &lt;span style="color:#ff79c6">++&lt;/span>i) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">65&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (events[i].data.fd &lt;span style="color:#ff79c6">==&lt;/span> socketFd) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">66&lt;/span>&lt;span> &lt;span style="color:#8be9fd">int&lt;/span> tfd &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">67&lt;/span>&lt;span> sockaddr_in cli_addr{};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">68&lt;/span>&lt;span> socklen_t length &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#ff79c6">sizeof&lt;/span>(cli_addr);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">69&lt;/span>&lt;span> tfd &lt;span style="color:#ff79c6">=&lt;/span> accept(socketFd, (sockaddr &lt;span style="color:#ff79c6">*&lt;/span>) &lt;span style="color:#ff79c6">&amp;amp;&lt;/span>cli_addr, &lt;span style="color:#ff79c6">&amp;amp;&lt;/span>length);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">70&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (tfd &lt;span style="color:#ff79c6">&amp;lt;=&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">71&lt;/span>&lt;span> std&lt;span style="color:#ff79c6">::&lt;/span>cout &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;accept error&amp;#34;&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> std&lt;span style="color:#ff79c6">::&lt;/span>endl;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">72&lt;/span>&lt;span> } &lt;span style="color:#ff79c6">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">73&lt;/span>&lt;span> std&lt;span style="color:#ff79c6">::&lt;/span>cout &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;worker&amp;#34;&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> k &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34; accept &amp;#34;&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> std&lt;span style="color:#ff79c6">::&lt;/span>endl;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">74&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">75&lt;/span>&lt;span> } &lt;span style="color:#ff79c6">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">76&lt;/span>&lt;span> &lt;span style="color:#6272a4">//å¤„ç†æ­£å¸¸çš„socketè¯»å†™äº‹ä»¶
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">77&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">78&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">79&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">80&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">81&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">82&lt;/span>&lt;span>&lt;span style="color:#8be9fd">int&lt;/span> &lt;span style="color:#50fa7b">main&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">83&lt;/span>&lt;span> std&lt;span style="color:#ff79c6">::&lt;/span>mutex mutex;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">84&lt;/span>&lt;span> std&lt;span style="color:#ff79c6">::&lt;/span>unique_lock&lt;span style="color:#ff79c6">&amp;lt;&lt;/span>std&lt;span style="color:#ff79c6">::&lt;/span>mutex&lt;span style="color:#ff79c6">&amp;gt;&lt;/span> lck(mutex);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">85&lt;/span>&lt;span> std&lt;span style="color:#ff79c6">::&lt;/span>condition_variable cv;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">86&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">87&lt;/span>&lt;span> &lt;span style="color:#6272a4">//ç¬¬ä¸‰ç§,å¤šä¸ªçº¿ç¨‹ä½¿ç”¨epollå¤šè·¯å¤ç”¨,æ¯ä¸ªçº¿ç¨‹åˆ†åˆ«bind,listen åŒä¸€ä¸ªç«¯å£, acceptå„è‡ªçš„socket
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">88&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">for&lt;/span> (&lt;span style="color:#8be9fd">int&lt;/span> i &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>; i &lt;span style="color:#ff79c6">&amp;lt;&lt;/span> WORKER_THREAD; &lt;span style="color:#ff79c6">++&lt;/span>i) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">89&lt;/span>&lt;span> std&lt;span style="color:#ff79c6">::&lt;/span>&lt;span style="color:#ff79c6">thread&lt;/span> th(&lt;span style="color:#ff79c6">&amp;amp;&lt;/span>Worker3, i &lt;span style="color:#ff79c6">+&lt;/span> &lt;span style="color:#bd93f9">1&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">90&lt;/span>&lt;span> th.detach();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">91&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">92&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">93&lt;/span>&lt;span> cv.wait(lck);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">94&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">95&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ç»“æœ
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-a210ececf944df66.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-a210ececf944df66.webp" alt="" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>ä¹Ÿæ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼Œå¤šä¸ªè¿æ¥æ¥çš„æ—¶å€™ï¼Œåªä¼šæœ‰ä¸€ä¸ªçº¿ç¨‹è¢«å”¤é†’ï¼Œç›¸å½“äºåœ¨å†…æ ¸çº§åˆ«ä¸­å®ç°äº†ä¸€ä¸ªè´Ÿè½½å‡è¡¡&lt;/p>
&lt;h2 id="æ€»ç»“">&lt;a href="#%e6%80%bb%e7%bb%93" class="header-anchor">&lt;/a>æ€»ç»“
&lt;/h2>&lt;p>ç®€å•æ€»ç»“ä¸€ä¸‹ï¼Œå½“å¤šä¸ªçº¿ç¨‹æˆ–è€…è¿›ç¨‹åŒæ—¶é˜»å¡åŒä¸€ä¸ªäº‹ä»¶çš„æ—¶å€™ï¼Œä¼šå‡ºç°æƒŠç¾¤ç°è±¡ï¼Œå¦‚æœä¸é€‚ç”¨epollç­‰å¤šè·¯å¤ç”¨æŠ€æœ¯ï¼Œåœ¨linux2.6 ä»¥åå†…æ ¸å·²ç»å¸®æˆ‘ä»¬å¤„ç†äº†æƒŠç¾¤é—®é¢˜ã€‚&lt;/p>
&lt;p>å¦‚æœä½¿ç”¨äº†epollï¼Œå°±éœ€è¦é¢å¤–å¤„ç†epollå¯¼è‡´çš„æƒŠç¾¤é—®é¢˜ï¼Œæœ‰ä¸¤ç§æ–¹å¼&lt;/p>
&lt;ol>
&lt;li>linux4.5å†…æ ¸ä¹‹åï¼Œepollæœ‰ä¸€ä¸ª&lt;code>EPOLLEXCLUSIVE&lt;/code>ç‰¹æ€§ï¼Œå¯ä»¥é˜²æ­¢epollæƒŠç¾¤å‡ºç°&lt;/li>
&lt;li>linux 3.9å†…æ ¸ä¹‹åç»™ socket æä¾›&lt;code>SO_REUSEPORT&lt;/code>ç‰¹æ€§ï¼Œå¯ä»¥å…è®¸å¤šä¸ªsocketç»‘å®šåœ¨åŒä¸€ä¸ªç«¯å£ä¸Šï¼Œç›¸å½“äºæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€ä¸ªsocketï¼Œåœ¨å¤„ç†acceptæ—¶ï¼Œå†…æ ¸ä¼šè‡ªåŠ¨å¤„ç†æƒŠç¾¤é—®é¢˜&lt;/li>
&lt;/ol>
&lt;p>1å’Œ2ä¸¤ç§æ–¹å¼éƒ½èƒ½æœ‰æ•ˆè§£å†³æƒŠç¾¤é—®é¢˜ï¼Œä½†æ˜¯ç›®å‰ä½¿ç”¨ socketçš„ &lt;code>SO_REUSEPORT&lt;/code> æ˜¯æœ€å¥½çš„æ–¹å¼.ã€‚&lt;/p>
&lt;p>æˆ‘é€šè¿‡æŸ¥èµ„æ–™å¾—åˆ° &lt;code> EPOLLEXCLUSIVE&lt;/code> æ ‡è¯†ä¼šä¿è¯ä¸€ä¸ªäº‹ä»¶å‘ç”Ÿæ—¶å€™åªæœ‰ä¸€ä¸ªçº¿ç¨‹ä¼šè¢«å”¤é†’ï¼Œæ¥é¿å…å¤šæƒŠç¾¤é—®é¢˜ã€‚ä¸è¿‡ä»»ä¸€æ—¶å€™åªèƒ½æœ‰ä¸€ä¸ªWorkerè°ƒç”¨ acceptï¼Œé™åˆ¶äº†çœŸæ­£å¹¶è¡Œçš„ååé‡ã€‚
è¿™ä¸ªæœ‰å¾…éªŒè¯ï¼Œç­‰æˆ‘æœ‰æ—¶é—´å†å»æ·±å…¥äº†è§£ä¸€ä¸‹ã€‚&lt;/p>
&lt;p>&lt;a class="link" href="https://gitee.com/lqxlucky/linux_socket_test1" target="_blank" rel="noopener"
>æµ‹è¯•demo&lt;/a>&lt;/p></description></item><item><title>linuxä¸‹ C++ ä½¿ç”¨ epoll å¤šè·¯å¤ç”¨ å®ç°é«˜æ€§èƒ½çš„tcpserver</title><link>https://lqxhub.github.io/posts/91655bdf/</link><pubDate>Sun, 14 Mar 2021 13:58:35 +0000</pubDate><guid>https://lqxhub.github.io/posts/91655bdf/</guid><description>&lt;p>linuxç³»ç»Ÿä¸­ï¼Œå®ç°socketå¤šè·¯å¤ç”¨çš„æŠ€æœ¯æœ‰&lt;strong>select&lt;/strong> ã€&lt;strong>poll&lt;/strong> ã€&lt;strong>epoll&lt;/strong> ç­‰å¤šç§æ–¹å¼ã€‚è¿™äº›ä¸åŒæ–¹å¼ä¸ªæœ‰ä¼˜ç¼ºç‚¹å’Œé€‚ç”¨åœºæ™¯ï¼Œè¿™ä¸æ˜¯æœ¬æ–‡è®¨è®ºçš„é‡ç‚¹ï¼Œåˆå…´è¶£çš„å¯ä»¥è‡ªå·±æœç´¢å­¦ä¹ ä¸€ä¸‹ã€‚ä½†æ˜¯åœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹ï¼Œ &lt;strong>epoll&lt;/strong> æ€§èƒ½æ˜¯æœ€é«˜çš„ï¼Œ &lt;strong>Nginx&lt;/strong> éƒ½å¬è¯´è¿‡å§ï¼Œå¤§åé¼é¼çš„&lt;strong>Nginx&lt;/strong> åº•å±‚ç”¨çš„å°±æ˜¯ &lt;strong>epoll&lt;/strong>ã€‚&lt;/p>
&lt;p>è¿™ç¯‡æ–‡ç« ä¸»è¦æ˜¯å†™æ€ä¹ˆç”¨ epollï¼Œè€Œä¸æ˜¯åŸç†åˆ†æã€‚è¿™ç¯‡æ–‡ç« ä¸æ˜¯æœ€å…¨çš„ï¼Œä¹Ÿä¸æ˜¯æœ€æ·±å…¥çš„ï¼Œä½†æ˜¯ç»å¯¹æ˜¯ä¸€ç¯‡èƒ½è®©æ™®é€šäººçœ‹æ‡‚çš„ï¼Œçœ‹å®Œèƒ½è‡ªå·±ç”¨epollå†™å‡ºä¸€ä¸ªtcpserverçš„æ–‡ç« ã€‚å…¨åºŸè¯ä¸å¤šè¯´ï¼Œç›´æ¥å¼€å§‹æ&lt;/p>
&lt;p>é¦–å…ˆæ˜ç¡®ä¸€ç‚¹ï¼Œepoll æ˜¯linuxç³»ç»Ÿæä¾›çš„ç³»ç»Ÿè°ƒç”¨ï¼Œä¹Ÿå°±è¯´ï¼Œepoll åœ¨Windowsç³»ç»Ÿä¸Šæ˜¯æ²¡æ³•ä½¿ç”¨çš„ï¼Œç›¸åº”çš„ä»£ç ä¹Ÿæ˜¯æ²¡æ³•ç¼–è¯‘çš„ã€‚å¦‚æœæœ‰äººçŸ¥é“æ€ä¹ˆåœ¨Windowsä¸­ç¼–è¯‘ï¼Œè¯·èµæ•™ã€‚&lt;/p>
&lt;h2 id="å·¥å…·">&lt;a href="#%e5%b7%a5%e5%85%b7" class="header-anchor">&lt;/a>å·¥å…·
&lt;/h2>&lt;p>æ–‡ä¸­ä½¿ç”¨çš„å¼€å‘ç¯å¢ƒ&lt;/p>
&lt;ol>
&lt;li>ç³»ç»Ÿ: &lt;code>Debian GNU/Linux 10 (buster)&lt;/code>&lt;/li>
&lt;li>linuxå†…æ ¸: &lt;code>4.19.0-14&lt;/code>&lt;/li>
&lt;li>gccç‰ˆæœ¬: &lt;code>8.3.0&lt;/code>&lt;/li>
&lt;/ol>
&lt;h2 id="å‡†å¤‡çŸ¥è¯†">&lt;a href="#%e5%87%86%e5%a4%87%e7%9f%a5%e8%af%86" class="header-anchor">&lt;/a>å‡†å¤‡çŸ¥è¯†
&lt;/h2>&lt;p>epollæ˜¯linuxå†…æ ¸æä¾›çš„åŠŸèƒ½ï¼Œè¿™ä¸ªåŠŸèƒ½å¯¹å¤–æä¾›ç³»ç»Ÿè°ƒç”¨ï¼Œåœ¨C/C++ä¸­é€šè¿‡ä¸‰ä¸ªå‡½æ•°å¯¹ç”¨æˆ·æä¾›åŠŸèƒ½&lt;/p>
&lt;ol>
&lt;li>
&lt;p>&lt;code>epoll_create(int __size)&lt;/code> åˆ›å»ºä¸€ä¸ªepollï¼Œ&lt;strong>_size&lt;/strong> å‚æ•°åœ¨linux2.6å†…æ ¸ä¹‹åå°±æ²¡æœ‰ä»€ä¹ˆä½œç”¨äº†, ä½†æ˜¯è¦&amp;gt;0ï¼Œä¸€èˆ¬ç›´æ¥å¡« &lt;strong>1&lt;/strong> å°±å¥½äº†ã€‚å‡½æ•°è¿”å›åˆ›å»ºçš„epollçš„æ–‡ä»¶æè¿°ç¬¦ï¼Œå¦‚æœåˆ›å»ºå¤±è´¥ï¼Œä¼šè¿”å› -1ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>epoll_ctl(nt __epfd, int __op, int __fd,struct epoll_event *__event)&lt;/code> æ“ä½œå·²æœ‰çš„epoll,&lt;strong>epfd&lt;/strong>epollçš„æ–‡ä»¶æè¿°ç¬¦ï¼›&lt;strong>op&lt;/strong>æ“ä½œæ–¹å¼ï¼Œæœ‰æ·»åŠ ã€åˆ é™¤ã€ä¿®æ”¹ç­‰ç­‰ï¼›&lt;strong>_fd&lt;/strong> è¦æ“ä½œå¯¹è±¡çš„æè¿°ç¬¦ï¼Œå¦‚æœæ˜¯æ“ä½œtcpè¿æ¥ï¼Œä¹Ÿä¼šå°±æ˜¯è¿™ä¸ªè¿æ¥çš„æè¿°ç¬¦ã€‚&lt;strong>_event&lt;/strong> epoll çš„å“åº”äº‹ä»¶ï¼Œå½“epollç®¡ç†çš„tcpè¿æ¥æœ‰äº‹ä»¶å‘ç”Ÿæ—¶ï¼Œä¼šé€šè¿‡ _event è¿™ä¸ªå¯¹è±¡ä¼ é€’å‡ºæ¥ï¼Œæ‰€ä»¥åœ¨æ·»åŠ è¿æ¥æ—¶ï¼Œè¦æŠŠè¿™ä¸ªè¿æ¥åŒ…è£…æˆä¸€ä¸ª &lt;strong>epoll_event&lt;/strong> å¯¹è±¡ &lt;/br>&lt;/p>
&lt;ul>
&lt;li>op ç±»å‹&lt;/li>
&lt;li>&lt;strong>EPOLL_CTL_ADD&lt;/strong> æ·»åŠ ä¸€ä¸ªæè¿°ç¬¦&lt;/li>
&lt;li>&lt;strong>EPOLL_CTL_DEL&lt;/strong> åˆ é™¤ä¸€ä¸ªæè¿°ç¬¦&lt;/li>
&lt;li>&lt;strong>EPOLL_CTL_MOD&lt;/strong> ä¿®æ”¹ä¸€ä¸ªæè¿°ç¬¦&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>&lt;code>epoll_wait(int __epfd, struct epoll_event *__events,int __maxevents, int __timeout)&lt;/code> å½“epollç®¡ç†çš„è¿æ¥ä¸­æœ‰å“åº”äº‹ä»¶å‘ç”Ÿæ—¶,ä¼šå›è°ƒè¿™ä¸ªå‡½æ•°ã€‚&lt;strong>epfd&lt;/strong>epollçš„æ–‡ä»¶æè¿°ç¬¦ï¼›&lt;strong>__events&lt;/strong> å¯ä»¥æ“ä½œçš„è¿æ¥æ•°ç»„ï¼›&lt;strong>__maxevents&lt;/strong> ä¸€ä¸ªå¯ä»¥å¤„ç†çš„æœ€å¤§äº‹ä»¶æ•°é‡ï¼›&lt;strong>__timeout&lt;/strong> è¶…æ—¶æ—¶é—´ï¼ˆå•ä½æ¯«ç§’ï¼‰ï¼Œå¦‚æœå¡«-1ï¼Œä¼šç›´åˆ°æœ‰å¯æ“ä½œäº‹ä»¶å‘ç”Ÿæ—¶æ‰ä¼šè¿”å›ï¼Œå› ä¸ºC++ä¸æ”¯æŒå‡½æ•°å¤šè¿”å›å€¼ï¼ŒåƒGoå¯ä»¥ç›´æ¥è¿”å›æ‰€æœ‰äº‹ä»¶å’Œæ•°é‡äº† (â•¥â•¯^â•°â•¥)ã€‚&lt;br>&lt;/p>
&lt;p>events ä¸­çš„å¸¸ç”¨çš„ç±»å‹ï¼š&lt;br>&lt;/p>
&lt;ul>
&lt;li>EPOLLIN ï¼šè¡¨ç¤ºå¯¹åº”çš„æ–‡ä»¶æè¿°ç¬¦å¯ä»¥è¯»ï¼ˆSOCKETæ­£å¸¸å…³é—­ï¼‰&lt;/li>
&lt;li>EPOLLOUTï¼šè¡¨ç¤ºå¯¹åº”çš„æ–‡ä»¶æè¿°ç¬¦å¯ä»¥å†™&lt;/li>
&lt;li>EPOLLPRIï¼šè¡¨ç¤ºå¯¹åº”çš„æ–‡ä»¶æè¿°ç¬¦æœ‰ç´§æ€¥çš„æ•°æ®å¯è¯»ï¼ˆè¡¨ç¤ºæœ‰å¸¦å¤–æ•°æ®åˆ°æ¥ï¼‰&lt;/li>
&lt;li>EPOLLERRï¼šè¡¨ç¤ºå¯¹åº”çš„æ–‡ä»¶æè¿°ç¬¦å‘ç”Ÿé”™è¯¯(é»˜è®¤æ³¨å†Œ)&lt;/li>
&lt;li>EPOLLHUPï¼šè¡¨ç¤ºå¯¹åº”çš„æ–‡ä»¶æè¿°ç¬¦è¢«æŒ‚æ–­(é»˜è®¤æ³¨å†Œ)&lt;/li>
&lt;li>EPOLLETï¼š å°†EPOLLè®¾ä¸ºè¾¹ç¼˜è§¦å‘(Edge Triggered)æ¨¡å¼ï¼Œè¿™æ˜¯ç›¸å¯¹äºæ°´å¹³è§¦å‘(Level Triggered)æ¥è¯´çš„&lt;/li>
&lt;li>EPOLLONESHOTï¼šåªç›‘å¬ä¸€æ¬¡äº‹ä»¶ï¼Œå½“ç›‘å¬å®Œè¿™æ¬¡äº‹ä»¶ä¹‹åï¼Œå¦‚æœè¿˜éœ€è¦ç»§ç»­ç›‘å¬è¿™ä¸ªsocketçš„è¯ï¼Œéœ€è¦å†æ¬¡æŠŠè¿™ä¸ªsocketåŠ å…¥åˆ°EPOLLé˜Ÿåˆ—é‡Œ
æ˜¯ä¸æ˜¯å¾ˆæƒŠå¥‡ï¼Œè¿™ä¹ˆç‰›é€¼çš„epollå°±ä¸‰ä¸ªå‡½æ•°ï¼Œç¬¬ä¸€æ¬¡çœ‹åˆ°çš„æ—¶å€™æˆ‘ä¹Ÿè§‰å¾—å¾ˆå¥‡æ€ªï¼Œä¸‰ä¸ªå‡½æ•°å°±èƒ½æå®šé‚£ä¹ˆå¤æ‚çš„äº‹æƒ…ã€‚ä¸è¿‡æƒ³æƒ³ä¹Ÿæ˜¯ï¼ŒæŠŠå¤æ‚çš„ä¸œè¥¿ç®€åŒ–ï¼Œæ‰èƒ½ä½“ç°å‡ºå¤§ç¥çš„å®åŠ›&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ol>
&lt;h3 id="epollçš„ä¸¤ç§æ¨¡å¼">&lt;a href="#epoll%e7%9a%84%e4%b8%a4%e7%a7%8d%e6%a8%a1%e5%bc%8f" class="header-anchor">&lt;/a>epollçš„ä¸¤ç§æ¨¡å¼
&lt;/h3>&lt;p>epoll äº‹ä»¶æœ‰ä¸¤ç§æ¨¡å‹ &lt;strong>Level Triggered&lt;/strong> (LT) å’Œ &lt;strong>Edge Triggered&lt;/strong> (ET)ï¼š&lt;/br>&lt;/p>
&lt;ul>
&lt;li>
&lt;p>LT(level triggeredï¼Œæ°´å¹³è§¦å‘æ¨¡å¼)æ˜¯é»˜è®¤çš„å·¥ä½œæ–¹å¼ï¼Œå¹¶ä¸”åŒæ—¶æ”¯æŒ block å’Œ non-block socketã€‚åœ¨è¿™ç§åšæ³•ä¸­ï¼Œå†…æ ¸å‘Šè¯‰ä½ ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦æ˜¯å¦å°±ç»ªäº†ï¼Œç„¶åä½ å¯ä»¥å¯¹è¿™ä¸ªå°±ç»ªçš„fdè¿›è¡ŒIOæ“ä½œã€‚å¦‚æœä½ ä¸ä½œä»»ä½•æ“ä½œï¼Œå†…æ ¸è¿˜æ˜¯ä¼šç»§ç»­é€šçŸ¥ä½ çš„ï¼Œæ‰€ä»¥ï¼Œè¿™ç§æ¨¡å¼ç¼–ç¨‹å‡ºé”™è¯¯å¯èƒ½æ€§è¦å°ä¸€ç‚¹ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ET(edge-triggeredï¼Œè¾¹ç¼˜è§¦å‘æ¨¡å¼)æ˜¯é«˜é€Ÿå·¥ä½œæ–¹å¼ï¼Œåªæ”¯æŒno-block socketã€‚åœ¨è¿™ç§æ¨¡å¼ä¸‹ï¼Œå½“æè¿°ç¬¦ä»æœªå°±ç»ªå˜ä¸ºå°±ç»ªæ—¶ï¼Œå†…æ ¸é€šè¿‡epollå‘Šè¯‰ä½ ã€‚ç„¶åå®ƒä¼šå‡è®¾ä½ çŸ¥é“æ–‡ä»¶æè¿°ç¬¦å·²ç»å°±ç»ªï¼Œå¹¶ä¸”ä¸ä¼šå†ä¸ºé‚£ä¸ªæ–‡ä»¶æè¿°ç¬¦å‘é€æ›´å¤šçš„å°±ç»ªé€šçŸ¥ï¼Œç­‰åˆ°ä¸‹æ¬¡æœ‰æ–°çš„æ•°æ®è¿›æ¥çš„æ—¶å€™æ‰ä¼šå†æ¬¡å‡ºå‘å°±ç»ªäº‹ä»¶ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>æŠŠsocketè®¾ç½®ä¸ºéé˜»å¡æ¨¡å¼çš„æ–¹æ³•&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c++" data-lang="c++">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>&lt;span style="color:#8be9fd">int&lt;/span> flags &lt;span style="color:#ff79c6">=&lt;/span> fcntl(fd, F_GETFL, &lt;span style="color:#bd93f9">0&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span>fcntl(fd, F_SETFL, flags &lt;span style="color:#ff79c6">|&lt;/span> O_NONBLOCK);
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>éœ€è¦çš„å¤´æ–‡ä»¶ &lt;code>#include &amp;lt;fcntl.h&amp;gt;&lt;/code>&lt;/p>
&lt;h2 id="epollåŸç†">&lt;a href="#epoll%e5%8e%9f%e7%90%86" class="header-anchor">&lt;/a>epollåŸç†
&lt;/h2>&lt;p>ç®€å•é€šè¿‡ç”»å›¾è§£é‡Šä¸€ä¸‹epollçš„å·¥ä½œåŸç†
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-cb78a80f112544ea.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-cb78a80f112544ea.webp" alt="" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>è¿™é‡Œæ²¡æœ‰æ¶‰åŠå¤ªåº•å±‚çš„ä¸œè¥¿ï¼Œå› ä¸ºå¤ªåº•å±‚çš„æˆ‘ä¹Ÿæ²¡ç ”ç©¶è¿‡ï¼Œä¸æ•¢ä¹±è®²ã€‚çŸ¥ä¹‹ä¸ºçŸ¥ä¹‹ï¼Œä¸çŸ¥ä¸ºä¸çŸ¥ã€‚&lt;/br>
epollå¯ä»¥çœ‹åšæ˜¯ä¸€ä¸ªç”±æ“ä½œç³»ç»Ÿæä¾›çš„å®¹å™¨ï¼Œè¿™ä¸ªå®¹å™¨ç®¡ç†äº†ä¸€äº› &lt;strong>epoll_event&lt;/strong> ï¼ˆå›¾ä¸­æˆ‘ç”»æˆå•å‘é“¾è¡¨äº†ï¼Œå®é™…ä¸Šç”¨çš„æ˜¯çº¢é»‘æ ‘ï¼Œå› ä¸ºç”»æ ‘å¤ªéº»çƒ¦äº†ï¼‰ï¼Œè¿™ä¸ªeventæ˜¯æˆ‘ä»¬æ·»åŠ è¿›å»çš„ï¼Œeventä¸­è®¾ç½®äº†è¦å“åº”çš„äº‹ä»¶ç±»å‹ï¼Œå½“epoll æ£€æµ‹åˆ°å…·ä½“çš„ event æœ‰å¯¹åº”çš„äº‹ä»¶å‘ç”Ÿæ—¶ï¼Œä¼šé€šè¿‡&lt;strong>epoll_wait()&lt;/strong> é€šçŸ¥ã€‚&lt;/p>
&lt;h2 id="ç®€å•çš„epollå®ç°">&lt;a href="#%e7%ae%80%e5%8d%95%e7%9a%84epoll%e5%ae%9e%e7%8e%b0" class="header-anchor">&lt;/a>ç®€å•çš„epollå®ç°
&lt;/h2>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c++" data-lang="c++">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">#include&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;iostream&amp;gt;&lt;/span>&lt;span style="color:#6272a4">//æ§åˆ¶å°è¾“å‡º
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span>&lt;span style="color:#ff79c6">#include&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;sys/socket.h&amp;gt;&lt;/span>&lt;span style="color:#6272a4">//åˆ›å»ºsocket
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span>&lt;span style="color:#ff79c6">#include&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;netinet/in.h&amp;gt;&lt;/span>&lt;span style="color:#6272a4">//socket addr
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span>&lt;span style="color:#ff79c6">#include&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;sys/epoll.h&amp;gt;&lt;/span>&lt;span style="color:#6272a4">//epoll
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span>&lt;span style="color:#ff79c6">#include&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;unistd.h&amp;gt;&lt;/span>&lt;span style="color:#6272a4">//closeå‡½æ•°
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span>&lt;span style="color:#ff79c6">#include&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;fcntl.h&amp;gt;&lt;/span>&lt;span style="color:#6272a4">//è®¾ç½®éé˜»å¡
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span>&lt;span style="color:#ff79c6">using&lt;/span> &lt;span style="color:#ff79c6">namespace&lt;/span> std;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 10&lt;/span>&lt;span>&lt;span style="color:#8be9fd">int&lt;/span> &lt;span style="color:#50fa7b">main&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 11&lt;/span>&lt;span> &lt;span style="color:#ff79c6">const&lt;/span> &lt;span style="color:#8be9fd">int&lt;/span> EVENTS_SIZE &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#bd93f9">20&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 12&lt;/span>&lt;span> &lt;span style="color:#6272a4">//è¯»socketçš„æ•°ç»„
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 13&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#8be9fd">char&lt;/span> buff[&lt;span style="color:#bd93f9">1024&lt;/span>];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 14&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 15&lt;/span>&lt;span> &lt;span style="color:#6272a4">//åˆ›å»ºä¸€ä¸ªtcp socket
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 16&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#8be9fd">int&lt;/span> socketFd &lt;span style="color:#ff79c6">=&lt;/span> socket(AF_INET, SOCK_STREAM, IPPROTO_TCP);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 17&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 18&lt;/span>&lt;span> &lt;span style="color:#6272a4">//è®¾ç½®socketç›‘å¬çš„åœ°å€å’Œç«¯å£
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 19&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> sockaddr_in sockAddr{};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 20&lt;/span>&lt;span> sockAddr.sin_port &lt;span style="color:#ff79c6">=&lt;/span> htons(&lt;span style="color:#bd93f9">8088&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 21&lt;/span>&lt;span> sockAddr.sin_family &lt;span style="color:#ff79c6">=&lt;/span> AF_INET;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 22&lt;/span>&lt;span> sockAddr.sin_addr.s_addr &lt;span style="color:#ff79c6">=&lt;/span> htons(INADDR_ANY);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 23&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 24&lt;/span>&lt;span> &lt;span style="color:#6272a4">//å°†socketå’Œåœ°å€ç»‘å®š
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 25&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">if&lt;/span> (bind(socketFd, (sockaddr &lt;span style="color:#ff79c6">*&lt;/span>) &lt;span style="color:#ff79c6">&amp;amp;&lt;/span>sockAddr, &lt;span style="color:#ff79c6">sizeof&lt;/span>(sockAddr)) &lt;span style="color:#ff79c6">==&lt;/span> &lt;span style="color:#ff79c6">-&lt;/span>&lt;span style="color:#bd93f9">1&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 26&lt;/span>&lt;span> cout &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;bind error&amp;#34;&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> endl;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 27&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> &lt;span style="color:#ff79c6">-&lt;/span>&lt;span style="color:#bd93f9">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 28&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 29&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 30&lt;/span>&lt;span> &lt;span style="color:#6272a4">//å¼€å§‹ç›‘å¬socket,å½“è°ƒç”¨listenä¹‹å,
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 31&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#6272a4">//è¿›ç¨‹å°±å¯ä»¥è°ƒç”¨acceptæ¥æ¥å—ä¸€ä¸ªå¤–æ¥çš„è¯·æ±‚
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 32&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#6272a4">//ç¬¬äºŒä¸ªå‚æ•°,è¯·æ±‚é˜Ÿåˆ—çš„é•¿åº¦
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 33&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">if&lt;/span> (listen(socketFd, &lt;span style="color:#bd93f9">10&lt;/span>) &lt;span style="color:#ff79c6">==&lt;/span> &lt;span style="color:#ff79c6">-&lt;/span>&lt;span style="color:#bd93f9">1&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 34&lt;/span>&lt;span> cout &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;listen error&amp;#34;&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> endl;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 35&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> &lt;span style="color:#ff79c6">-&lt;/span>&lt;span style="color:#bd93f9">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 36&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 37&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 38&lt;/span>&lt;span> &lt;span style="color:#6272a4">//åˆ›å»ºä¸€ä¸ªepoll,sizeå·²ç»ä¸èµ·ä½œç”¨äº†,ä¸€èˆ¬å¡«1å°±å¥½äº†
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 39&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#8be9fd">int&lt;/span> eFd &lt;span style="color:#ff79c6">=&lt;/span> epoll_create(&lt;span style="color:#bd93f9">1&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 40&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 41&lt;/span>&lt;span> &lt;span style="color:#6272a4">//æŠŠsocketåŒ…è£…æˆä¸€ä¸ªepoll_eventå¯¹è±¡
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 42&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#6272a4">//å¹¶æ·»åŠ åˆ°epollä¸­
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 43&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> epoll_event epev{};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 44&lt;/span>&lt;span> epev.events &lt;span style="color:#ff79c6">=&lt;/span> EPOLLIN;&lt;span style="color:#6272a4">//å¯ä»¥å“åº”çš„äº‹ä»¶,è¿™é‡Œåªå“åº”å¯è¯»å°±å¯ä»¥äº†
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 45&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> epev.data.fd &lt;span style="color:#ff79c6">=&lt;/span> socketFd;&lt;span style="color:#6272a4">//socketçš„æ–‡ä»¶æè¿°ç¬¦
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 46&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> epoll_ctl(eFd, EPOLL_CTL_ADD, socketFd, &lt;span style="color:#ff79c6">&amp;amp;&lt;/span>epev);&lt;span style="color:#6272a4">//æ·»åŠ åˆ°epollä¸­
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 47&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 48&lt;/span>&lt;span> &lt;span style="color:#6272a4">//å›è°ƒäº‹ä»¶çš„æ•°ç»„,å½“epollä¸­æœ‰å“åº”äº‹ä»¶æ—¶,é€šè¿‡è¿™ä¸ªæ•°ç»„è¿”å›
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 49&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> epoll_event events[EVENTS_SIZE];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 50&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 51&lt;/span>&lt;span> &lt;span style="color:#6272a4">//æ•´ä¸ªepoll_wait å¤„ç†éƒ½è¦åœ¨ä¸€ä¸ªæ­»å¾ªç¯ä¸­å¤„ç†
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 52&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">while&lt;/span> (&lt;span style="color:#8be9fd;font-style:italic">true&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 53&lt;/span>&lt;span> &lt;span style="color:#6272a4">//è¿™ä¸ªå‡½æ•°ä¼šé˜»å¡,ç›´åˆ°è¶…æ—¶æˆ–è€…æœ‰å“åº”äº‹ä»¶å‘ç”Ÿ
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 54&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#8be9fd">int&lt;/span> eNum &lt;span style="color:#ff79c6">=&lt;/span> epoll_wait(eFd, events, EVENTS_SIZE, &lt;span style="color:#ff79c6">-&lt;/span>&lt;span style="color:#bd93f9">1&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 55&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 56&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (eNum &lt;span style="color:#ff79c6">==&lt;/span> &lt;span style="color:#ff79c6">-&lt;/span>&lt;span style="color:#bd93f9">1&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 57&lt;/span>&lt;span> cout &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;epoll_wait&amp;#34;&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> endl;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 58&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> &lt;span style="color:#ff79c6">-&lt;/span>&lt;span style="color:#bd93f9">1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 59&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 60&lt;/span>&lt;span> &lt;span style="color:#6272a4">//éå†æ‰€æœ‰çš„äº‹ä»¶
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 61&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">for&lt;/span> (&lt;span style="color:#8be9fd">int&lt;/span> i &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>; i &lt;span style="color:#ff79c6">&amp;lt;&lt;/span> eNum; i&lt;span style="color:#ff79c6">++&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 62&lt;/span>&lt;span> &lt;span style="color:#6272a4">//åˆ¤æ–­è¿™æ¬¡æ˜¯ä¸æ˜¯socketå¯è¯»(æ˜¯ä¸æ˜¯æœ‰æ–°çš„è¿æ¥)
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 63&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">if&lt;/span> (events[i].data.fd &lt;span style="color:#ff79c6">==&lt;/span> socketFd) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 64&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (events[i].events &lt;span style="color:#ff79c6">&amp;amp;&lt;/span> EPOLLIN) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 65&lt;/span>&lt;span> sockaddr_in cli_addr{};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 66&lt;/span>&lt;span> socklen_t length &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#ff79c6">sizeof&lt;/span>(cli_addr);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 67&lt;/span>&lt;span> &lt;span style="color:#6272a4">//æ¥å—æ¥è‡ªsocketè¿æ¥
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 68&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#8be9fd">int&lt;/span> fd &lt;span style="color:#ff79c6">=&lt;/span> accept(socketFd, (sockaddr &lt;span style="color:#ff79c6">*&lt;/span>) &lt;span style="color:#ff79c6">&amp;amp;&lt;/span>cli_addr, &lt;span style="color:#ff79c6">&amp;amp;&lt;/span>length);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 69&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (fd &lt;span style="color:#ff79c6">&amp;gt;&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 70&lt;/span>&lt;span> &lt;span style="color:#6272a4">//è®¾ç½®å“åº”äº‹ä»¶,è®¾ç½®å¯è¯»å’Œè¾¹ç¼˜(ET)æ¨¡å¼
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 71&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#6272a4">//å¾ˆå¤šäººä¼šæŠŠå¯å†™äº‹ä»¶(EPOLLOUT)ä¹Ÿæ³¨å†Œäº†,åé¢ä¼šè§£é‡Š
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 72&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> epev.events &lt;span style="color:#ff79c6">=&lt;/span> EPOLLIN &lt;span style="color:#ff79c6">|&lt;/span> EPOLLET;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 73&lt;/span>&lt;span> epev.data.fd &lt;span style="color:#ff79c6">=&lt;/span> fd;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 74&lt;/span>&lt;span> &lt;span style="color:#6272a4">//è®¾ç½®è¿æ¥ä¸ºéé˜»å¡æ¨¡å¼
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 75&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#8be9fd">int&lt;/span> flags &lt;span style="color:#ff79c6">=&lt;/span> fcntl(fd, F_GETFL, &lt;span style="color:#bd93f9">0&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 76&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (flags &lt;span style="color:#ff79c6">&amp;lt;&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 77&lt;/span>&lt;span> cout &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;set no block error, fd:&amp;#34;&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> fd &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> endl;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 78&lt;/span>&lt;span> &lt;span style="color:#ff79c6">continue&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 79&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 80&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (fcntl(fd, F_SETFL, flags &lt;span style="color:#ff79c6">|&lt;/span> O_NONBLOCK) &lt;span style="color:#ff79c6">&amp;lt;&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 81&lt;/span>&lt;span> cout &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;set no block error, fd:&amp;#34;&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> fd &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> endl;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 82&lt;/span>&lt;span> &lt;span style="color:#ff79c6">continue&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 83&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 84&lt;/span>&lt;span> &lt;span style="color:#6272a4">//å°†æ–°çš„è¿æ¥æ·»åŠ åˆ°epollä¸­
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 85&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> epoll_ctl(eFd, EPOLL_CTL_ADD, fd, &lt;span style="color:#ff79c6">&amp;amp;&lt;/span>epev);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 86&lt;/span>&lt;span> cout &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;client on line fd:&amp;#34;&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> fd &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> endl;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 87&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 88&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 89&lt;/span>&lt;span> } &lt;span style="color:#ff79c6">else&lt;/span> {&lt;span style="color:#6272a4">//ä¸æ˜¯socketçš„å“åº”äº‹ä»¶
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 90&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 91&lt;/span>&lt;span> &lt;span style="color:#6272a4">//åˆ¤æ–­æ˜¯ä¸æ˜¯æ–­å¼€å’Œè¿æ¥å‡ºé”™
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 92&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#6272a4">//å› ä¸ºè¿æ¥æ–­å¼€å’Œå‡ºé”™æ—¶,ä¹Ÿä¼šå“åº”`EPOLLIN`äº‹ä»¶
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 93&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">if&lt;/span> (events[i].events &lt;span style="color:#ff79c6">&amp;amp;&lt;/span> EPOLLERR &lt;span style="color:#ff79c6">||&lt;/span> events[i].events &lt;span style="color:#ff79c6">&amp;amp;&lt;/span> EPOLLHUP) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 94&lt;/span>&lt;span> &lt;span style="color:#6272a4">//å‡ºé”™æ—¶,ä»epollä¸­åˆ é™¤å¯¹åº”çš„è¿æ¥
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 95&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#6272a4">//ç¬¬ä¸€ä¸ªæ˜¯è¦æ“ä½œçš„epollçš„æè¿°ç¬¦
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 96&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#6272a4">//å› ä¸ºæ˜¯åˆ é™¤,æ‰€æœ‰eventå‚æ•°å¤©nullå°±å¯ä»¥äº†
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 97&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> epoll_ctl(eFd, EPOLL_CTL_DEL, events[i].data.fd, &lt;span style="color:#ff79c6">nullptr&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 98&lt;/span>&lt;span> cout &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;client out fd:&amp;#34;&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> events[i].data.fd &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> endl;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 99&lt;/span>&lt;span> close(events[i].data.fd);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">100&lt;/span>&lt;span> } &lt;span style="color:#ff79c6">else&lt;/span> &lt;span style="color:#ff79c6">if&lt;/span> (events[i].events &lt;span style="color:#ff79c6">&amp;amp;&lt;/span> EPOLLIN) {&lt;span style="color:#6272a4">//å¦‚æœæ˜¯å¯è¯»äº‹ä»¶
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">101&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">102&lt;/span>&lt;span> &lt;span style="color:#6272a4">//å¦‚æœåœ¨windowsä¸­,è¯»socketä¸­çš„æ•°æ®è¦ç”¨recv()å‡½æ•°
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">103&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#8be9fd">int&lt;/span> len &lt;span style="color:#ff79c6">=&lt;/span> read(events[i].data.fd, buff, &lt;span style="color:#ff79c6">sizeof&lt;/span>(buff));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">104&lt;/span>&lt;span> &lt;span style="color:#6272a4">//å¦‚æœè¯»å–æ•°æ®å‡ºé”™,å…³é—­å¹¶ä»epollä¸­åˆ é™¤è¿æ¥
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">105&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">if&lt;/span> (len &lt;span style="color:#ff79c6">==&lt;/span> &lt;span style="color:#ff79c6">-&lt;/span>&lt;span style="color:#bd93f9">1&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">106&lt;/span>&lt;span> epoll_ctl(eFd, EPOLL_CTL_DEL, events[i].data.fd, &lt;span style="color:#ff79c6">nullptr&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">107&lt;/span>&lt;span> cout &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;client out fd:&amp;#34;&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> events[i].data.fd &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> endl;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">108&lt;/span>&lt;span> close(events[i].data.fd);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">109&lt;/span>&lt;span> } &lt;span style="color:#ff79c6">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">110&lt;/span>&lt;span> &lt;span style="color:#6272a4">//æ­£å¸¸è¯»å–,æ‰“å°è¯»åˆ°çš„æ•°æ®
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">111&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> cout &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> buff &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> endl;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">112&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">113&lt;/span>&lt;span> &lt;span style="color:#6272a4">//å‘å®¢æˆ·ç«¯å‘æ•°æ®
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">114&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#8be9fd">char&lt;/span> a[] &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;123456&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">115&lt;/span>&lt;span> &lt;span style="color:#6272a4">//å¦‚æœåœ¨windowsä¸­,å‘socketä¸­å†™æ•°æ®è¦ç”¨send()å‡½æ•°
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">116&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> write(events[i].data.fd, a, &lt;span style="color:#ff79c6">sizeof&lt;/span>(a));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">117&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">118&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">119&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">120&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">121&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">122&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å¸¸è§çš„é—®é¢˜å’Œæ³¨æ„äº‹é¡¹åœ¨æ³¨é‡Šä¸­ï¼Œå°±å•è§£é‡Šä¸€ä¸‹æ–°è¿æ¥æ³¨å†Œäº‹ä»¶çš„é—®é¢˜å§ï¼Œå¾ˆå¤šæ–‡ç« ä¸­éƒ½ä¼šæŠŠå¯å†™äº‹ä»¶ä¹Ÿæ³¨å†Œè¿›å»ï¼Œåƒè¿™æ ·&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-C++" data-lang="C++">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>sockaddr_in cli_addr{};
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span>socklen_t length &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#ff79c6">sizeof&lt;/span>(cli_addr);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span>&lt;span style="color:#6272a4">//æ¥å—æ¥è‡ªsocketè¿æ¥
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span>&lt;span style="color:#8be9fd">int&lt;/span> fd &lt;span style="color:#ff79c6">=&lt;/span> accept(socketFd, (sockaddr &lt;span style="color:#ff79c6">*&lt;/span>) &lt;span style="color:#ff79c6">&amp;amp;&lt;/span>cli_addr, &lt;span style="color:#ff79c6">&amp;amp;&lt;/span>length);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span>&lt;span style="color:#ff79c6">if&lt;/span> (fd &lt;span style="color:#ff79c6">&amp;gt;&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span> epev.events &lt;span style="color:#ff79c6">=&lt;/span> EPOLLIN &lt;span style="color:#ff79c6">|&lt;/span> EPOLLET &lt;span style="color:#ff79c6">|&lt;/span> EPOLLOUT;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span> epev.data.fd &lt;span style="color:#ff79c6">=&lt;/span> fd;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span> epoll_ctl(eFd, EPOLL_CTL_ADD, fd, &lt;span style="color:#ff79c6">&amp;amp;&lt;/span>epev);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span> cout &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;client on line fd:&amp;#34;&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> fd &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> endl;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä½†æ˜¯ç»è¿‡æµ‹è¯•ï¼Œä¸æ³¨å†Œå¯å†™äº‹ä»¶ï¼Œç›´æ¥å¾€socketä¸­å†™ä¹Ÿæ˜¯å¯ä»¥çš„&lt;br>
ç»è¿‡æŸ¥èµ„æ–™å¾—çŸ¥:&lt;br>&lt;/p>
&lt;ul>
&lt;li>&lt;strong>EPOLLIN&lt;/strong> : å¦‚æœçŠ¶æ€æ”¹å˜äº†(æ¯”å¦‚ ä»æ— åˆ°æœ‰)ï¼Œåªè¦è¾“å…¥ç¼“å†²åŒºå¯è¯»å°±ä¼šè§¦å‘&lt;/li>
&lt;li>&lt;strong>EPOLLOUT&lt;/strong> : å¦‚æœçŠ¶æ€æ”¹å˜äº†(æ¯”å¦‚ ä»æ»¡åˆ°ä¸æ»¡)ï¼Œåªè¦è¾“å‡ºç¼“å†²åŒºå¯å†™å°±ä¼šè§¦
å¦‚æœæŠŠå¯å†™ä¹Ÿæ³¨å†Œä¸Šï¼Œä¼šé¢‘ç¹å›è°ƒï¼Œè¿™é‡Œä¼šæœ‰å¾ˆå¤šæ— ç”¨çš„å›è°ƒï¼Œå¯¼è‡´æ€§èƒ½ä¸‹é™ã€‚
æœ‰ä¸€ç§æ€è·¯ï¼Œå½“å‘socketå†™å¤±è´¥åï¼ˆwriteå‡½æ•°è¿”å›å€¼ == -1ï¼‰ï¼Œæ³¨å†Œä¸Š &lt;strong>EPOLLOUT&lt;/strong> å½“å“åº”äº†å¯å†™äº‹ä»¶åï¼Œé‡æ–°å¾€socketä¸­å†™æ•°æ®ï¼Œå†™æˆåŠŸåï¼Œå†å–æ¶ˆæ‰ &lt;strong>EPOLLOUT&lt;/strong>ã€‚ è¿™é‡Œå°±ä¸ç»™å‡ºç¤ºä¾‹äº†&lt;/li>
&lt;/ul>
&lt;h2 id="å®¢æˆ·ç«¯æµ‹è¯•">&lt;a href="#%e5%ae%a2%e6%88%b7%e7%ab%af%e6%b5%8b%e8%af%95" class="header-anchor">&lt;/a>å®¢æˆ·ç«¯æµ‹è¯•
&lt;/h2>&lt;p>è¿™æ¬¡å…³æ³¨çš„æ˜¯æœåŠ¡ç«¯å®ç°ï¼Œå®¢æˆ·ç«¯å°±ä¸ç”¨C++å†™äº†ï¼Œç”¨Goå†™äº†ä¸€ä¸ªclientï¼ˆæ²¡åˆ«çš„åŸå› ï¼Œåªæ˜¯å› ä¸ºGoå†™èµ·äº†ç®€å•ï¼‰&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">package&lt;/span> main
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span>&lt;span style="color:#ff79c6">import&lt;/span> (
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span> &lt;span style="color:#f1fa8c">&amp;#34;fmt&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span> &lt;span style="color:#f1fa8c">&amp;#34;net&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span> &lt;span style="color:#f1fa8c">&amp;#34;sync&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span> &lt;span style="color:#f1fa8c">&amp;#34;time&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">const&lt;/span> (
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span> MAX_CONN = &lt;span style="color:#bd93f9">10&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> &lt;span style="color:#50fa7b">main&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15&lt;/span>&lt;span> &lt;span style="color:#8be9fd;font-style:italic">var&lt;/span> wg sync.WaitGroup
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16&lt;/span>&lt;span> wg.&lt;span style="color:#50fa7b">Add&lt;/span>(&lt;span style="color:#bd93f9">1&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17&lt;/span>&lt;span> &lt;span style="color:#ff79c6">for&lt;/span> i &lt;span style="color:#ff79c6">:=&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>; i &amp;lt; MAX_CONN; i&lt;span style="color:#ff79c6">++&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18&lt;/span>&lt;span> &lt;span style="color:#ff79c6">go&lt;/span> &lt;span style="color:#50fa7b">Conn&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;192.168.199.164:8088&amp;#34;&lt;/span>, i)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19&lt;/span>&lt;span> time.&lt;span style="color:#50fa7b">Sleep&lt;/span>(time.Millisecond &lt;span style="color:#ff79c6">*&lt;/span> &lt;span style="color:#bd93f9">100&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21&lt;/span>&lt;span> wg.&lt;span style="color:#50fa7b">Wait&lt;/span>()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> &lt;span style="color:#50fa7b">Conn&lt;/span>(addr &lt;span style="color:#8be9fd">string&lt;/span>, id &lt;span style="color:#8be9fd">int&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25&lt;/span>&lt;span> conn, err &lt;span style="color:#ff79c6">:=&lt;/span> net.&lt;span style="color:#50fa7b">Dial&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;tcp&amp;#34;&lt;/span>, addr)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> err &lt;span style="color:#ff79c6">!=&lt;/span> &lt;span style="color:#ff79c6">nil&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27&lt;/span>&lt;span> fmt.&lt;span style="color:#50fa7b">Println&lt;/span>(err)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30&lt;/span>&lt;span> fmt.&lt;span style="color:#50fa7b">Println&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;connect &amp;#34;&lt;/span>, id)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31&lt;/span>&lt;span> &lt;span style="color:#ff79c6">go&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">func&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32&lt;/span>&lt;span> buf &lt;span style="color:#ff79c6">:=&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">make&lt;/span>([]&lt;span style="color:#8be9fd">byte&lt;/span>, &lt;span style="color:#bd93f9">1024&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33&lt;/span>&lt;span> &lt;span style="color:#ff79c6">for&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34&lt;/span>&lt;span> n, err &lt;span style="color:#ff79c6">:=&lt;/span> conn.&lt;span style="color:#50fa7b">Read&lt;/span>(buf)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> err &lt;span style="color:#ff79c6">!=&lt;/span> &lt;span style="color:#ff79c6">nil&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36&lt;/span>&lt;span> &lt;span style="color:#ff79c6">break&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38&lt;/span>&lt;span> fmt.&lt;span style="color:#50fa7b">Println&lt;/span>(id, &lt;span style="color:#f1fa8c">&amp;#34;read: &amp;#34;&lt;/span>, &lt;span style="color:#8be9fd;font-style:italic">string&lt;/span>(buf[:n]))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40&lt;/span>&lt;span> }()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41&lt;/span>&lt;span> time.&lt;span style="color:#50fa7b">Sleep&lt;/span>(time.Second &lt;span style="color:#ff79c6">*&lt;/span> &lt;span style="color:#bd93f9">1&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42&lt;/span>&lt;span> &lt;span style="color:#ff79c6">for&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43&lt;/span>&lt;span> _, err &lt;span style="color:#ff79c6">:=&lt;/span> conn.&lt;span style="color:#50fa7b">Write&lt;/span>([]&lt;span style="color:#8be9fd;font-style:italic">byte&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;hello&amp;#34;&lt;/span>))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> err &lt;span style="color:#ff79c6">!=&lt;/span> &lt;span style="color:#ff79c6">nil&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45&lt;/span>&lt;span> &lt;span style="color:#ff79c6">break&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47&lt;/span>&lt;span> time.&lt;span style="color:#50fa7b">Sleep&lt;/span>(time.Second &lt;span style="color:#ff79c6">*&lt;/span> &lt;span style="color:#bd93f9">10&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™åªæ˜¯ä¸€ä¸ªæµ‹è¯•ç”¨çš„ï¼Œå†™çš„å¾ˆç²—ç³™ï¼Œä½†æ˜¯ä¸å½±å“ä½¿ç”¨&lt;/p>
&lt;p>æœåŠ¡ç«¯æ‰“å°ä¿¡æ¯
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-8fb0e898063f3db7.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-8fb0e898063f3db7.webp" alt="æœåŠ¡ç«¯" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>å®¢æˆ·ç«¯æ‰“å°ä¿¡æ¯
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-42cda40faa00d188.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-42cda40faa00d188.webp" alt="å®¢æˆ·ç«¯" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;h2 id="æ€»ç»“">&lt;a href="#%e6%80%bb%e7%bb%93" class="header-anchor">&lt;/a>æ€»ç»“
&lt;/h2>&lt;ol>
&lt;li>epollæ˜¯socketå¤šè·¯å¤ç”¨æŠ€æœ¯çš„ä¸€ç§ï¼Œè¿˜æœ‰selectå’Œpoll&lt;/li>
&lt;li>epoll åªèƒ½åœ¨linuxä½¿ç”¨(Windowsä¸‹æ€ä¹ˆç”¨æˆ‘æ²¡æ‰¾åˆ°,å¦‚æœè¯´é”™äº†è¯·æŒ‡æ­£)&lt;/li>
&lt;li>epoll äº‹ä»¶æœ‰ Level Triggered (LT) å’Œ Edge Triggered (ET) ä¸¤ç§æ¨¡å‹ï¼ŒLTæ˜¯é»˜è®¤æ¨¡å¼ï¼ŒETæ˜¯é«˜æ€§èƒ½æ¨¡å¼&lt;/li>
&lt;/ol>
&lt;p>å¦å¤–ï¼Œæˆ‘ä½¿ç”¨é¢å‘å¯¹è±¡çš„æ–¹å¼å°è£…äº†ä¸€ä¸ªepollçš„tcpserver ä»£ç æœ‰ç‚¹å¤šï¼Œå°±ä¸è´´åœ¨è¿™äº†ï¼Œå·²ç»ä¸Šä¼ 
&lt;a class="link" href="https://github.com/lqxhub/epoll_server" target="_blank" rel="noopener"
>github&lt;/a>
&lt;a class="link" href="https://gitee.com/lqxlucky/epoll_server" target="_blank" rel="noopener"
>ç äº‘&lt;/a>&lt;/p>
&lt;p>æ¬¢è¿ç»™ç‚¹ä¸ªstar ãƒ¾(oâ—•âˆ€â—•)ï¾‰ãƒ¾&lt;/p></description></item><item><title>go ä½¿ç”¨ pprof æ’æŸ¥å†…å­˜æ³„éœ²</title><link>https://lqxhub.github.io/posts/24bc8405/</link><pubDate>Sun, 14 Mar 2021 13:58:27 +0000</pubDate><guid>https://lqxhub.github.io/posts/24bc8405/</guid><description>&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/118dbbd1af54c33c82bdbd4d3297a9709b550205.jpg" alt="Featured image of post go ä½¿ç”¨ pprof æ’æŸ¥å†…å­˜æ³„éœ²" />&lt;p>go æ˜¯è‡ªå¸¦gcçš„è¯­è¨€ï¼Œä¼šè‡ªåŠ¨ç®¡ç†å†…å­˜ï¼Œä¸ç”¨åƒC/C++é‚£æ ·ï¼Œéœ€è¦ç¨‹åºå‘˜æ‰‹åŠ¨é‡Šæ”¾å†…å­˜ï¼Œä¸ç”¨æ‰‹åŠ¨ç®¡ç†å†…å­˜ï¼Œå°±èƒ½å°‘æ‰å¾ˆå¤šå¤´å‘&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-4f43c913680427e5.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-4f43c913680427e5.webp" alt="" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>goçš„GCä¼šè‡ªåŠ¨ç®¡ç†å†…å­˜ï¼Œä½†æ˜¯è¿™ä¸ä»£è¡¨goç¨‹åºå°±ä¸ä¼šå†…å­˜æ³„éœ²äº†ã€‚ goå¸¸è§äº§ç”Ÿå†…å­˜æ³„éœ²çš„åŸå› å°±æ˜¯&lt;code>goroutine&lt;/code>æ²¡æœ‰ç»“æŸï¼Œç®€å•è¯´å°±æ˜¯goroutine è¢«é˜»å¡äº†ï¼Œè¿™æ ·å°±ä¼šå¯¼è‡´goroutineå¼•ç”¨çš„å†…å­˜ä¸è¢«GCå›æ”¶ï¼Œä¹Ÿå°±å¯¼è‡´äº†å†…å­˜æ³„éœ²ã€‚
å½“ç„¶äº§ç”Ÿå†…å­˜æ³„éœ²çš„åŸå› è¿˜æœ‰åˆ«çš„ï¼Œåªæ˜¯æš‚æ—¶æˆ‘è¿˜æ²¡æœ‰é‡åˆ°ã€‚ä¸ç®¡ä»€ä¹ˆåŸå› äº§ç”Ÿçš„å†…å­˜æ³„éœ²ï¼Œæœ€ç»ˆéƒ½æ˜¯å› ä¸ºå¼‚å¸¸çš„å¼•ç”¨ï¼Œå¯¼è‡´è¯¥è¢«å›æ”¶çš„å†…å­˜æ²¡æœ‰è¢«gc å›æ”¶æ‰&lt;/p>
&lt;h2 id="èµ·å› ">&lt;a href="#%e8%b5%b7%e5%9b%a0" class="header-anchor">&lt;/a>èµ·å› 
&lt;/h2>&lt;p>è¯´èµ·goå†…å­˜æ³„éœ²åˆ†æï¼Œè¿˜è¦ä»å¹´å‰çš„ä¸€æ¬¡ç¨‹åºå‹æµ‹è¯´èµ·ã€‚æˆ‘ç”¨ä¸€ä¸ªæµ‹è¯•ç¨‹åºå‹æµ‹æˆ‘ä»¬æ¸¸æˆçš„ä¸€äº›æ•°æ®ï¼Œå¤§çº¦å¼€äº†3000ä¸ªtcpè¿æ¥åˆ°æ¸¸æˆã€‚æ¸¸æˆæ•°æ®æ²¡æœ‰é—®é¢˜ï¼Œä½†æ˜¯å½“æµ‹è¯•ç»“æŸåï¼Œå‘ç°æ¸¸æˆçš„Gatewayå†…å­˜å ç”¨ä¸€ç›´æ²¡æœ‰ä¸‹é™ã€‚æœ¬èƒ½çš„è®©æˆ‘æƒ³èµ·äº†æ˜¯ä¸æ˜¯å†…å­˜æ³„éœ²äº†ã€‚é©¬ä¸Šç”¨pprofåˆ†æäº†ä¸€ä¸‹å†…å­˜ï¼Œå‘ç°æœç„¶æ˜¯å†…å­˜æ³„éœ²äº†ã€‚&lt;/p>
&lt;p>å› ä¸ºæ—¶å…¬å¸ä»£ç ï¼Œä¸æ–¹ä¾¿æ‹¿å‡ºäº†åˆ†æï¼Œå¤§ä½“è¯´ä¸€ä¸‹åŸå› å§&lt;/p>
&lt;p>Gatewayæ˜¯ä¸€ä¸ªè¯»å†™åˆ†ç¦»çš„tcpæœåŠ¡ï¼Œä¹Ÿå°±æ˜¯æ¯ä¸€ä¸ªè¿æ¥éƒ½è¦æœ‰ä¸¤ä¸ªgoroutineï¼Œä¸€ä¸ªè¯»ï¼Œä¸€ä¸ªå†™ã€‚&lt;/p>
&lt;p>ä½†æ˜¯å½“tcpè¿æ¥æ–­å¼€æ—¶ï¼Œå› ä¸ºæ—¶åºé—®é¢˜ï¼Œå¯¼è‡´goroutineé˜»å¡äº†ï¼Œä¸€ç›´æ²¡æœ‰ç»“æŸï¼Œå°±æ˜¯å¯¼è‡´äº†ç›¸å…³è”çš„å†…å­˜æ²¡æœ‰é‡Šæ”¾ã€‚&lt;/p>
&lt;p>å› ä¸ºæ—¶å…¬å¸ä»£ç ï¼Œä¸èƒ½éšä¾¿è´´å‡ºæ¥ï¼Œè¿™æ¬¡å°±è‡ªå·±å†™ä¸ªç®€å•çš„demoæ¨¡æ‹Ÿä¸€ä¸‹å§&lt;/p>
&lt;p>å› ä¸ºgo è‡ªå¸¦çš„pprof åªèƒ½å±•ç¤ºæ–‡å­—ï¼Œä¸å¤ªæ˜æ˜¾ï¼Œæ‰€æœ‰å…ˆå®‰è£…ä¸€ä¸ªå¯è§†åŒ–æ’ä»¶ &lt;strong>graphviz&lt;/strong> &lt;a class="link" href="https://www.graphviz.org/download/" target="_blank" rel="noopener"
>ä¼ é€é—¨&lt;/a>
linuxä¸Šå¯ä»¥ç›´æ¥é€šè¿‡ &lt;code>apt&lt;/code> æˆ–è€… &lt;code>yum&lt;/code> å®‰è£…å°±è¡Œäº†ã€‚
windowsä¸Šå»ç½‘ç«™ä¸‹ä¸€ä¸ªå°±å¥½äº†ï¼Œæˆ‘ä¸‹è½½ &lt;code>.msi&lt;/code> æ ¼å¼çš„å®‰è£…åä¸èƒ½ç”¨ï¼Œé‡æ–°ä¸‹äº†ä¸€ä¸ª å‹ç¼©åŒ…ï¼Œè§£å‹åæŠŠ &lt;code>bin&lt;/code> ç›®å½•é…ç½®åˆ°ç¯å¢ƒå˜é‡çš„ &lt;code>path&lt;/code> ä¸­å°±å¯ä»¥ä½¿ç”¨äº†&lt;/p>
&lt;h2 id="å¼€å§‹">&lt;a href="#%e5%bc%80%e5%a7%8b" class="header-anchor">&lt;/a>å¼€å§‹
&lt;/h2>&lt;p>å†™ä¸€ä¸ªç®€å•çš„demo æ¨¡æ‹Ÿä¸€ä¸‹å†…å­˜æ³„éœ²&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">package&lt;/span> main
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span>&lt;span style="color:#ff79c6">import&lt;/span> (
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span> &lt;span style="color:#f1fa8c">&amp;#34;math/rand&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span> &lt;span style="color:#f1fa8c">&amp;#34;net/http&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span> _ &lt;span style="color:#f1fa8c">&amp;#34;net/http/pprof&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span> &lt;span style="color:#f1fa8c">&amp;#34;sync&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> &lt;span style="color:#50fa7b">main&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span> &lt;span style="color:#ff79c6">go&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">func&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span> http.&lt;span style="color:#50fa7b">ListenAndServe&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;0.0.0.0:8090&amp;#34;&lt;/span>, &lt;span style="color:#ff79c6">nil&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span> }()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15&lt;/span>&lt;span> c &lt;span style="color:#ff79c6">:=&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">make&lt;/span>(&lt;span style="color:#8be9fd;font-style:italic">chan&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">struct&lt;/span>{})
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16&lt;/span>&lt;span> &lt;span style="color:#8be9fd;font-style:italic">var&lt;/span> wg sync.WaitGroup
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17&lt;/span>&lt;span> wg.&lt;span style="color:#50fa7b">Add&lt;/span>(&lt;span style="color:#bd93f9">1&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18&lt;/span>&lt;span> &lt;span style="color:#ff79c6">for&lt;/span> i &lt;span style="color:#ff79c6">:=&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>; i &amp;lt; &lt;span style="color:#bd93f9">10000&lt;/span>; i&lt;span style="color:#ff79c6">++&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19&lt;/span>&lt;span> &lt;span style="color:#ff79c6">go&lt;/span> &lt;span style="color:#50fa7b">one&lt;/span>(c)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21&lt;/span>&lt;span> wg.&lt;span style="color:#50fa7b">Wait&lt;/span>()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> &lt;span style="color:#50fa7b">one&lt;/span>(c &lt;span style="color:#8be9fd;font-style:italic">chan&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">struct&lt;/span>{}) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25&lt;/span>&lt;span> &lt;span style="color:#8be9fd;font-style:italic">var&lt;/span> a []&lt;span style="color:#8be9fd">int64&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26&lt;/span>&lt;span> &lt;span style="color:#ff79c6">for&lt;/span> i &lt;span style="color:#ff79c6">:=&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>; i &amp;lt; &lt;span style="color:#bd93f9">10000&lt;/span>; i&lt;span style="color:#ff79c6">++&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27&lt;/span>&lt;span> a = &lt;span style="color:#8be9fd;font-style:italic">append&lt;/span>(a, rand.&lt;span style="color:#50fa7b">Int63&lt;/span>())
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30&lt;/span>&lt;span> &lt;span style="color:#ff79c6">&amp;lt;-&lt;/span>c
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ç¨‹åºå¾ˆç®€å•ï¼Œåœ¨ for å¾ªç¯ä¸­å¼€å¯ 1000 ä¸ªåç¨‹ï¼Œæ¯ä¸ªåç¨‹ä¸­å¾€åˆ‡ç‰‡ä¸­append 1000ä¸ªæ•°æ®ã€‚
ç”¨ä¸€ä¸ªchannelæ¨¡æ‹Ÿåç¨‹é˜»å¡ï¼Œè¿™æ ·å°±ä¼šå¯¼è‡´goroutineä¸ä¼šç»“æŸã€‚&lt;/p>
&lt;h3 id="ä½¿ç”¨goå†å¸¦çš„pprofæŸ¥çœ‹">&lt;a href="#%e4%bd%bf%e7%94%a8go%e5%86%8d%e5%b8%a6%e7%9a%84pprof%e6%9f%a5%e7%9c%8b" class="header-anchor">&lt;/a>ä½¿ç”¨goå†å¸¦çš„pprofæŸ¥çœ‹
&lt;/h3>&lt;p>ä»£ç ä¸­ç›‘å¬äº† &lt;strong>8090&lt;/strong> ç«¯å£ï¼Œåœ¨æµè§ˆå™¨ä¸­è¾“å…¥ &lt;code>http://127.0.0.1:8090/debug/pprof/&lt;/code>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-907bb5ac613c504a.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-907bb5ac613c504a.webp" alt="" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>ä¸‹é¢éƒ½æœ‰è§£é‡Šï¼Œå°±ä¸ç”¨è¯¦ç»†ä»‹ç»äº†ï¼ŒæŒ‘ä¸€ä¸¤ä¸ªè¯´ä¸€ä¸‹&lt;/p>
&lt;ul>
&lt;li>allocs : ç¨‹åºè¿è¡ŒæœŸé—´ï¼Œæ‰€æœ‰å†…å­˜åˆ†é…çš„æ ·æœ¬&lt;/li>
&lt;li>heap : å½“å‰æ´»åŠ¨å¯¹è±¡çš„å†…å­˜åˆ†é…é‡‡æ ·&lt;/li>
&lt;li>guroutine : å½“å‰æ‰€æœ‰åç¨‹çš„å †æ ˆè·Ÿè¸ª&lt;/li>
&lt;/ul>
&lt;p>å¯ä»¥çœ‹åˆ°ï¼Œå½“å‰çš„ç¨‹åºæ€»å…±æœ‰10005ä¸ªåç¨‹ï¼Œ21æ¬¡å †å†…å­˜åˆ†é…ï¼Œè¯´æ˜æˆ‘ä»¬çš„åç¨‹æ˜¯è¢«é˜»å¡çš„ã€‚&lt;/p>
&lt;h3 id="ä½¿ç”¨graphvizæŸ¥çœ‹">&lt;a href="#%e4%bd%bf%e7%94%a8graphviz%e6%9f%a5%e7%9c%8b" class="header-anchor">&lt;/a>ä½¿ç”¨graphvizæŸ¥çœ‹
&lt;/h3>&lt;p>åœ¨å‘½ä»¤è¡Œä¸­ï¼Œåœ¨Windowsä¸­å¯ä»¥ä½¿ç”¨ powerShell
è¾“å…¥ &lt;code>go tool pprof -http :8081 http://127.0.0.1:8090/debug/pprof/heap&lt;/code>&lt;/p>
&lt;p>å¦‚æœè¦åˆ†æCPUå ç”¨ï¼Œä½¿ç”¨&lt;/p>
&lt;p>&lt;code>go tool pprof -http :8081 http://127.0.0.1:8090/debug/pprof/profile?seconds=120&lt;/code>&lt;/p>
&lt;p>ä¼šåœ¨æµè§ˆå™¨ä¸­æ‰“å¼€
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-9e9641988f601903.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-9e9641988f601903.webp" alt="" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>è¿™å°±æ˜¯å½“å‰ &lt;strong>heap&lt;/strong> é‡‡æ ·å›¾
å¯ä»¥åœ¨ &lt;strong>VIEW&lt;/strong> ä¸­åˆ‡æ¢ä¸åŒçš„æ˜¾ç¤ºæ–¹å¼&lt;/p>
&lt;p>å›¾ä¸­æ–¹å—è¶Šå¤§ä¾¿æ˜¯å ç”¨çš„å†…å­˜è¶Šå¤šï¼Œæ–¹å—ä¸­è¿çº¿è¶Šç²—è¡¨ç¤ºè€—æ—¶è¶Šå¤š&lt;/p>
&lt;h2 id="å†…å­˜æ³„éœ²è¯¯åŒº">&lt;a href="#%e5%86%85%e5%ad%98%e6%b3%84%e9%9c%b2%e8%af%af%e5%8c%ba" class="header-anchor">&lt;/a>å†…å­˜æ³„éœ²è¯¯åŒº
&lt;/h2>&lt;p>æˆ‘åœ¨æ’æŸ¥å†…å­˜æ³„éœ²æ—¶ï¼Œå½“æˆ‘æŠŠgoroutineé˜»å¡è§£å†³åï¼Œé€šè¿‡linux çš„ &lt;strong>top&lt;/strong> å‘½ä»¤æŸ¥çœ‹Gatewayå†…å­˜å ç”¨æ—¶ï¼Œå‘ç°å†…å­˜æ²¡æœ‰é™ä¸‹æ¥ï¼Œä¸€æ—¶è®©æˆ‘é™·å…¥å›°æƒ‘ï¼Œä¸ºå•¥goroutine éƒ½ç»“æŸäº†ï¼Œä¸ºå•¥å†…å­˜è¿˜ä¸é‡Šæ”¾å‘¢ï¼Ÿç›´åˆ°æˆ‘åœ¨ç½‘ä¸Šæ‰¾åˆ°äº†è¿™ç¯‡æ–‡ç«  &lt;a class="link" href="https://colobu.com/2019/08/28/go-memory-leak-i-dont-think-so/" target="_blank" rel="noopener"
>ä¼ é€é—¨&lt;/a>&lt;br>
è¿™ä½å¤§ç¥å†™çš„golang ç›¸å…³çš„æ–‡ç« ï¼Œæ˜¯ç›®å‰æˆ‘åœ¨ç½‘ä¸Šæ‰¾åˆ°çš„æœ€ç‰›é€¼çš„ä¹‹ä¸€ï¼Œæ–‡ç« ä¸å…‰æœ‰æ·±åº¦ï¼Œè€Œä¸”é€šä¿—æ˜“æ‡‚ã€‚&lt;/p>
&lt;h3 id="é‡æ–°éªŒè¯">&lt;a href="#%e9%87%8d%e6%96%b0%e9%aa%8c%e8%af%81" class="header-anchor">&lt;/a>é‡æ–°éªŒè¯
&lt;/h3>&lt;p>ä¿®æ”¹ä¸Šé¢çš„ä»£ç &lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">package&lt;/span> main
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span>&lt;span style="color:#ff79c6">import&lt;/span> (
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span> &lt;span style="color:#f1fa8c">&amp;#34;math/rand&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span> &lt;span style="color:#f1fa8c">&amp;#34;net/http&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span> _ &lt;span style="color:#f1fa8c">&amp;#34;net/http/pprof&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span> &lt;span style="color:#f1fa8c">&amp;#34;sync&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span> &lt;span style="color:#f1fa8c">&amp;#34;time&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> &lt;span style="color:#50fa7b">main&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span> &lt;span style="color:#ff79c6">go&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">func&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span> http.&lt;span style="color:#50fa7b">ListenAndServe&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;0.0.0.0:8090&amp;#34;&lt;/span>, &lt;span style="color:#ff79c6">nil&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span> }()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16&lt;/span>&lt;span> &lt;span style="color:#8be9fd;font-style:italic">var&lt;/span> wg sync.WaitGroup
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17&lt;/span>&lt;span> wg.&lt;span style="color:#50fa7b">Add&lt;/span>(&lt;span style="color:#bd93f9">1&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18&lt;/span>&lt;span> &lt;span style="color:#ff79c6">for&lt;/span> i &lt;span style="color:#ff79c6">:=&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>; i &amp;lt; &lt;span style="color:#bd93f9">10000&lt;/span>; i&lt;span style="color:#ff79c6">++&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19&lt;/span>&lt;span> &lt;span style="color:#ff79c6">go&lt;/span> &lt;span style="color:#50fa7b">one&lt;/span>()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21&lt;/span>&lt;span> wg.&lt;span style="color:#50fa7b">Wait&lt;/span>()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> &lt;span style="color:#50fa7b">one&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25&lt;/span>&lt;span> &lt;span style="color:#8be9fd;font-style:italic">var&lt;/span> a []&lt;span style="color:#8be9fd">int64&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26&lt;/span>&lt;span> &lt;span style="color:#ff79c6">for&lt;/span> i &lt;span style="color:#ff79c6">:=&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>; i &amp;lt; &lt;span style="color:#bd93f9">10000&lt;/span>; i&lt;span style="color:#ff79c6">++&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27&lt;/span>&lt;span> a = &lt;span style="color:#8be9fd;font-style:italic">append&lt;/span>(a, rand.&lt;span style="color:#50fa7b">Int63&lt;/span>())
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29&lt;/span>&lt;span> time.&lt;span style="color:#50fa7b">Sleep&lt;/span>(time.Second &lt;span style="color:#ff79c6">*&lt;/span> &lt;span style="color:#bd93f9">1&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ç°åœ¨ go å‡ºæ¥çš„çš„å‡½æ•° &lt;code>one&lt;/code> ä¸å†ä¸€ç›´é˜»å¡ï¼Œè€Œæ˜¯åªä¼šé˜»å¡5ç§’&lt;/p>
&lt;p>æŠŠç¨‹åºè¿è¡Œèµ·æ¥çœ‹ä¸€ä¸‹&lt;/p>
&lt;p>ç­‰ä¸€æ®µæ—¶é—´åï¼Œå‘ç°goroutineæ•°é‡å·²ç»ä¸‹æ¥äº†ï¼Œè¯´æ˜é˜»å¡çš„åç¨‹éƒ½å·²ç»ç»“æŸäº†ï¼Œå¦‚å›¾
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-7d29e861c224e51b.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-7d29e861c224e51b.webp" alt="" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>ä½†æ˜¯é€šè¿‡ä»»åŠ¡ç®¡ç†å™¨ä¸­ï¼Œçœ‹åˆ°ç¨‹åºè¿˜æ˜¯å ç”¨ç€å¤§é‡çš„å†…å­˜
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-58966e5ea8aaecf5.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-58966e5ea8aaecf5.webp" alt="ä»»åŠ¡ç®¡ç†å™¨" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>è¿™æ—¶ç‚¹å‡» &lt;strong>heap&lt;/strong> æŸ¥çœ‹å…·ä½“çš„å †å†…å­˜æƒ…å†µï¼Œæ‹‰åˆ°æœ€ä½ä¸‹ï¼Œçœ‹åˆ°ä¸€å †å‚æ•°&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-f5dba243c2239857.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-f5dba243c2239857.webp" alt="" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>å‚æ•°å¾ˆå¤šï¼Œä½†æ˜¯é‡ç‚¹å…³æ³¨è¢«æ¡†å‡ºæ¥çš„é‚£å‡ ä¸ªå°±å¥½äº†ï¼Œè¯¦ç»†çš„åˆ†æåœ¨å¤§ç¥çš„æ–‡ç« ä¸­æœ‰åˆ†æï¼Œåœ¨goçš„åº“æ–‡ä»¶ä¸­ä¹Ÿèƒ½æ‰¾åˆ°ï¼Œé‡Œé¢æœ‰è¯¦ç»†çš„æ³¨é‡Šã€‚
è·¯å¾„ &lt;code>src-&amp;gt;runtime-&amp;gt;mstats.go&lt;/code> æ–‡ä»¶ä¸­æœ‰ &lt;strong>MemStats&lt;/strong> çš„å®šä¹‰å’Œæ³¨é‡Š&lt;/p>
&lt;p>è¿™äº›å‚æ•°çš„å•ä½éƒ½æ˜¯å­—èŠ‚&lt;/p>
&lt;ul>
&lt;li>TotalAlloc : æ‰€æœ‰å¯¹è±¡åˆ†é…çš„æ€»å’Œï¼Œæ•´ä¸ªç¨‹åºè¿è¡ŒæœŸé—´ï¼Œåªå¢ä¸å‡&lt;/li>
&lt;li>HeapAlloc : åˆ†é…çš„å †å¯¹è±¡çš„å­—èŠ‚æ•°ï¼ŒåŒ…æ‹¬å¯è®¿é—®çš„å¯¹è±¡å’Œæœªè¢«GCå›æ”¶çš„ä¸å¯è®¿é—®çš„å¯¹è±¡ï¼Œè¿™ä¸ªå€¼ä¼šåŠ¨æ€å˜åŒ–ï¼Œåˆ†é…å¯¹è±¡æ—¶å¢åŠ ï¼Œå›æ”¶å¯¹è±¡åå‡å°‘&lt;/li>
&lt;li>HeapIdle : é—²ç½®çš„spanä¸­çš„å­—èŠ‚æ•°ï¼Œè¿™äº›spanä¸­å·²ç»æ²¡æœ‰å¯¹è±¡äº†ï¼ˆä¸ç”¨äº†ï¼‰ï¼Œä½†æ˜¯ç°åœ¨è¿˜æ²¡æœ‰è¿˜ç»™æ“ä½œç³»ç»Ÿï¼Œè¿™äº›spanå¯ä»¥é‡æ–°ç”¨æ¥åˆ†é…heapå’Œstackã€‚HeapIdle å‡å» HeapReleased çš„å€¼å¯ä»¥å½“ä½œ &amp;ldquo;å¯ä»¥è¿”å›åˆ°æ“ä½œç³»ç»Ÿä½†ç”±è¿è¡Œæ—¶ä¿ç•™çš„å†…å­˜é‡&amp;rdquo;ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œgoçš„runtimeå¯ä»¥åœ¨ä¸åƒæ“ä½œç³»ç»Ÿç”³è¯·å†…å­˜çš„æƒ…å†µä¸‹ï¼Œä¹Ÿå¯ä»¥åˆ†é…heapç©ºé—´ï¼Œè¿™æ ·å¯ä»¥æé«˜ç¨‹åºæ€§èƒ½&lt;/li>
&lt;li>HeapInuse : æ­£åœ¨ä½¿ç”¨çš„spançš„å­—èŠ‚å¤§å°&lt;/li>
&lt;li>HeapReleased : æ˜¯è¿”è¿˜ç»™æ“ä½œç³»ç»Ÿçš„ç‰©ç†å†…å­˜çš„å­—èŠ‚æ•°&lt;/li>
&lt;/ul>
&lt;p>å›åˆ°æˆ‘ä»¬çš„æµ‹è¯•ç¨‹åºä¸­ï¼Œå½“æ‰€æœ‰çš„goroutineéƒ½ç»“æŸæ—¶ï¼ŒGCä¼šå¼€å§‹å›æ”¶åˆ‡ç‰‡ï¼Œä½†æ˜¯è¢«å›æ”¶çš„å†…å­˜ä¸ä¼šç›´æ¥æ¢ç»™æ“ä½œç³»ç»Ÿï¼Œè€Œæ˜¯ç”±goçš„runtimeæš‚æ—¶ä¿ç®¡ï¼ˆä¹Ÿå°±æ˜¯ &lt;strong>HeapIdle&lt;/strong> å€¼ä¼šå˜å¤§ï¼‰ï¼Œæ¥ä¸‹æ¥å¦‚æœå†æ¬¡éœ€è¦åˆ†é…ç©ºé—´ï¼Œgoçš„runtimeå¯ä»¥ä¸å‘æ“ä½œç³»ç»Ÿç”³è¯·å†…å­˜ï¼Œç›´æ¥ä»è‡ªå·±ä¿ç®¡çš„é—²ç½®å†…å­˜ä¸­åˆ†é…ï¼Œè¿™æ ·å¯ä»¥æé«˜ç¨‹åºæ€§èƒ½ã€‚è‡³äºGOçš„runtimeä»€ä¹ˆæ—¶å€™æŠŠè¿™éƒ¨åˆ†å†…å­˜è¿˜ç»™æ“ä½œç³»ç»Ÿï¼Œä¸åŒçš„åˆ†é…ç­–ç•¥å’Œä¸åŒçš„ç³»ç»Ÿä¸å¤ªä¸€æ ·ï¼Œè¿™ä¸ªæœ‰ç‚¹æ·±ï¼Œæˆ‘è¿˜æ²¡æœ‰æ·±å…¥ç ”ç©¶è¿™äº›ã€‚ä¸è¿‡ &lt;a class="link" href="https://colobu.com/2019/08/28/go-memory-leak-i-dont-think-so/" target="_blank" rel="noopener"
>ä¼ é€é—¨&lt;/a> çš„æ–‡ä¸­æœ‰ä»‹ç» &lt;strong>MADV_FREE&lt;/strong> æœ‰å…´è¶£å¯ä»¥è‡ªå·±å­¦ä¹ ä¸€ä¸‹&lt;/p>
&lt;h2 id="æ€»ç»“">&lt;a href="#%e6%80%bb%e7%bb%93" class="header-anchor">&lt;/a>æ€»ç»“
&lt;/h2>&lt;ul>
&lt;li>go è™½ç„¶æœ‰GCï¼Œä½†æ˜¯ä½¿ç”¨ä¸å½“ä¹Ÿä¼šå¯¼è‡´å†…å­˜æ³„éœ²&lt;/li>
&lt;li>ä¸åŒçš„æ“ä½œç³»ç»Ÿå’Œä¸ç”¨ç­–ç•¥ï¼Œä¼šå¯¼è‡´goç¨‹åºçš„å†…å­˜å·²ç»è¢«å›æ”¶äº†ï¼Œä½†æ˜¯æ²¡æœ‰åŠæ—¶çš„å½’è¿˜ç»™æ“ä½œç³»ç»Ÿ&lt;/li>
&lt;/ul>
&lt;p>ç”±äºæ°´å¹³æœ‰é™ï¼Œæ–‡ä¸­å¦‚æœ‰è°¬å¤„ï¼Œè¿˜è¯·åœ¨è¯„è®ºåŒºä¸åèµæ•™&lt;/p></description></item><item><title>linuxä¸‹é€šè¿‡rpathè§£å†³cmakeåŠ¨æ€ç¼–è¯‘åæ‰¾ä¸åˆ°åŠ¨æ€é“¾æ¥åº“é—®é¢˜</title><link>https://lqxhub.github.io/posts/497a7ebf/</link><pubDate>Sat, 13 Mar 2021 17:48:50 +0000</pubDate><guid>https://lqxhub.github.io/posts/497a7ebf/</guid><description>&lt;p>è¿™æ¬¡ä¹¦æ¥ä¸Šå›ï¼Œå‰æ®µæ—¶é—´å†™äº†ä¸€ç¯‡ã€Šä½¿ç”¨cmakeæ„å»ºC/C++é¡¹ç›®å’ŒåŠ¨æ€åº“ã€‹çš„æ–‡ç« ï¼Œ &lt;a class="link" href="https://lqxhub.github.io/posts/a20c5e48/" >ä¼ é€é—¨&lt;/a>ã€‚
ä½†æ˜¯ç›´æ¥é€šè¿‡cmakeç¼–è¯‘é“¾æ¥åï¼Œä¼šæœ‰ä¸€ä¸ªé—®é¢˜ï¼Œé‚£å°±æ˜¯éœ€è¦çš„.soæ–‡ä»¶ä¸èƒ½æ›´æ”¹ç›®å½•ï¼Œä¸€æ—¦.soæ–‡ä»¶ç›®å½•å˜äº†,æ•´ä¸ªç¨‹åºå°±æ²¡æ³•è¿è¡Œäº†ï¼Œè¿™è‚¯å®šæ˜¯ä¸è¡Œçš„ã€‚&lt;/p>
&lt;h2 id="åŸå› ">&lt;a href="#%e5%8e%9f%e5%9b%a0" class="header-anchor">&lt;/a>åŸå› 
&lt;/h2>&lt;p>åæ¥æˆ‘æŸ¥ä¸€ä¸‹ä¸€ä¸‹ï¼Œlinuxç³»ç»Ÿä¸­ï¼Œç¨‹åºåŠ è½½è¿è¡Œéœ€è¦çš„.soæ–‡ä»¶æ˜¯æœ‰é¡ºåºçš„&lt;/p>
&lt;ol>
&lt;li>ç¯å¢ƒå˜é‡LD_LIBRARY_PATHæŒ‡å®šçš„è·¯å¾„&lt;/li>
&lt;li>gcc ç¼–è¯‘æ—¶æŒ‡å®šçš„è¿è¡Œæ—¶åº“è·¯å¾„-rpath&lt;/li>
&lt;li>ldconfig é…ç½®æ–‡ä»¶ld.so.confæŒ‡å®šçš„è·¯å¾„&lt;/li>
&lt;li>ç³»ç»Ÿé»˜è®¤åº“ä½ç½® /lib, /usr/lib&lt;/li>
&lt;/ol>
&lt;p>å¦‚æœæ²¡æœ‰æŒ‡å®šsoçš„ä½ç½®ï¼Œgccä¼šè‡ªåŠ¨æŠŠå½“å‰soæ‰€åœ¨çš„ç›®å½•ä½œä¸ºsoçš„è¿æ¥ç›®å½•ã€‚çŸ¥é“åŸå› äº†ï¼Œé—®é¢˜å°±å¥½è§£å†³äº†&lt;/p>
&lt;h2 id="è§£å†³åŠæ³•">&lt;a href="#%e8%a7%a3%e5%86%b3%e5%8a%9e%e6%b3%95" class="header-anchor">&lt;/a>è§£å†³åŠæ³•
&lt;/h2>&lt;p>å…ˆçœ‹ä¸€ä¸‹ç°åœ¨çš„ &lt;strong>CMakeLists.txt&lt;/strong>æ–‡ä»¶&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cmake" data-lang="cmake">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">cmake_minimum_required&lt;/span>(&lt;span style="color:#f1fa8c">VERSION&lt;/span> &lt;span style="color:#f1fa8c">3.13.3&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">project&lt;/span>(&lt;span style="color:#f1fa8c">project1&lt;/span> &lt;span style="color:#f1fa8c">C&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">set&lt;/span>(&lt;span style="color:#f1fa8c">CMAKE_C_STANDARD&lt;/span> &lt;span style="color:#f1fa8c">99&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">add_library&lt;/span>(&lt;span style="color:#f1fa8c">shared&lt;/span> &lt;span style="color:#f1fa8c">SHARED&lt;/span> &lt;span style="color:#f1fa8c">library.h&lt;/span> &lt;span style="color:#f1fa8c">library.c&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">set&lt;/span>(&lt;span style="color:#f1fa8c">LIBRARY_OUTPUT_PATH&lt;/span> &lt;span style="color:#ff79c6">${&lt;/span>&lt;span style="color:#8be9fd;font-style:italic">PROJECT_SOURCE_DIR&lt;/span>&lt;span style="color:#ff79c6">}&lt;/span>&lt;span style="color:#f1fa8c">/lib&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">add_executable&lt;/span>(&lt;span style="color:#f1fa8c">project1&lt;/span> &lt;span style="color:#f1fa8c">main.c&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">target_link_libraries&lt;/span>(&lt;span style="color:#f1fa8c">project1&lt;/span> &lt;span style="color:#f1fa8c">shared&lt;/span>)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æˆ‘å®éªŒäº†ä¸¤ç§åŠæ³•ï¼Œä¸€æ˜¯æŠŠ.so æ–‡ä»¶æ”¾åˆ°&lt;code>/lib&lt;/code> æˆ–è€… &lt;code>/usr/lib&lt;/code>ä¸­ï¼Œè¿™ä¹Ÿæ˜¯åœ¨å®‰è£…å¾ˆå¤šè½¯ä»¶æ—¶çš„åšæ³•ï¼Œå½“ä½¿ç”¨åŒ…ç®¡ç†å™¨å®‰è£…è½¯ä»¶æ—¶ï¼Œéœ€è¦çš„.soæ–‡ä»¶å¤§å¤šæ˜¯å®‰è£…åˆ°è¿™ä¸¤ä¸ªç›®å½•ä¸‹ã€‚åœ¨ä¸€ç§å°±æ˜¯åœ¨ç¼–è¯‘æ—¶æŒ‡å®š &lt;code>rpath&lt;/code>çš„ç›®å½•ï¼Œä½¿ç”¨ç›¸å¯¹ç›®å½•ï¼Œè¿™æ ·åœ¨å¤åˆ¶æ–‡ä»¶çš„æ—¶å€™ï¼ŒæŠŠ.soä¸€èµ·å¤åˆ¶å°±å¯ä»¥äº†ã€‚&lt;/p>
&lt;h3 id="å…ˆç”¨æœ€ç®€å•çš„åŠæ³•æŠŠsoç›®å½•æ”¾åˆ°ç³»ç»Ÿç›®å½•ä¸‹">&lt;a href="#%e5%85%88%e7%94%a8%e6%9c%80%e7%ae%80%e5%8d%95%e7%9a%84%e5%8a%9e%e6%b3%95%e6%8a%8aso%e7%9b%ae%e5%bd%95%e6%94%be%e5%88%b0%e7%b3%bb%e7%bb%9f%e7%9b%ae%e5%bd%95%e4%b8%8b" class="header-anchor">&lt;/a>å…ˆç”¨æœ€ç®€å•çš„åŠæ³•ï¼ŒæŠŠsoç›®å½•æ”¾åˆ°ç³»ç»Ÿç›®å½•ä¸‹
&lt;/h3>&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-243a1ebb13296817.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-243a1ebb13296817.webp" alt="" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>ç°åœ¨çš„ç›®å½•ç»“æ„å¦‚ä¸‹ï¼Œç¨‹åºä¾èµ–çš„&lt;strong>libshared.so&lt;/strong> åœ¨ &lt;strong>lib&lt;/strong> ç›®å½•ä¸‹ï¼Œç°åœ¨æŠŠ &lt;strong>libshared.so&lt;/strong> å¤åˆ¶åˆ° &lt;strong>/lib&lt;/strong> ç›®å½•ä¸‹ã€‚è¿™é‡Œæœ‰ä¸ªè¦æ³¨æ„çš„åœ°æ–¹ï¼Œå¤åˆ¶å®Œåè¦æ‰§è¡Œ &lt;code>ldconfig&lt;/code> å‘½ä»¤ï¼Œé‡æ–°ç”Ÿæˆç¼“å­˜ï¼Œè¦ä¸ç„¶ç¨‹åºä¾ç„¶æ‰¾ä¸åˆ°å¯¹åº”çš„.soæ–‡ä»¶
å‘½ä»¤å¦‚ä¸‹&lt;/p>
&lt;ol>
&lt;li>&lt;code>sudo mv lib/libshared.so /lib&lt;/code>&lt;/li>
&lt;li>&lt;code>sudo ldconfig &lt;/code>&lt;/li>
&lt;/ol>
&lt;p>è¿™æ—¶å€™åœ¨è¿è¡Œ &lt;strong>project1&lt;/strong> ä¸ä¼šæŠ¥é”™&lt;/p>
&lt;h3 id="ç¼–è¯‘æ—¶æŒ‡å®š-rpathç›®å½•">&lt;a href="#%e7%bc%96%e8%af%91%e6%97%b6%e6%8c%87%e5%ae%9a-rpath%e7%9b%ae%e5%bd%95" class="header-anchor">&lt;/a>ç¼–è¯‘æ—¶æŒ‡å®š rpathç›®å½•
&lt;/h3>&lt;p>è®¾ç½® &lt;strong>rpaht&lt;/strong> æœ‰ä¸¤ç§æ–¹å¼&lt;/p>
&lt;p>æ–¹å¼1&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cmake" data-lang="cmake">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">set&lt;/span>(&lt;span style="color:#f1fa8c">CMAKE_SKIP_BUILD_RPATH&lt;/span> &lt;span style="color:#f1fa8c">FALSE&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">set&lt;/span>(&lt;span style="color:#f1fa8c">CMAKE_BUILD_WITH_INSTALL_RPATH&lt;/span> &lt;span style="color:#f1fa8c">TRUE&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">set&lt;/span>(&lt;span style="color:#f1fa8c">CMAKE_INSTALL_RPATH&lt;/span> $&lt;span style="color:#f1fa8c">ORIGIN&lt;/span>)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>é€šè¿‡ä¿®æ”¹ç¼–è¯‘åçš„ install è·¯å¾„, è®©ç¨‹åºåœ¨è¿è¡Œæ—¶é€šè¿‡ç¨‹åºçš„ç›¸å¯¹ç›®å½•åŠ è½½.soæ–‡ä»¶ï¼Œå…¶ä¸­ &lt;strong>$ORIGIN&lt;/strong> å˜é‡æ˜¯ç¨‹åºçš„å½“å‰ç›®å½•&lt;/p>
&lt;p>æ–¹å¼2&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cmake" data-lang="cmake">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">set_target_properties&lt;/span>(&lt;span style="color:#f1fa8c">project1&lt;/span> &lt;span style="color:#f1fa8c">PROPERTIES&lt;/span> &lt;span style="color:#f1fa8c">LINK_FLAGS&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;-Wl,-rpath,./&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æ–¹å¼2æ›´ç²—æš´ï¼Œç›´æ¥è®¾ç½®gccçš„ç¼–è¯‘å‚æ•°ï¼ŒæŒ‡å®š&lt;strong>rpaht&lt;/strong> æ˜¯å½“å‰ç›®å½•&lt;/p>
&lt;p>ä¿®æ”¹ &lt;strong>CMakeLists.txt&lt;/strong>æ–‡ä»¶&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cmake" data-lang="cmake">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">cmake_minimum_required&lt;/span>(&lt;span style="color:#f1fa8c">VERSION&lt;/span> &lt;span style="color:#f1fa8c">3.13.3&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">project&lt;/span>(&lt;span style="color:#f1fa8c">project1&lt;/span> &lt;span style="color:#f1fa8c">C&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">set&lt;/span>(&lt;span style="color:#f1fa8c">CMAKE_C_STANDARD&lt;/span> &lt;span style="color:#f1fa8c">99&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">add_library&lt;/span>(&lt;span style="color:#f1fa8c">shared&lt;/span> &lt;span style="color:#f1fa8c">SHARED&lt;/span> &lt;span style="color:#f1fa8c">library.h&lt;/span> &lt;span style="color:#f1fa8c">library.c&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">set&lt;/span>(&lt;span style="color:#f1fa8c">LIBRARY_OUTPUT_PATH&lt;/span> &lt;span style="color:#ff79c6">${&lt;/span>&lt;span style="color:#8be9fd;font-style:italic">PROJECT_SOURCE_DIR&lt;/span>&lt;span style="color:#ff79c6">}&lt;/span>&lt;span style="color:#f1fa8c">/lib&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span>&lt;span style="color:#6272a4">#æ–¹å¼1
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span>&lt;span style="color:#8be9fd;font-style:italic">set&lt;/span>(&lt;span style="color:#f1fa8c">CMAKE_SKIP_BUILD_RPATH&lt;/span> &lt;span style="color:#f1fa8c">FALSE&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">set&lt;/span>(&lt;span style="color:#f1fa8c">CMAKE_BUILD_WITH_INSTALL_RPATH&lt;/span> &lt;span style="color:#f1fa8c">TRUE&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">set&lt;/span>(&lt;span style="color:#f1fa8c">CMAKE_INSTALL_RPATH&lt;/span> $&lt;span style="color:#f1fa8c">ORIGIN&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">add_executable&lt;/span>(&lt;span style="color:#f1fa8c">project1&lt;/span> &lt;span style="color:#f1fa8c">main.c&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17&lt;/span>&lt;span>&lt;span style="color:#6272a4">#æ–¹å¼2
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18&lt;/span>&lt;span>&lt;span style="color:#6272a4">#set_target_properties(project1 PROPERTIES LINK_FLAGS &amp;#34;-Wl,-rpath,./&amp;#34;)
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span>&lt;span style="color:#8be9fd;font-style:italic">target_link_libraries&lt;/span>(&lt;span style="color:#f1fa8c">project1&lt;/span> &lt;span style="color:#f1fa8c">shared&lt;/span>)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>é‡æ–°ç”Ÿæˆ &lt;strong>MakeFile&lt;/strong> æ–‡ä»¶, ç„¶åç¼–è¯‘&lt;/p>
&lt;p>ç¼–è¯‘ç”Ÿæˆçš„ &lt;strong>libshared.so&lt;/strong> è¿˜æ˜¯åœ¨ &lt;strong>lib&lt;/strong>ç›®å½•ä¸‹ï¼Œå…ˆç§»åŠ¨åˆ°å¯æ‰§è¡Œæ–‡ä»¶çš„åŒçº§ç›®å½•ä¸‹
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-74af9cfab32e95a7.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-74af9cfab32e95a7.webp" alt="" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>æœ€ç»ˆç›®å½•å¦‚å›¾ï¼Œç°åœ¨æ— è®ºæ€ä¹ˆå¤åˆ¶æ–‡ä»¶ï¼Œåªè¦å¯æ‰§è¡Œæ–‡ä»¶å’ŒåŠ¨æ€åº“åœ¨ä¸€ä¸ªç›®å½•ä¸‹ï¼Œéƒ½ä»¥è¿è¡Œäº†&lt;/p>
&lt;h2 id="æ€»ç»“">&lt;a href="#%e6%80%bb%e7%bb%93" class="header-anchor">&lt;/a>æ€»ç»“
&lt;/h2>&lt;p>è§£å†³linuxä¸‹ åŠ¨æ€ç¼–è¯‘çš„ç¨‹åºæ‰¾ä¸åˆ°åŠ¨æ€åº“çš„é—®é¢˜ï¼Œæœ‰å¤šç§è§£å†³åŠæ³•ï¼Œè¿™æ¬¡ç”¨äº†ä¸¤ç§&lt;/p>
&lt;ol>
&lt;li>æŠŠéœ€è¦çš„.soæ–‡ä»¶æ”¾åˆ° &lt;strong>/lib&lt;/strong> æˆ–è€… &lt;strong>/usr/lib&lt;/strong> ä¸‹ï¼Œ ç„¶åæ‰§è¡Œ &lt;code> ldconfig&lt;/code>å‘½ä»¤&lt;/li>
&lt;li>é€šè¿‡æŒ‡å®š &lt;strong>rpath&lt;/strong> æ¥å†³å®šåŠ è½½ .soçš„ç›®å½•&lt;/li>
&lt;/ol></description></item><item><title>ä½¿ç”¨cmakeæ„å»ºC/C++é¡¹ç›®å’ŒåŠ¨æ€åº“</title><link>https://lqxhub.github.io/posts/a20c5e48/</link><pubDate>Sat, 13 Mar 2021 17:45:45 +0000</pubDate><guid>https://lqxhub.github.io/posts/a20c5e48/</guid><description>&lt;p>ç¼–è¯‘C/C++æ–‡ä»¶æ—¶ï¼Œå¾ˆå¤šæ—¶å€™éƒ½æ˜¯ç›´æ¥ä½¿ç”¨åƒ &lt;code>gcc main.c&lt;/code> æˆ–è€… &lt;code>g++ main.cpp&lt;/code> è¿™æ ·çš„å‘½ä»¤ç¼–è¯‘çš„ã€‚ä½†æ˜¯ä»£ç æ–‡ä»¶å¤šäº†åï¼Œè¿™æ ·ç¼–è¯‘å°±å¾ˆå›°éš¾äº†ã€‚è¿™æ—¶å€™ å°±å‡ºç°äº†&lt;code>MakeFile&lt;/code> è¿™ä¸ªå·¥å…·ã€‚&lt;/p>
&lt;p>MakeFile è§£å†³äº†å¤šä¸ªæ–‡ä»¶ç¼–è¯‘éš¾çš„é—®é¢˜ï¼Œæœ‰äº†MakeFileï¼Œåªéœ€è¦åœ¨MakeFileçš„ç›®å½•ä¸­ è¿è¡Œä¸€ä¸‹&lt;code>make&lt;/code> å‘½ä»¤ï¼Œ ç¼–è¯‘å°±ä¼šè‡ªåŠ¨å®Œæˆã€‚ä½†æ˜¯ç¼–å†™MakeFileåˆå¾ˆå•°å—¦ï¼Œäºæ˜¯èªæ˜çš„ç¨‹åºå‘˜ä»¬æœ‰å¼€å‘äº†ä¸€ä¸ªå·¥å…·ï¼Œè‡ªåŠ¨ç”ŸæˆMakeFile æ–‡ä»¶ï¼Œ&lt;code>cmake&lt;/code> çš„ä½œç”¨å°±æ˜¯è‡ªåŠ¨ç”ŸæˆMakeFileã€‚æ¯•ç«Ÿå†™cmakeè¦æ¯”å†™MakeFileè¦ç®€å•å¾ˆå¤š&lt;/p>
&lt;p>ä¹Ÿè®¸ä½ ä¼šè¯´ï¼Œç°åœ¨éƒ½æ˜¯ç”¨IDEå†™ä»£ç ï¼ŒIDEéƒ½ä¼šè‡ªåŠ¨è‡ªåŠ¨ç¼–è¯‘å’Œè¿è¡Œï¼Œæˆ‘è¿˜å­¦è¿™äº›å¹²å•¥ã€‚ä½†æ˜¯æœ‰æ—¶å€™éœ€è¦æœåŠ¡å™¨ä¸Šç¼–è¯‘é¡¹ç›®ï¼Œæˆ–è€…åœ¨æ²¡æœ‰IDEçš„æœºå™¨ä¸Šç¼–è¯‘é¡¹ç›®ï¼Œè¿™æ—¶å€™MakeFileå°±å¾ˆæœ‰ç”¨äº†ã€‚å…¶å®å¾ˆå¤šIDEä¹Ÿæ˜¯ä½¿ç”¨cmakeå®Œæˆç¼–è¯‘çš„ï¼Œæ¯”å¦‚ &lt;strong>clion&lt;/strong>&lt;/p>
&lt;h2 id="cmake-å®‰è£…">&lt;a href="#cmake-%e5%ae%89%e8%a3%85" class="header-anchor">&lt;/a>cmake å®‰è£…
&lt;/h2>&lt;p>åœ¨linuxä¸Šå¯ä»¥ä½¿ç”¨æºç å®‰è£…å’ŒåŒ…ç®¡ç†å®‰è£…ï¼Œä¸€èˆ¬ç›´æ¥ç”¨åŒ…ç®¡ç†å®‰è£…å°±å¥½äº†
Ubuntuå’ŒDebian
&lt;code>sudo apt-get install cmake&lt;/code>&lt;/p>
&lt;p>CentOS
&lt;code>sudo yum install cmake&lt;/code>&lt;/p>
&lt;p>å› ä¸ºcmakeåªæ˜¯ç”ŸæˆMakeFileï¼Œæœ€ç»ˆç»„ç»‡ç¼–è¯‘çš„è¿˜æ˜¯MakeFileï¼Œæ‰€ä»¥è¿˜æœ‰å®‰è£…&lt;code>make&lt;/code>&lt;/p>
&lt;p>make ä¸€èˆ¬éƒ½ä¼šé¢„è£…ï¼Œä¸ºäº†ä¿é™©ï¼Œè¿˜æ˜¯è£…ä¸€ä¸‹&lt;/p>
&lt;p>Ubuntuå’ŒDebian
&lt;code>sudo apt-get install make&lt;/code>&lt;/p>
&lt;p>CentOS
&lt;code>sudo yum install make&lt;/code>&lt;/p>
&lt;h2 id="cmakeåŸºæœ¬è§„åˆ™">&lt;a href="#cmake%e5%9f%ba%e6%9c%ac%e8%a7%84%e5%88%99" class="header-anchor">&lt;/a>cmakeåŸºæœ¬è§„åˆ™
&lt;/h2>&lt;p>cmake ä¹Ÿæ²¡å•¥ç¥ç§˜çš„ï¼Œæœ¬è´¨ä¸Šä¹Ÿæ˜¯æ ¹æ®ä¸€å®šçš„è§„åˆ™è‡ªåŠ¨ç”ŸæˆMakeFileçš„ï¼Œä¹Ÿæ˜¯æœ‰è¯­æ³•çš„&lt;/p>
&lt;p>&lt;code>#&lt;/code> æ˜¯æ³¨é‡Šç¬¦å·&lt;/p>
&lt;h3 id="é¢„å®šä¹‰å˜é‡">&lt;a href="#%e9%a2%84%e5%ae%9a%e4%b9%89%e5%8f%98%e9%87%8f" class="header-anchor">&lt;/a>é¢„å®šä¹‰å˜é‡
&lt;/h3>&lt;p>&lt;code>PROJECT_NAME&lt;/code>é¡¹ç›®åç§°
&lt;code>PROJECT_SOURCE_DIR&lt;/code>å·¥ç¨‹çš„æ ¹ç›®å½•
&lt;code>PROJECT_BINARY_DIR&lt;/code> æ‰§è¡Œcmakeå‘½ä»¤çš„ç›®å½•
&lt;code>PROJECT_BINARY_DIR&lt;/code> æ‰§è¡Œcmakeå‘½ä»¤çš„ç›®å½•
&lt;code>CMAKE_CURRENT_SOURCE_DIR &lt;/code>å½“å‰CMakeLists.txtæ–‡ä»¶æ‰€åœ¨ç›®å½•
&lt;code>CMAKE_C_FLAGS&lt;/code>è®¾ç½®Cç¼–è¯‘é€‰é¡¹
&lt;code>CMAKE_CXX_FLAGS&lt;/code>è®¾ç½®C++ç¼–è¯‘é€‰é¡¹
&lt;code>CMAKE_C_COMPILER&lt;/code>è®¾ç½®Cç¼–è¯‘å™¨
&lt;code>CMAKE_CXX_COMPILER&lt;/code>è®¾ç½®C++ç¼–è¯‘å™¨
&lt;code>EXECUTABLE_OUTPUT_PATH&lt;/code>è®¾ç½®ç¼–è¯‘åå¯æ‰§è¡Œæ–‡ä»¶ç›®å½•
&lt;code>LIBRARY_OUTPUT_PATH&lt;/code>è®¾ç½®ç”Ÿæˆçš„åº“æ–‡ä»¶ç›®å½•&lt;/p>
&lt;h3 id="å¸¸ç”¨è§„åˆ™">&lt;a href="#%e5%b8%b8%e7%94%a8%e8%a7%84%e5%88%99" class="header-anchor">&lt;/a>å¸¸ç”¨è§„åˆ™
&lt;/h3>&lt;p>&lt;code>cmake_minimum_required(VERSION 3.16)&lt;/code> æŒ‡ä»¤cmake ç‰ˆæœ¬
&lt;code>project(hello_world)&lt;/code> è®¾ç½®å·¥ç¨‹å
&lt;code>include_directories(${PROJECT_SOURCE_DIR}/include)&lt;/code> æ·»åŠ å¤´æ–‡ä»¶è·¯å¾„
&lt;code>link_directories(${PROJECT_SOURCE_DIR}/lib)&lt;/code> æ·»åŠ é“¾æ¥åº“çš„è·¯å¾„
&lt;code>add_subdirectory(module)&lt;/code>æ·»åŠ  module å­ç›®å½•, æ­¤ç›®å½•ä¸‹ä¹Ÿè¦æœ‰CMakeLists.txtæ–‡ä»¶
&lt;code>add_executable(project1 main.c)&lt;/code>æŒ‡å®šç¼–è¯‘çš„å¯æ‰§è¡Œæ–‡ä»¶
&lt;code>add_library(lib1 SHARED library.c library.h)&lt;/code>æŒ‡å®šç”Ÿæˆçš„åº“æ–‡ä»¶ï¼Œ&lt;strong>SHARED&lt;/strong>æ˜¯ç”ŸæˆåŠ¨æ€åº“ï¼Œ&lt;strong>STATIC&lt;/strong>åç”Ÿæˆé™æ€åº“
&lt;code>add_compile_options()&lt;/code> æ·»åŠ ç¼–è¯‘é€‰é¡¹
&lt;code>target_link_libraries()&lt;/code>æŒ‡å®šåŠ¨æ€é“¾æ¥åº“
&lt;code>install()&lt;/code>æŒ‡å®šmake installçš„ç›®å½•&lt;/p>
&lt;p>&lt;code>set(XXXX YYYYYY)&lt;/code>ç”¨äºè®¾ç½®å’Œä¿®æ”¹å˜é‡
&lt;code>${XXXX}&lt;/code> ä½¿ç”¨å˜é‡&lt;/p>
&lt;h2 id="æ„å»ºä¸€ä¸ªç®€å•çš„é¡¹ç›®">&lt;a href="#%e6%9e%84%e5%bb%ba%e4%b8%80%e4%b8%aa%e7%ae%80%e5%8d%95%e7%9a%84%e9%a1%b9%e7%9b%ae" class="header-anchor">&lt;/a>æ„å»ºä¸€ä¸ªç®€å•çš„é¡¹ç›®
&lt;/h2>&lt;p>åªæœ‰ä¸€ä¸ª &lt;code>main.c&lt;/code> æ–‡ä»¶&lt;/p>
&lt;p>CMakeList.txt&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cmake" data-lang="cmake">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">cmake_minimum_required&lt;/span>(&lt;span style="color:#f1fa8c">VERSION&lt;/span> &lt;span style="color:#f1fa8c">3.15&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">project&lt;/span>(&lt;span style="color:#f1fa8c">project1&lt;/span> &lt;span style="color:#f1fa8c">C&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">set&lt;/span>(&lt;span style="color:#f1fa8c">CMAKE_C_STANDARD&lt;/span> &lt;span style="color:#f1fa8c">99&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">add_executable&lt;/span>(&lt;span style="color:#f1fa8c">project1&lt;/span> &lt;span style="color:#f1fa8c">main.c&lt;/span>)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>main.c&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-C" data-lang="C">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">#include&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;stdio.h&amp;gt;&lt;/span>&lt;span style="color:#ff79c6">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span>&lt;span style="color:#ff79c6">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3&lt;/span>&lt;span>&lt;span style="color:#8be9fd">int&lt;/span> &lt;span style="color:#50fa7b">main&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4&lt;/span>&lt;span> &lt;span style="color:#50fa7b">printf&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;Hello, CMakeList!&lt;/span>&lt;span style="color:#f1fa8c">\n&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="ç¼–è¯‘ä¸€ä¸ªdebugç‰ˆæœ¬">&lt;a href="#%e7%bc%96%e8%af%91%e4%b8%80%e4%b8%aadebug%e7%89%88%e6%9c%ac" class="header-anchor">&lt;/a>ç¼–è¯‘ä¸€ä¸ªdebugç‰ˆæœ¬
&lt;/h3>&lt;ol>
&lt;li>&lt;code>mkdir debug&lt;/code> æ–°å»ºdebugç›®å½•&lt;/li>
&lt;li>&lt;code>cd debug&lt;/code> è¿›å…¥debugç›®å½•&lt;/li>
&lt;li>&lt;code>cmake -DCMAKE_BUILD_TYPR=debug ..&lt;/code> æŒ‡å®šç¼–è¯‘æ¨¡å¼ä¸ºdebug&lt;/li>
&lt;li>&lt;code>make&lt;/code> ç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶&lt;/li>
&lt;/ol>
&lt;p>æ­¤æ—¶ä¼šç”Ÿæˆ&lt;code>project1&lt;/code>æ–‡ä»¶&lt;/p>
&lt;p>æ­¥éª¤ 3 ä¸­ &lt;code>cmake -DCMAKE_BUILD_TYPE=release ..&lt;/code> æŒ‡å®šç¼–è¯‘æ¨¡å¼ä¸ºrelease&lt;/p>
&lt;h2 id="æ„å»ºä¸€ä¸ªç”ŸæˆåŠ¨æ€åº“çš„é¡¹ç›®">&lt;a href="#%e6%9e%84%e5%bb%ba%e4%b8%80%e4%b8%aa%e7%94%9f%e6%88%90%e5%8a%a8%e6%80%81%e5%ba%93%e7%9a%84%e9%a1%b9%e7%9b%ae" class="header-anchor">&lt;/a>æ„å»ºä¸€ä¸ªç”ŸæˆåŠ¨æ€åº“çš„é¡¹ç›®
&lt;/h2>&lt;p>æœ‰ä¸¤ä¸ªæ–‡ä»¶&lt;code>library.h&lt;/code>å’Œ&lt;code>library.c&lt;/code>
CMakeList.txt&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cmake" data-lang="cmake">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">cmake_minimum_required&lt;/span>(&lt;span style="color:#f1fa8c">VERSION&lt;/span> &lt;span style="color:#f1fa8c">3.15&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">project&lt;/span>(&lt;span style="color:#f1fa8c">shared&lt;/span> &lt;span style="color:#f1fa8c">C&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">set&lt;/span>(&lt;span style="color:#f1fa8c">CMAKE_C_STANDARD&lt;/span> &lt;span style="color:#f1fa8c">99&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">add_library&lt;/span>(&lt;span style="color:#f1fa8c">shared&lt;/span> &lt;span style="color:#f1fa8c">SHARED&lt;/span> &lt;span style="color:#f1fa8c">library.c&lt;/span> &lt;span style="color:#f1fa8c">library.h&lt;/span>)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>library.h&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>&lt;span style="color:#8be9fd">int&lt;/span> &lt;span style="color:#50fa7b">add&lt;/span>(&lt;span style="color:#8be9fd">int&lt;/span> a, &lt;span style="color:#8be9fd">int&lt;/span> b);
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>library.c&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>&lt;span style="color:#8be9fd">int&lt;/span> &lt;span style="color:#50fa7b">add&lt;/span>(&lt;span style="color:#8be9fd">int&lt;/span> a, &lt;span style="color:#8be9fd">int&lt;/span> b) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> a &lt;span style="color:#ff79c6">+&lt;/span> b;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="ç”ŸæˆåŠ¨æ€åº“">&lt;a href="#%e7%94%9f%e6%88%90%e5%8a%a8%e6%80%81%e5%ba%93" class="header-anchor">&lt;/a>ç”ŸæˆåŠ¨æ€åº“
&lt;/h3>&lt;ol>
&lt;li>&lt;code>mkdir lib&lt;/code> æ–°å»ºlibç›®å½•&lt;/li>
&lt;li>&lt;code>cd lib&lt;/code> è¿›å…¥libç›®å½•&lt;/li>
&lt;li>&lt;code>cmake -DCMAKE_BUILD_TYPE=debug ..&lt;/code> æŒ‡å®šç¼–è¯‘æ¨¡å¼ä¸ºdebug&lt;/li>
&lt;li>&lt;code>make&lt;/code> ç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶
æ­¤æ—¶ä¼šç”Ÿæˆ &lt;code>libshared.so&lt;/code>æ–‡ä»¶&lt;/li>
&lt;/ol>
&lt;h2 id="åœ¨ç¬¬ä¸€ä¸ªé¡¹ç›®ä¸­ä½¿ç”¨åŠ¨æ€åº“">&lt;a href="#%e5%9c%a8%e7%ac%ac%e4%b8%80%e4%b8%aa%e9%a1%b9%e7%9b%ae%e4%b8%ad%e4%bd%bf%e7%94%a8%e5%8a%a8%e6%80%81%e5%ba%93" class="header-anchor">&lt;/a>åœ¨ç¬¬ä¸€ä¸ªé¡¹ç›®ä¸­ä½¿ç”¨åŠ¨æ€åº“
&lt;/h2>&lt;p>é¦–å…ˆæŠŠ &lt;code>libshared.so&lt;/code>æ–‡ä»¶å’Œ&lt;code>library.h&lt;/code>æ–‡ä»¶å¤åˆ¶åˆ°ç¬¬ä¸€ä¸ªé¡¹ç›®ä¸­&lt;/p>
&lt;p>ä¿®æ”¹ CMakeList.txt&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cmake" data-lang="cmake">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">cmake_minimum_required&lt;/span>(&lt;span style="color:#f1fa8c">VERSION&lt;/span> &lt;span style="color:#f1fa8c">3.15&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">project&lt;/span>(&lt;span style="color:#f1fa8c">project1&lt;/span> &lt;span style="color:#f1fa8c">C&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">set&lt;/span>(&lt;span style="color:#f1fa8c">CMAKE_C_STANDARD&lt;/span> &lt;span style="color:#f1fa8c">99&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">add_executable&lt;/span>(&lt;span style="color:#f1fa8c">project1&lt;/span> &lt;span style="color:#f1fa8c">main.c&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">target_link_libraries&lt;/span>(&lt;span style="color:#f1fa8c">project1&lt;/span> &lt;span style="color:#ff79c6">${&lt;/span>&lt;span style="color:#8be9fd;font-style:italic">PROJECT_SOURCE_DIR&lt;/span>&lt;span style="color:#ff79c6">}&lt;/span>&lt;span style="color:#f1fa8c">/libshared.so&lt;/span>)&lt;span style="color:#6272a4">#æŒ‡å®šåŠ¨æ€åº“æ–‡ä»¶
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ol>
&lt;li>&lt;code>mkdir debug&lt;/code> æ–°å»ºdebugç›®å½•&lt;/li>
&lt;li>&lt;code>cd debug&lt;/code> è¿›å…¥debugç›®å½•&lt;/li>
&lt;li>&lt;code>cmake -DCMAKE_BUILD_TYPE=debug ..&lt;/code> æŒ‡å®šç¼–è¯‘æ¨¡å¼ä¸ºdebug&lt;/li>
&lt;li>&lt;code>make&lt;/code> ç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶&lt;/li>
&lt;/ol>
&lt;p>æœ€ç»ˆç›®å½•å¦‚å›¾
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-74e036182d3b091d.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-74e036182d3b091d.webp" alt="" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;h2 id="æŠŠä¸¤ä¸ªé¡¹ç›®åˆæˆä¸€ä¸ª">&lt;a href="#%e6%8a%8a%e4%b8%a4%e4%b8%aa%e9%a1%b9%e7%9b%ae%e5%90%88%e6%88%90%e4%b8%80%e4%b8%aa" class="header-anchor">&lt;/a>æŠŠä¸¤ä¸ªé¡¹ç›®åˆæˆä¸€ä¸ª
&lt;/h2>&lt;p>èƒ½ä¸èƒ½åœ¨ä¸€ä¸ªé¡¹ç›®ä¸­ç”ŸæˆåŠ¨æ€åº“å¹¶åœ¨è¿™ä¸ªé¡¹ç›®ä¸­ä½¿ç”¨å‘¢ï¼Œå½“ç„¶æ˜¯å¯ä»¥çš„ã€‚&lt;/p>
&lt;p>ä¹Ÿå°±æ˜¯åœ¨è¿™ä¸ªé¡¹ç›®ä¸­éƒ¨åˆ†æ–‡ä»¶ç¼–è¯‘æˆåŠ¨æ€åº“ .so æ–‡ä»¶ï¼Œ éƒ¨åˆ†æ–‡ä»¶ç¼–è¯‘æˆ å¯æ‰§è¡Œæ–‡ä»¶&lt;/p>
&lt;p>ä¿®æ”¹ CMakeList.txt&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cmake" data-lang="cmake">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">cmake_minimum_required&lt;/span>(&lt;span style="color:#f1fa8c">VERSION&lt;/span> &lt;span style="color:#f1fa8c">3.13.3&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">project&lt;/span>(&lt;span style="color:#f1fa8c">project1&lt;/span> &lt;span style="color:#f1fa8c">C&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">set&lt;/span>(&lt;span style="color:#f1fa8c">CMAKE_C_STANDARD&lt;/span> &lt;span style="color:#f1fa8c">99&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">add_library&lt;/span>(&lt;span style="color:#f1fa8c">shared&lt;/span> &lt;span style="color:#f1fa8c">SHARED&lt;/span> &lt;span style="color:#f1fa8c">library.h&lt;/span> &lt;span style="color:#f1fa8c">library.c&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">set&lt;/span>(&lt;span style="color:#f1fa8c">LIBRARY_OUTPUT_PATH&lt;/span> &lt;span style="color:#ff79c6">${&lt;/span>&lt;span style="color:#8be9fd;font-style:italic">PROJECT_SOURCE_DIR&lt;/span>&lt;span style="color:#ff79c6">}&lt;/span>&lt;span style="color:#f1fa8c">/lib&lt;/span>)&lt;span style="color:#6272a4">#è®¾ç½®åŠ¨æ€åº“è¾“å‡ºç›®å½•
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">add_executable&lt;/span>(&lt;span style="color:#f1fa8c">project1&lt;/span> &lt;span style="color:#f1fa8c">main.c&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">target_link_libraries&lt;/span>(&lt;span style="color:#f1fa8c">project1&lt;/span> &lt;span style="color:#f1fa8c">shared&lt;/span>)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ol>
&lt;li>&lt;code>mkdir debug&lt;/code> æ–°å»ºdebugç›®å½•&lt;/li>
&lt;li>&lt;code>cd debug&lt;/code> è¿›å…¥debugç›®å½•&lt;/li>
&lt;li>&lt;code>cmake -DCMAKE_BUILD_TYPE=debug ..&lt;/code> æŒ‡å®šç¼–è¯‘æ¨¡å¼ä¸ºdebug&lt;/li>
&lt;li>&lt;code>make&lt;/code> ç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶&lt;/li>
&lt;/ol>
&lt;p>æœ€ç»ˆç›®å½•å¦‚å›¾&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-ef708a45de2bc055.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-ef708a45de2bc055.webp" alt="" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;h2 id="æœ€å">&lt;a href="#%e6%9c%80%e5%90%8e" class="header-anchor">&lt;/a>æœ€å
&lt;/h2>&lt;p>é€šè¿‡å‡ ä¸ªç®€å•çš„ä¾‹å­ï¼Œä»‹ç»äº†ä¸€ä¸‹cmakeçš„åŸºæœ¬ä½¿ç”¨ï¼Œæ–‡ä¸­æ˜¯ä½¿ç”¨cmakeæ„å»ºçš„Cé¡¹ç›®ï¼Œæ¢æˆC++åŸºæœ¬æ²¡ä»€ä¹ˆåŒºåˆ«ï¼Œå°±ä¸å±•ç¤ºäº†&lt;/p>
&lt;p>cmakeçš„åŠŸèƒ½è¿œä¸æ­¢è¿™äº›ï¼Œè¿˜éœ€è¦åœ¨å®æˆ˜ä¸­å¤šå­¦ä¹ ï¼Œå¤šæ€»ç»“&lt;/p>
&lt;p>&lt;strong>2021-03-06 è¡¥å……&lt;/strong>
é€šè¿‡ä¸Šé¢çš„æ–¹å¼å¯ä»¥ç¼–è¯‘è¿è¡Œï¼Œä½†æ˜¯ä¼šæœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯ &lt;strong>.so&lt;/strong> æ–‡ä»¶ä¸èƒ½æ›´æ”¹ç›®å½•ï¼Œä¸€æ—¦åŠ¨æ€åº“ç›®å½•å˜äº†ï¼Œç¨‹åºå°±æ²¡æ³•åŠ è½½ï¼Œç¨‹åºä¹Ÿå°±æ²¡æ³•è¿è¡Œäº†ã€‚ä¸ºæ­¤åˆæ‰¾èµ„æ–™å­¦ä¹ ä¸€ç•ªï¼Œå¦å†™äº†ä¸€ç¯‡ï¼Œ{% post_link linuxä¸‹cmakeåŠ¨æ€ç¼–è¯‘åæ‰¾ä¸åˆ°åŠ¨æ€é“¾æ¥åº“ [ä¼ é€é—¨] %}&lt;/p></description></item><item><title>golangä½¿ç”¨unsafeåŒ…å®ç°æŒ‡é’ˆè¿ç®—æ“ä½œprivate</title><link>https://lqxhub.github.io/posts/560ffd6b/</link><pubDate>Sat, 13 Mar 2021 17:43:57 +0000</pubDate><guid>https://lqxhub.github.io/posts/560ffd6b/</guid><description>&lt;p>golangä¸­æ˜¯æœ‰æŒ‡é’ˆæ¦‚å¿µçš„ï¼Œä½†æ˜¯goä¸­çš„æŒ‡é’ˆåŠŸèƒ½è¢«é™åˆ¶äº†ï¼Œä¸åƒC/C++ä¸­é‚£æ ·,å¯ä»¥å¯¹æŒ‡é’ˆè¿›è¡Œè¿ç®—&lt;/p>
&lt;p>æ¯”å¦‚åœ¨C/C++ä¸­ &lt;code>*p++&lt;/code> è¿™æ ·æ˜¯æ­£ç¡®çš„ã€‚ä½†æ˜¯åœ¨goä¸­ï¼Œè¿™æ ·å†™æ˜¯é”™è¯¯çš„ã€‚è‡³äºgoä¸ºä»€ä¹ˆä¼šå±è”½æŒ‡é’ˆçš„è¿ç®—ï¼Œæ¯”è¾ƒå¤šçš„ä¸€ç§è¯´æ³•æ˜¯goå›¢é˜Ÿè®¤ä¸ºæŒ‡é’ˆçš„è¿ç®—ä¼šå¸¦æ¥ä¸€äº›å®‰å…¨é—®é¢˜ï¼Œå†æœ‰å°±æ˜¯ç®€åŒ–è¯­æ³•ï¼Œæ‰€ä»¥goç›´æ¥å°±ä¸æ”¯æŒæŒ‡é’ˆè¿ç®—äº†ã€‚&lt;/p>
&lt;p>è™½ç„¶goè¯­æ³•ä¸æ”¯æŒï¼Œä½†æ˜¯é€šè¿‡goçš„ &lt;strong>unsafe&lt;/strong> åŒ…å¯ä»¥é—´æ¥çš„å®ç°å¯¹æŒ‡é’ˆçš„è¿ç®—ï¼Œå°±æƒ³è¿™ä¸ªåŒ…çš„åå­—ä¸€æ ·ï¼Œè¿™ä¸ªåŒ…æä¾›çš„ä¸œè¥¿ä¸æ˜¯å®‰å…¨çš„ï¼Œä½¿ç”¨ä¸å½“å¯èƒ½ä¼šå‡ºç°ä¸€äº›é—®é¢˜ï¼Œæ‰€ä»¥åœ¨goæ˜¯ä¸æ¨èä½¿ç”¨çš„ï¼Œè‡ªå·±ç©ç©è¿˜å¯ä»¥ï¼ŒçœŸæ­£çš„é¡¹ç›®ä¸­ï¼Œè¿˜æ˜¯å°½é‡ä¸è¦ä½¿ç”¨ã€‚&lt;/p>
&lt;p>åœ¨ä¸€ä¸ªçŸ¥è¯†ç‚¹ï¼Œgoæ˜¯é€šè¿‡é¦–å­—æ¯çš„å¤§å°å†™åœ¨å´åˆ« &lt;strong>private&lt;/strong> å’Œ &lt;strong>public&lt;/strong> çš„ï¼Œä¸åŒåŒ…ä¸­çš„æ˜¯æ— æ³•è®¿é—®privateå˜é‡çš„ã€‚å…¶å®æ‰€è°“çš„privateå’Œpublicåªæ˜¯è¯­æ³•ä¸Šçš„é™åˆ¶ï¼Œåˆ°äº†æ±‡ç¼–å±‚ï¼Œéƒ½æ˜¯åœ°å€ï¼Œå“ªæ¥çš„å…¬å¼€å’Œç§æœ‰çš„ï¼Œæ‰€ä»¥ï¼Œä½†æ˜¯æˆ‘ä»¬é€šè¿‡ä½¿ç”¨åœ°å€ï¼ˆä¹Ÿå°±æ˜¯æŒ‡é’ˆï¼‰æ¥ç»•è¿‡è¯­æ³•é™åˆ¶ï¼Œè®¿é—®å…¶ä»–åŒ…ä¸­çš„ç§æœ‰å˜é‡ã€‚&lt;/p>
&lt;p>è¯´äº†ä¸€å †åºŸè¯äº†ï¼Œå¼€å§‹ä¸ŠçœŸçš„ï¼Œå…ˆåˆ›å»ºæœ‰ä¸€ä¸ªprojectï¼Œç›®å½•å±‚æ¬¡å¦‚ä¸‹ï¼š&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-799540d369327268.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-799540d369327268.webp" alt="ç›®å½•" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;h2 id="ä¸Šä»£ç ">&lt;a href="#%e4%b8%8a%e4%bb%a3%e7%a0%81" class="header-anchor">&lt;/a>ä¸Šä»£ç 
&lt;/h2>&lt;h3 id="onego">&lt;a href="#onego" class="header-anchor">&lt;/a>one.go
&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">package&lt;/span> one
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">type&lt;/span> One &lt;span style="color:#8be9fd;font-style:italic">struct&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4&lt;/span>&lt;span> A &lt;span style="color:#8be9fd">int&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5&lt;/span>&lt;span> b &lt;span style="color:#8be9fd">int&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6&lt;/span>&lt;span> c &lt;span style="color:#ff79c6">*&lt;/span>Two
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="twogo">&lt;a href="#twogo" class="header-anchor">&lt;/a>two.go
&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">package&lt;/span> one
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">type&lt;/span> Two &lt;span style="color:#8be9fd;font-style:italic">struct&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4&lt;/span>&lt;span> D &lt;span style="color:#8be9fd">int&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="maingo">&lt;a href="#maingo" class="header-anchor">&lt;/a>main.go
&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">package&lt;/span> main
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span>&lt;span style="color:#ff79c6">import&lt;/span> (
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span> &lt;span style="color:#f1fa8c">&amp;#34;fmt&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span> &lt;span style="color:#f1fa8c">&amp;#34;pointer/one&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span> &lt;span style="color:#f1fa8c">&amp;#34;unsafe&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> &lt;span style="color:#50fa7b">main&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span> o &lt;span style="color:#ff79c6">:=&lt;/span> &lt;span style="color:#ff79c6">&amp;amp;&lt;/span>one.One{}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span> p &lt;span style="color:#ff79c6">:=&lt;/span> unsafe.&lt;span style="color:#50fa7b">Pointer&lt;/span>(o)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span> p2 &lt;span style="color:#ff79c6">:=&lt;/span> (&lt;span style="color:#ff79c6">*&lt;/span>&lt;span style="color:#8be9fd">int&lt;/span>)(unsafe.&lt;span style="color:#50fa7b">Pointer&lt;/span>(&lt;span style="color:#8be9fd;font-style:italic">uintptr&lt;/span>(p) &lt;span style="color:#ff79c6">+&lt;/span> unsafe.&lt;span style="color:#50fa7b">Sizeof&lt;/span>(o.A)))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span> &lt;span style="color:#ff79c6">*&lt;/span>p2 = &lt;span style="color:#bd93f9">100&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16&lt;/span>&lt;span> t &lt;span style="color:#ff79c6">:=&lt;/span> &lt;span style="color:#ff79c6">&amp;amp;&lt;/span>one.Two{D: &lt;span style="color:#bd93f9">2000&lt;/span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17&lt;/span>&lt;span> fmt.&lt;span style="color:#50fa7b">Printf&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;%p \n&amp;#34;&lt;/span>, t)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19&lt;/span>&lt;span> p3 &lt;span style="color:#ff79c6">:=&lt;/span> (&lt;span style="color:#ff79c6">*&lt;/span>&lt;span style="color:#8be9fd">int&lt;/span>)(unsafe.&lt;span style="color:#50fa7b">Pointer&lt;/span>(&lt;span style="color:#8be9fd;font-style:italic">uintptr&lt;/span>(p) &lt;span style="color:#ff79c6">+&lt;/span> unsafe.&lt;span style="color:#50fa7b">Sizeof&lt;/span>(o.A)&lt;span style="color:#ff79c6">*&lt;/span>&lt;span style="color:#bd93f9">2&lt;/span>))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21&lt;/span>&lt;span> &lt;span style="color:#ff79c6">*&lt;/span>p3 = (&lt;span style="color:#8be9fd">int&lt;/span>)(&lt;span style="color:#8be9fd;font-style:italic">uintptr&lt;/span>(unsafe.&lt;span style="color:#50fa7b">Pointer&lt;/span>(t)))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23&lt;/span>&lt;span> fmt.&lt;span style="color:#50fa7b">Println&lt;/span>(o)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="è¿è¡Œç»“æœ">&lt;a href="#%e8%bf%90%e8%a1%8c%e7%bb%93%e6%9e%9c" class="header-anchor">&lt;/a>è¿è¡Œç»“æœ
&lt;/h2>&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-7dfb79a2f271b45c.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-7dfb79a2f271b45c.webp" alt="image" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>å¯ä»¥çœ‹åˆ°ï¼Œoneä¸­ç§æœ‰å˜é‡å·²ç»è¢«æˆåŠŸèµ‹å€¼äº†ï¼Œ&lt;/p>
&lt;p>é€šè¿‡æ‰“å°çš„æŒ‡é’ˆå¯ä»¥çœ‹åˆ°ï¼Œ &lt;strong>two&lt;/strong> ç»“æ„ä½“çš„æŒ‡é’ˆå·²ç»èµ‹åˆ° &lt;strong>one&lt;/strong> ç»“æ„çš„ç§æœ‰å˜é‡ &lt;strong>c&lt;/strong> ä¸­äº†&lt;/p>
&lt;p>ä»£ç å…·ä½“æ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼Œç®€å•ä»‹ç»ä¸€ä¸‹&lt;/p>
&lt;h2 id="å…·ä½“è§£é‡Š">&lt;a href="#%e5%85%b7%e4%bd%93%e8%a7%a3%e9%87%8a" class="header-anchor">&lt;/a>å…·ä½“è§£é‡Š
&lt;/h2>&lt;p>&lt;code>p := unsafe.Pointer(o)&lt;/code> æŠŠoneç»“æ„çš„æŒ‡é’ˆè½¬æ¢æˆ &lt;code>unsafe.Pointer&lt;/code> ç±»å‹ã€‚&lt;/p>
&lt;p>è¿™ä¸ªç±»å‹æœ‰ç‚¹åƒ C/C++ ä¸­çš„ &lt;code>void*&lt;/code>&lt;/p>
&lt;p>&lt;code>uintptr(p)&lt;/code> æŠŠæŒ‡é’ˆè½¬æ¢æˆå¯ä»¥è¿ç®—çš„ç±»å‹&lt;/p>
&lt;p>&lt;code>unsafe.Sizeof(o.A)&lt;/code> æ˜¯è·å–Aå˜é‡åœ¨ç»“æ„ä½“ä¸­é•¿åº¦ï¼Œå¯¹åº”çš„bå°±åœ¨ç»“æ„ä½“ä¸­çš„ä½ç½®ï¼Œä¹Ÿå°±æ˜¯æŒ‡é’ˆ&lt;/p>
&lt;p>å› ä¸º oneä¸­çš„bå˜é‡æ˜¯ &lt;code>int&lt;/code> ç±»å‹,æ‰€ä»¥è¦å¼ºè½¬æˆ intç±»å‹çš„æŒ‡é’ˆï¼Œè¿™æ—¶å€™å°±å¯ä»¥ç»™privateå˜é‡bèµ‹å€¼äº†&lt;/p>
&lt;p>åŒæ ·ï¼Œä¹Ÿå¯ä»¥ä¸ºcèµ‹å€¼ï¼Œåªä¸è¿‡cä¸­æ˜¯æŒ‡é’ˆç±»å‹çš„ï¼Œå…¶å®æŒ‡é’ˆç±»å‹å¯ä»¥çœ‹åšæ˜¯intç±»å‹ï¼Œå˜é‡ä¸­ä¿å­˜çš„æ˜¯å†…å­˜åœ°å€ç½¢äº†&lt;/p>
&lt;p>&lt;code>(*int)(unsafe.Pointer(uintptr(p) + unsafe.Sizeof(o.A)*2))&lt;/code> åŒæ ·çš„æ–¹æ³•æ‹¿åˆ°cçš„åœ°å€&lt;/p>
&lt;p>&lt;code>(int)(uintptr(unsafe.Pointer(t)))&lt;/code> åˆ›å»ºçš„twoçš„æŒ‡é’ˆåœ°å€è½¬æ¢æˆ int ç±»å‹&lt;/p>
&lt;p>å¥½äº†,åˆ°ç°åœ¨æ•´ä¸ªæŒ‡é’ˆçš„è¿ç®—è¿‡ç¨‹å°±ç»“æŸäº†&lt;/p>
&lt;h2 id="æ¢ä¸ªå½¢å¼">&lt;a href="#%e6%8d%a2%e4%b8%aa%e5%bd%a2%e5%bc%8f" class="header-anchor">&lt;/a>æ¢ä¸ªå½¢å¼
&lt;/h2>&lt;p>ä¹‹å‰æˆ‘ä»¬æ˜¯é€šè¿‡ &lt;code>unsafe.Sizeof(o.A)&lt;/code> è·å–æŒ‡é’ˆåç§»é•¿åº¦çš„ï¼Œå…¶å®æˆ‘ä»¬å¯ä»¥æ ¹æ®å˜é‡çš„ç±»å‹è‡ªå·±æ¨ç®—å‡ºæ¥ã€‚&lt;/p>
&lt;p>æˆ‘çš„ç”µè„‘æ˜¯64ä½çš„ï¼Œæ‰€æœ‰int å˜é‡çš„é•¿åº¦ä¹Ÿæ˜¯64ä½ï¼Œä¹Ÿå°±æ˜¯8ä¸ªå­—èŠ‚ï¼Œä¿®æ”¹ä¸€ä¸‹ä»£ç &lt;/p>
&lt;h3 id="ä¿®æ”¹å">&lt;a href="#%e4%bf%ae%e6%94%b9%e5%90%8e" class="header-anchor">&lt;/a>ä¿®æ”¹å
&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">package&lt;/span> main
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span>&lt;span style="color:#ff79c6">import&lt;/span> (
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span> &lt;span style="color:#f1fa8c">&amp;#34;fmt&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span> &lt;span style="color:#f1fa8c">&amp;#34;pointer/one&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span> &lt;span style="color:#f1fa8c">&amp;#34;unsafe&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> &lt;span style="color:#50fa7b">main&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span> o &lt;span style="color:#ff79c6">:=&lt;/span> &lt;span style="color:#ff79c6">&amp;amp;&lt;/span>one.One{}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span> p &lt;span style="color:#ff79c6">:=&lt;/span> unsafe.&lt;span style="color:#50fa7b">Pointer&lt;/span>(o)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span> p2 &lt;span style="color:#ff79c6">:=&lt;/span> (&lt;span style="color:#ff79c6">*&lt;/span>&lt;span style="color:#8be9fd">int&lt;/span>)(unsafe.&lt;span style="color:#50fa7b">Pointer&lt;/span>(&lt;span style="color:#8be9fd;font-style:italic">uintptr&lt;/span>(p) &lt;span style="color:#ff79c6">+&lt;/span> &lt;span style="color:#bd93f9">8&lt;/span>))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span> &lt;span style="color:#ff79c6">*&lt;/span>p2 = &lt;span style="color:#bd93f9">100&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16&lt;/span>&lt;span> t &lt;span style="color:#ff79c6">:=&lt;/span> &lt;span style="color:#ff79c6">&amp;amp;&lt;/span>one.Two{D: &lt;span style="color:#bd93f9">2000&lt;/span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17&lt;/span>&lt;span> fmt.&lt;span style="color:#50fa7b">Printf&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;%p \n&amp;#34;&lt;/span>, t)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19&lt;/span>&lt;span> p3 &lt;span style="color:#ff79c6">:=&lt;/span> (&lt;span style="color:#ff79c6">*&lt;/span>&lt;span style="color:#8be9fd">int&lt;/span>)(unsafe.&lt;span style="color:#50fa7b">Pointer&lt;/span>(&lt;span style="color:#8be9fd;font-style:italic">uintptr&lt;/span>(p) &lt;span style="color:#ff79c6">+&lt;/span> &lt;span style="color:#bd93f9">16&lt;/span>))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21&lt;/span>&lt;span> &lt;span style="color:#ff79c6">*&lt;/span>p3 = (&lt;span style="color:#8be9fd">int&lt;/span>)(&lt;span style="color:#8be9fd;font-style:italic">uintptr&lt;/span>(unsafe.&lt;span style="color:#50fa7b">Pointer&lt;/span>(t)))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23&lt;/span>&lt;span> fmt.&lt;span style="color:#50fa7b">Println&lt;/span>(o)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="è¿è¡Œç»“æœ-1">&lt;a href="#%e8%bf%90%e8%a1%8c%e7%bb%93%e6%9e%9c-1" class="header-anchor">&lt;/a>è¿è¡Œç»“æœ
&lt;/h3>&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-08cbb26651fa8f8f.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-08cbb26651fa8f8f.webp" alt="ç»“æœ" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>å¯ä»¥å‘ç°ç»“æœæ˜¯ä¸€æ ·çš„&lt;/p>
&lt;p>ä½†æ˜¯ç¬¬äºŒç§æ–¹å¼ä¸å¤Ÿé€šç”¨ï¼Œæ¢ä¸ªæœºå™¨å¯èƒ½å°±æŠ¥é”™äº†ï¼Œæ¯”å¦‚åœ¨32ä½çš„æœºå™¨ä¸Šï¼Œinté•¿åº¦æ˜¯32ä½ï¼Œç¨‹åºå°±å‡ºé”™äº†&lt;/p>
&lt;h2 id="æ€»ç»“">&lt;a href="#%e6%80%bb%e7%bb%93" class="header-anchor">&lt;/a>æ€»ç»“
&lt;/h2>&lt;p>è™½ç„¶ go æœ¬èº«ä¸æ”¯æŒæŒ‡é’ˆçš„è¿ç®—ï¼Œä½†æ˜¯æœ‰äº›æ—¶å€™æˆ‘ä»¬éœ€è¦ç”¨åˆ°æŒ‡é’ˆçš„è¿ç®—ï¼Œæ¯”å¦‚è·å–privateå˜é‡ã€‚ä½†æ˜¯è¿™ç§æ–¹å¼æœ‰é£é™©ï¼Œåœ¨å®é™…é¡¹ç›®ä¸­ä½¿ç”¨è¦æ…é‡ï¼ï¼ï¼&lt;/p></description></item><item><title>golangé€ è½®å­ å°è£…ä¸€ä¸ªç®€å•çš„http client</title><link>https://lqxhub.github.io/posts/19d697e6/</link><pubDate>Sat, 13 Mar 2021 17:40:55 +0000</pubDate><guid>https://lqxhub.github.io/posts/19d697e6/</guid><description>&lt;p>è¿‘æ¥æ— äº‹ï¼Œæœ¬ç€çˆ±æŠ˜è…¾çš„åŸåˆ™ï¼Œåœ¨goåŸç”Ÿ http client çš„åŸºç¡€ä¸Šï¼Œè‡ªå·±å°è£…äº†ä¸€ä¸ªgoçš„http clientã€‚ç”±äºæ‰ç–å­¦æµ…ï¼Œå†åŠ æ˜¯ç¬¬ä¸€æ¬¡é€ è½®å­ï¼Œåœ¨å„ä½å¤§ä½¬é¢å‰çŒ®ä¸‘äº†ï¼Œå†™çš„çƒ‚çš„åœ°æ–¹ï¼Œè¯·è½»å–·ã€‚è¿˜è¯·å„ä½ä¸åèµæ•™ã€‚&lt;/p>
&lt;p>å…ˆæ”¾åœ°å€&lt;/p>
&lt;p>&lt;strong>gethubï¼š&lt;/strong> &lt;a class="link" href="https://github.com/lqxhub/easy_http" target="_blank" rel="noopener"
>https://github.com/lqxhub/easy_http&lt;/a>&lt;/p>
&lt;p>&lt;strong>Giteeï¼š&lt;/strong> &lt;a class="link" href="https://gitee.com/lqxlucky/easy_http" target="_blank" rel="noopener"
>https://gitee.com/lqxlucky/easy_http&lt;/a>&lt;/p>
&lt;h2 id="ç®€å•ä»‹ç»ä¸€ä¸‹åŠŸèƒ½">&lt;a href="#%e7%ae%80%e5%8d%95%e4%bb%8b%e7%bb%8d%e4%b8%80%e4%b8%8b%e5%8a%9f%e8%83%bd" class="header-anchor">&lt;/a>ç®€å•ä»‹ç»ä¸€ä¸‹åŠŸèƒ½
&lt;/h2>&lt;ol>
&lt;li>ä½¿ç”¨ æ„é€ å™¨æ¨¡å¼ï¼Œæä¾›äº†é“¾å¼è°ƒç”¨å’Œæ–¹ä¾¿ä½¿ç”¨çš„æ¥å£&lt;/li>
&lt;li>æ”¯æŒhttpsè‡ªå®šä¹‰æœåŠ¡å™¨è¯ä¹¦æ ¡éªŒå’ŒåŒå‘è¯ä¹¦æ ¡éªŒ&lt;/li>
&lt;li>æ”¯æŒä»£ç†,å¯ä»¥æ–¹ä¾¿çš„è®¾ç½®ä»£ç†&lt;/li>
&lt;li>å°è£…äº†multipart åè®®, å¯ä»¥æ–¹ä¾¿çš„ä¸Šä¼ æ–‡ä»¶&lt;/li>
&lt;li>å…·æœ‰å¾ˆå¼ºçš„æ‹“å±•æ€§,å¯ä»¥åœ¨åŸºç¡€ä¸Šéå¸¸æ–¹ä¾¿çš„å®šåˆ¶è‡ªå·±httpè¯·æ±‚&lt;/li>
&lt;li>æ”¯æŒhttpçš„ è¿”å›ç»“æœ å¼‚æ­¥å›è°ƒ&lt;/li>
&lt;li>å¯ä»¥æ–¹ä¾¿çš„è‡ªå®šä¹‰Response&lt;/li>
&lt;/ol>
&lt;h2 id="å®‰è£…åº“">&lt;a href="#%e5%ae%89%e8%a3%85%e5%ba%93" class="header-anchor">&lt;/a>å®‰è£…åº“
&lt;/h2>&lt;p>å¯ä»¥ä½¿ç”¨githubçš„åº“,ä¹Ÿå¯ä½¿ç”¨Giteeçš„åº“ï¼Œä¸¤ä¸ªåº“çš„ä»£ç éƒ½æ˜¯ä¸€æ ·çš„ï¼Œå› ä¸ºgithubç½‘é€Ÿçš„åŸå› ï¼Œæ‰€ä»¥åœ¨giteeä¸Šä¹Ÿä¼ äº†ä¸€ä»½&lt;/p>
&lt;ol>
&lt;li>
&lt;p>githubï¼š&lt;code>go get -u https://github.com/lqxhub/easy_http&lt;/code>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>giteeï¼š &lt;code>go get -u https://gitee.com/lqxlucky/easy_http&lt;/code>&lt;/p>
&lt;/li>
&lt;/ol>
&lt;h2 id="ä½¿ç”¨">&lt;a href="#%e4%bd%bf%e7%94%a8" class="header-anchor">&lt;/a>ä½¿ç”¨
&lt;/h2>&lt;h3 id="å¼•å…¥åº“">&lt;a href="#%e5%bc%95%e5%85%a5%e5%ba%93" class="header-anchor">&lt;/a>å¼•å…¥åº“
&lt;/h3>&lt;p>å› ä¸ºgithubå’Œgiteeæ‹‰ä¸‹æ¥çš„åº“ç›®å½•ä¸åŒï¼Œæ‰€ä»¥ä»¥githubçš„ä¸ºå‡†&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-fallback" data-lang="fallback">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>import &amp;#34;github.com/lqxhub/easy_http&amp;#34;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="å…·ä½“ä½¿ç”¨">&lt;a href="#%e5%85%b7%e4%bd%93%e4%bd%bf%e7%94%a8" class="header-anchor">&lt;/a>å…·ä½“ä½¿ç”¨
&lt;/h3>&lt;h4 id="å…¨éƒ¨é…ç½®">&lt;a href="#%e5%85%a8%e9%83%a8%e9%85%8d%e7%bd%ae" class="header-anchor">&lt;/a>å…¨éƒ¨é…ç½®
&lt;/h4>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> &lt;span style="color:#50fa7b">main&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span> &lt;span style="color:#6272a4">//å¾—åˆ°ä¸€ä¸ªhttp clientçš„æ„é€ å™¨
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> builder &lt;span style="color:#ff79c6">:=&lt;/span> easy_http.&lt;span style="color:#50fa7b">NewClientBuilder&lt;/span>()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span> &lt;span style="color:#6272a4">//æ˜¯å¦è·³è¿‡æœåŠ¡å™¨è¯ä¹¦æ ¡éªŒ
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> builder.&lt;span style="color:#50fa7b">SkipVerify&lt;/span>(&lt;span style="color:#ff79c6">false&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span> &lt;span style="color:#6272a4">//è®¾ç½®è¶…æ—¶æ—¶é—´
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> builder.&lt;span style="color:#50fa7b">TimeOut&lt;/span>(time.Second &lt;span style="color:#ff79c6">*&lt;/span> &lt;span style="color:#bd93f9">5&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span> &lt;span style="color:#6272a4">//è®¾ç½®ä»£ç†
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> builder.&lt;span style="color:#50fa7b">ProxyUrl&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;http://127.0.0.1:10809&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span> &lt;span style="color:#6272a4">//è®¾ç½®æ ¹è¯ä¹¦
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">var&lt;/span> certPool [&lt;span style="color:#bd93f9">1&lt;/span>]&lt;span style="color:#8be9fd">string&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16&lt;/span>&lt;span> certPool[&lt;span style="color:#bd93f9">0&lt;/span>] = &lt;span style="color:#f1fa8c">&amp;#34;D:\\server.pem&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17&lt;/span>&lt;span> builder.&lt;span style="color:#50fa7b">Cert&lt;/span>(certPool[:])
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19&lt;/span>&lt;span> &lt;span style="color:#6272a4">//è®¾ç½®åŒå‘æ ¡éªŒè¯ä¹¦
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">var&lt;/span> tlsPath [&lt;span style="color:#bd93f9">1&lt;/span>]&lt;span style="color:#ff79c6">*&lt;/span>easy_http.TlsPath
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21&lt;/span>&lt;span> tlsPath[&lt;span style="color:#bd93f9">0&lt;/span>] = &lt;span style="color:#ff79c6">&amp;amp;&lt;/span>easy_http.TlsPath{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22&lt;/span>&lt;span> CertFile: &lt;span style="color:#f1fa8c">&amp;#34;D:\\client.pem&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23&lt;/span>&lt;span> KeyFile: &lt;span style="color:#f1fa8c">&amp;#34;D:\\client.key&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25&lt;/span>&lt;span> builder.&lt;span style="color:#50fa7b">Tls&lt;/span>(tlsPath[:])
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27&lt;/span>&lt;span> &lt;span style="color:#6272a4">//è®¾ç½®httpè¯·æ±‚header
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> header &lt;span style="color:#ff79c6">:=&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">make&lt;/span>(&lt;span style="color:#8be9fd;font-style:italic">map&lt;/span>[&lt;span style="color:#8be9fd">string&lt;/span>]&lt;span style="color:#8be9fd">string&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29&lt;/span>&lt;span> header[&lt;span style="color:#f1fa8c">&amp;#34;Accept-Language&amp;#34;&lt;/span>] = &lt;span style="color:#f1fa8c">&amp;#34;Accept-Language: en,zh&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30&lt;/span>&lt;span> builder.&lt;span style="color:#50fa7b">Header&lt;/span>(header)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32&lt;/span>&lt;span> &lt;span style="color:#6272a4">//è®¾ç½®httpè¯·æ±‚cookie
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> cookie &lt;span style="color:#ff79c6">:=&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">make&lt;/span>(&lt;span style="color:#8be9fd;font-style:italic">map&lt;/span>[&lt;span style="color:#8be9fd">string&lt;/span>]&lt;span style="color:#8be9fd">string&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34&lt;/span>&lt;span> cookie[&lt;span style="color:#f1fa8c">&amp;#34;name&amp;#34;&lt;/span>] = &lt;span style="color:#f1fa8c">&amp;#34;value&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35&lt;/span>&lt;span> builder.&lt;span style="color:#50fa7b">Cookie&lt;/span>(easy_http.&lt;span style="color:#50fa7b">EasyCookie&lt;/span>(cookie))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37&lt;/span>&lt;span> &lt;span style="color:#6272a4">//å¼€å¯cookie jar
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> builder.&lt;span style="color:#50fa7b">Jar&lt;/span>(&lt;span style="color:#ff79c6">nil&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40&lt;/span>&lt;span> &lt;span style="color:#6272a4">//è®¾ç½® Response å¤„ç†å‡½æ•°
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> builder.&lt;span style="color:#50fa7b">BuildResponse&lt;/span>(easy_http.EasyBuildResponse)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43&lt;/span>&lt;span> &lt;span style="color:#6272a4">//æ„é€ client
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> client, err &lt;span style="color:#ff79c6">:=&lt;/span> builder.&lt;span style="color:#50fa7b">Build&lt;/span>()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> err &lt;span style="color:#ff79c6">!=&lt;/span> &lt;span style="color:#ff79c6">nil&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46&lt;/span>&lt;span> fmt.&lt;span style="color:#50fa7b">Println&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;aa&amp;#34;&lt;/span>, err)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™æ ·å°±åˆå§‹åŒ–ä¸€ä¸ªhttpçš„å®¢æˆ·ç«¯&lt;/p>
&lt;p>å½“ç„¶ï¼Œä¸Šé¢çš„ä¾‹å­æ˜¯è®¾ç½®äº†æ‰€æœ‰é…ç½®çš„ï¼Œä¹Ÿå¯ä»¥å…¨éƒ¨ä½¿ç”¨é»˜è®¤é…ç½®&lt;/p>
&lt;h3 id="ä½¿ç”¨é»˜è®¤é…ç½®">&lt;a href="#%e4%bd%bf%e7%94%a8%e9%bb%98%e8%ae%a4%e9%85%8d%e7%bd%ae" class="header-anchor">&lt;/a>ä½¿ç”¨é»˜è®¤é…ç½®
&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> &lt;span style="color:#50fa7b">DefaultClient&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span> builder &lt;span style="color:#ff79c6">:=&lt;/span> easy_http.&lt;span style="color:#50fa7b">NewClientBuilder&lt;/span>()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3&lt;/span>&lt;span> client, err &lt;span style="color:#ff79c6">:=&lt;/span> builder.&lt;span style="color:#50fa7b">Build&lt;/span>()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> err &lt;span style="color:#ff79c6">!=&lt;/span> &lt;span style="color:#ff79c6">nil&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5&lt;/span>&lt;span> fmt.&lt;span style="color:#50fa7b">Println&lt;/span>(err)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8&lt;/span>&lt;span> client.&lt;span style="color:#50fa7b">Get&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;http://baidu.com&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">9&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™æ ·åŒæ ·æ˜¯å¯ä»¥çš„&lt;/p>
&lt;h4 id="easy-å‡½æ•°-ä½¿ç”¨">&lt;a href="#easy-%e5%87%bd%e6%95%b0-%e4%bd%bf%e7%94%a8" class="header-anchor">&lt;/a>easy å‡½æ•° ä½¿ç”¨
&lt;/h4>&lt;p>åº“ä¸­æä¾›äº†ä¸€äº›å‡½æ•°ï¼Œå¯ä»¥æ–¹ä¾¿çš„æ„é€ httpè¯·æ±‚ç›¸å…³çš„ç»“æ„&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> &lt;span style="color:#50fa7b">EasyFunction&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span> url &lt;span style="color:#ff79c6">:=&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;http://baidu.com&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span> &lt;span style="color:#6272a4">//åˆæˆhttp getçš„urlå’Œå‚æ•°
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> values &lt;span style="color:#ff79c6">:=&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">make&lt;/span>(&lt;span style="color:#8be9fd;font-style:italic">map&lt;/span>[&lt;span style="color:#8be9fd">string&lt;/span>]&lt;span style="color:#8be9fd">string&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span> values[&lt;span style="color:#f1fa8c">&amp;#34;v&amp;#34;&lt;/span>] = &lt;span style="color:#f1fa8c">&amp;#34;123456&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span> easy_http.&lt;span style="color:#50fa7b">EasyGet&lt;/span>(url, values)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span> &lt;span style="color:#6272a4">//æ„é€ cookie
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> cookie &lt;span style="color:#ff79c6">:=&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">make&lt;/span>(&lt;span style="color:#8be9fd;font-style:italic">map&lt;/span>[&lt;span style="color:#8be9fd">string&lt;/span>]&lt;span style="color:#8be9fd">string&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span> cookie[&lt;span style="color:#f1fa8c">&amp;#34;name&amp;#34;&lt;/span>] = &lt;span style="color:#f1fa8c">&amp;#34;value&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span> easy_http.&lt;span style="color:#50fa7b">EasyCookie&lt;/span>(cookie)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15&lt;/span>&lt;span> &lt;span style="color:#6272a4">//åˆæˆ http post çš„å‚æ•°
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> easy_http.&lt;span style="color:#50fa7b">EasyPost&lt;/span>(values)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18&lt;/span>&lt;span> &lt;span style="color:#6272a4">//æ„é€  ä¸Šä¼ æ–‡ä»¶çš„multipart
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> multipartBuilder &lt;span style="color:#ff79c6">:=&lt;/span> easy_http.&lt;span style="color:#50fa7b">NewMultipartBuilder&lt;/span>()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20&lt;/span>&lt;span> multipartBuilder.&lt;span style="color:#50fa7b">AddFile&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;file1&amp;#34;&lt;/span>,&lt;span style="color:#f1fa8c">&amp;#34;D:\\a.txt&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21&lt;/span>&lt;span> multipartBuilder.&lt;span style="color:#50fa7b">AddFromDate&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;name&amp;#34;&lt;/span>,&lt;span style="color:#f1fa8c">&amp;#34;value&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22&lt;/span>&lt;span> multipartBuilder.&lt;span style="color:#50fa7b">AddBytes&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;name2&amp;#34;&lt;/span>,[]&lt;span style="color:#8be9fd;font-style:italic">byte&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;aaaaa&amp;#34;&lt;/span>))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23&lt;/span>&lt;span> multipart, err &lt;span style="color:#ff79c6">:=&lt;/span> multipartBuilder.&lt;span style="color:#50fa7b">Builder&lt;/span>()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="å¼‚æ­¥å›è°ƒä½¿ç”¨">&lt;a href="#%e5%bc%82%e6%ad%a5%e5%9b%9e%e8%b0%83%e4%bd%bf%e7%94%a8" class="header-anchor">&lt;/a>å¼‚æ­¥å›è°ƒä½¿ç”¨
&lt;/h4>&lt;p>åº“å°è£…äº† å¼‚æ­¥å›è°ƒåŠŸèƒ½ï¼Œè¯·æ±‚ä¼šåœ¨ä¸€ä¸ªæ–°çš„goroutineä¸­è¿›è¡Œã€‚å½“httpè¯·æ±‚å®Œæˆæ—¶ï¼Œä¼šå›è°ƒå‡½æ•°ã€‚å›è°ƒå‡½æ•°å¯ç”¨å½¢å‚ä½¿ç”¨ä¼ å…¥å‡½æ•°å’Œå®ç°æ¥å£ä¸¤ç§æ–¹å¼&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> &lt;span style="color:#50fa7b">Call&lt;/span>(response easy_http.IResponse) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span> fmt.&lt;span style="color:#50fa7b">Println&lt;/span>(response.&lt;span style="color:#50fa7b">Error&lt;/span>())
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span> fmt.&lt;span style="color:#50fa7b">Println&lt;/span>(response.&lt;span style="color:#50fa7b">StatusCode&lt;/span>())
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span> fmt.&lt;span style="color:#50fa7b">Println&lt;/span>(&lt;span style="color:#8be9fd;font-style:italic">string&lt;/span>(response.&lt;span style="color:#50fa7b">Content&lt;/span>()))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">type&lt;/span> Get &lt;span style="color:#8be9fd;font-style:italic">struct&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> (g Get) &lt;span style="color:#50fa7b">EasyResponseCallback&lt;/span>(response easy_http.IResponse) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span> fmt.&lt;span style="color:#50fa7b">Println&lt;/span>(response.&lt;span style="color:#50fa7b">Error&lt;/span>())
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span> fmt.&lt;span style="color:#50fa7b">Println&lt;/span>(response.&lt;span style="color:#50fa7b">StatusCode&lt;/span>())
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span> fmt.&lt;span style="color:#50fa7b">Println&lt;/span>(&lt;span style="color:#8be9fd;font-style:italic">string&lt;/span>(response.&lt;span style="color:#50fa7b">Content&lt;/span>()))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> &lt;span style="color:#50fa7b">AsynchronousRequest&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18&lt;/span>&lt;span> url &lt;span style="color:#ff79c6">:=&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;http://baidu.com&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19&lt;/span>&lt;span> client, err &lt;span style="color:#ff79c6">:=&lt;/span> easy_http.&lt;span style="color:#50fa7b">NewClientBuilder&lt;/span>().&lt;span style="color:#50fa7b">Build&lt;/span>()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> err &lt;span style="color:#ff79c6">!=&lt;/span> &lt;span style="color:#ff79c6">nil&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21&lt;/span>&lt;span> fmt.&lt;span style="color:#50fa7b">Println&lt;/span>(err)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25&lt;/span>&lt;span> &lt;span style="color:#6272a4">//å‡½æ•°å¼‚æ­¥å›è°ƒ
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> client.&lt;span style="color:#50fa7b">GetAsyn&lt;/span>(url, Call)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28&lt;/span>&lt;span> &lt;span style="color:#6272a4">//æ¥å£å¼‚æ­¥å›è°ƒ
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> client.&lt;span style="color:#50fa7b">GetAsynWithCallback&lt;/span>(url, &lt;span style="color:#ff79c6">&amp;amp;&lt;/span>Get{})
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="è‡ªå®šä¹‰è¯·æ±‚">&lt;a href="#%e8%87%aa%e5%ae%9a%e4%b9%89%e8%af%b7%e6%b1%82" class="header-anchor">&lt;/a>è‡ªå®šä¹‰è¯·æ±‚
&lt;/h4>&lt;p>å› ä¸ºåº“ä¸­åªå°è£…äº† GETå’ŒPOSTè¿™ä¸¤ç§æ–¹å¼ï¼Œå‘PUTï¼ŒDELETEç­‰è¿™äº›æ–¹å¼éœ€è¦è‡ªå·±å»å®ç°ã€‚æ‰€ä»¥ï¼Œå¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‡½æ•°æ¥å®ç°&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> &lt;span style="color:#50fa7b">Call&lt;/span>(response easy_http.IResponse) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span> fmt.&lt;span style="color:#50fa7b">Println&lt;/span>(response.&lt;span style="color:#50fa7b">Error&lt;/span>())
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span> fmt.&lt;span style="color:#50fa7b">Println&lt;/span>(response.&lt;span style="color:#50fa7b">StatusCode&lt;/span>())
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span> fmt.&lt;span style="color:#50fa7b">Println&lt;/span>(&lt;span style="color:#8be9fd;font-style:italic">string&lt;/span>(response.&lt;span style="color:#50fa7b">Content&lt;/span>()))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> &lt;span style="color:#50fa7b">CustomizeRequest&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span> url &lt;span style="color:#ff79c6">:=&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;http://baidu.com&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span> client, err &lt;span style="color:#ff79c6">:=&lt;/span> easy_http.&lt;span style="color:#50fa7b">NewClientBuilder&lt;/span>().&lt;span style="color:#50fa7b">Build&lt;/span>()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> err &lt;span style="color:#ff79c6">!=&lt;/span> &lt;span style="color:#ff79c6">nil&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span> fmt.&lt;span style="color:#50fa7b">Println&lt;/span>(err)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span> response &lt;span style="color:#ff79c6">:=&lt;/span> client.&lt;span style="color:#50fa7b">SendWithMethod&lt;/span>(url, http.MethodPut, &lt;span style="color:#ff79c6">nil&lt;/span>, &lt;span style="color:#8be9fd;font-style:italic">func&lt;/span>(request &lt;span style="color:#ff79c6">*&lt;/span>http.Request) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15&lt;/span>&lt;span> &lt;span style="color:#6272a4">//ä¿®æ”¹Request
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> })
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17&lt;/span>&lt;span> fmt.&lt;span style="color:#50fa7b">Println&lt;/span>(response.&lt;span style="color:#50fa7b">Error&lt;/span>())
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18&lt;/span>&lt;span> fmt.&lt;span style="color:#50fa7b">Println&lt;/span>(response.&lt;span style="color:#50fa7b">StatusCode&lt;/span>())
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20&lt;/span>&lt;span> &lt;span style="color:#6272a4">//å¼‚æ­¥æ–¹å¼
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> client.&lt;span style="color:#50fa7b">SendWithMethodCallBack&lt;/span>(url, http.MethodPut, &lt;span style="color:#ff79c6">nil&lt;/span>, &lt;span style="color:#8be9fd;font-style:italic">func&lt;/span>(request &lt;span style="color:#ff79c6">*&lt;/span>http.Request) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22&lt;/span>&lt;span> &lt;span style="color:#6272a4">//ä¹ æƒ¯Request
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> }, Call)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="ä½¿ç”¨go-httpé»˜è®¤çš„å‡½æ•°è¯·æ±‚">&lt;a href="#%e4%bd%bf%e7%94%a8go-http%e9%bb%98%e8%ae%a4%e7%9a%84%e5%87%bd%e6%95%b0%e8%af%b7%e6%b1%82" class="header-anchor">&lt;/a>ä½¿ç”¨go httpé»˜è®¤çš„å‡½æ•°è¯·æ±‚
&lt;/h4>&lt;p>å½“éœ€è¦æœ‰ä¸€äº›ç‰¹æ®Šçš„è¯·æ±‚ï¼Œè¿™ä¸ªåº“æ— æ³•æ»¡è¶³æ—¶ï¼Œå¯ä»¥ä½¿ç”¨go httpåŸç”Ÿçš„æ–¹å¼æ¥è¯·æ±‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> &lt;span style="color:#50fa7b">Primitive&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span> url &lt;span style="color:#ff79c6">:=&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;http://baidu.com&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span> client, err &lt;span style="color:#ff79c6">:=&lt;/span> easy_http.&lt;span style="color:#50fa7b">NewClientBuilder&lt;/span>().&lt;span style="color:#50fa7b">Build&lt;/span>()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> err &lt;span style="color:#ff79c6">!=&lt;/span> &lt;span style="color:#ff79c6">nil&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span> fmt.&lt;span style="color:#50fa7b">Println&lt;/span>(err)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span> &lt;span style="color:#6272a4">//è·å–Request
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> request, err &lt;span style="color:#ff79c6">:=&lt;/span> http.&lt;span style="color:#50fa7b">NewRequest&lt;/span>(http.MethodGet, url, &lt;span style="color:#ff79c6">nil&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> err &lt;span style="color:#ff79c6">!=&lt;/span> &lt;span style="color:#ff79c6">nil&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span> fmt.&lt;span style="color:#50fa7b">Println&lt;/span>(err)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span> &lt;span style="color:#6272a4">//å¾—åˆ°httpçš„åŸç”ŸResponse
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> response, err &lt;span style="color:#ff79c6">:=&lt;/span> client.&lt;span style="color:#50fa7b">DoRequest&lt;/span>(request)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> err &lt;span style="color:#ff79c6">!=&lt;/span> &lt;span style="color:#ff79c6">nil&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17&lt;/span>&lt;span> fmt.&lt;span style="color:#50fa7b">Println&lt;/span>(err)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20&lt;/span>&lt;span> fmt.&lt;span style="color:#50fa7b">Println&lt;/span>(response)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="è‡ªå®šä¹‰response">&lt;a href="#%e8%87%aa%e5%ae%9a%e4%b9%89response" class="header-anchor">&lt;/a>è‡ªå®šä¹‰Response
&lt;/h4>&lt;p>åº“ä¸­è¿”å›çš„Responseæ˜¯ä¸€ä¸ªæ¥å£ç±»å‹ï¼Œåªè¦å®ç°äº†è¿™ä¸ªæ¥å£ï¼Œéƒ½å¯ä½œä¸ºè¿”å›å€¼è¿”å›ï¼Œè‡ªå®šä¹‰çš„Responseï¼Œåœ¨æ„é€ clientçš„è®¾ç½®å°±å¯ä»¥äº†&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">type&lt;/span> MyResponse &lt;span style="color:#8be9fd;font-style:italic">struct&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> (m MyResponse) &lt;span style="color:#50fa7b">Error&lt;/span>() &lt;span style="color:#8be9fd">error&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> &lt;span style="color:#ff79c6">nil&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> (m MyResponse) &lt;span style="color:#50fa7b">StatusCode&lt;/span>() &lt;span style="color:#8be9fd">int&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> (m MyResponse) &lt;span style="color:#50fa7b">Header&lt;/span>() http.Header {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> &lt;span style="color:#ff79c6">nil&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> (m MyResponse) &lt;span style="color:#50fa7b">ContentLength&lt;/span>() &lt;span style="color:#8be9fd">int64&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> (m MyResponse) &lt;span style="color:#50fa7b">Content&lt;/span>() []&lt;span style="color:#8be9fd">byte&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> &lt;span style="color:#ff79c6">nil&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> (m MyResponse) &lt;span style="color:#50fa7b">Resp&lt;/span>() &lt;span style="color:#ff79c6">*&lt;/span>http.Response {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> &lt;span style="color:#ff79c6">nil&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> (m MyResponse) &lt;span style="color:#50fa7b">Request&lt;/span>() &lt;span style="color:#ff79c6">*&lt;/span>http.Request {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> &lt;span style="color:#ff79c6">nil&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> (m MyResponse) &lt;span style="color:#50fa7b">Cookie&lt;/span>(name &lt;span style="color:#8be9fd">string&lt;/span>) &lt;span style="color:#ff79c6">*&lt;/span>http.Cookie {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> &lt;span style="color:#ff79c6">nil&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36&lt;/span>&lt;span>&lt;span style="color:#6272a4">//æ„é€ HTTP responseçš„å‡½æ•°
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> &lt;span style="color:#50fa7b">MyBuildResponse&lt;/span>(resp &lt;span style="color:#ff79c6">*&lt;/span>http.Response, err &lt;span style="color:#8be9fd">error&lt;/span>) easy_http.IResponse {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38&lt;/span>&lt;span> response &lt;span style="color:#ff79c6">:=&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">new&lt;/span>(MyResponse)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39&lt;/span>&lt;span> &lt;span style="color:#6272a4">//åšå¤„ç†
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> &lt;span style="color:#ff79c6">return&lt;/span> response
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> &lt;span style="color:#50fa7b">CustomizeResponse&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43&lt;/span>&lt;span> client, err &lt;span style="color:#ff79c6">:=&lt;/span> easy_http.&lt;span style="color:#50fa7b">NewClientBuilder&lt;/span>().
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44&lt;/span>&lt;span> &lt;span style="color:#50fa7b">BuildResponse&lt;/span>(MyBuildResponse).
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45&lt;/span>&lt;span> &lt;span style="color:#50fa7b">Build&lt;/span>()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> err &lt;span style="color:#ff79c6">!=&lt;/span> &lt;span style="color:#ff79c6">nil&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47&lt;/span>&lt;span> fmt.&lt;span style="color:#50fa7b">Println&lt;/span>(err)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ç»“æ„ä½“ &lt;code>MyResponse&lt;/code> å®ç°äº† &lt;code>easy_http.IResponse&lt;/code> è¿™ä¸ªæ¥å£ã€‚ç„¶ååœ¨&lt;code>MyBuildResponse&lt;/code>è¿™ä¸ªå‡½æ•°ä¸­ï¼Œnew ä¸€ä¸ª &lt;code>MyResponse&lt;/code>çš„å¯¹è±¡ï¼Œå†æ ¹æ®è‡ªå·±çš„éœ€è¦ï¼Œåšç›¸åº”çš„å¤„ç†å°±å¯ä»¥äº†ã€‚
åœ¨&lt;code>clientBuilder.BuildResponse(MyBuildResponse)&lt;/code>è®¾ç½®å°±å¯ä»¥äº†&lt;/p>
&lt;h2 id="æœ€å">&lt;a href="#%e6%9c%80%e5%90%8e" class="header-anchor">&lt;/a>æœ€å
&lt;/h2>&lt;p>æ•´ä¸ªåº“çš„åŸºæœ¬åŠŸèƒ½å°±æ˜¯è¿™äº›äº†ã€‚ç¬¬ä¸€é€ è½®å­ï¼Œå†™çš„å¾ˆçƒ‚ã€‚å†™è¿™ç¯‡æ–‡ç« æ—¶ï¼Œè¿˜å‘ç°äº†å¥½å‡ ä¸ªå› ä¸ºé¦–å­—æ¯å°å†™å¯¼è‡´çš„é—®é¢˜ã€‚&lt;/p>
&lt;p>æœ‰é—®é¢˜çš„åœ°æ–¹ï¼Œè¿˜è¯·ä¸åèµæ•™&lt;/p></description></item><item><title>linux shell è„šæœ¬ å¸¸ç”¨çš„ifåˆ¤æ–­æ¡ä»¶</title><link>https://lqxhub.github.io/posts/6cd27815/</link><pubDate>Sat, 13 Mar 2021 11:27:54 +0000</pubDate><guid>https://lqxhub.github.io/posts/6cd27815/</guid><description>&lt;p>å·¥ä½œä¸­ç»å¸¸éœ€è¦å†™shellè„šæœ¬æ¥å¤„ç†ä¸€äº›é‡å¤çš„ä¸œè¥¿ï¼Œä½¿ç”¨è„šæœ¬è‡ªåŠ¨ç¼–è¯‘ï¼Œä½¿ç”¨è„šæœ¬å¤šæœºå™¨ä¼ è¾“æ–‡ä»¶ã€‚&lt;/p>
&lt;p>å› ä¸ºä¸æ˜¯å¤©å¤©å†™shellï¼Œåªæ˜¯ç”¨åˆ°çš„æ—¶å€™å†™ä¸€ä¸ªï¼Œå†åŠ ä¸Šè„šæœ¬ä¸­çš„ifçš„åˆ¤æ–­æ¡ä»¶æœ‰ç‚¹å¤šï¼Œå®¹æ˜“å¿˜è®°ï¼Œæ‰€ä»¥åšä¸ªå¤‡å¿˜å½•ï¼Œä»¥å¤‡ä¸æ—¶ä¹‹éœ€&lt;/p>
&lt;h2 id="å…ˆè¯´ä¸€ä¸‹-if-è¡¨è¾¾å¼çš„åŸºæœ¬è¯­æ³•">&lt;a href="#%e5%85%88%e8%af%b4%e4%b8%80%e4%b8%8b-if-%e8%a1%a8%e8%be%be%e5%bc%8f%e7%9a%84%e5%9f%ba%e6%9c%ac%e8%af%ad%e6%b3%95" class="header-anchor">&lt;/a>å…ˆè¯´ä¸€ä¸‹ if è¡¨è¾¾å¼çš„åŸºæœ¬è¯­æ³•
&lt;/h2>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">if&lt;/span> &lt;span style="color:#ff79c6">[&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">command&lt;/span> &lt;span style="color:#ff79c6">]&lt;/span>; &lt;span style="color:#ff79c6">then&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span> ç¬¦åˆè¯¥æ¡ä»¶æ‰§è¡Œçš„è¯­å¥
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3&lt;/span>&lt;span>&lt;span style="color:#ff79c6">fi&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">if&lt;/span> &lt;span style="color:#ff79c6">[&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">command&lt;/span> &lt;span style="color:#ff79c6">]&lt;/span>;&lt;span style="color:#ff79c6">then&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span> ç¬¦åˆè¯¥æ¡ä»¶æ‰§è¡Œçš„è¯­å¥
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3&lt;/span>&lt;span>&lt;span style="color:#ff79c6">elif&lt;/span> &lt;span style="color:#ff79c6">[&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">command&lt;/span> &lt;span style="color:#ff79c6">]&lt;/span>;&lt;span style="color:#ff79c6">then&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4&lt;/span>&lt;span> ç¬¦åˆè¯¥æ¡ä»¶æ‰§è¡Œçš„è¯­å¥
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5&lt;/span>&lt;span>&lt;span style="color:#ff79c6">else&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6&lt;/span>&lt;span> ç¬¦åˆè¯¥æ¡ä»¶æ‰§è¡Œçš„è¯­å¥
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7&lt;/span>&lt;span>&lt;span style="color:#ff79c6">fi&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>æ³¨æ„ï¼š&lt;/strong>&lt;/p>
&lt;ol>
&lt;li>if æ¡ä»¶ è¦ä»¥ &lt;code>fi&lt;/code> ç»“æŸ&lt;/li>
&lt;li>&lt;code>[]&lt;/code> ifè¯­å¥ä¸­ å’Œ è¡¨è¾¾å¼è¦æ³¨æ„ç©ºæ ¼&lt;/li>
&lt;li>&lt;code>then&lt;/code> å’Œ &lt;code>fi&lt;/code> æ˜¯åˆ†å¼€çš„è¯­å¥ã€‚å¦‚æœè¦åœ¨åŒä¸€è¡Œé‡Œé¢è¾“å…¥ï¼Œåˆ™éœ€è¦ç”¨åˆ†å·å°†ä»–ä»¬éš”å¼€&lt;/li>
&lt;li>ä½¿ç”¨ &lt;code>-z&lt;/code> æˆ–è€… &lt;code>-n&lt;/code> æ¥æ£€æŸ¥é•¿åº¦çš„æ—¶å€™ï¼Œæ²¡æœ‰å®šä¹‰çš„å˜é‡ä¹Ÿä¸º0&lt;/li>
&lt;/ol>
&lt;h2 id="ä¸‹é¢æ˜¯å¸¸ç”¨è¡¨è¾¾å¼">&lt;a href="#%e4%b8%8b%e9%9d%a2%e6%98%af%e5%b8%b8%e7%94%a8%e8%a1%a8%e8%be%be%e5%bc%8f" class="header-anchor">&lt;/a>ä¸‹é¢æ˜¯å¸¸ç”¨è¡¨è¾¾å¼
&lt;/h2>&lt;h3 id="æ•°å­—åˆ¤æ–­">&lt;a href="#%e6%95%b0%e5%ad%97%e5%88%a4%e6%96%ad" class="header-anchor">&lt;/a>æ•°å­—åˆ¤æ–­
&lt;/h3>&lt;table>
&lt;thead>
&lt;tr>
&lt;th>è¡¨è¾¾å¼&lt;/th>
&lt;th>å«ä¹‰&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>int1 -eq int2&lt;/td>
&lt;td>ä¸¤æ•°ç›¸ç­‰ä¸ºçœŸ&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>int1 -ne int2&lt;/td>
&lt;td>ä¸¤æ•°ä¸ç­‰ä¸ºçœŸ&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>int1 -gt int2&lt;/td>
&lt;td>int1å¤§äºint2ä¸ºçœŸ&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>int1 -ge int2&lt;/td>
&lt;td>int1å¤§äºç­‰äºint2ä¸ºçœŸ&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>int1 -lt int2&lt;/td>
&lt;td>int1å°äºint2ä¸ºçœŸ&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>int1 -le int2&lt;/td>
&lt;td>int1å°äºç­‰äºint2ä¸ºçœŸ&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h3 id="é€»è¾‘ç›¸å…³">&lt;a href="#%e9%80%bb%e8%be%91%e7%9b%b8%e5%85%b3" class="header-anchor">&lt;/a>é€»è¾‘ç›¸å…³
&lt;/h3>&lt;table>
&lt;thead>
&lt;tr>
&lt;th>è¡¨è¾¾å¼&lt;/th>
&lt;th>å«ä¹‰&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>-a&lt;/td>
&lt;td>ä¸&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>-oã€€&lt;/td>
&lt;td>æˆ–&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>!&lt;/td>
&lt;td>ã€€é&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h3 id="å­—ç¬¦ä¸²ç›¸å…³">&lt;a href="#%e5%ad%97%e7%ac%a6%e4%b8%b2%e7%9b%b8%e5%85%b3" class="header-anchor">&lt;/a>å­—ç¬¦ä¸²ç›¸å…³
&lt;/h3>&lt;table>
&lt;thead>
&lt;tr>
&lt;th>è¡¨è¾¾å¼&lt;/th>
&lt;th>å«ä¹‰&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>STRINGã€€&lt;/td>
&lt;td>å½“ä¸²str1ä¸ºéç©ºæ—¶ä¸ºçœŸ&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>-z STRING&lt;/td>
&lt;td>â€œSTRINGâ€ çš„é•¿åº¦ä¸ºé›¶åˆ™ä¸ºçœŸ&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>-n STRING&lt;/td>
&lt;td>â€œSTRINGâ€ çš„é•¿åº¦ä¸ºéé›¶ non-zeroåˆ™ä¸ºçœŸ&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>STRING1 == STRING2&lt;/td>
&lt;td>å¦‚æœ2ä¸ªå­—ç¬¦ä¸²ç›¸åŒåˆ™ä¸ºçœŸ&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>STRING1 != STRING2&lt;/td>
&lt;td>å¦‚æœå­—ç¬¦ä¸²ä¸ç›¸ç­‰åˆ™ä¸º&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h3 id="æ–‡ä»¶ç›¸å…³">&lt;a href="#%e6%96%87%e4%bb%b6%e7%9b%b8%e5%85%b3" class="header-anchor">&lt;/a>æ–‡ä»¶ç›¸å…³
&lt;/h3>&lt;table>
&lt;thead>
&lt;tr>
&lt;th>è¡¨è¾¾å¼&lt;/th>
&lt;th>å«ä¹‰&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>-a FILE&lt;/td>
&lt;td>å¦‚æœ FILE å­˜åœ¨åˆ™ä¸ºçœŸ&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>-b FILE&lt;/td>
&lt;td>å¦‚æœ FILE å­˜åœ¨ä¸”æ˜¯ä¸€ä¸ªå—ç‰¹æ®Šæ–‡ä»¶åˆ™ä¸ºçœŸ&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>-c FILE&lt;/td>
&lt;td>å¦‚æœ FILE å­˜åœ¨ä¸”æ˜¯ä¸€ä¸ªå­—ç‰¹æ®Šæ–‡ä»¶åˆ™ä¸ºçœŸ&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>-d FILE&lt;/td>
&lt;td>å¦‚æœ FILE å­˜åœ¨ä¸”æ˜¯ä¸€ä¸ªç›®å½•åˆ™ä¸ºçœŸ&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>-e FILE&lt;/td>
&lt;td>å¦‚æœ FILE å­˜åœ¨åˆ™ä¸ºçœŸ&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>-f FILE&lt;/td>
&lt;td>å¦‚æœ FILE å­˜åœ¨ä¸”æ˜¯ä¸€ä¸ªæ™®é€šæ–‡ä»¶åˆ™ä¸ºçœŸ&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>-g FILE&lt;/td>
&lt;td>å¦‚æœ FILE å­˜åœ¨ä¸”å·²ç»è®¾ç½®äº†SGIDåˆ™ä¸ºçœŸ&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>-h FILE&lt;/td>
&lt;td>å¦‚æœ FILE å­˜åœ¨ä¸”æ˜¯ä¸€ä¸ªç¬¦å·è¿æ¥åˆ™ä¸ºçœŸ&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>-k FILE&lt;/td>
&lt;td>å¦‚æœ FILE å­˜åœ¨ä¸”å·²ç»è®¾ç½®äº†ç²˜åˆ¶ä½åˆ™ä¸ºçœŸ&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>-p FILE&lt;/td>
&lt;td>å¦‚æœ FILE å­˜åœ¨ä¸”æ˜¯ä¸€ä¸ªåå­—ç®¡é“(Få¦‚æœO)åˆ™ä¸ºçœŸ&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>-r FILE&lt;/td>
&lt;td>å¦‚æœ FILE å­˜åœ¨ä¸”æ˜¯å¯è¯»çš„åˆ™ä¸ºçœŸ&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>-s FILE&lt;/td>
&lt;td>å¦‚æœ FILE å­˜åœ¨ä¸”å¤§å°ä¸ä¸º0åˆ™ä¸ºçœŸ&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>-t FD&lt;/td>
&lt;td>å¦‚æœæ–‡ä»¶æè¿°ç¬¦ FD æ‰“å¼€ä¸”æŒ‡å‘ä¸€ä¸ªç»ˆç«¯åˆ™ä¸ºçœŸ&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>-u FILE&lt;/td>
&lt;td>å¦‚æœ FILE å­˜åœ¨ä¸”è®¾ç½®äº†SUID (set user ID)åˆ™ä¸ºçœŸ&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>-w FILE&lt;/td>
&lt;td>å¦‚æœ FILE å¦‚æœ FILE å­˜åœ¨ä¸”æ˜¯å¯å†™çš„åˆ™ä¸ºçœŸ&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>-x FILE&lt;/td>
&lt;td>å¦‚æœ FILE å­˜åœ¨ä¸”æ˜¯å¯æ‰§è¡Œçš„åˆ™ä¸ºçœŸ&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>-O FILE&lt;/td>
&lt;td>å¦‚æœ FILE å­˜åœ¨ä¸”å±æœ‰æ•ˆç”¨æˆ·IDåˆ™ä¸ºçœŸ&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>-G FILE&lt;/td>
&lt;td>å¦‚æœ FILE å­˜åœ¨ä¸”å±æœ‰æ•ˆç”¨æˆ·ç»„åˆ™ä¸ºçœŸ&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>-L FILE&lt;/td>
&lt;td>å¦‚æœ FILE å­˜åœ¨ä¸”æ˜¯ä¸€ä¸ªç¬¦å·è¿æ¥åˆ™ä¸ºçœŸ&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>-S FILE&lt;/td>
&lt;td>å¦‚æœ FILE å­˜åœ¨ä¸”æ˜¯ä¸€ä¸ªå¥—æ¥å­—åˆ™ä¸ºçœŸ&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>FILE1 -ot FILE2&lt;/td>
&lt;td>å¦‚æœ FILE1 æ¯” FILE2 è¦è€, æˆ–è€… FILE2 å­˜åœ¨ä¸” FILE1 ä¸å­˜åœ¨åˆ™ä¸ºçœŸ&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>FILE1 -ef FILE2&lt;/td>
&lt;td>å¦‚æœ FILE1 å’Œ FILE2 æŒ‡å‘ç›¸åŒçš„è®¾å¤‡å’ŒèŠ‚ç‚¹å·åˆ™ä¸ºçœŸ&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>-o OPTIONNAME&lt;/td>
&lt;td>å¦‚æœ shellé€‰é¡¹ â€œOPTIONNAMEâ€ å¼€å¯åˆ™ä¸ºçœŸ&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table></description></item><item><title>goæ•°æ®åº“æŸ¥è¯¢ unsupported Scan</title><link>https://lqxhub.github.io/posts/5c491bc1/</link><pubDate>Sun, 21 Jun 2020 11:27:54 +0000</pubDate><guid>https://lqxhub.github.io/posts/5c491bc1/</guid><description>&lt;p>ä½¿ç”¨goæŸ¥è¯¢æ•°æ®åº“æ—¶ï¼Œæœ‰æ—¶å€™ä¼šé‡åˆ° **scan error sql: Scan error on column index XXXXX unsupported Scan, storing driver.Value type &lt;nil>**è¿™ä¸ªé”™è¯¯ï¼Œ&lt;/p>
&lt;p>è¿™ä¸ªé”™è¯¯äº§ç”Ÿçš„åŸå› æ˜¯ï¼ŒæŸ¥è¯¢çš„ç»“æœä¸­æœ‰çš„å€¼æ˜¯&lt;strong>NULL&lt;/strong> ï¼Œ å¯¼è‡´åœ¨è¯»æŸ¥è¯¢ç»“æœæ—¶ï¼Œé‡åˆ°&lt;strong>NUL&lt;/strong> ç±»å‹çš„æ•°å€¼ï¼Œæ— æ³•æ­£ç¡®è¯»å‡ºæ•°å€¼
ç°åœ¨é€šè¿‡ä¸€ä¸ªç®€å•çš„ä¾‹å­å¤ç°ä¸€ä¸‹
å…ˆåˆ›å»ºä¸€ä¸ªç®€å•çš„è¡¨&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-sql" data-lang="sql">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">CREATE&lt;/span> &lt;span style="color:#ff79c6">TABLE&lt;/span> &lt;span style="color:#ff79c6">`&lt;/span>&lt;span style="color:#ff79c6">user&lt;/span>&lt;span style="color:#ff79c6">`&lt;/span> (
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span> &lt;span style="color:#ff79c6">`&lt;/span>id&lt;span style="color:#ff79c6">`&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">int&lt;/span>(&lt;span style="color:#bd93f9">11&lt;/span>) &lt;span style="color:#ff79c6">NOT&lt;/span> &lt;span style="color:#ff79c6">NULL&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3&lt;/span>&lt;span> &lt;span style="color:#ff79c6">`&lt;/span>name&lt;span style="color:#ff79c6">`&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">varchar&lt;/span>(&lt;span style="color:#bd93f9">255&lt;/span>) &lt;span style="color:#ff79c6">DEFAULT&lt;/span> &lt;span style="color:#ff79c6">NULL&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4&lt;/span>&lt;span> &lt;span style="color:#ff79c6">PRIMARY&lt;/span> &lt;span style="color:#ff79c6">KEY&lt;/span> (&lt;span style="color:#ff79c6">`&lt;/span>id&lt;span style="color:#ff79c6">`&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5&lt;/span>&lt;span>) ENGINE&lt;span style="color:#ff79c6">=&lt;/span>InnoDB &lt;span style="color:#ff79c6">DEFAULT&lt;/span> CHARSET&lt;span style="color:#ff79c6">=&lt;/span>utf8;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å…¶ä¸­ &lt;code>name&lt;/code>è¿™ä¸ªå­—æ®µé»˜è®¤æ˜¯&lt;code>NULL&lt;/code> çš„ï¼Œç°åœ¨æ’å…¥å‡ æ¡æ•°æ®&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-sql" data-lang="sql">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span> &lt;span style="color:#ff79c6">insert&lt;/span> &lt;span style="color:#ff79c6">into&lt;/span> &lt;span style="color:#ff79c6">user&lt;/span>(&lt;span style="color:#ff79c6">`&lt;/span>id&lt;span style="color:#ff79c6">`&lt;/span>,&lt;span style="color:#ff79c6">`&lt;/span>name&lt;span style="color:#ff79c6">`&lt;/span>) &lt;span style="color:#ff79c6">values&lt;/span>(&lt;span style="color:#bd93f9">1&lt;/span>,&lt;span style="color:#f1fa8c">&amp;#39;A&amp;#39;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span> &lt;span style="color:#ff79c6">insert&lt;/span> &lt;span style="color:#ff79c6">into&lt;/span> &lt;span style="color:#ff79c6">user&lt;/span>(&lt;span style="color:#ff79c6">`&lt;/span>id&lt;span style="color:#ff79c6">`&lt;/span>,&lt;span style="color:#ff79c6">`&lt;/span>name&lt;span style="color:#ff79c6">`&lt;/span>) &lt;span style="color:#ff79c6">values&lt;/span>(&lt;span style="color:#bd93f9">2&lt;/span>,&lt;span style="color:#f1fa8c">&amp;#39;B&amp;#39;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3&lt;/span>&lt;span> &lt;span style="color:#ff79c6">insert&lt;/span> &lt;span style="color:#ff79c6">into&lt;/span> &lt;span style="color:#ff79c6">user&lt;/span>(&lt;span style="color:#ff79c6">`&lt;/span>id&lt;span style="color:#ff79c6">`&lt;/span>,&lt;span style="color:#ff79c6">`&lt;/span>name&lt;span style="color:#ff79c6">`&lt;/span>) &lt;span style="color:#ff79c6">values&lt;/span>(&lt;span style="color:#bd93f9">3&lt;/span>,&lt;span style="color:#ff79c6">NULL&lt;/span>);
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>goä»£ç &lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">package&lt;/span> main
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span>&lt;span style="color:#ff79c6">import&lt;/span> (
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span> &lt;span style="color:#f1fa8c">&amp;#34;database/sql&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span> &lt;span style="color:#f1fa8c">&amp;#34;fmt&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span> _ &lt;span style="color:#f1fa8c">&amp;#34;github.com/go-sql-driver/mysql&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">type&lt;/span> User &lt;span style="color:#8be9fd;font-style:italic">struct&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span> id &lt;span style="color:#8be9fd">uint32&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span> name &lt;span style="color:#8be9fd">string&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> &lt;span style="color:#50fa7b">main&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15&lt;/span>&lt;span> db &lt;span style="color:#ff79c6">:=&lt;/span> &lt;span style="color:#50fa7b">Conn&lt;/span>()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> db &lt;span style="color:#ff79c6">==&lt;/span> &lt;span style="color:#ff79c6">nil&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19&lt;/span>&lt;span> result &lt;span style="color:#ff79c6">:=&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">make&lt;/span>([]&lt;span style="color:#ff79c6">*&lt;/span>User, &lt;span style="color:#bd93f9">0&lt;/span>, &lt;span style="color:#bd93f9">10&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20&lt;/span>&lt;span> q &lt;span style="color:#ff79c6">:=&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;SELECT `id`, `name` FROM `user`&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> rows, err &lt;span style="color:#ff79c6">:=&lt;/span> db.&lt;span style="color:#50fa7b">Query&lt;/span>(q); err &lt;span style="color:#ff79c6">==&lt;/span> &lt;span style="color:#ff79c6">nil&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22&lt;/span>&lt;span> &lt;span style="color:#ff79c6">for&lt;/span> rows.&lt;span style="color:#50fa7b">Next&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23&lt;/span>&lt;span> id &lt;span style="color:#ff79c6">:=&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">uint32&lt;/span>(&lt;span style="color:#bd93f9">0&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24&lt;/span>&lt;span> name &lt;span style="color:#ff79c6">:=&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> err &lt;span style="color:#ff79c6">:=&lt;/span> rows.&lt;span style="color:#50fa7b">Scan&lt;/span>(&lt;span style="color:#ff79c6">&amp;amp;&lt;/span>id, &lt;span style="color:#ff79c6">&amp;amp;&lt;/span>name); err &lt;span style="color:#ff79c6">==&lt;/span> &lt;span style="color:#ff79c6">nil&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26&lt;/span>&lt;span> result = &lt;span style="color:#8be9fd;font-style:italic">append&lt;/span>(result, &lt;span style="color:#ff79c6">&amp;amp;&lt;/span>User{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27&lt;/span>&lt;span> id: id,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28&lt;/span>&lt;span> name: name,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29&lt;/span>&lt;span> })
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30&lt;/span>&lt;span> } &lt;span style="color:#ff79c6">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31&lt;/span>&lt;span> fmt.&lt;span style="color:#50fa7b">Println&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;rows scan error&amp;#34;&lt;/span>, err)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34&lt;/span>&lt;span> } &lt;span style="color:#ff79c6">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35&lt;/span>&lt;span> fmt.&lt;span style="color:#50fa7b">Println&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;query error&amp;#34;&lt;/span>, err)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37&lt;/span>&lt;span> &lt;span style="color:#ff79c6">for&lt;/span> _, v &lt;span style="color:#ff79c6">:=&lt;/span> &lt;span style="color:#ff79c6">range&lt;/span> result {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38&lt;/span>&lt;span> fmt.&lt;span style="color:#50fa7b">Println&lt;/span>(v)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> &lt;span style="color:#50fa7b">Conn&lt;/span>() &lt;span style="color:#ff79c6">*&lt;/span>sql.DB {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43&lt;/span>&lt;span> db, err &lt;span style="color:#ff79c6">:=&lt;/span> sql.&lt;span style="color:#50fa7b">Open&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;mysql&amp;#34;&lt;/span>, &lt;span style="color:#f1fa8c">&amp;#34;root:123456@tcp(127.0.0.1)/go_test&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> err &lt;span style="color:#ff79c6">!=&lt;/span> &lt;span style="color:#ff79c6">nil&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45&lt;/span>&lt;span> fmt.&lt;span style="color:#50fa7b">Print&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;sql open error&amp;#34;&lt;/span>, err)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> &lt;span style="color:#ff79c6">nil&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48&lt;/span>&lt;span> err2 &lt;span style="color:#ff79c6">:=&lt;/span> db.&lt;span style="color:#50fa7b">Ping&lt;/span>()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> err2 &lt;span style="color:#ff79c6">!=&lt;/span> &lt;span style="color:#ff79c6">nil&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50&lt;/span>&lt;span> fmt.&lt;span style="color:#50fa7b">Print&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;sql pin error&amp;#34;&lt;/span>, err2)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">51&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> &lt;span style="color:#ff79c6">nil&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">52&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">53&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> db
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">54&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿è¡Œåï¼ŒæŠ¥é”™
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-8520c816e78b89fe.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-8520c816e78b89fe.webp" alt="" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>è¿™ä¸ªé”™è¯¯æœ‰ä¸¤ç§è§£å†³åŠæ³•&lt;/p>
&lt;ol>
&lt;li>ä»æ•°æ®å±‚é¢è§£å†³ï¼ŒæŠŠ&lt;code>name&lt;/code>å­—æ®µè®¾ç½®ä¸ºéç©ºå­—æ®µï¼Œå¹¶ä¸”é»˜è®¤å€¼è®¾ç½®ä¸º**&amp;quot;&amp;quot;**ç©ºå­—ç¬¦ä¸²ï¼Œé—®é¢˜å°±è§£å†³äº†
æ”¹ä¸€ä¸‹è¡¨&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-sql" data-lang="sql">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">CREATE&lt;/span> &lt;span style="color:#ff79c6">TABLE&lt;/span> &lt;span style="color:#ff79c6">`&lt;/span>&lt;span style="color:#ff79c6">user&lt;/span>&lt;span style="color:#ff79c6">`&lt;/span> (
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span> &lt;span style="color:#ff79c6">`&lt;/span>id&lt;span style="color:#ff79c6">`&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">int&lt;/span>(&lt;span style="color:#bd93f9">11&lt;/span>) &lt;span style="color:#ff79c6">NOT&lt;/span> &lt;span style="color:#ff79c6">NULL&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3&lt;/span>&lt;span> &lt;span style="color:#ff79c6">`&lt;/span>name&lt;span style="color:#ff79c6">`&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">varchar&lt;/span>(&lt;span style="color:#bd93f9">255&lt;/span>) &lt;span style="color:#ff79c6">NOT&lt;/span> &lt;span style="color:#ff79c6">NULL&lt;/span> &lt;span style="color:#ff79c6">DEFAULT&lt;/span> &lt;span style="color:#f1fa8c">&amp;#39;&amp;#39;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4&lt;/span>&lt;span> &lt;span style="color:#ff79c6">PRIMARY&lt;/span> &lt;span style="color:#ff79c6">KEY&lt;/span> (&lt;span style="color:#ff79c6">`&lt;/span>id&lt;span style="color:#ff79c6">`&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5&lt;/span>&lt;span>) ENGINE&lt;span style="color:#ff79c6">=&lt;/span>InnoDB &lt;span style="color:#ff79c6">DEFAULT&lt;/span> CHARSET&lt;span style="color:#ff79c6">=&lt;/span>utf8;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æŸ¥è¯¢ç»“æœæ˜¯æ­£å¸¸çš„
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-3403681411e0e9a8.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-3403681411e0e9a8.webp" alt="" />
&lt;/a>
&lt;/div>
å¯¹äºä¸€äº›ç‰¹æ®Šçš„æŸ¥è¯¢ï¼Œç»“æœä¸­éš¾å…ä¼šæœ‰NULLå€¼ï¼Œæ¯”å¦‚è¿æ¥æŸ¥è¯¢ç­‰ç­‰ï¼Œè¿™æ—¶å€™éœ€è¦ç”¨ç¬¬äºŒç§æ–¹å¼æ¥è§£å†³
2. ä½¿ç”¨go æä¾›çš„ &lt;code>sql.NullString&lt;/code>ç±»å‹å€¼æ¥ç»“å±€ï¼Œè¿™ä¸ªæ˜¯&lt;code>string&lt;/code>ç±»å‹çš„ï¼Œ go è¿˜æä¾›äº†å…¶ä»–ç±»å‹çš„ï¼Œè¿˜æœ‰&lt;code>NullBool&lt;/code>boolç±»å‹çš„ï¼Œ&lt;code>NullFloat64&lt;/code>float64ç±»å‹çš„ï¼Œ&lt;code>NullInt64&lt;/code> int64ç±»å‹çš„&lt;/p>
&lt;p>ä¸ºäº†æ–¹ä¾¿ï¼Œè¿˜æ˜¯æŠŠè¡¨æ”¹å›æœ€å¼€å§‹ï¼Œ&lt;code>name&lt;/code>é»˜è®¤æ˜¯NULLç±»å‹çš„
ä¿®æ”¹ä¸€ä¸‹ä»£ç &lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span> result &lt;span style="color:#ff79c6">:=&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">make&lt;/span>([]&lt;span style="color:#ff79c6">*&lt;/span>User, &lt;span style="color:#bd93f9">0&lt;/span>, &lt;span style="color:#bd93f9">10&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span> q &lt;span style="color:#ff79c6">:=&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;SELECT `id`, `name` FROM `user`&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> rows, err &lt;span style="color:#ff79c6">:=&lt;/span> db.&lt;span style="color:#50fa7b">Query&lt;/span>(q); err &lt;span style="color:#ff79c6">==&lt;/span> &lt;span style="color:#ff79c6">nil&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span> &lt;span style="color:#ff79c6">for&lt;/span> rows.&lt;span style="color:#50fa7b">Next&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span> id &lt;span style="color:#ff79c6">:=&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">uint32&lt;/span>(&lt;span style="color:#bd93f9">0&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span> &lt;span style="color:#8be9fd;font-style:italic">var&lt;/span> name sql.NullString
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> err &lt;span style="color:#ff79c6">:=&lt;/span> rows.&lt;span style="color:#50fa7b">Scan&lt;/span>(&lt;span style="color:#ff79c6">&amp;amp;&lt;/span>id, &lt;span style="color:#ff79c6">&amp;amp;&lt;/span>name); err &lt;span style="color:#ff79c6">==&lt;/span> &lt;span style="color:#ff79c6">nil&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span> u &lt;span style="color:#ff79c6">:=&lt;/span> &lt;span style="color:#ff79c6">&amp;amp;&lt;/span>User{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span> id: id,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> name.Valid {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span> u.name = name.String
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span> } &lt;span style="color:#ff79c6">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span> u.name = &lt;span style="color:#f1fa8c">&amp;#34;&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16&lt;/span>&lt;span> result = &lt;span style="color:#8be9fd;font-style:italic">append&lt;/span>(result, u)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17&lt;/span>&lt;span> } &lt;span style="color:#ff79c6">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18&lt;/span>&lt;span> fmt.&lt;span style="color:#50fa7b">Println&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;rows scan error&amp;#34;&lt;/span>, err)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21&lt;/span>&lt;span> } &lt;span style="color:#ff79c6">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22&lt;/span>&lt;span> fmt.&lt;span style="color:#50fa7b">Println&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;query error&amp;#34;&lt;/span>, err)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æŠŠ &lt;strong>name&lt;/strong> çš„ç±»å‹æ”¹ä¸º &lt;code>sql.NullString&lt;/code> å¹¶ä¸”åœ¨æŸ¥è¯¢å®Œæˆåï¼Œåˆ¤æ–­ä¸€ä¸‹nameæ˜¯å¦æœ‰æ•ˆ&lt;/p>
&lt;p>çœ‹ä¸€ä¸‹ç»“æœ
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-769aaf949bb03f93.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-769aaf949bb03f93.webp" alt="" />
&lt;/a>
&lt;/div>
æ²¡æœ‰é—®é¢˜&lt;/p>
&lt;p>åˆ°è¿™é—®é¢˜è§£å†³äº†&lt;/p></description></item><item><title>é€šè¿‡æ±‡ç¼–çœ‹golangå‡½æ•°çš„å¤šè¿”å›å€¼</title><link>https://lqxhub.github.io/posts/1c1c3bd5/</link><pubDate>Sun, 21 Jun 2020 11:27:54 +0000</pubDate><guid>https://lqxhub.github.io/posts/1c1c3bd5/</guid><description>&lt;p>golangè¿™é—¨è¯­è¨€ï¼Œæœ‰ä¸ªæ¯”è¾ƒå¥½çš„ç‰¹æ€§ï¼Œå°±æ˜¯æ”¯æŒå‡½æ•°çš„å¤šè¿”å›å€¼ã€‚æƒ³Cï¼ŒC++ï¼ŒJavaç­‰è¿™äº›è¯­è¨€ï¼Œæ˜¯ä¸æ”¯æŒå‡½æ•°å¤šè¿”å›çš„ã€‚ä½†æ˜¯Cï¼ŒC++å¯ä»¥ä½¿ç”¨ä¼ é€’æŒ‡é’ˆï¼Œå®ç°å‡½æ•°å¤šè¿”å›ã€‚ä½†æ˜¯ï¼Œä½ æœ‰æ²¡æœ‰æƒ³è¿‡ï¼Œgolangæ˜¯æ€æ ·å®ç°å‡½æ•°å¤šè¿”å›å€¼çš„å‘¢ï¼Ÿ
æˆ‘ä»¬çŸ¥é“ï¼ŒCï¼ŒC++æ˜¯é€šè¿‡å¯„å­˜å™¨å®ç°å‡½æ•°è¿”å›å€¼çš„ï¼Œä¹Ÿå°±æ˜¯å…ˆæŠŠè¿”å›å€¼å†™å…¥åˆ°ä¸€ä¸ªå¯„å­˜å™¨ä¸­ï¼Œç„¶åå†ä»å¯„å­˜å™¨ä¸­ï¼Œè¯»åˆ°å‡½æ•°çš„è¿”å›å€¼ã€‚golangä¹Ÿæ˜¯è¿™æ ·å®ç°çš„å—ï¼Ÿ&lt;/p>
&lt;blockquote>
&lt;p>ä¼Ÿå¤§çš„æ€æƒ³å®¶å­”å­æ›¾è¯´è¿‡ï¼Œåœ¨æºç é¢å‰ä¸€åˆ‡éƒ½å¦‚åŒè£¸å¥”ã€‚åæ¥ï¼Œé²è¿…å…ˆç”Ÿï¼Œæ€»ç»“äº†å­”å­çš„æ€æƒ³ï¼Œè¯´å‡ºäº†ï¼Œåœ¨æ±‡ç¼–é¢å‰ï¼Œä¸€åˆ‡è¯­æ³•éƒ½æ˜¯çº¸è€è™ã€‚&lt;/p>
&lt;/blockquote>
&lt;p>ä¸‹é¢æˆ‘ä»¬é€šè¿‡golangçš„æ±‡ç¼–æŒ‡ä»¤ï¼Œæ¥çœ‹ä¸€ä¸‹golangæ˜¯æ€æ ·å®ç°å‡½æ•°çš„å¤šè¿”å›å€¼çš„&lt;/p>
&lt;p>åœ¨çœ‹æ±‡ç¼–ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆç”¨goçš„&lt;strong>debug&lt;/strong>å‡½æ•°çœ‹ä¸‹å‡½æ•°çš„æ ˆä¿¡æ¯
ä»£ç å¾ˆç®€å•ï¼Œä¸ç”¨è§£é‡Šäº†&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">package&lt;/span> main
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span>&lt;span style="color:#ff79c6">import&lt;/span> (
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span> &lt;span style="color:#f1fa8c">&amp;#34;fmt&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span> &lt;span style="color:#f1fa8c">&amp;#34;runtime/debug&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> &lt;span style="color:#50fa7b">main&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span> &lt;span style="color:#50fa7b">one&lt;/span>(&lt;span style="color:#bd93f9">3&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> &lt;span style="color:#50fa7b">one&lt;/span>(a &lt;span style="color:#8be9fd">int&lt;/span>) (&lt;span style="color:#8be9fd">int&lt;/span>, &lt;span style="color:#8be9fd">int&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span> fmt.&lt;span style="color:#50fa7b">Println&lt;/span>(&lt;span style="color:#8be9fd;font-style:italic">string&lt;/span>(debug.&lt;span style="color:#50fa7b">Stack&lt;/span>()))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> a, a &lt;span style="color:#ff79c6">+&lt;/span> &lt;span style="color:#bd93f9">5&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-6c8bd3d9a25a2dd4.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-6c8bd3d9a25a2dd4.webp" alt="" />
&lt;/a>
&lt;/div>
æˆ‘æ ‡çº¢çš„è¿™ä¸€è¡Œï¼Œå°±æ˜¯&lt;strong>one&lt;/strong> å‡½æ•°çš„æ ˆä¿¡æ¯ï¼Œç¬¬ä¸€ä¸ªå‚æ•° &lt;strong>0x3&lt;/strong> å¾ˆå¥½ç†è§£ï¼Œå°±æ˜¯æˆ‘ä»¬ä¼ å…¥çš„å‚æ•°&lt;strong>3&lt;/strong>ï¼Œ ä½†æ˜¯åé¢è¿™ä¸¤ä¸ªæ˜¯å•¥ï¼Ÿè¿˜æœ‰ï¼Œæˆ‘æ˜æ˜åªä¼ äº†ä¸€ä¸ªå‚æ•°ï¼Œä¸ºå•¥ä¼šä¼ å…¥ä¸‰ä¸ªå‚æ•°ï¼Ÿ&lt;/p>
&lt;p>åˆ°è¿™é‡Œï¼Œæˆ‘ä¹Ÿå°±ä¸å–å…³å­äº†ï¼Œç›´æ¥è¯´äº†ï¼Œåé¢è¿™ä¸¤ä¸ªå‚æ•°ï¼Œå°±æ˜¯oneå‡½æ•°è¿”å›å€¼çš„åœ°å€ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œoneå‡½æ•°è¿”å›å€¼åœ°å€ä¸åœ¨oneå‡½æ•°ä¸­ï¼Œè€Œæ˜¯åœ¨è°ƒç”¨oneå‡½æ•°çš„mianå‡½æ•°ä¸­ã€‚golangçš„å‡½æ•°è¿”å›å€¼ï¼Œå’ŒCï¼ŒC++çš„ä¸åŒï¼Œgolangçš„è¿”å›å€¼æ˜¯é€šè¿‡æ ˆå†…åœ°å€å®ç°çš„ï¼ˆè¿”å›å€¼çš„åœ°å€æ˜¯ç”±å‡½æ•°è°ƒç”¨è€…æä¾›ï¼‰ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">package&lt;/span> main
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> &lt;span style="color:#50fa7b">main&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4&lt;/span>&lt;span> &lt;span style="color:#8be9fd;font-style:italic">var&lt;/span> b, c &lt;span style="color:#ff79c6">*&lt;/span>&lt;span style="color:#8be9fd">int&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5&lt;/span>&lt;span> &lt;span style="color:#50fa7b">one&lt;/span>(&lt;span style="color:#bd93f9">3&lt;/span>, b, c)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> &lt;span style="color:#50fa7b">one&lt;/span>(a &lt;span style="color:#8be9fd">int&lt;/span>, b, c &lt;span style="color:#ff79c6">*&lt;/span>&lt;span style="color:#8be9fd">int&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">9&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä¹Ÿå°±æ˜¯è¯´ï¼Œåˆšå¼€å§‹çš„é‚£æ®µä»£ç ï¼Œå’Œè¿™æ®µåœ¨åŠŸèƒ½å®ç°ä¸Šï¼Œæ²¡æœ‰ä»€ä¹ˆå·®åˆ«ï¼Œåªæ˜¯golangç¼–è¯‘å™¨æä¾›çš„ä¸€ä¸ªè¯­æ³•ç³–ã€‚&lt;/p>
&lt;p>ä¸‹é¢é€šè¿‡æ±‡ç¼–æ¥çœ‹ä¸€ä¸‹
è¿™æ¬¡æˆ‘ä»¬ä¸æ˜¯å¯¹æ·±å…¥åˆ†ægolangçš„æ±‡ç¼–ï¼Œåªæ˜¯ä»æ±‡ç¼–å±‚é¢ï¼ŒéªŒè¯æˆ‘ä»¬ä¹‹å‰ç»“è®ºï¼ˆgolangå‡½æ•°å¤šè¿”å›é—®é¢˜ï¼‰
æ‰€ä»¥ï¼Œä¸ä¼šæ­»ç£•plan9æ±‡ç¼–è¯­æ³•ï¼Œè¯´å®è¯ï¼Œplan9çš„å¾ˆå¤šçŸ¥è¯†æˆ‘ä¹Ÿä¸æ‡‚ï¼Œå¤§å­¦æ²¡å¼€è¿‡æ±‡ç¼–çš„è¯¾ç¨‹ï¼Œè¿™äº›ä¸œè¥¿éƒ½æ˜¯å› ä¸ºå…´è¶£è‡ªå­¦çš„ã€‚&lt;/p>
&lt;p>golangç”¨çš„æ˜¯plan9æ±‡ç¼–ï¼Œçœ‹plan9ä¹‹å‰ï¼Œå…ˆäº†è§£ä¸€ä¸‹plan9çš„å‡ ä¸ªæ¦‚å¿µ&lt;/p>
&lt;p>goæ±‡ç¼–ä¸­æœ‰4ä¸ªä¼ªå¯„å­˜å™¨&lt;/p>
&lt;ul>
&lt;li>FP: Frame pointerï¼ŒæŒ‡å‘æ ˆåº•ä½ç½®ï¼Œä¸€èˆ¬ç”¨æ¥å¼•ç”¨å‡½æ•°çš„è¾“å…¥å‚æ•°ï¼Œç”¨æ¥è®¿é—®å‡½æ•°çš„å‚æ•°&lt;/li>
&lt;li>PC: Program counter: ç¨‹åºè®¡æ•°å™¨ï¼Œç”¨äºåˆ†æ”¯å’Œè·³è½¬&lt;/li>
&lt;li>SB: Static base pointer: ä¸€èˆ¬ç”¨äºå£°æ˜å‡½æ•°æˆ–è€…å…¨å±€å˜é‡&lt;/li>
&lt;li>SP: Stack pointerï¼šæŒ‡å‘å½“å‰æ ˆå¸§çš„å±€éƒ¨å˜é‡çš„å¼€å§‹ä½ç½®(æ ˆé¡¶ä½ç½®)ï¼Œä¸€èˆ¬ç”¨æ¥å¼•ç”¨å‡½æ•°çš„å±€éƒ¨å˜é‡&lt;/li>
&lt;/ul>
&lt;p>æˆ‘ä»¬ç”¨è¿™æ®µä»£ç è¿›è¡Œæ±‡ç¼–&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">package&lt;/span> main
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> &lt;span style="color:#50fa7b">main&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4&lt;/span>&lt;span> &lt;span style="color:#50fa7b">one&lt;/span>(&lt;span style="color:#bd93f9">3&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> &lt;span style="color:#50fa7b">one&lt;/span>(a &lt;span style="color:#8be9fd">int&lt;/span>) (&lt;span style="color:#8be9fd">int&lt;/span>, &lt;span style="color:#8be9fd">int&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> a, a &lt;span style="color:#ff79c6">+&lt;/span> &lt;span style="color:#bd93f9">5&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">9&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä½¿ç”¨ &lt;code>go tool compile -N -l -S main.go &lt;/code> å¾—åˆ°æ±‡ç¼–ä»£ç &lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-asm" data-lang="asm">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&amp;#34;&amp;#34;&lt;span style="color:#50fa7b">.main&lt;/span> STEXT nosplit size=&lt;span style="color:#bd93f9">2&lt;/span> args=&lt;span style="color:#bd93f9">0x0&lt;/span> locals=&lt;span style="color:#bd93f9">0x0&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span> 0&lt;span style="color:#50fa7b">x0000&lt;/span> &lt;span style="color:#bd93f9">00000&lt;/span> (C:\Users\bruce\Desktop\go\main.go:&lt;span style="color:#bd93f9">3&lt;/span>) TEXT &amp;#34;&amp;#34;.main(SB), NOSPLIT|ABIInternal, $0-0
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span> 0&lt;span style="color:#50fa7b">x0000&lt;/span> &lt;span style="color:#bd93f9">00000&lt;/span> (C:\Users\bruce\Desktop\go\main.go:&lt;span style="color:#bd93f9">3&lt;/span>) FUNCDATA $0, gclocalsÂ·&lt;span style="color:#bd93f9">33&lt;/span>cdeccccebe80329f1fdbee7f5874cb(SB)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span> 0&lt;span style="color:#50fa7b">x0000&lt;/span> &lt;span style="color:#bd93f9">00000&lt;/span> (C:\Users\bruce\Desktop\go\main.go:&lt;span style="color:#bd93f9">3&lt;/span>) FUNCDATA $1, gclocalsÂ·&lt;span style="color:#bd93f9">33&lt;/span>cdeccccebe80329f1fdbee7f5874cb(SB)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span> 0&lt;span style="color:#50fa7b">x0000&lt;/span> &lt;span style="color:#bd93f9">00000&lt;/span> (C:\Users\bruce\Desktop\go\main.go:&lt;span style="color:#bd93f9">3&lt;/span>) FUNCDATA $3, gclocalsÂ·&lt;span style="color:#bd93f9">33&lt;/span>cdeccccebe80329f1fdbee7f5874cb(SB)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span> 0&lt;span style="color:#50fa7b">x0000&lt;/span> &lt;span style="color:#bd93f9">00000&lt;/span> (C:\Users\bruce\Desktop\go\main.go:&lt;span style="color:#bd93f9">4&lt;/span>) PCDATA $2, $0
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span> 0&lt;span style="color:#50fa7b">x0000&lt;/span> &lt;span style="color:#bd93f9">00000&lt;/span> (C:\Users\bruce\Desktop\go\main.go:&lt;span style="color:#bd93f9">4&lt;/span>) PCDATA $0, $0
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span> 0&lt;span style="color:#50fa7b">x0000&lt;/span> &lt;span style="color:#bd93f9">00000&lt;/span> (C:\Users\bruce\Desktop\go\main.go:&lt;span style="color:#bd93f9">4&lt;/span>) XCHGL AX, AX
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span> 0&lt;span style="color:#50fa7b">x0001&lt;/span> &lt;span style="color:#bd93f9">00001&lt;/span> (&amp;lt;unknown line number&amp;gt;) RET
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span> 0&lt;span style="color:#50fa7b">x0000&lt;/span> &lt;span style="color:#bd93f9">90&lt;/span> c3 ..
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span>&amp;#34;&amp;#34;&lt;span style="color:#50fa7b">.one&lt;/span> STEXT nosplit size=&lt;span style="color:#bd93f9">20&lt;/span> args=&lt;span style="color:#bd93f9">0x18&lt;/span> locals=&lt;span style="color:#bd93f9">0x0&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span> 0&lt;span style="color:#50fa7b">x0000&lt;/span> &lt;span style="color:#bd93f9">00000&lt;/span> (C:\Users\bruce\Desktop\go\main.go:&lt;span style="color:#bd93f9">7&lt;/span>) TEXT &amp;#34;&amp;#34;.one(SB), NOSPLIT|ABIInternal, $0-24
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span> 0&lt;span style="color:#50fa7b">x0000&lt;/span> &lt;span style="color:#bd93f9">00000&lt;/span> (C:\Users\bruce\Desktop\go\main.go:&lt;span style="color:#bd93f9">7&lt;/span>) FUNCDATA $0, gclocalsÂ·&lt;span style="color:#bd93f9">33&lt;/span>cdeccccebe80329f1fdbee7f5874cb(SB)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span> 0&lt;span style="color:#50fa7b">x0000&lt;/span> &lt;span style="color:#bd93f9">00000&lt;/span> (C:\Users\bruce\Desktop\go\main.go:&lt;span style="color:#bd93f9">7&lt;/span>) FUNCDATA $1, gclocalsÂ·&lt;span style="color:#bd93f9">33&lt;/span>cdeccccebe80329f1fdbee7f5874cb(SB)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15&lt;/span>&lt;span> 0&lt;span style="color:#50fa7b">x0000&lt;/span> &lt;span style="color:#bd93f9">00000&lt;/span> (C:\Users\bruce\Desktop\go\main.go:&lt;span style="color:#bd93f9">7&lt;/span>) FUNCDATA $3, gclocalsÂ·&lt;span style="color:#bd93f9">33&lt;/span>cdeccccebe80329f1fdbee7f5874cb(SB)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16&lt;/span>&lt;span> 0&lt;span style="color:#50fa7b">x0000&lt;/span> &lt;span style="color:#bd93f9">00000&lt;/span> (C:\Users\bruce\Desktop\go\main.go:&lt;span style="color:#bd93f9">8&lt;/span>) PCDATA $2, $0
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17&lt;/span>&lt;span> 0&lt;span style="color:#50fa7b">x0000&lt;/span> &lt;span style="color:#bd93f9">00000&lt;/span> (C:\Users\bruce\Desktop\go\main.go:&lt;span style="color:#bd93f9">8&lt;/span>) PCDATA $0, $0
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18&lt;/span>&lt;span> 0&lt;span style="color:#50fa7b">x0000&lt;/span> &lt;span style="color:#bd93f9">00000&lt;/span> (C:\Users\bruce\Desktop\go\main.go:&lt;span style="color:#bd93f9">8&lt;/span>) MOVQ &amp;#34;&amp;#34;.a+&lt;span style="color:#bd93f9">8&lt;/span>(SP), AX
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19&lt;/span>&lt;span> 0&lt;span style="color:#50fa7b">x0005&lt;/span> &lt;span style="color:#bd93f9">00005&lt;/span> (C:\Users\bruce\Desktop\go\main.go:&lt;span style="color:#bd93f9">8&lt;/span>) MOVQ AX, &amp;#34;&amp;#34;.~r1+&lt;span style="color:#bd93f9">16&lt;/span>(SP)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20&lt;/span>&lt;span> 0&lt;span style="color:#50fa7b">x000a&lt;/span> &lt;span style="color:#bd93f9">00010&lt;/span> (C:\Users\bruce\Desktop\go\main.go:&lt;span style="color:#bd93f9">8&lt;/span>) ADDQ $5, AX
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21&lt;/span>&lt;span> 0&lt;span style="color:#50fa7b">x000e&lt;/span> &lt;span style="color:#bd93f9">00014&lt;/span> (C:\Users\bruce\Desktop\go\main.go:&lt;span style="color:#bd93f9">8&lt;/span>) MOVQ AX, &amp;#34;&amp;#34;.~r2+&lt;span style="color:#bd93f9">24&lt;/span>(SP)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22&lt;/span>&lt;span> 0&lt;span style="color:#50fa7b">x0013&lt;/span> &lt;span style="color:#bd93f9">00019&lt;/span> (C:\Users\bruce\Desktop\go\main.go:&lt;span style="color:#bd93f9">8&lt;/span>) RET
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23&lt;/span>&lt;span> 0&lt;span style="color:#50fa7b">x0000&lt;/span> &lt;span style="color:#bd93f9">48&lt;/span> &lt;span style="color:#bd93f9">8&lt;/span>b &lt;span style="color:#bd93f9">44&lt;/span> &lt;span style="color:#bd93f9">24&lt;/span> &lt;span style="color:#bd93f9">08&lt;/span> &lt;span style="color:#bd93f9">48&lt;/span> &lt;span style="color:#bd93f9">89&lt;/span> &lt;span style="color:#bd93f9">44&lt;/span> &lt;span style="color:#bd93f9">24&lt;/span> &lt;span style="color:#bd93f9">10&lt;/span> &lt;span style="color:#bd93f9">48&lt;/span> &lt;span style="color:#bd93f9">83&lt;/span> c0 &lt;span style="color:#bd93f9">05&lt;/span> &lt;span style="color:#bd93f9">48&lt;/span> &lt;span style="color:#bd93f9">89&lt;/span> H.D$.H.D$.H...H.
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24&lt;/span>&lt;span> 0&lt;span style="color:#50fa7b">x0010&lt;/span> &lt;span style="color:#bd93f9">44&lt;/span> &lt;span style="color:#bd93f9">24&lt;/span> &lt;span style="color:#bd93f9">18&lt;/span> c3 D$..
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æˆ‘åªæˆªå–äº†å’Œmainï¼Œoneå‡½æ•°ç›¸å…³çš„éƒ¨åˆ†
&lt;code>TEXT &amp;quot;&amp;quot;.one(SB), NOSPLIT|ABIInternal, $0-24&lt;/code>è¿™è¡Œæœ€åï¼Œ &lt;strong>$0-24&lt;/strong> çš„å«ä¹‰ï¼Œ0ä»£è¡¨oneå‡½æ•°çš„æ ˆå¸§å¤§å°(å±€éƒ¨å˜é‡+å¯èƒ½éœ€è¦çš„é¢å¤–è°ƒç”¨å‡½æ•°çš„å‚æ•°ç©ºé—´çš„æ€»å¤§å°)ï¼Œ
å› ä¸ºoneå‡½æ•°ä¸­æ²¡æœ‰é¢å¤–å¼€é”€ï¼Œæ‰€æœ‰å¤§å°æ˜¯0ï¼Œ24æ˜¯ä¼ å…¥å‚æ•°å’Œè¿”å›å€¼çš„å¤§å°ï¼Œå•ä½æ˜¯å­—èŠ‚ã€‚ä¼ å…¥çš„å‚æ•°å’Œè¿”å›å€¼éƒ½æ˜¯&lt;strong>int&lt;/strong>ï¼Œåœ¨64ä½æœºå™¨ä¸Šï¼Œå¤§å°æ˜¯8ä¸ªå­—èŠ‚ï¼Œ64ä½ã€‚&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-786702857f8ab1b9.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-786702857f8ab1b9.webp" alt="" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>ç®€å•ç”»ä¸€ä¸‹æ ˆçš„ç¤ºæ„å›¾&lt;/p>
&lt;p>çœ‹ä¸€ä¸‹è¿™å¥ &lt;code>0x0000 00000 (C:\Users\bruce\Desktop\go\main.go:8) MOVQ &amp;quot;&amp;quot;.a+8(SP), AX&lt;/code>&lt;/p>
&lt;p>&lt;strong>SP&lt;/strong> å¯„å­˜å™¨æŒ‡å‘çš„æ˜¯æ ˆé¡¶çš„ä½ç½®ï¼Œ&lt;strong>AX&lt;/strong> æ˜¯ä¸€ä¸ªé€šç”¨å¯„å­˜å™¨
&lt;strong>MOVQ&lt;/strong> æŒ‡ä»¤ æŠŠ å‚æ•°a ä¹Ÿå°±æ˜¯(SP+8)çš„å€¼æ¬åˆ°AXä¸­&lt;/p>
&lt;hr>
&lt;p>&lt;code> 0x0005 00005 (C:\Users\bruce\Desktop\go\main.go:8) MOVQ AX, &amp;quot;&amp;quot;.~r1+16(SP)&lt;/code>&lt;/p>
&lt;p>åŒæ ·ï¼ŒæŠŠAXä¸­çš„å€¼æ¬åˆ°r1ï¼ˆè¿”å›å€¼bï¼‰&lt;/p>
&lt;hr>
&lt;p>&lt;code>0x000a 00010 (C:\Users\bruce\Desktop\go\main.go:8) ADDQ $5, AX&lt;/code>
&lt;strong>ADDQ&lt;/strong>æŒ‡ä»¤æŠŠAXå€¼+5&lt;/p>
&lt;p>&lt;code> 0x000e 00014 (C:\Users\bruce\Desktop\go\main.go:8) MOVQ AX, &amp;quot;&amp;quot;.~r2+24(SP)&lt;/code>
æœ€åæŠŠAXçš„å€¼æ¬åˆ°r2(è¿”å›å€¼c)&lt;/p>
&lt;p>&lt;code> 0x0013 00019 (C:\Users\bruce\Desktop\go\main.go:8) RET&lt;/code>
æœ€åRETæŒ‡ä»¤ï¼Œoneå‡½æ•°ç»“æŸ&lt;/p>
&lt;p>&lt;strong>æ€»ç»“&lt;/strong>&lt;/p>
&lt;p>é€šè¿‡å¯¹golangè¿›è¡Œæ±‡ç¼–ï¼ŒçœŸå®äº†ä¹‹å‰çš„ç»“è®º&lt;/p>
&lt;p>&lt;strong>golangå‡½æ•°çš„å¤šè¿”å›å€¼ä¸æ˜¯é€šè¿‡å¯„å­˜å™¨ä¼ é€’ï¼Œä½¿ç”¨è¿‡ä½¿ç”¨è°ƒç”¨å€¼æä¾›çš„åœ°å€ï¼Œèµ‹å€¼å®ç°çš„&lt;/strong>&lt;/p>
&lt;p>å…ˆå†™è¿™äº›å§ï¼Œæˆ‘ä¹Ÿæ˜¯åˆšæ¥è§¦golangçš„æ±‡ç¼–ï¼Œæ–‡ä¸­å¦‚æœ‰ä¸æ­£ç¡®çš„åœ°æ–¹ï¼Œè¿˜è¯·åœ¨è¯„è®ºåŒºæŒ‡å‡º&lt;/p></description></item><item><title>ansible åœ¨å‚æ•°ä¸­ä¼ å…¥å¯†ç </title><link>https://lqxhub.github.io/posts/f6596db0/</link><pubDate>Sat, 13 Jun 2020 17:06:53 +0000</pubDate><guid>https://lqxhub.github.io/posts/f6596db0/</guid><description>&lt;p>ansibleæ˜¯ä¸€ä¸ªåŸºäºpythonå¼€å‘è‡ªåŠ¨åŒ–çš„è¿ç»´å·¥å…·ï¼Œè¿™ä¸ªå·¥å…·å¼ºå¤§çš„åœ°æ–¹æ˜¯ï¼Œè¢«æ“ä½œçš„æœºå™¨ä¸Šä¸éœ€è¦å®‰è£…ä»»ä½•è½¯ä»¶ï¼Œåªéœ€è¦åœ¨å‘èµ·æ“ä½œçš„æœºå™¨ä¸Šå®‰è£…å°±å¯ä»¥ä½¿ç”¨äº†ã€‚
è€Œä¸”ansibleæ”¯æŒå¾ˆå¤šæ¨¡å—ï¼Œè¿˜å¯ä»¥åŸºäºansibleäºŒæ¬¡å¼€å‘ï¼Œæ·»åŠ è‡ªå·±çš„åŠŸèƒ½&lt;/p>
&lt;p>ansibleåŠŸèƒ½å’Œæ¨¡å—å¾ˆå¤šï¼Œè¿™æ¬¡æˆ‘ä»¬åªè®²å…¶ä¸­çš„ä¸€ä¸ªã€‚åœ¨å‘½ä»¤è¡Œä¸­ï¼Œç›´æ¥æŠŠè¦æ“ä½œä¸»æœºçš„ç”¨æˆ·åå’Œå¯†ç ä¼ å…¥ã€‚åˆ«çš„ä¸œè¥¿ç­‰ä»¥åæœ‰æ—¶é—´ä¼šç»§ç»­å†™çš„ï¼Œæ¯•ç«Ÿ996å¤ªç´¯äº†&lt;/p>
&lt;p>æ­£å¸¸ä½¿ç”¨ansibleä¸€èˆ¬éƒ½æ˜¯ åœ¨ &lt;code>/ect/ansible/hosts&lt;/code> ä¸­é…ç½®è¿œç¨‹ä¸»æœºçš„ç”¨æˆ·å’Œå¯†ç 
ä¸€èˆ¬å†™æ³•&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-fallback" data-lang="fallback">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>[test]
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span>one ansible_ssh_host=192.168.199.209 ansible_ssh_port=22 ansible_ssh_user=root ansible_ssh_pass=123456
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ç„¶åä½¿ç”¨å‘½ä»¤è¡Œ
&lt;code>ansible test -m ping&lt;/code>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-cfb7e759ab9cb508.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-cfb7e759ab9cb508.webp" alt="" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>çœ‹åˆ°æˆªå›¾ï¼Œè¯´æ˜å·²ç»pingé€šï¼Œè¯´æ˜é…ç½®æ˜¯æ²¡é—®é¢˜çš„&lt;/p>
&lt;p>æœ‰æ—¶å€™ï¼Œéœ€è¦å•ç‹¬æŒ‡å®šè¿æ¥ä¸€å°ä¸»æœºï¼Œæˆ–è€…åªæ˜¯ä¸´æ—¶è¿æ¥ä¸€æ¬¡ï¼Œè¿™æ—¶å€™æ²¡å¿…è¦åœ¨&lt;strong>hosts&lt;/strong>æ–‡ä»¶ä¸­é…ç½®ï¼Œå¯ä»¥ç›´æ¥åœ¨å‘½ä»¤è¡Œä¸­ä¼ å…¥ä¸»æœºipå’Œè¿æ¥ç”¨æˆ·åå’Œå¯†ç 
&lt;code>ansible all -i &amp;quot;192.168.199.209:22,&amp;quot; -m ping -e&amp;quot;ansible_user=root ansible_password=123456&amp;quot;&lt;/code>
&lt;strong>æ³¨æ„&lt;/strong>ï¼šipåé¢ä¸€å®šè¦æœ‰ä¸€ä¸ª&amp;quot;,&amp;quot;
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-e2301bcfad8e9e6a.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-e2301bcfad8e9e6a.webp" alt="" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>æˆªå›¾ä¸­ï¼Œè¯´æ˜æ²¡é—®é¢˜&lt;/p>
&lt;p>å¥½äº†å…ˆå†™è¿™äº›ï¼Œansibleæ¨¡å—è·Ÿå¤šï¼ŒåŠŸèƒ½å¾ˆå¤šã€‚å°¤å…¶æ˜¯playbookè¿™ä¸ªä¸œè¥¿ï¼Œæ›´æ˜¯ç‰›é€¼ï¼Œä»¥åæœ‰æ—¶é—´ç»§ç»­å†™&lt;/p></description></item><item><title>dockerå­¦ä¹ 3-æ‰“åŒ…ä¸€ä¸ªdockeré•œåƒ</title><link>https://lqxhub.github.io/posts/c3d3e563/</link><pubDate>Sun, 12 Apr 2020 21:24:55 +0000</pubDate><guid>https://lqxhub.github.io/posts/c3d3e563/</guid><description>&lt;p>ä¹‹å‰ä½¿ç”¨dockerå®‰è£…è¿‡mysqlï¼Œä½¿ç”¨çš„æ˜¯åˆ«äººåˆ¶ä½œå¥½çš„é•œåƒã€‚ä»Šå¤©ä½¿ç”¨Dockerfileè‡ªå·±æ‰“åŒ…ä¸€ä¸ªdockerçš„é•œåƒã€‚è¿™ä¸ªé•œåƒæ˜¯ä¸€ä¸ªwebçš„é•œåƒï¼Œä½¿ç”¨goç¼–å†™ã€‚&lt;/p>
&lt;p>goéå¸¸é€‚åˆç”¨æ¥å†™dockerçš„é•œåƒç¨‹åºï¼Œå› ä¸ºgoç¼–è¯‘åçš„äºŒè¿›åˆ¶ç¨‹åºä¸ä¾èµ–å¤–å¤–éƒ¨åº“ï¼ˆåˆ’é‡ç‚¹ï¼Œåé¢ä¼šç”¨åˆ°è¿™ä¸ªçŸ¥è¯†ç‚¹ï¼‰ï¼Œå¯ä»¥éå¸¸æ–¹ä¾¿çš„æ‰“åŒ…è¿›dockerä¸­ã€‚
è¿™æ¬¡æ‰“åŒ…é•œåƒä¼šç”¨åˆ°dockerçš„ç«¯å£æ˜ å°„å’Œç›®å½•æŒ‚è½½è¿™ä¸¤ä¸ªç‰¹æ€§ï¼Œåé¢ç”¨åˆ°ä¼šæŒ‡å‡º
æˆ‘çš„ç¼–è¯‘å’Œæ‰“åŒ…æ˜¯åœ¨linuxä¸­å®Œæˆçš„ï¼Œæ–‡ä¸­æ‰€æœ‰çš„ä»‹ç»éƒ½æ˜¯ä»¥linuxç³»ç»Ÿä¸ºåŸºç¡€&lt;/p>
&lt;p>å…ˆä¸Šwebç¨‹åºçš„ä»£ç &lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">package&lt;/span> main
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span>&lt;span style="color:#ff79c6">import&lt;/span> (
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span> &lt;span style="color:#f1fa8c">&amp;#34;net/http&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span> &lt;span style="color:#f1fa8c">&amp;#34;os&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span> &lt;span style="color:#f1fa8c">&amp;#34;strconv&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span> &lt;span style="color:#f1fa8c">&amp;#34;time&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">const&lt;/span> BASE_DIR = &lt;span style="color:#f1fa8c">&amp;#34;./data/&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> &lt;span style="color:#50fa7b">main&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span> http.&lt;span style="color:#50fa7b">HandleFunc&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;/&amp;#34;&lt;/span>, Hand)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span> http.&lt;span style="color:#50fa7b">ListenAndServe&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;0.0.0.0:8088&amp;#34;&lt;/span>, &lt;span style="color:#ff79c6">nil&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> &lt;span style="color:#50fa7b">Hand&lt;/span>(w http.ResponseWriter, r &lt;span style="color:#ff79c6">*&lt;/span>http.Request) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18&lt;/span>&lt;span> query &lt;span style="color:#ff79c6">:=&lt;/span> r.URL.&lt;span style="color:#50fa7b">Query&lt;/span>()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19&lt;/span>&lt;span> one &lt;span style="color:#ff79c6">:=&lt;/span> query.&lt;span style="color:#50fa7b">Get&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;one&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20&lt;/span>&lt;span> now &lt;span style="color:#ff79c6">:=&lt;/span> time.&lt;span style="color:#50fa7b">Now&lt;/span>().&lt;span style="color:#50fa7b">Unix&lt;/span>()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21&lt;/span>&lt;span> fileName &lt;span style="color:#ff79c6">:=&lt;/span> strconv.&lt;span style="color:#50fa7b">FormatInt&lt;/span>(now, &lt;span style="color:#bd93f9">10&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23&lt;/span>&lt;span> file, err &lt;span style="color:#ff79c6">:=&lt;/span> os.&lt;span style="color:#50fa7b">OpenFile&lt;/span>(BASE_DIR&lt;span style="color:#ff79c6">+&lt;/span>fileName&lt;span style="color:#ff79c6">+&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;.txt&amp;#34;&lt;/span>, os.O_RDWR|os.O_CREATE, &lt;span style="color:#bd93f9">0666&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> err &lt;span style="color:#ff79c6">==&lt;/span> &lt;span style="color:#ff79c6">nil&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25&lt;/span>&lt;span> file.&lt;span style="color:#50fa7b">WriteString&lt;/span>(one)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26&lt;/span>&lt;span> file.&lt;span style="color:#50fa7b">Close&lt;/span>()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27&lt;/span>&lt;span> w.&lt;span style="color:#50fa7b">Write&lt;/span>([]&lt;span style="color:#8be9fd;font-style:italic">byte&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;ok&amp;#34;&lt;/span>))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28&lt;/span>&lt;span> } &lt;span style="color:#ff79c6">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29&lt;/span>&lt;span> w.&lt;span style="color:#50fa7b">Write&lt;/span>([]&lt;span style="color:#8be9fd;font-style:italic">byte&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;open file error,&amp;#34;&lt;/span>))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30&lt;/span>&lt;span> w.&lt;span style="color:#50fa7b">Write&lt;/span>([]&lt;span style="color:#8be9fd;font-style:italic">byte&lt;/span>(err.&lt;span style="color:#50fa7b">Error&lt;/span>()))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ç®€å•è¯´ä¸€ä¸‹é€»è¾‘ï¼Œwebä¼šç›‘å¬ &lt;strong>8080&lt;/strong> ç«¯å£ï¼Œå½“æ”¶åˆ°å®¢æˆ·ç«¯çš„è¯·æ±‚æ—¶ï¼Œä¼šåœ¨å½“å‰ç›®å½•çš„ &lt;strong>/data/&lt;/strong> ä¸‹åˆ›å»ºä¸€ä¸ª &lt;strong>å½“å‰æ—¶é—´æˆ³.txt&lt;/strong> æ–‡ä»¶ï¼Œå¹¶æŠŠè·å–åˆ°çš„æ•°æ®å†™å…¥åˆ°æ–‡ä»¶ä¸­ï¼Œå¹¶æŠŠç»“æœè¿”å›åˆ°ç½‘é¡µä¸­&lt;/p>
&lt;p>å…ˆæŠŠä»£ç ç¼–è¯‘æˆå¯æ‰§è¡Œæ–‡ä»¶ï¼Œæ‰§è¡Œ &lt;code>go build -ldflags &amp;quot;-w -s&amp;quot; main.go&lt;/code>ï¼Œ&lt;strong>-ldflags &amp;ldquo;-w -s&amp;rdquo;&lt;/strong> è¿™ä¸ªå‚æ•°ä¼šè‡ªåŠ¨ä¼˜åŒ–ä»£ç ï¼Œè¿™æ ·ç¼–è¯‘å‡ºæ¥çš„å¯æ‰§è¡Œæ–‡ä»¶ä½“ç§¯ä¼šå˜å°ã€‚
å…ˆåœ¨æœ¬åœ°è¿è¡Œä¸€ä¸‹çœ‹ä¸€ä¸‹æ•ˆæœ&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-9938f7c1db83dfbb.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-9938f7c1db83dfbb.webp" alt="" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>æµè§ˆå™¨æ˜¾ç¤ºæ­£ç¡®ï¼Œå†çœ‹ä¸€ä¸‹dataç›®å½•ä¸‹æœ‰æ²¡æœ‰å¯¹åº”çš„æ–‡ä»¶&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-3842121ea1f16e26.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-3842121ea1f16e26.webp" alt="" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>æ–‡ä»¶ä¹Ÿæ­£å¸¸å†™å…¥äº†ï¼Œè¯´æ˜ç¨‹åºæ˜¯æ²¡æœ‰é—®é¢˜çš„&lt;/p>
&lt;p>ä¸‹é¢å¼€å§‹æ‰“åŒ…docker&lt;/p>
&lt;p>å¼€å§‹ç¼–å†™Dockerfileæ–‡ä»¶&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>FROM scratch
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span>WORKDIR /app
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span>VOLUME /app/data
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span>ADD main /app
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span>COPY data /app
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span>EXPOSE 8088
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span>CMD [&amp;#34;/app/main&amp;#34;]
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æ‰“åŒ…dockeré•œåƒéœ€è¦åœ¨ä¸€ä¸ªé•œåƒçš„åŸºç¡€ä¸Šæ‰“åŒ…ï¼Œ&lt;strong>scratch&lt;/strong>è¿™ä¸ªé•œåƒæ˜¯ä¸€ä¸ªå¾ˆç‰¹æ®Šçš„é•œåƒï¼Œæ˜¯ä¸€ä¸ªç©ºçš„é•œåƒï¼Œå¤§å°æ˜¯0ï¼Œè¿™æ ·æˆ‘ä»¬æ‰“åŒ…å‡ºæ¥çš„é•œåƒä¼šå¾ˆå°ï¼Œå¦‚æœä½¿ç”¨Ubuntuä½œä¸ºåŸºç¡€é•œåƒï¼Œæ‰“åŒ…å‡ºæ¥çš„é•œåƒä½“ç§¯ä¼šå¾ˆå¤§ï¼Œå› ä¸ºUbuntué•œåƒå°±è¦æœ‰60M+äº†ã€‚æ›´å¤šå…³äºscratchå¯ä»¥æŸ¥çœ‹&lt;a class="link" href="https://hub.docker.com/_/scratch?tab=description" target="_blank" rel="noopener"
>è¿™é‡Œ&lt;/a>ã€‚ ç”¨åˆ°çš„Dockerfileå‘½ä»¤&lt;/p>
&lt;ol>
&lt;li>&lt;strong>FROM&lt;/strong> æŒ‡å®šä»¥å“ªä¸ªé•œåƒä¸ºåŸºç¡€å¼€å§‹æ„å»ºé•œåƒ&lt;/li>
&lt;li>&lt;strong>WROKDIR&lt;/strong> æŒ‡å®šæˆ‘ä»¬dockerä¸­çš„å·¥ä½œç›®å½•ï¼Œå¦‚æœè¿™ä¸ªç›®å½•ä¸å­˜åœ¨ï¼Œä¼šè‡ªåŠ¨åˆ›å»º&lt;/li>
&lt;li>&lt;strong>VOLUME&lt;/strong> æŒ‡å®šå¯¹å¤–æ˜ å°„çš„ç›®å½•&lt;/li>
&lt;li>&lt;strong>ADD&lt;/strong> å°†æœ¬åœ°çš„æ–‡ä»¶æ·»åŠ åˆ°dockerä¸­&lt;/li>
&lt;li>&lt;strong>COPY&lt;/strong> å’ŒADDå‘½ä»¤ç›¸ä¼¼ä¹Ÿæ˜¯å°†æœ¬åœ°çš„æ–‡ä»¶æ·»åŠ åˆ°dockerä¸­&lt;/li>
&lt;li>&lt;strong>EXPOSE&lt;/strong> æŒ‡å®šå¯¹å¤–æ˜ å°„çš„ç«¯å£&lt;/li>
&lt;li>&lt;strong>CMD&lt;/strong> åœ¨dockerä¸­æ‰§è¡Œå‘½ä»¤ï¼Œå¦‚æœæœ‰å¤šä¸ªCMDï¼Œåªæœ‰æœ€æœ‰ä¸€ä¸ªç”Ÿæ•ˆ&lt;/li>
&lt;/ol>
&lt;p>åˆ«çš„å‘½ä»¤æ²¡ä»€ä¹ˆç‰¹æ®Šçš„ï¼Œç®€å•è¯´ä¸€ä¸‹&lt;strong>ADD&lt;/strong>å’Œ&lt;strong>COPY&lt;/strong>çš„åŒºåˆ«ï¼Œç›¸åŒç‚¹éƒ½æ˜¯è®²æ–‡ä»¶å¤åˆ¶åˆ°dockerä¸­ï¼Œä¸åŒçš„æ˜¯ADDå‘½ä»¤åŠŸèƒ½æ›´å¤šï¼Œå¦‚æœå¤åˆ¶åˆ°æ–‡ä»¶æ˜¯tarï¼Œzipç­‰å‹ç¼©æ–‡ä»¶æ—¶ï¼ŒADDå‘½ä»¤ä¼šè‡ªåŠ¨è§£å‹ç¼©ï¼ŒADDè¿˜å¯ä»¥ä»ç½‘ç»œä¸ŠåŠ è½½æ–‡ä»¶&lt;/p>
&lt;p>Dockerfileæ–‡ä»¶å†™å¥½äº†ï¼Œä¸‹ä¸€æ­¥å¼€å§‹æ„å»ºäº†
ä½¿ç”¨ &lt;code> docker build -t goweb .&lt;/code>å‘½ä»¤æ„å»º &lt;strong>goweb&lt;/strong> æ˜¯æŒ‡å®šæ„å»ºåé•œåƒçš„åå­—
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-da37547fb1d148db.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-da37547fb1d148db.webp" alt="build" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>æ²¡æœ‰æŠ¥é”™,è¯´æ˜æ„å»ºå®Œæˆ&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-acbc0c39546a18ea.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-acbc0c39546a18ea.webp" alt="" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>å¯ä»¥åœ¨æœ¬åœ°çš„é•œåƒä¸­çœ‹åˆ°åˆšæ‰æ„å»ºçš„é•œåƒäº†ï¼Œå¤§å°åªæœ‰5.4M&lt;/p>
&lt;p>æœ‰äº†é•œåƒå¼€å§‹åˆ›å»ºå®¹å™¨
ç°åœ¨ç”¨æˆ·ç›®å½•ä¸‹æ–°å»ºä¸€ä¸ª &lt;strong>go_web&lt;/strong> ç›®å½•
ä½¿ç”¨&lt;code>docker run -idt --name goweb -v ~/go_web:/app/data -p 8088:8088 goweb&lt;/code>å‘½ä»¤åˆ›å»ºå®¹å™¨
ä¹‹å‰çš„æ–‡ç« å·²ç»ä»‹ç»è¿‡äº†ï¼Œä¸åœ¨èµ˜è¿°äº†ï¼Œæ–‡ç«  &lt;a class="link" href="https://lqxhub.github.io/posts/dff1cc87/" >ä¼ é€é—¨&lt;/a>
çœ‹ä¸€ä¸‹å®¹å™¨çš„è¿è¡Œæƒ…å†µ&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-2631426b950c6825.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-2631426b950c6825.webp" alt="" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>whatï¼Œä¸ºå•¥å®¹å™¨é€€å‡ºäº†ï¼Œåº”è¯¥æ˜¯å‡ºé”™äº†ï¼Œçœ‹ä¸€ä¸‹é”™è¯¯&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-b4a39ec17c07d82c.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-b4a39ec17c07d82c.webp" alt="" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>è¿˜è®°å¾—å‰é¢ç”»çš„é‡ç‚¹å—ï¼Œgoç¼–è¯‘åçš„äºŒè¿›åˆ¶ç¨‹åºä¸ä¾èµ–å¤–å¤–éƒ¨åº“ï¼Œå…¶å®è¿™å¥è¯æ˜¯é”™è¯¯çš„
çœ‹ä¸€ä¸‹åˆšæ‰ç¼–è¯‘çš„ç¨‹åºä¾èµ–é‚£äº›å¤–éƒ¨åº“&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-c74257a003a08453.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-c74257a003a08453.webp" alt="" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>ç°åœ¨çš„mainæ–‡ä»¶ä¾èµ–4ä¸ªå¤–éƒ¨æ–‡ä»¶ï¼Œå› ä¸ºæˆ‘ä»¬æ˜¯åŸºäº&lt;strong>scratch&lt;/strong>æ‰“åŒ…çš„ï¼Œscratchæ˜¯ä¸€ä¸ªç©ºç™½çš„é•œåƒï¼Œæ²¡æœ‰è¿™äº›æ–‡ä»¶ï¼Œæ‰€ä»¥è¿è¡Œå°±æŠ¥é”™äº†ã€‚æœ‰ä¸¤ç§è§£å†³åŠæ³•&lt;/p>
&lt;ol>
&lt;li>ä½¿ç”¨Ubuntuç­‰æœ‰è¿™äº›åº“çš„åŸºç¡€é•œåƒï¼Œä½†æ˜¯è¿™æ ·ä¼šå¢åŠ æ‰“åŒ…åé•œåƒçš„ä½“ç§¯ï¼Œå¾ˆæ˜¾ç„¶ä¸åˆ’ç®—&lt;/li>
&lt;li>ä½¿ç”¨é™æ€ç¼–è¯‘ï¼ŒæŠŠè¿™äº›åº“ç¼–è¯‘è¿›mainæ–‡ä»¶ä¸­&lt;/li>
&lt;/ol>
&lt;p>é‡æ–°ç¼–è¯‘goæ–‡ä»¶
å…ˆæŠŠåŸæ¥çš„mainæ”¹ä¸€ä¸ªåå­—&lt;code>mv main main2&lt;/code>
é‡æ–°ç¼–è¯‘&lt;code>CGO_ENABLED=0 go build -ldflags &amp;quot;-w -s&amp;quot; main.go&lt;/code> &lt;strong>CGO_ENABLED=0&lt;/strong> æŒ‡å®šä¸ºé™æ€ç¼–è¯‘
ç°åœ¨çœ‹ä¸€ä¸‹mainçš„å¤–éƒ¨ä¾èµ–&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-d55296460cc8e327.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-d55296460cc8e327.webp" alt="" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>ç°åœ¨çš„mainä¸ä¾èµ–å¤–éƒ¨æ–‡ä»¶äº†
æŠŠä¹‹å‰çš„dockeré•œåƒå’Œå®¹å™¨éƒ½åˆ æ‰ï¼Œé‡æ–°æ‰“åŒ…dockerï¼Œé‡æ–°ç”Ÿæˆå®¹å™¨&lt;/p>
&lt;p>ç°åœ¨çœ‹ä¸€ä¸‹
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-ccd65dbbf05053cd.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-ccd65dbbf05053cd.webp" alt="" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>å®¹å™¨å·²ç»è¿è¡Œäº†ï¼Œå¹¶ä¸”å®Œæˆäº†ç«¯å£æ˜ å°„
åœ¨æµè§ˆå™¨ä¸­è¯•ä¸€ä¸‹&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-ee3636371f5eb43e.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-ee3636371f5eb43e.webp" alt="" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>çœ‹ä¸€ä¸‹&lt;strong>go_web&lt;/strong>ç›®å½•&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-3a7115fb870c33f9.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-3a7115fb870c33f9.webp" alt="" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>åœ¨go_webç›®å½•ä¸­å·²ç»åˆ›å»ºäº†æ–‡ä»¶ï¼Œå¹¶ä¸”å†…å®¹ä¹Ÿæ­£ç¡®å†™å…¥äº†&lt;/p>
&lt;p>åˆ°è¿™ï¼Œè‡ªå·±æ‰“åŒ…dockeré•œåƒå°±å®Œæˆäº†ã€‚&lt;/p></description></item><item><title>dockerå­¦ä¹ 2-dockeråŸºæœ¬å‘½ä»¤</title><link>https://lqxhub.github.io/posts/dff1cc87/</link><pubDate>Sat, 04 Apr 2020 18:03:39 +0000</pubDate><guid>https://lqxhub.github.io/posts/dff1cc87/</guid><description>&lt;p>æ“ä½œdockerå®¹å™¨ï¼Œå’Œæ“ä½œlinuxå·®ä¸å¤šï¼Œéƒ½æ˜¯ä½¿ç”¨å‘½ä»¤è¡Œæ“ä½œã€‚ä¸åŒçš„æ˜¯ï¼Œæ“ä½œdockeréœ€è¦ä½¿ç”¨dockerçš„å‘½ä»¤ã€‚dockerçš„å‘½ä»¤å’Œlinuxçš„å‘½ä»¤å¾ˆå¤šç›¸ä¼¼çš„ï¼Œä¹Ÿæœ‰ä¸€äº›ä¸åŒã€‚åºŸè¯ä¸å¤šè¯´ï¼Œå¼€å§‹å­¦ä¹ ã€‚dockerå‘½ä»¤åˆ†ä¸ºé•œåƒç›¸å…³ï¼Œå®¹å™¨ç”Ÿå‘½å‘¨æœŸç›¸å…³ï¼Œå®¹å™¨æ“ä½œç›¸å…³ï¼Œä»“åº“ç›¸å…³ç­‰ä¸€ç³»åˆ—å‘½ä»¤ã€‚æ˜¯ç”¨dockerå‘½ä»¤æ—¶ï¼Œå‰è¦åŠ ä¸Š &lt;strong>docker&lt;/strong> ï¼Œæ¯”å¦‚æŸ¥çœ‹dockerç‰ˆæœ¬ï¼Œåœ¨ç»ˆç«¯è¾“å…¥ &lt;code>docker version&lt;/code>&lt;/p>
&lt;h5 id="ç‰ˆæœ¬ç›¸å…³">&lt;a href="#%e7%89%88%e6%9c%ac%e7%9b%b8%e5%85%b3" class="header-anchor">&lt;/a>ç‰ˆæœ¬ç›¸å…³
&lt;/h5>&lt;ol>
&lt;li>
&lt;p>&lt;strong>version&lt;/strong> æŸ¥çœ‹dockerçš„ç‰ˆæœ¬ï¼Œèƒ½çœ‹åˆ°dockerçš„clientå’Œserverçš„ç‰ˆæœ¬
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-d96d5ffd0240b672.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-d96d5ffd0240b672.webp" alt="version" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>info&lt;/strong> æ˜¾ç¤º Docker ç³»ç»Ÿä¿¡æ¯ï¼ŒåŒ…æ‹¬é•œåƒå’Œå®¹å™¨æ•°ã€‚
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-a0e1bf22c4a18bf3.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-a0e1bf22c4a18bf3.webp" alt="info" />
&lt;/a>
&lt;/div>
å¯ä»¥çœ‹åˆ°ï¼Œæœ‰ä¸¤ä¸ªå®¹å™¨ï¼Œä¸€ä¸ªè¿è¡Œä¸­ä¸€ä¸ªåœæ­¢ã€‚æœ¬åœ°è¿˜æœ‰ä¸¤ä¸ªé•œåƒ&lt;/p>
&lt;/li>
&lt;/ol>
&lt;h5 id="æœ¬åœ°é•œåƒç›¸å…³æ“ä½œ">&lt;a href="#%e6%9c%ac%e5%9c%b0%e9%95%9c%e5%83%8f%e7%9b%b8%e5%85%b3%e6%93%8d%e4%bd%9c" class="header-anchor">&lt;/a>æœ¬åœ°é•œåƒç›¸å…³æ“ä½œ
&lt;/h5>&lt;ol>
&lt;li>
&lt;p>&lt;strong>images&lt;/strong> æŸ¥çœ‹æœ¬åœ°æ‰€æœ‰é•œåƒ
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-e3677fd94908cbda.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-e3677fd94908cbda.webp" alt="images" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>rmi&lt;/strong> åˆ é™¤æœ¬åœ°ä¸€ä¸ªæˆ–å¤šå°‘é•œåƒã€‚è¿™ä¸ªå‘½ä»¤å’Œlinuxçš„rmå‘½ä»¤å¾ˆåƒï¼Œå¯ä»¥ä½¿ç”¨ -f å¼ºåˆ¶åˆ é™¤&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>tag&lt;/strong> ä¸ºæœ¬åœ°é•œåƒæ‰“ä¸€ä¸ªæ ‡ç­¾ï¼Œå¯ä»¥ç†è§£ä¸ºé‡å‘½åã€‚
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-b542e6bc61eedf19.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-b542e6bc61eedf19.webp" alt="tag" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;/li>
&lt;/ol>
&lt;p>å¯ä»¥çœ‹åˆ°ï¼Œä½¿ç”¨tagå‘½ä»¤ç»™mysqlåŠ äº†ä¸€ä¸ªæ ‡ç­¾ï¼Œä¸¤ä¸ªé•œåƒçš„idæ˜¯ç›¸åŒçš„ï¼Œè¯´æ˜è¿˜æ˜¯åŒä¸€ä¸ªé•œåƒã€‚ä½¿ç”¨&lt;strong>rmi&lt;/strong>å‘½ä»¤åˆ é™¤ä¸€ä¸ªï¼Œå¦ä¸€ä¸ªä¸å—å½±å“ã€‚&lt;/p>
&lt;ol start="4">
&lt;li>
&lt;p>&lt;strong>build&lt;/strong> å‘½ä»¤ç”¨äºä½¿ç”¨ Dockerfile åˆ›å»ºé•œåƒã€‚è¿™ä¸ªå‘½ä»¤æ¯”è¾ƒå¤æ‚ï¼Œæœ‰å¾ˆå¤šå‚æ•°ï¼Œè€Œä¸”éœ€è¦é…åˆDockerfileæ–‡ä»¶ä½¿ç”¨&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>history&lt;/strong> æŸ¥çœ‹æŒ‡å®šé•œåƒçš„åˆ›å»ºå†å²ã€‚&lt;/p>
&lt;ul>
&lt;li>-H :ä»¥å¯è¯»çš„æ ¼å¼æ‰“å°é•œåƒå¤§å°å’Œæ—¥æœŸï¼Œé»˜è®¤ä¸ºtrueï¼›&lt;/li>
&lt;li>&amp;ndash;no-trunc :æ˜¾ç¤ºå®Œæ•´çš„æäº¤è®°å½•ï¼›&lt;/li>
&lt;li>-q :ä»…åˆ—å‡ºæäº¤è®°å½•IDã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>save&lt;/strong> å°†æœ¬åœ°çš„å®¹å™¨ä¿å­˜ä¸ºä¸€ä¸ªæ–‡ä»¶ã€‚
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-b8c020279ebd4860.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-b8c020279ebd4860.webp" alt="save" />
&lt;/a>
&lt;/div>
å·²ç»æŠŠæœ¬åœ°çš„redis é•œåƒä¿å­˜åˆ°äº†å½“å‰ç›®å½•&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>load&lt;/strong> å¯¼å…¥ä½¿ç”¨ &lt;strong>save&lt;/strong> å‘½ä»¤å¯¼å‡ºçš„é•œåƒã€‚
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-e53de37c06b88626.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-e53de37c06b88626.webp" alt="load" />
&lt;/a>
&lt;/div>
æˆ‘ä»¬å…ˆæŠŠæœ¬åœ°çš„redisé•œåƒåˆ é™¤ï¼Œå†é€šè¿‡loadå‘½ä»¤æŠŠåˆšæ‰å¯¼å‡ºçš„redisé•œåƒå†å¯¼å…¥&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>import&lt;/strong> ä¹Ÿæ˜¯ä»æœ¬åœ°æ–‡ä»¶å¯¼å…¥é•œåƒã€‚å’Œ&lt;strong>load&lt;/strong> ä¸åŒçš„æ˜¯ï¼Œ&lt;strong>import&lt;/strong> å‘½ä»¤éœ€è¦æŒ‡å®šå¯¼å…¥åçš„é•œåƒçš„nameå’Œtag
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-dee770184a3c63b6.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-dee770184a3c63b6.webp" alt="import" />
&lt;/a>
&lt;/div>
å…ˆæŠŠåŸæœ‰çš„redisé•œåƒåˆ æ‰ï¼Œå†ä½¿ç”¨&lt;strong>import&lt;/strong>å‘½åå¯¼å…¥é•œåƒï¼Œå¹¶æŒ‡å®šnameå’Œtagã€‚ä¸€èˆ¬&lt;strong>import&lt;/strong>å‘½ä»¤é…åˆ&lt;strong>export&lt;/strong>å‘½ä»¤ä½¿ç”¨&lt;/p>
&lt;/li>
&lt;/ol>
&lt;h5 id="å®¹å™¨ä»“åº“ç›¸å…³">&lt;a href="#%e5%ae%b9%e5%99%a8%e4%bb%93%e5%ba%93%e7%9b%b8%e5%85%b3" class="header-anchor">&lt;/a>å®¹å™¨ä»“åº“ç›¸å…³
&lt;/h5>&lt;ol>
&lt;li>
&lt;p>&lt;strong>search&lt;/strong> åœ¨è¿œç¨‹ä»“åº“ä¸­æœç´¢ç›¸å…³çš„é•œåƒã€‚
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-99bd8e282f018e1c.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-99bd8e282f018e1c.webp" alt="search" />
&lt;/a>
&lt;/div>
åœ¨è¿œç¨‹ä»“åº“ä¸­æœç´¢mysqlç›¸å…³çš„é•œåƒ&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>pull&lt;/strong> ä»è¿œç¨‹ä»“åº“æ‹‰å–é•œåƒåˆ°æœ¬åœ°ï¼Œæ¯”å¦‚æ‹‰å–mysqlå‘½ä»¤ï¼Œ &lt;code>docker pull mysql&lt;/code>&lt;/p>
&lt;/li>
&lt;/ol>
&lt;h5 id="å®¹å™¨ç”Ÿå‘½å‘¨æœŸç›¸å…³">&lt;a href="#%e5%ae%b9%e5%99%a8%e7%94%9f%e5%91%bd%e5%91%a8%e6%9c%9f%e7%9b%b8%e5%85%b3" class="header-anchor">&lt;/a>å®¹å™¨ç”Ÿå‘½å‘¨æœŸç›¸å…³
&lt;/h5>&lt;ol>
&lt;li>
&lt;p>&lt;strong>run&lt;/strong> åˆ›å»ºä¸€ä¸ªæ–°çš„å®¹å™¨å¹¶è¿è¡Œï¼›runå‘½ä»¤æœ‰å¾ˆå¤šå‚æ•°ï¼ŒæŒ‘å‡ ä¸ªå¸¸ç”¨çš„ä»‹ç»ä¸€ä¸ª&lt;/p>
&lt;ul>
&lt;li>-d: åå°è¿è¡Œå®¹å™¨ï¼Œå¹¶è¿”å›å®¹å™¨ID;&lt;/li>
&lt;li>-i: ä»¥äº¤äº’æ¨¡å¼è¿è¡Œå®¹å™¨ï¼Œé€šå¸¸ä¸ -t åŒæ—¶ä½¿ç”¨ï¼›&lt;/li>
&lt;li>-t: ä¸ºå®¹å™¨é‡æ–°åˆ†é…ä¸€ä¸ªä¼ªè¾“å…¥ç»ˆç«¯ï¼Œé€šå¸¸ä¸ -i åŒæ—¶ä½¿ç”¨ï¼›&lt;/li>
&lt;li>&amp;ndash;name=&amp;ldquo;nginx-lb&amp;rdquo;: ä¸ºå®¹å™¨æŒ‡å®šä¸€ä¸ªåç§°ï¼›æ³¨æ„è¿™ä¸ªå‰é¢æ˜¯ &lt;strong>&amp;ndash;&lt;/strong>&lt;/li>
&lt;li>-e: è®¾ç½®ç¯å¢ƒå˜é‡ï¼›åœ¨ç”¨dockerå¯åŠ¨mysqlçš„æ—¶å€™ï¼Œä¼šç”¨åˆ°ç¯å¢ƒå˜é‡è®¾ç½®mysqlçš„å¯†ç &lt;/li>
&lt;li>-P: éšæœºç«¯å£æ˜ å°„ï¼Œå®¹å™¨å†…éƒ¨ç«¯å£éšæœºæ˜ å°„åˆ°ä¸»æœºçš„é«˜ç«¯å£ï¼Œå¤§å†™çš„Pï¼›&lt;/li>
&lt;li>-p: æŒ‡å®šç«¯å£æ˜ å°„ï¼Œæ ¼å¼ä¸ºï¼šä¸»æœº(å®¿ä¸»)ç«¯å£:å®¹å™¨ç«¯å£ï¼›æ¯”å¦‚ä½¿ç”¨dockerè¿è¡Œnginxæ—¶ï¼Œå°†å®¹å™¨çš„nginx80ç«¯å£æ˜ å°„åˆ°ä¸»æœºçš„8080ç«¯å£ï¼›-p 8080:80&lt;/li>
&lt;li>-m :è®¾ç½®å®¹å™¨ä½¿ç”¨å†…å­˜æœ€å¤§å€¼ï¼›&lt;/li>
&lt;li>&amp;ndash;volume , -v: å°†ä¸»æœºä¸Šçš„ç›®å½•æŒ‚è½½åˆ°å®¹å™¨å†…ï¼›æ ¼å¼ä¸ºï¼šä¸»æœºç›®å½•:å®¹å™¨å†…çš„ç›®å½•
ä»¥è¿è¡Œmysqlä¸ºä¾‹ï¼Œ
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-481e52e6e6ba3d9d.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-481e52e6e6ba3d9d.webp" alt="run" />
&lt;/a>
&lt;/div>
è¿è¡Œä¸€ä¸ªmysqlå®¹å™¨ï¼Œé‡å‘½åä¸ºmy_mysqlï¼Œå°†å®¹å™¨çš„3306ç«¯å£æ˜ å°„åˆ°ä¸»æœºçš„3366ç«¯å£ï¼Œå¹¶å°†mysqlçš„å­˜å‚¨ç›®å½•*/var/lib/mysql* æŒ‚è½½åˆ°&lt;em>ç”¨æˆ·ç›®å½•çš„mysql_data&lt;/em>ç›®å½•ä¸‹&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>start&lt;/strong> å¯åŠ¨ä¸€ä¸ªå®¹å™¨ï¼Œå¯ä»¥ä½¿ç”¨å®¹å™¨çš„idä¹Ÿå¯ä»¥ä½¿ç”¨å®¹å™¨çš„name&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>stop&lt;/strong> åœæ­¢ä¸€ä¸ªå®¹å™¨&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>restart&lt;/strong> é‡å¯ä¸€ä¸ªå®¹å™¨&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>kill&lt;/strong> æ€æ­»ä¸€ä¸ªå®¹å™¨ï¼Œå’Œlinuxçš„killå‘½ä»¤å¾ˆåƒï¼Œå¯ä»¥ä½¿ç”¨å®¹å™¨çš„nameæ“ä½œ&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>pause&lt;/strong> æš‚åœå®¹å™¨ä¸­æ‰€æœ‰çš„è¿›ç¨‹ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>unpause&lt;/strong> æ¢å¤å®¹å™¨æš‚åœçš„è¿›ç¨‹ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>create&lt;/strong> åˆ›å»ºä¸€ä¸ªå®¹å™¨,ä½†æ˜¯ä¸å¯åŠ¨è¿™ä¸ªå®¹å™¨&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>exec&lt;/strong> åœ¨è¿è¡Œçš„å®¹å™¨ä¸­æ‰§è¡Œå‘½ä»¤ã€‚å¯ä»¥çœ‹åšæ˜¯è¿›å…¥åˆ°è¿™ä¸ªå®¹å™¨ä¸­ã€‚&lt;/p>
&lt;ul>
&lt;li>-d :åˆ†ç¦»æ¨¡å¼: åœ¨åå°è¿è¡Œ&lt;/li>
&lt;li>-i :é»˜è®¤æ‰“å¼€ï¼Œæ²¡æœ‰é™„åŠ ä¹Ÿä¿æŒSTDIN æ‰“å¼€&lt;/li>
&lt;li>-t :åˆ†é…ä¸€ä¸ªä¼ªç»ˆç«¯
ä½¿ç”¨å‘½ä»¤ &lt;code>docker exec -it redis&lt;/code> è¿›å…¥nameä¸ºredis çš„å®¹å™¨ä¸­&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ol>
&lt;h5 id="å®¹å™¨æ“ä½œç›¸å…³">&lt;a href="#%e5%ae%b9%e5%99%a8%e6%93%8d%e4%bd%9c%e7%9b%b8%e5%85%b3" class="header-anchor">&lt;/a>å®¹å™¨æ“ä½œç›¸å…³
&lt;/h5>&lt;ol>
&lt;li>
&lt;p>&lt;strong>ps&lt;/strong> åˆ—å‡ºå½“å‰æœºå™¨ä¸Šçš„å®¹å™¨&lt;/p>
&lt;ul>
&lt;li>-a:åˆ—å‡ºæ‰€æœ‰çš„å®¹å™¨ï¼ŒåŒ…æ‹¬æ²¡æœ‰è¿è¡Œçš„å®¹å™¨&lt;/li>
&lt;li>-f :æ ¹æ®æ¡ä»¶è¿‡æ»¤æ˜¾ç¤ºçš„å†…å®¹&lt;/li>
&lt;li>-n :åˆ—å‡ºæœ€è¿‘åˆ›å»ºçš„nä¸ªå®¹å™¨&lt;/li>
&lt;li>-q :é™é»˜æ¨¡å¼ï¼Œåªæ˜¾ç¤ºå®¹å™¨ç¼–å·&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>top&lt;/strong> æŸ¥çœ‹å®¹å™¨ä¸­è¿è¡Œçš„è¿›ç¨‹ä¿¡æ¯ï¼Œæ”¯æŒ ps å‘½ä»¤å‚æ•°ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>logs&lt;/strong> è·å–å®¹å™¨çš„æ—¥å¿—&lt;/p>
&lt;ul>
&lt;li>-f : è·Ÿè¸ªæ—¥å¿—è¾“å‡ºï¼Œå’Œlinuxçš„ &lt;strong>tail&lt;/strong> çš„-fæ•ˆæœç›¸åŒ&lt;/li>
&lt;li>&amp;ndash;since :æ˜¾ç¤ºæŸä¸ªå¼€å§‹æ—¶é—´çš„æ‰€æœ‰æ—¥å¿—&lt;/li>
&lt;li>-t : æ˜¾ç¤ºæ—¶é—´æˆ³&lt;/li>
&lt;li>&amp;ndash;tail :ä»…åˆ—å‡ºæœ€æ–°Næ¡å®¹å™¨æ—¥å¿—&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>**port ** åˆ—å‡ºæŒ‡å®šçš„å®¹å™¨çš„ç«¯å£æ˜ å°„ï¼Œæˆ–è€…æŸ¥æ‰¾å°†PRIVATE_PORT NATåˆ°é¢å‘å…¬ä¼—çš„ç«¯å£ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>export&lt;/strong> å°†å®¹å™¨å¯¼å‡ºä¸ºä¸€ä¸ªæ–‡ä»¶ï¼Œå’Œ&lt;strong>save&lt;/strong>å‘½ä»¤ç›¸ä¼¼ï¼Œä½†æ˜¯&lt;strong>save&lt;/strong>å‘½ä»¤æ“ä½œçš„æ˜¯é•œåƒï¼Œ&lt;strong>export&lt;/strong>æ“ä½œçš„æ˜¯å®¹å™¨ã€‚&lt;strong>save&lt;/strong>ä¿å­˜çš„æ–‡ä»¶æ²¡æœ‰ä¸¢å¤±é•œåƒçš„å†å²ï¼Œå¯ä»¥å›æ»šåˆ°ä¹‹å‰ã€‚&lt;strong>export&lt;/strong> ä¿å­˜çš„æ–‡ä»¶å†å¯¼å…¥æ—¶ä¼šä¸¢å¤±é•œåƒæ‰€æœ‰çš„å†å²ï¼Œæ‰€ä»¥æ— æ³•è¿›è¡Œå›æ»š
ä½¿ç”¨å‘½ä»¤ &lt;code>docker export name &amp;gt; filename&lt;/code>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>commit&lt;/strong> ä»æŒ‡å®šå®¹å™¨åˆ›å»ºä¸€ä¸ªæ–°çš„é•œåƒã€‚&lt;/p>
&lt;ul>
&lt;li>-a :æäº¤çš„é•œåƒä½œè€…&lt;/li>
&lt;li>-c :ä½¿ç”¨DockerfileæŒ‡ä»¤æ¥åˆ›å»ºé•œåƒ&lt;/li>
&lt;li>-m :æäº¤æ—¶çš„è¯´æ˜æ–‡å­—&lt;/li>
&lt;li>-p :åœ¨commitæ—¶ï¼Œå°†å®¹å™¨æš‚åœ
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-530a81457c569856.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-530a81457c569856.webp" alt="commit" />
&lt;/a>
&lt;/div>
å°†&lt;strong>mariadb&lt;/strong> å®¹å™¨ç”Ÿæˆä¸€ä¸ªæ–°çš„é•œåƒ&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>cp&lt;/strong> åœ¨å®¿ä¸»æœºå’Œå®¹å™¨ä¹‹é—´å¤åˆ¶æ–‡ä»¶ã€‚
å°† &lt;em>a.txt&lt;/em> å¤åˆ¶åˆ° nameä¸º &lt;em>mysql&lt;/em> å®¹å™¨çš„ &lt;em>var&lt;/em> ç›®å½• &lt;code>docker cp a.txt redis:/var&lt;/code>&lt;/p>
&lt;/li>
&lt;/ol></description></item><item><title>dockerå­¦ä¹ 1-åŸºæœ¬æ¦‚å¿µ</title><link>https://lqxhub.github.io/posts/79efdaf8/</link><pubDate>Thu, 02 Apr 2020 19:56:27 +0000</pubDate><guid>https://lqxhub.github.io/posts/79efdaf8/</guid><description>&lt;p>dockeræ˜¯å½“ä¸‹æ˜¯ç”¨çš„æœ€å¤šçš„è™šæ‹ŸåŒ–æŠ€æœ¯ï¼Œé‚£å¿…é¡»è¦å­¦ä¹ ä¸€æ³¢ã€‚å­¦ä¹ ä¹‹å‰å…ˆææ¸…æ¥šä¸‰ä¸ªé—®é¢˜&lt;/p>
&lt;ol>
&lt;li>ä»€ä¹ˆæ˜¯docker&lt;/li>
&lt;li>dockerè§£å†³äº†å·¥ä½œä¸­çš„é‚£äº›é—®é¢˜&lt;/li>
&lt;li>ç†æ¸…æ¥šdockerä¸­çš„å‡ ä¸ªæ¦‚å¿µ&lt;/li>
&lt;/ol>
&lt;h4 id="ä»€ä¹ˆæ˜¯docker">&lt;a href="#%e4%bb%80%e4%b9%88%e6%98%afdocker" class="header-anchor">&lt;/a>ä»€ä¹ˆæ˜¯docker
&lt;/h4>&lt;p>å…ˆè§£å†³ç¬¬ä¸€ä¸ªé—®é¢˜ï¼Œdockeråˆ°åº•æ˜¯ä¸ªå•¥ç©æ„ã€‚dockeræ˜¯ä¸€ç§&lt;strong>è™šæ‹ŸåŒ–&lt;/strong>æŠ€æœ¯ï¼Œé€šä¿—çš„è®²ï¼Œdockerç±»ä¼¼ä¸€ä¸ªè™šæ‹Ÿæœºï¼Œå¯ä»¥è™šæ‹Ÿå‡ºä¸€ä¸ªä¸»æœºã€‚åœ¨dockerä¸­ï¼Œæ¯ä¸ªå®¹å™¨ç›¸äº’éš”ç¦»ï¼Œå®¹å™¨å†…çš„ç¨‹åºä¸èƒ½è·¨å®¹å™¨ç›´æ¥äº¤äº’ã€‚å®¹å™¨ä¹‹é—´å¯ä»¥é€šè¿‡ç½‘ç»œæˆ–è€…å…±äº«æ–‡ä»¶äº¤äº’ã€‚ä½†æ˜¯dockerä¸æ˜¯è™šæ‹Ÿæœºï¼Œdockerä¸è™šæ‹Ÿæœºç›¸æ¯”ï¼Œdockeræ˜¯è½»é‡çº§çš„ï¼Œå¯ä»¥åšåˆ°ç§’çº§å¯åŠ¨ï¼Œdockerå ç”¨çš„ç³»ç»Ÿå¼€é”€ä¹Ÿæ˜¯å¾ˆä½çš„ã€‚ç”¨è¿‡è™šæ‹Ÿçš„éƒ½çŸ¥é“ï¼Œè™šæ‹Ÿæœºå¯åŠ¨å¾ˆæ…¢ï¼Œè€Œä¸”ä¼šå ç”¨å®¿ä¸»æœºå¾ˆå¤§çš„å†…å­˜å’Œcpuèµ„æºã€‚ä½¿ç”¨dockerï¼Œå‡ ä¹æ„Ÿè§‰ä¸åˆ°dockerçš„å­˜åœ¨ã€‚&lt;/p>
&lt;h4 id="dockerè§£å†³äº†å·¥ä½œä¸­çš„é‚£äº›é—®é¢˜">&lt;a href="#docker%e8%a7%a3%e5%86%b3%e4%ba%86%e5%b7%a5%e4%bd%9c%e4%b8%ad%e7%9a%84%e9%82%a3%e4%ba%9b%e9%97%ae%e9%a2%98" class="header-anchor">&lt;/a>dockerè§£å†³äº†å·¥ä½œä¸­çš„é‚£äº›é—®é¢˜
&lt;/h4>&lt;p>dockerè§£å†³äº†å·¥ä½œä¸­çš„é‚£äº›é—®é¢˜ã€‚å¾ˆå¤šæ—¶å€™ï¼Œç”±äºå¼€å‘ç¯å¢ƒå’Œçº¿ä¸Šç¯å¢ƒæ˜¯ä¸åŒçš„ï¼Œæ¯”å¦‚åœ¨windowsä¸‹å¼€å‘ï¼Œç¨‹åºæœ€ç»ˆéƒ¨ç½²åˆ°linuxä¸Šã€‚å¾ˆå¤šæ—¶å€™ï¼Œä¼šå› ä¸ºä¾èµ–åº“çš„é—®é¢˜ï¼Œå¯¼è‡´ç¨‹åºè¿è¡ŒæŠ¥é”™ã€‚javaï¼Œphpï¼ŒC++ç­‰è¿™äº›ç¨‹åºï¼Œåœ¨å¼€å‘ç¯å¢ƒä¸­æ˜¯æ­£å¸¸çš„ã€‚ä½†æ˜¯åœ¨è¿è¡Œç¯å¢ƒä¸­ï¼Œç”±äºç¼ºå¤±è¿è¡Œæ‰€ä¾èµ–çš„åº“ï¼Œå¯¼è‡´ç¨‹åºæŠ¥é”™æˆ–è€…æ— æ³•è¿è¡Œã€‚å½“ä½ è´¹åŠ²ä¹ç‰›äºŒè™ä¹‹åŠ›é…ç½®å¥½è¿è¡Œç¯å¢ƒæ—¶ï¼Œè€æ¿å‘Šè¯‰ä½ ï¼Œè¿˜æœ‰100å°æœåŠ¡å™¨éœ€è¦é…ç½®ï¼Œä½ æ˜¯ä¸æ˜¯ç¬é—´å°±å¥”æºƒäº†ã€‚&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-4266369a762ff268.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-4266369a762ff268.webp" alt="" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>ä½¿ç”¨dockerå°±å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚åªéœ€è¦æŠŠè¦éƒ¨ç½²çš„ç¨‹åºæ‰“åŒ…æˆä¸€ä¸ªdockerçš„é•œåƒï¼Œç„¶ååœ¨ç”¨dockeræŠŠé•œåƒç”Ÿæˆå®¹å™¨ï¼Œä½¿ç”¨å®¹å™¨è¿è¡Œã€‚å†ä¹Ÿä¸ç”¨é…ç½®è¿è¡Œç¯å¢ƒäº†ï¼Œä¸ç®¡æœ‰å¤šå°‘å°æœºå™¨ï¼Œåªéœ€è¦æŠŠdockeré•œåƒå¯¼å…¥ï¼Œå°±å¯ä»¥éå¸¸ç®€å•çš„éƒ¨ç½²ä¸€å°æœºå™¨ã€‚dockerä¸ºå•¥èƒ½åšåˆ°å‘¢ï¼Œå…¶å®è¿™ä¸ªæ‰“åŒ…æˆé•œåƒçš„è¿‡ç¨‹ï¼Œå·²ç»æŠŠè¿è¡Œç¨‹åºå¿…å¤‡çš„ä¸€äº›åº“ï¼Œå…¨éƒ½æ‰“åŒ…è¿›é•œåƒä¸­äº†ï¼Œå½“ç¨‹åºåœ¨å®¹å™¨ä¸­è¿è¡Œæ—¶ï¼Œå°±ä¸ä¼šå› ä¸ºç¯å¢ƒçš„é—®é¢˜å¯¼è‡´æŠ¥é”™äº†ã€‚&lt;/p>
&lt;h4 id="dockerä¸­çš„å‡ ä¸ªæ¦‚å¿µ">&lt;a href="#docker%e4%b8%ad%e7%9a%84%e5%87%a0%e4%b8%aa%e6%a6%82%e5%bf%b5" class="header-anchor">&lt;/a>dockerä¸­çš„å‡ ä¸ªæ¦‚å¿µ
&lt;/h4>&lt;ol>
&lt;li>&lt;strong>é•œåƒ&lt;/strong>(Images)ï¼šé•œåƒæ˜¯ä¸€ä¸ªæ–‡ä»¶ï¼Œæ˜¯ç”¨é•œåƒæ–‡ä»¶å¯ä»¥åˆ›å»ºå®¹å™¨ã€‚æ¯”å¦‚æˆ‘ä»¬è£…ç³»ç»Ÿæ—¶ï¼Œä¼šç”¨åˆ°windowsçš„ç³»ç»Ÿé•œåƒï¼Œä¸€èˆ¬æ˜¯ä¸€ä¸ª**.iso** æ–‡ä»¶ï¼Œdockerä¸­çš„é•œåƒè¿™å°±æ˜¯ä¸€ä¸ªç±»ä¼¼çš„æ–‡ä»¶ã€‚&lt;/li>
&lt;li>&lt;strong>å®¹å™¨&lt;/strong>(Container)ï¼š å®¹å™¨æ˜¯ä¸€ä¸ªå¯ä»¥é€šè¿‡dockerè¿è¡Œçš„å®ä¾‹ï¼Œåƒæˆ‘ä»¬è£…æœºå®Œæˆåçš„ç³»ç»Ÿä¸€æ ·ã€‚&lt;/li>
&lt;li>&lt;strong>ä»“åº“&lt;/strong>(Repository)ï¼šä»“åº“æ˜¯ä¸€ä¸ªå­˜æ”¾dockeré•œåƒçš„ç½‘ç«™ï¼Œç±»ä¼¼ä¸€ä¸ªç½‘ç›˜ï¼Œè¿™é‡Œä¿å­˜ç€å¾ˆå¤šé•œåƒï¼Œå¯ä»¥é€šè¿‡ç½‘ç»œä¸‹è½½è¿™äº›é•œåƒ&lt;/li>
&lt;li>&lt;strong>ä¸»æœº&lt;/strong>(Host)ï¼šä¸€ä¸ªç‰©ç†æœºæˆ–è€…è™šæ‹Ÿæœºï¼Œæ¯”å¦‚æˆ‘ä»¬çš„ç”µè„‘ã€äº‘æœåŠ¡å™¨ã€‚ç”¨äºæ‰§è¡Œ Docker å®ˆæŠ¤è¿›ç¨‹å’Œå®¹å™¨&lt;/li>
&lt;li>&lt;strong>å®¢æˆ·ç«¯&lt;/strong>(CLient)ï¼šDocker å®¢æˆ·ç«¯é€šè¿‡å‘½ä»¤è¡Œä¸ Docker çš„å®ˆæŠ¤è¿›ç¨‹é€šä¿¡ã€‚å°±æ˜¯æˆ‘ä»¬æ“ä½œdockerçš„å·¥å…·&lt;/li>
&lt;/ol>
&lt;hr>
&lt;p>æ€»ç»“ä¸€ä¸‹ï¼Œé•œåƒå¯ä»¥çœ‹åšæ˜¯é¢å‘å¯¹è±¡ä¸­çš„ &lt;strong>ç±»&lt;/strong>ï¼Œå®¹å™¨å°±æ˜¯ &lt;strong>å¯¹è±¡&lt;/strong>ï¼ŒåŒæ ·çš„ï¼Œä¸€ä¸ªé•œåƒä¹Ÿå¯ä»¥åˆ›å»ºå¤šä¸ªå®¹å™¨&lt;/p>
&lt;p>è‡³äºæ€ä¹ˆå®‰è£…dockerï¼Œç½‘ä¸Šæ•™ç¨‹å¤ªå¤šäº†ï¼Œå°±ä¸èµ˜è¿°äº†ã€‚å»ºè®®åœ¨linuxä¸Šå®‰è£…dockerï¼Œæ²¡æœ‰linuxçš„å¯ä»¥åœ¨windowsä¸­è£…ä¸€ä¸ªè™šæ‹Ÿæœºï¼Œè™šæ‹Ÿæœºè£…linuxï¼Œç„¶ååœ¨è£…dockerã€‚æˆ‘å°±æ˜¯è¿™æ ·å¼„çš„ã€‚&lt;/p></description></item><item><title>ä½¿ç”¨ä¸€ä¸ªå­—æ®µå®ç°ç¬¬äºŒæ¡ä»¶æ’åº</title><link>https://lqxhub.github.io/posts/f329a22f/</link><pubDate>Sun, 24 Nov 2019 22:07:45 +0000</pubDate><guid>https://lqxhub.github.io/posts/f329a22f/</guid><description>&lt;p>åœ¨æ’åºä¸­ï¼Œç»å¸¸é‡åˆ°å˜é‡ç›¸åŒæƒ…å†µä¸‹çš„æ’åºé—®é¢˜ã€‚åœ¨MySQLä¸­å¯ä»¥ä½¿ç”¨ &lt;strong>ORDER BY&lt;/strong> çº¦æŸå¤šä¸ªå­—æ®µã€‚ä½†æ˜¯åœ¨redisä¸­ï¼Œä½¿ç”¨sorted setæ’åºæ—¶ï¼Œscoreåªèƒ½è®¾ç½®ä¸€ä¸ªå˜é‡ã€‚è¿™æ ·åœ¨scoreç›¸åŒæ—¶ï¼Œåªèƒ½ä½¿ç”¨å­—å…¸åºäº†ï¼ˆè¿™ä¸ªæ˜¯ä»æ–‡æ¡£ä¸Šçœ‹åˆ°çš„ï¼Œå…·ä½“æ²¡éªŒè¯ï¼‰
è¿™å°±ä¼šå‡ºç°ä¸€äº›é—®é¢˜äº†ï¼Œæœ€ç®€å•ï¼Œåœ¨æ¸¸æˆæ’è¡Œæ¦œä¸­ï¼Œæˆ‘åŸæ¥æ˜¯æ’ç¬¬ä¸€çš„ï¼Œçªç„¶æ¥äº†ä¸ªäººï¼Œåˆ†æ•°å’Œæˆ‘ç›¸åŒï¼Œä½†æ˜¯æ’åˆ°æˆ‘å‰é¢äº†ï¼Œæˆ‘æˆç¬¬äºŒäº†ï¼Œç©å®¶è‚¯å®šä¸å¹²äº†ã€‚ä½†æ˜¯redisåªèƒ½ä½¿ç”¨ä¸€ä¸ªå€¼ä½œä¸ºæ’åºæ¡ä»¶ï¼Œè¿™å°±éœ€è¦æˆ‘ä»¬åœ¨ä¸€ä¸ªå€¼é‡Œæ—¢èƒ½è®°å½•åŸæœ‰çš„åˆ†æ•°ï¼Œè¿˜è¦è®°å½•å¦ä¸€ä¸ªå€¼ã€‚&lt;/p>
&lt;p>æ¯”è¾ƒå¸¸è§çš„æ˜¯ç”¨æ—¶é—´ä½œä¸ºç¬¬äºŒä¸ªæ’åºæ¡ä»¶ï¼Œè°å…ˆè¾¾åˆ°è¿™ä¸ªåˆ†æ•°ï¼Œè°æ’åœ¨å‰é¢ã€‚
è¦å®ç°è¿™ä¸ªåŠŸèƒ½ï¼Œè¦æ»¡è¶³ &lt;strong>å¯é€†&lt;/strong> ï¼Œ&lt;strong>ç¨³å®šæ’åº&lt;/strong> ä¸¤ä¸ªè¦æ±‚ã€‚&lt;/p>
&lt;ol>
&lt;li>å¯é€†ï¼šæŠŠæ•°å€¼å¤„ç†åè¿˜èƒ½åˆ°çš„åŸæ¥çš„å€¼ï¼ˆåˆ†æ•°å’Œæ—¶é—´ï¼‰&lt;/li>
&lt;li>ç¨³å®šæ’åºï¼šæ·»åŠ æ—¶é—´åä¸èƒ½å½±å“åŸæ¥çš„æ’åºç»“æœï¼Œæ·»åŠ çš„æ—¶é—´åªæ˜¯åœ¨åˆ†æ•°ç›¸åŒçš„æƒ…å†µä¸‹æ‰èµ·ä½œç”¨&lt;/li>
&lt;/ol>
&lt;p>ç®€å•çš„å¯¹æ•°å€¼è¿›è¡ŒåŠ å‡ä¹˜é™¤æ˜¯æ²¡æ³•å®ç°çš„äº†ï¼Œç®€å•çš„æ•°å€¼åŠ å‡ä¹˜é™¤ä¸€æ˜¯ä¸èƒ½æ¢å¤åŸæ¥çš„æ•°æ®ï¼ŒäºŒæ˜¯ä¼šå½±å“åˆ°åŸæœ‰çš„æ’åºã€‚&lt;/p>
&lt;p>ä¸å–å…³å­äº†ï¼Œä½¿ç”¨**â€˜æˆ–â€™&lt;strong>è¿ç®—ï¼Œå¯ä»¥å®ç°è¿™ä¸ªéœ€æ±‚ã€‚æŠŠä¸¤ä¸ªæ•°å€¼è¿›è¡Œ&lt;/strong>æˆ–**è¿ç®—ï¼Œç”Ÿæˆä¸€ä¸ªæ•°ã€‚ç®€å•è¯´ä¸€ä¸‹åŸç†ã€‚
&lt;strong>æˆ–&lt;/strong> è¿ç®—çš„è§„åˆ™æ˜¯åœ¨äºŒè¿›åˆ¶ä½ä¸Šï¼Œæœ‰1 æˆ– è¿ç®—åè¿˜æ˜¯1ï¼Œä¸¤ä¸ªéƒ½æ˜¯0 æˆ–è¿ç®—åæ˜¯ 0ã€‚ ä¾‹ï¼š1æˆ–2 äºŒè¿›åˆ¶è¡¨ç¤º 01|10 = 11ã€‚ä½†æ˜¯ç°åœ¨å´å‘ç°ï¼Œæ— æ³•å®ç°æ•°æ®è¿˜åŸï¼Œè¿™å°±éœ€è¦ç§»ä½äº†ã€‚å°±æ˜¯ä¸¤ä¸ª8ä½é•¿çš„æ•°æ®ï¼Œæˆ– è¿ç®—åè¦æˆä¸º16ä½çš„æ•°æ®ã€‚
è¿˜æ˜¯ä¸Šä¸ªä¾‹å­ï¼šä¸ºäº†ç®€å•èµ·è§ï¼Œå‡è®¾åŸæ•°æ®æ˜¯2ä½é•¿ï¼Œå…ˆæŠŠåŸæ¥2ä½é•¿çš„æ•°æ®è½¬æˆ4ä½é•¿ï¼Œç„¶åå·¦ç§»2ä½ï¼Œ1å°±ä»åŸæ¥çš„01å˜æˆäº†0111ã€‚2åªå˜æˆ4ä½ï¼Œä¸ç§»ä½ã€‚2ä»10å˜æˆ0010ã€‚0100|0010 = 0110ã€‚è¿™æ ·å°±èƒ½è¿˜åŸæ•°æ®äº†ã€‚å‰ä¸¤ä½01æ˜¯åŸæ¥çš„1ï¼Œåä¸¤ä½10å°±æ˜¯åŸæ¥çš„2ã€‚
ä¸‹é¢é€šè¿‡ä»£ç æ¥å®ç°ä¸€ä¸‹ã€‚
ä»£ç ç”¨golangå®ç°&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">package&lt;/span> main
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span>&lt;span style="color:#ff79c6">import&lt;/span> (
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span> &lt;span style="color:#f1fa8c">&amp;#34;fmt&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span> &lt;span style="color:#f1fa8c">&amp;#34;math/rand&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span> &lt;span style="color:#f1fa8c">&amp;#34;sort&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> &lt;span style="color:#50fa7b">main&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span> arr &lt;span style="color:#ff79c6">:=&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">make&lt;/span>([]&lt;span style="color:#8be9fd">uint64&lt;/span>, &lt;span style="color:#bd93f9">10&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span> b &lt;span style="color:#ff79c6">:=&lt;/span> rand.&lt;span style="color:#50fa7b">Perm&lt;/span>(&lt;span style="color:#bd93f9">10&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span> &lt;span style="color:#ff79c6">for&lt;/span> i &lt;span style="color:#ff79c6">:=&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>; i &amp;lt; &lt;span style="color:#bd93f9">10&lt;/span>; i&lt;span style="color:#ff79c6">++&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span> &lt;span style="color:#8be9fd;font-style:italic">var&lt;/span> a &lt;span style="color:#8be9fd">uint32&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> i&lt;span style="color:#ff79c6">%&lt;/span>&lt;span style="color:#bd93f9">2&lt;/span> &lt;span style="color:#ff79c6">==&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15&lt;/span>&lt;span> a = &lt;span style="color:#bd93f9">10&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16&lt;/span>&lt;span> } &lt;span style="color:#ff79c6">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17&lt;/span>&lt;span> a = &lt;span style="color:#bd93f9">5&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19&lt;/span>&lt;span> arr[i] = &lt;span style="color:#8be9fd;font-style:italic">uint64&lt;/span>(a)&lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span>&lt;span style="color:#bd93f9">32&lt;/span> | &lt;span style="color:#8be9fd;font-style:italic">uint64&lt;/span>(b[i])
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20&lt;/span>&lt;span> fmt.&lt;span style="color:#50fa7b">Println&lt;/span>(a, b[i], arr[i])
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22&lt;/span>&lt;span> sort.&lt;span style="color:#50fa7b">Sort&lt;/span>(&lt;span style="color:#50fa7b">Myuint64&lt;/span>(arr))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24&lt;/span>&lt;span> fmt.&lt;span style="color:#50fa7b">Println&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;æ’åºå&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25&lt;/span>&lt;span> &lt;span style="color:#ff79c6">for&lt;/span> _, v &lt;span style="color:#ff79c6">:=&lt;/span> &lt;span style="color:#ff79c6">range&lt;/span> arr {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26&lt;/span>&lt;span> fmt.&lt;span style="color:#50fa7b">Println&lt;/span>(v, v&lt;span style="color:#ff79c6">&amp;gt;&amp;gt;&lt;/span>&lt;span style="color:#bd93f9">32&lt;/span>, &lt;span style="color:#8be9fd;font-style:italic">uint32&lt;/span>(v))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">type&lt;/span> Myuint64 []&lt;span style="color:#8be9fd">uint64&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> (this Myuint64) &lt;span style="color:#50fa7b">Len&lt;/span>() &lt;span style="color:#8be9fd">int&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">len&lt;/span>(this)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> (this Myuint64) &lt;span style="color:#50fa7b">Less&lt;/span>(i, j &lt;span style="color:#8be9fd">int&lt;/span>) &lt;span style="color:#8be9fd">bool&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> this[i] &amp;gt; this[j]
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> (this Myuint64) &lt;span style="color:#50fa7b">Swap&lt;/span>(i, j &lt;span style="color:#8be9fd">int&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40&lt;/span>&lt;span> this[i], this[j] = this[j], this[i]
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ç®€å•è¯´ä¸€ä¸‹ä»£ç ï¼Œç¬¬ä¸€æ’åºæ¡ä»¶ç”¨äº†é—´éš”ä½¿ç”¨äº†5å’Œæ˜¯è¿™ä¸¤ä¸ªæ•°ï¼Œç¬¬äºŒæ¡ä»¶éšæœºç”Ÿæˆäº†10ä¸ªä¸é‡å¤çš„éšæœºæ•°ï¼Œä¸ç”¨æ—¶é—´æˆ³çš„åŸå› æ˜¯ï¼Œç¨‹åºè¿è¡Œçš„æ—¶é—´å¾ˆçŸ­ï¼Œå–åˆ°çš„æ—¶é—´æˆ³åŸºæœ¬æ˜¯ä¸€ä¸ªæ•°ï¼Œçœ‹ä¸å‡ºåŒºåˆ«ï¼Œæœ¬è´¨æ€æƒ³éƒ½æ˜¯ä¸€æ ·çš„ã€‚
æ’åºä½¿ç”¨äº†goè‡ªå¸¦çš„æ’åºæ¥å£&lt;/p>
&lt;p>ä»£ç ä¸­&lt;code>fmt.Println(v, v&amp;gt;&amp;gt;32, uint32(v))&lt;/code> å°±æ˜¯è§£æ•°æ®ï¼Œ&lt;strong>æˆ–&lt;/strong> è¿ç®—åï¼Œå‰32ä½æ˜¯ä¸€ä¸ªæ•°ï¼Œå32ä½æ˜¯å¦ä¸€ä¸ªæ•°æ®ã€‚
å–å‰é¢çš„æ•°æ®åªéœ€è¦æŠŠè®¡ç®—åçš„æ•°æ®å³ç§»32ä½å°±è¡Œäº†ï¼Œå–åé¢çš„æ•°æ®ï¼Œæ›´ç®€å•äº†ï¼Œç›´æ¥å¼ºè½¬æˆ32ä½çš„ç±»å‹å°±è¡Œäº†ã€‚
çœ‹ä¸€ä¸‹è¿è¡Œç»“æœï¼š&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-a4b1ddebf918051a.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-a4b1ddebf918051a.webp" alt="" />
&lt;/a>
&lt;/div>
å¯ä»¥çœ‹åˆ°ï¼Œæ’åºå‰ï¼Œ10å’Œ5äº¤æ›¿å‡ºç°ï¼Œç¬¬äºŒæ¡ä»¶æ²¡æœ‰è§„å¾‹
æ’åºåï¼Œå…ˆä½¿ç”¨ç¬¬ä¸€ä¸ªæ•°æ’åºï¼Œç¬¬ä¸€ä¸ªæ•°ç›¸åŒæ—¶ï¼Œä½¿ç”¨ç¬¬äºŒæ¡ä»¶æ’åºã€‚è€Œä¸”æˆ‘ä»¬ä¹ŸæˆåŠŸè¿˜åŸäº†åŸæ¥çš„æ•°æ®ã€‚
å¥½äº†ï¼Œè¿™æ ·å°±å®ç°äº†ç”¨ä¸€ä¸ªæ•°å€¼å®ç°ç¬¬äºŒæ¡ä»¶æ’åºäº†ã€‚åœ¨å­˜å…¥redisæ—¶åªéœ€è¦æŠŠè®¡ç®—åçš„æ•°æ®å­˜å…¥rediså°±è¡Œäº†ï¼Œæ˜¾ç¤ºæ•°æ®çš„æ—¶å€™ï¼Œåªéœ€è¦è§£ä¸€ä¸‹æ•°æ®å°±è¡Œäº†ã€‚
å¥½äº†ï¼Œåˆ°è¿™å°±ä»‹ç»å®Œäº†ï¼Œæœ‰é—®é¢˜æ¬¢è¿è¯„è®ºåŒºè®¨è®º&lt;/p></description></item><item><title>ç”¨ã€Šè‹±é›„è”ç›Ÿã€‹è§£é‡Šä¸€ä¸‹é¢å‘å¯¹è±¡ä¸­æ¥å£çš„ä½œç”¨</title><link>https://lqxhub.github.io/posts/a96f0ff3/</link><pubDate>Tue, 27 Aug 2019 23:23:14 +0000</pubDate><guid>https://lqxhub.github.io/posts/a96f0ff3/</guid><description>&lt;p>åœ¨é¢å‘å¯¹è±¡ç¼–ç¨‹çš„æ€æƒ³ä¸­ï¼Œæ¥å£æ˜¯ä¸€ä¸ªéå¸¸é‡è¦çš„æ¦‚å¿µã€‚æŒ‰ä¹¦ä¸Šä»‹ç»çš„ï¼Œä½¿ç”¨æ¥å£ï¼Œå¯ä»¥å®ç°è¿è¡Œæ—¶å¤šæ€ã€æ˜“ç»´æŠ¤ã€æ˜“æ‹“å±•ç­‰ç­‰ä¼˜ç‚¹ã€‚æ‹¥æœ‰å¤šå¹´ç¼–ç¨‹ç»éªŒçš„äººåº”è¯¥èƒ½ç†è§£è¿™äº›è¯çš„å«ä¹‰ï¼Œå¯¹äºä¸€ä¸ªåˆå­¦ç¼–ç¨‹çš„èŒæ–°æ¥è¯´ï¼Œçœ‹å®Œè¿™æ®µè¯å®Œå…¨ä¸çŸ¥æ‰€äº‘ã€‚é‚£ä»Šå¤©æˆ‘ç”¨ã€Šè‹±é›„è”ç›Ÿã€‹ä¸ºèƒŒæ™¯ï¼Œè¯¦ç»†çš„åˆ†æä¸€ä¸‹æ¥å£åœ¨é¢å‘å¯¹è±¡ç¼–ç¨‹ä¸­çš„ä½œç”¨ï¼Œä»¥åŠä½¿ç”¨æ¥å£çš„ä¼˜åŠ¿ã€‚&lt;/p>
&lt;p>è¿™æ¬¡ä½¿ç”¨javaä½œä¸ºç¼–å†™demoçš„è¯­è¨€ï¼Œä¸»è¦åŸå› æœ‰ä¸¤ä¸ªï¼š&lt;/p>
&lt;ol>
&lt;li>javaæ˜¯æœ€æµè¡Œçš„ç¼–ç¨‹è¯­è¨€ï¼ŒåŸºæœ¬ä¸Šå­¦è¿‡ç¼–ç¨‹çš„éƒ½ä¼šjavaè¯­è¨€ï¼›&lt;/li>
&lt;li>javaæ˜¯ä¸€é—¨å¯¹é¢å‘å¯¹è±¡ç‰¹æ€§æ”¯æŒæ¯”è¾ƒå¥½çš„è¯­è¨€ï¼›&lt;/li>
&lt;/ol>
&lt;p>è¿˜è®°å¾—æˆ‘åˆšå¼€å§‹å­¦ä¹ javaçš„æ—¶å€™ï¼Œå°±å¾ˆä¸ç†è§£æ¥å£çš„ä½œç”¨ï¼Œæ„Ÿè§‰æ¥å£æœ‰ç‚¹å¤šä½™ã€‚&lt;/p>
&lt;blockquote>
&lt;p>ä¾‹å¦‚æˆ‘å®šä¹‰äº†ä¸€ä¸ªæ¥å£ï¼Œä½†æ˜¯æˆ‘åœ¨å®ç°è¿™ä¸ªæ¥å£çš„ç±»ä¸­è¿˜è¦å†™æ¥å£çš„å®ç°æ–¹æ³•ï¼Œé‚£æˆ‘ä¸å¦‚ç›´æ¥å°±åœ¨è¿™ä¸ªç±»ä¸­å†™å®ç°æ–¹æ³•å²‚ä¸æ˜¯æ›´ä¾¿æ·ï¼Œè¿˜çœå»äº†å®šä¹‰æ¥å£&lt;/p>
&lt;/blockquote>
&lt;p>ç›¸ä¿¡ä¸æ­¢æˆ‘ä¸€ä¸ªäººæœ‰è¿‡è¿™æ ·çš„ç–‘æƒ‘å§ã€‚
åæ¥éšç€å†™ä»£ç ï¼Œçœ‹é˜…è¯»åˆ«äººçš„ä»£ç ï¼Œé€æ¸å¼€å§‹ç†è§£æ¥å£çš„ä½œç”¨äº†ï¼Œæ…¢æ…¢è§‰å¾—æ¥å£æ˜¯ä¸€ä¸ªéå¸¸æ–¹ä¾¿å’Œç‰›é€¼çš„ä¸œè¥¿ã€‚
æ•™æä¸Šï¼Œç½‘ä¸Šè§£é‡Šæ¥å£çš„ä¾‹å­å¤§å¤šæ•°ä½¿ç”¨å®šä¹‰ä¸€ä¸ªAnimalæ¥å£ï¼Œç„¶åDogå®ç°äº†è¿™ä¸ªæ¥å£ï¼ŒCatå®ç°äº†è¿™ä¸ªæ¥å£ï¼›è¿˜æœ‰ä¸€ç§ç”¨USBæ¥å£ä¸¾ä¾‹ã€‚å¤§å¤šæ•°äººçœ‹å®Œè¿˜æ˜¯ä¸€è„¸æ‡µé€¼ã€‚
ç°åœ¨ç”¨ä¸€ç§æ–°çš„æ–¹å¼â€”â€”ã€Šè‹±é›„è”ç›Ÿã€‹ä¸ºèƒŒæ™¯ä»‹ç»ä¸€ä¸‹ã€‚
è¯´äº†è¿™ä¹ˆåŠå¤©ï¼Œå¼€å§‹è¿›å…¥æ­£é¢˜å§ã€‚&lt;/p>
&lt;h2 id="å…ˆåœˆä¸¤ä¸ªé‡ç‚¹">&lt;a href="#%e5%85%88%e5%9c%88%e4%b8%a4%e4%b8%aa%e9%87%8d%e7%82%b9" class="header-anchor">&lt;/a>å…ˆåœˆä¸¤ä¸ªé‡ç‚¹ï¼š
&lt;/h2>&lt;ol>
&lt;li>Javaä¹‹æ‰€ä»¥è¦æœ‰æ¥å£ï¼Œæ˜¯å› ä¸ºjavaä¸æ”¯æŒå¤šç»§æ‰¿ï¼Œä½¿ç”¨æ¥å£ï¼Œå¯ä»¥é—´æ¥çš„å®ç°å¤šç»§æ‰¿çš„ä¸€äº›ç‰¹æ€§ï¼›åƒC++å°±ä¸å­˜åœ¨æ¥å£è¿™ä¸ªä¸œè¥¿ï¼Œå› ä¸ºC++æ”¯æŒå¤šç»§æ‰¿&lt;/li>
&lt;li>åœ¨é¢å‘å¯¹è±¡çš„æ¦‚å¿µä¸­ï¼Œå­ç±»ï¼ˆæ´¾ç”Ÿç±»ï¼‰å¯ä»¥è‡ªåŠ¨è½¬æ¢ä¸ºçˆ¶ç±»ï¼ˆåŸºç±»ï¼‰ç±»å‹ï¼›ä¹Ÿå°±æ˜¯è¯´ï¼ŒAç±»å®ç°äº†æ¥å£Bï¼Œé‚£ä¹ˆAçš„å®ä¾‹åŒ–å¯¹è±¡å¯ä»¥è‡ªåŠ¨è½¬æ¢ä¸ºBç±»å‹&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">public&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">class&lt;/span> &lt;span style="color:#50fa7b">Main&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span> &lt;span style="color:#8be9fd;font-style:italic">public&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">static&lt;/span> &lt;span style="color:#8be9fd">void&lt;/span> &lt;span style="color:#50fa7b">main&lt;/span>(String&lt;span style="color:#ff79c6">[]&lt;/span> args) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span> B a &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#ff79c6">new&lt;/span> A();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">interface&lt;/span> &lt;span style="color:#50fa7b">B&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">class&lt;/span> &lt;span style="color:#50fa7b">A&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">implements&lt;/span> B {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™æ ·çš„ä»£ç æ˜¯æ­£ç¡®çš„ã€‚&lt;/p>
&lt;hr>
&lt;p>å¼€å§‹demoéƒ¨åˆ†ï¼Œæˆ‘ä»¬å®šä¹‰ä¸€ä¸ªSkillæ¥å£ï¼Œé‡Œé¢æœ‰ &lt;strong>Q&lt;/strong>ã€&lt;strong>W&lt;/strong>ã€&lt;strong>E&lt;/strong>ã€&lt;strong>R&lt;/strong> å››ä¸ªæ–¹æ³•ï¼Œä»£è¡¨è‹±é›„çš„å››ä¸ªæŠ€èƒ½ã€‚ä¸ºäº†ç®€å•ï¼Œè¢«åŠ¨æŠ€èƒ½å’Œå¬å”¤å¸ˆæŠ€èƒ½å°±ä¸å†™äº†ã€‚
ç„¶åä»äº”ä¸ªä½ç½®ä¸Šå•ã€æ‰“é‡ã€ä¸­å•ã€ADCã€è¾…åŠ©ä¸­å„æŒ‘é€‰ä¸€ä¸ªè‹±é›„ï¼Œä½œä¸ºä¾‹å­ã€‚ä¸Šè·¯ä¸­æˆ‘æœ€å–œæ¬¢çš„æ˜¯é”é›¯ï¼Œæ‰“é‡æˆ‘ç©çš„æœ€å¤šï¼Œçº ç»“äº†åŠå¤©é€‰äº†ç›²åƒ§ã€‚ä¸­å•é‡Œå¿…é¡»é€‰äºšç´¢ï¼ŒADCé‡Œé€‰æ‹©äº†æš´èµ°èè‰ï¼Œè¾…åŠ©é‡Œé€‰æ‹©äº†é”¤çŸ³ã€‚&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/7273fd1787764f48a317ffd38730ef42~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/7273fd1787764f48a317ffd38730ef42~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>å…ˆä¸Šä»£ç å†è§£é‡Šï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#6272a4">//æŠ€èƒ½æ¥å£&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">interface&lt;/span> &lt;span style="color:#50fa7b">Skill&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span> &lt;span style="color:#8be9fd">void&lt;/span> &lt;span style="color:#50fa7b">Q&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span> &lt;span style="color:#8be9fd">void&lt;/span> &lt;span style="color:#50fa7b">W&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span> &lt;span style="color:#8be9fd">void&lt;/span> &lt;span style="color:#50fa7b">E&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span> &lt;span style="color:#8be9fd">void&lt;/span> &lt;span style="color:#50fa7b">R&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 10&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 11&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 12&lt;/span>&lt;span>&lt;span style="color:#6272a4">//æ”¾é€ä¹‹åˆƒ-é”é›¯&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 13&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">class&lt;/span> &lt;span style="color:#50fa7b">RuiWen&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">implements&lt;/span> Skill {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 14&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 15&lt;/span>&lt;span> &lt;span style="color:#8be9fd;font-style:italic">public&lt;/span> &lt;span style="color:#50fa7b">RuiWen&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 16&lt;/span>&lt;span> System.&lt;span style="color:#50fa7b">out&lt;/span>.&lt;span style="color:#50fa7b">println&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;æ–­å‰‘é‡é“¸ä¹‹æ—¥,éª‘å£«å½’æ¥ä¹‹æ—¶&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 17&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 18&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 19&lt;/span>&lt;span> @Override
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 20&lt;/span>&lt;span> &lt;span style="color:#8be9fd;font-style:italic">public&lt;/span> &lt;span style="color:#8be9fd">void&lt;/span> &lt;span style="color:#50fa7b">Q&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 21&lt;/span>&lt;span> System.&lt;span style="color:#50fa7b">out&lt;/span>.&lt;span style="color:#50fa7b">println&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;æŠ˜ç¿¼ä¹‹èˆ&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 22&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 23&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 24&lt;/span>&lt;span> @Override
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 25&lt;/span>&lt;span> &lt;span style="color:#8be9fd;font-style:italic">public&lt;/span> &lt;span style="color:#8be9fd">void&lt;/span> &lt;span style="color:#50fa7b">W&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 26&lt;/span>&lt;span> System.&lt;span style="color:#50fa7b">out&lt;/span>.&lt;span style="color:#50fa7b">println&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;éœ‡é­‚æ€’å¼&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 27&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 28&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 29&lt;/span>&lt;span> @Override
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 30&lt;/span>&lt;span> &lt;span style="color:#8be9fd;font-style:italic">public&lt;/span> &lt;span style="color:#8be9fd">void&lt;/span> &lt;span style="color:#50fa7b">E&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 31&lt;/span>&lt;span> System.&lt;span style="color:#50fa7b">out&lt;/span>.&lt;span style="color:#50fa7b">println&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;å‹‡å¾€ç›´å‰&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 32&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 33&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 34&lt;/span>&lt;span> @Override
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 35&lt;/span>&lt;span> &lt;span style="color:#8be9fd;font-style:italic">public&lt;/span> &lt;span style="color:#8be9fd">void&lt;/span> &lt;span style="color:#50fa7b">R&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 36&lt;/span>&lt;span> System.&lt;span style="color:#50fa7b">out&lt;/span>.&lt;span style="color:#50fa7b">println&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;æ”¾é€ä¹‹é”‹&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 37&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 38&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 39&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 40&lt;/span>&lt;span>&lt;span style="color:#6272a4">//ç›²åƒ§-æé’&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 41&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">class&lt;/span> &lt;span style="color:#50fa7b">LiQing&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">implements&lt;/span> Skill {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 42&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 43&lt;/span>&lt;span> &lt;span style="color:#8be9fd;font-style:italic">public&lt;/span> &lt;span style="color:#50fa7b">LiQing&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 44&lt;/span>&lt;span> System.&lt;span style="color:#50fa7b">out&lt;/span>.&lt;span style="color:#50fa7b">println&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;æˆ‘ç”¨åŒæ‰‹æˆå°±ä½ çš„æ¢¦æƒ³&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 45&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 46&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 47&lt;/span>&lt;span> @Override
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 48&lt;/span>&lt;span> &lt;span style="color:#8be9fd;font-style:italic">public&lt;/span> &lt;span style="color:#8be9fd">void&lt;/span> &lt;span style="color:#50fa7b">Q&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 49&lt;/span>&lt;span> System.&lt;span style="color:#50fa7b">out&lt;/span>.&lt;span style="color:#50fa7b">println&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;å¤©éŸ³æ³¢/å›éŸ³å‡»&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 50&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 51&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 52&lt;/span>&lt;span> @Override
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 53&lt;/span>&lt;span> &lt;span style="color:#8be9fd;font-style:italic">public&lt;/span> &lt;span style="color:#8be9fd">void&lt;/span> &lt;span style="color:#50fa7b">W&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 54&lt;/span>&lt;span> System.&lt;span style="color:#50fa7b">out&lt;/span>.&lt;span style="color:#50fa7b">println&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;é‡‘é’Ÿç½©/é“å¸ƒè¡«&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 55&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 56&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 57&lt;/span>&lt;span> @Override
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 58&lt;/span>&lt;span> &lt;span style="color:#8be9fd;font-style:italic">public&lt;/span> &lt;span style="color:#8be9fd">void&lt;/span> &lt;span style="color:#50fa7b">E&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 59&lt;/span>&lt;span> System.&lt;span style="color:#50fa7b">out&lt;/span>.&lt;span style="color:#50fa7b">println&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;å¤©é›·ç ´/æ‘§ç­‹æ–­éª¨&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 60&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 61&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 62&lt;/span>&lt;span> @Override
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 63&lt;/span>&lt;span> &lt;span style="color:#8be9fd;font-style:italic">public&lt;/span> &lt;span style="color:#8be9fd">void&lt;/span> &lt;span style="color:#50fa7b">R&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 64&lt;/span>&lt;span> System.&lt;span style="color:#50fa7b">out&lt;/span>.&lt;span style="color:#50fa7b">println&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;çŒ›é¾™æ‘†å°¾&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 65&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 66&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 67&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 68&lt;/span>&lt;span>&lt;span style="color:#6272a4">//ç–¾é£å‰‘è±ª-äºšç´¢&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 69&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">class&lt;/span> &lt;span style="color:#50fa7b">YaSuo&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">implements&lt;/span> Skill {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 70&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 71&lt;/span>&lt;span> &lt;span style="color:#8be9fd;font-style:italic">public&lt;/span> &lt;span style="color:#50fa7b">YaSuo&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 72&lt;/span>&lt;span> System.&lt;span style="color:#50fa7b">out&lt;/span>.&lt;span style="color:#50fa7b">println&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;æ­»äº¡å¦‚é£,å¸¸ä¼´å¾ç”Ÿ&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 73&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 74&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 75&lt;/span>&lt;span> @Override
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 76&lt;/span>&lt;span> &lt;span style="color:#8be9fd;font-style:italic">public&lt;/span> &lt;span style="color:#8be9fd">void&lt;/span> &lt;span style="color:#50fa7b">Q&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 77&lt;/span>&lt;span> System.&lt;span style="color:#50fa7b">out&lt;/span>.&lt;span style="color:#50fa7b">println&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;æ–©é’¢é—ª&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 78&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 79&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 80&lt;/span>&lt;span> @Override
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 81&lt;/span>&lt;span> &lt;span style="color:#8be9fd;font-style:italic">public&lt;/span> &lt;span style="color:#8be9fd">void&lt;/span> &lt;span style="color:#50fa7b">W&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 82&lt;/span>&lt;span> System.&lt;span style="color:#50fa7b">out&lt;/span>.&lt;span style="color:#50fa7b">println&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;é£ä¹‹éšœå£&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 83&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 84&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 85&lt;/span>&lt;span> @Override
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 86&lt;/span>&lt;span> &lt;span style="color:#8be9fd;font-style:italic">public&lt;/span> &lt;span style="color:#8be9fd">void&lt;/span> &lt;span style="color:#50fa7b">E&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 87&lt;/span>&lt;span> System.&lt;span style="color:#50fa7b">out&lt;/span>.&lt;span style="color:#50fa7b">println&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;è¸å‰æ–©&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 88&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 89&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 90&lt;/span>&lt;span> @Override
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 91&lt;/span>&lt;span> &lt;span style="color:#8be9fd;font-style:italic">public&lt;/span> &lt;span style="color:#8be9fd">void&lt;/span> &lt;span style="color:#50fa7b">R&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 92&lt;/span>&lt;span> System.&lt;span style="color:#50fa7b">out&lt;/span>.&lt;span style="color:#50fa7b">println&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;ç‹‚é£ç»æ¯æ–©&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 93&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 94&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 95&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 96&lt;/span>&lt;span>&lt;span style="color:#6272a4">//æš´èµ°èè‰-é‡‘å…‹æ–¯&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 97&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">class&lt;/span> &lt;span style="color:#50fa7b">JinKeSi&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">implements&lt;/span> Skill {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 98&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 99&lt;/span>&lt;span> &lt;span style="color:#8be9fd;font-style:italic">public&lt;/span> &lt;span style="color:#50fa7b">JinKeSi&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">100&lt;/span>&lt;span> System.&lt;span style="color:#50fa7b">out&lt;/span>.&lt;span style="color:#50fa7b">println&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;è§„åˆ™å°±æ˜¯ç”¨æ¥æ‰“ç ´çš„&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">101&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">102&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">103&lt;/span>&lt;span> @Override
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">104&lt;/span>&lt;span> &lt;span style="color:#8be9fd;font-style:italic">public&lt;/span> &lt;span style="color:#8be9fd">void&lt;/span> &lt;span style="color:#50fa7b">Q&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">105&lt;/span>&lt;span> System.&lt;span style="color:#50fa7b">out&lt;/span>.&lt;span style="color:#50fa7b">println&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;æªç‚®äº¤å“æ›²ï¼&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">106&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">107&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">108&lt;/span>&lt;span> @Override
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">109&lt;/span>&lt;span> &lt;span style="color:#8be9fd;font-style:italic">public&lt;/span> &lt;span style="color:#8be9fd">void&lt;/span> &lt;span style="color:#50fa7b">W&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">110&lt;/span>&lt;span> System.&lt;span style="color:#50fa7b">out&lt;/span>.&lt;span style="color:#50fa7b">println&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;éœ‡è¡ç”µç£æ³¢ï¼&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">111&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">112&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">113&lt;/span>&lt;span> @Override
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">114&lt;/span>&lt;span> &lt;span style="color:#8be9fd;font-style:italic">public&lt;/span> &lt;span style="color:#8be9fd">void&lt;/span> &lt;span style="color:#50fa7b">E&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">115&lt;/span>&lt;span> System.&lt;span style="color:#50fa7b">out&lt;/span>.&lt;span style="color:#50fa7b">println&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;åš¼ç«è€…æ‰‹é›·ï¼&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">116&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">117&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">118&lt;/span>&lt;span> @Override
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">119&lt;/span>&lt;span> &lt;span style="color:#8be9fd;font-style:italic">public&lt;/span> &lt;span style="color:#8be9fd">void&lt;/span> &lt;span style="color:#50fa7b">R&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">120&lt;/span>&lt;span> System.&lt;span style="color:#50fa7b">out&lt;/span>.&lt;span style="color:#50fa7b">println&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;è¶…ç©¶ææ­»ç¥é£å¼¹ï¼&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">121&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">122&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">123&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">124&lt;/span>&lt;span>&lt;span style="color:#6272a4">//é­‚é”å…¸ç‹±é•¿-é”¤çŸ³&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">125&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">class&lt;/span> &lt;span style="color:#50fa7b">ChuiShi&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">implements&lt;/span> Skill {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">126&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">127&lt;/span>&lt;span> &lt;span style="color:#8be9fd;font-style:italic">public&lt;/span> &lt;span style="color:#50fa7b">ChiShi&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">128&lt;/span>&lt;span> System.&lt;span style="color:#50fa7b">out&lt;/span>.&lt;span style="color:#50fa7b">println&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;æˆ‘ä»¬è¦æ€æ ·è¿›è¡Œè¿™ä»¤äººæ„‰æ‚¦çš„æŠ˜ç£¨å‘¢&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">129&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">130&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">131&lt;/span>&lt;span> @Override
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">132&lt;/span>&lt;span> &lt;span style="color:#8be9fd;font-style:italic">public&lt;/span> &lt;span style="color:#8be9fd">void&lt;/span> &lt;span style="color:#50fa7b">Q&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">133&lt;/span>&lt;span> System.&lt;span style="color:#50fa7b">out&lt;/span>.&lt;span style="color:#50fa7b">println&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;æ­»äº¡åˆ¤å†³&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">134&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">135&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">136&lt;/span>&lt;span> @Override
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">137&lt;/span>&lt;span> &lt;span style="color:#8be9fd;font-style:italic">public&lt;/span> &lt;span style="color:#8be9fd">void&lt;/span> &lt;span style="color:#50fa7b">W&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">138&lt;/span>&lt;span> System.&lt;span style="color:#50fa7b">out&lt;/span>.&lt;span style="color:#50fa7b">println&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;é­‚å¼•ä¹‹ç¯&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">139&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">140&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">141&lt;/span>&lt;span> @Override
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">142&lt;/span>&lt;span> &lt;span style="color:#8be9fd;font-style:italic">public&lt;/span> &lt;span style="color:#8be9fd">void&lt;/span> &lt;span style="color:#50fa7b">E&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">143&lt;/span>&lt;span> System.&lt;span style="color:#50fa7b">out&lt;/span>.&lt;span style="color:#50fa7b">println&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;å„è¿é’Ÿæ‘†&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">144&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">145&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">146&lt;/span>&lt;span> @Override
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">147&lt;/span>&lt;span> &lt;span style="color:#8be9fd;font-style:italic">public&lt;/span> &lt;span style="color:#8be9fd">void&lt;/span> &lt;span style="color:#50fa7b">R&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">148&lt;/span>&lt;span> System.&lt;span style="color:#50fa7b">out&lt;/span>.&lt;span style="color:#50fa7b">println&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;å¹½å†¥ç›‘ç‰¢&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">149&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">150&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä»£ç æœ‰ç‚¹å¤šï¼Œä½†æ˜¯å¾ˆç®€å•ï¼Œå†™äº†5ç±»ï¼Œå¯¹åº”5ä¸ªè‹±é›„ã€‚æ¯ä¸ªç±»çš„æ„é€ æ–¹æ³•ä¸­ï¼Œæ‰“å°äº†è¿™ä¸ªè‹±é›„åœ¨æ’ä½ä¸­è¢«é€‰ä¸­æ—¶çš„å°è¯ã€‚æ¯ä¸ªç±»éƒ½å®ç°äº†skillè¿™ä¸ªæ¥å£ï¼Œå¹¶é‡å†™äº†QWERè¿™4ä¸ªæ–¹æ³•ï¼Œåœ¨æ–¹æ³•ä¸­æ‰“å°äº†è¿™ä¸ªè‹±é›„æŠ€èƒ½çš„åç§°ã€‚
åœ¨mainæ–¹æ³•ä¸­åˆå§‹åŒ–è¿™5ä¸ªè‹±é›„ï¼Œå¹¶è°ƒç”¨æ¯ä¸ªè‹±é›„çš„QWERè¿™å››ä¸ªæŠ€èƒ½ï¼Œä»£ç ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">public&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">class&lt;/span> &lt;span style="color:#50fa7b">Main&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span> &lt;span style="color:#8be9fd;font-style:italic">public&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">static&lt;/span> &lt;span style="color:#8be9fd">void&lt;/span> &lt;span style="color:#50fa7b">main&lt;/span>(String&lt;span style="color:#ff79c6">[]&lt;/span> args) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span> &lt;span style="color:#6272a4">//åˆå§‹åŒ–é”é›¯é‡Šï¼Œæ”¾æŠ€èƒ½&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span> Skill ruiWen &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#ff79c6">new&lt;/span> RuiWen();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span> ruiWen.&lt;span style="color:#50fa7b">Q&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span> ruiWen.&lt;span style="color:#50fa7b">W&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span> ruiWen.&lt;span style="color:#50fa7b">E&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span> ruiWen.&lt;span style="color:#50fa7b">R&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span> &lt;span style="color:#6272a4">//åˆå§‹åŒ–æé’ï¼Œé‡Šæ”¾æŠ€èƒ½&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span> Skill liQing &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#ff79c6">new&lt;/span> LiQing();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span> liQing.&lt;span style="color:#50fa7b">Q&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span> liQing.&lt;span style="color:#50fa7b">W&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span> liQing.&lt;span style="color:#50fa7b">E&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15&lt;/span>&lt;span> liQing.&lt;span style="color:#50fa7b">R&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17&lt;/span>&lt;span> &lt;span style="color:#6272a4">//åˆå§‹åŒ–äºšç´¢ï¼Œé‡Šæ”¾æŠ€èƒ½&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18&lt;/span>&lt;span> Skill yaSuo &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#ff79c6">new&lt;/span> YaSuo();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19&lt;/span>&lt;span> yaSuo.&lt;span style="color:#50fa7b">Q&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20&lt;/span>&lt;span> yaSuo.&lt;span style="color:#50fa7b">W&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21&lt;/span>&lt;span> yaSuo.&lt;span style="color:#50fa7b">E&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22&lt;/span>&lt;span> yaSuo.&lt;span style="color:#50fa7b">R&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24&lt;/span>&lt;span> &lt;span style="color:#6272a4">//åˆå§‹åŒ–é‡‘å…‹æ–¯ï¼Œé‡Šæ”¾æŠ€èƒ½&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25&lt;/span>&lt;span> Skill jinKeSi &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#ff79c6">new&lt;/span> JinKeSi();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26&lt;/span>&lt;span> jinKeSi.&lt;span style="color:#50fa7b">Q&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27&lt;/span>&lt;span> jinKeSi.&lt;span style="color:#50fa7b">W&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28&lt;/span>&lt;span> jinKeSi.&lt;span style="color:#50fa7b">E&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29&lt;/span>&lt;span> jinKeSi.&lt;span style="color:#50fa7b">R&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31&lt;/span>&lt;span> &lt;span style="color:#6272a4">//åˆå§‹åŒ–é”¤çŸ³ï¼Œé‡Šæ”¾æŠ€èƒ½&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32&lt;/span>&lt;span> Skill chuiShi &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#ff79c6">new&lt;/span> ChuiShi();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33&lt;/span>&lt;span> chuiShi.&lt;span style="color:#50fa7b">Q&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34&lt;/span>&lt;span> chuiShi.&lt;span style="color:#50fa7b">W&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35&lt;/span>&lt;span> chuiShi.&lt;span style="color:#50fa7b">E&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36&lt;/span>&lt;span> chuiShi.&lt;span style="color:#50fa7b">R&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="æ³¨æ„ä¸€ç‚¹">&lt;a href="#%e6%b3%a8%e6%84%8f%e4%b8%80%e7%82%b9" class="header-anchor">&lt;/a>æ³¨æ„ä¸€ç‚¹ï¼š
&lt;/h2>&lt;p>&lt;strong>æˆ‘ä»¬åœ¨å®ä¾‹åŒ–è¿™5ä¸ªè‹±é›„æ—¶ï¼Œè¿™5ä¸ªè‹±é›„éƒ½æ˜¯Skillç±»å‹çš„&lt;/strong>&lt;/p>
&lt;p>çœ‹ä¸€ä¸‹è¿è¡Œç»“æœï¼š&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-a2d7de70789b7a01.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-a2d7de70789b7a01.webp" alt="" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>å¯ä»¥çœ‹åˆ°ï¼Œè¿™5ä¸ªè‹±é›„ä¾æ¬¡è¢«å®ä¾‹åŒ–ï¼Œå¹¶é‡Šæ”¾äº†QWERè¿™4ä¸ªæŠ€èƒ½ã€‚&lt;/p>
&lt;p>å¯èƒ½åˆ°è¿™æœ‰çš„åŒå­¦æ²¡çœ‹æ‡‚ï¼Œè¿™å’Œæ¥å£æœ‰ä»€ä¹ˆå…³ç³»ï¼Ÿæ¥å£å¸¦æ¥äº†å“ªäº›å¥½å¤„ï¼Ÿ&lt;/p>
&lt;h2 id="ç®€å•åˆ†æä¸€ä¸‹">&lt;a href="#%e7%ae%80%e5%8d%95%e5%88%86%e6%9e%90%e4%b8%80%e4%b8%8b" class="header-anchor">&lt;/a>ç®€å•åˆ†æä¸€ä¸‹:
&lt;/h2>&lt;ol>
&lt;li>æ¥å£è¿™ä¸ªæ¦‚å¿µï¼Œå…¶å®å°±æ˜¯å®šä¹‰äº†ä¸€ç§è§„èŒƒã€‚åœ¨ &lt;strong>Skill&lt;/strong> è¿™ä¸ªæ¥å£ä¸­ï¼Œå®šä¹‰äº†&lt;strong>Qã€Wã€Eã€R&lt;/strong>è¿™å››ä¸ªæ–¹æ³•ï¼Œåªè¦æ˜¯å®ç°äº†è¿™ä¸ªæ¥å£çš„ç±»ï¼Œä¸€å®šä¼šæœ‰è¿™å››ä¸ªæ–¹æ³•ã€‚&lt;/li>
&lt;li>æ¥å£å¯ä»¥çœ‹åšæ˜¯å®ç°å¤šç»§æ‰¿çš„ä¸€ç§æ–¹å¼ï¼ˆè¿™æ ·è¯´å¯èƒ½ä¸ä¸¥è°¨ï¼‰ã€‚javaä¸­æ²¡æœ‰å¤šç»§æ‰¿è¿™ç§æœºåˆ¶ï¼Œå¤±å»äº†ä¸€äº›çµæ´»æ€§ã€‚ä½†æ˜¯å»æ‰å¤šç»§æ‰¿åï¼Œè¯­æ³•ç®€å•äº†å¾ˆå¤šï¼ŒåƒC++ä¸­ï¼Œå› ä¸ºæœ‰å¤šç»§æ‰¿ï¼Œåˆå¼•å…¥äº†è™šç»§æ‰¿çš„æ¦‚å¿µã€‚è¯´å¤šäº†ï¼Œå›åˆ°æ­£é¢˜ã€‚ä¸€ä¸ªç±»å®ç°ä¸€ä¸ªæ¥å£åï¼Œå¯ä»¥çœ‹åšæ˜¯è¿™ä¸ªæ¥å£çš„å­ç±»ï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬åœ¨å®ä¾‹åŒ–è‹±é›„æ—¶ï¼ˆ&lt;code>new Ruiwen()&lt;/code>ç­‰ï¼‰ï¼Œå¯ä»¥ç›´æ¥å®ä¾‹åŒ–ä¸º &lt;strong>Skill&lt;/strong> ç±»å‹çš„ã€‚&lt;/li>
&lt;/ol>
&lt;p>ç»“åˆè¿™ä¸¤ç‚¹ï¼Œæ‰€ä»¥æˆ‘ä»¬æ¯ä¸€ä¸ªSkillç±»å‹çš„å¯¹è±¡ï¼Œéƒ½å¯ä»¥è°ƒç”¨ &lt;strong>Qã€Wã€Eã€R&lt;/strong> è¿™å››ä¸ªæ–¹æ³•ã€‚
æœ‰äººä¼šæå‡ºç–‘é—®ï¼Œæˆ‘åœ¨æ¯ä¸ªç±»ä¸­éƒ½å®šä¹‰ &lt;strong>Qã€Wã€Eã€R&lt;/strong> è¿™å››ä¸ªæ–¹æ³•ä¸å°±è¡Œäº†ã€‚ä½†æ˜¯å¦‚ä½•ä¿è¯æ¯ä¸ªç±»é‡Œéƒ½æœ‰è¿™å››ä¸ªæ–¹æ³•å‘¢ï¼Ÿé€šè¿‡æ¥å£çº¦æŸï¼Œå¯ä»¥ä¿è¯ï¼Œæ‰€æœ‰å®ç°è¿™ä¸ªæ¥å£çš„ç±»ä¸­ï¼Œä¸€å®šæœ‰è¿™å››ä¸ªæ–¹æ³•ã€‚&lt;/p>
&lt;p>å†é€šè¿‡ä¸‹é¢è¿™ä¸ªç”¨æ³•ï¼Œçœ‹ä¸€ä¸‹æ¥å£æ€æ ·å®ç°å¤šæ€çš„ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">import&lt;/span> java.util.Scanner;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">public&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">class&lt;/span> &lt;span style="color:#50fa7b">Main&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span> &lt;span style="color:#8be9fd;font-style:italic">public&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">static&lt;/span> &lt;span style="color:#8be9fd">void&lt;/span> &lt;span style="color:#50fa7b">main&lt;/span>(String&lt;span style="color:#ff79c6">[]&lt;/span> args) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span> Skill hero;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span> Scanner scanner &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#ff79c6">new&lt;/span> Scanner(System.&lt;span style="color:#50fa7b">in&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span> &lt;span style="color:#ff79c6">switch&lt;/span> (scanner.&lt;span style="color:#50fa7b">nextInt&lt;/span>()) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span> &lt;span style="color:#ff79c6">case&lt;/span> 1:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span> hero &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#ff79c6">new&lt;/span> RuiWen();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span> &lt;span style="color:#ff79c6">break&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span> &lt;span style="color:#ff79c6">case&lt;/span> 2:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span> hero &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#ff79c6">new&lt;/span> LiQing();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span> &lt;span style="color:#ff79c6">break&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span> &lt;span style="color:#ff79c6">case&lt;/span> 3:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span> hero &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#ff79c6">new&lt;/span> YaSuo();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15&lt;/span>&lt;span> &lt;span style="color:#ff79c6">break&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16&lt;/span>&lt;span> &lt;span style="color:#ff79c6">case&lt;/span> 4:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17&lt;/span>&lt;span> hero &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#ff79c6">new&lt;/span> JinKeSi();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18&lt;/span>&lt;span> &lt;span style="color:#ff79c6">break&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19&lt;/span>&lt;span> &lt;span style="color:#ff79c6">case&lt;/span> 5:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20&lt;/span>&lt;span> hero &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#ff79c6">new&lt;/span> ChuiShi();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21&lt;/span>&lt;span> &lt;span style="color:#ff79c6">break&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22&lt;/span>&lt;span> &lt;span style="color:#ff79c6">default&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23&lt;/span>&lt;span> hero &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#ff79c6">new&lt;/span> RuiWen();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26&lt;/span>&lt;span> hero.&lt;span style="color:#50fa7b">Q&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27&lt;/span>&lt;span> hero.&lt;span style="color:#50fa7b">W&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28&lt;/span>&lt;span> hero.&lt;span style="color:#50fa7b">E&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29&lt;/span>&lt;span> hero.&lt;span style="color:#50fa7b">R&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ç®€å•çœ‹ä¸€ä¸‹ä»£ç ï¼Œå®šä¹‰äº†ä¸€ä¸ªSkillç±»å‹çš„å˜é‡hreoã€‚é€šè¿‡è¾“å…¥ä¸åŒçš„å€¼ï¼Œæ¥åˆ¤æ–­å®ä¾‹åŒ–å“ªä¸€ä¸ªè‹±é›„ã€‚æœ€åè°ƒç”¨è‹±é›„çš„ &lt;strong>Qã€Wã€Eã€R&lt;/strong> æ–¹æ³•ã€‚&lt;/p>
&lt;p>å…ˆè¾“å…¥ &lt;strong>1&lt;/strong> çœ‹ä¸€ä¸‹ï¼Œè¾“å…¥ &lt;strong>1&lt;/strong> åº”è¯¥æ˜¯å®ä¾‹åŒ–é”é›¯è¿™ä¸ªè‹±é›„&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-a55624be285776f7.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-a55624be285776f7.webp" alt="" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>æ²¡æœ‰é—®é¢˜ï¼Œè¾“å…¥1æˆåŠŸå®ä¾‹åŒ–äº†é”é›¯è¿™ä¸ªè‹±é›„ï¼Œå¹¶è°ƒç”¨äº†é”é›¯çš„å››ä¸ªæŠ€èƒ½ã€‚&lt;/p>
&lt;p>å†æ¢ä¸€ä¸ªè¾“å…¥å€¼çœ‹ä¸€ä¸‹ï¼š&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-4405b601df5f4bdf.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-4405b601df5f4bdf.webp" alt="" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>è¿™æ¬¡è¾“å…¥äº† &lt;strong>2&lt;/strong> ï¼Œå®ä¾‹åŒ–äº†æé’è¿™ä¸ªè‹±é›„ï¼Œå¹¶è°ƒç”¨äº†æé’çš„å››ä¸ªæŠ€èƒ½ã€‚&lt;/p>
&lt;h2 id="ä½¿ç”¨äº†æ¥å£åçš„ä¼˜åŠ¿">&lt;a href="#%e4%bd%bf%e7%94%a8%e4%ba%86%e6%8e%a5%e5%8f%a3%e5%90%8e%e7%9a%84%e4%bc%98%e5%8a%bf" class="header-anchor">&lt;/a>ä½¿ç”¨äº†æ¥å£åçš„ä¼˜åŠ¿ï¼š
&lt;/h2>&lt;ol>
&lt;li>
&lt;p>ä½¿ç”¨æ¥å£åï¼Œå®ç°äº†è¿è¡Œæ—¶å¤šæ€ï¼Œä¹Ÿå°±æ˜¯ &lt;strong>hero&lt;/strong> å…·ä½“æ˜¯å“ªä¸ªç±»çš„å¯¹è±¡ï¼Œåœ¨ç¼–è¯‘é˜¶æ®µæˆ‘ä»¬æ˜¯ä¸çŸ¥é“çš„ï¼Œåªæœ‰å½“ç¨‹åºè¿è¡Œæ—¶ï¼Œé€šè¿‡æˆ‘ä»¬è¾“å…¥çš„å€¼æ‰èƒ½ç¡®å®š &lt;strong>hero&lt;/strong> æ˜¯å“ªä¸ªç±»çš„å¯¹è±¡ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ä½¿ç”¨äº†æ¥å£åï¼Œæ‰€æœ‰å®ç°äº† &lt;strong>Skill&lt;/strong> æ¥å£çš„ç±»ï¼Œéƒ½å¯ä»¥å®ä¾‹åŒ–ä¸º &lt;strong>Skill&lt;/strong> ç±»å‹çš„å¯¹è±¡ã€‚å¦‚æœä¸æ˜¯è¿™æ ·ï¼Œé‚£æœ‰å¤šå°‘ä¸ªè‹±é›„ï¼ˆç±»ï¼‰å°±è¦å®šä¹‰å¤šå°‘ä¸ªå˜é‡ã€‚ç°åœ¨è‹±é›„è”ç›Ÿæœ‰145ä¸ªè‹±é›„ï¼Œé‚£å°±è¦å®šä¹‰145ä¸ªå˜é‡ï¼Œè¿™ã€‚ã€‚ã€‚ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-07f5e774f5b3ba39.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-07f5e774f5b3ba39.webp" alt="" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;/li>
&lt;/ol>
&lt;h2 id="æ€»ç»“">&lt;a href="#%e6%80%bb%e7%bb%93" class="header-anchor">&lt;/a>æ€»ç»“ï¼š
&lt;/h2>&lt;ol>
&lt;li>æ¥å£çš„ä½œç”¨æ˜¯å®šä¹‰äº†å®šä¹‰äº†ä¸€äº›è§„èŒƒï¼ˆä¹Ÿå°±æ˜¯å®šä¹‰äº†ä¸€äº›æ–¹æ³•ï¼‰ï¼Œæ‰€æœ‰å®ç°äº†è¿™ä¸ªæ¥å£çš„ç±»ï¼Œå¿…é¡»è¦éµå®ˆè¿™äº›è§„èŒƒï¼ˆç±»ä¸­ä¸€å®šæœ‰è¿™äº›æ–¹æ³•ï¼‰&lt;/li>
&lt;li>ä¸€ä¸ªç±»å®ç°äº†ä¸€ä¸ªæ¥å£ï¼Œ &lt;strong>å¯ä»¥çœ‹åš&lt;/strong> æ˜¯è¿™ä¸ªæ¥å£çš„å­ç±»ï¼Œæ³¨æ„æ˜¯å¯ä»¥çœ‹åšã€‚å­ç±»ç±»å‹å¯ä»¥è‡ªåŠ¨è½¬æ¢ä¸ºçˆ¶ç±»ç±»å‹ï¼Œæ‰€ä»¥ä»»ä½•å‡ºç°æ¥å£çš„åœ°æ–¹ï¼Œéƒ½å¯ä»¥ä½¿ç”¨å®ç°è¿™ä¸ªæ¥å£çš„ç±»çš„å¯¹è±¡ä»£æ›¿ã€‚æœ€å¸¸è§çš„å°±æ˜¯æ–¹æ³•ä¸­ä¼ å‚ï¼Œå®šä¹‰ä¸€ä¸ªæ¥å£ç±»å‹çš„å˜é‡ï¼Œä¼ å…¥ä¸€ä¸ªå®ç°äº†æ¥å£çš„å¯¹è±¡ã€‚&lt;/li>
&lt;/ol>
&lt;p>æœ€åï¼šæ–‡ç« æ˜¯ä¸‹ç­ååŠå¤œå†™çš„ï¼ŒåŠ ä¸Šè‡ªèº«èƒ½åŠ›æœ‰é™ï¼Œæ–‡ä¸­å¦‚æœ‰ä¸æ­£ç¡®çš„åœ°æ–¹ï¼Œæ¬¢è¿è¯„è®ºåŒºæ¢è®¨ï¼Œå…±åŒæé«˜ã€‚&lt;/p></description></item><item><title>golangä¸­ type func() ç”¨æ³•</title><link>https://lqxhub.github.io/posts/20b9663a/</link><pubDate>Sun, 25 Aug 2019 18:50:33 +0000</pubDate><guid>https://lqxhub.github.io/posts/20b9663a/</guid><description>&lt;p>åœ¨çœ‹golang çš„httpæœåŠ¡éƒ¨åˆ†ä»£ç æ—¶ï¼Œè¢«golang ä¸­çš„ type func()å†™æ³•éš¾ä½äº†ï¼Œä¸€æ—¶æ²¡çœ‹æ‡‚ä»£ç ã€‚åæ¥æŸ¥èµ„æ–™åï¼Œæœ‰äº†ä¸€ç‚¹ç†è§£ã€‚&lt;/p>
&lt;p>åœ¨golangä¸­å¯ä»¥é€šè¿‡è¿™æ ·ç®€å•å®ç°ä¸€ä¸ªhttpæœåŠ¡&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">package&lt;/span> main
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span>&lt;span style="color:#ff79c6">import&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;net/http&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> &lt;span style="color:#50fa7b">mHttp&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span> http.&lt;span style="color:#50fa7b">HandleFunc&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;/&amp;#34;&lt;/span>, h)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span> http.&lt;span style="color:#50fa7b">ListenAndServe&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;0.0.0.0:8888&amp;#34;&lt;/span>,&lt;span style="color:#ff79c6">nil&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> &lt;span style="color:#50fa7b">h&lt;/span>(w http.ResponseWriter, r &lt;span style="color:#ff79c6">*&lt;/span>http.Request) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>http.HandleFunc()&lt;/code>æ˜¯ä¸€ä¸ªæ³¨å†Œå‡½æ•°ï¼Œä¼ ä¸€ä¸ªstringç±»å‹çš„è·¯ç”±ï¼Œå’Œä¸€ä¸ªå‡½æ•°ï¼Œå‡½æ•°çš„å‚æ•°ä¸º&lt;code>(http.ResponseWriter, *http.Request)&lt;/code>ã€‚è·Ÿè¸ªè¿›å…¥å‡½æ•°ï¼Œåœ¨golang æºç net/http/server.goæ–‡ä»¶ä¸­&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">func&lt;/span> HandleFunc(pattern string, handler &lt;span style="color:#ff79c6">func&lt;/span>(ResponseWriter, &lt;span style="color:#ff79c6">*&lt;/span>Request)) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span> DefaultServeMux&lt;span style="color:#ff79c6">.&lt;/span>HandleFunc(pattern, handler)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>åœ¨&lt;strong>HandleFunc&lt;/strong>è°ƒç”¨äº†&lt;code> DefaultServeMux.HandleFunc(pattern, handler)&lt;/code>
è‡³äºè¿™äº›å‡½æ•°æ˜¯å¹²å•¥çš„å…ˆä¸åšæ¢è®¨ï¼Œè¿™ä¸æ˜¯æœ¬æ–‡çš„é‡ç‚¹ã€‚
å†æ¬¡è·Ÿè¿›å‡½æ•°&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> (mux &lt;span style="color:#ff79c6">*&lt;/span>ServeMux) &lt;span style="color:#50fa7b">HandleFunc&lt;/span>(pattern &lt;span style="color:#8be9fd">string&lt;/span>, handler &lt;span style="color:#8be9fd;font-style:italic">func&lt;/span>(ResponseWriter, &lt;span style="color:#ff79c6">*&lt;/span>Request)) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> handler &lt;span style="color:#ff79c6">==&lt;/span> &lt;span style="color:#ff79c6">nil&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3&lt;/span>&lt;span> &lt;span style="color:#8be9fd;font-style:italic">panic&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;http: nil handler&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5&lt;/span>&lt;span> mux.&lt;span style="color:#50fa7b">Handle&lt;/span>(pattern, &lt;span style="color:#50fa7b">HandlerFunc&lt;/span>(handler))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>åœ¨&lt;strong>mux.Handle(pattern, HandlerFunc(handler))&lt;/strong> çš„ç¬¬äºŒä¸ªå‚æ•°&lt;code>HandlerFunc(handler)&lt;/code>æ˜¯ä»€ä¹ˆé¬¼ã€‚
è·Ÿè¿›çœ‹ä¸€ä¸‹&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">type&lt;/span> HandlerFunc &lt;span style="color:#8be9fd;font-style:italic">func&lt;/span>(ResponseWriter, &lt;span style="color:#ff79c6">*&lt;/span>Request)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> (f HandlerFunc) &lt;span style="color:#50fa7b">ServeHTTP&lt;/span>(w ResponseWriter, r &lt;span style="color:#ff79c6">*&lt;/span>Request) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4&lt;/span>&lt;span> &lt;span style="color:#50fa7b">f&lt;/span>(w, r)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>åŸæ¥&lt;strong>HandlerFunc&lt;/strong> æ˜¯ç”¨ &lt;strong>type&lt;/strong> å®šä¹‰çš„å‡½æ•°ï¼Œè€Œå‡½æ•°çš„ç±»å‹å°±æ˜¯æœ€å¼€å§‹ä¼ å…¥çš„ç±»å‹&lt;code>func(ResponseWriter, *Request)&lt;/code>
&lt;strong>ServeHTTP&lt;/strong>æ˜¯&lt;strong>HandlerFunc&lt;/strong>çš„ä¸€ä¸ªæ–¹æ³•ï¼ˆæ³¨æ„ä¸€ä¸‹ï¼Œgolangä¸­æ–¹æ³•å’Œå‡½æ•°ä¸æ˜¯ä¸€å›äº‹ï¼‰ã€‚å¹¶ä¸”&lt;strong>HandlerFunc&lt;/strong>å®ç°äº† &lt;strong>Handler&lt;/strong>æ¥å£
Handleræ¥å£å®šä¹‰:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">type&lt;/span> Handler &lt;span style="color:#8be9fd;font-style:italic">interface&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span> &lt;span style="color:#50fa7b">ServeHTTP&lt;/span>(ResponseWriter, &lt;span style="color:#ff79c6">*&lt;/span>Request)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å›åˆ°&lt;strong>HandleFunc&lt;/strong>æ–¹æ³•ä¸­ï¼Œ&lt;code>mux.Handle(pattern, HandlerFunc(handler))&lt;/code>çš„ç¬¬äºŒä¸ªå‚æ•°æ˜¯æŠŠä¼ å…¥çš„å‡½æ•° &lt;strong>handler&lt;/strong> å¼ºè½¬æˆ &lt;strong>HandlerFunc&lt;/strong>ç±»å‹ï¼Œè¿™æ ·&lt;strong>handler&lt;/strong>å°±å®ç°äº†Handleræ¥å£ã€‚
åˆ°è¿™æˆ‘ä»¬æ˜ç™½&lt;code>HandlerFunc(handler)&lt;/code> æ˜¯æŠŠæ™®é€šå‡½æ•°å¼ºè½¬æˆtypeå®šä¹‰çš„å‡½æ•°ã€‚
ç°åœ¨å†™ä¸€ä¸ªç®€å•çš„demoéªŒè¯ä¸€ä¸‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">package&lt;/span> main
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span>&lt;span style="color:#ff79c6">import&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;fmt&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> &lt;span style="color:#50fa7b">main&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span> &lt;span style="color:#50fa7b">one&lt;/span>(&lt;span style="color:#bd93f9">2&lt;/span>, callback)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span>&lt;span style="color:#6272a4">//éœ€è¦ä¼ é€’å‡½æ•°
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> &lt;span style="color:#50fa7b">callback&lt;/span>(i &lt;span style="color:#8be9fd">int&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span> fmt.&lt;span style="color:#50fa7b">Println&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;i am callBack&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span> fmt.&lt;span style="color:#50fa7b">Println&lt;/span>(i)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15&lt;/span>&lt;span>&lt;span style="color:#6272a4">//mainä¸­è°ƒç”¨çš„å‡½æ•°
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> &lt;span style="color:#50fa7b">one&lt;/span>(i &lt;span style="color:#8be9fd">int&lt;/span>, f &lt;span style="color:#8be9fd;font-style:italic">func&lt;/span>(&lt;span style="color:#8be9fd">int&lt;/span>)) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17&lt;/span>&lt;span> &lt;span style="color:#50fa7b">two&lt;/span>(i, &lt;span style="color:#50fa7b">fun&lt;/span>(f))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20&lt;/span>&lt;span>&lt;span style="color:#6272a4">//one()ä¸­è°ƒç”¨çš„å‡½æ•°
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> &lt;span style="color:#50fa7b">two&lt;/span>(i &lt;span style="color:#8be9fd">int&lt;/span>, c Call) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22&lt;/span>&lt;span> c.&lt;span style="color:#50fa7b">call&lt;/span>(i)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25&lt;/span>&lt;span>&lt;span style="color:#6272a4">//å®šä¹‰çš„typeå‡½æ•°
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span>&lt;span style="color:#8be9fd;font-style:italic">type&lt;/span> fun &lt;span style="color:#8be9fd;font-style:italic">func&lt;/span>(&lt;span style="color:#8be9fd">int&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28&lt;/span>&lt;span>&lt;span style="color:#6272a4">//funå®ç°çš„Callæ¥å£çš„call()å‡½æ•°
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> (f fun) &lt;span style="color:#50fa7b">call&lt;/span>(i &lt;span style="color:#8be9fd">int&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30&lt;/span>&lt;span> &lt;span style="color:#50fa7b">f&lt;/span>(i)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33&lt;/span>&lt;span>&lt;span style="color:#6272a4">//æ¥å£
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span>&lt;span style="color:#8be9fd;font-style:italic">type&lt;/span> Call &lt;span style="color:#8be9fd;font-style:italic">interface&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35&lt;/span>&lt;span> &lt;span style="color:#50fa7b">call&lt;/span>(&lt;span style="color:#8be9fd">int&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å…ˆçœ‹ä¸€ä¸‹ç¨‹åºçš„è¿è¡Œç»“æœ:
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-4c3267ec6e9d7972.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-4c3267ec6e9d7972.webp" alt="" />
&lt;/a>
&lt;/div>
æˆ‘ä»¬åœ¨ &lt;code>main()&lt;/code> å‡½æ•°ä¸­è°ƒç”¨äº† &lt;code>one()&lt;/code> å‡½æ•°ï¼Œå¹¶ä¼ å…¥äº† &lt;code>callback()&lt;/code> å‡½æ•°ï¼Œæœ€ç»ˆè°ƒç”¨äº†æˆ‘ä»¬ä¼ å…¥çš„ &lt;code>callback()&lt;/code> å‡½æ•°ã€‚&lt;/p>
&lt;h6 id="ç†ä¸€ä¸‹æ€è·¯">&lt;a href="#%e7%90%86%e4%b8%80%e4%b8%8b%e6%80%9d%e8%b7%af" class="header-anchor">&lt;/a>ç†ä¸€ä¸‹æ€è·¯ï¼š
&lt;/h6>&lt;p>ä½¿ç”¨ &lt;code>type&lt;/code> å®šä¹‰å‡½æ•° &lt;code>func(int)&lt;/code>
å®šä¹‰ &lt;code>Call&lt;/code> æ¥å£ï¼ŒCallä¸­æœ‰ä¸€ä¸ªå‡½æ•° &lt;code>call(int)&lt;/code>
åœ¨ &lt;code>main()&lt;/code> ä¸­è°ƒç”¨ &lt;code>one(2, callback)&lt;/code>ï¼Œåœ¨ &lt;code>one()&lt;/code> ä¸­è°ƒç”¨ &lt;code>two()&lt;/code>ï¼Œä¼ å…¥&lt;code>two()&lt;/code> å‡½æ•°å‰ï¼Œå¯¹callbackå‡½æ•°å®ç°äº†ç±»å‹è½¬æ¢ï¼Œä»æ™®é€šå‡½æ•°è½¬æ¢æˆtypeå®šä¹‰çš„å‡½æ•°ã€‚
åœ¨ &lt;code>two()&lt;/code> ä¸­è°ƒç”¨ä¼ å…¥çš„ &lt;code>c&lt;/code> å› ä¸º &lt;code>c&lt;/code> å®ç°äº† &lt;code>Call&lt;/code> æ¥å£ï¼Œæ‰€ä»¥å¯ä»¥è°ƒç”¨ &lt;code>call()&lt;/code> å‡½æ•°ï¼Œæœ€ç»ˆè°ƒç”¨äº†æˆ‘ä»¬ä¼ å…¥çš„ &lt;code>callback()&lt;/code> å‡½æ•°ã€‚&lt;/p>
&lt;h6 id="å…³äºgolangä¸­-type-func-ç”¨æ³•å…ˆåˆ†æåˆ°è¿™å§æœ‰ä¸åŒçš„è§è§£æ¬¢è¿è¯„è®ºåŒºæ¢è®¨">&lt;a href="#%e5%85%b3%e4%ba%8egolang%e4%b8%ad-type-func-%e7%94%a8%e6%b3%95%e5%85%88%e5%88%86%e6%9e%90%e5%88%b0%e8%bf%99%e5%90%a7%e6%9c%89%e4%b8%8d%e5%90%8c%e7%9a%84%e8%a7%81%e8%a7%a3%e6%ac%a2%e8%bf%8e%e8%af%84%e8%ae%ba%e5%8c%ba%e6%8e%a2%e8%ae%a8" class="header-anchor">&lt;/a>å…³äºgolangä¸­ type func() ç”¨æ³•å…ˆåˆ†æåˆ°è¿™å§ï¼Œæœ‰ä¸åŒçš„è§è§£ï¼Œæ¬¢è¿è¯„è®ºåŒºæ¢è®¨
&lt;/h6></description></item><item><title>golang cannot assign to XXX é”™è¯¯</title><link>https://lqxhub.github.io/posts/f0f408a8/</link><pubDate>Mon, 19 Aug 2019 22:42:43 +0000</pubDate><guid>https://lqxhub.github.io/posts/f0f408a8/</guid><description>&lt;p>ä»Šå¤©åœ¨ç¼–è¯‘golangé¡¹ç›®æ—¶,é‡åˆ°äº†ä¸€ä¸ªé”™è¯¯ã€‚ç¼–è¯‘å™¨æç¤º &lt;code>cannot assign to m[1][1]&lt;/code>&lt;/p>
&lt;p>åŸé¡¹ç›®å¤ªå¤§äº†ï¼Œä¸è´´äº†ä»£ç å¤§ä½“æ˜¯è¿™æ ·çš„&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">package&lt;/span> main
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> &lt;span style="color:#50fa7b">main&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4&lt;/span>&lt;span> m &lt;span style="color:#ff79c6">:=&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">make&lt;/span>(&lt;span style="color:#8be9fd;font-style:italic">map&lt;/span>[&lt;span style="color:#8be9fd">int&lt;/span>][&lt;span style="color:#bd93f9">2&lt;/span>]&lt;span style="color:#8be9fd">int&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5&lt;/span>&lt;span> a &lt;span style="color:#ff79c6">:=&lt;/span> [&lt;span style="color:#bd93f9">2&lt;/span>]&lt;span style="color:#8be9fd">int&lt;/span>{&lt;span style="color:#bd93f9">1&lt;/span>, &lt;span style="color:#bd93f9">2&lt;/span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6&lt;/span>&lt;span> m[&lt;span style="color:#bd93f9">1&lt;/span>] = a
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8&lt;/span>&lt;span> m[&lt;span style="color:#bd93f9">1&lt;/span>][&lt;span style="color:#bd93f9">1&lt;/span>] = &lt;span style="color:#bd93f9">3&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">9&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ç¼–è¯‘å™¨æç¤ºï¼Œä¸èƒ½å–åˆ°m[1][1]çš„åœ°å€ã€‚
ä½†æ˜¯ä½¿ç”¨ &lt;strong>fmt&lt;/strong> èƒ½æ‰“å°å‡ºæ•°å€¼&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">package&lt;/span> main
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span>&lt;span style="color:#ff79c6">import&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;fmt&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> &lt;span style="color:#50fa7b">main&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span> m &lt;span style="color:#ff79c6">:=&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">make&lt;/span>(&lt;span style="color:#8be9fd;font-style:italic">map&lt;/span>[&lt;span style="color:#8be9fd">int&lt;/span>][&lt;span style="color:#bd93f9">2&lt;/span>]&lt;span style="color:#8be9fd">int&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span> a &lt;span style="color:#ff79c6">:=&lt;/span> [&lt;span style="color:#bd93f9">2&lt;/span>]&lt;span style="color:#8be9fd">int&lt;/span>{&lt;span style="color:#bd93f9">1&lt;/span>, &lt;span style="color:#bd93f9">2&lt;/span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span> m[&lt;span style="color:#bd93f9">1&lt;/span>] = a
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span> &lt;span style="color:#6272a4">// m[1][1] = 3
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> fmt.&lt;span style="color:#50fa7b">Println&lt;/span>(m[&lt;span style="color:#bd93f9">1&lt;/span>][&lt;span style="color:#bd93f9">1&lt;/span>])
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æ‰“å°ç»“æœ
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-0386473ce24ce34d.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-0386473ce24ce34d.webp" alt="" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;hr>
&lt;p>æƒ³äº†ä¸€ä¸‹ï¼Œgoä¸­çš„æ•°ç»„å’Œåˆ‡ç‰‡(Slice)çš„å’Œæ•°ç»„(Array)æ˜¯ä¸ä¸€æ ·çš„ï¼Œsliceæ˜¯å¼•ç”¨ä¼ é€’ï¼Œarrayæ˜¯å€¼ä¼ é€’ã€‚æŠŠ &lt;code>a&lt;/code> æ¢æˆsliceè¯•ä¸€ä¸‹
ä»£ç å¦‚ä¸‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">package&lt;/span> main
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span>&lt;span style="color:#ff79c6">import&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;fmt&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> &lt;span style="color:#50fa7b">main&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span> m &lt;span style="color:#ff79c6">:=&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">make&lt;/span>(&lt;span style="color:#8be9fd;font-style:italic">map&lt;/span>[&lt;span style="color:#8be9fd">int&lt;/span>][]&lt;span style="color:#8be9fd">int&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span> a &lt;span style="color:#ff79c6">:=&lt;/span> []&lt;span style="color:#8be9fd">int&lt;/span>{&lt;span style="color:#bd93f9">1&lt;/span>, &lt;span style="color:#bd93f9">2&lt;/span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span> m[&lt;span style="color:#bd93f9">1&lt;/span>] = a
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span> m[&lt;span style="color:#bd93f9">1&lt;/span>][&lt;span style="color:#bd93f9">1&lt;/span>] = &lt;span style="color:#bd93f9">3&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span> fmt.&lt;span style="color:#50fa7b">Println&lt;/span>(m[&lt;span style="color:#bd93f9">1&lt;/span>][&lt;span style="color:#bd93f9">1&lt;/span>])
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ç¼–è¯‘é€šè¿‡ï¼Œæ²¡æœ‰é—®é¢˜ã€‚&lt;/p>
&lt;hr>
&lt;p>é—®é¢˜æ‰¾åˆ°äº†ï¼Œæ˜¯å› ä¸ºå€¼ä¼ é€’å¯¼è‡´çš„é—®é¢˜ï¼Œè§£å†³åŠæ³•æœ‰ä¸‰ç§
1 . åƒä¸Šé¢ä¸€æ ·ï¼Œä½¿ç”¨sliceä»£æ›¿arrayã€‚
2 . ä¸ç›´æ¥ä¿®æ”¹æ•°ç»„çš„å€¼ï¼Œä¿®æ”¹å€¼æ—¶ï¼Œé‡æ–°åˆ›å»ºæ•°ç»„ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">package&lt;/span> main
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span>&lt;span style="color:#ff79c6">import&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;fmt&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> &lt;span style="color:#50fa7b">main&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span> m &lt;span style="color:#ff79c6">:=&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">make&lt;/span>(&lt;span style="color:#8be9fd;font-style:italic">map&lt;/span>[&lt;span style="color:#8be9fd">int&lt;/span>][&lt;span style="color:#bd93f9">2&lt;/span>]&lt;span style="color:#8be9fd">int&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span> a &lt;span style="color:#ff79c6">:=&lt;/span> [&lt;span style="color:#bd93f9">2&lt;/span>]&lt;span style="color:#8be9fd">int&lt;/span>{&lt;span style="color:#bd93f9">1&lt;/span>, &lt;span style="color:#bd93f9">2&lt;/span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span> m[&lt;span style="color:#bd93f9">1&lt;/span>] = a
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span> fmt.&lt;span style="color:#50fa7b">Println&lt;/span>(m)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span> b &lt;span style="color:#ff79c6">:=&lt;/span> [&lt;span style="color:#bd93f9">2&lt;/span>]&lt;span style="color:#8be9fd">int&lt;/span>{&lt;span style="color:#bd93f9">3&lt;/span>, &lt;span style="color:#bd93f9">4&lt;/span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span> m[&lt;span style="color:#bd93f9">1&lt;/span>] = b
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span> fmt.&lt;span style="color:#50fa7b">Println&lt;/span>(m)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ç»“æœå¦‚ä¸‹ï¼š
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-7011bb871af9e725.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-7011bb871af9e725.webp" alt="" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>3 .ä½¿ç”¨æŒ‡å‘æ•°ç»„çš„æŒ‡é’ˆï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">package&lt;/span> main
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span>&lt;span style="color:#ff79c6">import&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;fmt&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> &lt;span style="color:#50fa7b">main&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span> m &lt;span style="color:#ff79c6">:=&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">make&lt;/span>(&lt;span style="color:#8be9fd;font-style:italic">map&lt;/span>[&lt;span style="color:#8be9fd">int&lt;/span>]&lt;span style="color:#ff79c6">*&lt;/span>[&lt;span style="color:#bd93f9">2&lt;/span>]&lt;span style="color:#8be9fd">int&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span> a &lt;span style="color:#ff79c6">:=&lt;/span> &lt;span style="color:#ff79c6">&amp;amp;&lt;/span>[&lt;span style="color:#bd93f9">2&lt;/span>]&lt;span style="color:#8be9fd">int&lt;/span>{&lt;span style="color:#bd93f9">1&lt;/span>, &lt;span style="color:#bd93f9">2&lt;/span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span> m[&lt;span style="color:#bd93f9">1&lt;/span>] = a
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span> fmt.&lt;span style="color:#50fa7b">Println&lt;/span>(m[&lt;span style="color:#bd93f9">1&lt;/span>])
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span> m[&lt;span style="color:#bd93f9">1&lt;/span>][&lt;span style="color:#bd93f9">1&lt;/span>] = &lt;span style="color:#bd93f9">3&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span> fmt.&lt;span style="color:#50fa7b">Println&lt;/span>(m[&lt;span style="color:#bd93f9">1&lt;/span>])
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ç»“æœå¦‚ä¸‹ï¼š
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-1cca642c76386294.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-1cca642c76386294.webp" alt="" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;h2 id="æ²¡æœ‰é—®é¢˜å¯ä»¥ä¿®æ”¹å€¼">&lt;a href="#%e6%b2%a1%e6%9c%89%e9%97%ae%e9%a2%98%e5%8f%af%e4%bb%a5%e4%bf%ae%e6%94%b9%e5%80%bc" class="header-anchor">&lt;/a>æ²¡æœ‰é—®é¢˜ï¼Œå¯ä»¥ä¿®æ”¹å€¼
&lt;/h2>&lt;p>åœ¨ç½‘ä¸Šæœç´¢æ²¡æœ‰æ‰¾åˆ°æ·±å…¥ç‚¹åˆ†æçš„æ–‡ç« ï¼Œæœ€ç»ˆåœ¨stack overflowä¸­æ‰¾åˆ°äº†ä¸€ä¸ªæŒºå¥½çš„åˆ†æ&lt;a class="link" href="https://stackoverflow.com/questions/32751537/why-do-i-get-a-cannot-assign-error-when-setting-value-to-a-struct-as-a-value-i" target="_blank" rel="noopener"
>ä¼ é€é—¨&lt;/a>
åŸæ–‡ï¼š&lt;/p>
&lt;blockquote>
&lt;p>&lt;code>p[&amp;quot;HM&amp;quot;]&lt;/code>Â isn&amp;rsquo;t quite a regularÂ &lt;a class="link" href="https://golang.org/ref/spec#Address_operators" target="_blank" rel="noopener"
>addressable&lt;/a>Â value:Â &lt;a class="link" href="https://en.wikipedia.org/wiki/Hash_table#Dynamic_resizing" target="_blank" rel="noopener"
>hashmaps can grow at runtime&lt;/a>, and then their values get moved around in memory, and the old locations become outdated. If values in maps were treated as regular addressable values, those internals of theÂ &lt;code>map&lt;/code>Â implementation would get exposed.
è‹±æ–‡æ¯”è¾ƒæ¸£ï¼Œå¤§ä½“çœ‹æ‡‚äº†ä¸€ç‚¹æ„æ€ã€‚æˆ‘ç†è§£çš„ï¼Œåº”è¯¥æ˜¯åœ¨ç¨‹åºæ‰§è¡Œè¿‡ç¨‹ä¸­mapçš„é•¿åº¦ä¼šå˜åŒ–ï¼Œä¸ºäº†mapå€¼çš„æ­£ç¡®ï¼Œgoè¯­è¨€ä¸å…è®¸ç›´æ¥ä¿®æ”¹mapä¸­çš„å€¼ç±»å‹ç»“æ„ã€‚&lt;/p>
&lt;/blockquote>
&lt;hr>
&lt;p>åœ¨æƒ³å¦ä¸€ç§æƒ…å†µ:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">package&lt;/span> main
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span>&lt;span style="color:#ff79c6">import&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;fmt&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> &lt;span style="color:#50fa7b">main&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span> m &lt;span style="color:#ff79c6">:=&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">make&lt;/span>(&lt;span style="color:#8be9fd;font-style:italic">map&lt;/span>[&lt;span style="color:#8be9fd">int&lt;/span>]T)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span> t &lt;span style="color:#ff79c6">:=&lt;/span> T{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span> One: &lt;span style="color:#bd93f9">1&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span> Two: &lt;span style="color:#bd93f9">2&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span> m[&lt;span style="color:#bd93f9">1&lt;/span>] = t
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span> fmt.&lt;span style="color:#50fa7b">Println&lt;/span>(m)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span> m[&lt;span style="color:#bd93f9">1&lt;/span>].Two = &lt;span style="color:#bd93f9">3&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span> fmt.&lt;span style="color:#50fa7b">Println&lt;/span>(m[&lt;span style="color:#bd93f9">1&lt;/span>])
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">type&lt;/span> T &lt;span style="color:#8be9fd;font-style:italic">struct&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18&lt;/span>&lt;span> One &lt;span style="color:#8be9fd">int&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19&lt;/span>&lt;span> Two &lt;span style="color:#8be9fd">int&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿è¡Œï¼š
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-18bbf69cc4188e66.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-18bbf69cc4188e66.webp" alt="" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>ç¼–è¯‘å™¨æç¤ºåŒæ ·çš„é”™è¯¯
æ¢æˆæŒ‡é’ˆåï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">package&lt;/span> main
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span>&lt;span style="color:#ff79c6">import&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;fmt&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> &lt;span style="color:#50fa7b">main&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span> m &lt;span style="color:#ff79c6">:=&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">make&lt;/span>(&lt;span style="color:#8be9fd;font-style:italic">map&lt;/span>[&lt;span style="color:#8be9fd">int&lt;/span>]&lt;span style="color:#ff79c6">*&lt;/span>T)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span> t &lt;span style="color:#ff79c6">:=&lt;/span> &lt;span style="color:#ff79c6">&amp;amp;&lt;/span>T{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span> One: &lt;span style="color:#bd93f9">1&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span> Two: &lt;span style="color:#bd93f9">2&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span> m[&lt;span style="color:#bd93f9">1&lt;/span>] = t
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span> fmt.&lt;span style="color:#50fa7b">Println&lt;/span>(m[&lt;span style="color:#bd93f9">1&lt;/span>])
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span> m[&lt;span style="color:#bd93f9">1&lt;/span>].Two = &lt;span style="color:#bd93f9">3&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span> fmt.&lt;span style="color:#50fa7b">Println&lt;/span>(m[&lt;span style="color:#bd93f9">1&lt;/span>])
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">type&lt;/span> T &lt;span style="color:#8be9fd;font-style:italic">struct&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18&lt;/span>&lt;span> One &lt;span style="color:#8be9fd">int&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19&lt;/span>&lt;span> Two &lt;span style="color:#8be9fd">int&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="httpscdnjsdelivrnetghlqxhubimagesmasterblog3622259-f7dc6344d965234bwebp">&lt;a href="#httpscdnjsdelivrnetghlqxhubimagesmasterblog3622259-f7dc6344d965234bwebp" class="header-anchor">&lt;/a>è¿è¡Œï¼š
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-f7dc6344d965234b.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-f7dc6344d965234b.webp" alt="" />
&lt;/a>
&lt;/div>
&lt;/h2>&lt;h2 id="å…ˆæ€»ç»“åˆ°è¿™æŠŠ996ç¡®å®æœ‰ç‚¹ç´¯æ—©ç¡æ—©èµ·å¤šæ¬ç –">&lt;a href="#%e5%85%88%e6%80%bb%e7%bb%93%e5%88%b0%e8%bf%99%e6%8a%8a996%e7%a1%ae%e5%ae%9e%e6%9c%89%e7%82%b9%e7%b4%af%e6%97%a9%e7%9d%a1%e6%97%a9%e8%b5%b7%e5%a4%9a%e6%90%ac%e7%a0%96" class="header-anchor">&lt;/a>å…ˆæ€»ç»“åˆ°è¿™æŠŠï¼Œ996ç¡®å®æœ‰ç‚¹ç´¯ã€‚æ—©ç¡æ—©èµ·å¤šæ¬ç –
&lt;/h2></description></item><item><title>golangå¼ºåˆ¶ç±»å‹è½¬æ¢</title><link>https://lqxhub.github.io/posts/7395675/</link><pubDate>Mon, 01 Jul 2019 23:36:03 +0000</pubDate><guid>https://lqxhub.github.io/posts/7395675/</guid><description>&lt;p>golangæ˜¯ä¸€ç§å¼ºç±»å‹è¯­è¨€ï¼Œè™½ç„¶åœ¨ä»£ç ä¸­ç»å¸¸çœ‹åˆ°è¿™ç§å†™æ³•ï¼Œ&lt;code>i:=10&lt;/code>è¿™å…¶å®è¿™æ˜¯ç¼–è¯‘å™¨è‡ªåŠ¨åšäº†ç±»å‹æ¨æ–­åœ¨ç¼–è¯‘æœŸé—´ã€‚ç¼–è¯‘å™¨ä¼šå¯¹æ•°æ®è¿›è¡Œç±»å‹æ£€æŸ¥ã€‚ä¸åŒç±»å‹çš„æ•°æ®ä¸èƒ½èµ‹å€¼,ä¸èƒ½åœ¨å‡½æ•°ä¸­ä¼ å‚ã€‚å¼ºç±»å‹è¯­è¨€æœ‰ä¸€äº›ä¼˜åŠ¿ï¼Œå¾ˆå¤šçš„é”™è¯¯ä¼šåœ¨ç¼–è¯‘æœŸé—´è¢«æ£€æŸ¥å‡ºæ¥ï¼Œä¸æƒ³phpå’Œpythonç­‰å¼±ç±»å‹è¯­è¨€ï¼Œå¾ˆå¤šé”™è¯¯åªæœ‰è¿è¡Œåˆ°æ‰èƒ½è¢«å‘ç°ã€‚åŒæ ·ï¼Œå¼ºç±»å‹ä¹Ÿæœ‰ä¸€äº›ç¼ºç‚¹ï¼Œå†™ä»£ç çš„æ—¶å€™è¦è€ƒè™‘æ•°æ®ç±»å‹äº†ï¼Œå¤±å»äº†ä¸€äº›çµæ´»æ€§ã€‚&lt;/p>
&lt;p>&lt;strong>è¨€å½’æ­£ä¼ ï¼Œå¼€å§‹golangçš„ç±»å‹è½¬æ¢é—®é¢˜&lt;/strong>
golangçš„ç±»å‹è½¬æ¢å’ŒC/C++ javaç­‰è¯­è¨€çš„ç±»å‹è½¬æ¢è¿˜æœ‰ç‚¹åŒºåˆ«&lt;/p>
&lt;ol>
&lt;li>C/C++ç­‰è¯­è¨€æœ‰éšå¼ç±»å‹è½¬æ¢ï¼Œgolangä¸­æ²¡æœ‰&lt;/li>
&lt;li>golangä¸­çš„ç±»å‹è½¬æ¢åˆ†&lt;strong>å¼ºåˆ¶ç±»å‹è½¬æ¢&lt;/strong>å’Œ&lt;strong>ç±»å‹æ–­è¨€&lt;/strong>
åœ¨C/C++ä¸­&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>&lt;span style="color:#8be9fd">int&lt;/span> &lt;span style="color:#50fa7b">main&lt;/span>()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3&lt;/span>&lt;span> &lt;span style="color:#8be9fd">int&lt;/span> a=&lt;span style="color:#bd93f9">5&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4&lt;/span>&lt;span> &lt;span style="color:#8be9fd">float&lt;/span> b=&lt;span style="color:#bd93f9">3.5&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5&lt;/span>&lt;span> &lt;span style="color:#50fa7b">printf&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;%f&amp;#34;&lt;/span>,a&lt;span style="color:#ff79c6">*&lt;/span>b);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™æ ·çš„ä»£ç æ˜¯æ²¡æœ‰é—®é¢˜çš„,ç¼–è¯‘å™¨éšå¼çš„æŠŠaå‘ä¸Šè½¬ä¸ºfloatç±»å‹ã€‚
ä½†æ˜¯åœ¨golangä¸­&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">package&lt;/span> main
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3&lt;/span>&lt;span>&lt;span style="color:#ff79c6">import&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;fmt&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> &lt;span style="color:#50fa7b">main&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6&lt;/span>&lt;span> &lt;span style="color:#8be9fd;font-style:italic">var&lt;/span> a &lt;span style="color:#8be9fd">float32&lt;/span> = &lt;span style="color:#bd93f9">5.6&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7&lt;/span>&lt;span> &lt;span style="color:#8be9fd;font-style:italic">var&lt;/span> b &lt;span style="color:#8be9fd">int&lt;/span> = &lt;span style="color:#bd93f9">10&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8&lt;/span>&lt;span> fmt.&lt;span style="color:#50fa7b">Println&lt;/span> (a &lt;span style="color:#ff79c6">*&lt;/span> b)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">9&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™æ ·çš„ä»£ç ä¼šæŠ¥é”™ï¼Œå› ä¸ºç±»å‹ä¸åŒ¹é…
è¿™æ—¶å€™éœ€è¦å¼ºåˆ¶ç±»å‹è½¬æ¢&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">package&lt;/span> main
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3&lt;/span>&lt;span>&lt;span style="color:#ff79c6">import&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;fmt&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> &lt;span style="color:#50fa7b">main&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6&lt;/span>&lt;span> &lt;span style="color:#8be9fd;font-style:italic">var&lt;/span> a &lt;span style="color:#8be9fd">float32&lt;/span> = &lt;span style="color:#bd93f9">5.6&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7&lt;/span>&lt;span> &lt;span style="color:#8be9fd;font-style:italic">var&lt;/span> b &lt;span style="color:#8be9fd">int&lt;/span> = &lt;span style="color:#bd93f9">10&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8&lt;/span>&lt;span> fmt.&lt;span style="color:#50fa7b">Println&lt;/span> (a &lt;span style="color:#ff79c6">*&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">float32&lt;/span>(b))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">9&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™æ ·å°±ä¸ä¼šæŠ¥é”™äº†
æ™®é€šå˜é‡ç±»å‹&lt;strong>int,float,string&lt;/strong> éƒ½å¯ä»¥ä½¿ç”¨ &lt;code> type (a)&lt;/code>è¿™ç§å½¢å¼æ¥è¿›è¡Œå¼ºåˆ¶ç±»å‹è½¬æ¢,æ¯”å¦‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">var&lt;/span> a &lt;span style="color:#8be9fd">int32&lt;/span> = &lt;span style="color:#bd93f9">10&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">var&lt;/span> b &lt;span style="color:#8be9fd">int64&lt;/span> = &lt;span style="color:#8be9fd;font-style:italic">int64&lt;/span>(a)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">var&lt;/span> c &lt;span style="color:#8be9fd">float32&lt;/span> = &lt;span style="color:#bd93f9">12.3&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">var&lt;/span> d &lt;span style="color:#8be9fd">float64&lt;/span> =&lt;span style="color:#8be9fd;font-style:italic">float64&lt;/span>(c)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>golangä¸­ æŒ‡é’ˆä¹Ÿæ˜¯æœ‰ç±»å‹çš„,&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">package&lt;/span> main
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> &lt;span style="color:#50fa7b">main&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4&lt;/span>&lt;span> &lt;span style="color:#8be9fd;font-style:italic">var&lt;/span> a &lt;span style="color:#8be9fd">int&lt;/span> = &lt;span style="color:#bd93f9">10&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5&lt;/span>&lt;span> &lt;span style="color:#8be9fd;font-style:italic">var&lt;/span> p &lt;span style="color:#ff79c6">*&lt;/span>&lt;span style="color:#8be9fd">int&lt;/span> =&lt;span style="color:#ff79c6">&amp;amp;&lt;/span>a
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6&lt;/span>&lt;span> &lt;span style="color:#8be9fd;font-style:italic">var&lt;/span> c &lt;span style="color:#ff79c6">*&lt;/span>&lt;span style="color:#8be9fd">int64&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7&lt;/span>&lt;span> c= (&lt;span style="color:#ff79c6">*&lt;/span>&lt;span style="color:#8be9fd">int64&lt;/span>)(p)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™æ ·çš„ä»£ç æ˜¯é”™è¯¯çš„,ç¼–è¯‘å™¨ä¼šæç¤º&lt;strong>cannot convert p (type *int) to type *int64&lt;/strong>
æŒ‡é’ˆçš„å¼ºåˆ¶ç±»å‹è½¬æ¢éœ€è¦ç”¨åˆ°&lt;strong>unsafe&lt;/strong>åŒ…ä¸­çš„å‡½æ•°å®ç°&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">package&lt;/span> main
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span>&lt;span style="color:#ff79c6">import&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;unsafe&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span>&lt;span style="color:#ff79c6">import&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;fmt&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> &lt;span style="color:#50fa7b">main&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span> &lt;span style="color:#8be9fd;font-style:italic">var&lt;/span> a &lt;span style="color:#8be9fd">int&lt;/span> =&lt;span style="color:#bd93f9">10&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span> &lt;span style="color:#8be9fd;font-style:italic">var&lt;/span> b &lt;span style="color:#ff79c6">*&lt;/span>&lt;span style="color:#8be9fd">int&lt;/span> =&lt;span style="color:#ff79c6">&amp;amp;&lt;/span>a
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span> &lt;span style="color:#8be9fd;font-style:italic">var&lt;/span> c &lt;span style="color:#ff79c6">*&lt;/span>&lt;span style="color:#8be9fd">int64&lt;/span> = (&lt;span style="color:#ff79c6">*&lt;/span>&lt;span style="color:#8be9fd">int64&lt;/span>)(unsafe.&lt;span style="color:#50fa7b">Pointer&lt;/span>(b))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span> fmt.&lt;span style="color:#50fa7b">Println&lt;/span>(&lt;span style="color:#ff79c6">*&lt;/span>c)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>golangä¸­è¿˜æœ‰ä¸€ä¸­ç±»å‹åˆ¤æ–­,ç±»å‹æ–­è¨€&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">package&lt;/span> main
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span>&lt;span style="color:#ff79c6">import&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;fmt&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> &lt;span style="color:#50fa7b">main&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span> &lt;span style="color:#8be9fd;font-style:italic">var&lt;/span> a &lt;span style="color:#8be9fd;font-style:italic">interface&lt;/span>{} =&lt;span style="color:#bd93f9">10&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span> &lt;span style="color:#ff79c6">switch&lt;/span> a.(&lt;span style="color:#8be9fd;font-style:italic">type&lt;/span>){
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span> &lt;span style="color:#ff79c6">case&lt;/span> &lt;span style="color:#8be9fd">int&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span> fmt.&lt;span style="color:#50fa7b">Println&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;int&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span> &lt;span style="color:#ff79c6">case&lt;/span> &lt;span style="color:#8be9fd">float32&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span> fmt.&lt;span style="color:#50fa7b">Println&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;string&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ç¨‹åºè¾“å‡ºç»“æœæ˜¯&lt;strong>int&lt;/strong>&lt;/p>
&lt;p>ç±»å‹æ–­è¨€è¿˜æœ‰ä¸€ç§ç”¨æ³•&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">package&lt;/span> main
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span>&lt;span style="color:#ff79c6">import&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;fmt&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> &lt;span style="color:#50fa7b">main&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span> &lt;span style="color:#8be9fd;font-style:italic">var&lt;/span> a &lt;span style="color:#8be9fd;font-style:italic">interface&lt;/span>{} =&lt;span style="color:#bd93f9">10&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span> t,ok&lt;span style="color:#ff79c6">:=&lt;/span> a.(&lt;span style="color:#8be9fd">int&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> ok{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span> fmt.&lt;span style="color:#50fa7b">Println&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;int&amp;#34;&lt;/span>,t)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span> t2,ok&lt;span style="color:#ff79c6">:=&lt;/span> a.(&lt;span style="color:#8be9fd">float32&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> ok{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span> fmt.&lt;span style="color:#50fa7b">Println&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;float32&amp;#34;&lt;/span>,t2)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>t,ok:= a.(int)&lt;/code>æœ‰ä¸¤ä¸ªè¿”å›å€¼,ç¬¬ä¸€ä¸ªæ˜¯å¯¹åº”ç±»å‹çš„å€¼,ç¬¬äºŒä¸ªæ˜¯boolç±»å‹çš„,ç±»å‹åˆ¤æ–­æ˜¯å¦æ­£ç¡®ã€‚&lt;/p>
&lt;p>å¥½äº†ï¼Œgolangçš„å¼ºåˆ¶ç±»å‹è½¬æ¢å†™å†™åˆ°è¿™ï¼ŒåŠå¤œå›°äº†ï¼Œæƒ³åˆ°å•¥åœ¨è¡¥å……å§ã€‚ä¸‹æ¬¡å†™ä¸€ä¸‹golangä¸­æ•°å­—å’Œå­—ç¬¦ä¸²ä¹‹é—´çš„è½¬æ¢&lt;/p></description></item><item><title>PHPå¤„ç†å›¾ç‰‡(orientation)æ—‹è½¬é—®é¢˜</title><link>https://lqxhub.github.io/posts/9dd71679/</link><pubDate>Fri, 29 Mar 2019 10:53:57 +0000</pubDate><guid>https://lqxhub.github.io/posts/9dd71679/</guid><description>&lt;p>åœ¨PHPæ—¥å¸¸å¼€å‘ä¸­,ç»å¸¸éœ€è¦å¤„ç†å‰ç«¯ä¸Šä¼ æ¥çš„å›¾ç‰‡,æœ€ç®€å•çš„å°±æ˜¯ä¿å­˜ä¸€ä¸‹,æœ‰æ—¶å€™éœ€è¦è¿›è¡Œä¸€äº›å¤„ç†,æ¯”å¦‚å‹ç¼©å›¾ç‰‡,ç”Ÿæˆç¼©ç•¥å›¾ç­‰ç­‰
è¿™äº›è¿˜å¥½è¯´,æ›´å‘çš„æ˜¯,æœ‰æ—¶å€™å‰ç«¯ä¸Šä¼ çš„å›¾ç‰‡,æœåŠ¡ç«¯è½¬å­˜å,è«åå…¶å¦™çš„æ—‹è½¬äº†90åº¦,æ—‹è½¬äº†180åº¦ã€‚å…³é”®æ˜¯æœ‰çš„æ—¶å€™è¿™äº›å›¾ç‰‡åœ¨å‰ç«¯æ˜¾ç¤ºæ˜¯æ­£å¸¸çš„,åˆ°æœåŠ¡ç«¯è½¬å­˜å,å°±å‡ºé—®é¢˜äº†,å‰ç«¯çš„åŒå­¦è¡¨ç¤ºä¸èƒŒè¿™é”…,è¿™æ˜¯ä½ åç«¯çš„é—®é¢˜!&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-9f17c5b689dded6f.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-9f17c5b689dded6f.webp" alt="" />
&lt;/a>
&lt;/div>
æ²¡åŠæ³•,è‡ªå·±è§£å†³å§
PHPä¸­æœ‰å¤„ç†å›¾ç‰‡æ—‹è½¬çš„æ‹“å±•&lt;strong>exif&lt;/strong>ï¼Œè¦å¤„ç†å›¾ç‰‡æ—‹è½¬é—®é¢˜,å¿…é¡»å®‰è£…è¿™ä¸ªæ‹“å±•ï¼Œ&lt;strong>exif&lt;/strong>æ‹“å±•ä¾èµ–&lt;strong>php_mbstring&lt;/strong>è¿™ä¸ªæ‹“å±•ï¼Œæ‰€ä»¥è¦å®‰è£…è¿™ä¸¤ä¸ªæ‹“å±•ã€‚
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-41df6ceb4548bdd7.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-41df6ceb4548bdd7.webp" alt="exif" />
&lt;/a>
&lt;/div>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-4d910118a84b3fc5.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-4d910118a84b3fc5.webp" alt="mbstring" />
&lt;/a>
&lt;/div>
åœ¨phpinfoä¸­èƒ½çœ‹åˆ°è¿™ä¸¤ä¸ªæ‹“å±•,å°±OKäº†ã€‚
å¦‚æœæ²¡æœ‰å®‰è£…ï¼Œå°±éœ€è¦æ‰‹åŠ¨å®‰è£…ä¸€ä¸‹äº†ï¼Œåªè¯´Linuxä¸Šæ€ä¹ˆå®‰è£…ï¼ŒWindowsä¸Šä¸€èˆ¬éƒ½ç”¨WAMPï¼ŒWAMPå¯ä»¥ä¸€é”®å®‰è£…çš„ã€‚&lt;/p>
&lt;p>Linuxæ¨èä½¿ç”¨æºç å®‰è£…&lt;/p>
&lt;ol>
&lt;li>é¦–å…ˆä¸‹è½½æ‹“å±•çš„æºç ï¼Œå¯ä»¥å»å®˜ç½‘ä¸‹è½½ï¼Œæˆ‘ç”¨çš„php7.2ï¼Œå¯ä»¥åœ¨è¿™é‡Œä¸‹è½½https://pan.baidu.com/s/1RmgFY3bAkyK_Yu636zrx3g æå–ç : pm7y&lt;/li>
&lt;li>ç¼–è¯‘å®‰è£…&lt;/li>
&lt;/ol>
&lt;blockquote>
&lt;ol>
&lt;li>è¿›å…¥æºç çš„ç›®å½•&lt;/li>
&lt;li>ä½¿ç”¨&lt;code>/usr/local/php/bin/phpize&lt;/code>å‘½ä»¤,ç”Ÿæˆconfigureï¼ˆå‡è®¾phpå®‰è£…åœ¨/usr/local/phpç›®å½•ä¸‹ï¼‰&lt;/li>
&lt;li>ä½¿ç”¨&lt;code>./configure --with-php-config=/usr/local/php/bin/php-config&lt;/code>å‘½ä»¤ç”Ÿæˆ Makefileæ–‡ä»¶&lt;/li>
&lt;li>ä½¿ç”¨&lt;code>make &amp;amp;&amp;amp; make install&lt;/code>å‘½ä»¤ç¼–è¯‘å®‰è£…&lt;/li>
&lt;li>å»ä¿®æ”¹php.iniæ–‡ä»¶(å¯èƒ½åœ¨**/usr/local/php/etc&lt;strong>ç›®å½•æˆ–è€…&lt;/strong>/etc/php/&lt;strong>ç›®å½•ä¸‹),æ‰¾åˆ° &lt;strong>extension&lt;/strong> æŠŠ&lt;code> extension=mbstring&lt;/code>å’Œ&lt;code> extension=exif&lt;/code>å‰é¢çš„&lt;/strong>;**å»æ‰æ²¡æœ‰çš„åŠ ä¸Šè¿™ä¸¤å¥ï¼ŒæŠŠ&lt;code>extension=mbstring&lt;/code>æ”¾åœ¨&lt;code>extension=exif&lt;/code>å‰é¢ï¼Œä¿å­˜é€€å‡º&lt;/li>
&lt;li>é‡å¯Apacheæˆ–è€…nginxï¼ŒæŸ¥çœ‹phpinfoï¼Œæœ‰æ²¡æœ‰è¿™ä¸¤ä¸ªæ‹“å±•&lt;/li>
&lt;/ol>
&lt;/blockquote>
&lt;p>å‡†å¤‡å·¥ä½œOKäº†,å¯ä»¥å¼€å§‹å†™ä»£ç äº†ï¼Œåªå†™ä¸€ä¸‹ç®€å•çš„é€»è¾‘ä»£ç å§&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-PHP" data-lang="PHP">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span> &lt;span style="color:#8be9fd;font-style:italic">$str&lt;/span> &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#f1fa8c">&amp;#39;æ–‡ä»¶è·¯å¾„&amp;#39;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span> &lt;span style="color:#8be9fd;font-style:italic">$savePath&lt;/span>&lt;span style="color:#ff79c6">=&lt;/span>&lt;span style="color:#f1fa8c">&amp;#39;ä¿å­˜è·¯å¾„&amp;#39;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span> &lt;span style="color:#8be9fd;font-style:italic">$image&lt;/span> &lt;span style="color:#ff79c6">=&lt;/span> imagecreatefromstring(file_get_contents(&lt;span style="color:#8be9fd;font-style:italic">$str&lt;/span>));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span> &lt;span style="color:#8be9fd;font-style:italic">$exif&lt;/span> &lt;span style="color:#ff79c6">=&lt;/span> exif_read_data(&lt;span style="color:#8be9fd;font-style:italic">$str&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (&lt;span style="color:#ff79c6">!&lt;/span>&lt;span style="color:#ff79c6">empty&lt;/span>(&lt;span style="color:#8be9fd;font-style:italic">$exif&lt;/span>[&lt;span style="color:#f1fa8c">&amp;#39;Orientation&amp;#39;&lt;/span>])) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span> &lt;span style="color:#ff79c6">switch&lt;/span> (&lt;span style="color:#8be9fd;font-style:italic">$exif&lt;/span>[&lt;span style="color:#f1fa8c">&amp;#39;Orientation&amp;#39;&lt;/span>]) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span> &lt;span style="color:#ff79c6">case&lt;/span> &lt;span style="color:#bd93f9">8&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span> &lt;span style="color:#8be9fd;font-style:italic">$image&lt;/span> &lt;span style="color:#ff79c6">=&lt;/span> imagerotate(&lt;span style="color:#8be9fd;font-style:italic">$image&lt;/span>, &lt;span style="color:#bd93f9">90&lt;/span>, &lt;span style="color:#bd93f9">0&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span> &lt;span style="color:#ff79c6">break&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span> &lt;span style="color:#ff79c6">case&lt;/span> &lt;span style="color:#bd93f9">3&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span> &lt;span style="color:#8be9fd;font-style:italic">$image&lt;/span> &lt;span style="color:#ff79c6">=&lt;/span> imagerotate(&lt;span style="color:#8be9fd;font-style:italic">$image&lt;/span>, &lt;span style="color:#bd93f9">180&lt;/span>, &lt;span style="color:#bd93f9">0&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span> &lt;span style="color:#ff79c6">break&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span> &lt;span style="color:#ff79c6">case&lt;/span> &lt;span style="color:#bd93f9">6&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15&lt;/span>&lt;span> &lt;span style="color:#8be9fd;font-style:italic">$image&lt;/span> &lt;span style="color:#ff79c6">=&lt;/span> imagerotate(&lt;span style="color:#8be9fd;font-style:italic">$image&lt;/span>, &lt;span style="color:#ff79c6">-&lt;/span>&lt;span style="color:#bd93f9">90&lt;/span>, &lt;span style="color:#bd93f9">0&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16&lt;/span>&lt;span> &lt;span style="color:#ff79c6">break&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18&lt;/span>&lt;span> imagejpeg(&lt;span style="color:#8be9fd;font-style:italic">$image&lt;/span>, &lt;span style="color:#8be9fd;font-style:italic">$savePath&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19&lt;/span>&lt;span> imagedestroy(&lt;span style="color:#8be9fd;font-style:italic">$image&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>Orientation&lt;/code>ä¸­çš„å€¼ä»£è¡¨ä»€ä¹ˆå«ä¹‰,æˆ‘è¿˜æ²¡æŸ¥åˆ°,ç­‰æŸ¥åˆ°å†è¡¥å……å§ï¼Œæ¬¢è¿å¤§ä½¬è¯„è®ºåŒºè¡¥å……&lt;/p>
&lt;h3 id="è¯´ä¸€ä¸‹é‡åˆ°çš„å‘">&lt;a href="#%e8%af%b4%e4%b8%80%e4%b8%8b%e9%81%87%e5%88%b0%e7%9a%84%e5%9d%91" class="header-anchor">&lt;/a>è¯´ä¸€ä¸‹é‡åˆ°çš„å‘
&lt;/h3>&lt;ol>
&lt;li>è·å–å›¾ç‰‡ä¿¡æ¯ï¼Œåœ¨php7ä¹‹å‰ï¼Œç”¨&lt;code>exif_imagetype()&lt;/code>å‡½æ•°ï¼Œåœ¨php7ä»¥åç”¨&lt;code>exif_read_data()&lt;/code>å‡½æ•°&lt;/li>
&lt;li>ä¸€å®šè¦åˆ¤æ–­æ˜¯è·å–åˆ°å›¾ç‰‡ä¿¡æ¯çš„æ•°ç»„ä¸­å¦å­˜åœ¨&lt;code>Orientation&lt;/code>å­—æ®µï¼Œå› ä¸ºå¾ˆå¤šå›¾ç‰‡ä¸­æ²¡æœ‰æ²¡æœ‰è¿™ä¸ªå±æ€§ï¼Œæˆ–è€…å±æ€§ä¸ºç©ºï¼Œä¸€ç‚¹è¦åˆ¤æ–­&lt;/li>
&lt;/ol></description></item><item><title>php è·å–HTTP POSTä¸­ä¸åŒæ ¼å¼çš„æ•°æ®</title><link>https://lqxhub.github.io/posts/ba4d9bad/</link><pubDate>Thu, 27 Dec 2018 13:39:26 +0000</pubDate><guid>https://lqxhub.github.io/posts/ba4d9bad/</guid><description>&lt;p>HTTPåè®®ä¸­çš„POST æ–¹æ³•æœ‰å¤šä¸­æ ¼å¼çš„æ•°æ®åè®®,åœ¨HTTPçš„headä¸­ç”¨ä¸åŒçš„&lt;code>Content-type&lt;/code>æ ‡è¯†.å¸¸ç”¨çš„æœ‰&lt;/p>
&lt;blockquote>
&lt;p>&lt;code>application/x-www-form-urlencoded&lt;/code>,è¿™æ˜¯æœ€å¸¸è§çš„,å°±æ˜¯fromè¡¨å•çš„æ ¼å¼.åœ¨HTTPçš„headä¸­æ˜¯&lt;code>Content-Type: application/x-www-form-urlencoded&lt;/code>.&lt;/p>
&lt;/blockquote>
&lt;blockquote>
&lt;p>&lt;code>multipart/form-data&lt;/code>,è¿™ä¸ªæ˜¯ç”¨æ¥ä¸Šä¼ æ–‡ä»¶çš„,åœ¨HTTPçš„headä¸­æ˜¯&lt;code>Content-Type: multipart/form-data; boundary=----WebKitFormBoundary7MA4YWxkTrZu0gW&lt;/code>&lt;/p>
&lt;/blockquote>
&lt;blockquote>
&lt;p>&lt;code>Raw&lt;/code> è¿™ä¸ªä¸æ˜¯ç‰¹åˆ«å¸¸ç”¨,ä¼ è¾“çš„æ•°æ®åœ¨HTTPçš„bodyä¸­åªæœ‰ä¸€æ®µ,ä¸æ˜¯ä»¥é”®å€¼å¯¹çš„å½¢å¼å­˜æ”¾.åœ¨HTTPçš„headä¸­æ˜¯&lt;code>Content-Type: application/json&lt;/code>,&lt;code>Content-Type: text&lt;/code>,&lt;code>Content-Type: application/xml&lt;/code>,&lt;code>Content-Type: text/xml&lt;/code>,ç­‰ç­‰å½¢å¼&lt;/p>
&lt;/blockquote>
&lt;p>å¯¹äº&lt;code>Content-Type: application/x-www-form-urlencoded&lt;/code>è¿™ç§formè¡¨å•çš„æ•°æ®,åœ¨phpä¸­,ä½¿ç”¨&lt;code>$_POST['name']&lt;/code>å¯ä»¥ç›´æ¥è·å–, æ²¡æœ‰ä»€ä¹ˆç‰¹åˆ«çš„&lt;/p>
&lt;p>&lt;code>Content-Type: multipart/form-data; &lt;/code>è¿™ç§æ ¼å¼çš„æ•°æ®,åœ¨phpä¸­ä½¿ç”¨&lt;code>$_POST['name']&lt;/code>å¯ä»¥è·å–å­—ç¬¦æ•°æ®,ä½¿ç”¨&lt;code>$_FILES['file']&lt;/code>å¯ä»¥è·å–.&lt;/p>
&lt;p>å¯¹äº&lt;code>Raw&lt;/code>è¿™ç§æ ¼å¼çš„æ•°æ®,ä½¿ç”¨ä»¥ä¸Šä¸¤ç§åŠæ³•æ²¡æœ‰åŠæ³•è·å–åˆ°,éœ€è¦ä½¿ç”¨åˆ«çš„æ‰‹æ®µ.
1.ä½¿ç”¨&lt;code>file_get_contents(&amp;quot;php://input&amp;quot;)&lt;/code>è·å–;å†™ä¸€ä¸ªç®€å•phpæ–‡ä»¶æµ‹è¯•ä¸€ä¸‹&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-php" data-lang="php">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">&amp;lt;?&lt;/span>php
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">$test&lt;/span>&lt;span style="color:#ff79c6">=&lt;/span>file_get_contents(&lt;span style="color:#f1fa8c">&amp;#34;php://input&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3&lt;/span>&lt;span>&lt;span style="color:#ff79c6">echo&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">$test&lt;/span>;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ç”¨postmanæµ‹è¯•ä¸€ä¸‹
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-da2f59e4f1c51f16.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-da2f59e4f1c51f16.webp" alt="" />
&lt;/a>
&lt;/div>
æ²¡é—®é¢˜,å¯ä»¥æ¥æ”¶åˆ°&lt;/p>
&lt;p>2.ä½¿ç”¨&lt;code>$GLOBALS['HTTP_RAW_POST_DATA']&lt;/code>æ¥æ”¶&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-php" data-lang="php">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">&amp;lt;?&lt;/span>php
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">$test&lt;/span>&lt;span style="color:#ff79c6">=&lt;/span>&lt;span style="color:#8be9fd;font-style:italic">$GLOBALS&lt;/span>[&lt;span style="color:#f1fa8c">&amp;#39;HTTP_RAW_POST_DATA&amp;#39;&lt;/span>];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3&lt;/span>&lt;span>&lt;span style="color:#ff79c6">echo&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">$test&lt;/span>;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ç”¨postmanæµ‹è¯•ä¸€ä¸‹
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-96ec2d127bfb979e.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-96ec2d127bfb979e.webp" alt="" />
&lt;/a>
&lt;/div>
å§æ§½,ç«Ÿç„¶å‡ºé”™äº†,æç¤ºæ²¡æœ‰å‘ç°&lt;strong>HTTP_RAW_POST_DATA&lt;/strong>è¿™ä¸ªæ•°ç»„ç´¢å¼•,ä»€ä¹ˆé¬¼.Googleä¸€ç•ª,åœ¨phpçš„å®˜ç½‘çœ‹åˆ°äº†è¿™æ ·ä¸€æ®µè¯
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-5ab88c19311732c8.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-5ab88c19311732c8.webp" alt="" />
&lt;/a>
&lt;/div>
åŸæ¥&lt;strong>HTTP_RAW_POST_DATA&lt;/strong>è¿™ä¸ªåœ¨php5.6ä¸­å·²ç»è¢«åºŸå¼ƒäº†,åœ¨php7.0ä»¥åçš„ç‰ˆæœ¬ä¸­å·²ç»è¢«åˆ é™¤äº†,æˆ‘ç”¨çš„phpç‰ˆæœ¬ä¸º7.2,è‚¯å®šå°±å‡ºé”™äº†&lt;/p>
&lt;p>å¥½å§,é‚£å°±è€è€å®å®çš„ç”¨&lt;code>file_get_contents(&amp;quot;php://input&amp;quot;)&lt;/code>è·å–å§&lt;/p>
&lt;p>åœ¨å®é™…å¼€å‘ä¸­,ä¸€èˆ¬éƒ½æ˜¯ä½¿ç”¨æ¡†æ¶çš„,æˆ‘ç”¨thinkphpç”¨æ¯”è¾ƒå¤š,åœ¨tp5.0ä¸­å¯ä»¥ä½¿ç”¨&lt;code>Requestçš„getInput()&lt;/code>å‡½æ•°è·å–&lt;code>Raw&lt;/code>ä¸­çš„æ•°æ®&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-php" data-lang="php">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">&amp;lt;?&lt;/span>php
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span>&lt;span style="color:#ff79c6">namespace&lt;/span> app\index\controller;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span>&lt;span style="color:#ff79c6">use&lt;/span> think\Request;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span>&lt;span style="color:#ff79c6">class&lt;/span> &lt;span style="color:#50fa7b">Index&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span> &lt;span style="color:#ff79c6">public&lt;/span> &lt;span style="color:#ff79c6">function&lt;/span> &lt;span style="color:#50fa7b">index&lt;/span>(Request &lt;span style="color:#8be9fd;font-style:italic">$request&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span> &lt;span style="color:#ff79c6">echo&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">$request&lt;/span>&lt;span style="color:#ff79c6">-&amp;gt;&lt;/span>&lt;span style="color:#50fa7b">getInput&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æµ‹è¯•ä¸€ä¸‹
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-e82d2b162d373cc9.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-e82d2b162d373cc9.webp" alt="" />
&lt;/a>
&lt;/div>
æ²¡æœ‰é—®é¢˜,å¯ä»¥æ­£å¸¸è·å–&lt;/p>
&lt;p>&lt;strong>å…³äºphpè·å–HTTP POSTæ•°æ®çš„æ–¹æ³•å…ˆä»‹ç»åˆ°è¿™é‡Œ&lt;/strong>&lt;/p></description></item><item><title>mysqlä½¿ç”¨ fromä¸¤è¡¨æŸ¥è¯¢ä¸joinä¸¤è¡¨æŸ¥è¯¢åŒºåˆ«</title><link>https://lqxhub.github.io/posts/63c229e6/</link><pubDate>Thu, 27 Dec 2018 11:29:19 +0000</pubDate><guid>https://lqxhub.github.io/posts/63c229e6/</guid><description>&lt;p>åœ¨mysqlä¸­,å¤šè¡¨è¿æ¥æŸ¥è¯¢æ˜¯å¾ˆå¸¸è§çš„éœ€æ±‚,åœ¨ä½¿ç”¨å¤šè¡¨æŸ¥è¯¢æ—¶,å¯ä»¥fromå¤šä¸ªè¡¨,ä¹Ÿå¯ä»¥ä½¿ç”¨&lt;code>join&lt;/code>è¿æ¥è¿ä¸ªè¡¨
è¿™ä¸¤ç§æŸ¥è¯¢æœ‰ä»€ä¹ˆåŒºåˆ«?å“ªç§æŸ¥è¯¢çš„æ•ˆç‡æ›´é«˜å‘¢? å¸¦ç€è¿™äº›ç–‘é—®,å†³å®šåŠ¨æ‰‹è¯•è¯•&lt;/p>
&lt;p>1.å…ˆåœ¨æœ¬åœ°çš„mysqlä¸Šå…ˆå»ºä¸¤ä¸ªè¡¨&lt;code>one&lt;/code>å’Œ&lt;code>two&lt;/code>
oneè¡¨&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-sql" data-lang="sql">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">CREATE&lt;/span> &lt;span style="color:#ff79c6">TABLE&lt;/span> &lt;span style="color:#ff79c6">`&lt;/span>one&lt;span style="color:#ff79c6">`&lt;/span> (
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span> &lt;span style="color:#ff79c6">`&lt;/span>id&lt;span style="color:#ff79c6">`&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">int&lt;/span>(&lt;span style="color:#bd93f9">0&lt;/span>) &lt;span style="color:#ff79c6">NOT&lt;/span> &lt;span style="color:#ff79c6">NULL&lt;/span> AUTO_INCREMENT,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3&lt;/span>&lt;span> &lt;span style="color:#ff79c6">`&lt;/span>one&lt;span style="color:#ff79c6">`&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">varchar&lt;/span>(&lt;span style="color:#bd93f9">100&lt;/span>) &lt;span style="color:#ff79c6">NOT&lt;/span> &lt;span style="color:#ff79c6">NULL&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4&lt;/span>&lt;span> &lt;span style="color:#ff79c6">PRIMARY&lt;/span> &lt;span style="color:#ff79c6">KEY&lt;/span> (&lt;span style="color:#ff79c6">`&lt;/span>id&lt;span style="color:#ff79c6">`&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5&lt;/span>&lt;span>) ENGINE &lt;span style="color:#ff79c6">=&lt;/span> InnoDB &lt;span style="color:#8be9fd;font-style:italic">CHARACTER&lt;/span> &lt;span style="color:#ff79c6">SET&lt;/span> &lt;span style="color:#ff79c6">=&lt;/span> utf8;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>twoè¡¨&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-sql" data-lang="sql">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">CREATE&lt;/span> &lt;span style="color:#ff79c6">TABLE&lt;/span> &lt;span style="color:#ff79c6">`&lt;/span>two&lt;span style="color:#ff79c6">`&lt;/span> (
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span> &lt;span style="color:#ff79c6">`&lt;/span>id&lt;span style="color:#ff79c6">`&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">int&lt;/span>(&lt;span style="color:#bd93f9">0&lt;/span>) &lt;span style="color:#ff79c6">NOT&lt;/span> &lt;span style="color:#ff79c6">NULL&lt;/span> AUTO_INCREMENT,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3&lt;/span>&lt;span> &lt;span style="color:#ff79c6">`&lt;/span>two&lt;span style="color:#ff79c6">`&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">varchar&lt;/span>(&lt;span style="color:#bd93f9">100&lt;/span>) &lt;span style="color:#ff79c6">NOT&lt;/span> &lt;span style="color:#ff79c6">NULL&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4&lt;/span>&lt;span> &lt;span style="color:#ff79c6">PRIMARY&lt;/span> &lt;span style="color:#ff79c6">KEY&lt;/span> (&lt;span style="color:#ff79c6">`&lt;/span>id&lt;span style="color:#ff79c6">`&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5&lt;/span>&lt;span>) ENGINE &lt;span style="color:#ff79c6">=&lt;/span> InnoDB &lt;span style="color:#8be9fd;font-style:italic">CHARACTER&lt;/span> &lt;span style="color:#ff79c6">SET&lt;/span> &lt;span style="color:#ff79c6">=&lt;/span> utf8;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å…ˆéšä¾¿æ’å…¥å‡ æ¡æ•°æ®,æŸ¥è¯¢çœ‹ä¸€ä¸‹;&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-sql" data-lang="sql">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">select&lt;/span> one.id,one.one,two.id,two.two &lt;span style="color:#ff79c6">from&lt;/span> one,two &lt;span style="color:#ff79c6">where&lt;/span> one.id&lt;span style="color:#ff79c6">=&lt;/span>two.id;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-5113ee7537d10f77.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-5113ee7537d10f77.webp" alt="" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-sql" data-lang="sql">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">select&lt;/span> one.id,one.one,two.id,two.two &lt;span style="color:#ff79c6">from&lt;/span> one &lt;span style="color:#ff79c6">join&lt;/span> two &lt;span style="color:#ff79c6">on&lt;/span> one.id&lt;span style="color:#ff79c6">=&lt;/span>two.id;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-a8130abdd05dc2e9.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-a8130abdd05dc2e9.webp" alt="" />
&lt;/a>
&lt;/div>
å¯¹æ¯”è¿™ä¸¤æ¬¡çš„æŸ¥è¯¢,æŸ¥è¯¢æ—¶é—´å‡ ä¹æ²¡æœ‰åŒºåˆ«,æŸ¥çœ‹sqlè¿è¡Œåˆ†æ,ä¹Ÿæ²¡æœ‰åŒºåˆ«&lt;/p>
&lt;p>ä¸ºäº†çªå‡ºä¸¤ç§æŸ¥è¯¢çš„æ€§èƒ½å·®å¼‚,å¾€&lt;code>one&lt;/code>è¡¨ä¸­æ’å…¥100wæ¡æ•°æ®,å¾€&lt;code>two&lt;/code>è¡¨ä¸­æ’å…¥10wæ¡æ•°æ®,åœ¨å¤§é‡æ•°æ®é¢å‰,ä¸€ä¸ä¸€æ¯«çš„å·®åˆ«ä¹Ÿä¼šè¢«æ— é™æ”¾å¤§;è¿™æ—¶å€™åœ¨æ¥æ¯”è¾ƒä¸€ä¸‹å·®å¼‚&lt;/p>
&lt;p>å…ˆä½¿ç”¨pythonå¾€æ•°æ®åº“ä¸­æ’å…¥æ•°æ®,ä¸ºå•¥ç”¨python,å› ä¸ºpythonå†™èµ·äº†ç®€å•
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-90418ea42c193a16.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-90418ea42c193a16.webp" alt="" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>ä¸Šä»£ç &lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">import&lt;/span> pymysql
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span>db &lt;span style="color:#ff79c6">=&lt;/span> pymysql&lt;span style="color:#ff79c6">.&lt;/span>connect(&lt;span style="color:#f1fa8c">&amp;#34;127.0.0.1&amp;#34;&lt;/span>, &lt;span style="color:#f1fa8c">&amp;#39;root&amp;#39;&lt;/span>, &lt;span style="color:#f1fa8c">&amp;#34;123456&amp;#34;&lt;/span>, &lt;span style="color:#f1fa8c">&amp;#34;bruce&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span>cursor &lt;span style="color:#ff79c6">=&lt;/span> db&lt;span style="color:#ff79c6">.&lt;/span>cursor()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span>sql &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;INSERT INTO one (one) values (&lt;/span>&lt;span style="color:#f1fa8c">%s&lt;/span>&lt;span style="color:#f1fa8c">)&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span>&lt;span style="color:#ff79c6">for&lt;/span> i &lt;span style="color:#ff79c6">in&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">range&lt;/span>(&lt;span style="color:#bd93f9">1000000&lt;/span>):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span> cursor&lt;span style="color:#ff79c6">.&lt;/span>executemany(sql, [&lt;span style="color:#f1fa8c">&amp;#39;one&amp;#39;&lt;/span> &lt;span style="color:#ff79c6">+&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">str&lt;/span>(i)])
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> i &lt;span style="color:#ff79c6">%&lt;/span> &lt;span style="color:#bd93f9">10000&lt;/span> &lt;span style="color:#ff79c6">==&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span> db&lt;span style="color:#ff79c6">.&lt;/span>commit()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span> &lt;span style="color:#8be9fd;font-style:italic">print&lt;/span>(&lt;span style="color:#8be9fd;font-style:italic">str&lt;/span>(i) &lt;span style="color:#ff79c6">+&lt;/span> &lt;span style="color:#f1fa8c">&amp;#39;æ¬¡ commit&amp;#39;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span>db&lt;span style="color:#ff79c6">.&lt;/span>commit()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">print&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#39;insert one ok&amp;#39;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15&lt;/span>&lt;span>sql2 &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;INSERT INTO two (two) values (&lt;/span>&lt;span style="color:#f1fa8c">%s&lt;/span>&lt;span style="color:#f1fa8c">)&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16&lt;/span>&lt;span>&lt;span style="color:#ff79c6">for&lt;/span> i &lt;span style="color:#ff79c6">in&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">range&lt;/span>(&lt;span style="color:#bd93f9">100000&lt;/span>):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17&lt;/span>&lt;span> cursor&lt;span style="color:#ff79c6">.&lt;/span>executemany(sql2, [&lt;span style="color:#f1fa8c">&amp;#39;two&amp;#39;&lt;/span> &lt;span style="color:#ff79c6">+&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">str&lt;/span>(i)])
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> i &lt;span style="color:#ff79c6">%&lt;/span> &lt;span style="color:#bd93f9">10000&lt;/span> &lt;span style="color:#ff79c6">==&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19&lt;/span>&lt;span> db&lt;span style="color:#ff79c6">.&lt;/span>commit()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20&lt;/span>&lt;span> &lt;span style="color:#8be9fd;font-style:italic">print&lt;/span>(&lt;span style="color:#8be9fd;font-style:italic">str&lt;/span>(i) &lt;span style="color:#ff79c6">+&lt;/span> &lt;span style="color:#f1fa8c">&amp;#39;æ¬¡ commit&amp;#39;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21&lt;/span>&lt;span>db&lt;span style="color:#ff79c6">.&lt;/span>commit()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">print&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#39;insert two ok&amp;#39;&lt;/span>)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è€å¿ƒç­‰å¾…ä¸€ä¼š,æ’å…¥éœ€è¦ä¸€äº›æ—¶é—´;&lt;/p>
&lt;p>ç­‰æ•°æ®æ’å…¥å®Œæˆ,æ¥æŸ¥è¯¢ä¸€äº›çœ‹çœ‹
å…ˆä½¿ç”¨&lt;code>FROM&lt;/code>ä¸¤ä¸ªè¡¨æŸ¥è¯¢&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-sql" data-lang="sql">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">select&lt;/span> one.id,one.one,two.id,two.two &lt;span style="color:#ff79c6">from&lt;/span> one,two &lt;span style="color:#ff79c6">where&lt;/span> one.id&lt;span style="color:#ff79c6">=&lt;/span>two.id;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-f4d293c042096b1a.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-f4d293c042096b1a.webp" alt="" />
&lt;/a>
&lt;/div>
ç”¨æ—¶å¤§çº¦20.49;&lt;/p>
&lt;p>å†ç”¨&lt;code>JOIN&lt;/code>æŸ¥è¯¢çœ‹ä¸€ä¸‹&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-sql" data-lang="sql">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">select&lt;/span> one.id,one.one,two.id,two.two &lt;span style="color:#ff79c6">from&lt;/span> one &lt;span style="color:#ff79c6">join&lt;/span> two &lt;span style="color:#ff79c6">on&lt;/span> one.id&lt;span style="color:#ff79c6">=&lt;/span>two.id;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-6cfdb7498181131e.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-6cfdb7498181131e.webp" alt="" />
&lt;/a>
&lt;/div>
ç”¨æ—¶19.45,åœ¨10wæ¡æ•°æ®ä¸­,1ç§’çš„è¯¯å·®å¹¶ä¸ç®—å¤§,
æŸ¥çœ‹ä¸€ä¸‹ä½¿ç”¨idä½œä¸ºæ¡ä»¶çº¦æŸæ—¶çš„æŸ¥è¯¢
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-de36facc1c1bf331.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-de36facc1c1bf331.webp" alt="" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-73ea585e7ba392e4.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-73ea585e7ba392e4.webp" alt="" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>æŸ¥è¯¢æ—¶é—´æ²¡æœ‰å·®åˆ«&lt;/p>
&lt;p>å†çœ‹ä¸€ä¸‹sqlæ‰§è¡Œåˆ†æ
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-06f5c3b595c67f18.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-06f5c3b595c67f18.webp" alt="" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-d61ec19b6c72db3f.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-d61ec19b6c72db3f.webp" alt="" />
&lt;/a>
&lt;/div>
ç»“æœè¿˜æ˜¯ä¸€æ ·çš„&lt;/p>
&lt;p>&lt;strong>æ€»ç»“&lt;/strong>
åœ¨mysqlä¸­ä½¿ç”¨&lt;code>FROM&lt;/code>æŸ¥è¯¢å¤šè¡¨å’Œä½¿ç”¨&lt;code>JOIN&lt;/code>è¿æ¥(&lt;code>LEFT JOIN&lt;/code>,&lt;code>RIGHT JOIN&lt;/code>é™¤å¤–),æŸ¥è¯¢ç»“æœ,æŸ¥è¯¢æ•ˆç‡æ˜¯ä¸€æ ·çš„&lt;/p></description></item><item><title>ä½¿ç”¨tcpdump+wiresharkæŠ“åŒ…åˆ†æç½‘ç»œæ•°æ®åŒ…</title><link>https://lqxhub.github.io/posts/a3fd02f/</link><pubDate>Sun, 16 Dec 2018 10:54:33 +0000</pubDate><guid>https://lqxhub.github.io/posts/a3fd02f/</guid><description>&lt;p>æœ€è¿‘å’Œå­¦å¼Ÿåœ¨è°ƒè¯•ä¸€ä¸ªGPRSé€šä¿¡æ¨¡å—,éœ€æ±‚æ˜¯é€šè¿‡GPRSæ¨¡å—é€šè¿‡httpåè®®å‘é€æ•°æ®åˆ°æœåŠ¡å™¨,ä½†æ˜¯httpåè®®ä¸€ç›´å¤±è´¥,æœåŠ¡å™¨è¿”å›400,é€šè¿‡æŸ¥è¯¢httpçŠ¶æ€ç å¾—çŸ¥,http400é”™è¯¯æ˜¯è¯·æ±‚æ— æ•ˆ,å› ä¸ºGPRSæ¨¡å—æ²¡æœ‰å®ç°httpåè®®çš„å°è£…,éœ€è¦åœ¨TCPåè®®çš„åŸºç¡€ä¸Š,æ‰‹åŠ¨æ‹¼è£…httpæ ¼å¼çš„æŠ¥æ–‡.æ‰€ä»¥åˆæ­¥çŒœæµ‹æ˜¯httpåè®®æ ¼å¼é”™è¯¯å¯¼è‡´çš„.&lt;/p>
&lt;p>è¿™æ—¶å€™,æœ€ç®€å•æœ‰æ•ˆçš„è°ƒé”™æ–¹å¼å°±æ˜¯é€šè¿‡æŠ“åŒ…åˆ†æ,æŸ¥çœ‹æ•°æ®æ ¼å¼,ç„¶åä¿®æ”¹.ä½†æ˜¯åœ¨GPRSæ¨¡å—ä¸Šæ²¡æ³•å®‰è£…æŠ“åŒ…å·¥å…·,åªèƒ½åœ¨æœåŠ¡å™¨ä¸ŠæŠ“åŒ…,æœåŠ¡å™¨æ˜¯centosçš„,è™½ç„¶æœ‰tcpdumpå·¥å…·,ä½†æ˜¯æ²¡æœ‰ç•Œé¢,æ²¡æ³•å…·ä½“åˆ†ææ•°æ®åŒ….
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-07e76fa9d331441d.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-07e76fa9d331441d.webp" alt="tcpdump" />
&lt;/a>
&lt;/div>
ç›´æ¥ä½¿ç”¨tcpdumpæŠ“åˆ°çš„æ•°æ®åŒ…,æ ¹æœ¬æ²¡æ³•åˆ†æå¥½ä¸.&lt;/p>
&lt;p>åœ¨windowsä¸Š,æœ‰wiresharkè¿™ä¸ªå·¥å…·,å¯ä»¥å¾ˆæ–¹ä¾¿çš„åˆ†æç½‘ç»œæ•°æ®åŒ…,è¿™ä¸ªè½¯ä»¶æœ‰å¤šç‰›é¼»å°±ä¸ç”¨å¤šè¯´äº†,æ‰€æœ‰ç»è¿‡ç½‘å¡æ•°æ®éƒ½èƒ½æŠ“åˆ°,é…åˆå›¾å½¢ç•Œé¢,å¯ä»¥å¾ˆæ–¹ä¾¿çš„æŸ¥çœ‹åˆ†ææ•°æ®.ä¸çŸ¥èƒ½æŸ¥çœ‹åº”ç”¨å±‚åè®®çš„æ•°æ®,ç½‘ç»œä¸­çš„äº”å±‚åè®®éƒ½èƒ½æŸ¥çœ‹.
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-3c4762f575fb0262.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-3c4762f575fb0262.webp" alt="wireshark" />
&lt;/a>
&lt;/div>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-98ef788511211707.png">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-98ef788511211707.png" alt="wireshark" />
&lt;/a>
&lt;/div>
æœ‰æ²¡æœ‰åŠæ³•æŠŠtcpdumpå’Œwiresharkè¿™ä¸¤ä¸ªè½¯ä»¶ç»“åˆèµ·æ¥ä½¿ç”¨å‘¢???
åŠæ³•å½“ç„¶æ˜¯æœ‰çš„,æŠŠtcpdumpæŠ“å–çš„æ•°æ®è½¬å­˜æ–‡ä»¶,ç„¶åç”¨wiresharkæ‰“å¼€æ–‡ä»¶,åˆ†ææ•°æ®.&lt;/p>
&lt;blockquote>
&lt;p>1.å¼€å¯tcpdumpæŠ“åŒ…,å¹¶å°†ç»“æœè½¬å­˜ä¸ºæ–‡ä»¶
&lt;code>tcpdump tcp -s 0 port 80 -w ./http.cap&lt;/code>
è¯´ä¸€ä¸‹è¿™å‡ ä¸ªå‚æ•°
&lt;code>tcp&lt;/code>æ˜¯æŒ‡å®šæŠ“å–é‚£ç§åè®®çš„æ•°æ®,å› ä¸ºæˆ‘ä»¬è¦æŠ“å–httpåè®®,ä½†æ˜¯tcpä¸èƒ½æŒ‡å®šhttpåè®®,ä½†æ˜¯httpåè®®æ˜¯åŸºäºTCPåè®®çš„,æ‰€ä»¥æŠ“å–TCPåè®®æ•°æ®.
&lt;code>-s 0&lt;/code> tcpdump æŠ“å–æ•°æ®åŒ…æ—¶é»˜è®¤æŠ“å–é•¿åº¦ä¸º68å­—èŠ‚ã€‚åŠ ä¸Š-S 0 åå¯ä»¥æŠ“åˆ°å®Œæ•´çš„æ•°æ®åŒ…
&lt;code>port 80&lt;/code> æˆ‘çš„æœåŠ¡å™¨ç›‘å¬çš„80ç«¯å£,æ‰€ä»¥åªæŠ“å–80ç«¯å£çš„æ•°æ®.
&lt;code>-w ./http.cap&lt;/code> æŒ‡å®štcpdumpè½¬å­˜æ•°æ®æ—¶çš„æ–‡ä»¶ &lt;code>./http.cap&lt;/code>æ˜¯å½“å‰ç›®å½•ä¸‹çš„http.capæ–‡ä»¶&lt;/p>
&lt;/blockquote>
&lt;blockquote>
&lt;ol start="2">
&lt;li>å‘èµ·è¯·æ±‚
åœ¨ç»ˆç«¯ä¸­ä½¿ç”¨ &lt;strong>ctrl+c&lt;/strong>ç»„åˆé”®ç»“æŸæŠ“åŒ…,ç„¶åä¼šåœ¨å½“å‰ç›®å½•ä¸‹ç”Ÿæˆä¸€ä¸ªhttp.capæ–‡ä»¶
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-729afb96de3efa57.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-729afb96de3efa57.webp" alt="http.cap" />
&lt;/a>
&lt;/div>
&lt;/li>
&lt;/ol>
&lt;/blockquote>
&lt;blockquote>
&lt;p>3.æŠŠæ–‡ä»¶ä¸‹è½½ä¸‹æ¥,ä½¿ç”¨tcpdumpåˆ†ææ•°æ®
åœ¨wiresharkä¸­,é€šè¿‡&lt;strong>æ–‡ä»¶&lt;/strong>&amp;gt;&lt;strong>æ‰“å¼€&lt;/strong> æ‰¾åˆ°ä»æœåŠ¡å™¨ä¸‹è½½çš„http.capæ–‡ä»¶,å¹¶æ‰“å¼€
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-f93441beb2843761.png">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-f93441beb2843761.png" alt="" />
&lt;/a>
&lt;/div>
åˆ°è¿™å·²ç»æˆåŠŸæ‰“å¼€äº†,å‰©ä¸‹çš„å°±æ˜¯åˆ†ææ•°æ®åŒ…äº†
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-f324b589b3b8c925.png">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-f324b589b3b8c925.png" alt="wireshark" />
&lt;/a>
&lt;/div>
åœ¨åè®®httpçš„é‚£ä¸€è¡Œå³é”®,é€‰æ‹©è¿½è¸ªæµ,ç„¶åé€‰æ‹©http
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-884eb6da73617670.png">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-884eb6da73617670.png" alt="http" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;/blockquote>
&lt;p>åˆ°è¿™,æ•´ä¸ªæŠ“åŒ…å°±å®Œæˆäº†,æ˜¯ä¸æ˜¯å¾ˆç®€å•å‘¢&lt;/p>
&lt;p>ç»è¿‡æŠ“åŒ…åˆ†æ,ç»ˆäºè§£å†³äº†http400çš„é—®é¢˜&lt;/p></description></item><item><title>ä½¿ç”¨mysqlä¸­çš„é”è§£å†³é«˜å¹¶å‘é—®é¢˜</title><link>https://lqxhub.github.io/posts/a8083c8/</link><pubDate>Fri, 23 Nov 2018 17:17:26 +0000</pubDate><guid>https://lqxhub.github.io/posts/a8083c8/</guid><description>&lt;h2 id="ä¸ºä»€ä¹ˆè¦åŠ é”">&lt;a href="#%e4%b8%ba%e4%bb%80%e4%b9%88%e8%a6%81%e5%8a%a0%e9%94%81" class="header-anchor">&lt;/a>ä¸ºä»€ä¹ˆè¦åŠ é”
&lt;/h2>&lt;blockquote>
&lt;p>å¤šæ ¸è®¡ç®—æœºçš„å‡ºç°,è®¡ç®—æœºå®ç°çœŸæ­£å¹¶è¡Œè®¡ç®—,å¯ä»¥åœ¨åŒä¸€æ—¶åˆ»,æ‰§è¡Œå¤šä¸ªä»»åŠ¡ã€‚åœ¨å¤šçº¿ç¨‹ç¼–ç¨‹ä¸­ï¼Œå› ä¸ºçº¿ç¨‹æ‰§è¡Œé¡ºåºä¸å¯æ§å¯¼è‡´çš„æ•°æ®é”™è¯¯ã€‚æ¯”å¦‚ï¼Œå¤šçº¿ç¨‹çš„ç†æƒ³çŠ¶æ€æ˜¯è¿™æ ·çš„
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-801bea6ef02b13d6.jpg">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-801bea6ef02b13d6.jpg" alt="å¤šçº¿ç¨‹ç†æƒ³.jpg" />
&lt;/a>
&lt;/div>
ä½†æ˜¯å®é™…æƒ…å†µæ˜¯è¿™æ ·çš„:
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-bf3f64430beeca01.jpg">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-bf3f64430beeca01.jpg" alt="å¤šçº¿ç¨‹å®é™….jpg" />
&lt;/a>
&lt;/div>
åœ¨ç½‘ç»œç¼–ç¨‹ä¸­ï¼Œåœ¨åŒä¸€æ—¶åˆ»ï¼Œå¤šä¸ªå®¢æˆ·ç«¯åŒæ—¶è¯·æ±‚åŒä¸€ä¸ªèµ„æºï¼Œå¦‚æœä¸åšæ§åˆ¶ï¼Œä¹Ÿä¼šå¸¦æ¥æ•°æ®é”™è¯¯ã€‚æ¯”å¦‚åœ¨åŒä¸€æ—¶é—´æœ‰10000äººå»æŠ¢10å¼ ç«è½¦ç¥¨ï¼Œ10å¼ ç«è½¦ç¥¨æœ‰å¯èƒ½ä¼šä¹°ç»™100ä¸ªäººï¼Œè¿™æ˜¾ç„¶æ˜¯ä¸ç¬¦åˆè¦æ±‚çš„ã€‚
åœ¨å¤šçº¿ç¨‹ç¼–ç¨‹ä¸­,ä¸ºäº†è§£å†³çº¿ç¨‹æ‰§è¡Œä¸å¯æ§å¸¦æ¥çš„é—®é¢˜,é€šå¸¸æƒ…å†µä¸‹éƒ½æ˜¯é€šè¿‡åŠ é”æ¥å®ç°æ•°æ®åŒæ­¥çš„ã€‚åœ¨ç½‘ç»œç¼–ç¨‹ä¸­ï¼Œä¹Ÿå¯ä»¥é€šè¿‡åŠ é”æœºåˆ¶æ¥æ§åˆ¶ã€‚&lt;/p>
&lt;/blockquote>
&lt;p>åœ¨ç½‘ç»œç¼–ç¨‹ä¸­ï¼Œå¯ä»¥é€šè¿‡ç»™æ•°æ®åº“åŠ é”ï¼Œè¾¾åˆ°æ§åˆ¶å¹¶å‘çš„ç›®çš„ã€‚åœ¨phpå¼€å‘æ—¶ï¼ŒåŸºæœ¬éƒ½æ˜¯ä½¿ç”¨mysqlä½œä¸ºæ•°æ®åº“ã€‚æ‰€ä»¥ï¼Œå°±ä¼šç»™mysqlåŠ é”æ§åˆ¶ç½‘ç»œå¹¶å‘å¼•èµ·æ•°æ®é”™è¯¯é—®é¢˜ã€‚&lt;/p>
&lt;h2 id="mysqlçš„å­˜å‚¨å¼•æ“">&lt;a href="#mysql%e7%9a%84%e5%ad%98%e5%82%a8%e5%bc%95%e6%93%8e" class="header-anchor">&lt;/a>MySQLçš„å­˜å‚¨å¼•æ“
&lt;/h2>&lt;blockquote>
&lt;p>ä¸æ˜¯è¦è¯´MySQLçš„é”å—,æ€ä¹ˆè¯´ä¸Šå­˜å‚¨å¼•æ“äº†?å› ä¸ºMySQLå­˜å‚¨å¼•æ“ä¸åŒ,é”ä¹Ÿä¼šä¸åŒã€‚MySQLæœ‰&lt;strong>MyISAM&lt;/strong> å’Œ&lt;strong>InnoDB&lt;/strong>ä¸¤ç§å­˜å‚¨å¼•æ“ï¼Œç°åœ¨ä¸»è¦ä½¿ç”¨InnoDB,æ‰€ä»¥ä¸»è¦ä»‹ç»InnoDBä¸‹é”çš„ä½¿ç”¨ã€‚&lt;/p>
&lt;/blockquote>
&lt;p>InnoDBå¼•æ“æ”¯æŒäº‹åŠ¡æ“ä½œï¼Œä½¿ç”¨äº‹åŠ¡å¯ä»¥ä¿è¯å¤šæ¡sqlè¯­å¥æ‰§è¡Œçš„å®Œæ•´æ€§(è¦ä¸éƒ½æˆåŠŸ,è¦ä¸éƒ½å¤±è´¥)&lt;/p>
&lt;h5 id="äº‹åŠ¡æ˜¯ç”±ä¸€ç»„sqlè¯­å¥ç»„æˆçš„é€»è¾‘å¤„ç†å•å…ƒäº‹åŠ¡å…·æœ‰4å±æ€§">&lt;a href="#%e4%ba%8b%e5%8a%a1%e6%98%af%e7%94%b1%e4%b8%80%e7%bb%84sql%e8%af%ad%e5%8f%a5%e7%bb%84%e6%88%90%e7%9a%84%e9%80%bb%e8%be%91%e5%a4%84%e7%90%86%e5%8d%95%e5%85%83%e4%ba%8b%e5%8a%a1%e5%85%b7%e6%9c%894%e5%b1%9e%e6%80%a7" class="header-anchor">&lt;/a>äº‹åŠ¡æ˜¯ç”±ä¸€ç»„SQLè¯­å¥ç»„æˆçš„é€»è¾‘å¤„ç†å•å…ƒï¼Œäº‹åŠ¡å…·æœ‰4å±æ€§
&lt;/h5>&lt;ul>
&lt;li>åŸå­æ€§ï¼ˆActomicityï¼‰ï¼šäº‹åŠ¡æ˜¯ä¸€ä¸ªåŸå­æ“ä½œå•å…ƒï¼Œå…¶å¯¹æ•°æ®çš„ä¿®æ”¹ï¼Œè¦ä¹ˆå…¨éƒ½æ‰§è¡Œï¼Œè¦ä¹ˆå…¨éƒ½ä¸æ‰§è¡Œã€‚&lt;/li>
&lt;li>ä¸€è‡´æ€§ï¼ˆConsistentï¼‰ï¼šåœ¨äº‹åŠ¡å¼€å§‹å’Œå®Œæˆæ—¶ï¼Œæ•°æ®éƒ½å¿…é¡»ä¿æŒä¸€è‡´çŠ¶æ€ã€‚è¿™æ„å‘³ç€æ‰€æœ‰ç›¸å…³çš„æ•°æ®è§„åˆ™éƒ½å¿…é¡»åº”ç”¨äºäº‹åŠ¡çš„ä¿®æ”¹ï¼Œä»¥æ“æŒå®Œæ•´æ€§ï¼›äº‹åŠ¡ç»“æŸæ—¶ï¼Œæ‰€æœ‰çš„å†…éƒ¨æ•°æ®ç»“æ„ï¼ˆå¦‚Bæ ‘ç´¢å¼•æˆ–åŒå‘é“¾è¡¨ï¼‰ä¹Ÿéƒ½å¿…é¡»æ˜¯æ­£ç¡®çš„ã€‚&lt;/li>
&lt;li>éš”ç¦»æ€§ï¼ˆIsolationï¼‰ï¼šæ•°æ®åº“ç³»ç»Ÿæä¾›ä¸€å®šçš„éš”ç¦»æœºåˆ¶ï¼Œä¿è¯äº‹åŠ¡åœ¨ä¸å—å¤–éƒ¨å¹¶å‘æ“ä½œå½±å“çš„â€œç‹¬ç«‹â€ç¯å¢ƒæ‰§è¡Œã€‚è¿™æ„å‘³ç€äº‹åŠ¡å¤„ç†è¿‡ç¨‹ä¸­çš„ä¸­é—´çŠ¶æ€å¯¹å¤–éƒ¨æ˜¯ä¸å¯è§çš„ï¼Œåä¹‹äº¦ç„¶ã€‚&lt;/li>
&lt;li>æŒä¹…æ€§ï¼ˆDurableï¼‰ï¼šäº‹åŠ¡å®Œæˆä¹‹åï¼Œå®ƒå¯¹äºæ•°æ®çš„ä¿®æ”¹æ˜¯æ°¸ä¹…æ€§çš„ï¼Œå³ä½¿å‡ºç°ç³»ç»Ÿæ•…éšœä¹Ÿèƒ½å¤Ÿä¿æŒã€‚&lt;/li>
&lt;/ul>
&lt;h5 id="å¤šä¸ªäº‹åŠ¡å¹¶å‘æ‰§è¡Œä¼šå¸¦æ¥æ–°çš„é—®é¢˜">&lt;a href="#%e5%a4%9a%e4%b8%aa%e4%ba%8b%e5%8a%a1%e5%b9%b6%e5%8f%91%e6%89%a7%e8%a1%8c%e4%bc%9a%e5%b8%a6%e6%9d%a5%e6%96%b0%e7%9a%84%e9%97%ae%e9%a2%98" class="header-anchor">&lt;/a>å¤šä¸ªäº‹åŠ¡å¹¶å‘æ‰§è¡Œä¼šå¸¦æ¥æ–°çš„é—®é¢˜
&lt;/h5>&lt;ul>
&lt;li>æ›´æ–°ä¸¢å¤±ï¼ˆLost Updateï¼‰ï¼šå½“ä¸¤ä¸ªæˆ–å¤šä¸ªäº‹åŠ¡é€‰æ‹©åŒä¸€è¡Œï¼Œç„¶ååŸºäºæœ€åˆé€‰å®šçš„å€¼æ›´æ–°è¯¥è¡Œæ—¶ï¼Œç”±äºæ¯ä¸ª äº‹åŠ¡éƒ½ä¸çŸ¥é“å…¶ä»–äº‹åŠ¡çš„å­˜åœ¨ï¼Œå°±ä¼šå‘ç”Ÿä¸¢å¤±æ›´æ–°é—®é¢˜â€”â€”æœ€åçš„æ›´æ–°è¦†ç›–äº†å…¶ä»–äº‹åŠ¡æ‰€åšçš„æ›´æ–°ã€‚ä¾‹å¦‚ï¼Œä¸¤ä¸ªç¼–è¾‘äººå‘˜åˆ¶ä½œäº†åŒä¸€æ–‡æ¡£çš„ç”µå­å‰¯æœ¬ã€‚æ¯ä¸ªç¼–è¾‘äººå‘˜ç‹¬ç«‹åœ°æ›´æ”¹å…¶å‰¯æœ¬ï¼Œç„¶åä¿å­˜æ›´æ”¹åçš„å‰¯æœ¬ï¼Œè¿™æ ·å°±è¦†ç›–äº†åŸå§‹æ–‡æ¡£ã€‚æœ€åä¿å­˜å…¶æ›´æ”¹ä¿å­˜å…¶æ›´æ”¹å‰¯æœ¬çš„ç¼–è¾‘äººå‘˜è¦†ç›–å¦ä¸€ä¸ªç¼–è¾‘äººå‘˜æ‰€åšçš„ä¿®æ”¹ã€‚å¦‚æœåœ¨ä¸€ä¸ªç¼–è¾‘äººå‘˜å®Œæˆå¹¶æäº¤äº‹åŠ¡ä¹‹å‰ï¼Œå¦ä¸€ä¸ªç¼–è¾‘äººå‘˜ä¸èƒ½è®¿é—®åŒä¸€æ–‡ä»¶ï¼Œåˆ™å¯é¿å…æ­¤é—®é¢˜&lt;/li>
&lt;li>è„è¯»ï¼ˆDirty Readsï¼‰ï¼šä¸€ä¸ªäº‹åŠ¡æ­£åœ¨å¯¹ä¸€æ¡è®°å½•åšä¿®æ”¹ï¼Œåœ¨è¿™ä¸ªäº‹åŠ¡å¹¶æäº¤å‰ï¼Œè¿™æ¡è®°å½•çš„æ•°æ®å°±å¤„äºä¸ä¸€è‡´çŠ¶æ€ï¼›è¿™æ—¶ï¼Œå¦ä¸€ä¸ªäº‹åŠ¡ä¹Ÿæ¥è¯»å–åŒä¸€æ¡è®°å½•ï¼Œå¦‚æœä¸åŠ æ§åˆ¶ï¼Œç¬¬äºŒä¸ªäº‹åŠ¡è¯»å–äº†è¿™äº›â€œè„â€çš„æ•°æ®ï¼Œå¹¶æ®æ­¤åšè¿›ä¸€æ­¥çš„å¤„ç†ï¼Œå°±ä¼šäº§ç”Ÿæœªæäº¤çš„æ•°æ®ä¾èµ–å…³ç³»ã€‚è¿™ç§ç°è±¡è¢«å½¢è±¡åœ°å«åšâ€œè„è¯»â€ã€‚&lt;/li>
&lt;li>ä¸å¯é‡å¤è¯»ï¼ˆNon-Repeatable Readsï¼‰ï¼šä¸€ä¸ªäº‹åŠ¡åœ¨è¯»å–æŸäº›æ•°æ®å·²ç»å‘ç”Ÿäº†æ”¹å˜ã€æˆ–æŸäº›è®°å½•å·²ç»è¢«åˆ é™¤äº†ï¼è¿™ç§ç°è±¡å«åšâ€œä¸å¯é‡å¤è¯»â€ã€‚&lt;/li>
&lt;li>å¹»è¯»ï¼ˆPhantom Readsï¼‰ï¼šä¸€ä¸ªäº‹åŠ¡æŒ‰ç›¸åŒçš„æŸ¥è¯¢æ¡ä»¶é‡æ–°è¯»å–ä»¥å‰æ£€ç´¢è¿‡çš„æ•°æ®ï¼Œå´å‘ç°å…¶ä»–äº‹åŠ¡æ’å…¥äº†æ»¡è¶³å…¶æŸ¥è¯¢æ¡ä»¶çš„æ–°æ•°æ®ï¼Œè¿™ç§ç°è±¡å°±ç§°ä¸ºâ€œå¹»è¯»â€ã€‚&lt;/li>
&lt;/ul>
&lt;p>æ›¾ç»å¹´å°‘æ— çŸ¥çš„æˆ‘,ä»¥ä¸ºä½¿ç”¨äº‹åŠ¡å°±èƒ½ä¿è¯å¹¶å‘æƒ…å†µä¸‹æ•°æ®åŒæ­¥é—®é¢˜,åæ¥çš„ä¸€æ¬¡æƒ¨ç—›ç»å†æ‰æ˜ç™½äº†,äº‹åŠ¡ä¸èƒ½ä¿è¯å¹¶å‘æƒ…å†µçš„æ•°æ®åŒæ­¥é—®é¢˜,éœ€è¦äº‹åŠ¡å’Œé”åŒæ—¶ä½¿ç”¨æ‰èƒ½ä¿è¯ã€‚&lt;/p>
&lt;h2 id="é”çš„ç§ç±»">&lt;a href="#%e9%94%81%e7%9a%84%e7%a7%8d%e7%b1%bb" class="header-anchor">&lt;/a>é”çš„ç§ç±»
&lt;/h2>&lt;blockquote>
&lt;ul>
&lt;li>ä¹è§‚é” æœºåˆ¶é‡‡å–äº†æ›´åŠ å®½æ¾çš„åŠ é”æœºåˆ¶ã€‚æ‚²è§‚é”å¤§å¤šæ•°æƒ…å†µä¸‹ä¾é æ•°æ®åº“çš„é”æœºåˆ¶å®ç°ï¼Œä»¥ä¿è¯æ“ä½œæœ€å¤§ç¨‹åº¦çš„ç‹¬å æ€§ã€‚ä½†éšä¹‹è€Œæ¥çš„å°±æ˜¯æ•°æ®åº“æ€§èƒ½çš„å¤§é‡å¼€é”€ï¼Œç‰¹åˆ«æ˜¯å¯¹é•¿äº‹åŠ¡è€Œè¨€ï¼Œè¿™æ ·çš„å¼€é”€å¾€å¾€æ— æ³•æ‰¿å—ã€‚ç›¸å¯¹æ‚²è§‚é”è€Œè¨€ï¼Œä¹è§‚é”æ›´å€¾å‘äºå¼€å‘è¿ç”¨ã€‚&lt;/li>
&lt;li>æ‚²è§‚é” å…·æœ‰å¼ºçƒˆçš„ç‹¬å å’Œæ’ä»–ç‰¹æ€§ã€‚å®ƒæŒ‡çš„æ˜¯å¯¹æ•°æ®è¢«å¤–ç•Œï¼ˆåŒ…æ‹¬æœ¬ç³»ç»Ÿå½“å‰çš„å…¶ä»–äº‹åŠ¡ï¼Œä»¥åŠæ¥è‡ªå¤–éƒ¨ç³»ç»Ÿçš„äº‹åŠ¡å¤„ç†ï¼‰ä¿®æ”¹æŒä¿å®ˆæ€åº¦ï¼Œå› æ­¤ï¼Œåœ¨æ•´ä¸ªæ•°æ®å¤„ç†è¿‡ç¨‹ä¸­ï¼Œå°†æ•°æ®å¤„äºé”å®šçŠ¶æ€ã€‚æ‚²è§‚é”çš„å®ç°ï¼Œå¾€å¾€ä¾é æ•°æ®åº“æä¾›çš„é”æœºåˆ¶ï¼ˆä¹Ÿåªæœ‰æ•°æ®åº“å±‚æä¾›çš„é”æœºåˆ¶æ‰èƒ½çœŸæ­£ä¿è¯æ•°æ®è®¿é—®çš„æ’ä»–æ€§ï¼Œå¦åˆ™ï¼Œå³ä½¿åœ¨æœ¬ç³»ç»Ÿä¸­å®ç°äº†åŠ é”æœºåˆ¶ï¼Œä¹Ÿæ— æ³•ä¿è¯å¤–éƒ¨ç³»ç»Ÿä¸ä¼šä¿®æ”¹æ•°æ®ï¼‰ã€‚&lt;/li>
&lt;/ul>
&lt;/blockquote>
&lt;h2 id="mysqlä¸­é”çš„ç§ç±»">&lt;a href="#mysql%e4%b8%ad%e9%94%81%e7%9a%84%e7%a7%8d%e7%b1%bb" class="header-anchor">&lt;/a>MySQLä¸­é”çš„ç§ç±»
&lt;/h2>&lt;blockquote>
&lt;p>ä¹è§‚é”å’Œæ‚²è§‚é”æ˜¯ä¸€ç§æ€æƒ³,ä¸æ˜¯å…·ä½“å®ç°,åœ¨MySQLä¸­,æœ‰é”çš„å…·ä½“çš„å®ç°æ–¹å¼
(æ–‡ä¸­çš„çº¿ç¨‹åœ¨MySQLä¸­å¯ä»¥è§†ä½œMySQLçš„è¿æ¥)&lt;/p>
&lt;ul>
&lt;li>å…±äº«é” ä¸€ä¸ªçº¿ç¨‹åœ¨æŒæœ‰é”æ—¶,å…¶ä»–çš„çº¿ç¨‹å¯ä»¥æŸ¥è¯¢è¢«é”çš„æ•°æ®,ä½†æ˜¯ä¸èƒ½ä¿®æ”¹,ä¸èƒ½åˆ é™¤ã€‚å®ç°æ–¹å¼
&lt;code> SELECT * FROM table_name WHERE id =? lock in share mode;&lt;/code>&lt;/li>
&lt;li>æ’å®ƒé” ä¸€ä¸ªçº¿ç¨‹åœ¨æŒæœ‰é”æ—¶,å…¶ä»–çš„çº¿ç¨‹ä¸èƒ½æŸ¥è¯¢,ä¸èƒ½æ›´æ–°,ä¸èƒ½åˆ é™¤è¢«é”çš„æ•°æ®,ç›´åˆ°é”è¢«é‡Šæ”¾.
&amp;gt; &lt;code>SELECT * FROM table_name WHERE id =? for update&lt;/code>&lt;/li>
&lt;li>æ€»ç»“ä¸€ä¸‹:å…±äº«é”ç±»ä¼¼äºjavaä¸­çš„è¯»é”,ä¸€ä¸ªçº¿ç¨‹åœ¨æŒæœ‰ä¹è§‚é”çš„æ—¶å€™,å…¶ä»–çš„çº¿ç¨‹ä¹Ÿå¯ä»¥å¯¹è¢«é”çš„æ•°æ®è¿›è¡Œè¯»æ“ä½œ,ä½†æ˜¯ä¸èƒ½å¯¹è¢«é”çš„æ•°æ®è¿›è¡Œåˆ é™¤å’Œæ›´æ–°æ“ä½œ;æ’ä»–é”ç±»ä¼¼äºjavaçš„å†™é”,ä¸€ä¸ªçº¿ç¨‹æŒæœ‰å†™é”çš„æ—¶å€™,å…¶ä»–çš„çº¿ç¨‹ä¸èƒ½å†å¯¹è¢«é”çš„æ•°æ®è¿›è¡Œä»»ä½•æŸ¥è¯¢,æ›´æ–°,åˆ é™¤æ“ä½œã€‚&lt;/li>
&lt;li>&lt;strong>é‡ç‚¹&lt;/strong> InnoDBçš„è¡Œé”æ˜¯åŸºäºç´¢å¼•å®ç°çš„,å¦‚æœåœ¨æŸ¥è¯¢ä¸­ä¸ä½¿ç”¨ç´¢å¼•,ä¼šé”è¡¨ã€‚&lt;/li>
&lt;/ul>
&lt;/blockquote>
&lt;h2 id="mysqlé”ç²’åº¦">&lt;a href="#mysql%e9%94%81%e7%b2%92%e5%ba%a6" class="header-anchor">&lt;/a>MySQLé”ç²’åº¦
&lt;/h2>&lt;blockquote>
&lt;ul>
&lt;li>è¡¨çº§é” æ˜¯MySQLä¸­é”å®šç²’åº¦æœ€å¤§çš„ä¸€ç§é”ï¼Œè¡¨ç¤ºå¯¹å½“å‰æ“ä½œçš„æ•´å¼ è¡¨åŠ é”ï¼Œå®ƒå®ç°ç®€å•ï¼Œèµ„æºæ¶ˆè€—è¾ƒå°‘ï¼Œè¢«å¤§éƒ¨åˆ†MySQLå¼•æ“æ”¯æŒã€‚æœ€å¸¸ä½¿ç”¨çš„MyISAMä¸InnoDBéƒ½æ”¯æŒè¡¨çº§é”å®šã€‚è¡¨çº§é”åˆ†ä¸ºè¡¨å…±äº«è¯»é”ä¸è¡¨ç‹¬å å†™é”ã€‚&lt;/li>
&lt;li>è¡Œçº§é” æ˜¯Mysqlä¸­é”å®šç²’åº¦æœ€ç»†çš„ä¸€ç§é”ï¼Œè¡¨ç¤ºåªé’ˆå¯¹å½“å‰æ“ä½œçš„è¡Œè¿›è¡ŒåŠ é”ã€‚è¡Œçº§é”èƒ½å¤§å¤§å‡å°‘æ•°æ®åº“æ“ä½œçš„å†²çªã€‚å…¶åŠ é”ç²’åº¦æœ€å°ï¼Œä½†åŠ é”çš„å¼€é”€ä¹Ÿæœ€å¤§ã€‚è¡Œçº§é”åˆ†ä¸ºå…±äº«é” å’Œ æ’ä»–é”ã€‚&lt;/li>
&lt;/ul>
&lt;/blockquote>
&lt;h2 id="å…±äº«é”çš„ä½¿ç”¨">&lt;a href="#%e5%85%b1%e4%ba%ab%e9%94%81%e7%9a%84%e4%bd%bf%e7%94%a8" class="header-anchor">&lt;/a>å…±äº«é”çš„ä½¿ç”¨
&lt;/h2>&lt;h4 id="æ³¨æ„-ä¸‹é¢çš„æ“ä½œéƒ½æ˜¯è¡Œé”æ“ä½œmysqlä¸ºinnodbå¼•æ“idä¸ºè‡ªå¢ä¸»é”®">&lt;a href="#%e6%b3%a8%e6%84%8f-%e4%b8%8b%e9%9d%a2%e7%9a%84%e6%93%8d%e4%bd%9c%e9%83%bd%e6%98%af%e8%a1%8c%e9%94%81%e6%93%8d%e4%bd%9cmysql%e4%b8%bainnodb%e5%bc%95%e6%93%8eid%e4%b8%ba%e8%87%aa%e5%a2%9e%e4%b8%bb%e9%94%ae" class="header-anchor">&lt;/a>æ³¨æ„: ä¸‹é¢çš„æ“ä½œ,éƒ½æ˜¯è¡Œé”æ“ä½œ,MySQLä¸ºInnoDBå¼•æ“,idä¸ºè‡ªå¢ä¸»é”®
&lt;/h4>&lt;p>å…ˆåˆ›å»ºä¸€ä¸ªæµ‹è¯•è¡¨&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-sql" data-lang="sql">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">CREATE&lt;/span> &lt;span style="color:#ff79c6">TABLE&lt;/span> &lt;span style="color:#ff79c6">`&lt;/span>test&lt;span style="color:#ff79c6">`&lt;/span> (
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span> &lt;span style="color:#ff79c6">`&lt;/span>id&lt;span style="color:#ff79c6">`&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">int&lt;/span>(&lt;span style="color:#bd93f9">0&lt;/span>) &lt;span style="color:#ff79c6">NOT&lt;/span> &lt;span style="color:#ff79c6">NULL&lt;/span> AUTO_INCREMENT,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3&lt;/span>&lt;span> &lt;span style="color:#ff79c6">`&lt;/span>name&lt;span style="color:#ff79c6">`&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">varchar&lt;/span>(&lt;span style="color:#bd93f9">20&lt;/span>) &lt;span style="color:#ff79c6">NOT&lt;/span> &lt;span style="color:#ff79c6">NULL&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4&lt;/span>&lt;span> &lt;span style="color:#ff79c6">`&lt;/span>&lt;span style="color:#8be9fd;font-style:italic">number&lt;/span>&lt;span style="color:#ff79c6">`&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">bigint&lt;/span>(&lt;span style="color:#bd93f9">0&lt;/span>) &lt;span style="color:#ff79c6">NOT&lt;/span> &lt;span style="color:#ff79c6">NULL&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5&lt;/span>&lt;span> &lt;span style="color:#ff79c6">`&lt;/span>age&lt;span style="color:#ff79c6">`&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">int&lt;/span>(&lt;span style="color:#bd93f9">0&lt;/span>) &lt;span style="color:#ff79c6">NULL&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6&lt;/span>&lt;span> &lt;span style="color:#ff79c6">PRIMARY&lt;/span> &lt;span style="color:#ff79c6">KEY&lt;/span> (&lt;span style="color:#ff79c6">`&lt;/span>id&lt;span style="color:#ff79c6">`&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7&lt;/span>&lt;span>) ENGINE &lt;span style="color:#ff79c6">=&lt;/span> InnoDB;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>çœ‹ä¸€ä¸‹éšä¾¿æ’å…¥çš„å‡ æ¡æ•°æ®
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-b259874f3254fd99.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-b259874f3254fd99.webp" alt="" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;blockquote>
&lt;p>æ²¡æœ‰é—®é¢˜,ä½¿ç”¨å…±äº«é”çœ‹ä¸€ä¸‹æ•ˆæœ:&lt;/p>
&lt;ol>
&lt;li>å¼€å¯äº‹åŠ¡ &lt;code>begin;&lt;/code>&lt;/li>
&lt;li>ç»™idä¸º1çš„æ•°æ®åŠ å…±äº«é” &lt;code>mysql&amp;gt; select * from test where id=1 lock in share mode;&lt;/code>&lt;/li>
&lt;li>åˆ†åˆ«ä½¿ç”¨åŠ é”å’Œä¸åŠ é”æŸ¥è¯¢idä¸º1 çš„æ•°æ®
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-811690b2ef25d25d.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-811690b2ef25d25d.webp" alt="" />
&lt;/a>
&lt;/div>
&amp;gt;éƒ½å¯ä»¥æŸ¥è¯¢åˆ°æ•°æ®&lt;/li>
&lt;/ol>
&lt;/blockquote>
&lt;blockquote>
&lt;p>ä¿®æ”¹idä¸º1 çš„æ•°æ®çœ‹çœ‹
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-ba4482476ff9ee78.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-ba4482476ff9ee78.webp" alt="" />
&lt;/a>
&lt;/div>
sqlè¯­å¥ä¼šä¸€ç›´åœåœ¨è¿™é‡Œ,ç›´åˆ°è¶…æ—¶æˆ–è€…é”é‡Šæ”¾(äº‹åŠ¡æäº¤æˆ–è€…å›æ»š)
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-48184bff1a6d5188.png">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-48184bff1a6d5188.png" alt="" />
&lt;/a>
&lt;/div>
å·¦è¾¹çš„äº‹åŠ¡æäº¤å,å³è¾¹çš„sqlä¼šæ‰§è¡Œ,å®Œæˆæ›´æ–°æ“ä½œã€‚&lt;/p>
&lt;/blockquote>
&lt;p>åŒæ ·,åˆ é™¤æ“ä½œä¹Ÿä¼šç­‰å¾…é”é‡Šæ”¾æ‰èƒ½æ“ä½œ,è¿™é‡Œå°±ä¸æ¼”ç¤ºäº†ã€‚&lt;/p>
&lt;hr>
&lt;blockquote>
&lt;p>å†çœ‹ä¸€ä¸‹å¦ä¸€ç§æƒ…å†µ,å·¦è¾¹é”ä½idä¸º5çš„æ•°æ®,å³è¾¹æ›´æ–°idä¸º1 çš„æ•°æ®,ä¸å—å½±å“ã€‚è¿™å°±æ˜¯è¡Œçº§é”ï¼Œåªä¼šé”ä½ç›¸å…³çš„ä¸€è¡Œæ•°æ®
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-3206524302bab201.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-3206524302bab201.webp" alt="" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;/blockquote>
&lt;h2 id="æ’ä»–é”çš„ä½¿ç”¨">&lt;a href="#%e6%8e%92%e4%bb%96%e9%94%81%e7%9a%84%e4%bd%bf%e7%94%a8" class="header-anchor">&lt;/a>æ’ä»–é”çš„ä½¿ç”¨
&lt;/h2>&lt;p>è¿˜æ˜¯ä½¿ç”¨testè¿™å¼ è¡¨&lt;/p>
&lt;blockquote>
&lt;ol>
&lt;li>å¼€å¯äº‹åŠ¡&lt;code>begin;&lt;/code>&lt;/li>
&lt;li>ç»™id1çš„æ•°æ®åŠ æ’ä»–é”&lt;code>select * from test where id = 1 for update;&lt;/code>&lt;/li>
&lt;li>åœ¨å³è¾¹æŸ¥è¯¢idä¸º1çš„æ•°æ®
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-cb4034d4fbf6d486.png">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-cb4034d4fbf6d486.png" alt="" />
&lt;/a>
&lt;/div>
æŸ¥è¯¢è¯­å¥ä¼šä¸€ç›´ç­‰å¾…,ç›´åˆ°è¶…æ—¶æˆ–è€…é”é‡Šæ”¾(å·¦è¾¹commitæˆ–è€…rollback)&lt;/li>
&lt;/ol>
&lt;/blockquote>
&lt;hr>
&lt;blockquote>
&lt;p>å·¦è¾¹commitå
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-9571df6d6d6969d0.png">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-9571df6d6d6969d0.png" alt="" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;/blockquote>
&lt;hr>
&lt;blockquote>
&lt;p>ä½¿ç”¨æ’å®ƒé”å¯¹idä¸º5çš„æ•°æ®åŠ é”å,æ›´æ–°idä¸º5çš„æ•°æ®
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-9fa71ed1dd9e7a97.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-9fa71ed1dd9e7a97.webp" alt="" />
&lt;/a>
&lt;/div>
sqlè¯­å¥åŒæ ·ä¼šç­‰å¾…,ç›´åˆ°è¶…æ—¶æˆ–è€…é”é‡Šæ”¾,åˆ é™¤æ“ä½œä¹Ÿæ˜¯ä¸€æ ·&lt;/p>
&lt;/blockquote>
&lt;blockquote>
&lt;p>çœ‹ä¸€ä¸‹å¯¹idä¸º1çš„æ•°æ®åŠ é”,ç„¶åæ“ä½œidä¸ä¸º1çš„æ•°æ®çš„æƒ…å†µ
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-4424da5869c313f6.png">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-4424da5869c313f6.png" alt="" />
&lt;/a>
&lt;/div>
æ²¡æœ‰é—®é¢˜,MySQLåªæ˜¯é”ä½äº†idä¸º5çš„æ•°æ®,å…¶ä»–çš„æ•°æ®éƒ½å¯ä»¥æ“ä½œã€‚&lt;/p>
&lt;/blockquote>
&lt;h3 id="çœ‹ä¸€ä¸‹innodbå¼•æ“é”è¡¨çš„æƒ…å†µ">&lt;a href="#%e7%9c%8b%e4%b8%80%e4%b8%8binnodb%e5%bc%95%e6%93%8e%e9%94%81%e8%a1%a8%e7%9a%84%e6%83%85%e5%86%b5" class="header-anchor">&lt;/a>çœ‹ä¸€ä¸‹InnoDBå¼•æ“é”è¡¨çš„æƒ…å†µ
&lt;/h3>&lt;blockquote>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-a7e3773e931456e3.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-a7e3773e931456e3.webp" alt="" />
&lt;/a>
&lt;/div>
æˆ‘ä»¬å¸¸å¸¸è¯´InnoDBæ˜¯è¡Œé”ï¼Œä½†æ˜¯è¿™é‡Œä»‹ç»ä¸€ä¸‹å®ƒé”è¡¨çš„æƒ…å†µã€‚å› ä¸ºnameåˆ—æ²¡æœ‰ç´¢å¼•,æ‰€ä»¥,åœ¨åŠ è¡Œé”çš„æ—¶å€™,MySQLä¸èƒ½åŠ æ­£å¸¸åŠ è¡Œé”,ä¼šé”ä½æ•´å¼ è¡¨ã€‚
InnoDBè¡Œé”æ˜¯é€šè¿‡ç´¢å¼•ä¸Šçš„ç´¢å¼•é¡¹æ¥å®ç°çš„ï¼Œè¿™ä¸€ç‚¹ï¼­ySQLä¸Oracleä¸åŒï¼Œåè€…æ˜¯é€šè¿‡åœ¨æ•°æ®ä¸­å¯¹ç›¸åº”æ•°æ®è¡ŒåŠ é”æ¥å®ç°çš„ã€‚InnoDBè¿™ç§è¡Œé”å®ç°ç‰¹ç‚¹æ„å‘³è€…ï¼šåªæœ‰é€šè¿‡ç´¢å¼•æ¡ä»¶æ£€ç´¢æ•°æ®ï¼ŒInnoDBæ‰ä¼šä½¿ç”¨è¡Œçº§é”ï¼Œå¦åˆ™ï¼ŒInnoDBå°†ä½¿ç”¨è¡¨é”ï¼
åœ¨å®é™…åº”ç”¨ä¸­ï¼Œè¦ç‰¹åˆ«æ³¨æ„InnoDBè¡Œé”çš„è¿™ä¸€ç‰¹æ€§ï¼Œä¸ç„¶çš„è¯ï¼Œå¯èƒ½å¯¼è‡´å¤§é‡çš„é”å†²çªï¼Œä»è€Œå½±å“å¹¶å‘æ€§èƒ½ã€‚&lt;/p>
&lt;/blockquote>
&lt;h3 id="å†çœ‹å¦ä¸€ç§æƒ…å†µ">&lt;a href="#%e5%86%8d%e7%9c%8b%e5%8f%a6%e4%b8%80%e7%a7%8d%e6%83%85%e5%86%b5" class="header-anchor">&lt;/a>å†çœ‹å¦ä¸€ç§æƒ…å†µ
&lt;/h3>&lt;blockquote>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-553d084474795bbb.png">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-553d084474795bbb.png" alt="" />
&lt;/a>
&lt;/div>
ä½¿ç”¨æ’å®ƒé”å¯¹idä¸º1çš„æ•°æ®åŠ é”æ—¶,ä½¿ç”¨ä¸åŠ é”çš„æŸ¥è¯¢å’Œæ²¡æœ‰çº¦æŸçš„æŸ¥è¯¢æ—¶,ä¸€æ ·å¯ä»¥ç«‹åˆ»æŸ¥è¯¢åˆ°æ•°æ®ã€‚åªæœ‰ä½¿ç”¨åŠ é”çš„æŸ¥è¯¢æˆ–è€…æ›´æ–°å’Œåˆ é™¤æ—¶æ‰ä¼šç­‰å¾…é”é‡Šæ”¾ã€‚&lt;/p>
&lt;/blockquote>
&lt;h2 id="æ€»ç»“">&lt;a href="#%e6%80%bb%e7%bb%93" class="header-anchor">&lt;/a>æ€»ç»“
&lt;/h2>&lt;ul>
&lt;li>InnoDBçš„é”é…åˆäº‹åŠ¡ä½¿ç”¨&lt;/li>
&lt;li>MySQLæœ‰å…±äº«é”å’Œæ’å®ƒé”&lt;/li>
&lt;li>ä½¿ç”¨å…±äº«é”æ—¶,å…¶ä»–çº¿ç¨‹(è¿æ¥)å¯ä»¥æŸ¥è¯¢æ•°æ®,ä½†æ˜¯ä¸èƒ½æ›´æ–°å’Œåˆ é™¤æ•°æ®,ä½¿ç”¨æ’å®ƒé”æ—¶,ä¸èƒ½æŸ¥è¯¢æ•°æ®ä¸èƒ½æ›´æ–°æ•°æ®,ä¸èƒ½åˆ é™¤æ•°æ®&lt;/li>
&lt;li>MySQLçš„InnoDBå¼•æ“æ”¯æŒè¡Œçº§é”å’Œè¡¨çº§é”,è¡Œçº§é”&lt;/li>
&lt;li>InnoDBçš„è¡Œçº§é”æ˜¯åŸºäºç´¢å¼•çš„,åŠ é”æ˜¯å¯¹ç´¢å¼•åŠ é”,åŠ é”æ—¶æ²¡æœ‰ç´¢å¼•æ—¶ä¼šé”ä½æ•´å¼ è¡¨&lt;/li>
&lt;/ul>
&lt;p>ä»¥ä¸Šæ˜¯æˆ‘å¯¹MySQLé”çš„ç†è§£,æ–‡ä¸­å¦‚æœæœ‰ä¸æ­£ç¡®çš„åœ°æ–¹,è¿˜è¯·å„ä½å¤§å“¥æ‰¹è¯„æŒ‡æ­£ã€‚&lt;/p></description></item><item><title>mysqlä½¿ç”¨ç´¢å¼•æé«˜æŸ¥è¯¢æ•ˆç‡</title><link>https://lqxhub.github.io/posts/82773ef8/</link><pubDate>Thu, 25 Oct 2018 09:50:04 +0000</pubDate><guid>https://lqxhub.github.io/posts/82773ef8/</guid><description>&lt;p>mysqlå•è¡¨ä¸­æ•°æ®é‡åˆ°è¾¾ä¸€å®šæ•°é‡å,æŸ¥è¯¢æ•ˆç‡ä¼šå˜å¾—å¾ˆä½,ä½¿ç”¨ç´¢å¼•å¯ä»¥æœ‰æ•ˆåœ°æé«˜mysqlçš„æŸ¥è¯¢æ•ˆç‡.ä½†æ˜¯ç´¢å¼•ä½¿ç”¨ä¸å½“,ä¼šä½¿ç´¢å¼•å¤±æ•ˆ,èµ·ä¸åˆ°æå‡æ•ˆç‡çš„ä½œç”¨,åœ¨å®é™…é¡¹ç›®ä¸­,è¦åšå¥½ç´¢å¼•çš„ä¼˜åŒ–,åˆç†çš„ä½¿ç”¨ç´¢å¼•ã€‚å…³äºç´¢å¼•çš„ä¼˜åŒ–ï¼Œå¯ä»¥å‚è€ƒè¿™ç¯‡æ–‡ç« ï¼Œ&lt;a class="link" href="https://www.jianshu.com/p/07c42e310e67" target="_blank" rel="noopener"
>ä¼ é€é—¨&lt;/a>&lt;/p>
&lt;p>ä¸ºäº†åˆ†æsqlè¯­å¥æ‰§è¡Œæ•ˆç‡,ä½¿ç”¨&lt;strong>explain&lt;/strong> åˆ†æsqlè¯­å¥
ä½¿ç”¨explainå…³é”®å­—å¯ä»¥æ¨¡æ‹Ÿä¼˜åŒ–å™¨æ‰§è¡ŒsqlæŸ¥è¯¢è¯­å¥ï¼Œä»è€Œå¾—çŸ¥MySQL æ˜¯å¦‚ä½•å¤„ç†sqlè¯­å¥ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-fallback" data-lang="fallback">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>+----+-------------+-------+------------+-------+---------------+---------+---------+-------+------+----------+-------------+
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span>| id | select_type | table | partitions | type | possible_keys | key | key_len | ref | rows | filtered | Extra |
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3&lt;/span>&lt;span>+----+-------------+-------+------------+-------+---------------+---------+---------+-------+------+----------+-------------+
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="id">&lt;a href="#id" class="header-anchor">&lt;/a>id
&lt;/h2>&lt;blockquote>
&lt;p>select æŸ¥è¯¢çš„åºåˆ—å·ï¼ŒåŒ…å«ä¸€ç»„å¯ä»¥é‡å¤çš„æ•°å­—ï¼Œè¡¨ç¤ºæŸ¥è¯¢ä¸­æ‰§è¡Œsqlè¯­å¥çš„é¡ºåºã€‚ä¸€èˆ¬æœ‰ä¸‰ç§æƒ…å†µï¼š
ç¬¬ä¸€ç§ï¼šidå…¨éƒ¨ç›¸åŒï¼Œsqlçš„æ‰§è¡Œé¡ºåºæ˜¯ç”±ä¸Šè‡³ä¸‹ï¼›
ç¬¬äºŒç§ï¼šidå…¨éƒ¨ä¸åŒï¼Œsqlçš„æ‰§è¡Œé¡ºåºæ˜¯æ ¹æ®idå¤§çš„ä¼˜å…ˆæ‰§è¡Œï¼›
ç¬¬ä¸‰ç§ï¼šidæ—¢å­˜åœ¨ç›¸åŒï¼Œåˆå­˜åœ¨ä¸åŒçš„ã€‚å…ˆæ ¹æ®idå¤§çš„ä¼˜å…ˆæ‰§è¡Œï¼Œå†æ ¹æ®ç›¸åŒidä»ä¸Šè‡³ä¸‹çš„æ‰§è¡Œã€‚&lt;/p>
&lt;/blockquote>
&lt;h2 id="select_type">&lt;a href="#select_type" class="header-anchor">&lt;/a>select_type
&lt;/h2>&lt;blockquote>
&lt;p>select æŸ¥è¯¢çš„ç±»å‹ï¼Œä¸»è¦æ˜¯ç”¨äºåŒºåˆ«æ™®é€šæŸ¥è¯¢ï¼Œè”åˆæŸ¥è¯¢ï¼ŒåµŒå¥—çš„å¤æ‚æŸ¥è¯¢
**simpleï¼š**ç®€å•çš„select æŸ¥è¯¢ï¼ŒæŸ¥è¯¢ä¸­ä¸åŒ…å«å­æŸ¥è¯¢æˆ–è€…union
**primaryï¼š**æŸ¥è¯¢ä¸­è‹¥åŒ…å«ä»»ä½•å¤æ‚çš„å­æŸ¥è¯¢ï¼Œæœ€å¤–å±‚æŸ¥è¯¢åˆ™è¢«æ ‡è®°ä¸ºprimary
**subqueryï¼š**åœ¨selectæˆ–where åˆ—è¡¨ä¸­åŒ…å«äº†å­æŸ¥è¯¢
**derivedï¼š**åœ¨fromåˆ—è¡¨ä¸­åŒ…å«çš„å­æŸ¥è¯¢è¢«æ ‡è®°ä¸ºderivedï¼ˆè¡ç”Ÿï¼‰MySQLä¼šé€’å½’æ‰§è¡Œè¿™äº›å­æŸ¥è¯¢ï¼ŒæŠŠç»“æœæ”¾åœ¨ä¸´æ—¶è¡¨é‡Œã€‚
**unionï¼š**è‹¥ç¬¬äºŒä¸ªselectå‡ºç°åœ¨unionä¹‹åï¼Œåˆ™è¢«æ ‡è®°ä¸ºunionï¼Œè‹¥unionåŒ…å«åœ¨fromå­å¥çš„å­æŸ¥è¯¢ä¸­ï¼Œå¤–å±‚selectå°†è¢«æ ‡è®°ä¸ºï¼šderived
**union resultï¼š**ä»unionè¡¨è·å–ç»“æœçš„select&lt;/p>
&lt;/blockquote>
&lt;h2 id="partitions">&lt;a href="#partitions" class="header-anchor">&lt;/a>partitions
&lt;/h2>&lt;blockquote>
&lt;p>è¡¨æ‰€ä½¿ç”¨çš„åˆ†åŒºï¼Œå¦‚æœè¦ç»Ÿè®¡åå¹´å…¬å¸è®¢å•çš„é‡‘é¢ï¼Œå¯ä»¥æŠŠæ•°æ®åˆ†ä¸ºåä¸ªåŒºï¼Œæ¯ä¸€å¹´ä»£è¡¨ä¸€ä¸ªåŒºã€‚è¿™æ ·å¯ä»¥å¤§å¤§çš„æé«˜æŸ¥è¯¢æ•ˆç‡ã€‚&lt;/p>
&lt;/blockquote>
&lt;h2 id="type">&lt;a href="#type" class="header-anchor">&lt;/a>type
&lt;/h2>&lt;blockquote>
&lt;p>è¿™æ˜¯ä¸€ä¸ªéå¸¸é‡è¦çš„å‚æ•°ï¼Œè¿æ¥ç±»å‹ï¼Œå¸¸è§çš„æœ‰ï¼šall , index , range , ref , eq_ref , const , system , null å…«ä¸ªçº§åˆ«ã€‚
æ€§èƒ½ä»æœ€ä¼˜åˆ°æœ€å·®çš„æ’åºï¼šsystem &amp;gt; const &amp;gt; eq_ref &amp;gt; ref &amp;gt; range &amp;gt; index &amp;gt; all
åœ¨ä»£ç ä¸­,è‹¥ä¿è¯æŸ¥è¯¢è‡³å°‘è¾¾åˆ°rangeçº§åˆ«æˆ–è€…æœ€å¥½èƒ½è¾¾åˆ°refåˆ™ç®—æ˜¯ä¸€ä¸ªä¼˜ç§€è€Œåˆè´Ÿè´£çš„ç¨‹åºå‘˜ã€‚
&lt;strong>allï¼š&lt;/strong>ï¼ˆfull table scanï¼‰å…¨è¡¨æ‰«ææ— ç–‘æ˜¯æœ€å·®ï¼Œè‹¥æ˜¯ç™¾ä¸‡åƒä¸‡çº§æ•°æ®é‡ï¼Œå…¨è¡¨æ‰«æä¼šéå¸¸æ…¢ã€‚
&lt;strong>indexï¼š&lt;/strong>ï¼ˆfull index scanï¼‰å…¨ç´¢å¼•æ–‡ä»¶æ‰«ææ¯”allå¥½å¾ˆå¤šï¼Œæ¯•ç«Ÿä»ç´¢å¼•æ ‘ä¸­æ‰¾æ•°æ®ï¼Œæ¯”ä»å…¨è¡¨ä¸­æ‰¾æ•°æ®è¦å¿«ã€‚
**rangeï¼š**åªæ£€ç´¢ç»™å®šèŒƒå›´çš„è¡Œï¼Œä½¿ç”¨ç´¢å¼•æ¥åŒ¹é…è¡Œã€‚èŒƒå›´ç¼©å°äº†ï¼Œå½“ç„¶æ¯”å…¨è¡¨æ‰«æå’Œå…¨ç´¢å¼•æ–‡ä»¶æ‰«æè¦å¿«ã€‚sqlè¯­å¥ä¸­ä¸€èˆ¬ä¼šæœ‰betweenï¼Œinï¼Œ&amp;gt;ï¼Œ&amp;lt; ç­‰æŸ¥è¯¢ã€‚
**refï¼š**éå”¯ä¸€æ€§ç´¢å¼•æ‰«æï¼Œæœ¬è´¨ä¸Šä¹Ÿæ˜¯ä¸€ç§ç´¢å¼•è®¿é—®ï¼Œè¿”å›æ‰€æœ‰åŒ¹é…æŸä¸ªå•ç‹¬å€¼çš„è¡Œã€‚æ¯”å¦‚æŸ¥è¯¢å…¬å¸æ‰€æœ‰å±äºç ”å‘å›¢é˜Ÿçš„åŒäº‹ï¼ŒåŒ¹é…çš„ç»“æœæ˜¯å¤šä¸ªå¹¶éå”¯ä¸€å€¼ã€‚
**eq_refï¼š**å”¯ä¸€æ€§ç´¢å¼•æ‰«æï¼Œå¯¹äºæ¯ä¸ªç´¢å¼•é”®ï¼Œè¡¨ä¸­æœ‰ä¸€æ¡è®°å½•ä¸ä¹‹åŒ¹é…ã€‚æ¯”å¦‚æŸ¥è¯¢å…¬å¸çš„CEOï¼ŒåŒ¹é…çš„ç»“æœåªå¯èƒ½æ˜¯ä¸€æ¡è®°å½•ï¼Œ
**constï¼š**è¡¨ç¤ºé€šè¿‡ç´¢å¼•ä¸€æ¬¡å°±å¯ä»¥æ‰¾åˆ°ï¼Œconstç”¨äºæ¯”è¾ƒprimary key æˆ–è€…uniqueç´¢å¼•ã€‚å› ä¸ºåªåŒ¹é…ä¸€è¡Œæ•°æ®ï¼Œæ‰€ä»¥å¾ˆå¿«ï¼Œè‹¥å°†ä¸»é”®è‡³äºwhereåˆ—è¡¨ä¸­ï¼ŒMySQLå°±èƒ½å°†è¯¥æŸ¥è¯¢è½¬æ¢ä¸ºä¸€ä¸ªå¸¸é‡ã€‚
**systemï¼š**è¡¨åªæœ‰ä¸€æ¡è®°å½•ï¼ˆç­‰äºç³»ç»Ÿè¡¨ï¼‰ï¼Œè¿™æ˜¯constç±»å‹çš„ç‰¹åˆ—ï¼Œå¹³æ—¶ä¸ä¼šå‡ºç°ï¼Œäº†è§£å³å¯&lt;/p>
&lt;/blockquote>
&lt;h2 id="possible_keys">&lt;a href="#possible_keys" class="header-anchor">&lt;/a>possible_keys
&lt;/h2>&lt;blockquote>
&lt;p>æ˜¾ç¤ºæŸ¥è¯¢è¯­å¥å¯èƒ½ç”¨åˆ°çš„ç´¢å¼•(ä¸€ä¸ªæˆ–å¤šä¸ªæˆ–ä¸ºnull)ï¼Œä¸ä¸€å®šè¢«æŸ¥è¯¢å®é™…ä½¿ç”¨ã€‚ä»…ä¾›å‚è€ƒä½¿ç”¨ã€‚&lt;/p>
&lt;/blockquote>
&lt;h2 id="key">&lt;a href="#key" class="header-anchor">&lt;/a>key
&lt;/h2>&lt;blockquote>
&lt;p>æ˜¾ç¤ºæŸ¥è¯¢è¯­å¥å®é™…ä½¿ç”¨çš„ç´¢å¼•ã€‚è‹¥ä¸ºnullï¼Œåˆ™è¡¨ç¤ºæ²¡æœ‰ä½¿ç”¨ç´¢å¼•ã€‚&lt;/p>
&lt;/blockquote>
&lt;h2 id="key_len">&lt;a href="#key_len" class="header-anchor">&lt;/a>key_len
&lt;/h2>&lt;blockquote>
&lt;p>æ˜¾ç¤ºç´¢å¼•ä¸­ä½¿ç”¨çš„å­—èŠ‚æ•°ï¼Œå¯é€šè¿‡key_lenè®¡ç®—æŸ¥è¯¢ä¸­ä½¿ç”¨çš„ç´¢å¼•é•¿åº¦ã€‚åœ¨ä¸æŸå¤±ç²¾ç¡®æ€§çš„æƒ…å†µä¸‹ç´¢å¼•é•¿åº¦è¶ŠçŸ­è¶Šå¥½ã€‚key_len æ˜¾ç¤ºçš„å€¼ä¸ºç´¢å¼•å­—æ®µçš„æœ€å¯èƒ½é•¿åº¦ï¼Œå¹¶éå®é™…ä½¿ç”¨é•¿åº¦ï¼Œå³key_lenæ˜¯æ ¹æ®è¡¨å®šä¹‰è®¡ç®—è€Œå¾—ï¼Œå¹¶ä¸æ˜¯é€šè¿‡è¡¨å†…æ£€ç´¢å‡ºçš„ã€‚&lt;/p>
&lt;/blockquote>
&lt;h2 id="ref">&lt;a href="#ref" class="header-anchor">&lt;/a>ref
&lt;/h2>&lt;blockquote>
&lt;p>æ˜¾ç¤ºç´¢å¼•çš„å“ªä¸€åˆ—æˆ–å¸¸é‡è¢«ç”¨äºæŸ¥æ‰¾ç´¢å¼•åˆ—ä¸Šçš„å€¼ã€‚&lt;/p>
&lt;/blockquote>
&lt;h2 id="rows">&lt;a href="#rows" class="header-anchor">&lt;/a>rows
&lt;/h2>&lt;blockquote>
&lt;p>æ ¹æ®è¡¨ç»Ÿè®¡ä¿¡æ¯åŠç´¢å¼•é€‰ç”¨æƒ…å†µï¼Œå¤§è‡´ä¼°ç®—å‡ºæ‰¾åˆ°æ‰€éœ€çš„è®°å½•æ‰€éœ€è¦è¯»å–çš„è¡Œæ•°ï¼Œå€¼è¶Šå¤§è¶Šä¸å¥½ã€‚&lt;/p>
&lt;/blockquote>
&lt;h2 id="filtered">&lt;a href="#filtered" class="header-anchor">&lt;/a>filtered
&lt;/h2>&lt;blockquote>
&lt;p>ä¸€ä¸ªç™¾åˆ†æ¯”çš„å€¼ï¼Œå’Œrows åˆ—çš„å€¼ä¸€èµ·ä½¿ç”¨ï¼Œå¯ä»¥ä¼°è®¡å‡ºæŸ¥è¯¢æ‰§è¡Œè®¡åˆ’(QEP)ä¸­çš„å‰ä¸€ä¸ªè¡¨çš„ç»“æœé›†ï¼Œä»è€Œç¡®å®šjoinæ“ä½œçš„å¾ªç¯æ¬¡æ•°ã€‚å°è¡¨é©±åŠ¨å¤§è¡¨ï¼Œå‡è½»è¿æ¥çš„æ¬¡æ•°ã€‚&lt;/p>
&lt;/blockquote>
&lt;h2 id="extra">&lt;a href="#extra" class="header-anchor">&lt;/a>extra
&lt;/h2>&lt;blockquote>
&lt;p>Using filesortï¼š è¯´æ˜MySQLä¼šå¯¹æ•°æ®ä½¿ç”¨ä¸€ä¸ªå¤–éƒ¨çš„ç´¢å¼•æ’åºï¼Œè€Œä¸æ˜¯æŒ‰ç…§è¡¨å†…çš„ç´¢å¼•é¡ºåºè¿›è¡Œè¯»å–ã€‚MySQLä¸­æ— æ³•åˆ©ç”¨ç´¢å¼•å®Œæˆçš„æ’åºæ“ä½œç§°ä¸ºâ€œæ–‡ä»¶æ’åºâ€ ã€‚å‡ºç°è¿™ä¸ªå°±è¦ç«‹åˆ»ä¼˜åŒ–sqlã€‚
**Using temporaryï¼š**ä½¿ç”¨äº†ä¸´æ—¶è¡¨ä¿å­˜ä¸­é—´ç»“æœï¼ŒMySQLåœ¨å¯¹æŸ¥è¯¢ç»“æœæ’åºæ—¶ä½¿ç”¨ä¸´æ—¶è¡¨ã€‚å¸¸è§äºæ’åº order by å’Œ åˆ†ç»„æŸ¥è¯¢ group byã€‚ å‡ºç°è¿™ä¸ªæ›´è¦ç«‹åˆ»ä¼˜åŒ–sqlã€‚
&lt;strong>Using indexï¼š&lt;/strong> è¡¨ç¤ºç›¸åº”çš„select æ“ä½œä¸­ä½¿ç”¨äº†è¦†ç›–ç´¢å¼•ï¼ˆCovering indexï¼‰ï¼Œé¿å…è®¿é—®äº†è¡¨çš„æ•°æ®è¡Œï¼Œæ•ˆæœä¸é”™ï¼å¦‚æœåŒæ—¶å‡ºç°Using whereï¼Œè¡¨æ˜ç´¢å¼•è¢«ç”¨æ¥æ‰§è¡Œç´¢å¼•é”®å€¼çš„æŸ¥æ‰¾ã€‚å¦‚æœæ²¡æœ‰åŒæ—¶å‡ºç°Using whereï¼Œè¡¨ç¤ºç´¢å¼•ç”¨æ¥è¯»å–æ•°æ®è€Œéæ‰§è¡ŒæŸ¥æ‰¾åŠ¨ä½œã€‚
**Covering Indexï¼š**è¦†ç›–ç´¢å¼•ä¹Ÿå«ç´¢å¼•è¦†ç›–ï¼Œå°±æ˜¯select çš„æ•°æ®åˆ—åªç”¨ä»ç´¢å¼•ä¸­å°±èƒ½å¤Ÿå–å¾—ï¼Œä¸å¿…è¯»å–æ•°æ®è¡Œï¼ŒMySQLå¯ä»¥åˆ©ç”¨ç´¢å¼•è¿”å›select åˆ—è¡¨ä¸­çš„å­—æ®µï¼Œè€Œä¸å¿…æ ¹æ®ç´¢å¼•å†æ¬¡è¯»å–æ•°æ®æ–‡ä»¶ã€‚
&lt;strong>Using index conditionï¼š&lt;/strong> åœ¨5.6ç‰ˆæœ¬ååŠ å…¥çš„æ–°ç‰¹æ€§ï¼Œä¼˜åŒ–å™¨ä¼šåœ¨ç´¢å¼•å­˜åœ¨çš„æƒ…å†µä¸‹ï¼Œé€šè¿‡ç¬¦åˆRANGEèŒƒå›´çš„æ¡æ•° å’Œ æ€»æ•°çš„æ¯”ä¾‹æ¥é€‰æ‹©æ˜¯ä½¿ç”¨ç´¢å¼•è¿˜æ˜¯è¿›è¡Œå…¨è¡¨éå†ã€‚
&lt;strong>Using whereï¼š&lt;/strong> è¡¨æ˜ä½¿ç”¨äº†where è¿‡æ»¤
&lt;strong>Using join bufferï¼š&lt;/strong> è¡¨æ˜ä½¿ç”¨äº†è¿æ¥ç¼“å­˜
&lt;strong>impossible whereï¼š&lt;/strong> where è¯­å¥çš„å€¼æ€»æ˜¯falseï¼Œä¸å¯ç”¨ï¼Œä¸èƒ½ç”¨æ¥è·å–ä»»ä½•å…ƒç´ 
&lt;strong>distinctï¼š&lt;/strong> ä¼˜åŒ–distinctæ“ä½œï¼Œåœ¨æ‰¾åˆ°ç¬¬ä¸€åŒ¹é…çš„å…ƒç»„åå³åœæ­¢æ‰¾åŒæ ·å€¼çš„åŠ¨ä½œã€‚&lt;/p>
&lt;/blockquote>
&lt;h3 id="åœ¨æŸ¥è¯¢ä¸­ä½¿ç”¨ç´¢å¼•">&lt;a href="#%e5%9c%a8%e6%9f%a5%e8%af%a2%e4%b8%ad%e4%bd%bf%e7%94%a8%e7%b4%a2%e5%bc%95" class="header-anchor">&lt;/a>åœ¨æŸ¥è¯¢ä¸­ä½¿ç”¨ç´¢å¼•
&lt;/h3>&lt;p>å…ˆåˆ›å»ºä¸¤ä¸ªè¡¨&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-sql" data-lang="sql">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">CREATE&lt;/span> &lt;span style="color:#ff79c6">TABLE&lt;/span> &lt;span style="color:#ff79c6">user&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span>(
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3&lt;/span>&lt;span> id &lt;span style="color:#8be9fd;font-style:italic">int&lt;/span>(&lt;span style="color:#bd93f9">11&lt;/span>) UNSIGNED AUTO_INCREMENT
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4&lt;/span>&lt;span> &lt;span style="color:#ff79c6">PRIMARY&lt;/span> &lt;span style="color:#ff79c6">KEY&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5&lt;/span>&lt;span> name &lt;span style="color:#8be9fd;font-style:italic">char&lt;/span>(&lt;span style="color:#bd93f9">10&lt;/span>) &lt;span style="color:#ff79c6">NOT&lt;/span> &lt;span style="color:#ff79c6">NULL&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6&lt;/span>&lt;span> age &lt;span style="color:#8be9fd;font-style:italic">int&lt;/span> &lt;span style="color:#ff79c6">NOT&lt;/span> &lt;span style="color:#ff79c6">NULL&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7&lt;/span>&lt;span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8&lt;/span>&lt;span> ENGINE &lt;span style="color:#ff79c6">=&lt;/span> InnoDB;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-sql" data-lang="sql">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">CREATE&lt;/span> &lt;span style="color:#ff79c6">TABLE&lt;/span> phone
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span>(
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3&lt;/span>&lt;span> id &lt;span style="color:#8be9fd;font-style:italic">int&lt;/span>(&lt;span style="color:#bd93f9">11&lt;/span>) UNSIGNED AUTO_INCREMENT
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4&lt;/span>&lt;span> &lt;span style="color:#ff79c6">PRIMARY&lt;/span> &lt;span style="color:#ff79c6">KEY&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5&lt;/span>&lt;span> uid &lt;span style="color:#8be9fd;font-style:italic">int&lt;/span>(&lt;span style="color:#bd93f9">11&lt;/span>) UNSIGNED &lt;span style="color:#ff79c6">NOT&lt;/span> &lt;span style="color:#ff79c6">NULL&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6&lt;/span>&lt;span> phone &lt;span style="color:#8be9fd;font-style:italic">char&lt;/span>(&lt;span style="color:#bd93f9">10&lt;/span>) &lt;span style="color:#ff79c6">NOT&lt;/span> &lt;span style="color:#ff79c6">NULL&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7&lt;/span>&lt;span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8&lt;/span>&lt;span> ENGINE &lt;span style="color:#ff79c6">=&lt;/span> InnoDB;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>mysqlçš„ä¸»é”®å¸¦æœ‰ä¸€ä¸ªä¸»é”®ç´¢å¼•,åœ¨åˆ›å»ºè¡¨çš„æ—¶å€™å·²ç»å»ºç«‹
åœ¨ç®€å•åœ°æŸ¥è¯¢ä¸­ä½¿ç”¨ç´¢å¼•&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-sql" data-lang="sql">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">EXPLAIN&lt;/span> &lt;span style="color:#ff79c6">SELECT&lt;/span> name &lt;span style="color:#ff79c6">FROM&lt;/span> &lt;span style="color:#ff79c6">user&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-a5bef2ac26b7d4de.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-a5bef2ac26b7d4de.webp" alt="" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;hr>
&lt;p>è¿™æ—¶å€™å¹¶æ²¡æœ‰ä½¿ç”¨ç´¢å¼•,å› ä¸ºæˆ‘ä»¬æ²¡æœ‰åŠ é™åˆ¶æ¡ä»¶&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-sql" data-lang="sql">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">EXPLAIN&lt;/span> &lt;span style="color:#ff79c6">SELECT&lt;/span> name &lt;span style="color:#ff79c6">FROM&lt;/span> &lt;span style="color:#ff79c6">user&lt;/span> &lt;span style="color:#ff79c6">WHERE&lt;/span> id&lt;span style="color:#ff79c6">=&lt;/span>&lt;span style="color:#bd93f9">1&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="è¿™æ—¶å€™ç´¢å¼•å·²ç»èµ·ä½œç”¨äº†æ˜¯constç±»å‹">&lt;a href="#%e8%bf%99%e6%97%b6%e5%80%99%e7%b4%a2%e5%bc%95%e5%b7%b2%e7%bb%8f%e8%b5%b7%e4%bd%9c%e7%94%a8%e4%ba%86%e6%98%afconst%e7%b1%bb%e5%9e%8b" class="header-anchor">&lt;/a>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-06b62ce70025a61e.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-06b62ce70025a61e.webp" alt="" />
&lt;/a>
&lt;/div>
è¿™æ—¶å€™ç´¢å¼•å·²ç»èµ·ä½œç”¨äº†,æ˜¯constç±»å‹
&lt;/h2>&lt;p>å†æ¥çœ‹å¦ä¸€ç§æƒ…å†µ&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-sql" data-lang="sql">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">EXPLAIN&lt;/span> &lt;span style="color:#ff79c6">SELECT&lt;/span> id &lt;span style="color:#ff79c6">FROM&lt;/span> &lt;span style="color:#ff79c6">user&lt;/span> &lt;span style="color:#ff79c6">WHERE&lt;/span> id&lt;span style="color:#ff79c6">+&lt;/span>&lt;span style="color:#bd93f9">1&lt;/span> &lt;span style="color:#ff79c6">=&lt;/span>&lt;span style="color:#bd93f9">2&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/h3622259-f03fd5add3482ca7.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/h3622259-f03fd5add3482ca7.webp" alt="" />
&lt;/a>
&lt;/div>
è¿™æ—¶å€™è™½ç„¶ä½¿ç”¨äº†ç´¢å¼•,ä½†æ˜¯ç´¢å¼•ç±»å‹æ˜¯&lt;strong>index&lt;/strong>ç±»å‹,æ•ˆæœå¤§æ‰“æŠ˜æ‰£&lt;/p>
&lt;hr>
&lt;p>ç»™userè¡¨ä¸­çš„nameå­—æ®µåŠ ä¸Šç´¢å¼•&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-sql" data-lang="sql">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">ALTER&lt;/span> &lt;span style="color:#ff79c6">TABLE&lt;/span> &lt;span style="color:#ff79c6">`&lt;/span>&lt;span style="color:#ff79c6">user&lt;/span>&lt;span style="color:#ff79c6">`&lt;/span> &lt;span style="color:#ff79c6">ADD&lt;/span> &lt;span style="color:#ff79c6">INDEX&lt;/span> &lt;span style="color:#ff79c6">`&lt;/span>_name&lt;span style="color:#ff79c6">`&lt;/span>(&lt;span style="color:#ff79c6">`&lt;/span>name&lt;span style="color:#ff79c6">`&lt;/span>) &lt;span style="color:#ff79c6">USING&lt;/span> BTREE;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä½¿ç”¨LIKEæ¨¡ç³ŠæŸ¥è¯¢&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-sql" data-lang="sql">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">EXPLAIN&lt;/span> &lt;span style="color:#ff79c6">SELECT&lt;/span> name &lt;span style="color:#ff79c6">FROM&lt;/span> &lt;span style="color:#ff79c6">user&lt;/span> &lt;span style="color:#ff79c6">WHERE&lt;/span> name &lt;span style="color:#ff79c6">LIKE&lt;/span> &lt;span style="color:#f1fa8c">&amp;#39;ç‹%&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-a661ea65c51ce443.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-a661ea65c51ce443.webp" alt="" />
&lt;/a>
&lt;/div>
å¯ä»¥çœ‹åˆ°,ä½¿ç”¨äº†ç´¢å¼•,ç±»å‹ä¸º&lt;strong>range&lt;/strong>
æ¢ä¸ªåŒ¹é…æ–¹å¼è¯•è¯•&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-sql" data-lang="sql">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">EXPLAIN&lt;/span> &lt;span style="color:#ff79c6">SELECT&lt;/span> name &lt;span style="color:#ff79c6">FROM&lt;/span> &lt;span style="color:#ff79c6">user&lt;/span> &lt;span style="color:#ff79c6">WHERE&lt;/span> name &lt;span style="color:#ff79c6">LIKE&lt;/span> &lt;span style="color:#f1fa8c">&amp;#39;%ç‹&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-efde0793cef75d20.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-efde0793cef75d20.webp" alt="" />
&lt;/a>
&lt;/div>
è¿™æ—¶å€™,è™½ç„¶ä½¿ç”¨äº†ç´¢å¼•,ä½†æ˜¯ç´¢å¼•ç±»å‹æ˜¯&lt;strong>index&lt;/strong>,å…¨å±€ç´¢å¼•æ‰«æ,æ•ˆç‡æ˜¯å¾ˆä½çš„.&lt;/p>
&lt;hr>
&lt;p>å†æ¥è¯•ä¸€ä¸‹&lt;code>OR&lt;/code>è¿æ¥æŸ¥è¯¢&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-sql" data-lang="sql">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">EXPLAIN&lt;/span> &lt;span style="color:#ff79c6">SELECT&lt;/span> id,uid &lt;span style="color:#ff79c6">FROM&lt;/span> phone &lt;span style="color:#ff79c6">WHERE&lt;/span> id&lt;span style="color:#ff79c6">=&lt;/span>&lt;span style="color:#bd93f9">1&lt;/span> &lt;span style="color:#ff79c6">or&lt;/span> id &lt;span style="color:#ff79c6">=&lt;/span>&lt;span style="color:#bd93f9">2&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="ä½¿ç”¨äº†ç´¢å¼•æ˜¯rangeç±»å‹">&lt;a href="#%e4%bd%bf%e7%94%a8%e4%ba%86%e7%b4%a2%e5%bc%95%e6%98%afrange%e7%b1%bb%e5%9e%8b" class="header-anchor">&lt;/a>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-e9fc7f184a08e019.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-e9fc7f184a08e019.webp" alt="" />
&lt;/a>
&lt;/div>
ä½¿ç”¨äº†ç´¢å¼•,æ˜¯&lt;strong>range&lt;/strong>ç±»å‹
&lt;/h2>&lt;p>å†æ¥è¯•ä¸€ä¸‹ &lt;code>IN&lt;/code>çº¦æŸæŸ¥è¯¢,è¿™ä¸¤æ¬¡æŸ¥è¯¢ç»“æœæ˜¯ç›¸åŒçš„&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-sql" data-lang="sql">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">EXPLAIN&lt;/span> &lt;span style="color:#ff79c6">SELECT&lt;/span> id,uid &lt;span style="color:#ff79c6">FROM&lt;/span> phone &lt;span style="color:#ff79c6">WHERE&lt;/span> id &lt;span style="color:#ff79c6">IN&lt;/span> (&lt;span style="color:#bd93f9">1&lt;/span>,&lt;span style="color:#bd93f9">2&lt;/span>)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-965281ff28d4c682.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-965281ff28d4c682.webp" alt="" />
&lt;/a>
&lt;/div>
åŒæ ·,ä½¿ç”¨äº†ç´¢å¼•,æ˜¯&lt;strong>range&lt;/strong>ç±»å‹&lt;/p>
&lt;hr>
&lt;p>å†æ¥è¯•ä¸€ä¸‹&lt;code> OR&lt;/code>æŸ¥è¯¢çš„å¦ä¸€ç§æƒ…å†µ&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-sql" data-lang="sql">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">EXPLAIN&lt;/span> &lt;span style="color:#ff79c6">SELECT&lt;/span> id,uid &lt;span style="color:#ff79c6">FROM&lt;/span> phone &lt;span style="color:#ff79c6">WHERE&lt;/span> id &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#bd93f9">1&lt;/span> &lt;span style="color:#ff79c6">OR&lt;/span> uid&lt;span style="color:#ff79c6">=&lt;/span>&lt;span style="color:#bd93f9">2&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="è¿™æ—¶å€™ä¼šå‘ç°ç«Ÿç„¶æ²¡æœ‰ä½¿ç”¨ç´¢å¼•typeæ˜¯allå› ä¸ºè¿™æ¬¡orçš„è¿ä¸ªå­—æ®µåªæœ‰idæœ‰ç´¢å¼•uidæ²¡æœ‰ç´¢å¼•æ‰€ä»¥åœ¨æŸ¥è¯¢çš„æ—¶å€™å°±ä¼šæ”¾å¼ƒä½¿ç”¨ç´¢å¼•ä½¿ç”¨å…¨å±€æ‰«æ">&lt;a href="#%e8%bf%99%e6%97%b6%e5%80%99%e4%bc%9a%e5%8f%91%e7%8e%b0%e7%ab%9f%e7%84%b6%e6%b2%a1%e6%9c%89%e4%bd%bf%e7%94%a8%e7%b4%a2%e5%bc%95type%e6%98%afall%e5%9b%a0%e4%b8%ba%e8%bf%99%e6%ac%a1or%e7%9a%84%e8%bf%9e%e4%b8%aa%e5%ad%97%e6%ae%b5%e5%8f%aa%e6%9c%89id%e6%9c%89%e7%b4%a2%e5%bc%95uid%e6%b2%a1%e6%9c%89%e7%b4%a2%e5%bc%95%e6%89%80%e4%bb%a5%e5%9c%a8%e6%9f%a5%e8%af%a2%e7%9a%84%e6%97%b6%e5%80%99%e5%b0%b1%e4%bc%9a%e6%94%be%e5%bc%83%e4%bd%bf%e7%94%a8%e7%b4%a2%e5%bc%95%e4%bd%bf%e7%94%a8%e5%85%a8%e5%b1%80%e6%89%ab%e6%8f%8f" class="header-anchor">&lt;/a>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-5c792ec825ccf6c0.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-5c792ec825ccf6c0.webp" alt="" />
&lt;/a>
&lt;/div>
è¿™æ—¶å€™ä¼šå‘ç°,ç«Ÿç„¶æ²¡æœ‰ä½¿ç”¨ç´¢å¼•,typeæ˜¯&lt;strong>ALL&lt;/strong>,å› ä¸ºè¿™æ¬¡ORçš„è¿ä¸ªå­—æ®µåªæœ‰idæœ‰ç´¢å¼•,uidæ²¡æœ‰ç´¢å¼•,æ‰€ä»¥åœ¨æŸ¥è¯¢çš„æ—¶å€™å°±ä¼šæ”¾å¼ƒä½¿ç”¨ç´¢å¼•,ä½¿ç”¨å…¨å±€æ‰«æ.
&lt;/h2>&lt;p>è¿™ç§æƒ…å†µæ˜¯å¯ä»¥ä½¿ç”¨union è¿æ¥æŸ¥è¯¢ä¼˜åŒ–çš„&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-sql" data-lang="sql">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">EXPLAIN&lt;/span> &lt;span style="color:#ff79c6">SELECT&lt;/span> id
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span> &lt;span style="color:#ff79c6">FROM&lt;/span> phone
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3&lt;/span>&lt;span> &lt;span style="color:#ff79c6">WHERE&lt;/span> id &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#bd93f9">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4&lt;/span>&lt;span> &lt;span style="color:#ff79c6">UNION&lt;/span> &lt;span style="color:#ff79c6">ALL&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5&lt;/span>&lt;span> &lt;span style="color:#ff79c6">SELECT&lt;/span> uid
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6&lt;/span>&lt;span> &lt;span style="color:#ff79c6">FROM&lt;/span> phone
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7&lt;/span>&lt;span> &lt;span style="color:#ff79c6">WHERE&lt;/span> uid &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#bd93f9">2&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="æˆ‘ä»¬å¯ä»¥çœ‹åˆ°åœ¨æŸ¥è¯¢idæ—¶ä½¿ç”¨é‡Œç´¢å¼•æŸ¥è¯¢uidæ—¶å› ä¸ºuidæ²¡æœ‰ç´¢å¼•æ‰€ä»¥æ²¡æœ‰ä½¿ç”¨ç´¢å¼•">&lt;a href="#%e6%88%91%e4%bb%ac%e5%8f%af%e4%bb%a5%e7%9c%8b%e5%88%b0%e5%9c%a8%e6%9f%a5%e8%af%a2id%e6%97%b6%e4%bd%bf%e7%94%a8%e9%87%8c%e7%b4%a2%e5%bc%95%e6%9f%a5%e8%af%a2uid%e6%97%b6%e5%9b%a0%e4%b8%bauid%e6%b2%a1%e6%9c%89%e7%b4%a2%e5%bc%95%e6%89%80%e4%bb%a5%e6%b2%a1%e6%9c%89%e4%bd%bf%e7%94%a8%e7%b4%a2%e5%bc%95" class="header-anchor">&lt;/a>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-85b3be2f85dea62f.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-85b3be2f85dea62f.webp" alt="" />
&lt;/a>
&lt;/div>
æˆ‘ä»¬å¯ä»¥çœ‹åˆ°,åœ¨æŸ¥è¯¢idæ—¶ä½¿ç”¨é‡Œç´¢å¼•,æŸ¥è¯¢uidæ—¶,å› ä¸ºuidæ²¡æœ‰ç´¢å¼•,æ‰€ä»¥æ²¡æœ‰ä½¿ç”¨ç´¢å¼•.
&lt;/h2>&lt;p>å†æ¥çœ‹ä¸€ä¸‹å¾ˆå¸¸ç”¨çš„è¿æ¥æŸ¥è¯¢,&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-sql" data-lang="sql">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">EXPLAIN&lt;/span> &lt;span style="color:#ff79c6">SELECT&lt;/span> &lt;span style="color:#ff79c6">user&lt;/span>.id, name, uid, phone
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span> &lt;span style="color:#ff79c6">FROM&lt;/span> &lt;span style="color:#ff79c6">user&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3&lt;/span>&lt;span> &lt;span style="color:#ff79c6">JOIN&lt;/span> phone &lt;span style="color:#ff79c6">ON&lt;/span> &lt;span style="color:#ff79c6">user&lt;/span>.id &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#bd93f9">1&lt;/span> &lt;span style="color:#ff79c6">AND&lt;/span> uid &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#bd93f9">2&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-45086730559bde4f.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-45086730559bde4f.webp" alt="" />
&lt;/a>
&lt;/div>
(åœ¨ä½¿ç”¨è¿æ¥æŸ¥è¯¢çš„æ—¶å€™å°½é‡ä½¿ç”¨&lt;strong>join&lt;/strong>,ä¸è¦ä½¿ç”¨&lt;strong>left join&lt;/strong> å’Œ &lt;strong>right join&lt;/strong>,åœ¨ä½¿ç”¨joinæŸ¥è¯¢çš„æ—¶å€™,mysqlè§£æå™¨ä¼šè‡ªåŠ¨é€‰æ‹©ç”¨å°è¡¨é©±åŠ¨å¤§è¡¨,è¿™æ ·å¯ä»¥æé«˜æŸ¥è¯¢æ•ˆç‡,å¦‚æœä½¿ç”¨left joinæˆ–è€…right joinä¼šæŒ‡å®šé©±åŠ¨è¡¨,æœ‰æ—¶å€™ä¼šé™ä½æŸ¥è¯¢æ•ˆç‡)
è¿™æ—¶å€™åªæœ‰åœ¨æŸ¥è¯¢userè¡¨æ—¶ä½¿ç”¨äº†ç´¢å¼•,åœ¨æŸ¥è¯¢phoneè¡¨æ—¶æ²¡æœ‰ä½¿ç”¨ç´¢å¼•.å› ä¸ºåœ¨&lt;code>ON&lt;/code>çš„çº¦æŸæ¡ä»¶ä¸­,idæ˜¯æœ‰ç´¢å¼•çš„,è€Œuidæ²¡æœ‰ç´¢å¼•,æ‰€ä»¥åœ¨æŸ¥è¯¢çš„æ—¶å€™ä¸ä¼šä½¿ç”¨ç´¢å¼•.
è¿™æ—¶å€™ç»™uidå­—æ®µåŠ ä¸Šç´¢å¼•,çœ‹çœ‹æ•ˆæœ.
æ·»åŠ ç´¢å¼•&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-sql" data-lang="sql">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">ALTER&lt;/span> &lt;span style="color:#ff79c6">TABLE&lt;/span> &lt;span style="color:#ff79c6">`&lt;/span>phone&lt;span style="color:#ff79c6">`&lt;/span> &lt;span style="color:#ff79c6">ADD&lt;/span> &lt;span style="color:#ff79c6">INDEX&lt;/span> &lt;span style="color:#ff79c6">`&lt;/span>_uid&lt;span style="color:#ff79c6">`&lt;/span>(&lt;span style="color:#ff79c6">`&lt;/span>uid&lt;span style="color:#ff79c6">`&lt;/span>) &lt;span style="color:#ff79c6">USING&lt;/span> BTREE;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è·Ÿåˆšæ‰ä¸€æ ·,ä½¿ç”¨è¿æ¥æŸ¥è¯¢&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-sql" data-lang="sql">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">EXPLAIN&lt;/span> &lt;span style="color:#ff79c6">SELECT&lt;/span> &lt;span style="color:#ff79c6">user&lt;/span>.id, name, uid, phone
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span> &lt;span style="color:#ff79c6">FROM&lt;/span> &lt;span style="color:#ff79c6">user&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3&lt;/span>&lt;span> &lt;span style="color:#ff79c6">JOIN&lt;/span> phone &lt;span style="color:#ff79c6">ON&lt;/span> &lt;span style="color:#ff79c6">user&lt;/span>.id &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#bd93f9">1&lt;/span> &lt;span style="color:#ff79c6">AND&lt;/span> uid &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#bd93f9">2&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-e2dfc28562c9c731.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-e2dfc28562c9c731.webp" alt="" />
&lt;/a>
&lt;/div>
è¿™æ—¶å€™å¯ä»¥çœ‹åˆ°,æŸ¥è¯¢userè¡¨å’Œphoneè¡¨æ—¶,éƒ½ä½¿ç”¨äº†ç´¢å¼•ã€‚&lt;/p>
&lt;h2 id="æ€»ç»“">&lt;a href="#%e6%80%bb%e7%bb%93" class="header-anchor">&lt;/a>æ€»ç»“
&lt;/h2>&lt;ul>
&lt;li>åœ¨æœ‰é™åˆ¶æ¡ä»¶(&lt;code>WHERE,ON&lt;/code>)çš„çš„æŸ¥è¯¢ä¸­,å¯¹çº¦æŸå­—æ®µå°½é‡éƒ½åŠ ä¸Šç´¢å¼•.åœ¨æ•°æ®é‡å¾ˆå¤§çš„æ—¶å€™,æå‡æŸ¥è¯¢æ•ˆç‡ç‰¹åˆ«æ˜æ˜¾&lt;/li>
&lt;li>ä¸è¦åœ¨çº¦æŸæ¡ä»¶ä¸Šè¿›è¡Œè¿ç®—,åœ¨æŸ¥è¯¢ä¸­å¯¹ç´¢å¼•å­—æ®µè¿›è¡Œè¿ç®—,ä¼šä½¿ç”¨indexç´¢å¼•,æ•ˆæœå¤§æ‰“æŠ˜æ‰£&lt;/li>
&lt;li>åœ¨ä½¿ç”¨&lt;code>LIKE&lt;/code> æ¨¡ç³ŠåŒ¹é…æ—¶,å°½é‡ç”¨&lt;code> 'XXX%'&lt;/code>,ä¸è¦ä½¿ç”¨&lt;code>'%XXX'&lt;/code>&lt;/li>
&lt;li>åœ¨ç»å¸¸åˆ é™¤ã€æ›´æ–°æ•°æ®çš„å­—æ®µå’Œæ•°æ®é‡ä¸å¤§çš„æ—¶å€™(ç½‘ä¸Šè¯´å°äºç™¾ä¸‡,å› ä¸ºæˆ‘æ²¡æœ‰è¯•éªŒè¿‡,ä¸èƒ½ç¡®å®š),æ²¡æœ‰å¿…è¦ä½¿ç”¨ç´¢å¼•,å› ä¸ºç´¢å¼•ä¼šå æ®ç£ç›˜ç©ºé—´,è€Œä¸”ä¹Ÿä¼šé™ä½æ’å…¥å’Œæ›´æ–°æ•°æ®çš„æ•ˆç‡ã€‚&lt;/li>
&lt;li>åœ¨æŸ¥è¯¢ä¸­ä¸ä¼šä½¿ç”¨çº¦æŸæ¡ä»¶çš„å­—æ®µä¹Ÿä¸ç”¨åŠ ç´¢å¼•,æ¯”å¦‚åœ¨ä¾‹å­ä¸­,ä»æ¥æ²¡æœ‰å¯¹phoneè¡¨ä¸­çš„phoneå­—æ®µä½¿ç”¨è¿‡&lt;code> WHERE&lt;/code>å’Œ&lt;code>ON&lt;/code>æ¡ä»¶,æ‰€ä»¥æ²¡æœ‰å¿…è¦ç»™phoneå­—æ®µåŠ ç´¢å¼•ã€‚&lt;/li>
&lt;li>æŸ¥è¯¢ä¸­,ä½¿ç”¨&lt;code>OR&lt;/code>çº¦æŸæ¡ä»¶æ—¶,ORä¸¤è¾¹çš„å­—æ®µéƒ½å¿…é¡»æœ‰ç´¢å¼•,å¦‚æœåªæœ‰ä¸€è¾¹çš„å­—æ®µæœ‰ç´¢å¼•,å¯ä»¥ä½¿ç”¨&lt;code>union&lt;/code>è¿æ¥æŸ¥è¯¢æé«˜æ•ˆç‡ã€‚&lt;/li>
&lt;li>åœ¨è¿æ¥æŸ¥è¯¢ä¸­ï¼Œå¯¹ä¸¤ä¸ªè¡¨çš„å…³è”å­—æ®µåŠ ä¸Šç´¢å¼•ï¼Œå¯ä»¥æœ‰æ•ˆåœ°æé«˜æŸ¥è¯¢æ•ˆç‡ã€‚&lt;/li>
&lt;li>NULLä¼šå¯¼è‡´ç´¢å¼•å½¢åŒè™šè®¾ï¼Œæ‰€ä»¥åœ¨è®¾è®¡è¡¨ç»“æ„æ—¶åº”é¿å…NULL çš„å­˜åœ¨ï¼ˆç”¨å…¶ä»–æ–¹å¼è¡¨è¾¾ä½ æƒ³è¡¨è¾¾çš„NULLï¼Œæ¯”å¦‚ -1ï¼Ÿï¼‰&lt;/li>
&lt;/ul>
&lt;h2 id="æœ€åæ„Ÿè°¢åœ¨ç½‘ä¸Šæ— ç§åˆ†äº«çš„å‰è¾ˆä»¬">&lt;a href="#%e6%9c%80%e5%90%8e%e6%84%9f%e8%b0%a2%e5%9c%a8%e7%bd%91%e4%b8%8a%e6%97%a0%e7%a7%81%e5%88%86%e4%ba%ab%e7%9a%84%e5%89%8d%e8%be%88%e4%bb%ac" class="header-anchor">&lt;/a>æœ€åæ„Ÿè°¢åœ¨ç½‘ä¸Šæ— ç§åˆ†äº«çš„å‰è¾ˆä»¬
&lt;/h2>&lt;p>æˆ‘ä¹Ÿæ˜¯åˆšåˆšåœ¨å­¦ä¹ mysqlä¼˜åŒ–æ–¹é¢çš„çŸ¥è¯†,ä¸€è¾¹å­¦ä¹ ,ä¸€è¾¹æ€»ç»“,æ–‡ä¸­å¦‚æœæœ‰é”™è¯¯çš„åœ°æ–¹,è¿˜è¯·å„ä½å¤§ç¥æ‰¹è¯„æŒ‡æ­£&lt;/p></description></item><item><title>mysqlç´¢å¼•çš„ä½¿ç”¨å’Œä¼˜åŒ–</title><link>https://lqxhub.github.io/posts/82773ef8/</link><pubDate>Thu, 25 Oct 2018 09:46:12 +0000</pubDate><guid>https://lqxhub.github.io/posts/82773ef8/</guid><description>&lt;p>ç´¢å¼•æ˜¯ä¸€ç§ç‰¹æ®Šçš„æ–‡ä»¶(InnoDB æ•°æ®è¡¨ä¸Šçš„ç´¢å¼•æ˜¯è¡¨ç©ºé—´çš„ä¸€ä¸ªç»„æˆéƒ¨åˆ†)ï¼Œå®ƒä»¬åŒ…å«ç€å¯¹æ•°æ®è¡¨é‡Œçš„æ‰€æœ‰è®°å½•çš„å¼•ç”¨æŒ‡é’ˆã€‚æ›´é€šä¿—çš„è¯´ï¼Œæ•°æ®åº“ç´¢å¼•å°±å¥½æ¯”ä¸€æœ¬ä¹¦çš„ç›®å½•ï¼Œèƒ½å¤ŸåŠ å¿«æ•°æ®åº“çš„æŸ¥è¯¢é€Ÿåº¦ã€‚
&lt;strong>é¦–å…ˆæ„Ÿè°¢ç½‘ä¸Šçš„é‚£äº›å‰è¾ˆå’Œå¤§ç¥ä»¬çš„æ— ç§åˆ†äº«&lt;/strong>
æœ€è¿‘åœ¨å­¦ä¹ mysqlçš„ä¼˜åŒ–é—®é¢˜,åœ¨æŸ¥è¯¢ä¸­æ­£ç¡®ä½¿ç”¨ç´¢å¼•,å¯¹æŸ¥è¯¢æ•ˆç‡çš„æå‡æœ‰éå¸¸å¤§çš„å¸®åŠ©,ä½¿ç”¨ä¸å½“ä¼šä½¿ç´¢å¼•å¤±æ•ˆ,èµ·ä¸åˆ°ç´¢å¼•è¯¥æœ‰çš„ä½œç”¨ã€‚æŠŠè¿™ä¸¤å¤©å­¦åˆ°çš„çŸ¥è¯†è®°å½•ä¸€ä¸‹ã€‚&lt;/p>
&lt;h2 id="ä½¿ç”¨ç´¢å¼•çš„ä¼˜åŠ¿">&lt;a href="#%e4%bd%bf%e7%94%a8%e7%b4%a2%e5%bc%95%e7%9a%84%e4%bc%98%e5%8a%bf" class="header-anchor">&lt;/a>ä½¿ç”¨ç´¢å¼•çš„ä¼˜åŠ¿
&lt;/h2>&lt;blockquote>
&lt;ol>
&lt;li>æé«˜æ•°æ®çš„æ£€ç´¢é€Ÿåº¦ï¼Œé™ä½æ•°æ®åº“IOæˆæœ¬ï¼šä½¿ç”¨ç´¢å¼•çš„æ„ä¹‰å°±æ˜¯é€šè¿‡ç¼©å°è¡¨ä¸­éœ€è¦æŸ¥è¯¢çš„è®°å½•çš„æ•°ç›®ä»è€ŒåŠ å¿«æœç´¢çš„é€Ÿåº¦ã€‚&lt;/li>
&lt;li>é™ä½æ•°æ®æ’åºçš„æˆæœ¬ï¼Œé™ä½CPUæ¶ˆè€—ï¼šç´¢å¼•ä¹‹æ‰€ä»¥æŸ¥çš„å¿«ï¼Œæ˜¯å› ä¸ºå…ˆå°†æ•°æ®æ’å¥½åºï¼Œè‹¥è¯¥å­—æ®µæ­£å¥½éœ€è¦æ’åºï¼Œåˆ™çœŸå¥½é™ä½äº†æ’åºçš„æˆæœ¬ã€‚&lt;/li>
&lt;/ol>
&lt;/blockquote>
&lt;h2 id="ä½¿ç”¨ç´¢å¼•å¸¦æ¥çš„é—®é¢˜">&lt;a href="#%e4%bd%bf%e7%94%a8%e7%b4%a2%e5%bc%95%e5%b8%a6%e6%9d%a5%e7%9a%84%e9%97%ae%e9%a2%98" class="header-anchor">&lt;/a>ä½¿ç”¨ç´¢å¼•å¸¦æ¥çš„é—®é¢˜
&lt;/h2>&lt;blockquote>
&lt;p>1.å ç”¨å­˜å‚¨ç©ºé—´ï¼šç´¢å¼•å®é™…ä¸Šä¹Ÿæ˜¯ä¸€å¼ è¡¨ï¼Œè®°å½•äº†ä¸»é”®ä¸ç´¢å¼•å­—æ®µï¼Œä¸€èˆ¬ä»¥ç´¢å¼•æ–‡ä»¶çš„å½¢å¼å­˜å‚¨åœ¨ç£ç›˜ä¸Šã€‚
2. é™ä½æ›´æ–°è¡¨çš„é€Ÿåº¦ï¼šè¡¨çš„æ•°æ®å‘ç”Ÿäº†å˜åŒ–ï¼Œå¯¹åº”çš„ç´¢å¼•ä¹Ÿéœ€è¦ä¸€èµ·å˜æ›´ï¼Œä»è€Œå‡ä½çš„æ›´æ–°é€Ÿåº¦ã€‚å¦åˆ™ç´¢å¼•æŒ‡å‘çš„ç‰©ç†æ•°æ®å¯èƒ½ä¸å¯¹ï¼Œè¿™ä¹Ÿæ˜¯ç´¢å¼•å¤±æ•ˆçš„åŸå› ä¹‹ä¸€ã€‚&lt;/p>
&lt;/blockquote>
&lt;h2 id="ç´¢å¼•çš„ç±»å‹">&lt;a href="#%e7%b4%a2%e5%bc%95%e7%9a%84%e7%b1%bb%e5%9e%8b" class="header-anchor">&lt;/a>ç´¢å¼•çš„ç±»å‹
&lt;/h2>&lt;blockquote>
&lt;p>&lt;strong>1.normalï¼š&lt;/strong>
è¡¨ç¤ºæ™®é€šç´¢å¼•,å®ƒæ²¡æœ‰ä»»ä½•é™åˆ¶ï¼ŒMyISAM ä¸­é»˜è®¤çš„ B-tree ç±»å‹çš„ç´¢å¼•
&lt;strong>2.uniqueï¼š&lt;/strong>
è¡¨ç¤ºå”¯ä¸€çš„ï¼Œä¸å…è®¸é‡å¤çš„ç´¢å¼•ï¼Œä½†æ˜¯å…è®¸æœ‰ç©ºå€¼ã€‚å¦‚æœè¯¥å­—æ®µä¿¡æ¯ä¿è¯ä¸ä¼šé‡å¤ä¾‹å¦‚èº«ä»½è¯å·ç”¨ä½œç´¢å¼•æ—¶ï¼Œå¯è®¾ç½®ä¸ºuniqueã€‚
&lt;strong>3.full textl:&lt;/strong>
è¡¨ç¤ºå…¨æ–‡æœç´¢çš„ç´¢å¼•ã€‚ FULLTEXT ç”¨äºæœç´¢å¾ˆé•¿ä¸€ç¯‡æ–‡ç« çš„æ—¶å€™ï¼Œæ•ˆæœæœ€å¥½ã€‚æ³¨æ„ä»… MyISAM å¼•æ“æ”¯æŒ
&lt;strong>4.ç»„åˆç´¢å¼•ï¼ˆæœ€å·¦å‰ç¼€ï¼‰&lt;/strong>
å¹³æ—¶ç”¨çš„SQLæŸ¥è¯¢è¯­å¥ä¸€èˆ¬éƒ½æœ‰æ¯”è¾ƒå¤šçš„é™åˆ¶æ¡ä»¶ï¼Œæ‰€ä»¥ä¸ºäº†è¿›ä¸€æ­¥æ¦¨å–MySQLçš„æ•ˆç‡ï¼Œå°±è¦è€ƒè™‘å»ºç«‹ç»„åˆç´¢å¼•ã€‚ä½¿ç”¨ç»„åˆç´¢å¼•æ—¶æ³¨æ„æœ€å·¦åŒ¹é…åŸåˆ™ã€‚
æ¯”å¦‚æ–°å»ºç´¢å¼•&lt;code>ALTER TABLE testADD INDEX 'id_name_age' ('id','name','age')&lt;/code>ã€‚
åœ¨æŸ¥è¯¢çš„æ—¶&lt;code>SELECT * FROM user WHERE id =1 AND name='bruce'&lt;/code>ç´¢å¼•èµ·ä½œç”¨ã€‚
ä½†æ˜¯æŸ¥è¯¢æ—¶&lt;code>SELECT * FROM user WHERE name='bruce' AND age = 18&lt;/code>è¿™æ—¶å€™ç´¢å¼•ä¸èµ·ä½œç”¨ã€‚
è‡³äºåŸå› ,å› ä¸ºè¾…åŠ©ç´¢å¼•æ˜¯B+æ ‘å®ç°çš„ï¼Œè™½ç„¶å¯ä»¥æŒ‡å®šå¤šä¸ªåˆ—ï¼Œä½†æ˜¯æ¯ä¸ªåˆ—çš„æ¯”è¾ƒä¼˜å…ˆçº§ä¸ä¸€æ ·ï¼Œå†™åœ¨å‰é¢çš„ä¼˜å…ˆæ¯”è¾ƒã€‚ä¸€æ—¦å‡ºç°é—æ¼ï¼Œåœ¨B+æ ‘ä¸Šå°±æ— æ³•ç»§ç»­æœç´¢äº†ï¼ˆé€šè¿‡è¡¥é½ç­‰æªæ–½è§£å†³çš„é™¤å¤–ï¼‰ï¼Œå› æ­¤æ˜¯æŒ‰ç…§æœ€å·¦è¿ç»­åŒ¹é…æ¥çš„ã€‚æ—¢ç„¶æ˜¯åœ¨B+æ ‘ä¸Šæœç´¢ï¼Œå¯¹äºæ¡ä»¶çš„æ¯”è¾ƒè‡ªç„¶æ˜¯è¦æ±‚ç²¾ç¡®åŒ¹é…ï¼ˆå³&amp;quot;=&amp;ldquo;å’Œ&amp;quot;IN&amp;rdquo;ï¼‰ã€‚ä¸è¿‡é¡ºåºå€’æ˜¯å¯ä»¥é¢ å€’ï¼Œå› ä¸ºæŸ¥è¯¢ä¼˜åŒ–å™¨é‡æ’åºä¸€ä¸‹å°±å¥½äº†ã€‚&lt;/p>
&lt;/blockquote>
&lt;h2 id="ç´¢å¼•çš„ä¼˜åŒ–">&lt;a href="#%e7%b4%a2%e5%bc%95%e7%9a%84%e4%bc%98%e5%8c%96" class="header-anchor">&lt;/a>ç´¢å¼•çš„ä¼˜åŒ–
&lt;/h2>&lt;blockquote>
&lt;ul>
&lt;li>åº”å°½é‡é¿å…åœ¨ where å­å¥ä¸­å¯¹å­—æ®µè¿›è¡Œ null å€¼åˆ¤æ–­ï¼Œå¦åˆ™å°†å¯¼è‡´å¼•æ“æ”¾å¼ƒä½¿ç”¨ç´¢å¼•è€Œè¿›è¡Œå…¨è¡¨æ‰«æï¼Œå¦‚ï¼š
select id from t where num is null,å¯ä»¥åœ¨numä¸Šè®¾ç½®é»˜è®¤å€¼0ï¼Œç¡®ä¿è¡¨ä¸­numåˆ—æ²¡æœ‰nullå€¼ï¼Œç„¶åè¿™æ ·æŸ¥è¯¢ï¼š
select id from t where num=0&lt;/li>
&lt;li>åº”å°½é‡é¿å…åœ¨ where å­å¥ä¸­ä½¿ç”¨!=æˆ–&amp;lt;&amp;gt;æ“ä½œç¬¦ï¼Œå¦åˆ™å°†å¼•æ“æ”¾å¼ƒä½¿ç”¨ç´¢å¼•è€Œè¿›è¡Œå…¨è¡¨æ‰«æã€‚ä¼˜åŒ–å™¨å°†æ— æ³•é€šè¿‡ç´¢å¼•æ¥ç¡®å®šå°†è¦å‘½ä¸­çš„è¡Œæ•°,å› æ­¤éœ€è¦æœç´¢è¯¥è¡¨çš„æ‰€æœ‰è¡Œã€‚&lt;/li>
&lt;li>åº”å°½é‡é¿å…åœ¨ where å­å¥ä¸­ä½¿ç”¨ or æ¥è¿æ¥æ¡ä»¶ï¼Œå¦åˆ™å°†å¯¼è‡´å¼•æ“æ”¾å¼ƒä½¿ç”¨ç´¢å¼•è€Œè¿›è¡Œå…¨è¡¨æ‰«æï¼Œå¦‚ï¼š
select id from t where num=10 or num=20&lt;/li>
&lt;li>å°½é‡é¿å…åœ¨ç´¢å¼•è¿‡çš„å­—ç¬¦æ•°æ®ä¸­ï¼Œä½¿ç”¨éæ‰“å¤´å­—æ¯æœç´¢ã€‚è¿™ä¹Ÿä½¿å¾—å¼•æ“æ— æ³•åˆ©ç”¨ç´¢å¼•ã€‚
è§å¦‚ä¸‹ä¾‹å­ï¼š
SELECT * FROM T1 WHERE NAME LIKE â€˜%L%â€™
SELECT * FROM T1 WHERE SUBSTING(NAME,2,1)=â€™Lâ€™
SELECT * FROM T1 WHERE NAME LIKE â€˜L%â€™&lt;/li>
&lt;li>åº”å°½é‡é¿å…åœ¨ where å­å¥ä¸­å¯¹å­—æ®µè¿›è¡Œè¡¨è¾¾å¼æ“ä½œï¼Œè¿™å°†å¯¼è‡´å¼•æ“æ”¾å¼ƒä½¿ç”¨ç´¢å¼•è€Œè¿›è¡Œå…¨è¡¨æ‰«æ&lt;/li>
&lt;li>åº”å°½é‡é¿å…åœ¨whereå­å¥ä¸­å¯¹å­—æ®µè¿›è¡Œå‡½æ•°æ“ä½œï¼Œè¿™å°†å¯¼è‡´å¼•æ“æ”¾å¼ƒä½¿ç”¨ç´¢å¼•è€Œè¿›è¡Œå…¨è¡¨æ‰«æ&lt;/li>
&lt;li>ä¸è¦åœ¨ where å­å¥ä¸­çš„â€œ=â€å·¦è¾¹è¿›è¡Œå‡½æ•°ã€ç®—æœ¯è¿ç®—æˆ–å…¶ä»–è¡¨è¾¾å¼è¿ç®—ï¼Œå¦åˆ™ç³»ç»Ÿå°†å¯èƒ½æ— æ³•æ­£ç¡®ä½¿ç”¨ç´¢å¼•&lt;/li>
&lt;/ul>
&lt;/blockquote>
&lt;h2 id="æ€»ç»“">&lt;a href="#%e6%80%bb%e7%bb%93" class="header-anchor">&lt;/a>æ€»ç»“
&lt;/h2>&lt;p>&lt;strong>å“ªäº›æƒ…å†µéœ€è¦å»ºç´¢å¼•ï¼š&lt;/strong>&lt;/p>
&lt;blockquote>
&lt;p>1 ä¸»é”®ï¼Œå”¯ä¸€ç´¢å¼•
2 ç»å¸¸ç”¨ä½œæŸ¥è¯¢æ¡ä»¶çš„å­—æ®µéœ€è¦åˆ›å»ºç´¢å¼•
3 ç»å¸¸éœ€è¦æ’åºã€åˆ†ç»„å’Œç»Ÿè®¡çš„å­—æ®µéœ€è¦å»ºç«‹ç´¢å¼•
4 æŸ¥è¯¢ä¸­ä¸å…¶ä»–è¡¨å…³è”çš„å­—æ®µï¼Œå¤–é”®å…³ç³»å»ºç«‹ç´¢å¼•&lt;/p>
&lt;/blockquote>
&lt;p>&lt;strong>å“ªäº›æƒ…å†µä¸è¦å»ºç´¢å¼•ï¼š&lt;/strong>&lt;/p>
&lt;blockquote>
&lt;p>1 è¡¨çš„è®°å½•å¤ªå°‘ï¼Œç™¾ä¸‡çº§ä»¥ä¸‹çš„æ•°æ®ä¸éœ€è¦åˆ›å»ºç´¢å¼•,æ•°æ®é‡å¾ˆå°‘çš„æ—¶å€™,ç´¢å¼•å¸¦æ¥çš„æå‡ä¸å¤Ÿæ˜æ˜¾
2 ç»å¸¸å¢åˆ æ”¹çš„è¡¨ä¸éœ€è¦åˆ›å»ºç´¢å¼•(åœ¨ä¿®æ”¹è¡¨çš„å†…å®¹æ—¶ï¼Œç´¢å¼•å¿…é¡»è¿›è¡Œæ›´æ–°ï¼Œæœ‰æ—¶å¯èƒ½éœ€è¦é‡æ„ï¼Œå› æ­¤ï¼Œç´¢å¼•è¶Šå¤šï¼Œæ‰€èŠ±çš„æ—¶é—´è¶Šé•¿ã€‚)
3 æ•°æ®é‡å¤ä¸”åˆ†å¸ƒå¹³å‡çš„å­—æ®µä¸éœ€è¦åˆ›å»ºç´¢å¼•ï¼Œå¦‚ true,false ä¹‹ç±»ã€‚(ä½“ç°ä¸å‡ºç´¢å¼•å¸¦æ¥çš„ä»·å€¼)
4 é¢‘å‘æ›´æ–°çš„å­—æ®µä¸é€‚åˆåˆ›å»ºç´¢å¼•(å’Œ2åŒç†)
5 whereæ¡ä»¶é‡Œç”¨ä¸åˆ°çš„å­—æ®µä¸éœ€è¦åˆ›å»ºç´¢å¼•(ç´¢å¼•èµ·ä¸åˆ°ä½œç”¨)&lt;/p>
&lt;/blockquote>
&lt;p>&lt;strong>ä½¿ç”¨æ³¨æ„:&lt;/strong>&lt;/p>
&lt;blockquote>
&lt;ul>
&lt;li>æ€§èƒ½ä¼˜åŒ–è¿‡ç¨‹ä¸­ï¼Œé€‰æ‹©åœ¨å“ªä¸ªåˆ—ä¸Šåˆ›å»ºç´¢å¼•æ˜¯æœ€é‡è¦çš„æ­¥éª¤ä¹‹ä¸€ã€‚å¯ä»¥è€ƒè™‘ä½¿ç”¨ç´¢å¼•çš„ä¸»è¦æœ‰ä¸¤ç§ç±»å‹çš„åˆ—ï¼šåœ¨whereå­å¥ä¸­å‡ºç°çš„åˆ—ï¼Œåœ¨joinå­å¥ä¸­å‡ºç°çš„åˆ—ã€‚&lt;/li>
&lt;li>è€ƒè™‘åˆ—ä¸­å€¼çš„åˆ†å¸ƒï¼Œç´¢å¼•çš„åˆ—çš„åŸºæ•°è¶Šå¤§ï¼Œç´¢å¼•çš„æ•ˆæœè¶Šå¥½ã€‚&lt;/li>
&lt;li>ä½¿ç”¨çŸ­ç´¢å¼•ï¼Œå¦‚æœå¯¹å­—ç¬¦ä¸²åˆ—è¿›è¡Œç´¢å¼•ï¼Œåº”è¯¥æŒ‡å®šä¸€ä¸ªå‰ç¼€é•¿åº¦ï¼Œå¯èŠ‚çœå¤§é‡ç´¢å¼•ç©ºé—´ï¼Œæå‡æŸ¥è¯¢é€Ÿåº¦ã€‚&lt;/li>
&lt;li>ä¸è¦è¿‡åº¦ç´¢å¼•ï¼Œåªä¿æŒæ‰€éœ€çš„ç´¢å¼•ã€‚æ¯ä¸ªé¢å¤–çš„ç´¢å¼•éƒ½è¦å ç”¨é¢å¤–çš„ç£ç›˜ç©ºé—´ï¼Œå¹¶é™ä½å†™æ“ä½œçš„æ€§èƒ½ã€‚&lt;/li>
&lt;li>åœ¨ä¿®æ”¹è¡¨çš„å†…å®¹æ—¶ï¼Œç´¢å¼•å¿…é¡»è¿›è¡Œæ›´æ–°ï¼Œæœ‰æ—¶å¯èƒ½éœ€è¦é‡æ„ï¼Œå› æ­¤ï¼Œç´¢å¼•è¶Šå¤šï¼Œæ‰€èŠ±çš„æ—¶é—´è¶Šé•¿ã€‚&lt;/li>
&lt;li>MySQLåªå¯¹ä¸€ä¸‹æ“ä½œç¬¦æ‰ä½¿ç”¨ç´¢å¼•ï¼š&amp;lt;,&amp;lt;=,=,&amp;gt;,&amp;gt;=,between,in, ä»¥åŠæŸäº›æ—¶å€™çš„like(ä¸ä»¥é€šé…ç¬¦%æˆ–_å¼€å¤´çš„æƒ…å½¢)ã€‚&lt;/li>
&lt;/ul>
&lt;/blockquote>
&lt;h2 id="å†æ¬¡æ„Ÿè°¢å‰è¾ˆä»¬çš„æ— ç§åˆ†äº«">&lt;a href="#%e5%86%8d%e6%ac%a1%e6%84%9f%e8%b0%a2%e5%89%8d%e8%be%88%e4%bb%ac%e7%9a%84%e6%97%a0%e7%a7%81%e5%88%86%e4%ba%ab" class="header-anchor">&lt;/a>å†æ¬¡æ„Ÿè°¢å‰è¾ˆä»¬çš„æ— ç§åˆ†äº«
&lt;/h2>&lt;p>æˆ‘ä¹Ÿæ˜¯åœ¨å­¦ä¹ ä¸­,æ–‡ä¸­å¦‚æœ‰é”™è¯¯çš„åœ°æ–¹,æ¬¢è¿åœ¨è¯„è®ºåŒºæŒ‡å‡º,æ–¹ä¾¿å…±åŒå­¦ä¹ &lt;/p></description></item><item><title>nginxåå‘ä»£ç†webSocketé…ç½®</title><link>https://lqxhub.github.io/posts/83c41ef3/</link><pubDate>Sun, 21 Oct 2018 15:57:21 +0000</pubDate><guid>https://lqxhub.github.io/posts/83c41ef3/</guid><description>&lt;p>æœ€è¿‘åœ¨åšé¡¹ç›®çš„æ—¶å€™ç”¨åˆ°äº†webSocketåè®®,è€Œä¸”æ˜¯åœ¨å¾®ä¿¡å°ç¨‹åºä¸­ç”¨åˆ°äº†webSocket,å¾®ä¿¡å°ç¨‹åºä¸­ä½¿ç”¨wssåè®®çš„æ—¶å€™ä¸èƒ½è®¾ç½®ç«¯å£,åªèƒ½ä½¿ç”¨é»˜è®¤çš„443ç«¯å£ã€‚
æˆ‘æ“¦ï¼Œæˆ‘çš„httpså·²ç»ç›‘å¬äº†443ç«¯å£ï¼ŒwebSocketå†å»ç›‘å¬443ï¼Œè‚¯å®šä¸è¡Œå•Šã€‚è¦æƒ³åŠæ³•è§£å†³ï¼Œè€å¤§æŠŠè¿™ä¸ªé—®é¢˜äº¤ç»™æˆ‘äº†ï¼Œæˆ‘æ„‰å¿«ï¼ˆæ‰‹åŠ¨æ‡µé€¼ï¼‰çš„æ¥æ”¶äº†è¿™ä¸ªä»»åŠ¡ã€‚æƒ³åˆ°äº†ä¸¤ç§åŠæ³•è§£å†³ã€‚
ä¸€ç§è§£å†³åŠæ³•æ˜¯æŠŠwebSocketéƒ¨ç½²åˆ°å¦ä¸€å°æœåŠ¡å™¨ä¸Šï¼Œè¿™æ ·æˆæœ¬ä¹Ÿå¤ªé«˜äº†ã€‚å¦ä¸€ç§åŠæ³•ï¼Œå°±æ˜¯ä½¿ç”¨nginxåå‘ä»£ç†ã€‚&lt;/p>
&lt;p>å› ä¸ºwebSocketåè®®æ˜¯åŸºäºhttpåè®®å‡çº§çš„ï¼ˆè§ä¸‹å›¾ï¼‰ï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨nginxåå‘ä»£ç†webSocket.
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-0dd0a9b8d24ca99d.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-0dd0a9b8d24ca99d.webp" alt="webSocket" />
&lt;/a>
&lt;/div>
ä»è¿™å¼ å›¾ç‰‡ä¸Šå¯ä»¥çœ‹å‡ºï¼ŒwebSocketè¿æ¥çš„å»ºç«‹æ˜¯åœ¨httpåè®®çš„åŸºç¡€ä¸Šã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-fallback" data-lang="fallback">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>GET /chat HTTP/1.1
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span>Host: server.example.com
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3&lt;/span>&lt;span>Upgrade: websocket
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4&lt;/span>&lt;span>Connection: Upgrade
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5&lt;/span>&lt;span>Sec-WebSocket-Key: x3JJHMbDL1EzLkh9GBhXDw==
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6&lt;/span>&lt;span>Sec-WebSocket-Protocol: chat, superchat
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7&lt;/span>&lt;span>Sec-WebSocket-Version: 13
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8&lt;/span>&lt;span>Origin: http://example.com
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ç†Ÿæ‚‰HTTPçš„ç«¥é‹å¯èƒ½å‘ç°äº†ï¼Œè¿™æ®µç±»ä¼¼HTTPåè®®çš„æ¡æ‰‹è¯·æ±‚ä¸­ï¼Œåªæ˜¯å¤šäº†å‡ ä¸ªä¸œè¥¿ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-fallback" data-lang="fallback">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>Upgrade: websocket
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span>Connection: Upgrade
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3&lt;/span>&lt;span>è¿™ä¸ªå°±æ˜¯Websocketçš„æ ¸å¿ƒäº†ï¼Œå‘Šè¯‰Apacheã€Nginxç­‰æœåŠ¡å™¨ï¼šæˆ‘å‘èµ·çš„æ˜¯Websocketåè®®ã€‚
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4&lt;/span>&lt;span>Sec-WebSocket-Key: x3JJHMbDL1EzLkh9GBhXDw==
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5&lt;/span>&lt;span>Sec-WebSocket-Protocol: chat, superchat
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6&lt;/span>&lt;span>Sec-WebSocket-Version: 13
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>é¦–å…ˆï¼ŒSec-WebSocket-Key æ˜¯ä¸€ä¸ªBase64 encodeçš„å€¼ï¼Œè¿™ä¸ªæ˜¯æµè§ˆå™¨éšæœºç”Ÿæˆçš„ï¼Œå‘Šè¯‰æœåŠ¡å™¨ï¼šæ³¥ç…¤ï¼Œä¸è¦å¿½æ‚ çªï¼Œæˆ‘è¦éªŒè¯å°¼æ˜¯ä¸æ˜¯çœŸçš„æ˜¯WebsocketåŠ©ç†ã€‚
æœ€åï¼ŒSec-WebSocket-Version æ˜¯å‘Šè¯‰æœåŠ¡å™¨æ‰€ä½¿ç”¨çš„Websocket Draftï¼ˆåè®®ç‰ˆæœ¬ï¼‰ï¼Œåœ¨æœ€åˆçš„æ—¶å€™ï¼ŒWebsocketåè®®è¿˜åœ¨ Draft é˜¶æ®µï¼Œå„ç§å¥‡å¥‡æ€ªæ€ªçš„åè®®éƒ½æœ‰ï¼Œè€Œä¸”è¿˜æœ‰å¾ˆå¤šæœŸå¥‡å¥‡æ€ªæ€ªä¸åŒçš„ä¸œè¥¿ï¼Œä»€ä¹ˆFirefoxå’ŒChromeç”¨çš„ä¸æ˜¯ä¸€ä¸ªç‰ˆæœ¬ä¹‹ç±»çš„ï¼Œå½“åˆWebsocketåè®®å¤ªå¤šå¯æ˜¯ä¸€ä¸ªå¤§éš¾é¢˜ã€‚ã€‚ä¸è¿‡ç°åœ¨è¿˜å¥½ï¼Œå·²ç»å®šä¸‹æ¥å•¦&lt;del>å¤§å®¶éƒ½ä½¿ç”¨çš„ä¸€ä¸ªä¸œè¥¿&lt;/del>&lt;/p>
&lt;p>ç„¶åæœåŠ¡å™¨ä¼šè¿”å›ä¸‹åˆ—ä¸œè¥¿ï¼Œè¡¨ç¤ºå·²ç»æ¥å—åˆ°è¯·æ±‚ï¼Œ æˆåŠŸå»ºç«‹Websocketå•¦ï¼&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-fallback" data-lang="fallback">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>HTTP/1.1 101 Switching Protocols
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span>Upgrade: websocket
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3&lt;/span>&lt;span>Connection: Upgrade
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4&lt;/span>&lt;span>Sec-WebSocket-Accept: HSmrc0sMlYUkAGmm5OPpG2HaGWk=
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5&lt;/span>&lt;span>Sec-WebSocket-Protocol: chat
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™é‡Œå¼€å§‹å°±æ˜¯HTTPæœ€åè´Ÿè´£çš„åŒºåŸŸäº†ï¼Œå‘Šè¯‰å®¢æˆ·ï¼Œæˆ‘å·²ç»æˆåŠŸåˆ‡æ¢åè®®å•¦~&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-fallback" data-lang="fallback">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>Upgrade: websocket
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span>Connection: Upgrade
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä¾ç„¶æ˜¯å›ºå®šçš„ï¼Œå‘Šè¯‰å®¢æˆ·ç«¯å³å°†å‡çº§çš„æ˜¯Websocketåè®®ã€‚è‡³æ­¤ï¼ŒHTTPå·²ç»å®Œæˆå®ƒæ‰€æœ‰å·¥ä½œäº†ï¼Œæ¥ä¸‹æ¥å°±æ˜¯å®Œå…¨æŒ‰ç…§Websocketåè®®è¿›è¡Œäº†ã€‚&lt;/p>
&lt;p>æ˜ç™½åè®®çš„åŸç†äº†å°±å¯ä»¥ä¸‹ä¸€æ­¥äº†&lt;/p>
&lt;h2 id="é¦–å…ˆnginxå…ˆé…ç½®å¥½httpsçš„è¯ä¹¦">&lt;a href="#%e9%a6%96%e5%85%88nginx%e5%85%88%e9%85%8d%e7%bd%ae%e5%a5%bdhttps%e7%9a%84%e8%af%81%e4%b9%a6" class="header-anchor">&lt;/a>é¦–å…ˆnginxå…ˆé…ç½®å¥½httpsçš„è¯ä¹¦
&lt;/h2>&lt;p>æœåŠ¡å™¨çš„è¯ä¹¦æ˜¯è€å¤§é…ç½®å¥½çš„ï¼Œæˆ‘å°±ç›´æ¥ç”¨äº†ã€‚&lt;/p>
&lt;p>åœ¨nginxé…ç½®æ–‡ä»¶çš„&lt;code>service&lt;/code>èŠ‚ç‚¹ä¸­æ·»åŠ å¦‚ä¸‹é…ç½®&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-fallback" data-lang="fallback">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>location /wss
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3&lt;/span>&lt;span> proxy_pass http://127.0.0.1:8888;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4&lt;/span>&lt;span> proxy_http_version 1.1;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5&lt;/span>&lt;span> proxy_set_header Upgrade $http_upgrade;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6&lt;/span>&lt;span> proxy_set_header Connection &amp;#34;Upgrade&amp;#34;;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7&lt;/span>&lt;span> proxy_set_header X-Real-IP $remote_addr;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è§£é‡Šä¸€ä¸‹å‚æ•°
&lt;code>/wss&lt;/code>è¿™ä¸ªæ˜¯éšä¾¿èµ·çš„,å‘Šè¯‰Nginxè¦ä»£ç†çš„url,ç°åœ¨æˆ‘çš„è®¾ç½®ä¸º&lt;code>wss&lt;/code>,å½“æˆ‘è®¿é—®çš„æˆ‘çš„æœåŠ¡å™¨&lt;code>https://abc.com/wss&lt;/code>æ—¶,Nginxä¼šæŠŠæˆ‘çš„è¯·æ±‚æ˜ å°„åˆ°æœ¬æœºçš„8888ç«¯å£ã€‚
&lt;code>proxy_pass&lt;/code> è¦ä»£ç†åˆ°çš„url,æˆ‘çš„ä»£ç†åˆ°æœ¬æœºçš„8888ç«¯å£ã€‚
&lt;code>proxy_http_version&lt;/code> ä»£ç†æ—¶ä½¿ç”¨çš„ httpç‰ˆæœ¬ã€‚
&lt;strong>é‡ç‚¹æ¥äº†:&lt;/strong>
ä»£ç†webSocketçš„å…³é”®å‚æ•°
&lt;code>proxy_set_header Upgrade&lt;/code> æŠŠä»£ç†æ—¶httpè¯·æ±‚å¤´çš„&lt;code>Upgrade&lt;/code> è®¾ç½®ä¸ºåŸæ¥httpè¯·æ±‚çš„è¯·æ±‚å¤´,wssåè®®çš„è¯·æ±‚å¤´ä¸º&lt;code>websocket&lt;/code>
&lt;code>proxy_set_header Connection&lt;/code> å› ä¸ºä»£ç†çš„wssåè®®,æ‰€ä»¥httpè¯·æ±‚å¤´çš„&lt;code>Connection&lt;/code>è®¾ç½®ä¸º&lt;code>Upgrade&lt;/code>
&lt;code>proxy_set_header X-Real-IP&lt;/code> ç»™ä»£ç†è®¾ç½®åŸhttpè¯·æ±‚çš„ip,å¡«å†™&lt;code>$remote_addr&lt;/code> å³å¯
è‡³äºwebsocketåè®®çš„responseçš„å‚æ•°ï¼Œåœ¨åå‘ä»£ç†çš„æ—¶å€™ä¸ç”¨ç®¡ã€‚
åˆ°è¿™é‡Œ,Nginxåå‘ä»£ç†webSocketçš„é…ç½®å°±å®Œæˆäº†,é‡å¯Nginx,ç”¨websocketè¿æ¥è¯•è¯•ï¼Œåœ¨åŸæ¥wssåœ°å€çš„åœ°æ–¹å¡«å†™&lt;code>wss://abc.com/wss&lt;/code>ã€‚å¦‚æœwebsocketæˆåŠŸè¿æ¥,è¯´æ˜Nginxåå‘ä»£ç†websocketå·²ç»æˆåŠŸäº†ã€‚&lt;/p>
&lt;h2 id="æ€»ç»“">&lt;a href="#%e6%80%bb%e7%bb%93" class="header-anchor">&lt;/a>æ€»ç»“
&lt;/h2>&lt;p>ç°åœ¨çš„é…ç½®åªæ˜¯åå‘ä»£ç†åˆ°æœ¬æœºæ—¶çš„é…ç½®,å¦‚æœè¦åå‘ä»£ç†åˆ°åˆ«çš„ä¸»æœº,åœ¨ä»£ç†æ—¶å¯èƒ½ä¼šè·¨åŸŸé—®é¢˜,éœ€è¦åœ¨Nginxçš„åå‘ä»£ç†ä¸­åšè·¨åŸŸçš„é…ç½®ã€‚&lt;/p>
&lt;h2 id="æ€è€ƒ">&lt;a href="#%e6%80%9d%e8%80%83" class="header-anchor">&lt;/a>æ€è€ƒ
&lt;/h2>&lt;p>åœ¨Nginxçš„é…ç½®æ–‡ä»¶ä¸­èƒ½çœ‹åˆ°è¿™ä¸€æ®µ&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-fallback" data-lang="fallback">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>location ~ .php$ {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span> root html;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3&lt;/span>&lt;span> fastcgi_pass 127.0.0.1:9000;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4&lt;/span>&lt;span> fastcgi_index index.php;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5&lt;/span>&lt;span> fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6&lt;/span>&lt;span> include fastcgi_params;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™æ˜¯Nginxä¸­phpçš„é…ç½®æ–‡ä»¶,æˆ‘æ“¦,æ€ä¹ˆè¿™ä¹ˆçœ¼ç†Ÿ,è¿™ä¸ªé…ç½®æ¸…å•è·Ÿåˆšæ‰çš„websocketçš„åå‘ä»£ç†è¿™ä¹ˆåƒã€‚é€šè¿‡ä¸Šç½‘æŸ¥èµ„æ–™æ‰çŸ¥é“ï¼ŒåŸæ¥Nginxåœ¨å¤„ç†phpç±»å‹çš„è¯·æ±‚æ—¶ï¼ŒæŠŠè¯·æ±‚å‘fastcgiç®¡ç†è¿›ç¨‹å¤„ç†ï¼Œfascgiç®¡ç†è¿›ç¨‹é€‰æ‹©cgiå­è¿›ç¨‹å¤„ç†ç»“æœå¹¶è¿”å›è¢«nginx,è€Œphp-fpmæ˜¯ä¸€ä¸ªPHP FastCGIç®¡ç†å™¨,nginxæœ¬èº«ä¸èƒ½å¤„ç†PHPï¼Œå®ƒåªæ˜¯ä¸ªwebæœåŠ¡å™¨ï¼Œå½“æ¥æ”¶åˆ°è¯·æ±‚åï¼Œå¦‚æœæ˜¯phpè¯·æ±‚,åˆ™å‘ç»™phpè§£é‡Šå™¨å¤„ç†ï¼Œå¹¶æŠŠç»“æœè¿”å›ç»™å®¢æˆ·ç«¯ã€‚æ‰€ä»¥è¯´Nginxåœ¨å¤„ç†phpç±»å‹çš„è¯·æ±‚æ—¶,æœ¬è´¨ä¸Šä¹Ÿæ˜¯é€šè¿‡åå‘ä»£ç†åŠŸèƒ½å®ç°çš„ã€‚
æˆ‘ä»¬å¯ä»¥æŠŠæ€ç»´å±•å¼€ï¼Œç”¨Nginxåå‘ä»£ç†å¯ä»¥å®ç°æ›´å¤šçš„åŠŸèƒ½ï¼Œæ¯”å¦‚ä»£ç†Tomcat&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-fallback" data-lang="fallback">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>location /Tomcat
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3&lt;/span>&lt;span> proxy_pass http://127.0.0.1:8080;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4&lt;/span>&lt;span> proxy_http_version 1.1;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5&lt;/span>&lt;span> proxy_set_header X-Real-IP $remote_addr;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å½“ç„¶ï¼Œä¹Ÿå¯ä»¥ç”¨Nginxåå‘ä»£ç†å®ç°è´Ÿè½½å‡è¡¡,è¿™ä¸ªæˆ‘è¿˜æ²¡æœ‰è¯•è¿‡,ç­‰ä»¥åç”¨åˆ°äº†,å†æ¥è¡¥å……&lt;/p></description></item><item><title>ä½¿ç”¨fiddleråœ¨æ‰‹æœºä¸ŠæŠ“HTTPSåŒ…</title><link>https://lqxhub.github.io/posts/46c7ea4a/</link><pubDate>Sun, 21 Oct 2018 15:55:05 +0000</pubDate><guid>https://lqxhub.github.io/posts/46c7ea4a/</guid><description>&lt;p>æœ€è¿‘æƒ³æŠ“å–æ‰‹æœºä¸Šappçš„æ•°æ®åŒ…,åœ¨ç”µè„‘ä¸ŠæŠ“åŒ…å¯é€‰çš„å·¥å…·æœ‰å¾ˆå¤š, æ¯”å¦‚&lt;strong>wireshark&lt;/strong>,Linuxå‘½ä»¤è¡Œä¸‹æœ‰&lt;strong>tcpdump&lt;/strong>ç­‰ç­‰å·¥å…·ã€‚å¯æ˜¯åœ¨è¿™äº›å·¥å…·åœ¨æ‰‹æœºä¸Šéƒ½æ²¡æ³•ä½¿ç”¨ï¼Œè¿™æ€ä¹ˆæ!&lt;/p>
&lt;p>&lt;a class="link" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-58848e89e884254d.webp" target="_blank" rel="noopener"
>&lt;/a>
åæ¥æƒ³äº†æƒ³èƒ½ä¸èƒ½ç”¨ç½‘ç»œä»£ç†æŠ“åŒ…å‘¢,è¯´å¹²å°±å¹²ã€‚ä»ç½‘ä¸ŠæŸ¥åˆ°ï¼Œç”¨fiddlerå¯ä»¥ä»£ç†æ‰‹æœºçš„ç½‘ç»œã€‚&lt;/p>
&lt;h2 id="ç¬¬ä¸€æ­¥ä¸‹è½½fiddler">&lt;a href="#%e7%ac%ac%e4%b8%80%e6%ad%a5%e4%b8%8b%e8%bd%bdfiddler" class="header-anchor">&lt;/a>ç¬¬ä¸€æ­¥ä¸‹è½½fiddler
&lt;/h2>&lt;p>å»ä¸‹è½½ä¸€ä¸ªfiddlerï¼Œå»ºè®®å»å®˜ç½‘ä¸‹è½½&lt;a class="link" href="https://www.telerik.com/download/fiddler" target="_blank" rel="noopener"
>ä¼ é€é—¨&lt;/a>ã€‚
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-4623113b3cc81f47.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-4623113b3cc81f47.webp" alt="fiddler" />
&lt;/a>
&lt;/div>
å‹¾é€‰åè®®,å¡«å†™é‚®ç®±,ç„¶åä¸‹è½½å°±å¯ä»¥&lt;/p>
&lt;h2 id="ç¬¬äºŒæ­¥å®‰è£…fiddler">&lt;a href="#%e7%ac%ac%e4%ba%8c%e6%ad%a5%e5%ae%89%e8%a3%85fiddler" class="header-anchor">&lt;/a>ç¬¬äºŒæ­¥å®‰è£…fiddler
&lt;/h2>&lt;p>åŒå‡»ä¸‹è½½çš„.exeæ–‡ä»¶,ç„¶åé€‰æ‹©ç›®å½•,next,next,å®Œæˆå®‰è£…
##ç¬¬ä¸‰æ­¥å®‰è£…CertMakeræ’ä»¶
fiddleré»˜è®¤ç”Ÿæˆçš„è¯ä¹¦ä¸èƒ½æ»¡è¶³Androidå’ŒiOSç³»ç»Ÿçš„è¦æ±‚,éœ€è¦ä½¿ç”¨è¿™ä¸ªæ’ä»¶ &lt;a class="link" href="https://www.telerik.com/fiddler/add-ons" target="_blank" rel="noopener"
>ä¼ é€é—¨&lt;/a> å¾€ä¸‹æ‰¾,æ‰¾åˆ°å›¾ç‰‡çš„åœ°æ–¹,ç‚¹å‡»ä¸‹è½½,ä¸‹è½½å,åŒå‡»å®‰è£…&lt;/p>
&lt;h2 id="ç¬¬å››æ­¥é…ç½®fiddlerä»£ç†">&lt;a href="#%e7%ac%ac%e5%9b%9b%e6%ad%a5%e9%85%8d%e7%bd%aefiddler%e4%bb%a3%e7%90%86" class="header-anchor">&lt;/a>ç¬¬å››æ­¥é…ç½®fiddlerä»£ç†
&lt;/h2>&lt;p>æƒ³è¦æŠ“HTTPSçš„æ•°æ®åŒ…,å¿…é¡»å®‰è£…è¯ä¹¦,
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-7d789925391e1cbc.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-7d789925391e1cbc.webp" alt="fiddler" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;h2 id="httpscdnjsdelivrnetghlqxhubimagesmasterblog3622259-743eda534ce02dafwebp">&lt;a href="#httpscdnjsdelivrnetghlqxhubimagesmasterblog3622259-743eda534ce02dafwebp" class="header-anchor">&lt;/a>ç‚¹å‡»tools-&amp;gt;options,ç„¶åå‡ºç°è¿™ä¸ªç•Œé¢,æŒ‰ç…§æˆ‘æ ‡æ³¨çš„1,2,3,4éƒ½å‹¾é€‰,ä¸­é—´ä¼šå‡ºç°ä¸€äº›æç¤º,éƒ½ç‚¹ &lt;strong>yes&lt;/strong>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-743eda534ce02daf.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-743eda534ce02daf.webp" alt="" />
&lt;/a>
&lt;/div>
&lt;/h2>&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-7e8cbdaa3aa9b801.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-7e8cbdaa3aa9b801.webp" alt="" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;hr>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-89aad703f4de31de.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-89aad703f4de31de.webp" alt="ca2.png" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;hr>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-bfd40396ad37918f.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-bfd40396ad37918f.webp" alt="ca_ok.png" />
&lt;/a>
&lt;/div>
æœ€åå‡ºç°è¿™ä¸ªå¯¹è¯æ¡†è¯´æ˜è¯ä¹¦å·²ç»å®‰è£…æˆåŠŸã€‚&lt;/p>
&lt;h2 id="ç¬¬äº”æ­¥é…ç½®ä»£ç†æ‰‹æœºå’Œç”µè„‘åœ¨åŒä¸€ä¸ªç½‘ç»œä¸­">&lt;a href="#%e7%ac%ac%e4%ba%94%e6%ad%a5%e9%85%8d%e7%bd%ae%e4%bb%a3%e7%90%86%e6%89%8b%e6%9c%ba%e5%92%8c%e7%94%b5%e8%84%91%e5%9c%a8%e5%90%8c%e4%b8%80%e4%b8%aa%e7%bd%91%e7%bb%9c%e4%b8%ad" class="header-anchor">&lt;/a>ç¬¬äº”æ­¥é…ç½®ä»£ç†(æ‰‹æœºå’Œç”µè„‘åœ¨åŒä¸€ä¸ªç½‘ç»œä¸­)
&lt;/h2>&lt;p>é‡å¯fiddlerï¼Œå¼€å§‹æ‰‹æœºçš„é…ç½®ã€‚æŸ¥çœ‹ç”µè„‘çš„IPåœ°å€,æˆ‘çš„æ˜¯192.168.31.56ç„¶åæ‰“å¼€æ‰‹æœºçš„æµè§ˆå™¨(è‹¹æœæ‰‹æœºä¸€å®šè¦ç”¨Safari),è¾“å…¥&lt;strong>IPåœ°å€:ç«¯å£å·&lt;/strong> æˆ‘çš„æ˜¯&lt;strong>192.168.31.56:8888&lt;/strong> è¿™ä¸ªæ ¹æ®å…·ä½“æƒ…å†µè®¾ç½®
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-9b0486670a684700.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-9b0486670a684700.webp" alt="iPhone" />
&lt;/a>
&lt;/div>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-b5cce86fcb3de1ee.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-b5cce86fcb3de1ee.webp" alt="iPhone" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>ä¸‹è½½è¯ä¹¦,ç‚¹å‡»å…è®¸,å®‰è£…è¯ä¹¦.&lt;/p>
&lt;h2 id="é‡ç‚¹é‡ç‚¹é‡ç‚¹">&lt;a href="#%e9%87%8d%e7%82%b9%e9%87%8d%e7%82%b9%e9%87%8d%e7%82%b9" class="header-anchor">&lt;/a>é‡ç‚¹ã€é‡ç‚¹ã€é‡ç‚¹
&lt;/h2>&lt;p>&lt;strong>è¿™æ—¶å€™ä¸€å®šè¦æŠŠå®‰è£…çš„è¯ä¹¦è®¾ç½®ä¸ºä¿¡ä»»çš„è¯ä¹¦&lt;/strong>
å»æ‰‹æœºçš„è®¾ç½®-&amp;gt;é€šç”¨-&amp;gt;å…³äºæœ¬æœº-&amp;gt;è¯ä¹¦æ–°äººè®¾ç½®,æŠŠåˆšæ‰å®‰è£…çš„è¯ä¹¦è®¾ç½®ä¸ºä¿¡ä»»çš„è¯ä¹¦ã€‚å†å»ç½‘ç»œè®¾ç½®ä¸­,ç»™WiFiè®¾ç½®ä»£ç†(ç”µè„‘å’Œæ‰‹æœºä¸€å®šåœ¨åŒä¸€ä¸ªç½‘ç»œä¸­)
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-33e071e66c26266e.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-33e071e66c26266e.webp" alt="iPhone" />
&lt;/a>
&lt;/div>
ç„¶åæ‰“å¼€æ‰‹æœºä¸Šçš„app,åœ¨fiddlerä¸­å°±å¯ä»¥çœ‹åˆ°,httpçš„æ•°æ®äº†,æ‰“å¼€ä¸€ä¸ªHTTPSçš„è¿æ¥,å¯ä»¥çœ‹åˆ°,æ•°æ®æ˜¯æ²¡æœ‰åŠ å¯†çš„
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-701385010b89fdd2.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-701385010b89fdd2.webp" alt="fiddler" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>è¿™æ—¶å€™å¦‚æœæ²¡æœ‰æŠ“åˆ°æ•°æ®åŒ…,æˆ–è€…é”™è¯¯,åº”è¯¥æ˜¯è¯ä¹¦é…ç½®æœ‰é—®é¢˜,æŠŠä¹‹å‰çš„è¯ä¹¦æ¸…é™¤,æŒ‰ç…§æ­¥éª¤é‡æ–°é…ç½®ä¸€é.é‡å¯fiddler,é‡æ–°åœ¨æ‰‹æœºå®‰è£…è¯ä¹¦.
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-9f53b6e646f19abc.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-9f53b6e646f19abc.webp" alt="æ¸…é™¤è¯ä¹¦" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;h2 id="æ€»ç»“">&lt;a href="#%e6%80%bb%e7%bb%93" class="header-anchor">&lt;/a>æ€»ç»“
&lt;/h2>&lt;p>fiddlerä»£ç†å¯ä»¥æŠ“åˆ°å¤§å¤šæ•°çš„æ•°æ®åŒ…,ä½†ä¸æ˜¯æ‰€æœ‰çš„æ•°æ®åŒ…éƒ½èƒ½æŠ“åˆ°ã€‚fiddlerå¹¶ä¸æ”¯æŒå…¨éƒ¨åè®®ï¼Œç›®å‰å·²çŸ¥çš„æœ‰http2ã€tcpã€udpã€websocketç­‰ï¼Œå¦‚æœåº”ç”¨èµ°äº†ä»¥ä¸Šåè®®ï¼Œé‚£ä¹ˆfiddlerè‚¯å®šæ˜¯æŠ“ä¸åˆ°çš„ã€‚å› ä¸ºfiddleræ˜¯åŸºäº.net frameworkå®ç°çš„ï¼Œå› ä¸º.net frameworkä¸æ”¯æŒhttp2ï¼Œæ‰€ä»¥fiddleræ— æ³•æŠ“å–http2ã€‚
è¿˜æœ‰ä¸€ç§æƒ…å†µ,appä½¿ç”¨è‡ªå¸¦çš„è¯ä¹¦,æˆ‘ä»¬ç»™æ‰‹æœºå®‰è£…çš„è¯ä¹¦,appä¸ä¿¡ä»».è¿™æ ·ä¹Ÿæ˜¯æ— æ³•æŠ“åˆ°çš„ã€‚fiddleræŠ“åŒ…çš„åŸç†æ˜¯ä¸­é—´äººæ”»å‡»ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä¸¤å¤´ç’ï¼Œæ¬ºéª—å®¢æˆ·ç«¯&amp;amp;&amp;amp;æ¬ºéª—æœåŠ¡å™¨ç«¯ï¼Œå¦‚æœhttpsè¯ä¹¦å†™æ­»åœ¨appé‡Œï¼Œappåªä¿¡ä»»è‡ªå·±çš„è¯ä¹¦ï¼Œfiddleræ²¡æ³•ç’å®¢æˆ·ç«¯äº†ï¼Œå› æ­¤fiddlerä¹Ÿå°±æŠ“å–ä¸åˆ°åŒ…äº†ã€‚&lt;/p></description></item><item><title>Androidæ‰‹æœºä¸Šæ­å»ºä¸€ä¸ªhttpæœåŠ¡å™¨</title><link>https://lqxhub.github.io/posts/b60bc963/</link><pubDate>Sun, 08 Apr 2018 19:48:03 +0000</pubDate><guid>https://lqxhub.github.io/posts/b60bc963/</guid><description>&lt;p>çœ‹åˆ°æ ‡é¢˜æ˜¯ä¸æ˜¯æœ‰ç‚¹æ‡µï¼Œåœ¨Androidæ‰‹æœºä¸Šæ­å»ºä¸€ä¸ªhttpæœåŠ¡å™¨ï¼Ÿï¼Ÿï¼Ÿ
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-4289714841b06ff7.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-4289714841b06ff7.webp" alt="ä½ TMåœ¨é€—æˆ‘" />
&lt;/a>
&lt;/div>
æ²¡é”™ï¼Œæˆ‘ä»¬å°±æ˜¯è¦åœ¨Androidæ‰‹æœºä¸Šæ­å»ºä¸€ä¸ªhttpæœåŠ¡å™¨ã€‚æåˆ°httpæœåŠ¡å™¨ä¸€èˆ¬ç¬¬ä¸€ååº”æ˜¯Apacheï¼Œnginx
Androidä¸Šä¹Ÿèƒ½è¿è¡ŒApacheï¼Œnginxäº†ï¼Ÿï¼Ÿï¼Ÿ
Androidæ‰‹æœºä¸Šå½“ç„¶ä¸èƒ½è¿è¡Œè¿™äº›æœåŠ¡å™¨äº†ï¼Œè¿™æ¬¡åœ¨Androidä¸Šè¿è¡Œçš„æ˜¯ç”¨Golangå†™çš„ä¸€ä¸ªç®€å•çš„httpæœåŠ¡å™¨ã€‚å› ä¸ºGolangå¯ä»¥è·¨å¹³å°ç¼–è¯‘ï¼Œæˆ‘å°è¯•ç€æŠŠç³»ç»Ÿé€‰æ‹©æˆLinuxï¼ŒCPUæ¶æ„é€‰æ‹©armï¼Œç„¶ååœ¨æ‰‹æœºä¸Šè¿è¡Œï¼Œç„¶åAndroidæ‰‹æœºä¸ŠçœŸçš„è¿è¡Œèµ·äº†ä¸€ä¸ªhttpæœåŠ¡å™¨!
&lt;a class="link" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-43d8111cfa38fa59.webp" target="_blank" rel="noopener"
>æƒŠå–œ&lt;/a>
å›åˆ°æ­£é¢˜ï¼Œè¦æƒ³å¼€å‘ç¼–å†™golangï¼Œé¦–å…ˆè¦é…ç½®å¥½golangçš„å¼€å‘ç¯å¢ƒ&lt;/p>
&lt;p>æˆ‘æ˜¯åœ¨Ubuntuä¸‹å¼€å‘çš„ï¼Œæ–°å»ºservice.goæ–‡ä»¶&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">package&lt;/span> main
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span>&lt;span style="color:#ff79c6">import&lt;/span> (
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span> &lt;span style="color:#f1fa8c">&amp;#34;net/http&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span> )
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> &lt;span style="color:#50fa7b">main&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span> http.&lt;span style="color:#50fa7b">HandleFunc&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;/&amp;#34;&lt;/span>,myResponse)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span> http.&lt;span style="color:#50fa7b">ListenAndServe&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;127.0.0.1:8888&amp;#34;&lt;/span>,&lt;span style="color:#ff79c6">nil&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">func&lt;/span> &lt;span style="color:#50fa7b">myResponse&lt;/span>(w http.ResponseWriter,r&lt;span style="color:#ff79c6">*&lt;/span> http.Request) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span> w.&lt;span style="color:#50fa7b">Write&lt;/span>([]&lt;span style="color:#8be9fd;font-style:italic">byte&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;&amp;lt;html&amp;gt;&amp;lt;center&amp;gt; &amp;lt;font size=\&amp;#34;40\&amp;#34;&amp;gt;hello I am go service&amp;lt;/font&amp;gt;&amp;lt;/center&amp;gt;&amp;lt;/html&amp;gt;&amp;#34;&lt;/span>))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä¸ç†Ÿæ‚‰goçš„åŒå­¦æ³¨æ„ä¸‹ï¼Œ&lt;strong>ä¸è¦éšæ„å›è½¦æ¢è¡Œ&lt;/strong> &lt;strong>ä¸è¦éšæ„å›è½¦æ¢è¡Œ&lt;/strong> &lt;strong>ä¸è¦éšæ„å›è½¦æ¢è¡Œ&lt;/strong> å› ä¸ºgoæœ‰ç‚¹åƒPythonï¼Œä¸æ˜¯ç”¨ &lt;strong>â€œ;â€&lt;/strong> ç»“æŸçš„
ç®€å•è§£é‡Šä¸€ä¸‹&lt;/p>
&lt;p>&lt;code>http.HandleFunc(&amp;quot;/&amp;quot;,myResponse)&lt;/code> ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æ³¨å†ŒhttpæœåŠ¡çš„URLï¼Œè¿™é‡Œæˆ‘ä»¬å¡«å†™ &lt;code>&amp;quot;/&amp;quot;&lt;/code>, åœ¨è®¿é—®çš„æ—¶å€™ç›´æ¥ &lt;code>localhost:8888&lt;/code> å°±è¡Œäº†ï¼Œå¦‚æœå¡« &lt;code>&amp;quot;/test&amp;quot;&lt;/code> è®¿é—®çš„æ—¶å€™URLä¸º&lt;code>localhost/test:8888&amp;quot;&lt;/code>&lt;/p>
&lt;p>&lt;code>http.ListenAndServe(&amp;quot;127.0.0.1:8888&amp;quot;,nil)&lt;/code> ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯è¦ç›‘å¬çš„ipå’Œç«¯å£ï¼Œç¬¬äºŒä¸ªå¡« &lt;code>nil&lt;/code> å°±å¥½äº†&lt;/p>
&lt;p>ç„¶åç¼–è¯‘è¿è¡Œè¯•è¯•ï¼Œåœ¨æœ¬æœºä¸Šè¿è¡Œçš„ç¨‹åºç”¨é»˜è®¤çš„ç¼–è¯‘å‚æ•°å°±è¡Œ &lt;code>go build service.go&lt;/code>&lt;/p>
&lt;p>ç„¶åè¿è¡Œ &lt;code>./service &lt;/code>&lt;/p>
&lt;p>åœ¨æµè§ˆå™¨ä¸­è¾“å…¥URLï¼ŒæˆåŠŸè®¿é—®åˆ°
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-4c0593b18238d911.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-4c0593b18238d911.webp" alt="" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>ä¸‹ä¸€æ­¥æˆ‘ä»¬æŠŠè¿™ä¸ªç¨‹åºç§»æ¤åˆ°Androidä¸Šï¼ŒAndroidæ‰‹æœºå¿…é¡»è¦æœ‰rootæƒé™ï¼Œæ‰‹æœºæ²¡æœ‰rootï¼Œè€Œåˆä¸æƒ³rootçš„åŒå­¦å¯ä»¥ç”¨æ¨¡æ‹Ÿå™¨ï¼Œåªè¦CPUçš„æŒ‡ä»¤é›†å‚æ•°æ”¹ä¸€ä¸‹å°±è¡Œï¼Œå…ˆåœ¨æ‰‹æœºä¸Šè¿è¡Œä¸€ä¸‹ï¼Œæˆ‘çš„æ‰‹æœºæ˜¯è£è€€6ï¼ŒCPUæ˜¯æµ·æ€920ï¼Œç™¾åº¦åˆ°æµ·æ€920çš„æŒ‡ä»¤é›†æ˜¯arm32çš„ï¼Œå¥½çš„ï¼Œç¼–è¯‘ä¸€ä¸ª
åœ¨ç¼–è¯‘ä¹‹å‰æˆ‘ä»¬å…ˆä¿®æ”¹ä¸€ä¸‹åˆšæ‰ç¼–è¯‘çš„ç¨‹åºçš„å&lt;/p>
&lt;p>æ‰§è¡Œ &lt;code>GOOS=&amp;quot;linux&amp;quot; GOARCH=&amp;quot;arm&amp;quot; go build service.go&lt;/code>
å¾—åˆ°ä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ï¼Œç”¨ &lt;code>file&lt;/code> å‘½ä»¤çœ‹ä¸€ä¸‹ &lt;code>file service&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-txt" data-lang="txt">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>service: ELF 32-bit LSB executable, ARM, EABI5 version 1 (SYSV), statically linked, not stripped
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æˆ‘ä»¬çœ‹åˆ°è¿™ä¸ªæ–‡ä»¶æ˜¯ä¸€ä¸ª32ä½çš„armç¨‹åºã€‚okï¼Œå¤åˆ¶çš„Androidæ‰‹æœºä¸Šè¯•è¯•
éœ€è¦ç”¨åˆ°çš„è½¯ä»¶&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-dc97cda51f2b39f6.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-dc97cda51f2b39f6.webp" alt="Screenshot_2018-04-08-19-17-19.png" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>&lt;strong>â€œjuiceSSHâ€&lt;/strong> æ˜¯ç”¨æ¥æ¨¡æ‹ŸLinuxçš„shellå‘½ä»¤çš„ï¼Œ&lt;strong>â€œREæ–‡ä»¶ç®¡ç†å™¨â€&lt;/strong> ç”¨æ¥ä¿®æ”¹æ–‡ä»¶çš„æƒé™ï¼Œåœ¨Androidä¸Šchmodå‘½ä»¤ä¸èµ·ä½œç”¨ã€‚
å…ˆå¤åˆ¶åˆ°æ ¹ç›®å½•ï¼Œç„¶åä¿®æ”¹æ–‡ä»¶çš„æƒé™&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-96acccf703163537.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-96acccf703163537.webp" alt="Screenshot_2018-04-08-19-18-11.png" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-548b70e7f081aa8b.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-548b70e7f081aa8b.webp" alt="Screenshot_2018-04-08-19-18-20.png" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>ç„¶ååœ¨juiceSSHé‡Œè¿è¡Œï¼Œç„¶åå»æµè§ˆå™¨è¾“å…¥URLçœ‹çœ‹ï¼Œ&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-d12cd408edf34255.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-d12cd408edf34255.webp" alt="Screenshot_2018-04-08-19-19-43.png" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>æ²¡é—®é¢˜
æ¥ä¸‹æ¥ç¼–è¯‘ä¸€ä¸ªæ¨¡æ‹Ÿå™¨ä¸Šçš„ï¼Œæˆ‘ç”¨çš„genymotionï¼Œè¿è¡Œçš„æ˜¯Google nexus5æ‰‹æœºç³»ç»Ÿï¼Œæˆ‘ç™¾åº¦äº†ä¸€ä¸‹ï¼Œnexus5ç”¨çš„æ˜¯é«˜é€šéªé¾™800CPUï¼Œç„¶åå‘æ¥äº†ï¼Œéªé¾™800æ˜¯arm32çš„æŒ‡ä»¤é›†ï¼ŒæŒ‰ç†è¯´ç›´æ¥æŠŠé‚£ä¸ªç¨‹åºå¤åˆ¶è¿›å»å°±å¯ä»¥è¿è¡Œäº†ï¼Œä½†æ˜¯æç¤º &lt;code>/system/bin/sh: ./service_arm32: not executable: 32-bit ELF file&lt;/code>&lt;/p>
&lt;p>åæ¥æƒ³äº†æƒ³CPUç”¨çš„æ˜¯ç”µè„‘ä¸Šçš„ï¼Œé‚£ç¼–è¯‘æˆ &lt;code>X64&lt;/code> çš„è¯•è¯•ã€‚è¿˜æ˜¯ä¸è¡Œï¼Œæ¢æˆ &lt;code>X86&lt;/code> çš„è¯•è¯•ã€‚ç»ˆäºæˆåŠŸäº†ã€‚åŸæ¥æ˜¯æŒ‡ä»¤è¦ç”¨ç”µè„‘CPUçš„ï¼Œå¤šå°‘ä½éœ€è¦æ¨¡æ‹Ÿå™¨çš„ã€‚&lt;/p>
&lt;p>æ‰§è¡Œ &lt;code>GOOS=&amp;quot;linux&amp;quot; GOARCH=&amp;quot;386&amp;quot; go build service.go&lt;/code>&lt;/p>
&lt;p>å¤åˆ¶åˆ°æ¨¡æ‹Ÿå™¨ä¸­ï¼Œç„¶åè·Ÿåœ¨æ‰‹æœºä¸€æ ·ï¼Œå¤åˆ¶åˆ°æ ¹ç›®å½•ï¼Œæ·»åŠ æƒé™ã€‚ç„¶åç”¨adb shellè¿è¡Œï¼Œç„¶ååœ¨æ¨¡æ‹Ÿå™¨çš„æµè§ˆå™¨ä¸­å‘ç°å¯ä»¥è®¿é—®
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-75ff994585803468.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-75ff994585803468.webp" alt="genymotion" />
&lt;/a>
&lt;/div>
å¥½äº†ï¼Œæˆ‘ä»¬å·²ç»åœ¨Androidä¸Šè¿è¡Œä¸€ä¸ªhttpæœåŠ¡å™¨äº†ï¼Œæ˜¯ä¸æ˜¯æ¯”è¾ƒç®€å•&lt;/p></description></item><item><title>ä¿®æ”¹Ubuntuå’Œwin10åŒç³»ç»Ÿå¯åŠ¨é¡ºåº</title><link>https://lqxhub.github.io/posts/fcd83655/</link><pubDate>Sun, 25 Mar 2018 12:39:52 +0000</pubDate><guid>https://lqxhub.github.io/posts/fcd83655/</guid><description>&lt;p>å› ä¸ºæƒ³ç©Linuxï¼Œé‚è£…äº†Ubuntuå’Œwin10çš„åŒç³»ç»Ÿï¼Œå®‰è£…è¿˜å¥½ï¼Œä¸€åˆ‡é¡ºåˆ©ï¼Œä¸¤ä¸ªç³»ç»Ÿéƒ½èƒ½æ­£å¸¸å¯åŠ¨ï¼Œä½†æ˜¯æœ‰ä¸€ç‚¹è®©æˆ‘éå¸¸ä¸çˆ½ã€‚å°±æ˜¯å¯åŠ¨çš„æ—¶å€™Ubuntuæ˜¯é»˜è®¤å¯åŠ¨é¡¹ï¼Œå¼€ç”µè„‘ä¸€ä¸æ³¨æ„å°±è¿›Ubuntuäº†ã€‚é¢ï¼Œé‡å¯å§&amp;hellip;&amp;hellip;&lt;/p>
&lt;p>é»˜è®¤çš„å¯åŠ¨é¡¹é¡ºåº(å›¾ç‰‡æ˜¯æˆ‘ç›—çš„ï¼Œå› ä¸ºæˆ‘çš„å·²ç»æ”¹äº†)
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-7c02264608790c89.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-7c02264608790c89.webp" alt="grub" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>æœ‰æ²¡æœ‰åŠæ³•èƒ½æ”¹ä¸€ä¸‹å¯åŠ¨é¡ºåºå‘¢ï¼Ÿæ–¹æ³•å½“ç„¶æœ‰äº†ã€‚å› ä¸ºç”¨çš„æ˜¯grub2å¼•å¯¼ï¼Œæ‰€ä»¥ä¸Šç½‘æŸ¥äº†è¿™æ–¹é¢çš„èµ„æ–™ï¼Œæ²¡æ‰¾åˆ°åˆé€‚çš„ï¼Œè¦ä¸å°±æ˜¯grub1çš„èµ„æ–™ï¼Œè¦ä¸å°±æ˜¯æ²»æ ‡ä¸æ²»æœ¬ã€‚æ‰€ä»¥æœ¬ç€å¤§ä¸äº†é‡è£…ç³»ç»Ÿçš„å¿ƒæ€ï¼Œè‡ªå·±æ£é¼“&lt;/p>
&lt;h1 id="ç¬¬ä¸€ç§æ–¹æ³•åªæ›´æ”¹é»˜è®¤é€‰é¡¹">&lt;a href="#%e7%ac%ac%e4%b8%80%e7%a7%8d%e6%96%b9%e6%b3%95%e5%8f%aa%e6%9b%b4%e6%94%b9%e9%bb%98%e8%ae%a4%e9%80%89%e9%a1%b9" class="header-anchor">&lt;/a>ç¬¬ä¸€ç§æ–¹æ³•ï¼Œåªæ›´æ”¹é»˜è®¤é€‰é¡¹
&lt;/h1>&lt;blockquote>
&lt;p>é¦–å…ˆè¿›å…¥ &lt;em>/etc/default&lt;/em> ç›®å½•ï¼Œæ‰§è¡Œ&lt;code>sudo vim grub&lt;/code>
æ­£å¸¸çš„è¯ä½ çœ‹åˆ°çš„æ˜¯è¿™ä¸ª
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-23b903b0e3106d73.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-23b903b0e3106d73.webp" alt="grub.png" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;/blockquote>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-fallback" data-lang="fallback">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span> 6 GRUB_DEFAULT=&amp;#34;0&amp;#34;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span> 7 #GRUB_HIDDEN_TIMEOUT=&amp;#34;0&amp;#34;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3&lt;/span>&lt;span> 8 GRUB_HIDDEN_TIMEOUT_QUIET=&amp;#34;true&amp;#34;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4&lt;/span>&lt;span> 9 GRUB_TIMEOUT=&amp;#34;10&amp;#34;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5&lt;/span>&lt;span> 10 GRUB_DISTRIBUTOR=&amp;#34;`lsb_release -i -s 2&amp;gt; /dev/null || echo Debian`&amp;#34;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6&lt;/span>&lt;span> 11 GRUB_CMDLINE_LINUX_DEFAULT=&amp;#34;quiet splash&amp;#34;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7&lt;/span>&lt;span> 12 GRUB_CMDLINE_LINUX=&amp;#34;&amp;#34;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;blockquote>
&lt;p>è¿™æ˜¯æˆ‘ä»¬å…³æ³¨çš„å†…å®¹ï¼Œåªéœ€è¦æŠŠç¬¬6è¡Œçš„&lt;code>GRUB_DEFAULT=&amp;quot;0&amp;quot;&lt;/code>æ”¹æˆä½ æƒ³è¦é»˜è®¤é€‰ä¸­çš„åºå·å‡å»1å°±è¡Œï¼Œæ¯”å¦‚ç¬¬ä¸€å¼ å›¾ä¸­ï¼Œæƒ³è¦é»˜è®¤é€‰ä¸­&lt;code>Windows boot manger&lt;/code>ï¼Œä¿®æ”¹&lt;code>GRUB_DEFAULT=&amp;quot;2&amp;quot;&lt;/code>ä¿å­˜ï¼Œé€€å‡º
&lt;strong>ç„¶åæ‰§è¡Œå…³é”®çš„ä¸€æ­¥&lt;code>sudo update-grub&lt;/code>&lt;/strong>
è¿™æ ·ï¼Œä¸‹æ¬¡å¼€æœºçš„æ—¶å€™é»˜è®¤é€‰ä¸­çš„å¯åŠ¨é¡¹å°±æ˜¯Windowsäº†ã€‚&lt;/p>
&lt;/blockquote>
&lt;p>è¿™æ ·çš„æ“ä½œå¯¹äºæˆ‘è¿™ç§å¼ºè¿«ç—‡æ™šæœŸçš„äººæ¥è¯´æ˜¯ç»å¯¹ä¸èƒ½å¿çš„ã€‚å¿…é¡»æŠŠWindows boot manger æ”¾åˆ°ç¬¬ä¸€ä½ï¼Œä¸‹é¢å°±æ˜¯ç¬¬äºŒç§æ–¹æ³•&lt;/p>
&lt;h1 id="ç¬¬äºŒç§æ–¹æ³•å½»åº•è§£å†³">&lt;a href="#%e7%ac%ac%e4%ba%8c%e7%a7%8d%e6%96%b9%e6%b3%95%e5%bd%bb%e5%ba%95%e8%a7%a3%e5%86%b3" class="header-anchor">&lt;/a>ç¬¬äºŒç§æ–¹æ³•ï¼Œå½»åº•è§£å†³
&lt;/h1>&lt;blockquote>
&lt;p>é¦–å…ˆè¿›å…¥*/boot/grub&lt;em>ç›®å½•ï¼Œå…ˆæŠŠ&lt;/em>grub.cfgæ–‡ä»¶å¤åˆ¶ä¸€ä»½å‡ºæ¥ï¼Œä»¥å…æåäº†æ²¡æ³•æ¢å¤ã€‚&lt;em>ç„¶åæŸ¥çœ‹ &lt;em>grub.cfg&lt;/em>æ–‡ä»¶çš„è¯»å†™æƒé™ï¼Œé»˜è®¤æ˜¯åªè¯»çš„ã€‚å…ˆç»™&lt;/em>grub.cfg&lt;em>æ–‡ä»¶åŠ ä¸Šå¯å†™çš„æƒé™ã€‚
æ‰§è¡Œ&lt;code>sudo chmod u+w grub.cfg&lt;/code> è¿™æ ·èƒ½ä¿®æ”¹è¿™ä¸ªæ–‡ä»¶äº†ã€‚
ç„¶å&lt;code>sudo vim grub.cfg&lt;/code>æ‰“å¼€è¿™ä¸ªæ–‡ä»¶ã€‚ç„¶åä½ ä¼šå‘ç°è¿™ä¸ªæ–‡ä»¶æœ‰300å¤šè¡Œï¼Œè¿™æ€ä¹ˆä¿®æ”¹ï¼Œä¸è¦æ…Œåœ¨vimé‡Œæœç´¢&lt;/em>menuentry* (æœç´¢menuentryçš„å‘½ä»¤æ˜¯â€œ/menuentryâ€)
æˆ‘çš„åœ¨134è¡Œã€‚ä¸Šå›¾
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-1f808bc27f28213e.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-1f808bc27f28213e.webp" alt="menuenty.png" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;/blockquote>
&lt;p>è¿™æ—¶å€™å†å¾€ä¸‹æ‰¾ç›´åˆ°æ‰¾åˆ°&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#bd93f9">276&lt;/span> menuentry &lt;span style="color:#f1fa8c">&amp;#39;Windows Boot Manager (on /dev/sda1)&amp;#39;&lt;/span> &lt;span style="color:#ff79c6">--&lt;/span>&lt;span style="color:#ff79c6">class&lt;/span> windows &lt;span style="color:#ff79c6">--&lt;/span>&lt;span style="color:#ff79c6">class&lt;/span> os &lt;span style="color:#ff79c6">$&lt;/span>menuentry_id_option &lt;span style="color:#f1fa8c">&amp;#39;osprober-efi-78EE-BE29&amp;#39;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span>&lt;span style="color:#bd93f9">277&lt;/span> insmod part_gpt
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span>&lt;span style="color:#bd93f9">278&lt;/span> insmod fat
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span>&lt;span style="color:#bd93f9">279&lt;/span> set root&lt;span style="color:#ff79c6">=&lt;/span>&lt;span style="color:#f1fa8c">&amp;#39;hd0,gpt1&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span>&lt;span style="color:#bd93f9">280&lt;/span> &lt;span style="color:#ff79c6">if&lt;/span> [ x&lt;span style="color:#ff79c6">$&lt;/span>feature_platform_search_hint &lt;span style="color:#ff79c6">=&lt;/span> xy ]; then
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span>&lt;span style="color:#bd93f9">281&lt;/span> search &lt;span style="color:#ff79c6">--&lt;/span>no&lt;span style="color:#ff79c6">-&lt;/span>floppy &lt;span style="color:#ff79c6">--&lt;/span>fs&lt;span style="color:#ff79c6">-&lt;/span>uuid &lt;span style="color:#ff79c6">--&lt;/span>set&lt;span style="color:#ff79c6">=&lt;/span>root &lt;span style="color:#ff79c6">--&lt;/span>hint&lt;span style="color:#ff79c6">-&lt;/span>bios&lt;span style="color:#ff79c6">=&lt;/span>hd0,gpt1 &lt;span style="color:#ff79c6">--&lt;/span>hint&lt;span style="color:#ff79c6">-&lt;/span>efi&lt;span style="color:#ff79c6">=&lt;/span>hd0,gpt1 &lt;span style="color:#ff79c6">--&lt;/span>hint&lt;span style="color:#ff79c6">-&lt;/span>baremetal&lt;span style="color:#ff79c6">=&lt;/span>ahci0,gpt1 &lt;span style="color:#bd93f9">78&lt;/span>EE&lt;span style="color:#ff79c6">-&lt;/span>BE29
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span>&lt;span style="color:#bd93f9">282&lt;/span> &lt;span style="color:#ff79c6">else&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span>&lt;span style="color:#bd93f9">283&lt;/span> search &lt;span style="color:#ff79c6">--&lt;/span>no&lt;span style="color:#ff79c6">-&lt;/span>floppy &lt;span style="color:#ff79c6">--&lt;/span>fs&lt;span style="color:#ff79c6">-&lt;/span>uuid &lt;span style="color:#ff79c6">--&lt;/span>set&lt;span style="color:#ff79c6">=&lt;/span>root &lt;span style="color:#bd93f9">78&lt;/span>EE&lt;span style="color:#ff79c6">-&lt;/span>BE29
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span>&lt;span style="color:#bd93f9">284&lt;/span> fi
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span>&lt;span style="color:#bd93f9">285&lt;/span> chainloader &lt;span style="color:#ff79c6">/&lt;/span>EFI&lt;span style="color:#ff79c6">/&lt;/span>Microsoft&lt;span style="color:#ff79c6">/&lt;/span>Boot&lt;span style="color:#ff79c6">/&lt;/span>bootmgfw&lt;span style="color:#ff79c6">.&lt;/span>efi
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span>&lt;span style="color:#bd93f9">286&lt;/span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span>&lt;span style="color:#bd93f9">287&lt;/span> set timeout_style&lt;span style="color:#ff79c6">=&lt;/span>menu
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span>&lt;span style="color:#bd93f9">288&lt;/span> &lt;span style="color:#ff79c6">if&lt;/span> [ &lt;span style="color:#f1fa8c">&amp;#34;${timeout}&amp;#34;&lt;/span> &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span> ]; then
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span>&lt;span style="color:#bd93f9">289&lt;/span> set timeout&lt;span style="color:#ff79c6">=&lt;/span>&lt;span style="color:#bd93f9">10&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15&lt;/span>&lt;span>&lt;span style="color:#bd93f9">290&lt;/span> fi
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;blockquote>
&lt;p>ç„¶åæŠŠè¿™ä¸€æ®µå‰ªåˆ‡ï¼Œæ”¾åˆ°åˆšæ‰134é‚£ä¸ª&lt;em>menuentry&lt;/em>å‰è¾¹ã€‚è¿™æ—¶ä¿å­˜ï¼Œé€€å‡ºã€‚
OKï¼Œå®Œæˆäº†ï¼Œä¸‹æ¬¡å¼€æœºå°±ä¼šå‘ç°&lt;em>Windows boot manger&lt;/em> æˆä¸ºç¬¬ä¸€å¯åŠ¨é¡¹äº†&lt;/p>
&lt;/blockquote>
&lt;p>è¿™é‡Œ&lt;strong>åƒä¸‡ä¸è¦&lt;/strong> &lt;strong>åƒä¸‡ä¸è¦&lt;/strong> &lt;strong>åƒä¸‡ä¸è¦&lt;/strong> æ‰§è¡Œ&lt;code>sudo update-grub&lt;/code>&lt;/p>
&lt;p>ä¸‹æ¬¡å¼€æœºå°±æ˜¯è¿™æ ·äº†
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-293181890a273082.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-293181890a273082.webp" alt="ä¿®æ”¹åçš„grub" />
&lt;/a>
&lt;/div>
&lt;/p></description></item><item><title>èŠ±å¼ä½¿ç”¨C/C++çš„æŒ‡é’ˆ</title><link>https://lqxhub.github.io/posts/4835beb2/</link><pubDate>Thu, 09 Nov 2017 17:10:42 +0000</pubDate><guid>https://lqxhub.github.io/posts/4835beb2/</guid><description>&lt;p>æŒ‡é’ˆæ— ç–‘æ˜¯C/C++è¯­è¨€çš„ç²¾é«“æ‰€åœ¨ï¼Œç”¨å¥½äº†æ˜¯æŠŠåˆ©å‰‘ï¼Œç”¨ä¸å¥½å°±æ˜¯ä¸€é¢—ç‚¸å¼¹ã€‚æŒ‡é’ˆå‡ºBUGäº†ï¼Œåˆ†åˆ†é’Ÿä¼šè®©ä½ å†™ç¨‹åºå´©æºƒ
ä»Šå¤©è¢«C++çš„æŒ‡é’ˆææ··äº†ï¼Œç¿»é˜…äº†å¾ˆå¤šèµ„æ–™ï¼Œæœ‰ç‚¹æ‡‚äº†ã€‚èµ¶å¿«æ¥åšä¸€ä¸‹ç¬”è®°ã€‚&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-379c50271ecccde6.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-379c50271ecccde6.webp" alt="" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>å…ˆæ¥ä½¿ç”¨ä¸€ä¸ªæœ€ç®€å•çš„æŒ‡é’ˆ&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c++" data-lang="c++">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span> &lt;span style="color:#8be9fd">int&lt;/span> a &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#bd93f9">10&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span> &lt;span style="color:#8be9fd">int&lt;/span> &lt;span style="color:#ff79c6">*&lt;/span>p&lt;span style="color:#ff79c6">=&amp;amp;&lt;/span>a;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™ä¸ªæ²¡å•¥éš¾åº¦ä¸ä¼šå‡ºé”™ï¼Œæ¥ä¸‹æ¥æ¥ä¸ªéš¾ç‚¹çš„&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c++" data-lang="c++">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span> &lt;span style="color:#8be9fd">int&lt;/span> a &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#bd93f9">10&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span> &lt;span style="color:#8be9fd">int&lt;/span> &lt;span style="color:#ff79c6">*&lt;/span>p &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#ff79c6">&amp;amp;&lt;/span>a;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3&lt;/span>&lt;span> &lt;span style="color:#8be9fd">int&lt;/span> &lt;span style="color:#ff79c6">**&lt;/span>p1 &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#ff79c6">&amp;amp;&lt;/span>p;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™ä¸ª&lt;strong>æŒ‡é’ˆçš„æŒ‡é’ˆ&lt;/strong>æ˜¯ä¸æ˜¯å·²ç»å¤´çš®å‘éº»äº†ï¼Œåˆ«æ€¥ï¼Œè¿˜æœ‰æ›´å˜æ€çš„â€”â€”&lt;strong>æŒ‡é’ˆæ•°ç»„&lt;/strong>ï¼Œ&lt;strong>æ•°ç»„æŒ‡é’ˆ&lt;/strong>ï¼Œ&lt;strong>å‡½æ•°æŒ‡é’ˆ&lt;/strong>ï¼Œ&lt;strong>æŒ‡é’ˆå‡½æ•°&lt;/strong>ã€‚è¿™å›æ˜¯ä¸æ˜¯å½»åº•æ‡µäº†ã€‚
ç°åœ¨å°±å¼€å§‹ä¸€ä¸ªä¸ªä½¿ç”¨è¿™äº›æŒ‡é’ˆ
é¦–å…ˆè¦æ˜ç¡®ä¸€ç‚¹ï¼ŒæŒ‡é’ˆæ•°ç»„å’Œæ•°ç»„æŒ‡é’ˆä¸æ˜¯ä¸€ä¸ªæ¦‚å¿µ&lt;/p>
&lt;p>&lt;code>int *p3[10];&lt;/code> è¿™å°±å®šä¹‰äº†ä¸€ä¸ªæŒ‡é’ˆæ•°ç»„ï¼Œ &lt;strong>[]&lt;/strong> ä¼˜å…ˆçº§é«˜ï¼Œå…ˆä¸pç»“åˆæˆä¸ºä¸€ä¸ªæ•°ç»„ï¼Œå†ç”±int*è¯´æ˜è¿™æ˜¯ä¸€ä¸ªæ•´å‹æŒ‡é’ˆæ•°ç»„ï¼Œå®ƒæœ‰10ä¸ªæŒ‡é’ˆç±»å‹çš„æ•°ç»„å…ƒç´ &lt;/p>
&lt;hr>
&lt;p>&lt;code>int (*p4)[10];&lt;/code>
è¿™æ˜¯ä¸€ä¸ªæ•°ç»„æŒ‡é’ˆï¼Œå› ä¸º()ä¼˜å…ˆçº§é«˜ï¼Œé¦–å…ˆè¯´æ˜pæ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼ŒæŒ‡å‘ä¸€ä¸ªæ•´å‹çš„ä¸€ç»´æ•°ç»„ï¼Œè¿™ä¸ªä¸€ç»´æ•°ç»„çš„é•¿åº¦æ˜¯10&lt;/p>
&lt;p>&lt;code>int* fun(int a);&lt;/code>
è¿™æ ·å°±å£°æ˜äº†ä¸€ ä¸ªæŒ‡é’ˆå‡½æ•°ï¼Œå°±æ˜¯è¿”å›æŒ‡é’ˆçš„å‡½æ•°ï¼Œå‡½æ•°å¯ä»¥ä¸è¿”å›ä»»ä½•å€¼ï¼Œä¹Ÿå¯ä»¥è¿”å›æ•´å‹å€¼ï¼Œå®å‹å€¼ï¼Œå­—ç¬¦å‹å€¼ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥è¿”å›æŒ‡é’ˆå€¼ã€‚å‡½æ•°funéœ€è¦åœ¨å‡½æ•°ä½“ä¸­è¿”å›ä¸€ä¸ªintå‹çš„æŒ‡é’ˆã€‚&lt;/p>
&lt;p>&lt;code>int (*fun)(int a);&lt;/code>
è¿™æ ·å°±å®šä¹‰äº†ä¸€ä¸ªæŒ‡å‘å‡½æ•°çš„æŒ‡é’ˆï¼Œå¯ä»¥é€šè¿‡è¿™ä¸ªæŒ‡é’ˆæ¥è°ƒç”¨å‡½æ•°ï¼Œæ³¨æ„ï¼Œè¿™ä¸ªæŒ‡é’ˆä¸èƒ½æŒ‡å‘ä»»æ„çš„å‡½æ•°ï¼Œåªèƒ½æŒ‡å‘è¿”å›å€¼æ˜¯intï¼Œå¹¶ä¸”åªæœ‰ä¸€ä¸ªå½¢å‚çš„å‡½æ•°ã€‚
è¿™äº›éƒ½æ˜¯Cä¸­æŒ‡é’ˆçš„ä½¿ç”¨ï¼Œåˆ°äº†C++ä¸­ï¼ŒæŒ‡é’ˆé‡åˆ°ç±»å’Œå¯¹è±¡ï¼Œé‡åˆ°newå’Œdeleteè¿™ä¸¤ä¸ªè¿ç®—ç¬¦ï¼Œç¨æœ‰ä¸æ…å°±ä¼šå†…å­˜æ³„æ¼ã€‚
è¯´äº†è¿™ä¹ˆå¤šï¼Œç°åœ¨å¼€å§‹ç ”ç©¶C++ä¸­æŒ‡é’ˆçš„ä½¿ç”¨é—®é¢˜
å…ˆæ¥æ–°å»ºä¸€ä¸ªTestç±»
&lt;strong>Test.h&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c++" data-lang="c++">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">#pragma once
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span>&lt;span style="color:#ff79c6">&lt;/span>&lt;span style="color:#ff79c6">class&lt;/span> &lt;span style="color:#50fa7b">Test&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3&lt;/span>&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4&lt;/span>&lt;span>&lt;span style="color:#ff79c6">public&lt;/span>&lt;span style="color:#ff79c6">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5&lt;/span>&lt;span> Test();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6&lt;/span>&lt;span> Test(&lt;span style="color:#8be9fd">int&lt;/span> _a);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7&lt;/span>&lt;span> &lt;span style="color:#ff79c6">~&lt;/span>Test();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8&lt;/span>&lt;span> &lt;span style="color:#8be9fd">int&lt;/span> a;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">9&lt;/span>&lt;span>};
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>Test.cpp&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c++" data-lang="c++">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">#include&lt;/span> &lt;span style="color:#ff79c6">&amp;#34;stdafx.h&amp;#34;&lt;/span>&lt;span style="color:#ff79c6">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span>&lt;span style="color:#ff79c6">#include&lt;/span> &lt;span style="color:#ff79c6">&amp;#34;Test.h&amp;#34;&lt;/span>&lt;span style="color:#ff79c6">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span>&lt;span style="color:#ff79c6">#include&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;iostream&amp;gt;&lt;/span>&lt;span style="color:#ff79c6">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span>&lt;span style="color:#ff79c6">&lt;/span>&lt;span style="color:#ff79c6">using&lt;/span> std&lt;span style="color:#ff79c6">::&lt;/span>cout;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span>&lt;span style="color:#ff79c6">using&lt;/span> std&lt;span style="color:#ff79c6">::&lt;/span>endl;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span>Test&lt;span style="color:#ff79c6">::&lt;/span>Test()&lt;span style="color:#ff79c6">:&lt;/span>Test(&lt;span style="color:#bd93f9">0&lt;/span>)&lt;span style="color:#6272a4">//å§”æ‰˜æ„é€ å‡½æ•°
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span> cout &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;è°ƒç”¨å§”æ‰˜æ„é€ å‡½æ•°ç»™aèµ‹å€¼ 0&amp;#34;&lt;/span>&lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span>endl;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span>Test&lt;span style="color:#ff79c6">::&lt;/span>Test(&lt;span style="color:#8be9fd">int&lt;/span> _a&lt;span style="color:#ff79c6">=&lt;/span>&lt;span style="color:#bd93f9">10&lt;/span>)&lt;span style="color:#ff79c6">:&lt;/span>a(_a)&lt;span style="color:#6272a4">//æ„é€ åˆå§‹åŒ–,å½¢å‚é»˜è®¤å€¼=10
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15&lt;/span>&lt;span> cout &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;call function Test(int _a) &amp;#34;&lt;/span>&lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span>endl;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19&lt;/span>&lt;span>Test&lt;span style="color:#ff79c6">::~&lt;/span>Test()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20&lt;/span>&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21&lt;/span>&lt;span> cout &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;delete Test &amp;#34;&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> a &lt;span style="color:#ff79c6">&amp;lt;&amp;lt;&lt;/span> endl;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>main.cpp&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c++" data-lang="c++">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#6272a4">// main.cpp: å®šä¹‰æ§åˆ¶å°åº”ç”¨ç¨‹åºçš„å…¥å£ç‚¹ã€‚
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span>&lt;span style="color:#6272a4">//
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span>&lt;span style="color:#ff79c6">#include&lt;/span> &lt;span style="color:#ff79c6">&amp;#34;stdafx.h&amp;#34;&lt;/span>&lt;span style="color:#ff79c6">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span>&lt;span style="color:#ff79c6">#include&lt;/span> &lt;span style="color:#ff79c6">&amp;#34;Test.h&amp;#34;&lt;/span>&lt;span style="color:#ff79c6">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span>&lt;span style="color:#ff79c6">#include&lt;/span> &lt;span style="color:#ff79c6">&amp;lt;stdlib.h&amp;gt;&lt;/span>&lt;span style="color:#ff79c6">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span>&lt;span style="color:#ff79c6">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span>&lt;span style="color:#8be9fd">int&lt;/span> &lt;span style="color:#50fa7b">main&lt;/span>()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span> &lt;span style="color:#6272a4">/*1
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span>&lt;span style="color:#6272a4"> åˆ›å»ºTestçš„å®ä¾‹ï¼ŒæŒ‡é’ˆt1æŒ‡å‘å®ä¾‹*/&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span> Test &lt;span style="color:#ff79c6">*&lt;/span>t1 &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#ff79c6">new&lt;/span> Test(&lt;span style="color:#bd93f9">6&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span> &lt;span style="color:#ff79c6">delete&lt;/span> t1;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15&lt;/span>&lt;span> t1 &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#ff79c6">nullptr&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18&lt;/span>&lt;span> &lt;span style="color:#6272a4">/*2
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19&lt;/span>&lt;span>&lt;span style="color:#6272a4"> åˆ›å»º3ä¸ªtestå®ä¾‹æ•°ç»„ æŒ‡é’ˆt2æŒ‡å‘æ•°ç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´ ,
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20&lt;/span>&lt;span>&lt;span style="color:#6272a4"> æ­¤æ—¶åªèƒ½è°ƒç”¨Testç±»çš„æ— å‚æ„é€ å‡½æ•°*/&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21&lt;/span>&lt;span> Test &lt;span style="color:#ff79c6">*&lt;/span>t2 &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#ff79c6">new&lt;/span> Test[&lt;span style="color:#bd93f9">3&lt;/span>];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23&lt;/span>&lt;span> &lt;span style="color:#ff79c6">delete&lt;/span>[] t2;&lt;span style="color:#6272a4">//é‡Šæ”¾ testçš„ä¸‰ä¸ªå®ä¾‹
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span> t2 &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#ff79c6">nullptr&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26&lt;/span>&lt;span> &lt;span style="color:#6272a4">/*3
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27&lt;/span>&lt;span>&lt;span style="color:#6272a4"> åœ¨å †ä¸­åˆ›å»º3ä¸ªï¼ˆTestï¼‰ç±»å‹çš„æŒ‡é’ˆæ•°ç»„ï¼Œt3æŒ‡å‘è¿™ä¸ªæ•°ç»„ï¼›*/&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28&lt;/span>&lt;span> Test&lt;span style="color:#ff79c6">*&lt;/span> &lt;span style="color:#ff79c6">*&lt;/span>t3 &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#ff79c6">new&lt;/span> Test&lt;span style="color:#ff79c6">*&lt;/span>[&lt;span style="color:#bd93f9">3&lt;/span>];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29&lt;/span>&lt;span> &lt;span style="color:#ff79c6">for&lt;/span> (&lt;span style="color:#8be9fd">int&lt;/span> i &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>; i &lt;span style="color:#ff79c6">&amp;lt;&lt;/span> &lt;span style="color:#bd93f9">3&lt;/span>; i&lt;span style="color:#ff79c6">++&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30&lt;/span>&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31&lt;/span>&lt;span> &lt;span style="color:#6272a4">/*åˆ›å»º3ä¸ªTestçš„å®ä¾‹ï¼Œè®©t3æ•°ç»„ä¸­çš„å…ƒç´ ï¼ˆæŒ‡é’ˆï¼‰æŒ‡å‘åˆ›å»ºçš„å¯¹è±¡*/&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32&lt;/span>&lt;span> t3[i] &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#ff79c6">new&lt;/span> Test(i &lt;span style="color:#ff79c6">+&lt;/span> &lt;span style="color:#bd93f9">10&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35&lt;/span>&lt;span> &lt;span style="color:#ff79c6">for&lt;/span> (&lt;span style="color:#8be9fd">int&lt;/span> i &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>; i &lt;span style="color:#ff79c6">&amp;lt;&lt;/span> &lt;span style="color:#bd93f9">3&lt;/span>; i&lt;span style="color:#ff79c6">++&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36&lt;/span>&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37&lt;/span>&lt;span> &lt;span style="color:#6272a4">/*é‡Šæ”¾ åœ¨å †ä¸­åˆ›å»ºçš„ä¸‰ä¸ªTestçš„å®ä¾‹*/&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38&lt;/span>&lt;span> &lt;span style="color:#ff79c6">delete&lt;/span> t3[i];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41&lt;/span>&lt;span> &lt;span style="color:#ff79c6">delete&lt;/span>[] t3;&lt;span style="color:#6272a4">//é‡Šæ”¾åŠ¨æ€åˆ›å»ºçš„æŒ‡å‘Testå®ä¾‹çš„æŒ‡é’ˆæ•°ç»„
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42&lt;/span>&lt;span>&lt;span style="color:#6272a4">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44&lt;/span>&lt;span> system(&lt;span style="color:#f1fa8c">&amp;#34;pause&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45&lt;/span>&lt;span> &lt;span style="color:#ff79c6">return&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å…ˆæ¥å¼€ä¸€ä¸‹æœ€ç®€å•çš„ä¸€ç§å¯¹è±¡æŒ‡é’ˆ&lt;code>Test *t1 = new Test(6);&lt;/code> è¿™æ—¶å®šä¹‰äº†ä¸€ä¸ªTestç±»å‹çš„æŒ‡é’ˆt1ï¼Œå¹¶è®©è¿™ä¸ªæŒ‡é’ˆæŒ‡å‘ä»å †ä¸­ç”³è¯·çš„å†…å­˜ï¼ˆTestçš„å®ä¾‹ï¼‰è¿è¡Œä»¥ä¸‹çœ‹çœ‹&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-7017480d4350e17f.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-7017480d4350e17f.webp" alt="1" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>æ²¡æ„å¤–ï¼ŒTestçš„å®ä¾‹æ­£å¸¸åˆ›å»ºï¼Œæ­£å¸¸é‡Šæ”¾äº†ã€‚
å†æ¥çœ‹ä¸€ä¸‹ç¬¬äºŒç§æƒ…å†µ&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c++" data-lang="c++">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1&lt;/span>&lt;span>Test &lt;span style="color:#ff79c6">*&lt;/span>t2 &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#ff79c6">new&lt;/span> Test[&lt;span style="color:#bd93f9">3&lt;/span>];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3&lt;/span>&lt;span>&lt;span style="color:#ff79c6">delete&lt;/span>[] t2;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ç°åœ¨å®šä¹‰äº†ä¸€ä¸ªTestçš„æŒ‡é’ˆt2ï¼Œå¹¶ä¸”åœ¨å †ä¸­åˆ›å»ºäº†3ä¸ªTestçš„å®ä¾‹ï¼Œæ”¾åœ¨ä¸€ä¸ªæ•°ç»„ä¸­ï¼ŒæŒ‡é’ˆt2æŒ‡å‘äº†è¿™ä¸ªæ•°ç»„ã€‚è¿è¡Œçœ‹ä¸€ä¸‹
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-de19b311faff18ae.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-de19b311faff18ae.webp" alt="2" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>è¿™æ—¶æœ‰ä¸€ç‚¹è¦æ³¨æ„ä¸€ä¸‹ï¼Œè¿™æ ·newåˆ›å»ºå¯¹è±¡æ—¶åªèƒ½è°ƒç”¨Testç±»çš„é»˜è®¤æ— å‚æ„é€ å‡½æ•°ï¼Œå…¶ä»–çš„å‡½æ•°ä¸èƒ½è°ƒç”¨ã€‚æˆ‘ä»¬ä¸ºäº†ç»™aèµ‹å€¼ï¼Œä½¿ç”¨äº†å§”æ‰˜æ„é€ å‡½æ•°ï¼ˆä¸å¤ªç†Ÿæ‚‰çš„åŒå­¦å¯ä»¥å¿½ç•¥ï¼‰ï¼Œä»æ‰“å°çš„ç»“æœæ¥çœ‹ï¼Œç¨‹åºæ­£å¸¸åˆ›å»ºäº†Testçš„å®ä¾‹ï¼Œä¹Ÿæ­£å¸¸é‡Šæ”¾å†…å­˜ã€‚
ç°åœ¨æ¥çœ‹ä¸€ä¸‹æœ€å¤æ‚çš„ä¸€ç§æƒ…å†µ&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c++" data-lang="c++">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#6272a4">/*3
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span>&lt;span style="color:#6272a4">åœ¨å †ä¸­åˆ›å»º3ä¸ªï¼ˆTestï¼‰ç±»å‹çš„æŒ‡é’ˆæ•°ç»„ï¼Œt3æŒ‡å‘è¿™ä¸ªæ•°ç»„ï¼›*/&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span>Test&lt;span style="color:#ff79c6">*&lt;/span> &lt;span style="color:#ff79c6">*&lt;/span>t3 &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#ff79c6">new&lt;/span> Test&lt;span style="color:#ff79c6">*&lt;/span>[&lt;span style="color:#bd93f9">3&lt;/span>];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span> &lt;span style="color:#ff79c6">for&lt;/span> (&lt;span style="color:#8be9fd">int&lt;/span> i &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>; i &lt;span style="color:#ff79c6">&amp;lt;&lt;/span> &lt;span style="color:#bd93f9">3&lt;/span>; i&lt;span style="color:#ff79c6">++&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span> &lt;span style="color:#6272a4">/*åˆ›å»º3ä¸ªTestçš„å®ä¾‹ï¼Œè®©t3æ•°ç»„ä¸­çš„å…ƒç´ ï¼ˆæŒ‡é’ˆï¼‰æŒ‡å‘åˆ›å»ºçš„å¯¹è±¡*/&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span> t3[i] &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#ff79c6">new&lt;/span> Test(i &lt;span style="color:#ff79c6">+&lt;/span> &lt;span style="color:#bd93f9">10&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span> &lt;span style="color:#ff79c6">for&lt;/span> (&lt;span style="color:#8be9fd">int&lt;/span> i &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#bd93f9">0&lt;/span>; i &lt;span style="color:#ff79c6">&amp;lt;&lt;/span> &lt;span style="color:#bd93f9">3&lt;/span>; i&lt;span style="color:#ff79c6">++&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span> &lt;span style="color:#6272a4">/*é‡Šæ”¾ åœ¨å †ä¸­åˆ›å»ºçš„ä¸‰ä¸ªTestçš„å®ä¾‹*/&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span> &lt;span style="color:#ff79c6">delete&lt;/span> t3[i];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16&lt;/span>&lt;span> &lt;span style="color:#ff79c6">delete&lt;/span>[] t3;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æ˜¯ä¸æ˜¯å·²ç»æ™•å€’åœ¨ç”µè„‘å‰äº†0.0 Â  Â  è«æ…Œ,å…ˆçœ‹ä¸€ä¸‹è¿è¡Œç»“æœ
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-0f144e7a69844359.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-0f144e7a69844359.webp" alt="3" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>ä¸€æ­¥æ­¥æ¥åˆ†æä»¥ä¸‹ä»£ç ï¼Œé¦–å…ˆçœ‹ä¸€ä¸‹&lt;code>Test* *t3 = new Test*[3];&lt;/code>t3æ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼Œå®ƒæŒ‡å‘äº†å †ä¸­çš„ä¸€ä¸ªæ•°ç»„ï¼Œè¿™ä¸ªæ•°ç»„çš„ç±»å‹æ˜¯&lt;code>Test*&lt;/code>çš„ã€‚&lt;code> new Test*[3]&lt;/code>åœ¨å †å†…å­˜ä¸­åˆ›å»ºäº†ä¸€ä¸ªé•¿åº¦ä¸º3çš„&lt;code>Test*&lt;/code>çš„æ•°ç»„ã€‚é‡ç‚¹&lt;strong>t3æŒ‡å‘çš„æ˜¯å †ä¸­çš„ä¸€ä¸ªæ•°ç»„&lt;/strong>
ç¬¬ä¸€ä¸ªforå¾ªç¯ä¸­çš„&lt;code>t3[i] = new Test(i + 10);&lt;/code>æ˜¯ç»™&lt;code>t3&lt;/code>æ‰€æŒ‡å‘çš„æ•°ç»„ä¸­çš„å…ƒç´ èµ‹å€¼ï¼Œå› ä¸ºæ•°ç»„æ˜¯&lt;code>Test*&lt;/code>ç±»å‹çš„ï¼Œæ‰€ä»¥å¯ä»¥æŒ‡å‘Testç±»çš„å®ä¾‹ã€‚
ç¬¬äºŒä¸ªforå¾ªç¯ä¸­&lt;code>delete t3[i];&lt;/code>æ˜¯æŠŠåœ¨å †å†…å­˜ä¸­åˆ›å»ºçš„Test ç±»çš„å®ä¾‹é‡Šæ”¾ã€‚å› ä¸º&lt;code>t3[i]&lt;/code>æ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼Œè€Œä¸”æ˜¯æŒ‡é’ˆæ•°ç»„ï¼Œä¹Ÿå°±æ˜¯è¯´&lt;code>t3[i]&lt;/code>ï¼Œæ˜¯&lt;code>t3&lt;/code>æŒ‡é’ˆæŒ‡å‘çš„æ•°ç»„ï¼ˆåœ¨å †å†…å­˜ä¸­ï¼‰çš„ä¸€ä¸ªå…ƒç´ ï¼Œæ‰€ä»¥è¦æŠŠ&lt;code>t3&lt;/code>æŒ‡å‘çš„æ•°ç»„é‡Šæ”¾&lt;code>delete[] t3;&lt;/code>&lt;/p>
&lt;p>å¥½äº†å…ˆæ€»ç»“åˆ°è¿™å§ã€‚é¡¹ç›®æˆ‘å·²ç»ä¸Šä¼ åˆ°&lt;strong>ç äº‘&lt;/strong>ï¼Œéœ€è¦çš„å¯ä»¥&lt;a class="link" href="https://gitee.com/bruce_le/111" target="_blank" rel="noopener"
>ä¸‹è½½&lt;/a>ã€‚&lt;/p></description></item><item><title>Android NDKå¼€å‘ä¹‹ç¯å¢ƒæ­å»º</title><link>https://lqxhub.github.io/posts/ddb43708/</link><pubDate>Sun, 10 Sep 2017 19:03:48 +0000</pubDate><guid>https://lqxhub.github.io/posts/ddb43708/</guid><description>&lt;p>å·¥æ¬²å–„å…¶äº‹ï¼Œå¿…å…ˆåˆ©å…¶å™¨ã€‚è¦æƒ³è¿›è¡ŒAndroid NDKå¼€å‘é¦–å…ˆæˆ‘ä»¬è½½NDKçš„å¼€å‘åŒ…ï¼Œé…ç½®NDKå¼€å‘ç¯å¢ƒï¼Œå°±åƒé…ç½®SDKå·®ä¸å¤šã€‚é…ç½®NDKç¯å¢ƒçš„æ–¹æ³•æœ‰å¾ˆå¤šï¼Œå¯ä»¥å»å®˜ç½‘ä¸‹è½½ï¼Œä¹Ÿå¯ä»¥ç”¨SDK mangerä¸‹è½½å®‰è£…ï¼Œè¿˜å¯ä»¥ç”¨Androidstudioçš„SDKç®¡ç†ä¸‹è½½ã€‚&lt;/p>
&lt;p>ä¸‹å›¾æ˜¯åœ¨ASä¸‹å®‰è£…NDK
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-733e2ec04c671b84.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-733e2ec04c671b84.webp" alt="NDKä¸‹è½½" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>çº¢è‰²æ ‡è®°çš„é€‰é¡¹ï¼Œå¯èƒ½æ’åˆ—çš„é¡ºåºä¸åŒï¼Œæ‰¾åˆ°ç„¶åå‹¾é€‰ï¼Œç‚¹å‡»OKï¼Œç­‰å¾…ä¸‹è½½å®Œæˆã€‚è¯´ä¸€ä¸‹è¿™ä¸‰ä¸ªå·¥å…·æ˜¯å¹²å•¥çš„å§ã€‚&lt;/p>
&lt;ul>
&lt;li>CMakeæ˜¯ä¸€ä¸ªè·¨å¹³å°çš„ç¼–è¯‘å·¥å…·ï¼Œå¯ä»¥ç”¨ç®€å•çš„è¯­å¥æ¥æè¿°æ‰€æœ‰å¹³å°çš„ç¼–è¯‘è¿‡ç¨‹ã€‚&lt;/li>
&lt;li>LLDBæ˜¯ç”¨æ¥è°ƒè¯•C++ä»£ç çš„å·¥å…·&lt;/li>
&lt;li>NDk ä¸ç”¨å¤šè¯´äº†ï¼Œç”¨æ¥ç¼–è¯‘å’Œæ‰“åŒ…C++çš„ä¸€æ•´å¥—å·¥å…·&lt;/li>
&lt;/ul>
&lt;p>è¿™é‡Œè¦è¯´ä¸€ä¸ªå‘ï¼ŒASçš„ä¸‹è½½æ˜¯ä¸æ”¯æŒæ–­ç‚¹çš„ï¼Œä¸€å®šè¦åœ¨è‰¯å¥½çš„ç½‘ç»œç¯å¢ƒä¸‹è½½ï¼Œè¦ä¸ç„¶ã€‚ã€‚ã€‚ã€‚è¯´å¤šäº†éƒ½æ˜¯æ³ªï¼Œè®©æ ¡å›­ç½‘å®³è‹¦äº†ï¼Œæœ€åç”¨ä¸‹è½½å·¥å…·ä¸‹è½½çš„å‹ç¼©åŒ…ã€‚ç½‘ç»œä¸å¥½çš„æƒ…å†µä¸‹å¯ä»¥æŠŠä¸‹è½½é“¾æ¥æå–å‡ºæ¥ï¼Œç”¨ä¸‹è½½å·¥å…·ä¸‹è½½ï¼Œè¿™æ ·å°±ä¸æ€•æ–­ç½‘äº†ã€‚ ASä¸‹è½½å®Œæˆä¼šè‡ªåŠ¨è§£å‹ï¼Œè‡ªå·±ä¸‹è½½çš„è¦è§£å‹åˆ°SDKçš„ç›®å½•ä¸‹ï¼Œæ–°å»ºndk-bundleæ–‡ä»¶å¤¹ã€‚åªè¦settingä¸­çš„SDKToolsä¸‹è¿™ä¸‰é¡¹æ‰“é’©äº†å°±è¯´æ˜ç¯å¢ƒæ­å»ºæˆåŠŸäº†ã€‚&lt;/p>
&lt;blockquote>
&lt;p>Linux NDKå‹ç¼©åŒ…ä¸‹è½½åœ°å€ &lt;a class="link" href="https://dl.google.com/android/repository/android-ndk-r15c-linux-x86_64.zip" target="_blank" rel="noopener"
>https://dl.google.com/android/repository/android-ndk-r15c-linux-x86_64.zip&lt;/a>&lt;/p>
&lt;/blockquote>
&lt;p>æˆ‘ç”¨çš„æ˜¯Ubuntuç³»ç»Ÿï¼Œæ²¡æ‰¾åˆ°SDK mangerï¼Œå°±ä¸ä»‹ç»äº†ï¼Œæˆ‘è®°å¾—Windowsé‡Œæœ‰è¿™ä¸ªä¸œè¥¿ï¼Œç•Œé¢å’Œasé‡Œå·®ä¸å¤šï¼Œå¤§åŒå°å¼‚ã€‚
è¿˜æœ‰å°±æ˜¯å»å®˜ç½‘&lt;a class="link" href="https://developer.android.google.cn/ndk/downloads/index.html" target="_blank" rel="noopener"
>ä¸‹è½½&lt;/a>ï¼Œé€‰æ‹©é€‚åˆè‡ªå·±ç³»ç»Ÿçš„ç‰ˆæœ¬ä¸‹è½½ï¼Œç„¶åè§£å‹åˆ°æŒ‡å®šç›®å½•å°±è¡Œäº†
ç½‘é€Ÿå¥½çš„è¯è¿˜æ˜¯æ¨èä½¿ç”¨ASå»å®‰è£…NDKï¼Œæ¯•ç«Ÿç®€å•ï¼Œä¸‹è½½å®Œæˆä¼šè‡ªå·±è§£å‹åˆ°æŒ‡å®šç›®å½•ã€‚è‡ªå·±ä¸‹è½½å‹ç¼©åŒ…å¦‚æœæ²¡æœ‰è§£å‹åˆ°æŒ‡å®šç›®å½•æ˜¯æ— æ³•ä½¿ç”¨çš„ã€‚
ç­‰ä¸€åˆ‡éƒ½å¼„å¥½ä»¥åï¼Œæ‰“å¼€ç•Œé¢çœ‹åˆ°&lt;em>&lt;strong>CMake&lt;/strong>&lt;/em>ï¼Œ&lt;em>&lt;strong>LLDB&lt;/strong>&lt;/em> ï¼Œ&lt;em>&lt;strong>NDK&lt;/strong>&lt;/em>éƒ½å‹¾é€‰äº†å°±è¯´æ˜é…ç½®æˆåŠŸäº†ã€‚
è¿˜æœ‰å°±æ˜¯&lt;em>&lt;strong>CMake&lt;/strong>&lt;/em>ï¼Œ&lt;em>&lt;strong>LLDB&lt;/strong>&lt;/em> åªèƒ½é€šè¿‡ASä¸‹è½½ï¼Œåˆ«çš„è¿˜æ²¡æ‰¾åˆ°ï¼Œè¿™ä¸¤ä¸ªæ¯”è¾ƒå°ï¼Œå¾ˆå¿«å°±ä¸‹å®Œäº†ã€‚&lt;/p>
&lt;p>åˆ°æ­¤ç¯å¢ƒæ­å»ºå°±ç®—å®Œæˆäº†ã€‚&lt;/p></description></item><item><title>è‡ªå®šä¹‰å±æ€§</title><link>https://lqxhub.github.io/posts/25a04712/</link><pubDate>Wed, 08 Mar 2017 18:27:24 +0000</pubDate><guid>https://lqxhub.github.io/posts/25a04712/</guid><description>&lt;p>è¿™ä¸¤å¤©åœ¨Androidä¸­ç”¨åˆ°äº†è‡ªå®šä¹‰viewï¼Œåœ¨è‡ªå®šä¹‰viewæ—¶ä¹Ÿé¡ºä¾¿ä½¿ç”¨äº†ä¸‹è‡ªå®šä¹‰å±æ€§ã€‚è‡ªå®šä¹‰å±æ€§ä»¥å‰åªæ˜¯è€³é—» æœªæ›¾è°‹é¢ï¼Œè¿™æ¬¡å€Ÿæœºä¼šå¯¹è‡ªå®šä¹‰å±æ€§è¿›è¡Œäº†ä¸€ç•ªå­¦ä¹ ï¼Œé¡ºä¾¿æ€»ç»“äº†ä¸€ä¸‹è‡ªå®šä¹‰å±æ€§çš„ä½¿ç”¨ã€‚
ä¸‹é¢æ‰«ç›²ç­è€å¸æœºè¦å¼€è½¦äº†ï¼Œå°ç™½å¿«åˆ·å¡ä¸Šè½¦ï¼Œå¤§ç¥æ‹’è½½ã€‚&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-03310748610842de.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-03310748610842de.webp" alt="è€å¸æœº" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>Androidä¸­ç»å¸¸ç”¨åˆ°è‡ªå®šä¹‰viewï¼Œæ—¢ç„¶ç”¨äº†è‡ªå®šä¹‰viewé‚£å°±ä¸å¾—ä¸æè‡ªå®šä¹‰å±æ€§ã€‚ä½ æ˜¯å¦æ€è€ƒè¿‡ä¸ºä»€ä¹ˆæˆ‘ä»¬åœ¨xmlæ–‡ä»¶ä¸­è¿›è¡Œå¸ƒå±€æ—¶å¯ä»¥ç›´æ¥é€šè¿‡&lt;code>android:layout_width=&amp;quot;match_parent&amp;quot;&lt;/code>å°±å¯ä»¥è®¾ç½®æ§ä»¶çš„å®½åº¦å‘¢ï¼Ÿä¸åªæ˜¯å®½åº¦ï¼Œå‡ ä¹æ§ä»¶çš„æ‰€æœ‰å±æ€§éƒ½å¯ä»¥åœ¨xmlæ–‡ä»¶ä¸­è¿›è¡Œè®¾ç½®ï¼Œè¿™æ˜¯æ€æ ·å®ç°çš„å‘¢ï¼Œthis is a question
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-03310748610842de.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-03310748610842de.webp" alt="TextViewéƒ¨åˆ†å±æ€§" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>æˆ‘ä»¬è‡ªå®šä¹‰viewæ—¶èƒ½ä¸èƒ½ä¹Ÿåƒç³»ç»Ÿæä¾›çš„æ§ä»¶ä¸€æ ·åœ¨xmlæ–‡ä»¶ä¸­è®¾ç½®å±æ€§å‘¢ã€‚ç­”æ¡ˆæ˜¯å½“ç„¶å¯ä»¥äº†ï¼Œç”¨åˆ°çš„å°±æ˜¯ä»Šå¤©è¦è¯´çš„è‡ªå®šä¹‰å±æ€§ã€‚åºŸè¯ä¸å¤šè¯´ ç›´æ¥å¼€å¹²ã€‚
1ï¼Œé¦–å…ˆåœ¨res çš„valuesæ–‡ä»¶å¤¹ä¸‹æ–°å»ºä¸€ä¸ªattrs.xmlæ–‡ä»¶ï¼Œå°±æ˜¯è¿™æ ·
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-2417ee7808124d9c">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-2417ee7808124d9c" alt="æ–°å»ºçš„attrs.xmlæ–‡ä»¶" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>2ï¼Œå¼€å§‹ç¼–å†™æˆ‘ä»¬éœ€è¦çš„å±æ€§ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-xml" data-lang="xml">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">&amp;lt;?xml version=&amp;#34;1.0&amp;#34; encoding=&amp;#34;utf-8&amp;#34;?&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span>&lt;span style="color:#ff79c6">&amp;lt;resources&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span> &lt;span style="color:#ff79c6">&amp;lt;declare-styleable&lt;/span> &lt;span style="color:#50fa7b">name=&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;burce&amp;#34;&lt;/span>&lt;span style="color:#ff79c6">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span> &lt;span style="color:#ff79c6">&amp;lt;attr&lt;/span> &lt;span style="color:#50fa7b">name=&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;mHeight&amp;#34;&lt;/span> &lt;span style="color:#50fa7b">format=&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;integer&amp;#34;&lt;/span>&lt;span style="color:#ff79c6">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span> &lt;span style="color:#ff79c6">&amp;lt;attr&lt;/span> &lt;span style="color:#50fa7b">name=&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;mWidth&amp;#34;&lt;/span> &lt;span style="color:#50fa7b">format=&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;integer&amp;#34;&lt;/span>&lt;span style="color:#ff79c6">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span> &lt;span style="color:#ff79c6">&amp;lt;attr&lt;/span> &lt;span style="color:#50fa7b">name=&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;mName&amp;#34;&lt;/span> &lt;span style="color:#50fa7b">format=&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;string&amp;#34;&lt;/span>&lt;span style="color:#ff79c6">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span> &lt;span style="color:#ff79c6">&amp;lt;attr&lt;/span> &lt;span style="color:#50fa7b">name=&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;sex&amp;#34;&lt;/span> &lt;span style="color:#50fa7b">format=&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;enum&amp;#34;&lt;/span>&lt;span style="color:#ff79c6">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span> &lt;span style="color:#ff79c6">&amp;lt;enum&lt;/span> &lt;span style="color:#50fa7b">name=&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;man&amp;#34;&lt;/span> &lt;span style="color:#50fa7b">value=&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;0&amp;#34;&lt;/span>&lt;span style="color:#ff79c6">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span> &lt;span style="color:#ff79c6">&amp;lt;enum&lt;/span> &lt;span style="color:#50fa7b">name=&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;woman&amp;#34;&lt;/span> &lt;span style="color:#50fa7b">value=&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;1&amp;#34;&lt;/span>&lt;span style="color:#ff79c6">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span> &lt;span style="color:#ff79c6">&amp;lt;/attr&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span> &lt;span style="color:#ff79c6">&amp;lt;attr&lt;/span> &lt;span style="color:#50fa7b">name=&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;student&amp;#34;&lt;/span> &lt;span style="color:#50fa7b">format=&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;boolean&amp;#34;&lt;/span>&lt;span style="color:#ff79c6">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span> &lt;span style="color:#ff79c6">&amp;lt;/declare-styleable&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span>&lt;span style="color:#ff79c6">&amp;lt;/resources&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¯´ä¸€ä¸‹ç”¨åˆ°çš„ä¸œè¥¿
&lt;code>&amp;lt;declare-styleable name=&amp;quot;burce&amp;quot;&amp;gt;&lt;/code>å…¶ä¸­çš„nameçš„å€¼éšä¾¿å®šä¹‰ä¸€ä¸ªï¼Œä¸è¦ä¸ç³»ç»Ÿçš„èµ·å†²çªã€‚
&lt;code> &amp;lt;attr name=&amp;quot;mHeight&amp;quot; format=&amp;quot;integer&amp;quot;/&amp;gt;&lt;/code>nameå°±æ˜¯è‡ªå®šä¹‰çš„å±æ€§çš„åå­—ï¼ˆæ¯”å¦‚ç³»ç»Ÿæ§ä»¶çš„android:layout_widthï¼‰ format å°±æ˜¯å±æ€§çš„ç±»å‹ï¼Œè¿™é‡Œæ”¯æŒ10ç§ç±»å‹ï¼Œå¸¸ç”¨çš„æœ‰stringï¼Œintegerï¼Œbooleanç­‰ç­‰ï¼Œè¿™æ¬¡æˆ‘ä»¬ç”¨åˆ°äº†æ•´å½¢ï¼Œæšä¸¾å’Œå¸ƒå°”
æ³¨æ„ï¼šæˆ‘ä»¬åœ¨è‡ªå®šä¹‰å±æ€§çš„åå­—çš„æ—¶å€™ä¸èƒ½ä¸ç³»ç»Ÿçš„åå­—å†²çªï¼Œå¦åˆ™ä¼šæŠ¥é”™&lt;/p>
&lt;p>3ï¼Œæ–°å»ºä¸€ä¸ªç±»ç»§æ‰¿Viewç±»ï¼Œå®ç°3ä¸ªæ„é€ æ–¹æ³•ï¼Œç„¶åè·å–æˆ‘ä»¬è‡ªå®šä¹‰çš„å±æ€§&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">public&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">class&lt;/span> &lt;span style="color:#50fa7b">MyView&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">extends&lt;/span> View {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span> &lt;span style="color:#8be9fd;font-style:italic">private&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">static&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">final&lt;/span> String TAG &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;MyView&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span> &lt;span style="color:#8be9fd;font-style:italic">private&lt;/span> &lt;span style="color:#8be9fd">int&lt;/span> heiget;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span> &lt;span style="color:#8be9fd;font-style:italic">private&lt;/span> &lt;span style="color:#8be9fd">int&lt;/span> width;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span> &lt;span style="color:#8be9fd;font-style:italic">private&lt;/span> String name;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span> &lt;span style="color:#8be9fd;font-style:italic">private&lt;/span> &lt;span style="color:#8be9fd">int&lt;/span> sex;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span> &lt;span style="color:#8be9fd;font-style:italic">private&lt;/span> &lt;span style="color:#8be9fd">boolean&lt;/span> student;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span> &lt;span style="color:#8be9fd;font-style:italic">public&lt;/span> &lt;span style="color:#50fa7b">MyView&lt;/span>(Context context) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span> &lt;span style="color:#ff79c6">this&lt;/span>(context,&lt;span style="color:#ff79c6">null&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span> &lt;span style="color:#8be9fd;font-style:italic">public&lt;/span> &lt;span style="color:#50fa7b">MyView&lt;/span>(Context context, AttributeSet attrs) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span> &lt;span style="color:#ff79c6">this&lt;/span>(context, attrs,0);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16&lt;/span>&lt;span> &lt;span style="color:#8be9fd;font-style:italic">public&lt;/span> &lt;span style="color:#50fa7b">MyView&lt;/span>(Context context, AttributeSet attrs, &lt;span style="color:#8be9fd">int&lt;/span> defStyleAttr) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17&lt;/span>&lt;span> &lt;span style="color:#8be9fd;font-style:italic">super&lt;/span>(context, attrs, defStyleAttr);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18&lt;/span>&lt;span> TypedArray array&lt;span style="color:#ff79c6">=&lt;/span>context.&lt;span style="color:#50fa7b">obtainStyledAttributes&lt;/span>(attrs, R.&lt;span style="color:#50fa7b">styleable&lt;/span>.&lt;span style="color:#50fa7b">burce&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19&lt;/span>&lt;span> heiget&lt;span style="color:#ff79c6">=&lt;/span>array.&lt;span style="color:#50fa7b">getInt&lt;/span>(R.&lt;span style="color:#50fa7b">styleable&lt;/span>.&lt;span style="color:#50fa7b">burce_mHeight&lt;/span>,0);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20&lt;/span>&lt;span> width&lt;span style="color:#ff79c6">=&lt;/span>array.&lt;span style="color:#50fa7b">getInt&lt;/span>(R.&lt;span style="color:#50fa7b">styleable&lt;/span>.&lt;span style="color:#50fa7b">burce_mWidth&lt;/span>,0);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21&lt;/span>&lt;span> name&lt;span style="color:#ff79c6">=&lt;/span>array.&lt;span style="color:#50fa7b">getString&lt;/span>(R.&lt;span style="color:#50fa7b">styleable&lt;/span>.&lt;span style="color:#50fa7b">burce_mName&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22&lt;/span>&lt;span> sex&lt;span style="color:#ff79c6">=&lt;/span>array.&lt;span style="color:#50fa7b">getInt&lt;/span>(R.&lt;span style="color:#50fa7b">styleable&lt;/span>.&lt;span style="color:#50fa7b">burce_sex&lt;/span>,0);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23&lt;/span>&lt;span> student&lt;span style="color:#ff79c6">=&lt;/span>array.&lt;span style="color:#50fa7b">getBoolean&lt;/span>(R.&lt;span style="color:#50fa7b">styleable&lt;/span>.&lt;span style="color:#50fa7b">burce_student&lt;/span>,&lt;span style="color:#ff79c6">true&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24&lt;/span>&lt;span> array.&lt;span style="color:#50fa7b">recycle&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26&lt;/span>&lt;span> Log.&lt;span style="color:#50fa7b">i&lt;/span>(TAG, &lt;span style="color:#f1fa8c">&amp;#34;height: &amp;#34;&lt;/span>&lt;span style="color:#ff79c6">+&lt;/span>heiget);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27&lt;/span>&lt;span> Log.&lt;span style="color:#50fa7b">i&lt;/span>(TAG, &lt;span style="color:#f1fa8c">&amp;#34;width: &amp;#34;&lt;/span>&lt;span style="color:#ff79c6">+&lt;/span>width);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28&lt;/span>&lt;span> Log.&lt;span style="color:#50fa7b">i&lt;/span>(TAG, &lt;span style="color:#f1fa8c">&amp;#34;name: &amp;#34;&lt;/span>&lt;span style="color:#ff79c6">+&lt;/span>name);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29&lt;/span>&lt;span> Log.&lt;span style="color:#50fa7b">i&lt;/span>(TAG, &lt;span style="color:#f1fa8c">&amp;#34;sex: &amp;#34;&lt;/span>&lt;span style="color:#ff79c6">+&lt;/span>sex);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30&lt;/span>&lt;span> Log.&lt;span style="color:#50fa7b">i&lt;/span>(TAG, &lt;span style="color:#f1fa8c">&amp;#34;student: &amp;#34;&lt;/span>&lt;span style="color:#ff79c6">+&lt;/span>student);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>TypedArray array=context.obtainStyledAttributes(attrs, R.styleable.burce);&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-f758038afb367abe.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-f758038afb367abe.webp" alt="Android Developers" />
&lt;/a>
&lt;/div>
è¿™æ˜¯Googleå®˜æ–¹ç»™çš„è§£é‡Šï¼Œå°±ç®€å•è¯´ä¸€ä¸‹ä¸¤ä¸ªå‚æ•°æ€ä¹ˆå¡«å§ï¼Œç¬¬ä¸€ä¸ªå¡«å½¢å‚çš„attrsï¼Œç¬¬äºŒä¸ªå¡« R.styleableæ˜¯å›ºå®šå†™æ³•ï¼Œbruceæ˜¯&lt;code>&amp;lt;declare-styleable name=&amp;quot;burce&amp;quot;&amp;gt;&lt;/code>ä¸­çš„nameçš„å€¼ã€‚
4ï¼Œå›åˆ°MainActivityçš„å¸ƒå±€æ–‡ä»¶ä¸­ä½¿ç”¨æˆ‘ä»¬çš„è‡ªå®šä¹‰view&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">&amp;lt;&lt;/span>?xml version&lt;span style="color:#ff79c6">=&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;1.0&amp;#34;&lt;/span> encoding&lt;span style="color:#ff79c6">=&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;utf-8&amp;#34;&lt;/span>?&lt;span style="color:#ff79c6">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span>&lt;span style="color:#ff79c6">&amp;lt;&lt;/span>RelativeLayout xmlns:android&lt;span style="color:#ff79c6">=&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;http://schemas.android.com/apk/res/android&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span> xmlns:app&lt;span style="color:#ff79c6">=&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;http://schemas.android.com/apk/res-auto&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span> xmlns:tools&lt;span style="color:#ff79c6">=&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;http://schemas.android.com/tools&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span> android:layout_width&lt;span style="color:#ff79c6">=&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;match_parent&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span> android:layout_height&lt;span style="color:#ff79c6">=&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;match_parent&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span> tools:context&lt;span style="color:#ff79c6">=&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;com.myviewtest.MainActivity&amp;#34;&lt;/span>&lt;span style="color:#ff79c6">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span> &lt;span style="color:#ff79c6">&amp;lt;&lt;/span>com&lt;span style="color:#ff79c6">.&lt;/span>myviewtest&lt;span style="color:#ff79c6">.&lt;/span>MyView
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span> android:layout_width&lt;span style="color:#ff79c6">=&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;match_parent&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span> android:layout_height&lt;span style="color:#ff79c6">=&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;match_parent&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span> app:mName&lt;span style="color:#ff79c6">=&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;bruce&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span> app:sex&lt;span style="color:#ff79c6">=&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;man&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span> app:mHeight&lt;span style="color:#ff79c6">=&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;100&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span> app:mWidth&lt;span style="color:#ff79c6">=&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;100&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15&lt;/span>&lt;span> app:student&lt;span style="color:#ff79c6">=&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;true&amp;#34;&lt;/span>&lt;span style="color:#ff79c6">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16&lt;/span>&lt;span>&lt;span style="color:#ff79c6">&amp;lt;/&lt;/span>RelativeLayout&lt;span style="color:#ff79c6">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æ³¨æ„ï¼šå¦‚æœAndroid studioæ²¡æœ‰åŠ ä¸Šå‘½åç©ºé—´çš„è¯éœ€è¦è‡ªå·±åŠ ä¸Š&lt;code> xmlns:app=&amp;quot;http://schemas.android.com/apk/res-auto&amp;quot;&lt;/code> åªæœ‰å£°æ˜äº†å‘½åç©ºé—´æ‰èƒ½ä½¿ç”¨è‡ªå®šä¹‰å±æ€§ï¼Œä¸æ‡‚å•¥æ˜¯å‘½åç©ºé—´çš„åŒå­¦å‘¢è‡ªå·±Googleå­¦ä¹ ä¸€ä¸‹å§ï¼ˆæœ€è¿‘åœ¨å­¦C++ï¼Œæˆ‘å°±å®‰C++ä¸­çš„å‘½åç©ºé—´ç†è§£çš„ï¼Œå¦‚æœä¸æ­£ç¡®è¿˜è¯·å¤§ç¥èµæ•™ï¼‰
&lt;attr name="height" format="integer"/> è¿™é‡Œçš„æˆ‘ä»¬åœ¨è¿™ç”¨äº†appå‘½åç©ºé—´ï¼Œæ‰€æœ‰æ‰€æœ‰çš„è‡ªå®šä¹‰å±æ€§çš„å¼€å¤´éƒ½åŠ ä¸Šäº†â€œapp:â€ã€‚&lt;/p>
&lt;p>å‡†å¤‡å·¥ä½œéƒ½åšå¥½äº†æ¥ä¸‹æ¥æˆ‘ä»¬å§åº”ç”¨è·‘èµ·æ¥çœ‹çœ‹å§ï¼Œè¿™é‡Œæˆ‘ä»¬é€šè¿‡æ‰“å°logæŸ¥çœ‹è‡ªå®šä¹‰å±æ€§çš„å€¼ã€‚&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-c84b11ee34379ad1.webp">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-c84b11ee34379ad1.webp" alt="è¿è¡Œç»“æœ" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>é€šè¿‡logå¯ä»¥å¾—çŸ¥ æˆ‘ä»¬åœ¨è‡ªå®šä¹‰viewä¸­æˆåŠŸçš„è·å–åˆ°äº†å±æ€§çš„å€¼ã€‚å¥½çš„è€å¸æœºå¹³å®‰åˆ°ç«™ï¼Œå°ç™½æœ‰åºä¸‹è½¦ã€‚
ç”±äºä½ é‡åˆ°äº†ä¸€ä¸ªå‡çš„è€å¸æœºï¼Œæ–‡ç« ä¸­å¦‚æœæœ‰ä¸æ­£ç¡®çš„åœ°æ–¹è¿˜è¯·å„ä½å¤§ç¥åœ¨è¯„è®ºåŒºæŒ‡æ­£ï¼Œè€å¸æœºåœ¨è¿™é‡ŒæŠ±æ‹³äº†ã€‚&lt;/p></description></item><item><title>åœ¨Androidä¸­å®ç°æ–‡ä»¶ä¸Šä¼ </title><link>https://lqxhub.github.io/posts/3c55041d/</link><pubDate>Wed, 15 Feb 2017 09:50:53 +0000</pubDate><guid>https://lqxhub.github.io/posts/3c55041d/</guid><description>&lt;p>æœ¬ä¾‹æ˜¯æˆ‘åœ¨å¹´å‰çš„é¡¹ç›®ä¸­ç”¨åˆ°çš„ä¸€ä¸ªå°ä¾‹å­ï¼Œä½¿ç”¨Androidè‡ªå¸¦çš„HttpURLConnectionå®ç°æ–‡ä»¶ä¸Šä¼ ã€‚ç½‘ä¸Šçš„èµ„æ–™å¯¹è¿™æ–¹é¢çš„è®²è§£ä¸å¤ªå¤šï¼Œæœ‰ä¸¤ä¸ªå®ä¾‹ä¹Ÿä¸å¤ªè¯¦ç»†ï¼Œæˆ‘åœ¨å¼€å‘ä¸­ç”¨åˆ°äº†ï¼Œè§‰å¾—æŒºå®ç”¨çš„ï¼Œåˆ†äº«å‡ºæ¥ï¼Œå¸Œæœ›èƒ½å¯¹å„ä½æœ‹å‹æœ‰æ‰€å¸®åŠ©ï¼Œå—æ°´å¹³æ‰€é™ï¼Œå®ä¾‹ä¸­å¦‚æœ‰è°¬å¤„ï¼Œè¿˜æœ›å„ä½å¤§ç¥æ‰¹è¯„æŒ‡æ­£ï¼Œè¿™ä¸ªå®ä¾‹ä¸ªäººè®¤ä¸ºé€‚ç”¨äºé¡¹ç›®ä¸­çš„æ–‡ä»¶ä¸Šä¼ æ¯”è¾ƒå°‘çš„æƒ…å†µï¼Œå½“æ–‡ä»¶ä¸Šä¼ æ¯”è¾ƒå¤šçš„æ—¶å€™è¿˜æ˜¯ç”¨æ¡†æ¶å§ï¼ˆä¾‹å¦‚okhtpï¼‰ã€‚
æœ¬æ¥æƒ³åœ¨åˆšæ”¾å¯’å‡å°±æ•´ç†ä¸€ä¸‹ï¼Œç”±äºå¹´å‰å›å®¶æ¯”è¾ƒæ™šäº†ï¼Œå¹´å‰å¹´åçš„äº‹æœ‰ç‚¹å¤šï¼Œç›´åˆ°ç°åœ¨æ‰æœ‰æ—¶é—´æ•´ç†ã€‚åºŸè¯ä¸å¤šè¯´ ç›´æ¥ä¸Šä»£ç ï¼š(ä»£ç æ˜¯æˆ‘ä»é¡¹ç›®ä¸­å‰ªå‡ºæ¥çš„ï¼Œå¯èƒ½ä¼šæœ‰æŠ¥é”™ï¼Œé—®é¢˜ä¸ä¼šå¤ªå¤§ï¼Œå¾ˆå¥½æ”¹)&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">import&lt;/span> android.os.Handler;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span>&lt;span style="color:#ff79c6">import&lt;/span> android.os.Message;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span>&lt;span style="color:#ff79c6">import&lt;/span> android.util.Log;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span>&lt;span style="color:#ff79c6">import&lt;/span> org.json.JSONException;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span>&lt;span style="color:#ff79c6">import&lt;/span> org.json.JSONObject;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span>&lt;span style="color:#ff79c6">import&lt;/span> java.io.BufferedReader;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span>&lt;span style="color:#ff79c6">import&lt;/span> java.io.DataOutputStream;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span>&lt;span style="color:#ff79c6">import&lt;/span> java.io.FileInputStream;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span>&lt;span style="color:#ff79c6">import&lt;/span> java.io.IOException;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span>&lt;span style="color:#ff79c6">import&lt;/span> java.io.InputStreamReader;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span>&lt;span style="color:#ff79c6">import&lt;/span> java.net.HttpURLConnection;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span>&lt;span style="color:#ff79c6">import&lt;/span> java.net.MalformedURLException;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span>&lt;span style="color:#ff79c6">import&lt;/span> java.net.URL;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15&lt;/span>&lt;span>&lt;span style="color:#8be9fd;font-style:italic">public&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">class&lt;/span> &lt;span style="color:#50fa7b">ArrivateUpload&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">extends&lt;/span> Thread {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17&lt;/span>&lt;span> &lt;span style="color:#8be9fd;font-style:italic">private&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">final&lt;/span> String BOUNDARYSTR &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;--------aifudao7816510d1hq&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18&lt;/span>&lt;span> &lt;span style="color:#8be9fd;font-style:italic">private&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">final&lt;/span> String END &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;\r\n&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19&lt;/span>&lt;span> &lt;span style="color:#8be9fd;font-style:italic">private&lt;/span> &lt;span style="color:#8be9fd;font-style:italic">final&lt;/span> String LAST &lt;span style="color:#ff79c6">=&lt;/span> &lt;span style="color:#f1fa8c">&amp;#34;--&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21&lt;/span>&lt;span> &lt;span style="color:#8be9fd;font-style:italic">private&lt;/span> String data;&lt;span style="color:#6272a4">//è¡¨å•æ•°æ®&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22&lt;/span>&lt;span> &lt;span style="color:#8be9fd;font-style:italic">private&lt;/span> FileInputStream fis;&lt;span style="color:#6272a4">//æ–‡ä»¶è¾“å…¥æµ&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23&lt;/span>&lt;span> &lt;span style="color:#8be9fd;font-style:italic">private&lt;/span> Handler handler;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25&lt;/span>&lt;span> &lt;span style="color:#8be9fd;font-style:italic">public&lt;/span> &lt;span style="color:#50fa7b">ArrivateUpload&lt;/span>(String data, FileInputStream fis, Handler handler) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26&lt;/span>&lt;span> &lt;span style="color:#ff79c6">this&lt;/span>.&lt;span style="color:#50fa7b">data&lt;/span> &lt;span style="color:#ff79c6">=&lt;/span> data;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27&lt;/span>&lt;span> &lt;span style="color:#ff79c6">this&lt;/span>.&lt;span style="color:#50fa7b">handler&lt;/span> &lt;span style="color:#ff79c6">=&lt;/span> handler;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28&lt;/span>&lt;span> &lt;span style="color:#ff79c6">this&lt;/span>.&lt;span style="color:#50fa7b">fis&lt;/span>&lt;span style="color:#ff79c6">=&lt;/span>fis;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31&lt;/span>&lt;span> @Override
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32&lt;/span>&lt;span> &lt;span style="color:#8be9fd;font-style:italic">public&lt;/span> &lt;span style="color:#8be9fd">void&lt;/span> &lt;span style="color:#50fa7b">run&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33&lt;/span>&lt;span> &lt;span style="color:#ff79c6">try&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34&lt;/span>&lt;span> URL httpUrl&lt;span style="color:#ff79c6">=&lt;/span>&lt;span style="color:#ff79c6">new&lt;/span> URL(urlStr);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35&lt;/span>&lt;span> HttpURLConnection connection&lt;span style="color:#ff79c6">=&lt;/span> (HttpURLConnection) httpUrl.&lt;span style="color:#50fa7b">openConnection&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36&lt;/span>&lt;span> connection.&lt;span style="color:#50fa7b">setRequestMethod&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;POST&amp;#34;&lt;/span>);&lt;span style="color:#6272a4">//å¿…é¡»ä¸ºpost&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37&lt;/span>&lt;span> connection.&lt;span style="color:#50fa7b">setDoInput&lt;/span>(&lt;span style="color:#ff79c6">true&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38&lt;/span>&lt;span> connection.&lt;span style="color:#50fa7b">setDoOutput&lt;/span>(&lt;span style="color:#ff79c6">true&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39&lt;/span>&lt;span> connection.&lt;span style="color:#50fa7b">setRequestProperty&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;Content-type&amp;#34;&lt;/span>, &lt;span style="color:#f1fa8c">&amp;#34;multipart/form-data;boundary=&amp;#34;&lt;/span> &lt;span style="color:#ff79c6">+&lt;/span> BOUNDARYSTR);&lt;span style="color:#6272a4">//å›ºå®šæ ¼å¼&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40&lt;/span>&lt;span> DataOutputStream dos&lt;span style="color:#ff79c6">=&lt;/span>&lt;span style="color:#ff79c6">new&lt;/span> DataOutputStream(connection.&lt;span style="color:#50fa7b">getOutputStream&lt;/span>());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41&lt;/span>&lt;span> StringBuffer sb&lt;span style="color:#ff79c6">=&lt;/span>&lt;span style="color:#ff79c6">new&lt;/span> StringBuffer();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42&lt;/span>&lt;span> &lt;span style="color:#6272a4">/**
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43&lt;/span>&lt;span>&lt;span style="color:#6272a4"> * å†™å…¥æ–‡æœ¬æ•°æ®
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44&lt;/span>&lt;span>&lt;span style="color:#6272a4"> */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45&lt;/span>&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46&lt;/span>&lt;span> sb.&lt;span style="color:#50fa7b">append&lt;/span>(LAST&lt;span style="color:#ff79c6">+&lt;/span>BOUNDARYSTR&lt;span style="color:#ff79c6">+&lt;/span>END);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47&lt;/span>&lt;span> sb.&lt;span style="color:#50fa7b">append&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;Content-Disposition: form-data; name=\&amp;#34;data\&amp;#34;&amp;#34;&lt;/span>&lt;span style="color:#ff79c6">+&lt;/span>END&lt;span style="color:#ff79c6">+&lt;/span>END);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48&lt;/span>&lt;span> sb.&lt;span style="color:#50fa7b">append&lt;/span>(data&lt;span style="color:#ff79c6">+&lt;/span>END);&lt;span style="color:#6272a4">//å†…å®¹&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49&lt;/span>&lt;span> &lt;span style="color:#6272a4">/**
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50&lt;/span>&lt;span>&lt;span style="color:#6272a4"> * å¾ªç¯å†™å…¥æ–‡ä»¶
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">51&lt;/span>&lt;span>&lt;span style="color:#6272a4"> */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">52&lt;/span>&lt;span>sb.&lt;span style="color:#50fa7b">append&lt;/span>(LAST&lt;span style="color:#ff79c6">+&lt;/span>BOUNDARYSTR&lt;span style="color:#ff79c6">+&lt;/span>END);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">53&lt;/span>&lt;span>sb.&lt;span style="color:#50fa7b">append&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;Content-Disposition:form-data;Content-Type:application/octet-stream;name=\&amp;#34;file\&amp;#34;;&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">54&lt;/span>&lt;span> sb.&lt;span style="color:#50fa7b">append&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;filename=\&amp;#34;&amp;#34;&lt;/span>&lt;span style="color:#ff79c6">+&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;map_image.png&amp;#34;&lt;/span>&lt;span style="color:#ff79c6">+&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;\&amp;#34;&amp;#34;&lt;/span>&lt;span style="color:#ff79c6">+&lt;/span>END&lt;span style="color:#ff79c6">+&lt;/span>END);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">55&lt;/span>&lt;span> dos.&lt;span style="color:#50fa7b">write&lt;/span>(sb.&lt;span style="color:#50fa7b">toString&lt;/span>().&lt;span style="color:#50fa7b">getBytes&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;utf-8&amp;#34;&lt;/span>));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">56&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (fis &lt;span style="color:#ff79c6">!=&lt;/span> &lt;span style="color:#ff79c6">null&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">57&lt;/span>&lt;span> &lt;span style="color:#8be9fd">byte&lt;/span>&lt;span style="color:#ff79c6">[]&lt;/span> b&lt;span style="color:#ff79c6">=&lt;/span>&lt;span style="color:#ff79c6">new&lt;/span> &lt;span style="color:#8be9fd">byte&lt;/span>&lt;span style="color:#ff79c6">[&lt;/span>1024&lt;span style="color:#ff79c6">]&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">58&lt;/span>&lt;span> &lt;span style="color:#8be9fd">int&lt;/span> len;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">59&lt;/span>&lt;span> &lt;span style="color:#ff79c6">while&lt;/span> ((len&lt;span style="color:#ff79c6">=&lt;/span>fis.&lt;span style="color:#50fa7b">read&lt;/span>(b))&lt;span style="color:#ff79c6">!=-&lt;/span>1){
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">60&lt;/span>&lt;span> dos.&lt;span style="color:#50fa7b">write&lt;/span>(b,0,len);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">61&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">62&lt;/span>&lt;span> dos.&lt;span style="color:#50fa7b">write&lt;/span>(END.&lt;span style="color:#50fa7b">getBytes&lt;/span>());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">63&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">64&lt;/span>&lt;span> dos.&lt;span style="color:#50fa7b">write&lt;/span>((LAST&lt;span style="color:#ff79c6">+&lt;/span>BOUNDARYSTR&lt;span style="color:#ff79c6">+&lt;/span>LAST&lt;span style="color:#ff79c6">+&lt;/span>END).&lt;span style="color:#50fa7b">getBytes&lt;/span>());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">65&lt;/span>&lt;span> dos.&lt;span style="color:#50fa7b">flush&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">66&lt;/span>&lt;span> sb&lt;span style="color:#ff79c6">=&lt;/span>&lt;span style="color:#ff79c6">new&lt;/span> StringBuffer();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">67&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (connection.&lt;span style="color:#50fa7b">getResponseCode&lt;/span>()&lt;span style="color:#ff79c6">==&lt;/span>200) {&lt;span style="color:#6272a4">//è¯·æ±‚æˆåŠŸ&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">68&lt;/span>&lt;span> BufferedReader br&lt;span style="color:#ff79c6">=&lt;/span>&lt;span style="color:#ff79c6">new&lt;/span> BufferedReader(&lt;span style="color:#ff79c6">new&lt;/span> InputStreamReader(connection.&lt;span style="color:#50fa7b">getInputStream&lt;/span>()));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">69&lt;/span>&lt;span> String line;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">70&lt;/span>&lt;span> &lt;span style="color:#ff79c6">while&lt;/span> ((line&lt;span style="color:#ff79c6">=&lt;/span>br.&lt;span style="color:#50fa7b">readLine&lt;/span>())&lt;span style="color:#ff79c6">!=&lt;/span>&lt;span style="color:#ff79c6">null&lt;/span>){
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">71&lt;/span>&lt;span> sb.&lt;span style="color:#50fa7b">append&lt;/span>(line);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">72&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">73&lt;/span>&lt;span> Message msg&lt;span style="color:#ff79c6">=&lt;/span>Message.&lt;span style="color:#50fa7b">obtain&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">74&lt;/span>&lt;span> JSONObject object&lt;span style="color:#ff79c6">=&lt;/span>&lt;span style="color:#ff79c6">new&lt;/span> JSONObject(sb.&lt;span style="color:#50fa7b">toString&lt;/span>());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">75&lt;/span>&lt;span> handler.&lt;span style="color:#50fa7b">sendMessage&lt;/span>(msg);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">76&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">77&lt;/span>&lt;span> } &lt;span style="color:#ff79c6">catch&lt;/span> (MalformedURLException e) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">78&lt;/span>&lt;span> e.&lt;span style="color:#50fa7b">printStackTrace&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">79&lt;/span>&lt;span> } &lt;span style="color:#ff79c6">catch&lt;/span> (IOException e) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">80&lt;/span>&lt;span> e.&lt;span style="color:#50fa7b">printStackTrace&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">81&lt;/span>&lt;span> } &lt;span style="color:#ff79c6">catch&lt;/span> (JSONException e) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">82&lt;/span>&lt;span> e.&lt;span style="color:#50fa7b">printStackTrace&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">83&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">84&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">85&lt;/span>&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¯´ä¸€ä¸‹å®ç°æ€è·¯ï¼šç”¨Androidç³»ç»Ÿä¸­æä¾›çš„HttpURLConnectionï¼Œåˆ©ç”¨httpä¸­çš„multipartåè®®å®ç°æ–‡ä»¶ä¸Šä¼ ã€‚httpUrlConnectionåº”è¯¥ä¸ç”¨å¤šè¯´äº†ï¼ˆä¸å¤ªç†Ÿæ‚‰çš„åŒå­¦å»Googleå­¦ä¹ ä¸€ä¸‹HttpURLConnectionå’Œhttpåè®®å§ï¼‰ï¼Œå°±è¯´å‡ ä¸ªæ³¨æ„ç‚¹å§ï¼Œè¯·æ±‚æ¨¡å¼è®¾ç½®ä¸ºPOSTï¼Œæ‰“å¼€è¾“å…¥è¾“å‡ºæµï¼ˆè¿™ä¸ªå¥½åƒé»˜è®¤æ˜¯å¼€å¯çš„ï¼Œè¿˜æ˜¯è®¾ç½®ä¸ºtrueæ¯”è¾ƒæ”¾å¿ƒï¼‰
é‡ç‚¹è¯´ä¸€ä¸‹multipartåè®®å§ï¼Œå› ä¸ºæ™®é€šçš„http poståè®®ä½¿ç”¨çš„åˆ†éš”ç¬¦å¤ªç®€å•ï¼Œä¸Šä¼ æ–‡ä»¶ä¼šé€ æˆæ–‡ä»¶åˆ†å‰²æ­§ä¹‰ï¼Œæ‰€ä»¥å¿…é¡»ä½¿ç”¨multipartåè®®ã€‚ å†™ä¸€ä¸ªç®€å•çš„HTMLè¡¨å•æ–‡ä»¶ä¸Šä¼ çš„ä¾‹å­ï¼Œå¯¹ç…§å­¦ä¹ ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-xml" data-lang="xml">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>&lt;span style="color:#ff79c6">&amp;lt;!DOCTYPE html&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span>&lt;span style="color:#ff79c6">&amp;lt;html&lt;/span> &lt;span style="color:#50fa7b">lang=&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;en&amp;#34;&lt;/span>&lt;span style="color:#ff79c6">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span>&lt;span style="color:#ff79c6">&amp;lt;head&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span> &lt;span style="color:#ff79c6">&amp;lt;meta&lt;/span> &lt;span style="color:#50fa7b">charset=&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;UTF-8&amp;#34;&lt;/span>&lt;span style="color:#ff79c6">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span> &lt;span style="color:#ff79c6">&amp;lt;title&amp;gt;&lt;/span>upload&lt;span style="color:#ff79c6">&amp;lt;/title&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span>&lt;span style="color:#ff79c6">&amp;lt;/head&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span>&lt;span style="color:#ff79c6">&amp;lt;body&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span>&lt;span style="color:#ff79c6">&amp;lt;form&lt;/span> &lt;span style="color:#50fa7b">action=&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;a.php&amp;#34;&lt;/span> &lt;span style="color:#50fa7b">method=&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;post&amp;#34;&lt;/span> &lt;span style="color:#50fa7b">enctype=&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;multipart/form-data&amp;#34;&lt;/span>&lt;span style="color:#ff79c6">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span> &lt;span style="color:#ff79c6">&amp;lt;input&lt;/span> &lt;span style="color:#50fa7b">type=&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;text&amp;#34;&lt;/span> &lt;span style="color:#50fa7b">name=&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;data&amp;#34;&lt;/span>&lt;span style="color:#ff79c6">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span> &lt;span style="color:#ff79c6">&amp;lt;input&lt;/span> &lt;span style="color:#50fa7b">type=&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;file&amp;#34;&lt;/span> &lt;span style="color:#50fa7b">name=&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;file&amp;#34;&lt;/span>&lt;span style="color:#ff79c6">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span> &lt;span style="color:#ff79c6">&amp;lt;input&lt;/span> &lt;span style="color:#50fa7b">type=&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;submit&amp;#34;&lt;/span>&lt;span style="color:#ff79c6">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span>&lt;span style="color:#ff79c6">&amp;lt;/form&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span>&lt;span style="color:#ff79c6">&amp;lt;/body&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14&lt;/span>&lt;span>&lt;span style="color:#ff79c6">&amp;lt;/html&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>åœ¨æµè§ˆå™¨ä¸­é€šè¿‡è°ƒè¯•æˆ‘ä»¬å¯ä»¥å¯¹ç…§æµè§ˆå™¨æ¥æ‹¼å‡ºmultipartåè®®ï¼Œæµè§ˆå™¨ä¼šæŠ¥404,a.php æ²¡æœ‰æ‰¾åˆ°ï¼Œä¸ç”¨ç®¡å®ƒï¼Œè¿™ä¸æ˜¯æˆ‘ä»¬å…³æ³¨çš„é‡ç‚¹ã€‚ä¸‹å›¾å°±æ˜¯æµè§ˆå™¨ä¸­çš„è¯¦ç»†ä¿¡æ¯&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-6e76fb78588d3baf.png">
&lt;img src="https://cdn.jsdelivr.net/gh/lqxhub/images@master/blog/3622259-6e76fb78588d3baf.png" alt="Paste_Image.png" />
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>åœ¨1å¤„å®šä¹‰äº†åˆ†éš”ç¬¦ï¼Œåˆ†éš”ç¬¦å°½é‡å¤æ‚ä¸€ç‚¹ï¼Œé¿å…é€ æˆä¸æ–‡ä»¶ä¸­çš„å­—ç¬¦äº§ç”Ÿå†²çªã€‚æ³¨æ„äº†ï¼Œå‰æ–¹æœ‰å¤§å‘ï¼Œæ³¨æ„è„šä¸‹æ²¹é—¨ï¼Œè€å¸æœºä¸€ä¸ç•™ç¥ä¹Ÿä¼šç¿»è½¦ã€‚ä»”ç»†å¯¹æ¯”ä½ ä¼šå‘ç°2,3,4å¤„å’Œ1å¤„æ˜¯ä¸åŒçš„ï¼Œ2,3,4å¤„æ¯”1å¤„å¤šäº†ä¸¤ä¸ªâ€œ-â€,ä¸€å®šè¦ç•™ç¥ï¼Œè¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬åœ¨ä½¿ç”¨boundaryæ—¶è¦åŠ ä¸Šâ€œ&amp;ndash;â€çš„åŸå› äº†ã€‚sb.append(LAST+BOUNDARYSTR+END); åœ¨4å¤„ï¼Œæ•´ä¸ªbodyçš„ç»“æŸå¤„è¦åŠ ä¸Šä¸€ä¸ªâ€œ&amp;ndash;â€ï¼Œæ²¡æœ‰whyï¼Œåè®®å°±æ˜¯è¿™æ ·è§„å®šçš„ã€‚&lt;/p>
&lt;p>æ¯ä¸€è¡Œç»“æŸéƒ½è¦æœ‰ä¸€ä¸ª&amp;quot;\r\n&amp;quot;ï¼Œç¬¬äºŒè¡Œç»“æŸæ—¶ï¼ˆæ•°æ®æ–‡ä»¶å¼€å§‹å‰ï¼‰è¦æœ‰ä¸¤ä¸ª&amp;quot;\r\n&amp;quot;ã€‚å¯¹æ¯”å›¾ä¸­ä¼šå‘ç°æ•°æ®æ–‡ä»¶å‰æœ‰ä¸€ä¸ªç©ºè¡Œã€‚è¿˜æœ‰éå¸¸é‡è¦çš„ä¸€ç‚¹ï¼Œåƒä¸‡æ³¨æ„å¼•å·(â€œ â€)çš„è½¬ä¹‰é—®é¢˜ï¼Œå¦‚æœå¼•å·å‡ºé—®é¢˜å°±ä¼šå¯¼è‡´ä¸Šä¼ å¤±è´¥ï¼Œè€Œä¸”è¿™ä¸ªé”™è¯¯è¿˜ä¸å®¹æ˜“å‘ç°ã€‚æ–‡ä»¶å†™å…¥éœ€è¦ç”¨è¾“å…¥æµå¾ªç¯å†™å…¥&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1&lt;/span>&lt;span>sb.&lt;span style="color:#50fa7b">append&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;Content-Disposition:form-data;Content-Type:application/octet-stream;name=\&amp;#34;file\&amp;#34;;&amp;#34;&lt;/span>); &lt;span style="color:#6272a4">//name ä¹‹å‰æ˜¯å›ºå®šå†™æ³•ï¼Œ è¿™é‡Œçš„nameæ˜¯æœåŠ¡ç«¯æ¥æ”¶æ—¶éœ€è¦ç”¨åˆ°çš„ï¼Œ&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2&lt;/span>&lt;span>sb.&lt;span style="color:#50fa7b">append&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;filename=\&amp;#34;&amp;#34;&lt;/span>&lt;span style="color:#ff79c6">+&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;map_image.png&amp;#34;&lt;/span>&lt;span style="color:#ff79c6">+&lt;/span>&lt;span style="color:#f1fa8c">&amp;#34;\&amp;#34;&amp;#34;&lt;/span>&lt;span style="color:#ff79c6">+&lt;/span>END&lt;span style="color:#ff79c6">+&lt;/span>END); &lt;span style="color:#6272a4">// è¿™é‡Œçš„filenameçš„å€¼éšä¾¿å†™ï¼Œæ— æ‰€è°“ï¼Œä½†æ˜¯ä¸€å®šè¦æœ‰ï¼Œæ²¡æœ‰ä¼šå¯¼è‡´ä¸Šä¼ å¤±è´¥ã€‚&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3&lt;/span>&lt;span>dos.&lt;span style="color:#50fa7b">write&lt;/span>(sb.&lt;span style="color:#50fa7b">toString&lt;/span>().&lt;span style="color:#50fa7b">getBytes&lt;/span>(&lt;span style="color:#f1fa8c">&amp;#34;utf-8&amp;#34;&lt;/span>));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4&lt;/span>&lt;span> &lt;span style="color:#ff79c6">if&lt;/span> (fis &lt;span style="color:#ff79c6">!=&lt;/span> &lt;span style="color:#ff79c6">null&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5&lt;/span>&lt;span> &lt;span style="color:#8be9fd">byte&lt;/span>&lt;span style="color:#ff79c6">[]&lt;/span> b&lt;span style="color:#ff79c6">=&lt;/span>&lt;span style="color:#ff79c6">new&lt;/span> &lt;span style="color:#8be9fd">byte&lt;/span>&lt;span style="color:#ff79c6">[&lt;/span>1024&lt;span style="color:#ff79c6">]&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6&lt;/span>&lt;span> &lt;span style="color:#8be9fd">int&lt;/span> len;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7&lt;/span>&lt;span> &lt;span style="color:#ff79c6">while&lt;/span> ((len&lt;span style="color:#ff79c6">=&lt;/span>fis.&lt;span style="color:#50fa7b">read&lt;/span>(b))&lt;span style="color:#ff79c6">!=-&lt;/span>1){
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8&lt;/span>&lt;span> dos.&lt;span style="color:#50fa7b">write&lt;/span>(b,0,len);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10&lt;/span>&lt;span> dos.&lt;span style="color:#50fa7b">write&lt;/span>(END.&lt;span style="color:#50fa7b">getBytes&lt;/span>());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11&lt;/span>&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12&lt;/span>&lt;span> dos.&lt;span style="color:#50fa7b">write&lt;/span>((LAST&lt;span style="color:#ff79c6">+&lt;/span>BOUNDARYSTR&lt;span style="color:#ff79c6">+&lt;/span>LAST&lt;span style="color:#ff79c6">+&lt;/span>END).&lt;span style="color:#50fa7b">getBytes&lt;/span>());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13&lt;/span>&lt;span> dos.&lt;span style="color:#50fa7b">flush&lt;/span>();
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å†åˆ†äº«ä¸€ä¸ªè°ƒè¯•æŠ€å·§ï¼Œæˆ‘ä»¬çš„ç¨‹åºæ˜¯è·‘åœ¨Androidä¸Šçš„ï¼Œæˆ‘ä»¬æ˜¯æ— æ³•åƒåœ¨æµè§ˆå™¨ä¸­é‚£æ ·è°ƒè¯•çš„ï¼Œæ‰€ä»¥å¼€æŠ“åŒ…æ˜¯éå¸¸å¿…è¦çš„ï¼ˆgenymationè‡ªå¸¦æŠ“åŒ…å™¨ï¼Œç†Ÿæ‚‰linuxçš„å¯ä»¥ç›´æ¥ä½¿ç”¨ï¼‰ï¼Œåœ¨æ¨¡æ‹Ÿå™¨ä¸Šè¿è¡Œç¨‹åºï¼Œç”µè„‘å¼€å¯æŠ“åŒ…å™¨ï¼Œæ¯æ¬¡ä¸Šä¼ éƒ½æŠ“å–ä¸€ä¸ªæ•°æ®åŒ…ï¼Œåˆ†ææ•°æ®åŒ…ï¼Œå¦‚æœå‡ºé”™äº†ä¸æµè§ˆå™¨çš„æ ¼å¼å¯¹æ¯”ï¼Œè¿™æ ·è°ƒè¯•ä¸è¦å¤ªé…¸çˆ½ã€‚æœ‰æ¬¡ä¸Šä¼ çš„å†…å®¹æœ‰ç‚¹å¤æ‚ï¼Œä¸€ç›´è°ƒè¯•ä¸æ­£ç¡®ï¼Œæœ€åç”¨æŠ“åŒ…å¯¹æ¯”æå®šäº†ã€‚æˆ‘ç”¨çš„æ˜¯wiresharkï¼Œè¿™ä¸ªåŠŸèƒ½å¤ªå¼ºå¤§äº†ï¼Œç›´æ¥åœ¨ç½‘å¡å®‰è£…é©±åŠ¨ï¼Œåªè¦ç»è¿‡ç½‘å¡çš„æ•°æ®éƒ½èƒ½æŠ“åˆ°ï¼ˆæƒ³è±¡åŠ›ä¸°å¯Œçš„åŒå­¦å¯ä»¥ç”¨å®ƒæ¥å¹²ç‚¹åäº‹æƒ… æ­¤å¤„ç•¥å»ä¸€åƒå­—â€¦â€¦ï¼‰ã€‚è¿˜æœ‰ä¸€ä¸ªåœ°æ–¹éœ€è¦æ³¨æ„ä¸€ä¸‹ï¼Œwiresharkä¸èƒ½æŠ“ipä¸º127.0.0.1çš„æ•°æ®åŒ…ï¼ˆç”¨æœ¬åœ°ç”µè„‘åšæœåŠ¡å™¨ï¼‰ï¼Œå› ä¸ºè¿™æ—¶çš„æ•°æ®ä¸ç»è¿‡ç½‘å¡ï¼Œæ‰€ä»¥æ— æ³•æŠ“å–ã€‚
ç”±äºæ°´å¹³æœ‰é™ï¼ŒåŠ ä¹‹æ—¶é—´åŒ†å¿™ï¼Œå¦‚æœ‰è°¬å¤„ï¼Œè¿˜è¯·å„ä½å¤§ç¥æ‰¹è¯„æŒ‡æ­£&lt;/p></description></item></channel></rss>